\input{preamble}

% OK, start here.
%
\begin{document}

\title{Relative Cycles}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents



\section{Introduction}
\label{section-introduction}

\noindent
A foundational reference is \cite{SV}.

\medskip\noindent
In this chapter we only define what are called the universally integral
relative cycles in \cite{SV}. This choice makes the theory somewhat
simpler to develop than in the original, but of course we also lose something.

\medskip\noindent
Fix a morphism $X \to S$ of finite type 
between Noetherian schemes. A family $\alpha$ of $r$-cycles on fibres
of $X/S$ is simply a collection $\alpha = (\alpha_s)_{s \in S}$
where $\alpha_s \in Z_r(X_s)$. It is immediately clear how to
base change $g^*\alpha$ of $\alpha$ along any morphism $g : S' \to S$.
Then we say $\alpha$ is a {\it relative $r$-cycle on $X/S$}
if $\alpha$ is compatible with specializations, i.e., for any
morphism $g : S' \to S$ where $S'$ is the spectrum of a discrete
valuation ring, we require the generic fibre of $g^*\alpha$
to specialize to the closed fibre of $g^*\alpha$.
See Section \ref{section-families-specialization}.






\section{Conventions and notation}
\label{section-conventions}

\noindent
Please consult the chapter on Chow Homology and Chern Classes
for our conventions and notation regarding cycles on schemes
locally of finite type over a fixed Noetherian base, see
Chow Homology, Section \ref{chow-section-setup} ff.

\medskip\noindent
In particular, if $X$ is locally of finite type over a field $k$,
then $Z_r(X)$ denotes the group of cycles of dimension $r$, see
Chow Homology, Example \ref{chow-example-field} and
Section \ref{chow-section-cycles}. Given an integral closed
subscheme $Z \subset X$ with $\dim(Z) = r$ we have $[Z] \in Z_r(X)$
and if $X$ is quasi-compact, then $Z_r(X)$ is free abelian on these classes.




\section{Cycles relative to fields}
\label{section-relative-fields}

\noindent
Let $k$ be a field. Let $X$ be a locally algebraic scheme over $k$.
Let $r \geq 0$ be an integer. In this setting we have the group
$Z_r(X)$ of $r$-cycles on $X$, see Section \ref{section-conventions}.

\medskip\noindent
{\bf Base change.} For any field extension $k'/k$ there is a base change
map $Z_r(X) \to Z_r(X_{k'})$, see
Chow Homology, Section \ref{chow-section-change-base}.
Namely, given an integral closed subscheme $Z \subset X$
of dimension $r$ we send $[Z] \in Z_r(X)$ to the $r$-cycle
$[Z_{k'}]_r \in Z_r(X_{k'})$ associated to the closed subscheme
$Z_{k'} \subset X_{k'}$ (of course in general $Z_{k'}$
is neither irreducible nor reduced). The base change map
$Z_r(X) \to Z_r(X_{k'})$ is always injective.

\begin{lemma}
\label{lemma-multiplicities-field-extension}
Let $K/k$ be a field extension. Let $Z$ be an integral locally algebraic
scheme over $k$. The multiplicity $m_{Z', Z_K}$ of an irreducible
component $Z' \subset Z_K$ is $1$ or a power of the characteristic of $k$.
\end{lemma}

\begin{proof}
If the characteristic of $k$ is zero, then $k$ is perfect and
the multiplicity is always $1$ since $X_K$ is reduced by
Varieties, Lemma \ref{varieties-lemma-geometrically-reduced}.
Assume the characteristic of $k$ is $p > 0$.
Let $L$ be the function field of $Z$. Since $Z$ is locally algebraic
over $k$, the field extension $L/k$ is finitely generated.
The ring $K \otimes_k L$ is Noetherian
(Algebra, Lemma \ref{algebra-lemma-Noetherian-field-extension}).
Translated into algebra, we have to show that the length of the
artinian local ring $(K \otimes_k L)_\mathfrak q$
is a power of $p$ for every minimal prime ideal $\mathfrak q$.

\medskip\noindent
Let $L'/L$ be a finite purely inseparable extension, say of degree
$p^n$. Then $K \otimes_k L \subset K \otimes_k L'$ is a finite
free ring map of degree $p^n$ which induces a homeomorphism on
spectra and purely inseparable residue field extensions.
Hence for every minimal prime $\mathfrak q$ as above
there is a unique minimal prime
$\mathfrak q' \subset K \otimes_k L'$ lying over it and
$$
p^n \text{length}((K \otimes_k L)_\mathfrak q) =
[\kappa(\mathfrak q') : \kappa(\mathfrak q)]
\text{length}((K \otimes_k L')_{\mathfrak q'})
$$
by Algebra, Lemma \ref{algebra-lemma-pushdown-module} applied
to $M = (K \otimes_k L')_{\mathfrak q'} \cong
(K \otimes_k L)_{\mathfrak q}^{\oplus p^n}$.
Since $[\kappa(\mathfrak q') : \kappa(\mathfrak q)]$ is a power
of $p$ we conclude that it suffices to prove the
statement for $L'$ and $\mathfrak q'$.

\medskip\noindent
By the previous paragraph and Algebra, Lemma \ref{algebra-lemma-make-separable}
we may assume that we have a subfield $L/k'/k$ such that $L/k'$ is separable
and $k'/k$ is finite purely inseparable. Then $K \otimes_k k'$ is an
Artinian local ring. The argument of the preceding paragraph
(applied to $L = k$ and $L' = k'$) shows that $\text{length}(K \otimes_k k')$
is a power of $p$. Since $L/k'$ is the localization of a
smooth $k'$-algebra
(Algebra, Lemma \ref{algebra-lemma-localization-smooth-separable}).
Hence $S = (K \otimes_k L)_\mathfrak q$ is the localization of a smooth
$R = K \otimes_k k'$-algebra at a minimal prime.
Thus $R \to S$ is a flat local homomorphism of Artinian
local rings and $\mathfrak m_R S = \mathfrak m_S$. It
follows from Algebra, Lemma \ref{algebra-lemma-pullback-module} that
$\text{length}(K \otimes_k k') = \text{length}(R) =
\text{length}(S) = \text{length}((K \otimes_k L)_\mathfrak q)$
and the proof is finished.
\end{proof}

\begin{lemma}
\label{lemma-how-different}
Let $k$ be a field of characteristic $p > 0$ with perfect closure $k^{perf}$.
Let $X$ be an algebraic scheme over $k$. Let $r \geq 0$ be an integer.
The cokernel of the injective map $Z_r(X) \to Z_r(X_{k^{perf}})$ is a
$p$-power torsion module (More on Algebra, Definition
\ref{more-algebra-definition-f-power-torsion}).
\end{lemma}

\begin{proof}
Since $X$ is quasi-compact, the abelian group $Z_r(X)$ is free with basis
given by the integral closed subschemes of dimension $r$. Similarly for
$Z_r(X_{k^{perf}})$.
Since $X_{k^{perf}} \to X$ is a homeomorphism, it follows
that $Z_r(X) \to Z_r(X_{k^{perf}})$ is injective with torsion cokernel.
Every element in the cokernel is $p$-power torsion by
Lemma \ref{lemma-multiplicities-field-extension}.
\end{proof}





\section{Specialization of cycles}
\label{section-specialization}

\noindent
Let $R$ be a discrete valuation ring with fraction field $K$
and residue field $\kappa$. Let $X$ be a scheme locally of finite type
over $R$. Let $r \geq 0$. There is a specialization map
$$
sp_{X/R} : Z_r(X_K) \longrightarrow Z_r(X_\kappa)
$$
defined as follows. For an integral closed subscheme $Z \subset X_K$
of dimension $r$ we denote $\overline{Z}$ the scheme theoretic image
of $Z \to X$. Then we let $sp_{X/R}$ be the unique $\mathbf{Z}$-linear
map such that
$$
sp_{X/R}([Z]) = [\overline{Z}_\kappa]_r
$$
We briefly discuss why this is well defined. First, observe that the
morphism $X_K \to X$ is quasi-compact and hence the morphism $Z \to X$
is quasi-compact. Thus taking the scheme theoretic image of $Z \to X$
commutes with flat base change by
Morphisms, Lemma \ref{morphisms-lemma-flat-base-change-scheme-theoretic-image}.
In particular, base changing back to $X_K$ we see that $Z = \overline{Z}_K$.
Since $Z$ is integral, of course $\overline{Z}$ is integral too and
in fact is equal to the unique integral closed subscheme whose generic
point is the (image of the) generic point of $Z$. It follows from
Varieties, Lemma \ref{varieties-lemma-dominate-valuation-ring-dimension-fibres}
that $Z_\kappa$ is equidimensional of dimension $r$.

\begin{lemma}
\label{lemma-specialization-module}
Let $R$ be a discrete valuation ring with fraction field $K$ and residue field
$\kappa$. Let $X$ be a scheme locally of finite type over $R$. Let $r \geq 0$.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module flat over $R$. Assume
$\dim(\text{Supp}(\mathcal{F}_K)) \leq r$. Then
$\dim(\text{Supp}(\mathcal{F}_\kappa)) \leq r$ and
$$
sp_{X/R}([\mathcal{F}_K]_r) = [\mathcal{F}_\kappa]_r
$$
\end{lemma}

\begin{proof}
The statement on dimension follows from More on Morphisms, Lemma
\ref{more-morphisms-lemma-relative-dimension-support-flat}.
Let $x$ be a generic point of an integral closed subscheme
$Z \subset X_\kappa$ of dimension $r$. To finish the proof
we wil show that the coefficient of $[Z]$
in the left (L) and right hand side (R) of equality are the same.

\medskip\noindent
Let $A = \mathcal{O}_{X, x}$ and $M = \mathcal{F}_x$.
Observe that $M$ is a finite $A$-module flat over $R$.
Let $\pi \in R$ be a uniformizer so that
$A/\pi A = \mathcal{O}_{X_\kappa, x}$.
By Chow Homology, Lemma \ref{chow-lemma-additivity-divisors-restricted}
we have
$$
\sum\nolimits_i \text{length}_A(A/(\pi, \mathfrak q_i))
\text{length}_{A_{\mathfrak q_i}}(M_{\mathfrak q_i}) =
\text{length}_A(M/\pi M)
$$
where the sum is over the minimal primes
$\mathfrak q_i$ in the support of $M$.
Since $\pi$ is a nonzerodivisor on $M$ we see
that $\pi \not \in \mathfrak q_i$ and hence
these primes correspond to those generic points $y_i \in X_K$ of the
support of $\mathcal{F}_K$ which specialize to our chosen $x \in X_\kappa$.
Thus the left hand side is the coefficient of $[Z]$
in (L). Of course $\text{length}_A(M/\pi M)$ is the coefficient
of $[Z]$ in (R). This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-specialization-closed}
Let $R$ be a discrete valuation ring with fraction field $K$ and residue field
$\kappa$. Let $X$ be a scheme locally of finite type over $R$. Let $r \geq 0$.
Let $W \subset X$ be a closed subscheme flat over $R$. Assume
$\dim(W_K) \leq r$. Then $\dim(W_\kappa) \leq r$ and
$$
sp_{X/R}([W_K]_r) = [W_\kappa]_r
$$
\end{lemma}

\begin{proof}
Taking $\mathcal{F} = \mathcal{O}_W$ this is a special case of
Lemma \ref{lemma-specialization-module}. See
Chow Homology, Lemma \ref{chow-lemma-cycle-closed-coherent}.
\end{proof}

\begin{lemma}
\label{lemma-specialization-extension}
Let $R'/R$ be an extension of discrete valuation rings inducing fraction field
extension $K'/K$ and residue field extension $\kappa'/\kappa$
(More on Algebra, Definition
\ref{more-algebra-definition-extension-discrete-valuation-rings}).
Let $X$ be locally of finite type over $R$. Denote $X' = X_{R'}$.
Then the diagram
$$
\xymatrix{
Z_r(X'_{K'}) \ar[rr]_{sp_{X'/R'}} & & Z_r(X'_{\kappa'}) \\
Z_r(X_K) \ar[rr]^{sp_{X/R}} \ar[u] & & Z_r(X_\kappa) \ar[u]
}
$$
commutes where $r \geq 0$ and the vertical arrows are base change maps.
\end{lemma}

\begin{proof}
Observe that $X'_{K'} = X_{K'} = X_K \times_{\Spec(K)} \Spec(K')$
and similarly for closed fibres, so that the vertical arrows indeed
make sense (see Section \ref{section-relative-fields}).
Now if $Z \subset X_K$ is an integral closed subscheme with
scheme theoretic image $\overline{Z} \subset X$, then we see that
$Z_{K'} \subset X_{K'}$ is a closed subscheme with scheme theoretic
image $\overline{Z}_{R'} \subset X_{R'}$. The base change of
$[Z]$ is $[Z_{K'}]_r = [\overline{Z}_{K'}]_r$ by definition. We have
$$
sp_{X/R}([Z]) = [\overline{Z}_\kappa]_r
\quad\text{and}\quad
sp_{X'/R'}([\overline{Z}_{K'}]_r) = [(\overline{Z}_{R'})_{\kappa'}]_r
$$
by Lemma \ref{lemma-specialization-module}. Since
$(\overline{Z}_{R'})_{\kappa'} = (\overline{Z}_\kappa)_{\kappa'}$
we conclude.
\end{proof}

\begin{lemma}
\label{lemma-specialization-flat-pullback}
Let $R$ be a discrete valuation ring with fraction field $K$ and residue field
$\kappa$. Let $X$ be a scheme locally of finite type over $R$.
Let $f : X' \to X$ be a morphism which is locally of finite type, flat,
and of relative dimension $e$. Then the diagram
$$
\xymatrix{
Z_{r + e}(X'_K) \ar[rr]_{sp_{X'/R}} & & Z_{r + e}(X'_\kappa) \\
Z_r(X_K) \ar[rr]^{sp_{X/R}} \ar[u] & & Z_r(X_\kappa) \ar[u]
}
$$
commutes where $r \geq 0$ and the vertical arrows are given
by flat pullback.
\end{lemma}

\begin{proof}
Let $Z \subset X$ be an integral closed subscheme dominating $R$.
By the construction of $sp_{X/R}$ we have $sp_{X/R}([Z_K]) = [Z_\kappa]_r$
and this characterizes the specialization map.
Set $Z' = f^{-1}(Z) = X' \times_X Z$.
Since $R$ is a valuation ring, $Z$ is flat over $R$.
Hence $Z'$ is flat over $R$ and
$sp_{X'/R}([Z'_K]_{r + e}) = [Z'_\kappa]_{r + e}$
by Lemma \ref{lemma-specialization-closed}.
Since by Chow Homology, Lemma \ref{chow-lemma-pullback-coherent}
we have $f_K^*[Z_K] = [Z'_K]_{r + e}$ and
$f_\kappa^*[Z_\kappa]_r = [Z'_\kappa]_{r + e}$ we win.
\end{proof}

\begin{lemma}
\label{lemma-specialization-proper-pushforward}
Let $R$ be a discrete valuation ring with fraction field $K$ and residue field
$\kappa$. Let $f : X \to Y$ be a proper morphism of schemes locally of
finite type over $R$. Then the diagram
$$
\xymatrix{
Z_r(X_K) \ar[rr]_{sp_{X/R}} \ar[d] & & Z_r(X_\kappa) \ar[d] \\
Z_r(Y_K) \ar[rr]^{sp_{Y/R}} & & Z_r(Y_\kappa)
}
$$
commutes where $r \geq 0$ and the vertical arrows are given
by proper pushforward.
\end{lemma}

\begin{proof}
Let $Z \subset X$ be an integral closed subscheme dominating $R$.
By the construction of $sp_{X/R}$ we have $sp_{X/R}([Z_K]) = [Z_\kappa]_r$
and this characterizes the specialization map.
Set $Z' = f(Z) \subset Y$. Then $Z'$ is an integral closed subscheme
of $Y$ dominating $R$. Thus $sp_{Y/R}([Z'_K]) = [Z'_\kappa]_r$.

\medskip\noindent
We can think of $[Z]$ as an element of $Z_{r + 1}(X)$. By definition
we have $f_*[Z] = 0$ if $\dim(Z') < r + 1$ and $f_*[Z] = d[Z']$
if $Z \to Z'$ is generically finite of degree $d$.
Since proper pushforward commutes with flat pullback by $Y_K \to Y$
(Chow Homology, Lemma \ref{chow-lemma-flat-pullback-proper-pushforward})
we see that correspondingly $f_{K, *}[Z_K] = 0$ or $f_{K, *}[Z_K] = d[Z'_K]$.
Let us apply Chow Homology, Lemma \ref{chow-lemma-closed-in-X-gysin} to
the commutative diagram
$$
\xymatrix{
X_\kappa \ar[d] \ar[r]_i & X \ar[d] \\
Y_\kappa \ar[r]^j & Y
}
$$
We obtain that $f_{\kappa, *}[Z_\kappa]_r = 0$ or
$f_{\kappa, *}[Z_\kappa] = d[Z'_\kappa]_r$ because
clearly $i^*[Z] = [Z_k]_r$ and $j^*[Z'] = [Z'_\kappa]_r$.
Putting everything together we conclude.
\end{proof}









\section{Families of cycles on fibres}
\label{section-cycles-fibres}

\noindent
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $r \geq 0$ be an integer. A
{\it family $\alpha$ of $r$-cycles on fibres of $X/S$} is a family
$$
\alpha = (\alpha_s)_{s \in S}
$$
indexed by the points $s$ of the scheme $S$ where $\alpha_s \in Z_r(X_s)$
is an $r$ cycle on the scheme theoretic fibre $X_s$ of $f$ at $s$.
There are various constructions we can perform on families of
$r$-cycles on fibres.

\medskip\noindent
{\bf Base change.} Let
$$
\xymatrix{
X' \ar[r] \ar[d] & X \ar[d]^f \\
S' \ar[r]^g & S
}
$$
be a catesian square of morphisms of schemes with $f$ locally of finite type.
Let $r \geq 0$ be an integer. Given a family $\alpha$ of $r$-cycles on
fibres of $X/S$ we define the {\it base change} $g^*\alpha$ of $\alpha$
to be the family
$$
g^*\alpha = (\alpha'_{s'})_{s' \in S'}
$$
where $\alpha'_{s'} \in Z_r(X'_{s'})$ is the base change
of the cycle $\alpha_s$ with $s' = g(s)$ as in
Section \ref{section-relative-fields} via the identitification
$X'_{s'} = X_s \times_{\Spec(\kappa(s))} \Spec(\kappa(s'))$
of scheme theoretic fibres.

\medskip\noindent
{\bf Restriction.} Let $f : X \to S$ be a morphism of schemes which is locally
of finite type. Let $r \geq 0$ be an integer. Let $U \subset X$ and
$V \subset S$ be open subschemes with $f(U) \subset V$. Given a family
$\alpha$ of $r$-cycles on fibres of $X/S$ we can define the
{\it restriction} $\alpha|_U$ of $\alpha$ to be the
family of $r$-cycles on fibres of $U/V$
$$
\alpha|_U = (\alpha_s|_{U_s})_{s \in V}
$$
of restrictions to scheme theoretic fibres.

\medskip\noindent
{\bf Flat pullback.} Let $X \to S$ be a morphism of schemes which is locally
of finite type. Let $r, e \geq 0$ be integers. Let $f : X' \to X$ be a
flat morphism, locally of finite type, and of relative dimension $e$.
Given a family $\alpha$ of $r$-cycles
on fibres of $X/S$ we define the {\it flat pullback} $f^*\alpha$ of $\alpha$
to be the family of $(r + e)$-cycles on fibres
$$
f^*\alpha = (f_s^*\alpha_s)_{s \in S}
$$
where $f_s^*\alpha_s \in Z_{r + e}(X'_s)$ is the flat pullback
of the cycle $\alpha_s$ in $Z_r(X_s)$ by the flat morphism
$f_s : X'_s \to X_s$ of relative dimension $e$
of scheme theoretic fibres.

\medskip\noindent
{\bf Proper pushforward.} Let
$$
\xymatrix{
X \ar[rr]_f \ar[rd] & & Y \ar[ld] \\
& S
}
$$
be a commutative diagram of morphisms of schemes with $X$ and $Y$
locally of finite type over $S$ and $f$ proper. Let $r \geq 0$ be an integer.
Given a family $\alpha$ of $r$-cycles on fibres of $X/S$ we define the
{\it proper pushforward} $f_*\alpha$ of $\alpha$ to be the family of
$r$-cycles on fibres of $Y/S$ by
$$
f_*\alpha = (f_{s, *}\alpha_s)_{s \in S}
$$
where $f_{s, *}\alpha_s \in Z_r(Y_s)$ is the proper pushforward
of the cycle $\alpha_s$ in $Z_r(X_s)$ by the proper morphism
$f_s : X_s \to Y_s$ of scheme theoretic fibres.

\begin{lemma}
\label{lemma-compatibilities}
We have the following compatibilities between the operations above:
(1) base change is functorial,
(2) restriction is a combination of base change and (a special case of)
flat pullback,
(3) flat pullback commutes with base change,
(4) flat pullback is functorial,
(5) proper pushforward commutes with base change,
(6) proper pushforward is functorial, and
(7) proper pushforward commutes with flat pullback.
\end{lemma}

\begin{proof}
Each of these compatibilities follows directly from the corresponding
results proved in the chapter on Chow homology applied to the fibres
over $S$ of the schemes in question. We omit the precise statements and
the detailed proofs. Here are some references.
Part (1): Chow Homology, Lemma
\ref{chow-lemma-compose-base-change}.
Part (2): Obvious.
Part (3): Chow Homology, Lemma
\ref{chow-lemma-pullback-base-change-pullback}.
Part (4): Chow Homology, Lemma
\ref{chow-lemma-compose-flat-pullback}.
Part (5): Chow Homology, Lemma
\ref{chow-lemma-pullback-base-change-pushforward}.
Part (6): Chow Homology, Lemma
\ref{chow-lemma-compose-pushforward}.
Part (7): Chow Homology, Lemma
\ref{chow-lemma-flat-pullback-proper-pushforward}.
\end{proof}

\begin{example}
\label{example-family-associated-module}
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $r \geq 0$ be an integer. Let $\mathcal{F}$ be a quasi-coherent
$\mathcal{O}_X$-module of finite type. For $s \in S$ denote $\mathcal{F}_s$
the pullback of $\mathcal{F}$ to $X_s$.
Assume $\dim(\text{Supp}(\mathcal{F}_s)) \leq r$ for all $s \in S$.
Then we can associate to $\mathcal{F}$ the family $[\mathcal{F}/X/S]_r$ of
$r$-cycles on fibres of $X/S$ defined by the formula
$$
[\mathcal{F}/X/S]_r = ([\mathcal{F}_s]_r)_{s \in S}
$$
where $[\mathcal{F}_s]_r$ is given by Chow Homology, Definition
\ref{chow-definition-cycle-associated-to-coherent-sheaf}.
\end{example}

\begin{lemma}
\label{lemma-family-associated-module}
The construction in Example \ref{example-family-associated-module}
is compatible with base change, restriction, and flat pullback.
\end{lemma}

\begin{proof}
See Chow Homology, Lemmas
\ref{chow-lemma-pullback-coherent-base-change} and
\ref{chow-lemma-pullback-coherent}.
\end{proof}

\begin{example}
\label{example-family-associated-closed}
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $r \geq 0$ be an integer. Let $Z \subset X$ be a closed subscheme.
For $s \in S$ denote $Z_s$ the inverse image of $Z$ in $X_s$
or equivalently the scheme theoretic fibre of $Z$ at $s$ viewed
as a closed subscheme of $X_s$.
Assume $\dim(Z_s) \leq r$ for all $s \in S$.
Then we can associate to $Z$ the family $[Z/X/S]_r$
of $r$-cycles on fibres of $X/S$ defined by the formula
$$
[Z/X/S]_r = ([Z_s]_r)_{s \in S}
$$
where $[Z_s]_r$ is given by
Chow Homology, Definition
\ref{chow-definition-cycle-associated-to-closed-subscheme}.
\end{example}

\begin{lemma}
\label{lemma-family-associated-closed}
The construction in Example \ref{example-family-associated-closed}
is compatible with base change, restriction, and flat pullback.
\end{lemma}

\begin{proof}
Taking $\mathcal{F} = (Z \to X)_*\mathcal{O}_Z$ this is a special case of
Lemma \ref{lemma-family-associated-module}. See
Chow Homology, Lemma \ref{chow-lemma-cycle-closed-coherent}.
\end{proof}

\begin{remark}[Support]
\label{remark-supports-family}
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $r \geq 0$ be an integer. Let $\alpha$ be a family of $r$-cycles
on fibres of $X/S$. We define the {\it support} of $\alpha$ to be
$$
\text{Supp}(\alpha) =
\bigcup\nolimits_{s \in S} \text{Supp}(\alpha_s) \subset X
$$
Here $\text{Supp}(\alpha_s) \subset X_s$ is the
support of the cycle $\alpha_s$, see
Chow Homology, Definition \ref{chow-definition-support-cycle}.
The support $\text{Supp}(\alpha)$ is rarely a closed subset of $X$.
\end{remark}

\begin{lemma}
\label{lemma-support-family}
Taking the support as in Remark \ref{remark-supports-family}
is compatible with base change, restriction, and flat pullback.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-coequalizer-dim-r}
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $r \geq 0$ be an integer. Let $g : S' \to S$ be a surjective morphism of
schemes. Set $S'' = S' \times_S S'$ and let $f' : X' \to S'$
and $f'' : X'' \to S''$ be the base changes of $f$.
Let $x \in X$ with $\text{trdeg}_{\kappa(f(x))}(\kappa(x)) = r$.
\begin{enumerate}
\item There exists an $x' \in X'$ mapping to $x$
with $\text{trdeg}_{\kappa(f'(x'))}(\kappa(x')) = r$.
\item If $x'_1, x'_2 \in X'$ are both as in (1), then there
exists an $x'' \in X''$ with
$\text{trdeg}_{\kappa(f''(x''))}(\kappa(x'')) = r$ and
$\text{pr}_i(x'') = x'_i$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) is
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-after-base-change}.
Let $x'_1, x'_2$ be as in (2). Then since $X'' = X' \times_X X'$
we see that there
exists a $x'' \in X''$ mapping to both $x'_1$ and $x'_2$ (see for
example Descent, Lemma \ref{descent-lemma-equiv-fibre-product}).
Denote $s'' \in S''$, $s'_i \in S'$, and $s \in S$ the images
of $x''$, $x'_i$, and $x$.
Denote $k = \kappa(s)$ and let $Z \subset X_k$ be the integral
closed subscheme whose generic point is $x$. Then $x'_i$
is a generic point of an irreducible component of $Z_{\kappa(s'_i)}$.
Let $Z'' \subset Z_{\kappa(s'')}$ be an irreducible component
containing $x''$. Denote $\xi'' \in Z''$ the generic point.
Since $\xi'' \leadsto x''$ we see that $\xi''$ must also
map to $x'_i$ under the two projections. On the other hand,
we see that $\text{trdeg}_{\kappa(s'')}(\kappa(\xi'')) = r$
because it is a generic
point of an irreducible component of the base change of $Z$.
\end{proof}

\begin{lemma}
\label{lemma-descend-family}
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $r \geq 0$ be an integer. Let $g : S' \to S$ be a morphism of
schemes and $X' = S' \times_S X$. Assume that for every $s \in S$ there
exists a point $s' \in S'$ with $g(s') = s$ and such that
$\kappa(s')/\kappa(s)$ is a separable extension of fields. Then
\begin{enumerate}
\item For families $\alpha_1$ and $\alpha_2$ of $r$-cycles on fibres of $X/S$
if $g^*\alpha_1 = g^*\alpha_2$, then $\alpha_1 = \alpha_2$.
\item Given a family $\alpha'$ of $r$-cycles on fibres of $X'/S'$ if
$\text{pr}_1^*\alpha' = \text{pr}_2^*\alpha'$ as families of
$r$-cycles on fibres of $(S' \times_S S') \times_S X / (S' \times_S S')$,
then there is a unique family $\alpha$ of $r$-cycles on fibres of $X/S$
such that $g^*\alpha = \alpha'$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) follows from the injectivity of the base change map discussed
in Section \ref{section-relative-fields}. (This argument works as
long as $S' \to S$ is surjective.)

\medskip\noindent
Let $\alpha'$ be as in (2). Denote
$\alpha'' = \text{pr}_1^*\alpha' = \text{pr}_2^*\alpha'$
the common value.

\medskip\noindent
Let $(X/S)^{(r)}$ be the set of $x \in X$ with
$\text{trdeg}_{\kappa(f(x))}(\kappa(x)) = r$
and similarly define $(X'/S')^{(r)}$ and $(X''/S'')^{(r)}$
Taking coefficients, we may think of $\alpha'$ and $\alpha''$ as functions
$\alpha' : (X'/S')^{(r)} \to \mathbf{Z}$ and
$\alpha'' : (X''/S'')^{(r)} \to \mathbf{Z}$.
Given a function
$$
\varphi : (X/S)^{(r)} \to \mathbf{Z}
$$
we define $g^*\varphi : (X'/S')^{(r)} \to \mathbf{Z}$ by analogy
with our base change operation. Namely, say $x' \in (X'/S')^{(r)}$
maps to $x \in X$, $s' \in S'$, and $s \in Z$.
Denote $Z' \subset X'_{s'}$ and $Z \subset X_s$ the integral
closed subschemes with generic points $x'$ and $x$. Note
that $\dim(Z') = r$. If $\dim(Z) < r$, then we set $(g^*\varphi)(x') = 0$.
If $\dim(Z) = r$, then $Z'$ is an irreducible component of $Z_{s'}$ and
hence has a multiplicity $m_{Z', Z_{s'}}$. Call this $m(x', g)$.
Then we define
$$
(g^*\varphi)(x') = m(x', g) \varphi(x)
$$
Note that the coefficients $m(x', g)$ are always positive integers
(see for example Lemma \ref{lemma-multiplicities-field-extension}).
We similarly have base change maps
$$
\text{pr}_1^*, \text{pr}_2^* :
\text{Map}((X'/S')^{(r)}, \mathbf{Z})
\longrightarrow
\text{Map}((X''/S'')^{(r)}, \mathbf{Z})
$$
It follows from the associativity of base change that we have
$\text{pr}_1^* \circ g^* = \text{pr}_2^* \circ g^*$ (small detail
omitted). To be explicity, in terms of the maps of sets this
equality just means that for $x'' \in (X''/S'')^{(r)}$ we have
$$
m(x'', \text{pr}_1) m(\text{pr}_1(x''), g) =
m(x'', \text{pr}_2) m(\text{pr}_2(x''), g)
$$
provided that $\text{pr}_1(x'')$ and $\text{pr}_2(x'')$ are
in $(X''/S'')^{(r)}$.
By Lemma \ref{lemma-coequalizer-dim-r} and an elementary
argument\footnote{Given $x \in (X/S)^{(r)}$ pick $x' \in (X'/S')^{(r)}$
mapping to $x$ and set $\alpha(x) = \alpha'(x')/m(x', g)$. This
is well defined by the formula and the lemma.}
using the previous displayed equation,
it follows that there exists a unique map
$$
\alpha : (X/S)^{(r)} \to \mathbf{Q}
$$
such that $g^*\alpha = \alpha'$. To finish the proof it suffices
to show that $\alpha$ has integer values (small detail omitted: one
needs to see that $\alpha$ determines a locally finite sum on
each fibre which follows from the corresponding fact for $\alpha'$).
Given any $x \in (X/S)^{(r)}$ with image $s \in S$
we can pick a point $s' \in S'$ such that $\kappa(s')/\kappa(s)$
is separable. Then we may choose $x' \in (X'/S')^{(r)}$ mapping
to $s$ and $x$ and we see that $m(x', g) = 1$ because
$Z_{s'}$ is reduced in this case. Whence $\alpha(x) = \alpha'(x')$
is an integer.
\end{proof}

\begin{lemma}
\label{lemma-pullback-universally-bijective}
Let $g : S' \to S$ be a bijective morphism of schemes
which induces isomorphisms of residue fields.
Let $f : X \to S$ be locally of finite type. Set $X' = S' \times_S X$.
Let $r \geq 0$. Then base change by $g$ determines a bijection
between the group of families of $r$-cycles on fibres of $X/S$ and
the group of families of $r$-cycles on fibres of $X'/S'$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}








\section{Relative cycles}
\label{section-families-specialization}

\noindent
Here is the definition we will work with; see Section \ref{section-compare}
for a comparison with the definitions in \cite{SV}.

\begin{definition}
\label{definition-relative-cycles}
Let $S$ be a locally Noetherian scheme. Let $f : X \to S$ be a morphism of
schemes which is locally of finite type. Let $r \geq 0$ be an integer.
A {\it relative $r$-cycle on $X/S$} is a family $\alpha$ of $r$-cycles
on fibres of $X/S$ such that for every morphism $g : S' \to S$
where $S'$ is the spectrum of a discrete valuation ring we have
$$
sp_{X'/S'}(\alpha_\eta) = \alpha_0
$$
where $sp_{X'/S'}$ is as in Section \ref{section-specialization}
and $\alpha_\eta$ (resp.\ $\alpha_0$) is the value of the base change
$g^*\alpha$ of $\alpha$ at the generic (resp.\ closed) point of $S'$.
The group of all relative $r$-cycles on $X/S$ is denoted $z(X/S, r)$.
\end{definition}

\begin{lemma}
\label{lemma-relative-cycle-functoriality}
Let $\alpha$ be a relative $r$-cycle on $X/S$ as in
Definition \ref{definition-relative-cycles}.
Then any restriction, base change, flat pullback, or proper pushforward
of $\alpha$ is a relative $r$-cycle.
\end{lemma}

\begin{proof}
For flat pullback use Lemma \ref{lemma-specialization-flat-pullback}.
Restriction is a special case of flat pullback. To see it holds for
base change use that base change is transitive.
For proper pushforward use Lemma \ref{lemma-specialization-proper-pushforward}.
\end{proof}

\begin{lemma}
\label{lemma-relative-cycles-h-descent}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r \geq 0$ be an integer. Let $\alpha$
be a family of $r$-cycles on fibres of $X/S$. Let $\{g_i : S_i \to S\}$
be a h covering (More on Flatness, Definition
\ref{flat-definition-h-covering}). Then $\alpha$ is a relative $r$-cycle
if and only if each base change $g_i^*\alpha$ is a relative $r$-cycle.
\end{lemma}

\begin{proof}
If $\alpha$ is a relative $r$-cycle, then each base change $g_i^*\alpha$ is a
relative $r$-cycle by Lemma \ref{lemma-relative-cycle-functoriality}.
Assume each $g_i^*\alpha$ is a relative $r$-cycle.
Let $g : S' \to S$ be a morphism where $S'$ is the spectrum of a discrete
valuation ring. After replacing $S$ by $S'$, $X$ by $X' = X \times_S S'$, and
$\alpha$ by $\alpha' = g^*\alpha$ and using that the base change of a
h covering is a h covering (More on Flatness, Lemma \ref{flat-lemma-h})
we reduce to the problem studied in the next paragraph.

\medskip\noindent
Assume $S$ is the spectrum of a discrete valuation ring with closed
point $0$ and generic point $\eta$. We have to show that
$sp_{X/S}(\alpha_\eta) = \alpha_0$. Since a h covering is a V covering
(by definition), there is an $i$ and a specialization $s' \leadsto s$
of points of $S_i$ with $g_i(s') = \eta$ and $g_i(s) = 0$, see
Topologies, Lemma \ref{topologies-lemma-refine-qcqs-V}. By
Properties, Lemma \ref{properties-lemma-locally-Noetherian-specialization-dvr}
we can find a morphism $h : S' \to S_i$ from the
spectrum $S'$ of a discrete valuation ring which maps
the generic point $\eta'$ to $s'$ and maps
the closed point $0'$ to $s$. Denote $\alpha' = h^*g_i^*\alpha$.
By assumption we have $sp_{X'/S'}(\alpha'_{\eta'}) = \alpha'_{0'}$.
Since $g = g_i \circ h : S' \to S$ is the morphism of schemes
induced by an extension of discrete valuation rings we conclude that
$sp_{X/S}$ and $sp_{X'/S'}$ are compatible with base change maps
on the fibres, see Lemma \ref{lemma-specialization-extension}.
We conclude that $sp_{X/S}(\alpha_\eta) = \alpha_0$ because
the base change map $Z_r(X_0) \to Z_r(X'_{0'})$ is injective
as discussed in Section \ref{section-relative-fields}.
\end{proof}

\begin{lemma}
\label{lemma-families-specialization-fppf-descent}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r, e \geq 0$ be integers.
Let $\alpha$ be a family of $r$-cycles on fibres of $X/S$.
Let $\{f_i : X_i \to X\}$ be a jointly surjective family
of flat morphisms, locally of finite type, and of relative dimension $e$.
Then $\alpha$ is a relative $r$-cycle if and only if each flat
pullback $f_i^*\alpha$ is a relative $r$-cycle.
\end{lemma}

\begin{proof}
If $\alpha$ is a relative $r$-cycle, then each pull back $f_i^*\alpha$ is a
relative $r$-cycle by Lemma \ref{lemma-relative-cycle-functoriality}.
Assume each $f_i^*\alpha$ is a relative $r$-cycle.
Let $g : S' \to S$ be a morphism where $S'$ is the spectrum of a discrete
valuation ring. After replacing $S$ by $S'$, $X$ by $X' = X \times_S S'$, and
$\alpha$ by $\alpha' = g^*\alpha$
we reduce to the problem studied in the next paragraph.

\medskip\noindent
Assume $S$ is the spectrum of a discrete valuation ring with closed
point $0$ and generic point $\eta$. We have to show that
$sp_{X/S}(\alpha_\eta) = \alpha_0$. Denote $f_{i, 0} : X_{i, 0} \to X_0$
the base change of $f_i$ to the closed point of $S$. Similarly
for $f_{i, \eta}$.
Observe that
$$
f_{i, 0}^*sp_{X/S}(\alpha_\eta) =
sp_{X_i/S}(f_{i, \eta}^*\alpha_\eta) = f_{i, 0}^*\alpha_0
$$
Namely, the first equality holds by
Lemma \ref{lemma-specialization-flat-pullback}
and the second by assumption. Since the family of maps
$f_{i, 0}^* : Z_r(X_0) \to Z_r(X_{i, 0})$ is jointly
injective (due to the fact that $f_{i, 0}$ is jointly
surjective), we conclude what we want.
\end{proof}

\begin{lemma}
\label{lemma-check-after-closed}
Let $S$ be a locally Noetherian scheme. Let $i : X \to Y$ be a closed immersion
of schemes locally of finite type over $S$. Let $r \geq 0$.
Let $\alpha$ be a family of $r$-cycles on fibres of $X/S$.
Then $\alpha$ is a relative $r$-cycle on $X/S$ if and only if
$i_*\alpha$ is a relative $r$-cycle on $Y/S$.
\end{lemma}

\begin{proof}
Since base change commutes with $i_*$ (Lemma \ref{lemma-compatibilities})
it suffices to prove the following: if $S$ is the spectrum of a discrete
valuation ring with generic point $\eta$ and closed point $0$,
then $sp_{X/S}(\alpha_\eta) = \alpha_0$ if and only if
$sp_{Y/S}(i_{\eta, *}\alpha_\eta) = i_{0, *}\alpha_0$.
This is true because $i_{0, *} : Z_r(X_0) \to Z_r(Y_0)$
is injective and because $i_{0, *}sp_{X/S}(\alpha_\eta) =
sp_{Y/S}(i_{\eta, *}\alpha_\eta)$ by
Lemma \ref{lemma-specialization-proper-pushforward}.
\end{proof}

\noindent
The following lemma will be strengthened in
Lemma \ref{lemma-relative-cycles-equal}.

\begin{lemma}
\label{lemma-uniqueness-extension}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ is locally Noetherian
and $f$ locally of finite type. Let $r \geq 0$. Let $\alpha$ and $\beta$
be relative $r$-cycles on $X/S$. The following are equivalent
\begin{enumerate}
\item $\alpha = \beta$, and
\item $\alpha_\eta = \beta_\eta$ for any generic point $\eta \in S$
of an irreducible component of $S$.
\end{enumerate}
\end{lemma}

\begin{proof}
The implication (1) $\Rightarrow$ (2) is immediate.
Assume (2). For every $s \in S$ we can find an $\eta$ as in (2)
which specializes to $s$. By
Properties, Lemma \ref{properties-lemma-locally-Noetherian-specialization-dvr}
we can find a morphism $g : S' \to S$ from the
spectrum $S'$ of a discrete valuation ring which maps
the generic point $\eta'$ to $\eta$ and maps
the closed point $0$ to $s$. Then $\alpha_s$ and $\beta_s$
are elements of $Z_r(X_s)$ which base change to the same
element of $Z_r(X_{0'})$, namely $sp_{X_{S'}/S'}(\alpha_{\eta'})$
where $\alpha_{\eta'}$ is the base change of $\alpha_\eta$.
Since the base change map $Z_r(X_s) \to Z_r(X_{0'})$ is injective
as discussed in Section \ref{section-relative-fields}
we conclude $\alpha_s = \beta_s$.
\end{proof}

\begin{lemma}
\label{lemma-family-associated-module-specialization}
In the situation of Example \ref{example-family-associated-module}
assume $S$ is locally Noetherian and
$\mathcal{F}$ is flat over $S$ in dimensions $\geq r$
(More on Flatness, Definition \ref{flat-definition-flat-dimension-n}).
Then $[\mathcal{F}/X/S]_r$ is a relative $r$-cycle on $X/S$.
\end{lemma}

\begin{proof}
By More on Flatness, Lemma \ref{flat-lemma-pre-flat-dimension-n}
the hypothesis on $\mathcal{F}$ is preserved by any base change.
Also, formation of $[\mathcal{F}/X/S]_r$ is compatible with any
base change by Lemma \ref{lemma-family-associated-module}.
Since the condition of being compatible with specializations
is checked after base change to the spectrum of a discrete valuation ring,
this reduces us to the case where $S$ is the spectrum of a valuation ring.
In this case the set
$U = \{x \in X \mid \mathcal{F}\text{ flat at }x\text{ over }S\}$
is open in $X$ by
More on Flatness, Lemma \ref{flat-lemma-finite-type-flat}.
Since the complement of $U$ in $X$ has fibres of dimension $< r$ over
$S$ by assumption, we see that restriction along the inclusion
$U \subset X$ induces an isomorphism on the groups of $r$-cycles
on fibres after any base change, compatible with specialization maps
and with formation of the relative cycle associated to $\mathcal{F}$.
Thus it suffices to show compability with
specializations for $[\mathcal{F}|_U / U /S]_r$.
Since $\mathcal{F}|_U$ is flat over $S$, this follows from
Lemma \ref{lemma-specialization-module} and the definitions.
\end{proof}

\begin{lemma}
\label{lemma-family-associated-closed-specialization}
In the situation of Example \ref{example-family-associated-closed}
assume $S$ is locally Noetherian and $Z$ is flat over $S$ in dimensions
$\geq r$. Then $[Z/X/S]_r$ is a relative $r$-cycle on $X/S$.
\end{lemma}

\begin{proof}
The assumption means that $\mathcal{O}_Z$ is flat over $S$ in
dimensions $\geq r$. Thus applying
Lemma \ref{lemma-family-associated-module-specialization}
with $\mathcal{F} = (Z \to X)_*\mathcal{O}_Z$ we conclude.
\end{proof}

\noindent
Let $S$ be a locally Noetherian scheme. Let $f : X \to S$ be a morphism
which is of finite type. Let $r \geq 0$. Denote $Hilb(X/S, r)$
the set of closed subschemes $Z \subset X$ such that $Z \to S$ is flat
and of relative dimension $\leq r$. By
Lemma \ref{lemma-family-associated-closed-specialization} for each
$Z \in Hilb(X/S, r)$ we have an element $[Z/X/S]_r \in z(X/S, r)$.
Thus we obtain a group homomorphism
\begin{equation}
\label{equation-cycle-classes}
\text{free abelian group on }Hilb(X/S, r) \longrightarrow z(X/S, r)
\end{equation}
sending $\sum n_i[Z_i]$ to $\sum n_i[Z_i/X/S]_r$.
A key feature of relative $r$-cycles is that they are locally
(on $X$ and $S$ in suitable topologies) in the image of this map.

\begin{lemma}
\label{lemma-get-cycles}
Let $f : X \to S$ be a finite type morphism of schemes with $S$ Noetherian.
Let $r \geq 0$. Let $\alpha$ be a relative $r$-cycle on $X/S$. Then there is
a proper, completely decomposed
(More on Morphisms, Definition \ref{more-morphisms-definition-cd-morphism})
morphism $g : S' \to S$ such that $g^*\alpha$ is in the image of
(\ref{equation-cycle-classes}).
\end{lemma}

\begin{proof}
By Noetherian induction, we may assume the result holds for the pullback of
$\alpha$ by any closed immersion $g : S' \to S$ which is not an isomorphism.

\medskip\noindent
Let $S_1 \subset S$ be an irreducible component (viewed as an integral closed
subscheme). Let $S_2 \subset S$ be the closure of the complement of $S'$
(viewed as a reduced closed subscheme). If $S_2 \not = \emptyset$, then
the result holds for the pullback of $\alpha$ by $S_1 \to S$ and $S_2 \to S$.
If $g_1 : S'_1 \to S_1$ and $g_2 : S'_2 \to S_2$
are the corresponding completely decomposed proper morphisms,
then $S' = S'_1 \amalg S'_2 \to S$
is a completely decomposed proper morphism and
we see the result holds for $S$\footnote{Namely, any closed
subscheme of $S'_1 \times_S X$ flat and of relative dimension
$\leq r$ over $S'_1$ may be viewed as a closed subscheme of $S' \times_S X$
flat and of relative dimension $\leq r$ over $S'$.}
. Thus we may assume $S' \to S$ is bijective
and we reduce to the case described in the next paragraph.

\medskip\noindent
Assume $S$ is integral. Let $\eta \in S$ be the generic point
and let $K = \kappa(\eta)$ be the function field of $S$.
Then $\alpha_\eta$ is an $r$-cycle on $X_K$.
Write $\alpha_\eta = \sum n_i[Y_i]$.
Taking the closure of $Y_i$ we obtain integral closed subschemes
$Z_i \subset X$ whose base change to $\eta$ is $Y_i$.
By generic flatness (for example Morphisms,
Proposition \ref{morphisms-proposition-generic-flatness}),
we see that $Z_i$ is flat over a nonempty open $U$ of $S$ for each $i$.
Applying More on Flatness, Lemma \ref{flat-lemma-flat-after-blowing-up}
we can find a $U$-admissible blowing up $g : S' \to S$
such that the strict transform $Z'_i \subset X_{S'}$
of $Z_i$ is flat over $S'$. Then $\beta = \sum n_i[Z'_i/X_{S'}/S']_r$
is in the image of (\ref{equation-cycle-classes}) and $\beta = g^*\alpha$
by Lemma \ref{lemma-uniqueness-extension}.

\medskip\noindent
However, this does not finish the proof as $S' \to S$ may not be
completely decomposed. This is easily fixed: denoting $T \subset S$
the complement of $U$ (viewed as a closed subscheme), by Noetherian
induction we can find a completely decomposed proper morphism
$T' \to T$ such that $(T' \to S)^*\alpha$
is in the image of (\ref{equation-cycle-classes}). Then
$S' \amalg T' \to S$ does the job.
\end{proof}

\begin{lemma}
\label{lemma-get-cycles-dvr}
Let $f : X \to S$ be a finite type morphism of schemes with $S$
the spectrum of a discrete valuation ring. Let $r \geq 0$.
Then (\ref{equation-cycle-classes}) is surjective.
\end{lemma}

\begin{proof}
This of course follows from Lemma \ref{lemma-get-cycles} but we can
also see it directly as follows. Say $\alpha$ is a relative $r$-cycle
on $X/S$. Write $\alpha_\eta = \sum n_i[Z_i]$ (the sum is finite). Denote
$\overline{Z}_i \subset X$ the closure of $Z_i$ as in
Section \ref{section-specialization}. Then
$\alpha = \sum n_i[\overline{Z}_i/X/S]$.
\end{proof}

\begin{lemma}
\label{lemma-relative-cycle-smooth}
Let $f : X \to S$ be a morphism of schemes. Let $r \geq 0$. Assume $S$
locally Noetherian and $f$ smooth of relative dimension $r$. Let
$\alpha \in z(X/S, r)$. Then the support of $\alpha$ is open and closed in $X$
(see proof for a more precise result).
\end{lemma}

\begin{proof}
Let $x \in X$ with image $s \in S$. Since $f$ is smooth, there is a
unique irreducible component $Z(x)$ of $X_s$ which contains $x$.
Then $\dim(Z(x)) = r$.
Let $n_x$ be the coefficient of $Z(x)$ in the cycle $\alpha_s$.
We will show the function $x \mapsto n_x$ is locally constant on $X$.

\medskip\noindent
Let $g : S' \to S$ be a morphism of locally Noetherian schemes.
Let $X'$ be the base change of $X$ and let $\alpha' = g^*\alpha$
be the base change of $\alpha$. Let $x' \in X'$ map to $s' \in S'$,
$x \in X$, and $s \in S$. We claim $n_{x'} = n_x$. Namely, since $Z(x)$
is smooth over $\kappa(s)$ we see that
$Z(x) \times_{\Spec(\kappa(s))} \Spec(\kappa(s'))$
is reduced. Since $Z(x')$ is an irreducible component
of this scheme, we see that the coefficient $n_{x'}$ of $Z(x')$
in $\alpha'_{s'}$ is the same as the coefficient $n_x$ of $Z(x)$
in $\alpha_s$ by the definition of base change in
Section \ref{section-relative-fields}
thereby proving the claim.

\medskip\noindent
Since $X$ is locally Noetherian, to show that $x \mapsto n_x$
is locally constant, it suffices to show: if $x' \leadsto x$
is a specialization in $X$, then $n_{x'} = n_x$.
Choose a morphism $S' \to X$ where $S'$ is the spectrum of a discrete
valuation ring mapping the generic point $\eta$ to $x'$ and the closed point
$0$ to $x$. See Properties, Lemma
\ref{properties-lemma-locally-Noetherian-specialization-dvr}.
Then the base change $X' \to S'$ of $f$ by $S' \to S$
has a section $\sigma : S' \to X'$ such that $\sigma(\eta) \leadsto \sigma(0)$
is a specialization of points of $X'$ mapping to $x' \leadsto x$ in $X$.
Thus we reduce to the claim in the next paragraph.

\medskip\noindent
Let $S$ be the spectrum of a discrete valuation ring with
generic point $\eta$ and closed point $0$ and we have a section
$\sigma : S  \to X$. Claim: $n_{\sigma(\eta)} = n_{\sigma(0)}$.
By the discussion in More on Morphisms, Section
\ref{more-morphisms-section-connected-components} and especially
More on Morphisms, Lemma \ref{more-morphisms-lemma-connected-along-section-open}
after replacing $X$ by an open subscheme, we may assume the
fibres of $X \to S$ are connected. Since these fibres
are smooth, they are irreducible. Then we see that $\alpha_\eta = n[X_\eta]$
with $n = n_{\sigma(\eta)}$ and the relation $sp_{X/S}(\alpha_\eta) = \alpha_0$
implies $\alpha_0 = n[X_0]$, i.e., $n_{\sigma(0)} = n$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-relative-cycles-equal}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r \geq 0$ and
$\alpha, \beta \in z(X/S, r)$. The set $E = \{s \in S : \alpha_s = \beta_s\}$
is closed in $S$.
\end{lemma}

\begin{proof}
The question is local on $S$, thus we may assume $S$ is affine.
Let $X = \bigcup U_i$ be an affine open covering. Let
$E_i = \{s \in S : \alpha_s|_{U_{i, s}} = \beta_s|_{U_{i, s}}\}$.
Then $E = \bigcap E_i$. Hence it suffices to prove the lemma for
$U_i \to S$ and the restriction of $\alpha$ and $\beta$ to $U_i$.
This reduces us to the case discussed in the next paragraph.

\medskip\noindent
Assume $X$ and $S$ are quasi-compact.
Set $\gamma = \alpha - \beta$. Then $E = \{s \in S : \gamma_s = 0\}$.
By Lemma \ref{lemma-family-associated-closed-specialization}
there exists a jointly surjective finite family of proper morphisms
$\{g_i : S_i \to S\}$ such that $g_i^*\gamma$ is in the image
of (\ref{equation-cycle-classes}). Observe that $E_i = g_i^{-1}(E)$ is
the set of point $t \in S_i$ such that $(g_i^*\gamma)_t = 0$.
If $E_i$ is closed for all $i$, then $E = \bigcup g_i(E_i)$
is closed as well. This reduces us to the case discussed in the next
paragraph.

\medskip\noindent
Assume $X$ and $S$ are quasi-compact and $\gamma = \sum n_i[Z_i/X/S]_r$
for a finite number of closed subschemes $Z_i \subset X$
flat and of relative dimension $\leq r$ over $S$.
Set $X' = \bigcup Z_i$ (scheme theoretic union).
Then $i : X' \to X$ is a closed immersion and $X'$
has relative dimension $\leq r$ over $S$. Also
$\gamma = i_*\gamma'$ where $\gamma' = \sum n_i[Z_i/X'/S]_r$.
Since clearly $E = E' = \{s \in S : \gamma'_s = 0\}$
we reduce to the case discussed in the next paragraph.

\medskip\noindent
Assume $X$ has relative dimension $\leq r$ over $S$.
Let $s \in S$, $s \not \in E$. We will show that there exists an
open neighbourhood $V \subset S$ of $s$ such that $E \cap V$ is empty.
The assumption $s \not \in E$ means there exists an integral closed
subscheme $Z \subset X_s$ of dimension $r$ such that the coefficient
$n$ of $[Z]$ in $\gamma_s$ is nonzero. Let $x \in Z$ be the
generic point. Since $\dim(Z) = r$ we see that $x$ is a generic
point of an irreducible component (namely $Z$) of $X_s$.
Thus after replacing $X$ by an open neighbourhood of $x$,
we may assume that $Z$ is the only irreducible component of $X_s$.
In particular, we have $\gamma_s = n[Z]$.

\medskip\noindent
At this point we apply More on Morphisms, Lemma
\ref{more-morphisms-lemma-local-structure-finite-type}
and we obtain a diagram
$$
\xymatrix{
X \ar[dd] & X' \ar[l]^g \ar[d]^\pi & x \ar@{|->}[dd] &
x' \ar@{|->}[l]  \ar@{|->}[d] \\
& Y \ar[d]^h & & y \ar@{|->}[d] \\
S \ar@{=}[r] & S & s & s \ar@{=}[l]
}
$$
with all the properties listed there. Let $\gamma' = g^*\gamma$
be the flat pullback. Note that $E \subset E' = \{s \in S: \gamma'_s = 0\}$
and that $s \not \in E'$ because the coefficient of $Z'$ in $\gamma'_s$
is nonzero, where $Z' \subset X'_s$ is the closure of $x'$.
Similarly, set $\gamma'' = \pi_*\gamma'$. Then we have
$E' \subset E'' = \{s \in S: \gamma''_s = 0\}$ and $s \not \in E''$
because the coefficient of $Z''$ in $\gamma''_s$ is nonzero, where
$Z'' \subset Y_s$ is the closure of $y$. By
Lemma \ref{lemma-relative-cycle-smooth} and openess of $Y \to S$
we see that an open neighbourhood of $s$ is disjoint from $E''$
and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-descend-through-limit}
Let $S = \lim_{i \in I} S_i$ be the limit of a directed inverse system of
Noetherian schemes with affine transition morphisms.
Let $0 \in I$ and let $X_0 \to S_0$ be a finite type morphism of schemes.
For $i \geq 0$ set $X_i = S_i \times_{S_0} X_0$ and set
$X = S \times_{S_0} X_0$. If $S$ is Noetherian too, then
$$
z(X/S, r) = \colim_{i \geq 0} z(X_i/S_i, r)
$$
where the transition maps are given by base change of relative
$r$-cycles.
\end{lemma}

\begin{proof}
Suppose that $i \geq 0$ and $\alpha_i, \beta_i \in z(X_i/S_i, r)$
map to the same element of $z(X/S, r)$. Then $S \to S_i$
maps into the closed subset $E \subset S_i$ of
Lemma \ref{lemma-relative-cycles-equal}.
Hence for some $j \geq i$ the morphism $S_j \to S_i$
maps into $E$, see Limits, Lemma
\ref{limits-lemma-limit-contained-in-constructible}.
It follows that the base change of
$\alpha_i$ and $\beta_i$ to $S_j$ agree. Thus the map is injective.

\medskip\noindent
Let $\alpha \in z(X/S, r)$. Applying Lemma \ref{lemma-get-cycles}
a completely decomposed proper morphism $g : S' \to S$ such that $g^*\alpha$
is in the image of (\ref{equation-cycle-classes}).
Set $X' = S' \times_S X$. We write $g^*\alpha = \sum n_a [Z_a/X'/S']_r$
for some $Z_a \subset X'$ closed subscheme
flat and of relative dimension $\leq r$ over $S'$.

\medskip\noindent
Now we bring the machinery of
Limits, Section \ref{limits-section-descending-relative} ff to bear.
We can find an $i \geq 0$ such that there exist
\begin{enumerate}
\item a completely decomposed proper morphism $g_i : S'_i \to S_i$
whose base change to $S$ is $g : S' \to S$,
\item setting $X'_i = S'_i \times_{S_i} X_i$
closed subschemes $Z_{ai} \subset X'_i$ flat and of
relative dimension $\leq r$ over $S'_i$ whose base change to $S'$
is $Z_a$.
\end{enumerate}
To do this one uses Limits, Lemmas
\ref{limits-lemma-descend-finite-presentation},
\ref{limits-lemma-descend-closed-immersion-finite-presentation},
\ref{limits-lemma-descend-flat-finite-presentation},
\ref{limits-lemma-eventually-proper}, and
\ref{limits-lemma-limit-dimension}
and More on Morphisms, Lemma
\ref{more-morphisms-lemma-descend-cd}.
Consider
$\alpha'_i = \sum n_a [Z_{ai}/X'_i/S'_i]_r \in z(X'_i/S'_i, r)$.
The image of $\alpha'_i$ in $z(X'/S', r)$ agrees with the base change
$g^*\alpha$ by construction.

\medskip\noindent
Set $S''_i = S'_i \times_{S_i} S'_i$ and $X''_i = S''_i \times_{S_i} X_i$
and set $S'' = S' \times_S S'$ and $X'' = S'' \times_S X$.
We denote $\text{pr}_1, \text{pr}_2 : S'' \to S'$ and
$\text{pr}_1, \text{pr}_2 : S''_i \to S'_i$ the projections.
The two base changes $\text{pr}_1^*\alpha'_i$ and $\text{pr}_1^*\alpha'_i$
map to the same element of $z(X''/S'', r)$ because
$\text{pr}_1^*g^*\alpha = \text{pr}_1^*g^*\alpha$.
Hence after increasing $i$ we may assume that
$\text{pr}_1^*\alpha'_i = \text{pr}_1^*\alpha'_i$
by the first paragraph of the proof.
By Lemma \ref{lemma-descend-family}
we obtain a unique family $\alpha_i$
of $r$-cycles on fibres of $X_i/S_i$
with $g_i^*\alpha_i = \alpha'_i$ (this uses that $S'_i \to S_i$
is completely decomposed).
By Lemma \ref{lemma-relative-cycles-h-descent}
we see that $\alpha_i \in z(X_i/S_i, r)$.
The uniqueness in Lemma \ref{lemma-descend-family} implies that the
image of $\alpha_i$ in $z(X/S, r)$ is $\alpha$ and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-thickening}
Let $S$ be a locally Noetherian scheme. Let $i : X \to X'$ be a thickening
of schemes locally of finite type over $S$. Let $r \geq 0$.
Then $i_* : z(X/S, r) \to z(X'/S, r)$ is a bijection.
\end{lemma}

\begin{proof}
Since $i_s : X_s \to X'_s$ is a thickening it is clear that $i_*$ induces
a bijection between
families of $r$-cycles on the fibres of $X/S$ and
families of $r$-cycles on the fibres of $X'/S$.
Also, given a family $\alpha$ of $r$-cycles on the fibres of $X/S$
$\alpha \in z(X/S, r) \Leftrightarrow i_*\alpha \in z(X'/S, r)$
by Lemma \ref{lemma-check-after-closed}. The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-extend-to-larger}
Let $S$ be a locally Noetherian scheme. Let $X$ be a scheme locally
of finite type over $S$. Let $r \geq 0$. Let $U \subset X$ be an open
such that $X \setminus U$ has relative dimension $< r$ over $S$, i.e.,
$\dim(X_s \setminus U_s) < r$ for all $s \in S$. Then
restriction defines a bijection $z(X/S, r) \to z(U/S, r)$.
\end{lemma}

\begin{proof}
Since $Z_r(X_s) \to Z_r(U_s)$ is a bijection by the dimension assumption,
we see that restriction induces a bijection between
families of $r$-cycles on the fibres of $X/S$ and
families of $r$-cycles on the fibres of $U/S$.
These restriction maps $Z_r(X_s) \to Z_r(U_s)$ are
compatible with base change and with specializations, see
Lemma \ref{lemma-compatibilities} and \ref{lemma-specialization-flat-pullback}.
The lemma follows easily from this; details omitted.
\end{proof}

\begin{lemma}
\label{lemma-seminormalize-base}
Let $g : S' \to S$ be a universal homeomorphism of locally Noetherian schemes
which induces isomorphisms of residue fields. Let $f : X \to S$ be locally of
finite type. Set $X' = S' \times_S X$. Let $r \geq 0$. Then base change by $g$
determines a bijection $z(X/S, r) \to z(X'/S', r)$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-pullback-universally-bijective} we have a bijection
between the group of families of $r$-cycles on fibres of $X/S$ and
the group of families of $r$-cycles on fibres of $X'/S'$.
Say $\alpha$ is a families of $r$-cycles on fibres of $X/S$ and
$\alpha' = g^*\alpha$ is the base change.
If $R$ is a discrete valuation ring, then any morphism
$h : \Spec(R) \to S$ factors as $g \circ h'$ for some
unique morphism $h' : \Spec(R) \to S'$.
Namely, the morphism $S' \times_S \Spec(R) \to \Spec(R)$ is
a univeral homomorphism inducing bijections on residue fields,
and hence has a section (for example because $R$ is a seminormal
ring, see Morphisms, Section \ref{morphisms-section-seminormalization}).
Thus the condition that $\alpha$ is compatible with
specializations (i.e., is a relative $r$-cycle)
is equivalent to the condition that
$\alpha'$ is compatible with specializations.
\end{proof}






\section{Equidimensional relative cycles}
\label{section-equidimensional}

\noindent
Here is the definition.

\begin{definition}
\label{definition-equidimensional}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ is locally Noetherian
and $f$ is locally of finite type. Let $r \geq 0$ be an integer. We say a
relative $r$-cycle $\alpha$ on $X/S$ {\it equidimensional} if the support
of $\alpha$ (Remark \ref{remark-supports-family})
is contained in a closed subset $W \subset X$ whose relative
dimension over $S$ is $\leq r$.
The group of all equidimensional relative $r$-cycles on $X/S$ is
denoted $z_{equi}(X/S, r)$.
\end{definition}

\begin{example}
\label{example-not-equidimensional}
\begin{reference}
\cite[Example 3.1.9]{SV}
\end{reference}
There exist relative $r$-cycles which are not equidimensional.
Namely, let $k$ be a field and let $X = \Spec(k[x, y, t])$
over $S = \Spec(k[x, y])$. Let $s$ be a point of $S$ and
denote $a, b \in \kappa(s)$ the images of $x$ and $y$.
Consider the family $\alpha$ of $0$-cycles on $X/S$ defined by
\begin{enumerate}
\item $\alpha_s = 0$ if $b = 0$ and otherwise
\item $\alpha_s = [p] - [q]$ where $p$, resp.\ $q$ is the $\kappa(s)$-rational
point of $\Spec(\kappa(s)[t])$ with $t = a/b$,
resp.\ $t = (a + b^2)/b$.
\end{enumerate}
We leave it to the reader to show that this is compatible with specializations;
the idea is that $a/b$ and $(a + b^2)/b = a/b + b$ limit to the same point
in $\mathbf{P}^1$ over the residue field of any valuation $v$ on $\kappa(s)$
with $v(b) > 0$. On the other hand, the closure of the support of $\alpha$
containes the whole fibre over $(0, 0)$.
\end{example}

\begin{lemma}
\label{lemma-equidimensional-functoriality}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ is locally Noetherian
and $f$ is locally of finite type. Let $r \geq 0$ be an integer. Let
$\alpha$ be a relative $r$-cycle on $X/S$. If $\alpha$ is equidimensional,
then any restriction, base change, or flat pullback of $\alpha$ is
equidimensional.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-check-equidimensional}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r \geq 0$ be an integer. Let $\alpha$
be a relative $r$-cycle on $X/S$. Then to check that $\alpha$ is equidimensional
we may work Zariski locally on $X$ and $S$.
\end{lemma}

\begin{proof}
Namely, the condition that $\alpha$ is equidimensional just means that
the closure of the support of $\alpha$ has relative dimension $\leq r$
over $S$. Since taking closures commutes with restriction to opens,
the lemma follows (small detail omitted).
\end{proof}

\begin{lemma}
\label{lemma-equidimensional-fppf-descent}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r \geq 0$ be an integer. Let $\alpha$
be a relative $r$-cycle on $X/S$. Let $\{g_i : S_i \to S\}$
be an fppf covering. Then $\alpha$ is equidimensional
if and only if each base change $g_i^*\alpha$ is equidimensional.
\end{lemma}

\begin{proof}
If $\alpha$ is equidimensional, then each $g_i^*\alpha$ is too by
Lemma \ref{lemma-equidimensional-functoriality}. Assume each $g_i^*\alpha$
is equidimensional. Denote $W$ the closure
of $\text{Supp}(\alpha)$ in $X$. Since $g_i : S_i \to S$ is universally open
(being flat and locally of finite presentation), so is the morphism
$f_i : X_i = S_i \times_S X \to X$. Denote $\alpha_i = g_i^*\alpha$. We have
$\text{Supp}(\alpha_i) = f_i^{-1}(\text{Supp}(\alpha))$ by
Lemma \ref{lemma-support-family}.
Since $f_i$ is open, we see that $W_i = f_i^{-1}(W)$ is the closure
of $\text{Supp}(\alpha_i)$. Hence by assumption the morphism
$W_i \to S_i$ has relative dimension $\leq r$.
By Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-after-base-change}
(and the fact that the morphisms $S_i \to S$ are jointly surjective)
we conclude that $W \to S$ has relative dimension $\leq r$.
\end{proof}

\begin{lemma}
\label{lemma-equidimensional-descent-pullbacks}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r, e \geq 0$ be integers.
Let $\alpha$ be a relative $r$-cycle on $X/S$.
Let $\{f_i : X_i \to X\}$ be a jointly surjective family
of flat morphisms, locally of finite type, and of relative dimension $e$.
Then $\alpha$ is equidimensional if and only if each flat
pullback $f_i^*\alpha$ is equidimensional.
\end{lemma}

\begin{proof}
Omitted. Hint: As in the proof of Lemma \ref{lemma-equidimensional-fppf-descent}
one shows that the inverse image by $f_i$ of the closure $W$ of the support of
$\alpha$ is the closure $W_i$ of the support of $f_i^*\alpha$. Then
$W \to S$ has relative dimension $\leq r$ holds if $W_i \to S$
has relative dimension $\leq r + e$ for all $i$.
\end{proof}

\noindent
Let $S$ be a locally Noetherian scheme. Let $f : X \to S$ be a locally
quasi-finite morphism of schemes. Then we have $z(X/S, 0) = z_{equi}(X/S, 0)$
and $z(X/S, r) = 0$ for $r > 0$. Given $\alpha \in z(X/S, 0)$ let us
define a map
$$
w_\alpha : X \longrightarrow \mathbf{Z},\quad
x \mapsto \alpha(x) [\kappa(x) : \kappa(s)]_i \quad\text{where }s = f(x)
$$
Here $\alpha(x)$ denotes the coefficient of $x$ in the $0$-cycle
$\alpha_s$ on the fibre $X_s$ and $[K : k]_i$ denotes the inseparable
degree of a finite field extension.
The following lemma shows that this map is a weighting of $f$
(More on Morphisms, Definition \ref{more-morphisms-definition-weighting})
and that every weighting is of this form up to taking a multiple.

\begin{lemma}
\label{lemma-weightings}
Let $S$ be a locally Noetherian scheme. Let $f : X \to S$ be a locally
quasi-finite morphism of schemes. Let $\alpha \in z(X/S, 0)$.
The map $w_\alpha : X \to \mathbf{Z}$ constructed above is a weighting.
Conversely, if $X$ is quasi-compact, then given a weighting
$w : X \to \mathbf{Z}$ there exists an integer $n > 0$ such
that $nw = w_\alpha$ for some $\alpha \in z(X/S, 0)$. Finally, the
integer $n$ may be chosen to be a power of the prime $p$ if $S$ is a scheme
over $\mathbf{F}_p$.
\end{lemma}

\begin{proof}
First, let us show that the construction is compatible with base
change: if $g : S' \to S$ is a morphism of locally Noetherian schemes,
then $w_{g^*\alpha} = w_\alpha \circ g'$ where $g' : X' \to X$ is the
projection $X' = S' \times_S X \to X$. Namely, let $x' \in X'$ with
images $s', s, x$ in $S', S, X$. Then the coefficient of $[x']$ in
the base change of $[x]$ by $\kappa(s')/\kappa(s)$ is the length of
the local ring $(\kappa(s') \otimes_{\kappa(s)} \kappa(x))_\mathfrak q$.
Here $\mathfrak q$ is the prime ideal corresponding to $x'$.
Thus compatibility with base change follows if
$$
[\kappa(x) : \kappa(s)]_i =
\text{length}((\kappa(s') \otimes_{\kappa(s)} \kappa(x))_\mathfrak q)
[\kappa(x') : \kappa(s')]_i
$$
Let $k/\kappa(s')$ be an algebraically closure. Choose a prime
$\mathfrak p \subset k \otimes_{\kappa(s)} \kappa(x)$ lying
over $\mathfrak q$. Suppose we can show that
$$
[\kappa(x) : \kappa(s)]_i =
\text{length}((k \otimes_{\kappa(s)} \kappa(x))_\mathfrak p)
\quad\text{and}\quad
[\kappa(x') : \kappa(s')]_i =
\text{length}((k \otimes_{\kappa(s')} \kappa(x'))_\mathfrak p)
$$
Then we win because
$$
\text{length}((\kappa(s') \otimes_{\kappa(s)} \kappa(x))_\mathfrak q)
\text{length}((k \otimes_{\kappa(s')} \kappa(x'))_\mathfrak p)
=
\text{length}((k \otimes_{\kappa(s)} \kappa(x))_\mathfrak p)
$$
by Algebra, Lemma \ref{algebra-lemma-pullback-module} and flatness of
$\kappa(s') \otimes_{\kappa(s)} \kappa(x) \to k \otimes_{\kappa(s)} \kappa(x)$.
To show the two equalities, it suffices to prove the first.
Let $\kappa(x)/\kappa/\kappa(s)$ be the subfield constructed in
Fields, Lemma \ref{fields-lemma-separable-first}. Then we see that
$$
k \otimes_{\kappa(s)} \kappa(x) =
\prod\nolimits_{\sigma : \kappa \to k}
k \otimes_{\sigma, \kappa} \kappa(x)
$$
and each of the factors is local of degree
$[\kappa(x) : \kappa] = [\kappa(x) : \kappa(s)]_i$
as desired.

\medskip\noindent
Let $\alpha \in z(X/S, 0)$ and choose a diagram
$$
\xymatrix{
X \ar[d]_f & U \ar[l]^h \ar[d]^\pi \\
Y & V \ar[l]_g
}
$$
as in More on Morphisms, Definition \ref{more-morphisms-definition-weighting}.
Denote $\beta \in z(U/V, 0)$ the restriction of the base change $g^*\alpha$.
By the compatibility with base change above we have
$w_\beta = w_\alpha \circ h$ and it suffices to show that
$\int_\pi w_\beta$ is locally constant on $V$. Next, note that
\begin{align*}
\left( \int_\pi w_\beta \right)(v)
& =
\sum\nolimits_{u \in U, \pi(u) = v} 
\beta(u) [\kappa(u) : \kappa(v)]_i [\kappa(u) : \kappa(v)]_s \\
& =
\sum\nolimits_{u \in U, \pi(u) = v} \beta(u)[\kappa(u) : \kappa(v)]
\end{align*}
This last expression is the coefficient of $v$ in $\pi_*\beta \in z(V/V, 0)$.
By Lemma \ref{lemma-relative-cycle-smooth} this function is locally
constand on $V$.

\medskip\noindent
Conversely, let $w : X \to S$ be a weighting and $X$ quasi-compact.
Choose a sufficiently divisible integer $n$. Let $\alpha$ be the family
of $0$-cycles on fibres of $X/S$ such that for $s \in S$ we have
$$
\alpha_s =
\sum\nolimits_{f(x) = s} \frac{n w(x)}{[\kappa(x) : \kappa(s)]_i} [x]
$$
as a zero cycle on $X_s$.
This makes sense since the fibres of $f$ are universally bounded
(Morphisms, Lemma
\ref{morphisms-lemma-locally-quasi-finite-qc-source-universally-bounded})
hence we can find $n$ such that the right hand side is an integer for
all $s \in S$. The final statement of the lemma also follows, provided
we show $\alpha$ is a relative $0$-cycle. To do this we have to
show that $\alpha$ is compatible with specializations along discrete
valuation rings. By the first paragraph of the proof our construction
is compatible with base change (small detail omitted; it is the ``inverse''
construction we are discussing here). Also, the base
change of a weighting is a weighting, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-weighting-base-change}.
Thus we reduce to the problem studied in the next paragraph.

\medskip\noindent
Assume $S$ is the spectrum of a discrete valuation ring with generic
point $\eta$ and closed point $0$. Let $w : X \to S$ be a weighting with
$X$ quasi-finite over $S$. Let $\alpha$ be the family of $0$-cycles on
fibres of $X/S$ constructed in the previous paragraph (for a suitable $n$).
We have to show that $sp_{X/S}(\alpha_\eta) = \alpha_0$.
Let $\beta \in z(X/S, 0)$ be the relative $0$-cycle on $X/S$
with $\beta_\eta = \alpha_\eta$ and $\beta_0 = sp_{X/S}(\alpha_\eta)$.
Then $w' = w_\beta - nw : X \to \mathbf{Z}$
is a weighting (using the result above) and zero in the points of $X$
which map to $\eta$. Now it is easy to see that a weighting which
is zero on all points of $X$ mapping to $\eta$ has to be zero;
details omitted. Hence $w' = 0$, i.e., $w_\beta = nw$, hence
$\alpha = \beta$ as desired.
\end{proof}









\section{Effective relative cycles}
\label{section-effective}


\noindent
Here is the definition.

\begin{definition}
\label{definition-effective}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ is locally Noetherian
and $f$ is locally of finite type. Let $r \geq 0$ be an integer. We say a
relative $r$-cycle $\alpha$ on $X/S$ {\it effective} if $\alpha_s$ is an
effective cycle
(Chow Homology, Definition \ref{chow-definition-effective-cycle})
for all $s \in S$. The monoid of all effective relative $r$-cycles
on $X/S$ is denoted $z^{eff}(X/S, r)$.
\end{definition}

\noindent
Below we will show that an effective relative cycle is equidimensional,
see Lemma \ref{lemma-effective-equidimensional}.

\begin{lemma}
\label{lemma-effective-functoriality}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ is locally Noetherian
and $f$ is locally of finite type. Let $r \geq 0$ be an integer. Let
$\alpha$ be a relative $r$-cycle on $X/S$. If $\alpha$ is effective,
then any restriction, base change, flat pullback, or proper pushforward
of $\alpha$ is effective.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-check-effective}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r \geq 0$ be an integer. Let $\alpha$
be a relative $r$-cycle on $X/S$. Then to check that $\alpha$ is effective
we may work Zariski locally on $X$ and $S$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-effective-descent}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r \geq 0$ be an integer. Let $\alpha$
be a relative $r$-cycle on $X/S$. Let $g : S' \to S$ be a surjective morphism.
Then $\alpha$ is effective if and only if the base change $g^*\alpha$
is effective.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-effective-descent-pullbacks}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r, e \geq 0$ be integers.
Let $\alpha$ be a relative $r$-cycle on $X/S$.
Let $\{f_i : X_i \to X\}$ be a jointly surjective family
of flat morphisms, locally of finite type, and of relative dimension $e$.
Then $\alpha$ is effective if and only if each flat
pullback $f_i^*\alpha$ is effective.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-effective-support-closed}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r, e \geq 0$ be integers.
Let $\alpha$ be a relative $r$-cycle on $X/S$.
If $\alpha$ is effective, then $\text{Supp}(\alpha)$ is
closed in $X$.
\end{lemma}

\begin{proof}
Let $g : S' \to S$ be the inclusion of an irreducible component
viewed as an integral closed subscheme. By
Lemmas \ref{lemma-effective-functoriality} and \ref{lemma-support-family}
it suffices to show that the support of the base change
$g^*\alpha$ is closed in $S' \times_S S$.
Thus we may assume $S$ is an integral scheme with generic point
$\eta$. We will show that $\text{Supp}(\alpha)$ is the closure
of $\text{Supp}(\alpha_\eta)$. To do this, pick any $s \in S$.
We can find a morphism $g : S' \to S$ where $S'$ is the spectrum
of a discrete valuation ring mapping the generic point $\eta' \in S'$ to $\eta$
and the closed point $0 \in S'$ to $s$, see
Properties, Lemma \ref{properties-lemma-locally-Noetherian-specialization-dvr}.
Then it suffices to prove that the support of $g^*\alpha$
is equal to the closure of $\text{Supp}((g^\alpha)_{\eta'})$.
This reduces us to the case discussed in the next paragraph.

\medskip\noindent
Here $S$ is the spectrum of a discrete valuation ring with generic
point $\eta$ and closed point $0$. We have to show that
$\text{Supp}(\alpha)$ is the closure of $\text{Supp}(\alpha_\eta)$.
Since $\alpha$ is effective we may write $\alpha_\eta = \sum n_i[Z_i]$
with $n_i > 0$ and $Z_i \subset X_\eta$ integral closed of dimension $r$.
Since $\alpha_0 = sp_{X/S}(\alpha_\eta)$ we know that
$\alpha_0 = \sum n_i [\overline{Z}_{i, 0}]_r$ where $\overline{Z}_i$
is the closure of $Z_i$. By Varieties, Lemma
\ref{varieties-lemma-dominate-valuation-ring-dimension-fibres}
we see that $\overline{Z}_{i, 0}$ is equidimensional of dimension $r$.
Since $n_i > 0$ we conclude that $\text{Supp}(\alpha_0)$
is equal to the union of the $\overline{Z}_{i, 0}$ which
is the fibre over $0$ of $\bigcup \overline{Z}_i$ which
in turn is the closure of $\bigcup Z_i$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-effective-equidimensional}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r, e \geq 0$ be integers.
Let $\alpha$ be a relative $r$-cycle on $X/S$.
If $\alpha$ is effective, then $\alpha$ is equidimensional.
\end{lemma}

\begin{proof}
Assume $\alpha$ is effective. By Lemma \ref{lemma-effective-support-closed}
the support $\text{Supp}(\alpha)$ is closed in $X$. Thus
$\alpha$ is equidimensional as the fibres of $\text{Supp}(\alpha) \to S$
are the supports of the cycles $\alpha_s$ and hence have dimension $r$.
\end{proof}

\begin{remark}
\label{remark-representable}
Let $f : X \to S$ be a morphism of schemes with $S$ locally Noetherian
and $f$ locally of finite type. We can ask if the contravariant functor
$$
\begin{matrix}
\text{schemes }S'\text{ locally} \\
\text{of finite type over }S
\end{matrix}
\longrightarrow
z^{eff}(X'/S', r)\text{ where }X' = S' \times_S X
$$
is representable. Since $z(X'/S', r) = z(X'_{red}/S'_{red}, r)$
this cannot be true (we leave it to the reader to make an actual
counter example). A better question would be if we can find a
subcategory of the left hand side on which the functor is
representable. Lemma \ref{lemma-seminormalize-base} suggests
we should restrict at least to the category of seminormal schemes over $S$.

\medskip\noindent
If $S/\Spec(\mathbf{Q})$ is Nagata and $f$ is a projective morphism, then
it turns out that $S' \mapsto z^{eff}(X'/S', r)$ is representable on the
category of seminormal $S'$. Roughly speaking this is the content of
\cite[Theorem 3.21]{KRC}.

\medskip\noindent
If $S$ has points of positive characteristic, then this no longer works
even if we replace seminormality with weak normality; a locally Noetherian
scheme $T$ is weakly normal if any birational universal homeomorphism
$T' \to T$ has a section. An example is to consider $0$-cycles of degree
$2$ on $X = \mathbf{A}^2_k$ over $S = \Spec(k)$ where $k$ is a field of
characteristic $2$. Namely, over $W = X \times_S X$ we have a canonical
relative $0$-cycle $\alpha \in z^{eff}(X_W/W, 0)$: for
$w = (x_1, x_2) \in W = X^2$ we have the cycle $\alpha_w = [x_1] + [x_2]$.
This cycle is invariant under the involution $\sigma : W \to W$ switching
the factors. Since $W$ is smooth (hence normal, hence weakly normal), if
$z(-/-, r)$ was representable by $M$ on the category of weakly normal
schemes of finite type over $k$ we would get a $\sigma$-invariant
morphism from $W$ to $M$. This in turn would define a morphism from the
quotient scheme $\text{Sym}^2_S(X) = W/\langle \sigma \rangle$ to $M$.
Since $\text{Sym}^2_S(X)$ is normal, we would by the moduli property of $M$
obtain a relative $0$-cycle $\beta$ on
$X \times_S \text{Sym}^2_S(X) / \text{Sym}^2_S(X)$
whose pullback to $W$ is $\alpha$. However, there is no such cycle $\beta$.
Namely, writing $X = \Spec(k[u, v])$ the scheme
$\text{Sym}^2_S(X)$ is the spectrum of
$$
k[u_1 + u_2, u_1u_2, v_1 + v_2, v_1v_2, u_1v_1 + u_2v_2]
\subset
k[u_1, u_2, v_1, v_2]
$$
The image of the diagonal $u_1 = u_2, v_1 = v_2$ in $\text{Sym}^2_S(X)$
is the closed subscheme $V = \Spec(k[u_1^2, v_1^2])$; here we use that
the characteristic of $k$ is $2$. Looking at the
generic point $\eta$ of $V$, the cycle $\beta_\eta$ would be a zero
cycle of degree $2$ on $\mathbf{A}^2_{k(u_1^2, v_1^2)}$
whose pullback to $\mathbf{A}^2_{k(u_1, u_2)}$ whould be
$2[\text{the point with coordinates} (u_1, v_2)]$.
This is clearly impossible.

\medskip\noindent
The discussion above does not contradict \cite[Theorem 4.13]{KRC} as the Chow
variety in that theorem only coarsely represents a functor (in fact 2
distinct functors, only one of which agrees with ours for projective $X$
as one can see with some work). Similarly, in \cite[Section 4.4]{SV}
it is shown that for projective $X/S$ the $h$-sheafification of the presheaf
$S' \mapsto z^{eff}(S' \times_S X/S', r)$ is equal to the $h$-sheafification of
a representable functor.
\end{remark}

\begin{remark}
\label{remark-equidimensional-over-geometrically-unibranch}
Let $f : X \to S$ be a morphism of schemes. Let $r \geq 0$. Let $Z \subset X$
be a closed subscheme. Assume
\begin{enumerate}
\item $S$ is Noetherian and geometrically unibranch,
\item $f$ is of finite type, and
\item $Z \to S$ has relative dimension $\leq r$.
\end{enumerate}
Then for all sufficiently divisible integers $n \geq 1$ there exists a
unique effective relative $r$-cycle $\alpha$ on $X/S$ such that
$\alpha_\eta = n[Z_\eta]_r$ for every generic point $\eta$ of $S$.
This is a reformulation of \cite[Theorem 3.4.2]{SV}.
If we ever need this result, we will precisely state and prove it here.
\end{remark}











\section{Proper relative cycles}
\label{section-proper}

\noindent
In our setting, the following is probably the correct definition.

\begin{definition}
\label{definition-proper}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ is locally Noetherian
and $f$ is locally of finite type. Let $r \geq 0$ be an integer. We say a
relative $r$-cycle $\alpha$ on $X/S$ is a {\it proper relative cycle}
if the support of $\alpha$ (Remark \ref{remark-supports-family})
is contained in a closed subset $W \subset X$ proper over $S$
(Cohomology of Schemes, Definition \ref{coherent-definition-proper-over-base}).
The group of all proper relative $r$-cycles on $X/S$ is
denoted $c(X/S, r)$.
\end{definition}

\noindent
By Cohomology of Schemes, Lemma
\ref{coherent-lemma-closed-closed-proper-over-base}
this just means that the closure of the support is proper over the base.
To see that these form a group, use
Cohomology of Schemes, Lemma \ref{coherent-lemma-union-closed-proper-over-base}.

\begin{lemma}
\label{lemma-proper-functoriality}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ is locally Noetherian
and $f$ is locally of finite type. Let $r \geq 0$ be an integer. Let
$\alpha$ be a relative $r$-cycle on $X/S$. If $\alpha$ is proper,
then any base change $\alpha$ is proper.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-proper-h-descent}
Let $f : X \to S$ be a morphism of schemes. Assume $S$ locally Noetherian
and $f$ locally of finite type. Let $r \geq 0$ be an integer. Let $\alpha$
be a relative $r$-cycle on $X/S$. Let $\{g_i : S_i \to S\}$
be a h covering. Then $\alpha$ is proper
if and only if each base change $g_i^*\alpha$ is proper.
\end{lemma}

\begin{proof}
If $\alpha$ is proper, then each $g_i^*\alpha$ is too by
Lemma \ref{lemma-proper-functoriality}. Assume each $g_i^*\alpha$
is proper. To prove that $\alpha$ is proper, it clearly suffices
to work affine locally on $S$. Thus we may and do assume that $S$
is affine. Then we can refine our covering $\{S_i \to S\}$
by a family $\{T_j \to S\}$ where $g : T \to S$ is a proper surjective
morphism and $T = \bigcup T_j$ is an open covering.
It follows that $\beta = g^*\alpha$ is proper on $Y = T \times_S X$
over $T$. By Lemma \ref{lemma-support-family} we find that the support
of $\beta$ is the inverse image of the support of $\alpha$ by the
morphism $f : Y \to X$. Hence the closure $W \subset Y$
of $f^{-1}\text{Supp}(\alpha)$ is proper over $T$. Since the
morphism $T \to S$ is proper, it follows that $W$ is proper over $S$.
Then by Cohomology of Schemes, Lemma
\ref{coherent-lemma-functoriality-closed-proper-over-base}
the image $f(W) \subset X$ is a closed subset proper over $S$.
Since $f(W)$ contains $\text{Supp}(\alpha)$ we conclude $\alpha$
is proper.
\end{proof}



\section{Proper and equidimensional relative cycles}
\label{section-proper-equidimensional}

\noindent
Let $f : X \to S$ be a morphism of schemes. Assume $S$ is locally Noetherian
and $f$ is locally of finite type. Let $r \geq 0$ be an integer. We say a
relative $r$-cycle $\alpha$ on $X/S$ is a {\it proper and equidimensional
relative cycle} if $\alpha$ is both equidimensional
(Definition \ref{definition-equidimensional})
and proper (Definition \ref{definition-proper}).
The group of all proper, equidimensional relative $r$-cycles on $X/S$ is
denoted $c_{equi}(X/S, r)$.

\medskip\noindent
Similarly we say a relative $r$-cycle $\alpha$ on $X/S$ is a
{\it proper and effective relative cycle} if $\alpha$ is both effective
(Definition \ref{definition-effective}) and proper
(Definition \ref{definition-proper}).
The monoid of all proper, effective relative $r$-cycles on $X/S$ is
denoted $c^{eff}(X/S, r)$.
Observe that these are equidimensional by
Lemma \ref{lemma-effective-equidimensional}.

\medskip\noindent
Thus we have the following diagram of inclusion maps
$$
\xymatrix{
c^{eff}(X/S, r) \ar[r] \ar[d] &
c_{equi}(X/S, r) \ar[r] \ar[d] &
c(X/S, r) \ar[d] \\
z^{eff}(X/S, r) \ar[r] &
z_{equi}(X/S, r) \ar[r] &
z(X/S, r)
}
$$



\section{Action on cycles}
\label{section-action}

\noindent
Let $S$ be a locally Noetherian, universally catenary scheme endowed
with a dimension function $\delta$, see
Chow Homology, Section \ref{chow-section-setup}.
Let $X \to Y$ be a morphism of schemes over $S$, both locally of finite
type over $S$. Let $r \geq 0$. Finally, let $\alpha$ be a family of
$r$-cycles on fibres of $X/Y$. For $e \in \mathbf{Z}$
we will construct an operation
$$
\alpha \cap - : Z_e(Y) \longrightarrow Z_{r + e}(X)
$$
Namely, given $\beta \in Z_e(Y)$ write $\beta = \sum n_i[Z_i]$
where $Z_i \subset Y$ is an integral closed subscheme of
$\delta$-dimension $e$ and the
family $Z_i$ is locally finite in the scheme $Y$.
Let $y_i \in Z_i$ be the generic point. Write
$\alpha_{y_i} = \sum m_{ij} [V_{ij}]$. Thus $V_{ij} \subset X_{y_i}$
is an integral closed subscheme of dimension $r$ and the family
$V_{ij}$ is locally finite in the scheme $X_{y_i}$.
Then we set
$$
\alpha \cap \beta = \sum n_i m_{ij} [\overline{V}_{ij}]
\quad\in\quad
Z_{r + e}(X)
$$
Here $\overline{V}_{ij} \subset X$ is the scheme theoretic image
of the morphism $V_{ij} \to X_{y_i} \to X$ or equivalently,
$\overline{V}_{ij} \subset X$ is an integral closed subscheme
mapping dominantly to $Z_i \subset Y$ whose generic fibre is $V_{ij}$.
It follows readily that $\dim_\delta(\overline{V}_{ij}) = r + e$
and that the family of closed subschemes
$\overline{V}_{ij} \subset X$ is locally finite (we omit the verifications).
Hence $\alpha \cap \beta$ is indeed an element of $Z_{r + e}(X)$.

\begin{lemma}
\label{lemma-action-bilinear}
The construction above is bilinear, i.e., we have
$(\alpha_1 + \alpha_2) \cap \beta = \alpha_1 \cap \beta +
\alpha_2 \cap \beta$ and $\alpha \cap (\beta_1 + \beta_2) =
\alpha \cap \beta_1 + \alpha \cap \beta_2$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-action-opens}
If $U \subset X$ and $V \subset Y$ are open and $f(U) \subset V$, then
$(\alpha \cap \beta)|_U$ is equal to $\alpha|_U \cap \beta|_V$.
\end{lemma}

\begin{proof}
Immediate from the explict description of $\alpha \cap \beta$
given above.
\end{proof}

\begin{lemma}
\label{lemma-action-base-change}
Forming $\alpha \cap \beta$ is compatible with flat base change
and flat pullback (see proof for elucidation).
\end{lemma}

\begin{proof}
Let $(S, \delta)$, $(S', \delta')$, $g : S' \to S$, and $c \in \mathbf{Z}$
be as in Chow Homology, Situation \ref{chow-situation-setup-base-change}.
Let $X \to Y$ be a morphism of schemes locally of finite type over $S$.
Denote $X' \to Y'$ the base change of $X \to Y$ by $g$.
Let $\alpha$ be a family of $r$-cycles on the fibres of $X/Y$.
Let $\beta \in Z_e(Y)$. Denote $\alpha'$ the
base change of $\alpha$ by $Y' \to Y$. Denote
$\beta' = g^*\beta \in Z_{e + c}(Y')$ the pullback of $\beta$ by $g$, see
Chow Homology, Section \ref{chow-section-change-base}.
Compatibility with base change means
$\alpha' \cap \beta'$ is the base change of $\alpha \cap \beta$.

\medskip\noindent
Proof of compatibility with base change.
Since we are proving an equality of cycles on $X'$, we may work locally
on $Y$, see Lemma \ref{lemma-action-opens}. Thus we may assume $Y$
is affine. In particular $\beta$ is a finite linear combination of prime
cycles. Since $- \cap -$ is linear in the second variable
(Lemma \ref{lemma-action-bilinear}), it suffices
to prove the equality when $\beta = [Z]$ for some integral closed subscheme
$Z \subset Y$ of $\delta$-dimension $e$.

\medskip\noindent
Let $y \in Z$ be the generic point. Write $\alpha_y = \sum m_j [V_j]$.
Let $\overline{V}_j$ be the closure of $V_j$ in $X$. Then we have
$$
\alpha \cap \beta = \sum m_j[\overline{V}_j]
$$
The base change of $\beta$ is $\beta' = \sum [Z \times_S S']_{e + c}$ as a
cycle on $Y' = Y \times_S S'$. Let $Z'_a \subset Z \times_S S'$
be the irreducible components, denote $y'_a \in Z'_a$ their generic points,
and denote $n_a$ the multiplicity of $Z'_a$ in $Z \times_S S'$.
We have
$$
\beta' = \sum [Z \times_S S']_{e + c} = \sum n_a[Z'_a]
$$
We have $\alpha'_{y'_a} = \sum m_j [V_{j, \kappa(y'_a)}]_r$
because $\alpha'$ is the base change of $\alpha$ by $Y' \to Y$.
Let $V'_{jab} \subset V_{j, \kappa(y'_a)}$ be the irreducible components
and denote $m_{jab}$ the multiplicity of $V'_{jab}$
in $V_{j, \kappa(y'_a)}$. We have
$$
\alpha'_{y'_a} = \sum m_j [V_{j, \kappa(y'_a)}]_r =
\sum m_j m_{jab} [V'_{jab}]
$$
Thus we we have
$$
\alpha' \cap \beta' = \sum n_a m_j m_{jab} [\overline{V}'_{jab}]
$$
where $\overline{V}'_{jab}$ is the closure of $V'_{jab}$ in $X'$.
Thus to prove the desired equality it suffices to prove
\begin{enumerate}
\item the irreducible components of $\overline{V}_j \times_S S'$
are the schemes $\overline{V}'_{jab}$ and
\item the multiplicity of $\overline{V}'_{jab}$ in
$\overline{V}_j \times_S S'$ is equal to $n_a m_{jab}$.
\end{enumerate}
Note that $V_j \to \overline{V}_j$ is a birational morphism of
integral schemes. The morphisms $V_j \times_S S' \to V_j$
and $\overline{V}_j \times_S S' \to \overline{V}_j$ are flat
and hence map generic points of irreducible components to the
(unique) generic points of $V_j$ and $\overline{V}_j$.
It follows that $V_j \times_S S' \to \overline{V}_j \times_S S'$
is a birational morphisms hence induces a bijection on irreducible
components and identifies their multiplicities.
This means that it suffices to prove that the irreducible components of
$V_j \times_S S'$ are the schemes $V'_{jab}$ and
the multiplicity of $V'_{jab}$ in $V_j \times_S S'$
is equal to $n_a m_{jab}$. However, then we are just saying
that the diagram
$$
\xymatrix{
Z_r(V_j) \ar[r] & Z_{r + c}(V_j \times_S S') \\
Z_0(\Spec(\kappa(y))) \ar[r] \ar[u] &
Z_c(\Spec(\kappa(y)) \times_S S') \ar[u]
}
$$
is commutative where the horizontal arrows are base change by
$\Spec(\kappa(y)) \times_S S' \to \Spec(\kappa(y))$ and
the vertical arrows are flat pullback. This was shown in
Chow Homology, Lemma \ref{chow-lemma-pullback-base-change-pullback}.

\medskip\noindent
The statement in the lemma on flat pullback means the following.
Let $(S, \delta)$, $X \to Y$, $\alpha$, and $\beta$ be as in the
constuction of $\alpha \cap \beta$ above. Let $Y' \to Y$ be a flat
morphism, locally of finite type, and of relative dimension $c$. Then
we can let $\alpha'$ be the base change of $\alpha$ by $Y' \to Y$
and $\beta'$ the flat pullback of $\beta$. Compatibility with flat
pullback means $\alpha' \cap \beta'$ is the flat pullback of
$\alpha \cap \beta$ by $X \times_Y Y' \to Y$. This is actually
a special case of the discussion above if we set $S = Y$ and $S' = Y'$.
\end{proof}

\begin{lemma}
\label{lemma-action-coherent}
Let $(S, \delta)$ and $f : X \to Y$ be as above.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module
with $\dim(\text{Supp}(\mathcal{F}_y)) \leq r$ for all $y \in Y$.
Let $\mathcal{G}$ be a coherent $\mathcal{O}_Y$-module
with $\dim_\delta(\text{Supp}(\mathcal{G})) \leq e$.
Set $\alpha = [\mathcal{F}/X/Y]_r$
(Example \ref{example-family-associated-module}) and
$\beta = [\mathcal{G}]_e$ (Chow Homology, Definition
\ref{chow-definition-cycle-associated-to-coherent-sheaf}).
If $\mathcal{F}$ is flat over $Y$, then $\alpha \cap \beta =
[\mathcal{F} \otimes_{\mathcal{O}_X} f^*\mathcal{G}]_{r + e}$.
\end{lemma}

\begin{proof}
Observe that
$$
\text{Supp}(\mathcal{F} \otimes_{\mathcal{O}_X} f^*\mathcal{G}) =
\text{Supp}(\mathcal{F}) \cap f^{-1}\text{Supp}(\mathcal{G}) =
\bigcup\nolimits_{y \in \text{Supp}(\mathcal{G})} \text{Supp}(\mathcal{F}_y)
$$
It follows that this is a closed subset of $\delta$-dimension $\leq r + e$.
Whence the expression
$[\mathcal{F} \otimes_{\mathcal{O}_X} f^*\mathcal{G}]_{r + e}$
makes sense.

\medskip\noindent
We will use the notation
$\beta = \sum n_i[Z_i]$, $y_i \in Z_i$,
$\alpha_{y_i} = \sum m_{ij} [V_{ij}]$, and
$\overline{V}_{ij}$ introduced in the construction
of $\alpha \cap \beta$. Since $\beta = [\mathcal{G}]_e$
we see that the $Z_i$ are the irreducible components of
$\text{Supp}(\mathcal{G})$ which have $\delta$-dimension $e$.
Similarly, the $V_{ij}$ are the irreducible components
of $\text{Supp}(\mathcal{F}_{y_i})$ having dimension $r$.
It follows from this and the equation in the first
paragraph that $\overline{V}_{ij}$ are the irreducible
components of
$\text{Supp}(\mathcal{F} \otimes_{\mathcal{O}_X} f^*\mathcal{G})$
having $\delta$-dimension $r + e$.
Thus to prove the lemma it now suffices to show that
$$
\text{length}_{\mathcal{O}_{X, \xi_{ij}}}(
(\mathcal{F} \otimes_{\mathcal{O}_X} f^*\mathcal{G})_{\xi_{ij}})
=
\text{length}_{\mathcal{O}_{X_{y_i}, \xi_{ij}}}((\mathcal{F}_{y_i})_{\xi_{ij}})
\cdot
\text{length}_{\mathcal{O}_{Y, y_i}}(\mathcal{G}_{y_i})
$$
By the first paragraph of the proof the left hand side is equal to
the lenth of the $B = \mathcal{O}_{X, \xi_{ij}}$-module
$$
\mathcal{G}_{y_i}
\otimes_{\mathcal{O}_{Y, y_i}}
\mathcal{F}_{\xi_{ij}} =
M \otimes_A N
$$
Here $M = \mathcal{G}_{y_i}$ is a finite length
$A = \mathcal{O}_{Y, y_i}$-module and $N = \mathcal{F}_{\xi_{ij}}$
is a finite $B$-module such that $N/\mathfrak m_AN$ has finite length.
Since $\mathcal{F}$ is flat over $Y$ the module $N$ is $A$-flat.
The right hand side of the formula is equal to
$$
\text{length}_B(N/\mathfrak m_A N) \cdot \text{length}_A(M)
$$
Thus the right and left hand side of the formula are additive in $M$
(use flatness of $N$ over $A$). Thus it suffices to prove the
formula with $M = \kappa_A$ is the residue field in which
case it is immediate.
\end{proof}

\begin{lemma}
\label{lemma-action-closed}
Let $(S, \delta)$ and $f : X \to Y$ be as above. Let $Z \subset X$
be a closed subscheme of relative dimension $\leq r$ over $Y$.
Set $\alpha = [Z/X/Y]_r$ (Example \ref{example-family-associated-closed}).
Let $W \subset Y$ be a closed subscheme of $\delta$-dimension $\leq e$.
Set $\beta = [W]_e$ (Chow Homology, Definition
\ref{chow-definition-cycle-associated-to-closed-subscheme}).
If $Z$ is flat over $Y$, then $\alpha \cap \beta = [Z \times_Y W]_{r + e}$.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-action-coherent}
if we take $\mathcal{F} = \mathcal{O}_Z$ and $\mathcal{F} = \mathcal{O}_W$.
\end{proof}

\begin{lemma}
\label{lemma-action-push-pull}
Let $(S, \delta)$ be as above. Let
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
Y' \ar[r]^g & Y
}
$$
be a cartesian diagram of schemes locally of finite type over $S$
with $g$ proper. Let $r, e \geq 0$. Let $\alpha$ be a family of
$r$-cycles on the fibres of $X/Y$. Let $\beta' \in Z_e(Y')$.
Then we have $f_*(g^*\alpha \cap \beta') = \alpha \cap g_*\beta'$.
\end{lemma}

\begin{proof}
Since we are proving an equality of cycles on $X$, we may work locally
on $Y$, see Lemma \ref{lemma-action-opens}. Thus we may assume $Y$
is affine. Thus $Y'$ is quasi-compact. In particular $\beta'$
is a finite linear combination of prime cycles.
Since $- \cap -$ is linear in the second variable
(Lemma \ref{lemma-action-bilinear}), it suffices
to prove the equality when $\beta' = [Z']$ for some integral closed subscheme
$Z' \subset Y'$ of $\delta$-dimension $e$. Set $Z = g(Z')$. This is
an integral closed subscheme of $Y$ of $\delta$-dimension $\leq e$.
For simplicity we are going to assume $Z$ has $\delta$-dimension 
equal to $e$ and leave the other case (which is easier) to the reader.
Let $y \in Z$ and $y' \in Z'$ be the generic points.
Write $\alpha_y = \sum m_j[V_j]$ with $V_j \subset X_y$
integral closed subschemes of dimension $r$.

\medskip\noindent
Assume first $g$ is a closed immersion. Then $g_*\beta' = [Z]$
and $(g^*\alpha)_{y'} = \sum n_j[V_j]$; this makes sense because
$V_j$ is contained in the closed subscheme $X'_{y'}$ of $X_y$.
Thus in this case the equality is obvious: in both cases
we obtain $\sum m_j[\overline{V}_j]$ where $\overline{V}_j$
is the closure of $V_j$ in the closed subscheme $X' \subset X$.

\medskip\noindent
Back to the general case with $\beta' = [Z']$ as above.
Set $W = Z \times_X Y$ and $W' = Z' \times_{X'} Y'$.
Consider the cartesian squares
$$
\xymatrix{
W \ar[r] \ar[d] & X \ar[d] \\
Z \ar[r] & Y
}
\quad
\xymatrix{
W' \ar[r] \ar[d] & X' \ar[d] \\
Z' \ar[r] & Y'
}
\quad
\xymatrix{
W' \ar[r] \ar[d] & W \ar[d] \\
Z' \ar[r] & Z
}
$$
Since we know the result for the first two squares with by the
previous paragraph, a formal argument shows that it suffices
to prove the result for the last square and the element
$\beta' = [Z'] \in Z_e(Z')$. This reduces us to the case discussed
in the next paragraph.

\medskip\noindent
Assume $Y' \to Y$ is a generically finite morphism of integral schemes
of $\delta$-dimension $e$ and $\beta' = [Y']$. In this case both
$f_*(g^*\alpha \cap \beta')$ and $\alpha \cap g_*\beta'$ are cycles
which can be written as a sum of prime cycles dominant over $Y$.
Thus we may replace $Y$ by a nonempty open subscheme in order to
check the equality. After such a replacement we may assume $g$ is
finite and flat, say of degree $d \geq 1$. Of course, this means
that $g_*\beta' = g_*[Y'] = d[Y]$. Also $\beta' = [Y'] = g^*[Y]$. Hence
$$
f_*(g^*\alpha \cap \beta') =
f_*(g^*\alpha \cap g^*[Y]) =
f_*f^*(\alpha \cap [Y]) =
d (\alpha \cap [Y]) =
\alpha \cap g_*\beta')
$$
as desired. The second equality is Lemma \ref{lemma-action-base-change}
and the third equality is Chow Homology, Lemma \ref{chow-lemma-finite-flat}.
\end{proof}







\section{Action on chow groups}
\label{section-action-chow}

\noindent
When $\alpha$ is a relative $r$-cycle, the operation $\alpha \cap -$
of Section \ref{section-action} factors through rational equivalence
and defines a bivariant class.

\begin{lemma}
\label{lemma-closed-in-X-gysin}
Let $(S, \delta)$ be as in Section \ref{section-action}.
Let $f : X' \to X$ be a proper morphism of schemes
locally of finite type over $S$.
Let $(\mathcal{L}, s, i : D \to X)$ be as in
Chow Homology, Definition \ref{chow-definition-gysin-homomorphism}.
Form the diagram
$$
\xymatrix{
D' \ar[d]_g \ar[r]_{i'} & X' \ar[d]^f \\
D \ar[r]^i & X
}
$$
as in Chow Homology, Remark \ref{chow-remark-pullback-pairs}.
If $\mathcal{L}|_D \cong \mathcal{O}_D$, then
$i^*f_*\alpha' = g_*(i')^*\alpha'$ in $Z_k(D)$
for any $\alpha' \in Z_{k + 1}(X')$.
\end{lemma}

\begin{proof}
The statement makes sense as all operations are defined on the level
of cycles, see Chow Homology, Remark \ref{chow-remark-gysin-on-cycles}
for the gysin maps.
Suppose $\alpha = [W']$ for some integral closed subscheme
$W' \subset X'$. Let $W = f(W') \subset X$. In case $W' \not \subset D'$,
then $W \not \subset D$ and we see that
$$
[W' \cap D']_k = \text{div}_{\mathcal{L}'|_{W'}}({s'|_{W'}})
\quad\text{and}\quad
[W \cap D]_k = \text{div}_{\mathcal{L}|_W}(s|_W)
$$
and hence $f_*$ of the first cycle equals the second cycle by
Chow Homology, Lemma \ref{chow-lemma-equal-c1-as-cycles}. Hence the
equality holds as cycles. In case $W' \subset D'$, then
$W \subset D$ and both sides are zero by construction.
\end{proof}

\begin{lemma}
\label{lemma-action-gysin}
Let $(S, \delta)$ be as in Section \ref{section-action}.
Let $X \to Y$ be a morphism of schemes
locally of finite type over $S$. Let $r \geq 0$ and let
$\alpha \in z(X/Y, r)$ be a relative $r$-cycle on $X/Y$.
Let $(\mathcal{L}, s, i : D \to Y)$ be as in
Chow Homology, Definition \ref{chow-definition-gysin-homomorphism}.
Form the cartesian diagram
$$
\xymatrix{
E \ar[d] \ar[r]_j & X \ar[d] \\
D \ar[r]^i & Y
}
$$
See Chow Homology, Remark \ref{chow-remark-pullback-pairs}.
If $\mathcal{L}|_D \cong \mathcal{O}_D$, then for $e \in \mathbf{Z}$
the diagram
$$
\xymatrix{
Z_e(D) \ar[rr]_{i^*\alpha \cap -} & &
Z_{e + r}(E) \\
Z_{e + 1}(Y) \ar[u]^{i^*} \ar[rr]^{\alpha \cap -} & &
Z_{r + e + 1}(X) \ar[u]_{j^*}
}
$$
commutes where the vertical arrows $i^*$ and $j^*$ are the
gysin maps on cycles as in
Chow Homology, Remark \ref{chow-remark-gysin-on-cycles}.
\end{lemma}

\begin{proof}
Preliminary remark.
Suppose that $g : Y' \to Y$ is an envelope (Chow Homology, Definition
\ref{chow-definition-envelope}).
Denote $D', i', E', j', X', \alpha'$ the base changes of
$D, i, E, j, X, \alpha$ by $g$ and denote $f : X' \to X$ the projection.
Assume the lemma holds for $D', i', E', j', X', Y', \alpha'$.
Then, if $\beta' \in Z_{e + 1}(Y')$, we have
\begin{align*}
i^*\alpha \cap i^*g_*\beta'
& =
i^*\alpha \cap f_*(i')^*\beta' \\
& =
f_*(f^*i^*\alpha \cap (i')^*\beta') \\
& =
f_*((i')^*\alpha' \cap (i')^*\beta') \\
& =
f_*((j')^*(\alpha' \cap \beta')) \\
& =
j^*(f_*(f^*\alpha \cap \beta')) \\
& =
j^*(\alpha \cap g_*\beta')
\end{align*}
Here the
first equality is Lemma \ref{lemma-closed-in-X-gysin},
the second equality is Lemma \ref{lemma-action-push-pull},
the third equality is the definition of $\alpha'$,
the fourth equality is the assumption that our lemma holds for
$D', i', E', j', X', \alpha'$,
the fifth equality is Lemma \ref{lemma-closed-in-X-gysin}, and
the sixth equality is Lemma \ref{lemma-action-push-pull}.
Thus we see that our lemma holds for the image of
$g_* : Z_{e + 1}(Y') \to Z_e(Y)$. However, since $g$ is completely
decomposed this map is surjective and we conclude the lemma holds
for $D, i, E, j, X, Y, \alpha$.

\medskip\noindent
Let $\beta \in Z_{e + 1}(Y)$. We have to show that
$(D \to Y)^*\alpha \cap i^*\beta = j^*(\alpha \cap \beta)$
as cycles on $E$. This question is local on $E$ hence we
can replace $X$ and $Y$ by open subschemes. (This uses that formation
of the operators $i^*$, $j^*$, $\alpha \cap - $ and
$(D \to Y)^*\alpha \cap -$ commute with localization. This is
obvious for the gysin maps and follows from
Lemma \ref{lemma-action-opens} for the others.)
Thus we may assume that $X$ and $Y$ are affine
and we reduce to the case discussed in the next paragraph.

\medskip\noindent
Assume $X$ and $Y$ are quasi-compact. By the first paragraph of the proof
and Lemma \ref{lemma-get-cycles} we may in addition assume that $\alpha$
is in the image of (\ref{equation-cycle-classes}). By linearity
of the operations in question, we may assume that $\alpha = [Z/X/Y]_r$
for some closed subscheme $Z \subset X$ which is flat and of relative
dimension $\leq r$ over $Y$. Also, as $Y$ is quasi-compact, the cycle
$\beta$ is a finite linear combination of prime cycles. Since the operations
in question are linear, it suffices
to prove the equality when $\beta = [W]$ for some integral closed subscheme
$W \subset Y$ of $\delta$-dimension $e + 1$.

\medskip\noindent
If $W \subset D$, then on the one hand $i^*[W] = 0$ and on the
other hand $\alpha \cap [W]$ is supported on $E$ so also
$j^*(\alpha \cap [W]) = 0$. Thus the equality holds in this case.

\medskip\noindent
Say $W \not \subset D$. Then $i^*[W] = [D \cap W]_e$.
Note that the pullback $i^*\alpha$ of $\alpha = [Z/X/Y]_r$
by $i$ is $[(E \cap Z)/E/D]_r$ and that
$(E \cap Z) = E \times_Y Z = D \times_Y Z$
is flat over $D$. Hence by Lemma \ref{lemma-action-closed}
used twice we have
$$
i^*\alpha \cap i^*[W] =
[(E \cap Z) \times_D (D \cap W)]_{r + e} =
[E \cap (Z \times_Y W)]_{r + e} =
j^*(\alpha \cap [W])
$$
as desired.
\end{proof}

\begin{proposition}
\label{proposition-get-bivariant-class}
Let $(S, \delta)$ be as in Section \ref{section-action}. Let $X \to Y$
be a morphism of schemes locally of finite type over $S$. Let $r \geq 0$
and let $\alpha \in z(X/Y, r)$ be a relative $r$-cycle on $X/Y$.
The rule that to every morphism $g : Y' \to Y$ locally of finite type
and every $e \in \mathbf{Z}$ associates the operation
$$
g^*\alpha \cap - : Z_e(Y') \to Z_{r + e}(X')
$$
where $X' = Y' \times_Y X$ factors through rational equivalence to
define a bivariant class $c(\alpha) \in A^{-r}(X \to Y)$.
\end{proposition}

\begin{proof}
The operation factors through rational equivalence by
Lemma \ref{lemma-action-gysin} and
Chow Homology, Lemma \ref{chow-lemma-factors-through-rational-equivalence}.
The resulting operation on chow groups is a bivariant class by
Chow Homology, Lemma \ref{chow-lemma-bivariant-weaker}
and
Lemmas \ref{lemma-action-push-pull}, \ref{lemma-action-base-change}, and
\ref{lemma-action-gysin}.
\end{proof}

\begin{remark}
\label{remark-characterize-relative-cycles}
Let $(S, \delta)$ be as in Section \ref{section-action}. Let $X \to Y$
be a morphism of schemes locally of finite type over $S$. Let $r \geq 0$.
Let $c$ be a rule that to every morphism $g : Y' \to Y$ locally of finite
type and every $e \in \mathbf{Z}$ associates an operation
$$
c \cap - : Z_e(Y') \to Z_{r + e}(X')
$$
compatible with proper pushforward, flat pullback, and gysin maps as in
Lemma \ref{lemma-action-gysin}. Then we claim there is a relative $r$-cycle
$\alpha$ on $X/Y$ such that $c \cap = g^*\alpha \cap -$ for every $g$ as above.
If we ever need this, we will carefully state and prove this here.
\end{remark}









\section{Composition of families of cycles on fibres}
\label{section-compose-families}

\noindent
Let $X \to Y \to S$ be morphisms of schemes, both locally of finite type.
Let $r, e \geq 0$. Let $\alpha$ be a family of $r$-cycles
on fibres of $X/Y$ and let $\beta$ be a family of $e$-cycles on
fibres of $Y/S$. Then we obtain a family of 
of $(r + e)$-cycles $\alpha \circ \beta$ on the fibres of $X/S$
by setting
$$
(\alpha \circ \beta)_s = (Y_s \to Y)^*\alpha \cap \beta_s
$$
More precisely, the expression $(Y_s \to Y)^*\alpha$ denotes
the base change of $\alpha$ by $Y_s \to Y$ to a family of $r$-cycles
on the fibres of $X_s/Y_s$ and the operation $- \cap -$
was defined and studied in Section \ref{section-action}\footnote{To be sure,
we use $s = \Spec(\kappa(s))$ as the base scheme with $\delta(s) = 0$.}.

\begin{lemma}
\label{lemma-construction-bilinear}
The construction above is bilinear, i.e., we have
$(\alpha_1 + \alpha_2) \circ \beta \alpha_1 \circ \beta +
\alpha_1 \circ \beta$ and $\alpha \circ (\beta_1 + \beta_2) =
\alpha \circ \beta_1 + \alpha \circ \beta_2$.
\end{lemma}

\begin{proof}
Omitted. Hint: on fibres the construction is bilinear
by Lemma \ref{lemma-action-bilinear}.
\end{proof}

\begin{lemma}
\label{lemma-construction-opens}
If $U \subset X$ and $V \subset Y$ are open and $f(U) \subset V$, then
$(\alpha \circ \beta)|_U$ is equal to $\alpha|_U \circ \beta|_V$.
\end{lemma}

\begin{proof}
Omitted. Hint: on fibres use
Lemma \ref{lemma-action-opens}.
\end{proof}

\begin{lemma}
\label{lemma-construction-base-change}
The formation of $\alpha \circ \beta$ is compatible with base change.
\end{lemma}

\begin{proof}
Let $g : S' \to S$ be a morphism of schemes.
Denote $X' \to Y'$ the base change of $X \to Y$ by $g$. Denote
$\alpha'$ the base change of $\alpha$ with respect to $Y' \to Y$.
Denote $\beta'$ the base change of $\beta$ with respect to $S' \to S$.
The assertion means that $\alpha' \circ \beta'$ is the base change
of $\alpha \circ \beta$ by $g : S' \to S$.

\medskip\noindent
Let $s' \in S'$ be a point with image $s \in S$. Then
$$
(\alpha' \circ \beta')_{s'} = (Y'_{s'} \to Y')^*\alpha' \cap \beta'_{s'}
$$
We observe that
$$
(Y'_{s'} \to Y')^*\alpha' =
(Y'_{s'} \to Y')^*(Y' \to Y)^*\alpha =
(Y'_{s'} \to Y_s)^*(Y_s \to Y)^*\alpha
$$
and that $\beta'_{s'}$ is the base change of $\beta_s$ by
$s' = \Spec(\kappa(s')) \to \Spec(\kappa(s)) = s$.
Hence the result follows from Lemma \ref{lemma-action-base-change}
applied to $(Y_s \to Y)^*\alpha$, $\beta_s$,
$X_s \to Y_s \to s$, and base change by $s' \to s$.
\end{proof}

\begin{lemma}
\label{lemma-construction-coherent}
Let $f : X \to Y$ and $Y \to S$ be morphisms of schemes, both locally of
finite type. Let $r, e \geq 0$. Let $\mathcal{F}$ be a quasi-coherent
$\mathcal{O}_X$-module of finite type, with
$\dim(\text{Supp}(\mathcal{F}_y)) \leq r$ for all $y \in Y$.
Let $\mathcal{G}$  be a quasi-coherent $\mathcal{O}_Y$-module of finite
type, with $\dim(\text{Supp}(\mathcal{G}_s)) \leq e$ for all $s \in S$.
If $\alpha = [\mathcal{F}/X/Y]_r$ and $\beta = [\mathcal{G}/Y/S]_e$
(Example \ref{example-family-associated-module}) and $\mathcal{F}$
is flat over $Y$, then $\alpha \circ \beta =
[\mathcal{F} \otimes_{\mathcal{O}_X} f^*\mathcal{G}/X/S]_{r + e}$.
\end{lemma}

\begin{proof}
First we observe that $\mathcal{F} \otimes_{\mathcal{O}_X} f^*\mathcal{G}$
is a quasi-coherent $\mathcal{O}_X$-module of finite type.
Let $s \in S$. Observe that
$$
(\mathcal{F} \otimes_{\mathcal{O}_X} f^*\mathcal{G})_s =
\mathcal{F}_s \otimes_{\mathcal{O}_{X_s}} f_s^*\mathcal{G}_s
$$
by right exactness of tensor products. Moreover $\mathcal{F}_s$
is flat over $Y_s$ as a base change of a flat module. Thus the equality
$(\alpha \circ \beta)_s =
[(\mathcal{F} \otimes_{\mathcal{O}_X} f^*\mathcal{G})_s]_{r + e}$
follows from Lemma \ref{lemma-action-coherent}.
\end{proof}

\begin{lemma}
\label{lemma-construction-closed}
Let $f : X \to Y$ and $Y \to S$ be morphisms of schemes, both locally of
finite type. Let $r, e \geq 0$. Let $Z \subset X$ be a closed
subscheme of relative dimension $\leq r$ over $Y$.
Let $W \subset Y$ be a closed subscheme of relative dimension $\leq e$
over $S$. If $\alpha = [Z/X/Y]_r$ and $\beta = [W/Y/S]_e$
(Example \ref{example-family-associated-closed}) and $Z$ is flat over $Y$,
then $\alpha \circ \beta = [Z \times_Y W/X/S]_{r + e}$.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-construction-coherent}
if we take $\mathcal{F} = \mathcal{O}_Z$ and $\mathcal{F} = \mathcal{O}_W$.
\end{proof}

\begin{lemma}
\label{lemma-construction-push-pull}
Let $S$ be a scheme. Let
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
Y' \ar[r]^g & Y
}
$$
be a cartesian diagram of schemes locally of finite type over $S$
with $g$ proper. Let $r, e \geq 0$. Let $\alpha$ be a family of
$r$-cycles on the fibres of $X/Y$. Let $\beta'$ be a family of
$e$-cycles on the fibres of $Y'/S$. Then we have
$f_*(g^*(\alpha) \circ \beta') = \alpha \circ g_*\beta'$.
\end{lemma}

\begin{proof}
Unwinding the definitions, this follows from
Lemma \ref{lemma-action-push-pull}.
\end{proof}

\begin{lemma}
\label{lemma-construction-composition}
Let $(S, \delta)$ be as in Chow Homology, Situation \ref{chow-situation-setup}.
Let $X \to Y \to Z$ be morphisms of schemes locally of finite type over $S$.
Let $r, s, e \geq 0$. Then
$$
(\alpha \circ \beta) \cap \gamma = \alpha \cap (\beta \cap \gamma)
\quad\text{in}\quad Z_{r + s + e}(X)
$$
where $\alpha$ is a family of $r$-cycles on fibres of $X/Y$,
$\beta$ is a family of $s$-cycles on fibres of $Y/Z$, and $\gamma \in Z_e(Z)$.
\end{lemma}

\begin{proof}
Since we are proving an equality of cycles on $X$, we may work locally
on $Z$, see Lemma \ref{lemma-action-opens}. Thus we may assume $Z$
is affine. In particular $\gamma$ is a finite linear combination of prime
cycles. Since $- \cap -$ is linear in the second variable
(Lemma \ref{lemma-action-bilinear}), it suffices
to prove the equality when $\gamma = [W]$ for some integral closed subscheme
$W \subset Z$ of $\delta$-dimension $e$.

\medskip\noindent
Let $z \in W$ be the generic point. Write $\beta_z = \sum m_j[V_j]$
in $Z_s(Y_z)$. Then $\beta \cap \gamma$ is equal to $\sum m_j[\overline{V}_j]$
where $\overline{V}_j \subset Y$ is an integral closed subscheme
mapped by $Y \to Z$ into $W$ with generic fibre $V_j$.
Let $y_j \in V_j$ be the generic point. We may and do view
also as the generic point of $\overline{V}_j$ (mapping to $z$ in $W$).
Write $\alpha_{y_j} = \sum n_{jk} [W_{jk}]$ in $Z_r(X_{y_j})$.
Then $\alpha \cap (\beta \cap \gamma)$ is equal to
$$
\sum m_j n_{jk} [\overline{W}_{jk}]
$$
where $\overline{W}_{jk} \subset X$ is an integral closed subscheme
mapped by $X \to Y$ into $\overline{V}_j$ with generic fibre $W_{jk}$.

\medskip\noindent
On the other hand, let us consider
$$
(\alpha \circ \beta)_z = (Y_z \to Y)^*\alpha \cap \beta_z =
(Y_z \to Y)^*\alpha \cap (\sum m_j [V_j])
$$
By the construction of $- \cap -$ this is equal to the cycle
$$
\sum m_j n_{jk} [(\overline{W}_{jk})_z]
$$
on $X_z$. Thus by definition we obtain
$$
(\alpha \circ \beta) \cap [W] =
\sum m_j n_{jk} [\widetilde{W}_{jk}]
$$
where $\widetilde{W}_{jk} \subset X$ is an integral closed subscheme which
is mapped by $X \to Z$ into $W$ with generic fibre $(\overline{W}_{jk})_z$.
Clearly, we must have $\widetilde{W}_{jk} = \overline{W}_{jk}$
and the proof is complete.
\end{proof}









\section{Composition of relative cycles}
\label{section-compose}

\noindent
Let $S$ be a locally Noetherian scheme. Let $X \to Y$
be a morphism of schemes locally of finite type over $S$.
We are going to define a map
$$
z(X/Y, r) \otimes_\mathbf{Z} z(Y/S, e) \longrightarrow z(X/S, r + e),\quad
\alpha \otimes \beta \longmapsto \alpha \circ \beta
$$
using the construction in Section \ref{section-compose-families}.
We already know the construction is bilinear
(Lemma \ref{lemma-construction-bilinear})
hence we obtain the displayed arrow once we show the following.

\begin{lemma}
\label{lemma-well-defined}
If $\alpha$ and $\beta$ are relative cycles, then so is $\alpha \circ \beta$.
\end{lemma}

\begin{proof}
The formation of $\alpha \circ \beta$ is compatible with base change
by Lemma \ref{lemma-construction-base-change}. Thus we may assume
$S$ is the spectrum of a discrete valuation ring with generic point
$\eta$ and closed point $0$ and we have to show that
$sp_{X/S}((\alpha \circ \beta)_\eta) = (\alpha \circ \beta)_0$.
Since we are trying to prove an equality of cycles, we may
work locally on $Y$ and $X$ (this uses
Lemmas \ref{lemma-construction-opens} and
\ref{lemma-specialization-flat-pullback}
to see that the constructions commute with restriction).
Thus we may assume $X$ and $Y$ are affine.
By Lemma \ref{lemma-get-cycles}
we can find a completely decomposed proper morphism
$g : Y' \to Y$ such that $g^*\alpha$ is in the image of
(\ref{equation-cycle-classes}).

\medskip\noindent
Since the family of morphisms $g_\eta : Y'_\eta \to Y_\eta$
is completely decomposed, we can find $\beta'_\eta \in Z_e(Y'_\eta)$ such that
$\beta_\eta = \sum g_{\eta, *}\beta'_\eta$, see
Chow Homology, Lemma \ref{chow-lemma-envelope}.
Set $\beta'_0 = sp_{Y'/S}(\beta'_\eta)$ so that
$\beta' = (\beta'_\eta, \beta'_0)$ is a relative $e$-cycle on $Y'/S$. Then
$g_*\beta'$ and $\beta$ are relative $e$-cycles
on $Y/S$ (Lemma \ref{lemma-relative-cycle-functoriality})
which have the same value at $\eta$ and hence are equal
(Lemma \ref{lemma-uniqueness-extension}). By linearity
(Lemma \ref{lemma-construction-bilinear})
it suffices to show that $\alpha \circ g_*\beta'$
is a relative $(r + e)$-cycle.

\medskip\noindent
Set $X' = X \times_Y Y'$ and denote $f : X' \to X$ the projection.
By Lemma \ref{lemma-construction-push-pull} we see that
$\alpha \circ g_*\beta' = f_*(g^*\alpha \circ \beta')$.
By Lemma \ref{lemma-relative-cycle-functoriality}
it suffices to show that $g^*\alpha \circ \beta'$
is a relative $(r + e)$-cycle. Using Lemma \ref{lemma-get-cycles-dvr}
and bilinearity this reduces us to the case discussed in the next paragraph.

\medskip\noindent
Assume $\alpha = [Z/X/Y]_r$ and $\beta = [W/Y/S]$
where $Z \subset X$ is a closed subscheme flat and of relative
dimension $\leq r$ over $Y$ and $W \subset Y$ is a closed
subscheme flat and of relative dimension $\leq e$ over $S$.
By Lemma \ref{lemma-construction-closed} we see that
$$
\alpha \circ \beta = [Z \times_X W/X/S]_{r + e}
$$
and $Z \times_X W \subset X$ is a closed subscheme flat over $S$
of relative dimension $\leq r + e$. This is a relative $(r + e)$-cycle by
Lemma \ref{lemma-family-associated-closed-specialization}.
\end{proof}

\begin{lemma}
\label{lemma-composition-fundamental-cycles}
Let $f : X \to Y$ and $g : Y \to S$ be a morphisms of schemes.
Assume $S$ locally Noetherian, $g$ locally of finite type and
flat of relative dimension $e \ge 0$, and $f$ locally of finite type
and flat of relative dimension $r \geq 0$. Then
$[X/X/Y]_r \circ [Y/Y/S]_e = [X/X/S]_{r + e}$ in $z(X/S, r + e)$.
\end{lemma}

\begin{proof}
Special case of Lemma \ref{lemma-construction-closed}.
\end{proof}






\section{Comparison with Suslin and Voevodsky}
\label{section-compare}

\noindent
We have tried to use the same notation as in \cite{SV}, except that
our notation for cycles is taken from
Chow Homology, Section \ref{chow-section-cycles} ff.
Here is a comparison:
\begin{enumerate}
\item In \cite[Section 3.1]{SV} there is a notion of a
``relative cycle'', of a ``relative cycle of dimension $r$'', and
of a ``equidimensional relative cycle of dimension $r$''.
There is no corresponding notion in this chapter. Consequently, the groups
$Cycl(X/S, r)$, $Cycl_{equi}(X/S, r)$,
$PropCycl(X/S, r)$, and $PropCycl_{equi}(X/S, r)$,
have no counter parts in this chapter.
\item On the bottom of \cite[page 36]{SV} the groups
$z(X/S, r)$, $c(X/S, r)$, $z_{equi}(X/S, r)$, $c_{equi}(X/S, r)$
are defined. These agree with our notions when $S$ is separated
Noetherian and $X \to S$ is separated and of finite type.
\item In \cite{SV} the symbol $z(X/S, r)$ is sometimes used for the
presheaf $S' \mapsto z(S' \times_S X/S', r)$ on the category of schemes
of finite type over $S$. Similarly for
$c(X/S, r)$, $z_{equi}(X/S, r)$, and $c_{equi}(X/S, r)$.
\item Base change, flat pullback, and proper pushforward
as defined in \cite{SV} agrees with ours when both apply.
\item For $\alpha \in z(X/S, r)$ the operation
$\alpha \cap - : Z_e(S) \to Z_{e + r}(X)$ defined in
Section \ref{section-action} agrees with
the operation $Cor(\alpha, -)$ in \cite[Section 3.7]{SV}
when both are defined.
\item For $X \to Y \to S$ the composition law
$z(X/Y, r) \otimes_\mathbf{Z} z(Y/S, e) \longrightarrow z(X/S, r + e)$
defined in Section \ref{section-compose}
agrees with the opration $Cor_{X/Y}(-, -)$ in
\cite[Corollary 3.7.5]{SV}.
\end{enumerate}











\section{Relative cycles in the non-Noetherian case}
\label{section-non-noetherian}

\noindent
We urge the reader to skip this section.

\medskip\noindent
Let $f : X \to S$ be a morphism of schemes of finite presentation.
Let $r \geq 0$. Denote $Hilb(X/S, r)$ the set of closed subschemes
$Z \subset X$ such that $Z \to S$ is flat, of finite presentation,
and of relative dimension $\leq r$. We consider the group homomorphism
\begin{equation}
\label{equation-cycle-classes-general}
\begin{matrix}
\text{free abelian group} \\
\text{on }Hilb(X/S, r)
\end{matrix}
\longrightarrow
\begin{matrix}
\text{families of }r\text{-cycles}\\
\text{on fibres of }X/S
\end{matrix}
\end{equation}
sending $\sum n_i[Z_i]$ to $\sum n_i[Z_i/X/S]_r$.

\begin{lemma}
\label{lemma-relative-r-cycle-general}
Let $S$ be a quasi-compact and quasi-separated scheme.
Let $f : X \to S$ be a morphism of finite presentation.
Let $r \geq 0$ and let $\alpha$ be a family of $r$-cycles on fibres of $X/S$.
The following are equivalent
\begin{enumerate}
\item there exists a cartesian diagram
$$
\xymatrix{
X \ar[r] \ar[d] & X_0 \ar[d] \\
S \ar[r] & S_0
}
$$
where $X_0 \to S_0$ is a finite type morphism of Noetherian schemes
and $\alpha_0 \in z(X_0/S_0, r)$ such that $\alpha$ is the base change
of $\alpha_0$ by $S \to S_0$
\item there exists a completely decomposed proper morphism $g : S' \to S$
of finite presentation such that $g^*\alpha$ is in the image of
(\ref{equation-cycle-classes-general}).
\end{enumerate}
\end{lemma}

\begin{proof}
Let a diagram and $\alpha_0 \in z(X_0/S_0, r)$ as in (1) be given.
By Lemma \ref{lemma-get-cycles} there exists a proper surjective
morphism $g_0 : S'_0 \to S_0$ such that $g_0^*\alpha_0$ is in
the image of (\ref{equation-cycle-classes-general}). Namely, since
$S'_0$ is Noetherian, every closed subscheme of $S'_0 \times_{S_0} X_0$
is of finite presentation over $S'_0$. Setting $S' = S \times_{S_0} S'_0$
and using base change by $S' \to S'_0$ we see that (2) holds.

\medskip\noindent
Conversely, assume that (2) holds. Choose a surjective proper morphism
$g : S' \to S$ of finite presentation such that $g^*\alpha$ is in the
image of (\ref{equation-cycle-classes-general}). Set $X' = S' \times_S X$.
Write $g^*\alpha = \sum n_a [Z_a/X'/S']_r$ for some $Z_a \subset X'$
closed subscheme flat, of finite presentation, and of relative dimension
$\leq r$ over $S'$.

\medskip\noindent
Write $S = \lim S_i$ as a directed limit with affine transition
morphisms with $S_i$ of finite type over $\mathbf{Z}$,
see Limits, Proposition \ref{limits-proposition-approximate}.
We can find an $i$ large enough such that there exist
\begin{enumerate}
\item a completely decomposed proper morphism $g_i : S'_i \to S_i$
whose base change to $S$ is $g : S' \to S$,
\item setting $X'_i = S'_i \times_{S_i} X_i$
closed subschemes $Z_{ai} \subset X'_i$ flat and of
relative dimension $\leq r$ over $S'_i$ whose base change to $S'$
is $Z_a$.
\end{enumerate}
To do this one uses Limits, Lemmas
\ref{limits-lemma-descend-finite-presentation},
\ref{limits-lemma-descend-closed-immersion-finite-presentation},
\ref{limits-lemma-descend-flat-finite-presentation},
\ref{limits-lemma-descend-surjective},
\ref{limits-lemma-eventually-proper}, and
\ref{limits-lemma-limit-dimension}
and
and More on Morphisms, Lemma
\ref{more-morphisms-lemma-descend-cd}.
Consider $\alpha'_i = \sum n_a [Z_{ai}/X'_i/S_i]_r \in z(X'_i/S'_i, r)$.
The base change of $\alpha'_i$ to a family of $r$-cycles on fibres
of $X'/S'$ agrees with the base change $g^*\alpha$ by construction.

\medskip\noindent
Set $S''_i = S'_i \times_{S_i} S'_i$ and $X''_i = S''_i \times_{S_i} X_i$
and set $S'' = S' \times_S S'$ and $X'' = S'' \times_S X$.
We denote $\text{pr}_1, \text{pr}_2 : S'' \to S'$ and
$\text{pr}_1, \text{pr}_2 : S''_i \to S'_i$ the projections.
The relative $r$-cycles $\text{pr}_1^*\alpha'_i$ and $\text{pr}_1^*\alpha'_i$
on $X''_i/S''_i$ base change to the same family of $r$-cycles
on fibres of $X''/S''$ because
$\text{pr}_1^*g^*\alpha = \text{pr}_1^*g^*\alpha$.
Hence the morphism $S'' \to S''_i$ maps into $E =
\{s \in S''_i : (\text{pr}_1^*\alpha'_i)_s = (\text{pr}_1^*\alpha'_i)_s\}$.
By Lemma \ref{lemma-relative-cycles-equal} this is a closed subset.
Since $S'' = \lim_{i' \geq i} S''_{i'}$ we see from
Limits, Lemma
\ref{limits-lemma-limit-contained-in-constructible}
that for some $i' \geq i$ the morphism $S''_{i'} \to S''_i$
maps into $E$. Therefore, after replacing $i$ by $i'$, we may assume that
$\text{pr}_1^*\alpha'_i = \text{pr}_1^*\alpha'_i$.
By Lemma \ref{lemma-descend-family}
we obtain a unique family $\alpha_i$
of $r$-cycles on fibres of $X_i/S_i$
with $g_i^*\alpha_i = \alpha'_i$ (this uses that $S'_i \to S_i$
is completely decomposed).
By Lemma \ref{lemma-relative-cycles-h-descent}
we see that $\alpha_i \in z(X_i/S_i, r)$.
The uniqueness in Lemma \ref{lemma-descend-family} implies that the
base change of $\alpha_i$ is $\alpha$ and we see (1) holds.
\end{proof}

\noindent
{\bf Discussion.}
If $f : X \to S$, $r$, and $\alpha$ are as in
Lemma \ref{lemma-relative-r-cycle-general}, then it makes sense to
say that $\alpha$ is a {\it relative $r$-cycle on $X/S$} if
the equivalent conditions
(1) and (2) of Lemma \ref{lemma-relative-r-cycle-general} hold.
This definition has many good properties; for example it
doesn't conflict with the earlier definition in case $S$
is Noetherian and most of the results of
Section \ref{section-families-specialization} generalize
to this setting.

\medskip\noindent
We may still generalize further as follows.
Assume $S$ is arbitrary and $f : X \to S$ is locally of finite presentation.
Let $r \geq 0$ and let $\alpha$ be a family of $r$-cycles $\alpha$ on fibres of
$X/S$. Then $\alpha$ is an {\it relative $r$-cycle on $X/S$} if
for $U \subset X$ and $V \subset S$ affine open with $f(U) \subset V$
the restriction $\alpha|_U$ is a relative $r$-cycle on $U/V$ as
defined in the previous paragraph. Again many of the earlier results
generalize to this setting.

\medskip\noindent
If we ever need these generalizations we will carefully state and prove
them here.



















\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
