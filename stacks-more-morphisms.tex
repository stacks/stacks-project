\input{preamble}

% OK, start here.
%
\begin{document}

\title{More on Morphisms of Stacks}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we continue our study of properties of morphisms of algebraic
stacks. A reference in the case of quasi-separated algebraic stacks with
representable diagonal is \cite{LM-B}.




\section{Conventions and abuse of language}
\label{section-conventions}

\noindent
We continue to use the conventions and the abuse of language
introduced in
Properties of Stacks, Section \ref{stacks-properties-section-conventions}.






\section{Thickenings}
\label{section-thickenings}

\noindent
The following terminology may not be completely standard, but it is convenient.
If $\mathcal{Y}$ is a closed substack of an algebraic stack $\mathcal{X}$,
then the morphism $\mathcal{Y} \to \mathcal{X}$ is representable.

\begin{definition}
\label{definition-thickening}
Thickenings.
\begin{enumerate}
\item We say an algebraic stack $\mathcal{X}'$ is a {\it thickening}
of an algebraic stack $\mathcal{X}$ if $\mathcal{X}$ is a closed substack
of $\mathcal{X}'$ and the associated topological spaces are equal.
\item Given two thickenings $\mathcal{X} \subset \mathcal{X}'$ and
$\mathcal{Y} \subset \mathcal{Y}'$ a {\it morphism of thickenings}
is a morphism $f' : \mathcal{X}' \to \mathcal{Y}'$ of algebraic stacks
such that $f'|_\mathcal{X}$ factors through the closed
substack $\mathcal{Y}$. In this situation we set
$f = f'|_\mathcal{X} : \mathcal{X} \to \mathcal{Y}$ and we say that
$(f, f') : (\mathcal{X} \subset \mathcal{X}') \to
(\mathcal{Y} \subset \mathcal{Y}')$ is a morphism of thickenings.
\item Let $\mathcal{Z}$ be an algebraic stack. We similarly define
{\it thickenings over $\mathcal{Z}$} and
{\it morphisms of thickenings over $\mathcal{Z}$}.
This means that the algebraic stacks
$\mathcal{X}'$ and $\mathcal{Y}'$
are algebraic stack endowed with a structure
morphism to $\mathcal{Z}$ and that $f'$ fits into a suitable
$2$-commutative diagram of algebraic stacks.
\end{enumerate}
\end{definition}

\noindent
Let $\mathcal{X} \subset \mathcal{X}'$ be a thickening of algebraic stacks.
Let $U'$ be a scheme and let $U' \to \mathcal{X}'$ be a surjective smooth
morphism. Setting $U = \mathcal{X} \times_{\mathcal{X}'} U'$ we obtain
a morphism of thickenings
$$
(U \subset U') \longrightarrow (\mathcal{X} \subset \mathcal{X}')
$$
and $U \to \mathcal{X}$ is a surjective smooth morphism. We can often
deduce properties of the thickening $\mathcal{X} \subset \mathcal{X}'$
from the corresponding properties of the thickening $U \subset U'$.
Sometimes, by abuse of language, we say that a morphism
$\mathcal{X} \to \mathcal{X}'$ is a thickening if it is a closed
immersion inducing a bijection $|\mathcal{X}| \to |\mathcal{X}'|$.

\begin{lemma}
\label{lemma-thickening}
Let $i : \mathcal{X} \to \mathcal{X}'$ be a morphism of algebraic stacks.
The following are equivalent
\begin{enumerate}
\item $i$ is a thickening of algebraic stacks (abuse of language as above), and
\item $i$ is representable by algebraic spaces and
is a thickening in the sense of Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}.
\end{enumerate}
In this case $i$ is a closed immersion and a universal homeomorphism.
\end{lemma}

\begin{proof}
By More on Morphisms of Spaces, Lemmas
\ref{spaces-more-morphisms-lemma-descending-property-thickening} and
\ref{spaces-more-morphisms-lemma-base-change-thickening}
the property $P$ that a morphism of algebraic spaces is a
(first order) thickening is fpqc local on the base and stable under base
change. Thus the discussion in Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms} indeed applies.
Having said this the equivalence of (1) and (2) follows from
the fact that $P = P_1 + P_2$ where $P_1$ is the property of being
a closed immersion and $P_2$ is the property of being surjective.
(Strictly speaking, the reader should also consult
More on Morphisms of Spaces, Definition
\ref{spaces-more-morphisms-definition-thickening},
Properties of Stacks, Definition \ref{stacks-properties-definition-immersion}
and the discussion following, Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-surjective-representable},
Properties of Stacks, Section \ref{stacks-properties-section-surjective}
to see that all the concepts all match up.)
The final assertion is clear from the foregoing.
\end{proof}

\noindent
We will use the lemma without further mention. Using the same references
More on Morphisms of Spaces, Lemmas
\ref{spaces-more-morphisms-lemma-descending-property-thickening} and
\ref{spaces-more-morphisms-lemma-base-change-thickening}
as used in the lemma, allows us to define a first order thickening as follows.

\begin{definition}
\label{definition-first-order-thickening}
We say an algebraic stack $\mathcal{X}'$ is a {\it first order thickening}
of an algebraic stack $\mathcal{X}$ if $\mathcal{X}$ is a closed substack
of $\mathcal{X}'$ and $\mathcal{X} \to \mathcal{X}'$ is a first order
thickening in the sense of Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}.
\end{definition}

\noindent
If $(U \subset U') \to (\mathcal{X} \subset \mathcal{X}')$ is a smooth
cover by a scheme as above, then this simply means that $U \subset U'$
is a first order thickening. Next we formulate the obligatory lemmas.

\begin{lemma}
\label{lemma-base-change-thickening}
Let $\mathcal{Y} \subset \mathcal{Y}'$ be a thickening of algebraic stacks.
Let $\mathcal{X}' \to \mathcal{Y}'$ be a morphism of algebraic stacks
and set $\mathcal{X} = \mathcal{Y} \times_{\mathcal{Y}'} \mathcal{X}'$.
Then
$(\mathcal{X} \subset \mathcal{X}') \to (\mathcal{Y} \subset \mathcal{Y}')$
is a morphism of thickenings. If $\mathcal{Y} \subset \mathcal{Y}'$ is a first
order thickening, then $\mathcal{X} \subset \mathcal{X}'$ is a first
order thickening.
\end{lemma}

\begin{proof}
See discussion above, Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}, and
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-base-change-thickening}.
\end{proof}

\begin{lemma}
\label{lemma-composition-thickening}
If $\mathcal{X} \subset \mathcal{X}'$ and $\mathcal{X}' \subset \mathcal{X}''$
are thickenings of algebraic stacks, then so is
$\mathcal{X} \subset \mathcal{X}''$.
\end{lemma}

\begin{proof}
See discussion above, Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}, and
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-composition-thickening}
\end{proof}

\begin{example}
\label{example-reduction-thickening}
Let $\mathcal{X}'$ be an algebraic stack. Then $\mathcal{X}'$ is a thickening
of the reduction $\mathcal{X}'_{red}$, see
Properties of Stacks, Definition
\ref{stacks-properties-definition-reduced-induced-stack}.
Moreover, if $\mathcal{X} \subset \mathcal{X}'$ is a thickening
of algebraic stacks, then
$\mathcal{X}'_{red} = \mathcal{X}_{red} \subset \mathcal{X}$.
In other words, $\mathcal{X} = \mathcal{X}'_{red}$ if and only
if $\mathcal{X}$ is a reduced algebraic stack.
\end{example}

\begin{lemma}
\label{lemma-reduced-diagonal}
Let $(f, f') : (\mathcal{X} \subset \mathcal{X}') \to
(\mathcal{Y} \subset \mathcal{Y}')$ be a morphism of thickenings
of algebraic stacks. Then
$\mathcal{X} \times_\mathcal{Y} \mathcal{X} \to
\mathcal{X}' \times_{\mathcal{Y}'} \mathcal{X}'$
is a thickening and the canonical diagram
$$
\xymatrix{
\mathcal{X} \ar[r]_-\Delta \ar[d] &
\mathcal{X} \times_\mathcal{Y} \mathcal{X} \ar[d] \\
\mathcal{X}' \ar[r]^-{\Delta'} &
\mathcal{X}' \times_{\mathcal{Y}'} \mathcal{X}'
}
$$
is cartesian.
\end{lemma}

\begin{proof}
Since $\mathcal{X} \to \mathcal{Y}'$ factors through the closed
substack $\mathcal{Y}$ we see that
$\mathcal{X} \times_\mathcal{Y} \mathcal{X} =
\mathcal{X} \times_{\mathcal{Y}'} \mathcal{X}$.
Hence
$\mathcal{X} \times_\mathcal{Y} \mathcal{X} \to
\mathcal{X}' \times_{\mathcal{Y}'} \mathcal{X}'$
is isomorphic to the composition
$$
\mathcal{X} \times_{\mathcal{Y}'} \mathcal{X} \to
\mathcal{X} \times_{\mathcal{Y}'} \mathcal{X}' \to
\mathcal{X}' \times_{\mathcal{Y}'} \mathcal{X}'
$$
both of which are thickenings as base changes of thickenings
(Lemma \ref{lemma-base-change-thickening}).
Hence so is the composition
(Lemma \ref{lemma-composition-thickening}).
Since $\mathcal{X} \to \mathcal{X}'$ is a monomorphism,
the final statement of the lemma follows from
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-monomorphism-diagonal}
applied to $\mathcal{X} \to \mathcal{X}' \to \mathcal{Y}'$.
\end{proof}

\begin{lemma}
\label{lemma-thickening-diagonals}
Let $(f, f') : (\mathcal{X} \subset \mathcal{X}') \to
(\mathcal{Y} \subset \mathcal{Y}')$ be a morphism of thickenings
of algebraic stacks.
Let $\Delta : \mathcal{X} \to \mathcal{X} \times_\mathcal{Y} \mathcal{X}$ and
$\Delta' : \mathcal{X}' \to \mathcal{X}' \times_{\mathcal{Y}'} \mathcal{X}'$
be the corresponding diagonal morphisms.
Then each property from the following list is satisfied by $\Delta$ if
and only if it is satisfied by $\Delta'$:
(a) representable by schemes, (b) affine, (c) surjective, (d) quasi-compact,
(e) universally closed, (f) integral, (g) quasi-separated, (h) separated,
(i) universally injective, (j) universally open, (k) locally quasi-finite,
(l) finite, (m) unramified, (n) monomorphism, (o) immersion,
(p) closed immersion, and (q) proper.
\end{lemma}

\begin{proof}
Observe that
$$
(\Delta, \Delta') :
(\mathcal{X} \subset \mathcal{X}')
\longrightarrow
(\mathcal{X} \times_\mathcal{Y} \mathcal{X} \subset
\mathcal{X}' \times_{\mathcal{Y}'} \mathcal{X}')
$$
is a morphism of thickenings (Lemma \ref{lemma-reduced-diagonal}).
Moreover $\Delta$ and $\Delta'$ are
representable by algebraic spaces by
Morphisms of Stacks, Lemma \ref{stacks-morphisms-lemma-properties-diagonal}.
Hence, via the discussion in
Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}
the lemma follows for cases (a), (b), (c), (d),
(e), (f), (g), (h), (i), and (j) by using
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-thicken-property-morphisms}.

\medskip\noindent
Lemma \ref{lemma-reduced-diagonal} tells us that
$\mathcal{X} = (\mathcal{X} \times_\mathcal{Y} \mathcal{X})
\times_{(\mathcal{X}' \times_{\mathcal{Y}'} \mathcal{X}')} \mathcal{X}'$.
Moreover, $\Delta$ and $\Delta'$ are locally of finite type by
the aforementioned
Morphisms of Stacks, Lemma \ref{stacks-morphisms-lemma-properties-diagonal}.
Hence the result for cases (k), (l), (m), (n), (o), (p), and (q) by using
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-properties-that-extend-over-thickenings}.
\end{proof}

\noindent
As a consequence we obtain the following pleasing result.

\begin{lemma}
\label{lemma-thickening-properties}
\begin{reference}
\cite[Theorem 2.2.5]{Conrad-moduli}
\end{reference}
Let $\mathcal{X} \subset \mathcal{X}'$ be a thickening of algebraic
stacks. Then
\begin{enumerate}
\item $\mathcal{X}$ is an algebraic space if and only if $\mathcal{X}'$
is an algebraic space,
\item $\mathcal{X}$ is a scheme if and only if $\mathcal{X}'$ is a scheme,
\item $\mathcal{X}$ is DM if and only if $\mathcal{X}'$ is DM,
\item $\mathcal{X}$ is quasi-DM if and only if $\mathcal{X}'$ is quasi-DM,
\item $\mathcal{X}$ is separated if and only if $\mathcal{X}'$ is separated,
\item $\mathcal{X}$ is quasi-separated if and only if $\mathcal{X}'$ is
quasi-separated, and
\item add more here.
\end{enumerate}
\end{lemma}

\begin{proof}
In each case we reduce to a question about the diagonal and then
we use Lemma \ref{lemma-thickening-diagonals} applied to the
morphism of thickenings
$$
(\mathcal{X} \subset \mathcal{X}') \to
\left(\Spec(\mathbf{Z}) \subset \Spec(\mathbf{Z})\right)
$$
We do this after viewing
$\mathcal{X} \subset \mathcal{X}'$ as a thickening of algebraic stacks
over $\Spec(\mathbf{Z})$ via
Algebraic Stacks, Definition \ref{algebraic-definition-viewed-as}.

\medskip\noindent
Case (1). An algebraic stack is an algebraic space if and only if its
diagonal is a monomorphism, see
Morphisms of Stacks, Lemma \ref{stacks-morphisms-lemma-hierarchy}
(this also follows immediately from Algebraic Stacks,
Proposition \ref{algebraic-proposition-algebraic-stack-no-automorphisms}).

\medskip\noindent
Case (2). By (1) we may assume that $\mathcal{X}$ and $\mathcal{X}'$
are algebraic spaces and then we can use
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-thickening-scheme}.

\medskip\noindent
Case (3) -- (6). Each of these cases corresponds to a condition
on the diagonal, see Morphisms of Stacks, Definitions
\ref{stacks-morphisms-definition-separated} and
\ref{stacks-morphisms-definition-absolute-separated}.
\end{proof}









\section{Morphisms of thickenings}
\label{section-morphisms-thickenings}

\noindent
If $(f, f') : (\mathcal{X} \subset \mathcal{X}') \to
(\mathcal{Y} \subset \mathcal{Y}')$ is a morphism
of thickenings of algebraic stacks, then often properties of the morphism
$f$ are inherited by $f'$. There are several variants.

\begin{lemma}
\label{lemma-thicken-property-morphisms}
Let $(f, f') : (\mathcal{X} \subset \mathcal{X}') \to
(\mathcal{Y} \subset \mathcal{Y}')$
be a morphism of thickenings of algebraic stacks. Then
\begin{enumerate}
\item $f$ is an affine morphism if and only if $f'$ is an affine morphism,
\item $f$ is a surjective morphism if and only if $f'$ is a surjective morphism,
\item $f$ is quasi-compact if and only if $f'$ quasi-compact,
\item $f$ is universally closed if and only if $f'$ is universally closed,
\item $f$ is integral if and only if $f'$ is integral,
\item $f$ is universally injective if and only if $f'$ is universally injective,
\item $f$ is universally open if and only if $f'$ is universally open,
\item $f$ is quasi-DM if and only if $f'$ is quasi-DM,
\item $f$ is DM if and only if $f'$ is DM,
\item $f$ is (quasi-)separated if and only if $f'$ is (quasi-)separated,
\item $f$ is representable if and only if $f'$ is representable,
\item $f$ is representable by algebraic spaces if and only if $f'$ is
representable by algebraic spaces,
\item add more here.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-thickening} the morphisms $\mathcal{X} \to \mathcal{X}'$
and $\mathcal{Y} \to \mathcal{Y}'$ are universal homeomorphisms. Thus any
condition on $|f| : |\mathcal{X}| \to |\mathcal{Y}|$ is equivalent with
the corresponding condition on $|f'| : |\mathcal{X}'| \to |\mathcal{Y}'|$
and the same is true after arbitrary base change by a morphism
$\mathcal{Z}' \to \mathcal{Y}'$. This proves that
(2), (3), (4), (6), (7) hold.

\medskip\noindent
In cases (8), (9), (10), (12) we can translate the conditions on
$f$ and $f'$ into conditions on the diagonals $\Delta$ and $\Delta'$
as in Lemma \ref{lemma-thickening-diagonals}. See
Morphisms of Stacks, Definition \ref{stacks-morphisms-definition-separated} and
Lemma \ref{stacks-morphisms-lemma-hierarchy}.
Hence these cases follow from Lemma \ref{lemma-thickening-diagonals}.

\medskip\noindent
Proof of (11). If $f'$ is representable, then so is $f$, because
for a scheme $T$ and a morphism $T \to \mathcal{Y}$ we have
$\mathcal{X} \times_\mathcal{Y} T =
\mathcal{X} \times_{\mathcal{X}'} (\mathcal{X}' \times_{\mathcal{Y}'} T)$
and $\mathcal{X} \to \mathcal{X}'$ is a closed immersion (hence representable).
Conversely, assume $f$ is representable, and let $T' \to \mathcal{Y}'$
be a morphism where $T'$ is a scheme. Then
$$
\mathcal{X} \times_{\mathcal{Y}}
(\mathcal{Y} \times_{\mathcal{Y}'} T') =
\mathcal{X} \times_{\mathcal{X}'}
(\mathcal{X}' \times_{\mathcal{Y}'} T') \to
\mathcal{X}' \times_{\mathcal{Y}'} T'
$$
is a thickening (by Lemma \ref{lemma-base-change-thickening})
and the source is a scheme. Hence the target is a scheme by
Lemma \ref{lemma-thickening-properties}.

\medskip\noindent
In cases (1) and (5) if either $f$ or $f'$ has the stated property,
then both $f$ and $f'$ are representable by (11). In this case
choose an algebraic space $V'$ and a surjective smooth morphism
$V' \to \mathcal{Y}'$. Set $V = \mathcal{Y} \times_{\mathcal{Y}'} V'$,
$U' = \mathcal{X}' \times_{\mathcal{Y}'} V'$, and
$U = \mathcal{X} \times_{\mathcal{Y}'} V'$. Then the desired
results follow from the corresponding results for
the morphism $(U \subset U') \to (V \subset V')$ of thickenings
of algebraic spaces via the principle of Properties of Stacks, Lemma
\ref{stacks-properties-lemma-check-property-covering}.
See More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-thicken-property-morphisms}
for the corresponding results in the case of algebraic spaces.
\end{proof}





\section{Infinitesimal deformations of algebraic stacks}
\label{section-deform}

\noindent
This section is the analogue of
More on Morphisms of Spaces, Section
\ref{spaces-more-morphisms-section-deform}.

\begin{lemma}
\label{lemma-flatness-morphism-thickenings-fp-over-ft}
Consider a commutative diagram
$$
\xymatrix{
(\mathcal{X} \subset \mathcal{X}') \ar[rr]_{(f, f')} \ar[rd] & &
(\mathcal{Y} \subset \mathcal{Y}') \ar[ld] \\
& (\mathcal{B} \subset \mathcal{B}')
}
$$
of thickenings of algebraic stacks. Assume
\begin{enumerate}
\item $\mathcal{Y}' \to \mathcal{B}'$ is locally of finite type,
\item $\mathcal{X}' \to \mathcal{B}'$ is
flat and locally of finite presentation,
\item $f$ is flat, and
\item $\mathcal{X} = \mathcal{B} \times_{\mathcal{B}'} \mathcal{X}'$ and
$\mathcal{Y} = \mathcal{B} \times_{\mathcal{B}'} \mathcal{Y}'$.
\end{enumerate}
Then $f'$ is flat and for all $y' \in |\mathcal{Y}'|$ in the image of $|f'|$
the morphism $\mathcal{Y}' \to \mathcal{B}'$ is flat at $y'$.
\end{lemma}

\begin{proof}
Choose an algebraic space $U'$ and a surjective smooth morphism
$U' \to \mathcal{B}'$.
Choose an algebraic space $V'$ and a surjective smooth morphism
$V' \to U' \times_{\mathcal{B}'} \mathcal{Y}'$.
Choose an algebraic space $W'$ and a surjective smooth morphism
$W' \to V' \times_{\mathcal{Y}'} \mathcal{X}'$. Let $U, V, W$
be the base change of $U', V', W'$ by $\mathcal{B} \to \mathcal{B}'$.
Then flatness of $f'$ is equivalent to flatness of $W' \to V'$ and
we are given that $W \to V$ is flat. Hence we may apply the lemma
in the case of algebraic spaces to the diagram
$$
\xymatrix{
(W \subset W') \ar[rr] \ar[rd] & & (V \subset V') \ar[ld] \\
& (U \subset U')
}
$$
of thickenings of algebraic spaces. See
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-flatness-morphism-thickenings-fp-over-ft}.
The statement about flatness of $\mathcal{Y}'/\mathcal{B}'$ at points in the
image of $|f'|$ follows in the same manner.
\end{proof}

\begin{lemma}
\label{lemma-deform-property-fp-over-ft}
Consider a commutative diagram
$$
\xymatrix{
(\mathcal{X} \subset \mathcal{X}') \ar[rr]_{(f, f')} \ar[rd] & &
(\mathcal{Y} \subset \mathcal{Y}') \ar[ld] \\
& (\mathcal{B} \subset \mathcal{B}')
}
$$
of thickenings of algebraic stacks.
Assume $\mathcal{Y}' \to \mathcal{B}'$ locally of finite type,
$\mathcal{X}' \to \mathcal{B}'$ flat and locally of finite presentation,
$\mathcal{X} = \mathcal{B} \times_{\mathcal{B}'} \mathcal{X}'$, and
$\mathcal{Y} = \mathcal{B} \times_{\mathcal{B}'} \mathcal{Y}'$. Then
\begin{enumerate}
\item $f$ is flat if and only if $f'$ is flat,
\label{item-flat-fp-over-ft}
\item $f$ is an isomorphism if and only if $f'$ is an isomorphism,
\label{item-isomorphism-fp-over-ft}
\item $f$ is an open immersion if and only if $f'$ is an open immersion,
\label{item-open-immersion-fp-over-ft}
\item $f$ is a monomorphism if and only if $f'$ is a monomorphism,
\label{item-monomorphism-fp-over-ft}
\item $f$ is locally quasi-finite if and only if $f'$ is locally quasi-finite,
\label{item-quasi-finite-fp-over-ft}
\item $f$ is syntomic if and only if $f'$ is syntomic,
\label{item-syntomic-fp-over-ft}
\item $f$ is smooth if and only if $f'$ is smooth,
\label{item-smooth-fp-over-ft}
\item $f$ is unramified if and only if $f'$ is unramified,
\label{item-unramified-fp-over-ft}
\item $f$ is \'etale if and only if $f'$ is \'etale,
\label{item-etale-fp-over-ft}
\item $f$ is finite if and only if $f'$ is finite, and
\label{item-finite-fp-over-ft}
\item add more here.
\end{enumerate}
\end{lemma}

\begin{proof}
In case (\ref{item-flat-fp-over-ft}) this follows from
Lemma \ref{lemma-flatness-morphism-thickenings-fp-over-ft}.

\medskip\noindent
In cases
(\ref{item-syntomic-fp-over-ft}), (\ref{item-smooth-fp-over-ft})
this can be proved by the method used in the proof of
Lemma \ref{lemma-flatness-morphism-thickenings-fp-over-ft}.
Namely, choose an algebraic space $U'$ and a surjective smooth morphism
$U' \to \mathcal{B}'$.
Choose an algebraic space $V'$ and a surjective smooth morphism
$V' \to U' \times_{\mathcal{B}'} \mathcal{Y}'$.
Choose an algebraic space $W'$ and a surjective smooth morphism
$W' \to V' \times_{\mathcal{Y}'} \mathcal{X}'$. Let $U, V, W$
be the base change of $U', V', W'$ by $\mathcal{B} \to \mathcal{B}'$.
Then the property for $f$, resp.\ $f'$
is equivalent to the property for of $W' \to V'$, resp.\ $W \to V$.
Hence we may apply the lemma in the case of algebraic spaces to the
diagram
$$
\xymatrix{
(W \subset W') \ar[rr] \ar[rd] & & (V \subset V') \ar[ld] \\
& (U \subset U')
}
$$
of thickenings of algebraic spaces. See
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-deform-property-fp-over-ft}.

\medskip\noindent
In cases (\ref{item-unramified-fp-over-ft}) and (\ref{item-etale-fp-over-ft})
we first see that the assumption for $f$ or $f'$ implies that both
$f$ and $f'$ are DM morphisms of algebraic stacks, see
Lemma \ref{lemma-thicken-property-morphisms}. Then we can choose
an algebraic space $U'$ and a surjective smooth morphism
$U' \to \mathcal{B}'$.
Choose an algebraic space $V'$ and a surjective smooth morphism
$V' \to U' \times_{\mathcal{B}'} \mathcal{Y}'$.
Choose an algebraic space $W'$ and a surjective \'etale(!) morphism
$W' \to V' \times_{\mathcal{Y}'} \mathcal{X}'$. Let $U, V, W$
be the base change of $U', V', W'$ by $\mathcal{B} \to \mathcal{B}'$.
Then $W \to V \times_\mathcal{Y} \mathcal{X}$ is surjective
\'etale as well. Hence the property for $f$, resp.\ $f'$
is equivalent to the property for of $W' \to V'$, resp.\ $W \to V$.
Hence we may apply the lemma in the case of algebraic spaces to the
diagram
$$
\xymatrix{
(W \subset W') \ar[rr] \ar[rd] & & (V \subset V') \ar[ld] \\
& (U \subset U')
}
$$
of thickenings of algebraic spaces. See
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-deform-property-fp-over-ft}.

\medskip\noindent
In cases (\ref{item-isomorphism-fp-over-ft}),
(\ref{item-open-immersion-fp-over-ft}),
(\ref{item-monomorphism-fp-over-ft}),
(\ref{item-finite-fp-over-ft})
we first conclude by Lemma \ref{lemma-thicken-property-morphisms}
that $f$ and $f'$ are representable by algebraic spaces. Thus we may choose
an algebraic space $U'$ and a surjective smooth morphism
$U' \to \mathcal{B}'$,
an algebraic space $V'$ and a surjective smooth morphism
$V' \to U' \times_{\mathcal{B}'} \mathcal{Y}'$, and then
$W' = V' \times_{\mathcal{Y}'} \mathcal{X}'$ will be an algebraic space.
Let $U, V, W$ be the base change of
$U', V', W'$ by $\mathcal{B} \to \mathcal{B}'$.
Then $W = V \times_\mathcal{Y} \mathcal{X}$ as well.
Then we have to see that $W' \to V'$ is an
isomorphism, resp.\ an open immersion, resp.\ a monomorphism,
resp.\ finite, if and only if $W \to V$ has the same property.
See Properties of Stacks, Lemma
\ref{stacks-properties-lemma-check-property-covering}.
Thus we conclude by applying the results
for algebraic spaces as above.

\medskip\noindent
In the case (\ref{item-quasi-finite-fp-over-ft}) we first
observe that $f$ and $f'$ are locally of finite type by
Morphisms of Stacks, Lemma \ref{stacks-morphisms-lemma-finite-type-permanence}.
On the other hand, the morphism $f$ is quasi-DM if and only if
$f'$ is by
Lemma \ref{lemma-thicken-property-morphisms}.
The last thing to check to see if $f$ or $f'$ is locally quasi-finite
(Morphisms of Stacks, Definition
\ref{stacks-morphisms-definition-quasi-finite})
is a condition on underlying topological spaces
which holds for $f$ if and only if it holds for $f'$ by
the discussion in the first paragraph of the proof.
\end{proof}









\section{Lifting affines}
\label{section-lifting-affines}

\noindent
Consider a solid diagram
$$
\xymatrix{
W \ar[d] \ar@{..>}[r] & W' \ar@{..>}[d] \\
\mathcal{X} \ar[r] & \mathcal{X}'
}
$$
where $\mathcal{X} \subset \mathcal{X}'$ is a thickening of algebraic stacks,
$W$ is an affine scheme and $W \to \mathcal{X}$ is smooth. The question
we address in this section is whether we can find $W'$ and the dotted
arrows so that the square is cartesian and $W' \to \mathcal{X}'$ is smooth.
We do not know the answer in general, but if $\mathcal{X} \subset \mathcal{X}'$
is a first order thickening we will prove the answer is yes.

\medskip\noindent
To study this problem we introduce the following category.

\begin{remark}[Category of lifts]
\label{remark-gerbe-of-lifts}
Consider a diagram
$$
\xymatrix{
W \ar[d]_x \\
\mathcal{X} \ar[r] & \mathcal{X}'
}
$$
where $\mathcal{X} \subset \mathcal{X}'$ is a thickening of algebraic stacks,
$W$ is an algebraic space, and $W \to \mathcal{X}$ is smooth.
We will construct a category $\mathcal{C}$ and a functor
$$
p : \mathcal{C} \longrightarrow W_{spaces, \etale}
$$
(see Properties of Spaces, Definition
\ref{spaces-properties-definition-spaces-etale-site} for notation)
as follows. An object of $\mathcal{C}$ will be a system
$(U, U', a, i, y', \alpha)$
which forms a commutative diagram
\begin{equation}
\label{equation-object}
\vcenter{
\xymatrix{
U \ar[d]_a \ar[r]_i & U' \ar[dd]^{x'} \\
W \ar[d]_x & \\
\mathcal{X} \ar[r] & \mathcal{X}'
}
}
\end{equation}
with commutativity witnessed by the $2$-morphism
$\alpha : x \circ a \to x' \circ i$ such that
$U$ and $U'$ are algebraic spaces,
$a : U \to W$ is \'etale, $x' : U' \to \mathcal{X}'$ is smooth,
and such that $U = \mathcal{X} \times_{\mathcal{X}'} U'$.
In particular $U \subset U'$ is a thickening.
A morphism
$$
(U, U', a, i, x', \alpha) \to (V, V', b, j, y', \beta)
$$
is given by $(f, f', \gamma)$ where $f : U \to V$ is a morphism
over $W$, $f' : U' \to V'$ is a morphism whose restriction
to $U$ gives $f$, and $\gamma : x' \circ f' \to y'$ is a $2$-morphism
witnessing the commutativity in right triangle of the diagram below
\begin{equation}
\label{equation-morphism}
\vcenter{
\xymatrix{
& V \ar[ld]_f \ar[ldd]^b \ar[rr]_j & & V' \ar[ld]_{f'} \ar[lddd]^{y'} \\
U \ar[d]_a \ar[rr]_i & & U' \ar[dd]_{x'} \\
W \ar[d]_x & \\
\mathcal{X} \ar[rr] & & \mathcal{X}'
}
}
\end{equation}
Finally, we require that $\gamma$ is compatible with $\alpha$ and $\beta$:
in the calculus of $2$-categories of Categories, Sections
\ref{categories-section-formal-cat-cat} and
\ref{categories-section-2-categories} this reads
$$
\beta = (\gamma \star \text{id}_j) \circ (\alpha \star \text{id}_f)
$$
(more succinctly: $\beta = j^*\gamma \circ f^*\alpha$).
Another formulation is that objects are commutative diagrams
(\ref{equation-object}) with some additional properties and
morphisms are commutative diagrams
(\ref{equation-morphism}) in the category $\textit{Spaces}/\mathcal{X}'$
introduced in Properties of Stacks, Remark
\ref{stacks-properties-remark-representable-over}.
This makes it clear that $\mathcal{C}$ is a category
and that the rule $p : \mathcal{C} \to W_{spaces, \etale}$
sending $(U, U', a, i, x', \alpha)$ to $a : U \to W$
is a functor.
\end{remark}

\begin{lemma}
\label{lemma-morphisms-lifts-etale}
For any morphism (\ref{equation-morphism}) the map $f' : V' \to U'$ is \'etale.
\end{lemma}

\begin{proof}
Namely $f : V \to U$ is \'etale as a morphism in $W_{spaces, \etale}$
and we can apply
Lemma \ref{lemma-deform-property-fp-over-ft} because $U' \to \mathcal{X}'$
and $V' \to \mathcal{X}'$ are smooth and
$U = \mathcal{X} \times_{\mathcal{X}'} U'$ and
$V = \mathcal{X} \times_{\mathcal{X}'} V'$.
\end{proof}

\begin{lemma}
\label{lemma-gerbe-of-lifts-fibred}
The category $p : \mathcal{C} \to W_{spaces, \etale}$ constructed
in Remark \ref{remark-gerbe-of-lifts} is fibred in groupoids.
\end{lemma}

\begin{proof}
We claim the fibre categories of $p$ are groupoids.
If $(f, f', \gamma')$ as in (\ref{equation-morphism})
is a morphism such that $f : U \to V$ is an isomorphism, then
$f'$ is an isomorphism by Lemma \ref{lemma-deform-property-fp-over-ft}
and hence $(f, f', \gamma')$ is an isomorphism.

\medskip\noindent
Consider a morphism $f : V \to U$ in $W_{spaces, \etale}$
and an object $\xi = (U, U', a, i, x', \alpha)$
of $\mathcal{C}$ over $U$. We are going to construct the ``pullback''
$f^*\xi$ over $V$. 
Namely, set $b = a \circ f$. Let $f' : V' \to U'$ be the \'etale morphism
whose restriction to $V$ is $f$ (More on Morphisms of Spaces,
Lemma \ref{spaces-more-morphisms-lemma-topological-invariance}).
Denote $j : V \to V'$ the corresponding thickening.
Let $y' = x' \circ f'$ and $\gamma = \text{id} : x' \circ f' \to y'$.
Set
$$
\beta = \alpha \star \text{id}_f :
x \circ b = x \circ a \circ f \to
x' \circ i \circ f = x' \circ f' \circ j = y' \circ j
$$
It is clear that $(f, f', \gamma) : (V, V', b, j, y', \beta) \to
(U, U', a, i, x', \alpha)$ is a morphism as in
(\ref{equation-morphism}). The morphisms $(f, f', \gamma)$
so constructed are strongly cartesian
(Categories, Definition \ref{categories-definition-cartesian-over-C}).
We omit the detailed proof, but essentially the reason is that
given a morphism
$(g, g', \epsilon) : (Y, Y', c, k, z', \delta) \to (U, U', a, i, x', \alpha)$
in $\mathcal{C}$ such that $g$ factors as $g = f \circ h$ for some
$h : Y \to V$, then we get a unique factorization $g' = f' \circ h'$
from More on Morphisms of Spaces,
Lemma \ref{spaces-more-morphisms-lemma-topological-invariance}
and after that one can produce the necessary $\zeta$ such that
$(h, h', \zeta) :  (Y, Y', c, k, z', \delta) \to
(V, V', b, j, y', \beta)$ is a morphism of $\mathcal{C}$
with $(g, g', \epsilon) = (f, f', \gamma) \circ (h, h', \zeta)$.

\medskip\noindent
Therefore $p : \mathcal{C} \to W_\etale$ is a fibred
category (Categories, Definition \ref{categories-definition-fibred-category}).
Combined with the fact that the fibre categories are groupoids
seen above we conclude that $p : \mathcal{C} \to W_\etale$
is fibred in groupoids by Categories, Lemma
\ref{categories-lemma-fibred-groupoids}.
\end{proof}

\begin{lemma}
\label{lemma-gerbe-of-lifts-stack}
The category $p : \mathcal{C} \to W_{spaces, \etale}$ constructed
in Remark \ref{remark-gerbe-of-lifts} is a stack in groupoids.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-gerbe-of-lifts-fibred} we see the first condition
of Stacks, Definition \ref{stacks-definition-stack-in-groupoids} holds.
As is customary we check descent of objects and we leave it to the reader
to check descent of morphisms. Thus suppose we have $a : U \to W$
in $W_{spaces, \etale}$, a covering $\{U_k \to U\}_{k \in K}$ in
$W_{spaces, \etale}$, objects $\xi_k = (U_k, U'_k, a_k, i_k, x'_k, \alpha_k)$
of $\mathcal{C}$ over $U_k$, and morphisms
$$
\varphi_{kk'} = (f_{kk'}, f'_{kk'}, \gamma_{kk'}) :
\xi_k|_{U_k \times_U U_{k'}} \to
\xi_{k'}|_{U_k \times_U U_{k'}}
$$
between restrictions satisfying the cocycle condition. In order to prove
effectivity we may first refine the covering. Hence we may assume each
$U_k$ is a scheme (even an affine scheme if you like). Let us write
$$
\xi_k|_{U_k \times_U U_{k'}} =
(U_k \times_U U_{k'}, U'_{kk'}, a_{kk'}, x'_{kk'}, \alpha_{kk'})
$$
Then we get an \'etale (by Lemma \ref{lemma-morphisms-lifts-etale}) morphism
$s_{kk'} : U'_{kk'} \to U'_k$
as the second component of the morphism
$\xi_k|_{U_k \times_U U_{k'}} \to \xi_k$ of $\mathcal{C}$.
Similarly we obtain an \'etale morphism $t_{kk'} : U'_{kk'} \to U'_{k'}$
by looking at the second component of the composition
$$
\xi_k|_{U_k \times_U U_{k'}} \xrightarrow{\varphi_{kk'}}
\xi_{k'}|_{U_k \times_U U_{k'}} \to \xi_{k'}
$$
We claim that
$$
j :
\coprod\nolimits_{(k, k') \in K \times K} U'_{kk'}
\xrightarrow{(\coprod s_{kk'}, \coprod t_{kk'})}
(\coprod\nolimits_{k \in K} U'_k) \times (\coprod\nolimits_{k \in K} U'_k)
$$
is an \'etale equivalence relation. First, we have already seen
that the components $s, t$ of the displayed morphism are \'etale.
The base change of the morphism $j$ by
$(\coprod U_k) \times (\coprod U_k) \to (\coprod U'_k) \times (\coprod U'_k)$
is a monomorphism because it is the map
$$
\coprod\nolimits_{(k, k') \in K \times K} U_k \times_U U_{k'}
\longrightarrow
(\coprod\nolimits_{k \in K} U_k) \times (\coprod\nolimits_{k \in K} U_k)
$$
Hence $j$ is a monomorphism by More on Morphisms, Lemma
\ref{more-morphisms-lemma-properties-that-extend-over-thickenings}.
Finally, symmetry of the relation $j$ comes from the fact that
$\varphi_{kk'}^{-1}$ is the ``flip'' of $\varphi_{k'k}$ (see
Stacks, Remarks \ref{stacks-remarks-definition-descent-datum})
and transitivity comes from the cocycle condition (details omitted).
Thus the quotient of $\coprod U'_k$ by $j$ is an algebraic space $U'$
(Spaces, Theorem \ref{spaces-theorem-presentation}).
Above we have already shown that there is a thickening
$i : U \to U'$ as we saw that the restriction of $j$ on
$\coprod U_k$ gives $(\coprod U_k) \times_U (\coprod U_k)$.
Finally, if we temporarily view the $1$-morphisms
$x'_k : U'_k \to \mathcal{X}'$ as objects of the stack
$\mathcal{X}'$ over $U'_k$ then we see that these come endowed with a
descent datum with respect to the \'etale covering
$\{U'_k \to U'\}$ given by the third component $\gamma_{kk'}$
of the morphisms $\varphi_{kk'}$ in $\mathcal{C}$.
Since $\mathcal{X}'$ is a stack
this descent datum is effective and translating back we obtain
a $1$-morphism $x' : U' \to \mathcal{X}'$ such that the compositions
$U'_k \to U' \to \mathcal{X}'$ come equipped with isomorphisms to $x'_k$
compatible with $\gamma_{kk'}$. This means that the morphisms
$\alpha_k : x \circ a_k \to x'_k \circ i_k$ glue to a morphism
$\alpha : x \circ a \to x' \circ i$. Then $\xi = (U, U', a, i, x', \alpha)$
is the desired object over $U$.
\end{proof}

\begin{lemma}
\label{lemma-etale-local-lifts}
Let $\mathcal{X} \subset \mathcal{X}'$ be a thickening of algebraic stacks.
Let $W$ be an algebraic space and let $W \to \mathcal{X}$ be a smooth morphism.
There exists an \'etale covering $\{W_i \to W\}_{i \in I}$ and for each $i$
a cartesian diagram
$$
\xymatrix{
W_i \ar[r] \ar[d] & W_i' \ar[d] \\
\mathcal{X} \ar[r] & \mathcal{X}'
}
$$
with $W_i' \to \mathcal{X}'$ smooth.
\end{lemma}

\begin{proof}
Choose a scheme $U'$ and a surjective smooth morphism $U' \to \mathcal{X}'$.
As usual we set $U = \mathcal{X} \times_{\mathcal{X}'} U'$. Then
$U \to \mathcal{X}$ is a surjective smooth morphism. Therefore the base change
$$
V = W \times_{\mathcal{X}} U \longrightarrow W
$$
is a surjective smooth morphism of algebraic spaces.
By Topologies on Spaces, Lemma
\ref{spaces-topologies-lemma-etale-dominates-smooth}
we can find an \'etale covering $\{W_i \to W\}$ such
that $W_i \to W$ factors through $V \to W$.
After covering $W_i$ by affines (Properties of Spaces, Lemma
\ref{spaces-properties-lemma-cover-by-union-affines})
we may assume each $W_i$ is affine. We may and do replace $W$ by $W_i$
which reduces us to the situation discussed in the next paragraph.

\medskip\noindent
Assume $W$ is affine and the given morphism $W \to \mathcal{X}$ factors
through $U$. Picture
$$
W \xrightarrow{i} U \to \mathcal{X}
$$
Since $W$ and $U$ are smooth over $\mathcal{X}$ we see that
$i$ is locally of finite type (Morphisms of Stacks, Lemma
\ref{stacks-morphisms-lemma-finite-type-permanence}).
After replacing $U$ by $\mathbf{A}^n_U$ we may assume
that $i$ is an immersion, see
Morphisms, Lemma \ref{morphisms-lemma-quasi-affine-finite-type-over-S}.
By Morphisms of Stacks,
Lemma \ref{stacks-morphisms-lemma-lci-permanence}
the morphism $i$ is a local complete intersection.
Hence $i$ is a Koszul-regular immersion (as defined in
Divisors, Definition \ref{divisors-definition-regular-immersion})
by More on Morphisms, Lemma \ref{more-morphisms-lemma-lci}.

\medskip\noindent
We may still replace $W$ by an affine open covering.
For every point $w \in W$ we can choose an affine open
$U'_w \subset U'$ such that if $U_w \subset U$ is the
corresponding affine open, then $w \in i^{-1}(U_w)$ and
$i^{-1}(U_w) \to U_w$ is a closed immersion cut out
by a Koszul-regular sequence
$f_1, \ldots, f_r \in \Gamma(U_w, \mathcal{O}_{U_w})$.
This follows from the definition of Koszul-regular immersions
and Divisors, Lemma \ref{divisors-lemma-regular-ideal-sheaf-scheme}.
Set $W_w = i^{-1}(U_w)$; this is an affine open neighbourhood
of $w \in W$.
Choose lifts $f'_1, \ldots, f'_r \in \Gamma(U'_w, \mathcal{O}_{U'_w})$
of $f_1, \ldots, f_r$. This is possible as $U_w \to U'_w$
is a closed immersion of affine schemes.
Let $W'_w \subset U'_w$ be the closed subscheme cut out by
$f'_1, \ldots, f'_r$.
We claim that $W'_w \to \mathcal{X}'$ is smooth.
The claim finishes the proof as
$W_w = \mathcal{X} \times_{\mathcal{X}'} W'_w$
by construction.

\medskip\noindent
To check the claim it suffices to check that the base change
$W'_w \times_{\mathcal{X}'} X' \to X'$ is smooth for every
affine scheme $X'$ smooth over $\mathcal{X}'$. Choose an
\'etale morphism
$$
Y' \to U'_w \times_{\mathcal{X}'} X'
$$
with $Y'$ affine. Because $U'_w \times_{\mathcal{X}'} X'$ is covered
by the images of such morphisms, it is enough to show that the closed
subscheme $Z'$ of $Y'$ cut out by $f'_1, \ldots, f'_r$ is smooth over $X'$.
Picture
$$
\xymatrix{
Z' \ar[r] \ar[d] & Y' \ar[d] \\
W'_w \times_{\mathcal{X}'} X' \ar[d] \ar[r] &
U'_w \times_{\mathcal{X}'} X' \ar[d] \ar[r] & X' \\
W'_w = V(f'_1, \ldots, f'_r) \ar[r] & U'_w
}
$$
Set $X = \mathcal{X} \times_{\mathcal{X}'} X'$,
$Y = X \times_{X'} Y' = \mathcal{X} \times_{\mathcal{X}'} Y'$, and
$Z = Y \times_{Y'} Z' = X \times_{X'} Z' =
\mathcal{X} \times_{\mathcal{X}'} Z'$.
Then $(Z \subset Z') \to (Y \subset Y') \subset (X \subset X')$
are (cartesian) morphisms of thickenings of affine schemes and
we are given that $Z \to X$ and $Y' \to X'$ are smooth.
Finally, the sequence of functions $f'_1, \ldots, f'_r$
map to a Koszul-regular sequence in $\Gamma(Y', \mathcal{O}_{Y'})$ by
More on Algebra, Lemma \ref{more-algebra-lemma-koszul-regular-flat-base-change}
because $Y' \to U'_w$ is smooth and hence flat.
By More on Algebra, Lemma \ref{more-algebra-lemma-cut-by-koszul}
(and the fact that Koszul-regular sequences are quasi-regular sequences
by More on Algebra, Lemmas \ref{more-algebra-lemma-regular-koszul-regular},
\ref{more-algebra-lemma-koszul-regular-H1-regular}, and
\ref{more-algebra-lemma-H1-regular-quasi-regular})
we conclude that $Z' \to X'$ is smooth as desired.
\end{proof}

\begin{lemma}
\label{lemma-etale-local-lifts-isomorphic}
Let $\mathcal{X} \subset \mathcal{X}'$ be a thickening of algebraic stacks.
Consider a commutative diagram
$$
\xymatrix{
W'' \ar[d]_{x''} & W \ar[l] \ar[r] \ar[d]_x & W' \ar[d]^{x'} \\
\mathcal{X}' & \mathcal{X} \ar[l] \ar[r] & \mathcal{X}'
}
$$
with cartesian squares where $W', W, W''$ are algebraic spaces and
the vertical arrows are smooth. Then there exist
\begin{enumerate}
\item an \'etale covering $\{f'_k : W'_k \to W'\}_{k \in K}$,
\item \'etale morphisms $f''_k : W'_k \to W''$, and
\item $2$-morphisms $\gamma_k : x'' \circ f''_k \to x' \circ f'_k$
\end{enumerate}
such that (a) $(f'_k)^{-1}(W) = (f''_k)^{-1}(W)$, (b)
$f'_k|_{(f'_k)^{-1}(W)} = f''_k|_{(f''_k)^{-1}(W)}$, and
(c) pulling back $\gamma_k$ to the closed subscheme of (a)
agrees with the $2$-morphism given by the commutativity of
the initial diagram over $W$.
\end{lemma}

\begin{proof}
Denote $i : W \to W'$ and $i'' : W \to W''$ the given thickenings.
The commutativity of the diagram in the statement of the lemma
means there is a $2$-morphism $\delta : x' \circ i' \to x'' \circ i''$
This is the $2$-morphism referred to in part (c) of the statement.
Consider the algebraic space
$$
I' = W' \times_{x', \mathcal{X}', x''} W''
$$
with projections $p' : I' \to W'$ and $q' : I' \to W''$.
Observe that there is a ``universal'' $2$-morphism
$\gamma : x' \circ p' \to x'' \circ q'$ (we will use this later).
The choice of $\delta$ defines a morphism
$$
\xymatrix{
W \ar[rr]_\delta & & I' \ar[ld]^{p'} \ar[rd]_{q'} \\
& W' & & W''
}
$$
such that the compositions $W \to I' \to W'$ and $W \to I' \to W''$
are $i : W \to W'$ and $i' : W \to W''$.
Since $x''$ is smooth, the morphism $p' : I' \to W'$ is smooth
as a base change of $x''$.

\medskip\noindent
Suppose we can find an \'etale covering $\{f'_k : W'_k \to W'\}$
and morphisms $\delta_k : W'_k \to I'$ such that the restriction
of $\delta_k$ to $W_k = (f'_k)^{-1}$ is equal to $\delta \circ f_k$
where $f_k = f'_k|_{W_k}$. Picture
$$
\xymatrix{
W_k \ar[r]^{f_k} \ar[d] & W \ar[r]^\delta & I' \ar[d]^{p'} \\
W'_k \ar[rr]^{f'_k} \ar[rru]^{\delta_k} & & W'
}
$$
In other words, we want to be able to extend the given section
$\delta : W \to I'$ of $p'$ to a section over $W'$ after possibly
replacing $W'$ by an \'etale covering.

\medskip\noindent
If this is true, then we can set $f''_k = q' \circ \delta_k$
and $\gamma_k = \gamma \star \text{id}_{\delta_k}$ (more succinctly
$\gamma_k = \delta_k^*\gamma$). Namely, the only thing left to show
at this is that the morphism $f''_k$ is \'etale.
By construction the morphism $x' \circ p'$ is $2$-isomorphic
to $x'' \circ q'$. Hence $x'' \circ f''_k$ is $2$-isomorphic
to $x' \circ f'_k$. We conclude that the composition
$$
W'_k \xrightarrow{f''_k} W'' \xrightarrow{x''} \mathcal{X}'
$$
is smooth because $x' \circ f'_k$ is so.
As $f_k$ is \'etale we conclude $f''_k$ is \'etale
by Lemma \ref{lemma-deform-property-fp-over-ft}.

\medskip\noindent
If the thickening is a first order thickening, then we can
choose any \'etale covering $\{W'_k \to W'\}$ with $W_k'$ affine.
Namely, since $p'$ is smooth we see that $p'$ is formally smooth by the
infinitesimal lifting criterion (More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-smooth-formally-smooth}).
As $W_k$ is affine and as $W_k \to W'_k$ is a first order thickening
(as a base change of $\mathcal{X} \to \mathcal{X}'$, see
Lemma \ref{lemma-base-change-thickening}) we get $\delta_k$ as
desired.

\medskip\noindent
In the general case the existence of the covering and the morphisms
$\delta_k$ follows from More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-smooth-strong-lift}.
\end{proof}

\begin{lemma}
\label{lemma-gerbe-of-lifts}
The category $p : \mathcal{C} \to W_{spaces, \etale}$ constructed
in Remark \ref{remark-gerbe-of-lifts} is a gerbe.
\end{lemma}

\begin{proof}
In Lemma \ref{lemma-gerbe-of-lifts-stack}
we have seen that it is a stack in groupoids.
Thus it remains to check conditions (2) and (3) of
Stacks, Definition \ref{stacks-definition-gerbe}.
Condition (2) follows from
Lemma \ref{lemma-etale-local-lifts}.
Condition (3) follows from
Lemma \ref{lemma-etale-local-lifts-isomorphic}.
\end{proof}

\begin{lemma}
\label{lemma-gerbe-of-lifts-first-order}
In Remark \ref{remark-gerbe-of-lifts} assume $\mathcal{X} \subset \mathcal{X}'$
is a first order thickening. Then
\begin{enumerate}
\item the automorphism sheaves of objects of the gerbe
$p : \mathcal{C} \to W_{spaces, \etale}$ constructed
in Remark \ref{remark-gerbe-of-lifts} are abelian, and
\item the sheaf of groups $\mathcal{G}$ constructed in
Stacks, Lemma \ref{stacks-lemma-gerbe-abelian-auts}
is a quasi-coherent $\mathcal{O}_W$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
We will prove both statements at the same time. Namely, given
an object $\xi = (U, U', a, i, x', \alpha)$ we will endow
$\mathit{Aut}(\xi)$ with the structure of a
quasi-coherent $\mathcal{O}_U$-module on $U_{spaces, \etale}$ and
we will show that this structure is compatible with pullbacks.
This will be sufficient by glueing of sheaves
(Sites, Section \ref{sites-section-glueing-sheaves})
and the construction of $\mathcal{G}$ in the proof of
Stacks, Lemma \ref{stacks-lemma-gerbe-abelian-auts}
as the glueing of the automorphism sheaves $\mathit{Aut}(\xi)$
and the fact that it suffices to check a module is
quasi-coherent after going to an \'etale covering
(Properties of Spaces, Lemma
\ref{spaces-properties-lemma-characterize-quasi-coherent}).

\medskip\noindent
We will describe the sheaf $\mathit{Aut}(\xi)$ using the
same method as used in the proof of
Lemma \ref{lemma-etale-local-lifts-isomorphic}.
Consider the algebraic space
$$
I' = U' \times_{x', \mathcal{X}', x'} U'
$$
with projections $p' : I' \to U'$ and $q' : I' \to U'$.
Over $I'$ there is a universal $2$-morphism
$\gamma : x' \circ p' \to x' \circ q'$.
The identity $x' \to x'$ defines a diagonal morphism
$$
\xymatrix{
U' \ar[rr]_{\Delta'} & & I' \ar[ld]^{p'} \ar[rd]_{q'} \\
& U' & & U'
}
$$
such that the compositions $U' \to I' \to U'$ and $U' \to I' \to U'$
are the identity morphisms. We will denote the base change of
$U', I', p', q', \Delta'$ to $\mathcal{X}$ by $U, I, p, q, \Delta$.
Since $W' \to \mathcal{X}'$ is smooth, we see that $p' : I' \to U'$
is smooth as a base change.

\medskip\noindent
A section of $\mathit{Aut}(\xi)$ over $U$ is a morphism $\delta' : U' \to I'$
such that $\delta'|_U = \Delta$ and such that
$p' \circ \delta' = \text{id}_{U'}$. To be explicit,
$(\text{id}_U, q' \circ \delta', (\delta')^*\gamma) : \xi \to \xi$
is a formula for the corresponding automorphism.
More generally, if
$f : V \to U$ is an \'etale morphism, then there is a thickening
$j : V \to V'$ and an \'etale morphism
$f' : V' \to U'$ whose restriction to $V$ is $f$ and $f^*\xi$
corresponds to $(V, V', a \circ f, j, x' \circ f', f^*\alpha)$, see proof of
Lemma \ref{lemma-gerbe-of-lifts-fibred}.
 a section of $\mathit{Aut}(\xi)$ over $V$ is a morphism
$\delta' : V' \to I'$
such that $\delta'|_V = \Delta \circ f$
and $p' \circ \delta' = f'$\footnote{A formula for the corresponding
automorphism is $(\text{id}_V, h', (\delta')^*\gamma)$.
Here $h' : V' \to V'$ is the unique (iso)morphism such that
$h'|_V = \text{id}_V$ and such that
$$
\xymatrix{
V' \ar[r]_{h'} \ar[rd]_{q' \circ \delta'} & V' \ar[d]^{f'} \\
& U'
}
$$
commutes. Uniqueness and existence of $h'$ by topological invariance of
the \'etale site, see More on Morphisms of Spaces,
Theorem \ref{spaces-more-morphisms-theorem-topological-invariance}.
The reader may feel we should instead look at morphisms
$\delta'' : V' \to V' \times_{\mathcal{X}'} V'$ with
$\delta'' \circ j = \Delta_{V'/\mathcal{X}'}$ and
$\text{pr}_1 \circ \delta'' = \text{id}_{V'}$.
This would be fine too: as $V' \times_{\mathcal{X}'} V' \to I'$ is \'etale,
the same topological invariance tells us that sending
$\delta''$ to $\delta' = (V' \times_{\mathcal{X}'} V' \to I') \circ \delta''$
is a bijection between the two
sets of morphisms.}.

\medskip\noindent
We conclude that $\mathit{Aut}(\xi)$ as a sheaf of sets agrees with
the sheaf defined in
More on Morphisms of Spaces, Remark
\ref{spaces-more-morphisms-remark-another-special-case}
for the thickenings $(U \subset U')$ and $(I \subset I')$ over
$(U \subset U')$ via $\text{id}_{U'}$ and $p'$.
The diagonal $\Delta'$ is a section of this sheaf and by
acting on this section using More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-action-sheaf}
we get an isomorphism
\begin{equation}
\label{equation-isomorphism}
\SheafHom_{\mathcal{O}_U}(\Delta^*\Omega_{I/U}, \mathcal{C}_{U/U'})
\longrightarrow
\mathit{Aut}(\xi)
\end{equation}
on $U_{spaces, \etale}$. There three things left to check
\begin{enumerate}
\item the construction of (\ref{equation-isomorphism})
commutes with \'etale localization,
\item $\SheafHom_{\mathcal{O}_U}(\Delta^*\Omega_{I/U}, \mathcal{C}_{U/U'})$
is a quasi-coherent module on $U$,
\item the composition in $\mathit{Aut}(\xi)$ corresponds
to addition of sections in this quasi-coherent module.
\end{enumerate}
We will check these in order.

\medskip\noindent
To see (1) we have to show that if $f : V \to U$ is \'etale,
then (\ref{equation-isomorphism}) constructed using $\xi$ over $U$,
restricts to the map (\ref{equation-isomorphism})
$$
\SheafHom_{\mathcal{O}_V}(
\Delta_V^*\Omega_{V \times_\mathcal{X} V/V}, \mathcal{C}_{V/V'}) \to
\mathit{Aut}(\xi|_V)
$$
constructed using $\xi|_V$ over $V$ on $V_{spaces, \etale}$.
This follows from the discussion in the footnote above
and More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-action-by-derivations-etale-localization}.

\medskip\noindent
Proof of (2). Since $p'$ is smooth, the morphism $I \to U$ is smooth,
and hence the relative module of differentials $\Omega_{I/U}$
is finite locally free (More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-smooth-omega-finite-locally-free}).
On the other hand, $\mathcal{C}_{U/U'}$ is quasi-coherent
(More on Morphisms of Spaces, Definition
\ref{spaces-more-morphisms-definition-conormal-sheaf}).
By Properties of Spaces, Lemma
\ref{spaces-properties-lemma-properties-quasi-coherent}
we conclude.

\medskip\noindent
Proof of (3). There exists a morphism $c' : I' \times_{p', U', q'} I' \to I'$
such that $(U', I', p', q', c')$ is a groupoid in algebraic spaces
with identity $\Delta'$. See
Algebraic Stacks, Lemma \ref{algebraic-lemma-map-space-into-stack} for example.
Composition in $\mathit{Aut}(\xi)$ is induced by the morphism
$c'$ as follows. Suppose we have two morphisms
$$
\delta'_1, \delta'_2 : U' \longrightarrow I'
$$
corresponding to sections of $\mathit{Aut}(\xi)$ over $U$ as above,
in other words, we have $\delta'_i|U = \Delta_U$ and
$p' \circ \delta'_i = \text{id}_{U'}$. Then the composition
in $\mathit{Aut}(\xi)$ is
$$
\delta'_1 \circ \delta'_2 = c'(\delta'_1 \circ q' \circ \delta'_2, \delta'_2)
$$
We omit the detailed verification\footnote{The reader can see immediately
that it is necessary to precompose
$\delta'_1$ by $q' \circ \delta'_2$ to get a well defined $U'$-valued
point of the fibre product $I' \times_{p', U', q'} I'$.}.
Thus we are in the situation described in
More on Groupoids in Spaces, Section
\ref{spaces-more-groupoids-section-groupoid-sections}
and the desired result follows from
More on Groupoids in Spaces, Lemma
\ref{spaces-more-groupoids-lemma-composition-is-addition}.
\end{proof}

\begin{proposition}[Emerton]
\label{proposition-affine-smooth-lift-to-first-order}
\begin{reference}
Email of Matthew Emerton dated April 27, 2016.
\end{reference}
Let $\mathcal{X} \subset \mathcal{X}'$ be a first order thickening
of algebraic stacks. Let $W$ be an affine scheme and let
$W \to \mathcal{X}$ be a smooth morphism. Then there exists
a cartesian diagram
$$
\xymatrix{
W \ar[d] \ar[r] & W' \ar[d] \\
\mathcal{X} \ar[r] & \mathcal{X}'
}
$$
with $W' \to \mathcal{X}'$ smooth.
\end{proposition}

\begin{proof}
Consider the category $p : \mathcal{C} \to W_{spaces, \etale}$
introduced in Remark \ref{remark-gerbe-of-lifts}.
The proposition states that there exists an object of $\mathcal{C}$
lying over $W$. By Lemma \ref{lemma-gerbe-of-lifts}
$\mathcal{C}$ is a gerbe over $W_{spaces, \etale}$.
This means we can \'etale locally find a solution and
these local solutions are \'etale locally isomorphic;
this part does not require the assumption that the thickening is first order.
By Lemma \ref{lemma-gerbe-of-lifts-first-order}
the automorphism sheaves of objects of our gerbe are abelian and
fit together to form a quasi-coherent module $\mathcal{G}$
on $W_{spaces, \etale}$. We will verify conditions (1) and (2)
of Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-existence}
to conclude the existence of an object of $\mathcal{C}$ lying over $W$.
Condition (1) is true: the \'etale coverings $\{W_i \to W\}$
with each $W_i$ affine are cofinal in the collection of all coverings.
For such a covering $W_i$ and $W_i \times_W W_j$ are affine
and $H^1(W_i, \mathcal{G})$ and $H^1(W_i \times_W W_j, \mathcal{G})$
are zero: the cohomology of a quasi-coherent module over an affine
algebraic space is zero for example by Cohomology of Spaces, Proposition
\ref{spaces-cohomology-proposition-vanishing}.
Finally, condition (2) is that $H^2(W, \mathcal{G}) = 0$
for our quasi-coherent sheaf $\mathcal{G}$ which again follows
from Cohomology of Spaces, Proposition
\ref{spaces-cohomology-proposition-vanishing}.
This finishes the proof.
\end{proof}







\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
