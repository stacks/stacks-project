\input{preamble}

% OK, start here.
%
\begin{document}

\title{Cohomology on Sites}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this document we work out some topics on cohomology of sheaves.
We work out what happens for sheaves on sites,
although often we will simply duplicate the discussion,
the constructions, and the proofs from the topological
case in the case.
Basic references are \cite{SGA4}, \cite{Godement} and \cite{Iversen}.

\section{Topics}
\label{section-topics}

\noindent
Here are some topics that should be discussed in this chapter,
and have not yet been written.
\begin{enumerate}
\item Cohomology of a sheaf of modules on a site is the same
as the cohomology of the underlying abelian sheaf.
\item Hypercohomology on a site.
\item Ext-groups.
\item Ext sheaves.
\item Tor functors.
\item Higher direct images for a morphism of sites.
\item Derived pullback for morphisms between ringed sites.
\item Cup-product.
\item Group cohomology.
\item Comparison of group cohomology and cohomology on $\mathcal{T}_G$.
\item {\v C}ech cohomology on sites.
\item {\v C}ech to cohomology spectral sequence on sites.
\item Leray Spectral sequence for a morphism between ringed sites.
\item Etc, etc, etc.
\end{enumerate}



\section{Cohomology of sheaves}
\label{section-cohomology-sheaves}

\noindent
Let $\mathcal{C}$ be a site, see
Sites, Definition \ref{sites-definition-site}.
Let $\mathcal{F}$ be a abelian sheaf on $\mathcal{C}$.
We know that the category of abelian sheaves on $\mathcal{C}$
has enough injectives, see
Injectives, Theorem \ref{injectives-theorem-sheaves-injectives}.
Hence we can choose an injective resolution
$\mathcal{F}[0] \to \mathcal{I}^\bullet$.
For any object $U$ of the site $\mathcal{C}$ we define
\begin{equation}
\label{equation-cohomology-object-site}
H^i(U, \mathcal{F}) = H^i(\Gamma(U, \mathcal{I}^\bullet))
\end{equation}
to be the {\it $i$th cohomology group of the abelian sheaf
$\mathcal{F}$ over the object $U$}. In other words, these are the
right derived functors of the functor $\mathcal{F} \mapsto \mathcal{F}(U)$.
The family of functors $H^i(U, -)$ forms a universal $\delta$-functor
$\textit{Ab}(\mathcal{C}) \to \textit{Ab}$.

\medskip\noindent
It sometimes happens that
the site $\mathcal{C}$ does not have a final object. In this
case we define the {\it global sections} of a presheaf
of sets $\mathcal{F}$ over $\mathcal{C}$ to be the set
\begin{equation}
\label{equation-global-sections}
\Gamma(\mathcal{C}, \mathcal{F}) =
\Mor_{\textit{PSh}(\mathcal{C})}(e, \mathcal{F})
\end{equation}
where $e$ is a final object in the category of presheaves on $\mathcal{C}$.
In this case, given an abelian sheaf $\mathcal{F}$ on $\mathcal{C}$,
we define the {\it $i$th cohomology group of $\mathcal{F}$ on $\mathcal{C}$}
as follows
\begin{equation}
\label{equation-cohomology}
H^i(\mathcal{C}, \mathcal{F}) = H^i(\Gamma(\mathcal{C}, \mathcal{I}^\bullet))
\end{equation}
in other words, it is the $i$th right derived functor of the
global sections functor.
The family of functors $H^i(\mathcal{C}, -)$ forms a universal $\delta$-functor
$\textit{Ab}(\mathcal{C}) \to \textit{Ab}$.

\medskip\noindent
Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ be a morphism of topoi, see
Sites, Definition \ref{sites-definition-topos}.
With $\mathcal{F}[0] \to \mathcal{I}^\bullet$ as above
we define
\begin{equation}
\label{equation-higher-direct-image}
R^if_*\mathcal{F} = H^i(f_*\mathcal{I}^\bullet)
\end{equation}
to be the {\it $i$th higher direct image of $\mathcal{F}$}.
These are the right derived functors of $f_*$.
The family of functors $R^if_*$ forms a universal $\delta$-functor
from $\textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$.

\medskip\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site, see
Modules on Sites, Definition \ref{sites-modules-definition-ringed-site}.
Let $\mathcal{F}$ be an $\mathcal{O}$-module.
We know that the category of $\mathcal{O}$-modules
has enough injectives, see
Injectives, Theorem \ref{injectives-theorem-sheaves-modules-injectives}.
Hence we can choose an injective resolution
$\mathcal{F}[0] \to \mathcal{I}^\bullet$.
For any object $U$ of the site $\mathcal{C}$ we define
\begin{equation}
\label{equation-cohomology-object-site-modules}
H^i(U, \mathcal{F}) = H^i(\Gamma(U, \mathcal{I}^\bullet))
\end{equation}
to be the {\it the $i$th cohomology group of $\mathcal{F}$ over $U$}.
The family of functors $H^i(U, -)$ forms a universal $\delta$-functor
$\textit{Mod}(\mathcal{O}) \to \text{Mod}_{\mathcal{O}(U)}$. Similarly
\begin{equation}
\label{equation-cohomology-modules}
H^i(\mathcal{C}, \mathcal{F}) = H^i(\Gamma(\mathcal{C}, \mathcal{I}^\bullet))
\end{equation}
it the {\it $i$th cohomology group of $\mathcal{F}$ on $\mathcal{C}$}.
The family of functors $H^i(\mathcal{C}, -)$ forms a universal
$\delta$-functor
$\textit{Mod}(\mathcal{C}) \to \text{Mod}_{\Gamma(\mathcal{C}, \mathcal{O})}$.

\medskip\noindent
Let $f : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$
be a morphism of ringed topoi, see
Modules on Sites, Definition \ref{sites-modules-definition-ringed-topos}.
With $\mathcal{F}[0] \to \mathcal{I}^\bullet$ as above
we define
\begin{equation}
\label{equation-higher-direct-image-modules}
R^if_*\mathcal{F} = H^i(f_*\mathcal{I}^\bullet)
\end{equation}
to be the {\it $i$th higher direct image of $\mathcal{F}$}.
These are the right derived functors of $f_*$.
The family of functors $R^if_*$ forms a universal $\delta$-functor
from $\textit{Mod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}')$.








\section{Derived functors}
\label{section-derived-functors}

\noindent
We briefly explain an approach to right derived functors using resolution
functors. Namely, suppose that $(\mathcal{C}, \mathcal{O})$ is a ringed site.
In this chapter we will write
$$
K(\mathcal{O}) = K(\textit{Mod}(\mathcal{O}))
\quad
\text{and}
\quad
D(\mathcal{O}) = D(\textit{Mod}(\mathcal{O}))
$$
and similarly for the bounded versions for the triangulated categories
introduced in
Derived Categories, Definition \ref{derived-definition-complexes-notation} and
Definition \ref{derived-definition-unbounded-derived-category}.
By
Derived Categories, Remark \ref{derived-remark-big-abelian-category}
there exists a resolution functor
$$
j = j_{(\mathcal{C}, \mathcal{O})} :
K^{+}(\textit{Mod}(\mathcal{O}))
\longrightarrow
K^{+}(\mathcal{I})
$$
where $\mathcal{I}$ is the strictly full additive subcategory of
$\textit{Mod}(\mathcal{O})$ which consists of injective $\mathcal{O}$-modules.
For any left exact functor $F : \textit{Mod}(\mathcal{O}) \to \mathcal{B}$
into any abelian category $\mathcal{B}$ we will denote $RF$ the
right derived functor of
Derived Categories, Section \ref{derived-section-right-derived-functor}
constructed using the resolution functor $j$ just described:
\begin{equation}
\label{equation-RF}
RF = F \circ j' : D^{+}(\mathcal{O}) \longrightarrow D^{+}(\mathcal{B})
\end{equation}
see
Derived Categories, Lemma \ref{derived-lemma-right-derived-functor}
for notation. Note that we may think of $RF$ as defined on
$\textit{Mod}(\mathcal{O})$, $\text{Comp}^{+}(\textit{Mod}(\mathcal{O}))$, or
$K^{+}(\mathcal{O})$ depending on the situation. According to
Derived Categories, Definition \ref{derived-definition-higher-derived-functors}
we obtain the $i$the right derived functor
\begin{equation}
\label{equation-RFi}
R^iF = H^i \circ RF : \textit{Mod}(\mathcal{O}) \longrightarrow \mathcal{B}
\end{equation}
so that $R^0F = F$ and $\{R^iF, \delta\}_{i \geq 0}$ is universal
$\delta$-functor, see
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}.

\medskip\noindent
Here are two special cases of this construction. Given a ring $R$ we write
$K(R) = K(\text{Mod}_R)$ and $D(R) = D(\text{Mod}_R)$ and similarly for the
bounded versions. For any object $U$ of $\mathcal{C}$ have a left exact functor
$
\Gamma(U, -) :
\textit{Mod}(\mathcal{O})
\longrightarrow
\text{Mod}_{\mathcal{O}(U)}
$
which gives rise to
$$
R\Gamma(U, -) :
D^{+}(\mathcal{O})
\longrightarrow
D^{+}(\mathcal{O}(U))
$$
by the discussion above. Note that $H^i(U, -) = R^i\Gamma(U, -)$
is compatible with (\ref{equation-cohomology-object-site-modules}) above.
We similarly have
$$
R\Gamma(\mathcal{C}, -) :
D^{+}(\mathcal{O})
\longrightarrow
D^{+}(\Gamma(\mathcal{C}, \mathcal{O}))
$$
compatible with (\ref{equation-cohomology-modules}). If
$f : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$
is a morphism of ringed topoi then we get a left exact functor
$f_* : \textit{Mod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}')$
which gives rise to {\it derived pushforward}
$$
Rf_* : D^{+}(\mathcal{O}) \to D^+(\mathcal{O}')
$$
The $i$th cohomology sheaf of $Rf_*\mathcal{F}^\bullet$ is denoted
$R^if_*\mathcal{F}^\bullet$ and called the $i$th {\it higher direct image}
in accordance with (\ref{equation-higher-direct-image-modules}).
The displayed functors above are exact functor
of derived categories.







\section{First cohomology and torsors}
\label{section-h1-torsors}

\begin{definition}
\label{definition-torsor}
Let $\mathcal{C}$ be a site.
Let $\mathcal{G}$ be a sheaf of (possibly non-commutative)
groups on $\mathcal{C}$.
A {\it pseudo torsor}, or more precisely a
{\it pseudo $\mathcal{G}$-torsor}, is a sheaf
of sets $\mathcal{F}$ on $\mathcal{C}$ endowed with an action
$\mathcal{G} \times \mathcal{F} \to \mathcal{F}$ such that
\begin{enumerate}
\item whenever $\mathcal{F}(U)$ is nonempty the action
$\mathcal{G}(U) \times \mathcal{F}(U) \to \mathcal{F}(U)$
is simply transitive.
\end{enumerate}
A {\it morphism of pseudo $\mathcal{G}$-torsors}
$\mathcal{F} \to \mathcal{F}'$
is simply a morphism of sheaves of sets compatible with the
$\mathcal{G}$-actions.
A {\it torsor}, or more precisely a
{\it $\mathcal{G}$-torsor}, is a pseudo $G$-torsor such that
in addition
\begin{enumerate}
\item[(2)] for every $U \in \Ob(\mathcal{C})$
there exists a covering $\{U_i \to U\}_{i \in I}$ of $U$
such that $\mathcal{F}(U_i)$ is nonempty for all $i \in I$.
\end{enumerate}
A {\it morphism of $G$-torsors} is simply a morphism of
pseudo $G$-torsors.
The {\it trivial $\mathcal{G}$-torsor}
is the sheaf $\mathcal{G}$ endowed with the obvious left
$\mathcal{G}$-action.
\end{definition}

\noindent
It is clear that a morphism of torsors is automatically an isomorphism.

\begin{lemma}
\label{lemma-trivial-torsor}
Let $\mathcal{C}$ be a site.
Let $\mathcal{G}$ be a sheaf of (possibly non-commutative)
groups on $\mathcal{C}$.
A $\mathcal{G}$-torsor $\mathcal{F}$ is trivial if and only if
$\Gamma(\mathcal{C}, \mathcal{F}) \not = \emptyset$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-torsors-h1}
Let $\mathcal{C}$ be a site.
Let $\mathcal{H}$ be an abelian sheaf on $\mathcal{C}$.
There is a canonical bijection between the set of isomorphism
classes of $\mathcal{H}$-torsors and $H^1(\mathcal{C}, \mathcal{H})$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be a $\mathcal{H}$-torsor.
Consider the free abelian sheaf $\mathbf{Z}[\mathcal{F}]$
on $\mathcal{F}$. It is the sheafification of the rule
which associates to $U \in \Ob(\mathcal{C})$ the collection of finite
formal sums $\sum n_i[s_i]$ with $n_i \in \mathbf{Z}$
and $s_i \in \mathcal{F}(U)$. There is a natural map
$$
\sigma : \mathbf{Z}[\mathcal{F}] \longrightarrow \underline{\mathbf{Z}}
$$
which to a local section $\sum n_i[s_i]$ associates $\sum n_i$.
The kernel of $\sigma$ is generated by sections of the form
$[s] - [s']$. There is a canonical map
$a : \Ker(\sigma) \to \mathcal{H}$
which maps $[s] - [s'] \mapsto h$ where $h$ is the local section of
$\mathcal{H}$ such that $h \cdot s = s'$. Consider the pushout diagram
$$
\xymatrix{
0 \ar[r] &
\Ker(\sigma) \ar[r] \ar[d]^a &
\mathbf{Z}[\mathcal{F}] \ar[r] \ar[d] &
\underline{\mathbf{Z}} \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\mathcal{H} \ar[r] &
\mathcal{E} \ar[r] &
\underline{\mathbf{Z}} \ar[r] &
0
}
$$
Here $\mathcal{E}$ is the extension obtained by pushout.
From the long exact cohomology sequence associated to the lower
short exact sequence we obtain an element
$\xi = \xi_\mathcal{F} \in H^1(\mathcal{C}, \mathcal{H})$
by applying the boundary operator to
$1 \in H^0(\mathcal{C}, \underline{\mathbf{Z}})$.

\medskip\noindent
Conversely, given $\xi \in H^1(\mathcal{C}, \mathcal{H})$ we can associate to
$\xi$ a torsor as follows. Choose an embedding $\mathcal{H} \to \mathcal{I}$
of $\mathcal{H}$ into an injective abelian sheaf $\mathcal{I}$. We set
$\mathcal{Q} = \mathcal{I}/\mathcal{H}$ so that we have a short exact
sequence
$$
\xymatrix{
0 \ar[r] &
\mathcal{H} \ar[r] &
\mathcal{I} \ar[r] &
\mathcal{Q} \ar[r] &
0
}
$$
The element $\xi$ is the image of a global section
$q \in H^0(\mathcal{C}, \mathcal{Q})$
because $H^1(\mathcal{C}, \mathcal{I}) = 0$ (see
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}).
Let $\mathcal{F} \subset \mathcal{I}$ be the subsheaf (of sets) of sections
that map to $q$ in the sheaf $\mathcal{Q}$. It is easy to verify that
$\mathcal{F}$ is a $\mathcal{H}$-torsor.

\medskip\noindent
We omit the verification that the two constructions given
above are mutually inverse.
\end{proof}






\section{First cohomology and extensions}
\label{section-h1-extensions}

\begin{lemma}
\label{lemma-h1-extensions}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules on $\mathcal{C}$.
There is a canonical bijection
$$
\text{Ext}^1_{\textit{Mod}(\mathcal{O})}(\mathcal{O}, \mathcal{F})
\longrightarrow
H^1(\mathcal{C}, \mathcal{F})
$$
which associates to the extension
$$
0 \to \mathcal{F} \to \mathcal{E} \to \mathcal{O} \to 0
$$
the image of $1 \in \Gamma(\mathcal{C}, \mathcal{O})$ in
$H^1(\mathcal{C}, \mathcal{F})$.
\end{lemma}

\begin{proof}
Let us construct the inverse of the map given in the lemma.
Let $\xi \in H^1(\mathcal{C}, \mathcal{F})$.
Choose an injection $\mathcal{F} \subset \mathcal{I}$ with
$\mathcal{I}$ injective in $\textit{Mod}(\mathcal{O})$.
Set $\mathcal{Q} = \mathcal{I}/\mathcal{F}$.
By the long exact sequence of cohomology, we see that
$\xi$ is the image of of a section
$\tilde \xi \in \Gamma(\mathcal{C}, \mathcal{Q}) =
\Hom_\mathcal{O}(\mathcal{O}, \mathcal{Q})$.
Now, we just form the pullback
$$
\xymatrix{
0 \ar[r] &
\mathcal{F} \ar[r] \ar@{=}[d] &
\mathcal{E} \ar[r] \ar[d] &
\mathcal{O} \ar[r] \ar[d]^{\tilde \xi} &
0 \\
0 \ar[r] &
\mathcal{F} \ar[r] &
\mathcal{I} \ar[r] &
\mathcal{Q} \ar[r] &
0
}
$$
see Homology, Section \ref{homology-section-extensions}.
\end{proof}

\noindent
The following lemma will be superseded by the more general
Lemma \ref{lemma-cohomology-modules-abelian-agree}.

\begin{lemma}
\label{lemma-h1-mod-ab-agree}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules on $\mathcal{C}$.
Let $\mathcal{F}_{ab}$ denote the underlying sheaf of abelian
groups. Then there is a functorial isomorphism
$$
H^1(\mathcal{C}, \mathcal{F}_{ab})
=
H^1(\mathcal{C}, \mathcal{F})
$$
where the left hand side is cohomology computed in
$\textit{Ab}(\mathcal{C})$ and the right hand side
is cohomology computed in $\textit{Mod}(\mathcal{O})$.
\end{lemma}

\begin{proof}
Let $\underline{\mathbf{Z}}$ denote the constant sheaf
$\mathbf{Z}$. As
$\textit{Ab}(\mathcal{C}) = \textit{Mod}(\underline{\mathbf{Z}})$
we may apply
Lemma \ref{lemma-h1-extensions}
twice, and it follows that we have to show
$$
\text{Ext}^1_{\textit{Mod}(\mathcal{O})}(\mathcal{O}, \mathcal{F})
=
\text{Ext}^1_{\textit{Mod}(\underline{\mathbf{Z}})}(
\underline{\mathbf{Z}}, \mathcal{F}_{ab}).
$$
Suppose that $0 \to \mathcal{F} \to \mathcal{E} \to \mathcal{O} \to 0$
is an extension in $\textit{Mod}(\mathcal{O})$. Then we can use
the obvious map of abelian sheaves
$1 : \underline{\mathbf{Z}} \to \mathcal{O}$
and pullback to obtain an extension $\mathcal{E}_{ab}$, like so:
$$
\xymatrix{
0 \ar[r] &
\mathcal{F}_{ab} \ar[r] \ar@{=}[d] &
\mathcal{E}_{ab} \ar[r] \ar[d] &
\underline{\mathbf{Z}} \ar[r] \ar[d]^{1} &
0 \\
0 \ar[r] &
\mathcal{F} \ar[r] &
\mathcal{E} \ar[r] &
\mathcal{O} \ar[r] &
0
}
$$
The converse is a little more fun. Suppose that
$0 \to \mathcal{F}_{ab} \to \mathcal{E}_{ab} \to \underline{\mathbf{Z}} \to 0$
is an extension in $\textit{Mod}(\underline{\mathbf{Z}})$.
Since $\underline{\mathbf{Z}}$ is a flat $\underline{\mathbf{Z}}$-module
we see that the sequence
$$
0 \to \mathcal{F}_{ab} \otimes_{\underline{\mathbf{Z}}} \mathcal{O}
\to \mathcal{E}_{ab} \otimes_{\underline{\mathbf{Z}}} \mathcal{O}
\to \underline{\mathbf{Z}} \otimes_{\underline{\mathbf{Z}}} \mathcal{O}
\to 0
$$
is exact, see
Modules on Sites, Lemma \ref{sites-modules-lemma-flat-tor-zero}.
Of course
$\underline{\mathbf{Z}} \otimes_{\underline{\mathbf{Z}}} \mathcal{O}
= \mathcal{O}$.
Hence we can form the pushout via the ($\mathcal{O}$-linear) multiplication map
$\mu : \mathcal{F} \otimes_{\underline{\mathbf{Z}}} \mathcal{O}
\to \mathcal{F}$ to get an extension of $\mathcal{O}$ by
$\mathcal{F}$, like this
$$
\xymatrix{
0 \ar[r] &
\mathcal{F}_{ab} \otimes_{\underline{\mathbf{Z}}} \mathcal{O}
\ar[r] \ar[d]^\mu &
\mathcal{E}_{ab} \otimes_{\underline{\mathbf{Z}}} \mathcal{O}
\ar[r] \ar[d] &
\mathcal{O} \ar[r] \ar@{=}[d] &
0 \\
0 \ar[r] &
\mathcal{F} \ar[r] &
\mathcal{E} \ar[r] &
\mathcal{O} \ar[r] &
0
}
$$
which is the desired extension. We omit the verification that these
constructions are mutually inverse.
\end{proof}





\section{First cohomology and invertible sheaves}
\label{section-invertible-sheaves}

\noindent
The Picard group of a ringed site is defined in
Modules on Sites, Section \ref{sites-modules-section-invertible}.

\begin{lemma}
\label{lemma-h1-invertible}
Let $(\mathcal{C}, \mathcal{O})$ be a locally ringed site.
There is a canonical isomorphism
$$
H^1(\mathcal{C}, \mathcal{O}^*) = \text{Pic}(\mathcal{O}).
$$
of abelian groups.
\end{lemma}

\begin{proof}
Let $\mathcal{L}$ be an invertible $\mathcal{O}$-module.
Consider the presheaf $\mathcal{L}^*$ defined by the rule
$$
U \longmapsto \{s \in \mathcal{L}(U)
\text{ such that } \mathcal{O}_U \xrightarrow{s \cdot -} \mathcal{L}_U
\text{ is an isomorphism}\}
$$
This presheaf satisfies the sheaf condition. Moreover, if
$f \in \mathcal{O}^*(U)$ and $s \in \mathcal{L}^*(U)$, then clearly
$fs \in \mathcal{L}^*(U)$. By the same token, if $s, s' \in \mathcal{L}^*(U)$
then there exists a unique $f \in \mathcal{O}^*(U)$ such that
$fs = s'$. Moreover, the sheaf $\mathcal{L}^*$ has sections locally
by Modules on Sites, Lemma
\ref{sites-modules-lemma-invertible-is-locally-free-rank-1}.
In other words we
see that $\mathcal{L}^*$ is a $\mathcal{O}^*$-torsor. Thus we get
a map
$$
\begin{matrix}
\text{set of invertible sheaves on }(\mathcal{C}, \mathcal{O}) \\
\text{ up to isomorphism}
\end{matrix}
\longrightarrow
\begin{matrix}
\text{set of }\mathcal{O}^*\text{-torsors} \\
\text{ up to isomorphism}
\end{matrix}
$$
We omit the verification that this is a homomorphism of abelian groups.
By
Lemma \ref{lemma-torsors-h1}
the right hand side is canonically
bijective to $H^1(\mathcal{C}, \mathcal{O}^*)$.
Thus we have to show this map is injective and surjective.

\medskip\noindent
Injective. If the torsor $\mathcal{L}^*$ is trivial, this means by
Lemma \ref{lemma-trivial-torsor}
that $\mathcal{L}^*$ has a global section.
Hence this means exactly that $\mathcal{L} \cong \mathcal{O}$ is
the neutral element in $\text{Pic}(\mathcal{O})$.

\medskip\noindent
Surjective. Let $\mathcal{F}$ be an $\mathcal{O}^*$-torsor.
Consider the presheaf of sets
$$
\mathcal{L}_1 : U \longmapsto
(\mathcal{F}(U) \times \mathcal{O}(U))/\mathcal{O}^*(U)
$$
where the action of $f \in \mathcal{O}^*(U)$ on
$(s, g)$ is $(fs, f^{-1}g)$. Then $\mathcal{L}_1$ is a presheaf
of $\mathcal{O}$-modules by setting
$(s, g) + (s', g') = (s, g + (s'/s)g')$ where $s'/s$ is the local
section $f$ of $\mathcal{O}^*$ such that $fs = s'$, and
$h(s, g) = (s, hg)$ for $h$ a local section of $\mathcal{O}$.
We omit the verification that the sheafification
$\mathcal{L} = \mathcal{L}_1^\#$ is an invertible $\mathcal{O}$-module
whose associated $\mathcal{O}^*$-torsor $\mathcal{L}^*$ is isomorphic
to $\mathcal{F}$.
\end{proof}









\section{Locality of cohomology}
\label{section-locality}

\noindent
The following lemma says there is no ambiguity in defining the cohomology
of a sheaf $\mathcal{F}$ over an object of the site.

\begin{lemma}
\label{lemma-cohomology-of-open}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $U$ be an object of $\mathcal{C}$.
\begin{enumerate}
\item If $\mathcal{I}$ is an injective $\mathcal{O}$-module
then $\mathcal{I}|_U$ is an injective $\mathcal{O}_U$-module.
\item For any sheaf of $\mathcal{O}$-modules $\mathcal{F}$ we have
$H^p(U, \mathcal{F}) = H^p(\mathcal{C}/U, \mathcal{F}|_U)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Recall that the functor $j_U^{-1}$ of restriction to $U$ is a right adjoint
to the functor $j_{U!}$ of extension by $0$, see
Modules on Sites, Section
\ref{sites-modules-section-localize}.
Moreover, $j_{U!}$ is exact. Hence (1) follows from
Homology, Lemma \ref{homology-lemma-adjoint-preserve-injectives}.

\medskip\noindent
By definition $H^p(U, \mathcal{F}) = H^p(\mathcal{I}^\bullet(U))$
where $\mathcal{F} \to \mathcal{I}^\bullet$ is an injective resolution
in $\textit{Mod}(\mathcal{O})$.
By the above we see that $\mathcal{F}|_U \to \mathcal{I}^\bullet|_U$
is an injective resolution in $\textit{Mod}(\mathcal{O}_U)$.
Hence $H^p(U, \mathcal{F}|_U)$ is equal to
$H^p(\mathcal{I}^\bullet|_U(U))$.
Of course $\mathcal{F}(U) = \mathcal{F}|_U(U)$ for
any sheaf $\mathcal{F}$ on $\mathcal{C}$.
Hence the equality in (2).
\end{proof}

\noindent
The following lemma will be use to see what happens if we change a
partial universe, or to compare cohomology of the small and big \'etale
sites.

\begin{lemma}
\label{lemma-cohomology-bigger-site}
Let $\mathcal{C}$ and $\mathcal{D}$ be sites.
Let $u : \mathcal{C} \to \mathcal{D}$ be a functor.
Assume $u$ satisfies the hypotheses of
Sites, Lemma \ref{sites-lemma-bigger-site}.
Let $g : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$
be the associated morphism of topoi.
For any abelian sheaf $\mathcal{F}$ on $\mathcal{D}$ we have
isomorphisms
$$
R\Gamma(\mathcal{C}, g^{-1}\mathcal{F}) = R\Gamma(\mathcal{D}, \mathcal{F}),
$$
in particular
$H^p(\mathcal{C}, g^{-1}\mathcal{F}) = H^p(\mathcal{D}, \mathcal{F})$
and for any $U \in \Ob(\mathcal{C})$ we have isomorphisms
$$
R\Gamma(U, g^{-1}\mathcal{F}) = R\Gamma(u(U), \mathcal{F}),
$$
in particular
$H^p(U, g^{-1}\mathcal{F}) = H^p(u(U), \mathcal{F})$. All of these
isomorphisms are functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
Since it is clear that
$\Gamma(\mathcal{C}, g^{-1}\mathcal{F}) = \Gamma(\mathcal{D}, \mathcal{F})$
by hypothesis (e), it suffices to show that $g^{-1}$ transforms injective
abelian sheaves into injective abelian sheaves. As usual we use
Homology, Lemma \ref{homology-lemma-adjoint-preserve-injectives}
to see this. The left adjoint to $g^{-1}$ is $g_! = f^{-1}$ with the
notation of
Sites, Lemma \ref{sites-lemma-bigger-site}
which is an exact functor. Hence the lemma does indeed apply.
\end{proof}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
Let $\varphi : U \to V$ be a morphism of $\mathcal{O}$.
Then there is a canonical {\it restriction mapping}
\begin{equation}
\label{equation-restriction-mapping}
H^n(V, \mathcal{F})
\longrightarrow
H^n(U, \mathcal{F}), \quad
\xi \longmapsto \xi|_U
\end{equation}
functorial in $\mathcal{F}$. Namely, choose any injective
resolution $\mathcal{F} \to \mathcal{I}^\bullet$. The restriction
mappings of the sheaves $\mathcal{I}^p$ give a morphism of complexes
$$
\Gamma(V, \mathcal{I}^\bullet)
\longrightarrow
\Gamma(U, \mathcal{I}^\bullet)
$$
The LHS is a complex representing $R\Gamma(V, \mathcal{F})$
and the RHS is a complex representing $R\Gamma(U, \mathcal{F})$.
We get the map on cohomology groups by applying the functor $H^n$.
As indicated we will use the notation $\xi \mapsto \xi|_U$ to denote this map.
Thus the rule $U \mapsto H^n(U, \mathcal{F})$ is a presheaf of
$\mathcal{O}$-modules. This presheaf is customarily denoted
$\underline{H}^n(\mathcal{F})$. We will give another interpretation
of this presheaf in Lemma \ref{lemma-include}.

\medskip\noindent
The following lemma says that it is possible to kill higher cohomology
classes by going to a covering.

\begin{lemma}
\label{lemma-kill-cohomology-class-on-covering}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
Let $U$ be an object of $\mathcal{C}$.
Let $n > 0$ and let $\xi \in H^n(U, \mathcal{F})$.
Then there exists a covering $\{U_i \to U\}$ of $\mathcal{C}$
such that $\xi|_{U_i} = 0$ for all $i \in I$.
\end{lemma}

\begin{proof}
Let $\mathcal{F} \to \mathcal{I}^\bullet$ be an injective resolution.
Then
$$
H^n(U, \mathcal{F}) =
\frac{\Ker(\mathcal{I}^n(U) \to \mathcal{I}^{n + 1}(U))}
{\Im(\mathcal{I}^{n - 1}(U) \to \mathcal{I}^n(U))}.
$$
Pick an element $\tilde \xi \in \mathcal{I}^n(U)$ representing the
cohomology class in the presentation above. Since $\mathcal{I}^\bullet$
is an injective resolution of $\mathcal{F}$ and $n > 0$ we see that
the complex $\mathcal{I}^\bullet$ is exact in degree $n$. Hence
$\Im(\mathcal{I}^{n - 1} \to \mathcal{I}^n) =
\Ker(\mathcal{I}^n \to \mathcal{I}^{n + 1})$ as sheaves.
Since $\tilde \xi$ is a section of the kernel sheaf over $U$
we conclude there exists a covering $\{U_i \to U\}$ of the site
such that $\tilde \xi|_{U_i}$ is the image under $d$ of a section
$\xi_i \in \mathcal{I}^{n - 1}(U_i)$. By our definition of the
restriction $\xi|_{U_i}$ as corresponding to the class of
$\tilde \xi|_{U_i}$ we conclude.
\end{proof}

\begin{lemma}
\label{lemma-higher-direct-images}
Let $f : (\mathcal{C}, \mathcal{O}_\mathcal{C}) \to
(\mathcal{D}, \mathcal{O}_\mathcal{D})$ be a morphism of ringed sites
corresponding to the continuous functor $u : \mathcal{D} \to \mathcal{C}$.
For any $\mathcal{F} \in \Ob(\textit{Mod}(\mathcal{O}_\mathcal{C}))$
the sheaf $R^if_*\mathcal{F}$ is the sheaf associated to the
presheaf
$$
V \longmapsto H^i(u(V), \mathcal{F})
$$
\end{lemma}

\begin{proof}
Let $\mathcal{F} \to \mathcal{I}^\bullet$ be an injective resolution.
Then $R^if_*\mathcal{F}$ is by definition the $i$th cohomology sheaf
of the complex
$$
f_*\mathcal{I}^0 \to f_*\mathcal{I}^1 \to f_*\mathcal{I}^2 \to \ldots
$$
By definition of the abelian category structure on
$\mathcal{O}_\mathcal{D}$-modules
this cohomology sheaf is the sheaf associated to the presheaf
$$
V
\longmapsto
\frac{\Ker(f_*\mathcal{I}^i(V) \to f_*\mathcal{I}^{i + 1}(V))}
{\Im(f_*\mathcal{I}^{i - 1}(V) \to f_*\mathcal{I}^i(V))}
$$
and this is obviously equal to
$$
\frac{\Ker(\mathcal{I}^i(u(V)) \to \mathcal{I}^{i + 1}(u(V)))}
{\Im(\mathcal{I}^{i - 1}(u(V)) \to \mathcal{I}^i(u(V)))}
$$
which is equal to $H^i(u(V), \mathcal{F})$
and we win.
\end{proof}






\section{The {\v C}ech complex and {\v C}ech cohomology}
\label{section-cech}

\noindent
Let $\mathcal{C}$ be a category. Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$
be a family of morphisms with fixed target, see
Sites, Definition \ref{sites-definition-family-morphisms-fixed-target}.
Assume that all fibre products $U_{i_0} \times_U \ldots \times_U U_{i_p}$
exist in $\mathcal{C}$. Let $\mathcal{F}$ be an abelian presheaf on
$\mathcal{C}$. Set
$$
\check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})
=
\prod\nolimits_{(i_0, \ldots, i_p) \in I^{p + 1}}
\mathcal{F}(U_{i_0} \times_U \ldots \times_U U_{i_p}).
$$
This is an abelian group. For
$s \in \check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})$ we denote
$s_{i_0\ldots i_p}$ its value in the factor
$\mathcal{F}(U_{i_0} \times_U \ldots \times_U U_{i_p})$.
We define
$$
d : \check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}^{p + 1}(\mathcal{U}, \mathcal{F})
$$
by the formula
\begin{equation}
\label{equation-d-cech}
d(s)_{i_0\ldots i_{p + 1}} =
\sum\nolimits_{j = 0}^{p + 1}
(-1)^j s_{i_0\ldots \hat i_j \ldots i_p}
|_{U_{i_0} \times_U \ldots \times_U U_{i_{p + 1}}}
\end{equation}
where the restriction is via the projection map
$$
U_{i_0} \times_U \ldots \times_U U_{i_{p + 1}} \longrightarrow
U_{i_0} \times_U \ldots \times_U \widehat{U_{i_j}} \times_U
\ldots \times_U U_{i_{p + 1}}.
$$
It is straightforward to see that $d \circ d = 0$. In other words
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$ is a complex.

\begin{definition}
\label{definition-cech-complex}
Let $\mathcal{C}$ be a category. Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$
be a family of morphisms with fixed target such that all fibre products
$U_{i_0} \times_U \ldots \times_U U_{i_p}$ exist in $\mathcal{C}$.
Let $\mathcal{F}$ be an abelian presheaf on $\mathcal{C}$.
The complex $\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$
is the {\it {\v C}ech complex} associated to $\mathcal{F}$ and the
family $\mathcal{U}$. Its cohomology groups
$H^i(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}))$ are
called the {\it {\v C}ech cohomology groups} of $\mathcal{F}$ with respect
to $\mathcal{U}$. They are denoted $\check H^i(\mathcal{U}, \mathcal{F})$.
\end{definition}

\noindent
We observe that any covering $\{U_i \to U\}$ of a site $\mathcal{C}$
is a family of morphisms with fixed target to which the definition applies.

\begin{lemma}
\label{lemma-cech-h0}
Let $\mathcal{C}$ be a site.
Let $\mathcal{F}$ be an abelian presheaf on $\mathcal{C}$.
The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is an abelian sheaf on $\mathcal{C}$ and
\item for every covering $\mathcal{U} = \{U_i \to U\}_{i \in I}$
of the site $\mathcal{C}$ the natural map
$$
\mathcal{F}(U) \to \check{H}^0(\mathcal{U}, \mathcal{F})
$$
(see Sites, Section \ref{sites-section-sheafification}) is bijective.
\end{enumerate}
\end{lemma}

\begin{proof}
This is true since the sheaf condition is exactly that
$\mathcal{F}(U) \to \check{H}^0(\mathcal{U}, \mathcal{F})$
is bijective for every covering of $\mathcal{C}$.
\end{proof}

\noindent
Let $\mathcal{C}$ be a category. Let $\mathcal{U} = \{U_i \to U\}_{i\in I}$
be a family of morphisms of $\mathcal{C}$ with fixed target such that
all fibre products $U_{i_0} \times_U \ldots \times_U U_{i_p}$ exist in
$\mathcal{C}$. Let $\mathcal{V} = \{V_j \to V\}_{j\in J}$ be another.
Let $f : U \to V$, $\alpha : I \to J$ and $f_i : U_i \to V_{\alpha(i)}$
be a morphism of families of morphisms with fixed target, see
Sites, Section \ref{sites-section-refinements}.
In this case we get a map of {\v C}ech complexes
\begin{equation}
\label{equation-map-cech-complexes}
\varphi : \check{\mathcal{C}}^\bullet(\mathcal{V}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\end{equation}
which in degree $p$ is given by
$$
\varphi(s)_{i_0 \ldots i_p} =
(f_{i_0} \times \ldots \times f_{i_p})^*s_{\alpha(i_0) \ldots \alpha(i_p)}
$$


\section{{\v C}ech cohomology as a functor on presheaves}
\label{section-cech-functor}

\noindent
Warning: In this section we work exclusively with abelian presheaves
on a category. The results are completely wrong in the
setting of sheaves and categories of sheaves!

\medskip\noindent
Let $\mathcal{C}$ be a category. Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$
be a family of morphisms with fixed target such that all fibre products
$U_{i_0} \times_U \ldots \times_U U_{i_p}$ exist in $\mathcal{C}$.
Let $\mathcal{F}$ be an abelian presheaf on $\mathcal{C}$.
The construction
$$
\mathcal{F} \longmapsto \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
$$
is functorial in $\mathcal{F}$. In fact, it is a functor
\begin{equation}
\label{equation-cech-functor}
\check{\mathcal{C}}^\bullet(\mathcal{U}, -) :
\textit{PAb}(\mathcal{C})
\longrightarrow
\text{Comp}^{+}(\textit{Ab})
\end{equation}
see
Derived Categories, Definition \ref{derived-definition-complexes-notation}
for notation. Recall that the category of bounded below complexes
in an abelian category is an abelian category, see
Homology, Lemma \ref{homology-lemma-cat-cochain-abelian}.

\begin{lemma}
\label{lemma-cech-exact-presheaves}
The functor given by Equation (\ref{equation-cech-functor})
is an exact functor (see Homology, Lemma \ref{homology-lemma-exact-functor}).
\end{lemma}

\begin{proof}
For any object $W$ of $\mathcal{C}$ the functor
$\mathcal{F} \mapsto \mathcal{F}(W)$ is an additive exact functor
from $\textit{PAb}(\mathcal{C})$ to $\textit{Ab}$.
The terms $\check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})$
of the complex are products of these exact functors and hence exact.
Moreover a sequence of complexes is exact if and only if the sequence
of terms in a given degree is exact. Hence the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-cech-cohomology-delta-functor-presheaves}
Let $\mathcal{C}$ be a category.
Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$ be a family of morphisms
with fixed target such that all fibre products
$U_{i_0} \times_U \ldots \times_U U_{i_p}$ exist in $\mathcal{C}$.
The functors $\mathcal{F} \mapsto \check{H}^n(\mathcal{U}, \mathcal{F})$
form a $\delta$-functor from the abelian category $\textit{PAb}(\mathcal{C})$
to the category of $\mathbf{Z}$-modules (see
Homology, Definition \ref{homology-definition-cohomological-delta-functor}).
\end{lemma}

\begin{proof}
By
Lemma \ref{lemma-cech-exact-presheaves}
a short exact sequence of abelian presheaves
$0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0$
is turned into a short exact sequence of complexes of
$\mathbf{Z}$-modules. Hence we can use
Homology, Lemma \ref{homology-lemma-long-exact-sequence-cochain}
to get the boundary maps
$\delta_{\mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3} :
\check{H}^n(\mathcal{U}, \mathcal{F}_3) \to
\check{H}^{n + 1}(\mathcal{U}, \mathcal{F}_1)$
and a corresponding long exact sequence. We omit the verification
that these maps are compatible with maps between short exact
sequences of presheaves.
\end{proof}

\begin{lemma}
\label{lemma-cech-map-into}
Let $\mathcal{C}$ be a category. Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$
be a family of morphisms with fixed target such that all fibre products
$U_{i_0} \times_U \ldots \times_U U_{i_p}$ exist in $\mathcal{C}$.
Consider the chain complex $\mathbf{Z}_{\mathcal{U}, \bullet}$
of abelian presheaves
$$
\ldots
\to
\bigoplus_{i_0i_1i_2} \mathbf{Z}_{U_{i_0} \times_U U_{i_1} \times_U U_{i_2}}
\to
\bigoplus_{i_0i_1} \mathbf{Z}_{U_{i_0} \times_U U_{i_1}}
\to
\bigoplus_{i_0} \mathbf{Z}_{U_{i_0}}
\to 0 \to \ldots
$$
where the last nonzero term is placed in degree $0$
and where the map
$$
\mathbf{Z}_{U_{i_0} \times_U \ldots \times_u U_{i_{p + 1}}}
\longrightarrow
\mathbf{Z}_{U_{i_0} \times_U
\ldots \widehat{U_{i_j}} \ldots \times_U U_{i_{p + 1}}}
$$
is given by $(-1)^j$ times the canonical map.
Then there is an isomorphism
$$
\Hom_{\textit{PAb}(\mathcal{C})}(\mathbf{Z}_{{U}, \bullet}, \mathcal{F})
=
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
$$
functorial in $\mathcal{F} \in \Ob(\textit{PAb}(\mathcal{C}))$.
\end{lemma}

\begin{proof}
This is a tautology based on the fact that
\begin{align*}
\Hom_{\textit{PAb}(\mathcal{C})}(
\bigoplus_{i_0 \ldots i_p}
\mathbf{Z}_{U_{i_0} \times_U \ldots \times_U U_{i_p}},
\mathcal{F})
& =
\prod_{i_0 \ldots i_p}
\Hom_{\textit{PAb}(\mathcal{C})}(
\mathbf{Z}_{U_{i_0} \times_U \ldots \times_U U_{i_p}},
\mathcal{F}) \\
& =
\prod_{i_0 \ldots i_p}
\mathcal{F}(U_{i_0} \times_U \ldots \times_U U_{i_p})
\end{align*}
see Modules on Sites, Lemma \ref{sites-modules-lemma-obvious-adjointness}.
\end{proof}

\begin{lemma}
\label{lemma-homology-complex}
Let $\mathcal{C}$ be a category. Let
$\mathcal{U} = \{f_i : U_i \to U\}_{i \in I}$ be a family of morphisms
with fixed target such that all fibre products
$U_{i_0} \times_U \ldots \times_U U_{i_p}$ exist in $\mathcal{C}$.
The chain complex $\mathbf{Z}_{\mathcal{U}, \bullet}$ of presheaves
of Lemma \ref{lemma-cech-map-into} above is exact in positive
degrees, i.e., the homology presheaves
$H_i(\mathbf{Z}_{\mathcal{U}, \bullet})$ are zero for $i > 0$.
\end{lemma}

\begin{proof}
Let $V$ be an object of $\mathcal{C}$. We have to show that the chain complex
of abelian groups $\mathbf{Z}_{\mathcal{U}, \bullet}(V)$ is exact in
degrees $> 0$. This is the complex
$$
\xymatrix{
\ldots \ar[d] \\
\bigoplus_{i_0i_1i_2}
\mathbf{Z}[
\Mor_\mathcal{C}(V, U_{i_0} \times_U U_{i_1} \times_U U_{i_2})
]
\ar[d] \\
\bigoplus_{i_0i_1}
\mathbf{Z}[
\Mor_\mathcal{C}(V, U_{i_0} \times_U U_{i_1})
]
\ar[d] \\
\bigoplus_{i_0}
\mathbf{Z}[
\Mor_\mathcal{C}(V, U_{i_0})
] \ar[d] \\
0
}
$$
For any morphism $\varphi : V \to U$ denote
$\Mor_\varphi(V, U_i) = \{\varphi_i : V \to U_i \mid
f_i \circ \varphi_i = \varphi\}$. We will use a similar notation
for $\Mor_\varphi(V, U_{i_0} \times_U \ldots \times_U U_{i_p})$.
Note that composing with the various projection maps between the
fibred products $U_{i_0} \times_U \ldots \times_U U_{i_p}$ preserves
these morphism sets. Hence we see that the complex above
is the same as the complex
$$
\xymatrix{
\ldots \ar[d] \\
\bigoplus_\varphi
\bigoplus_{i_0i_1i_2}
\mathbf{Z}[
\Mor_\varphi(V, U_{i_0} \times_U U_{i_1} \times_U U_{i_2})
]
\ar[d] \\
\bigoplus_\varphi
\bigoplus_{i_0i_1}
\mathbf{Z}[
\Mor_\varphi(V, U_{i_0} \times_U U_{i_1})
]
\ar[d] \\
\bigoplus_\varphi
\bigoplus_{i_0}
\mathbf{Z}[
\Mor_\varphi(V, U_{i_0})
] \ar[d] \\
0
}
$$
Next, we make the remark that we have
$$
\Mor_\varphi(V, U_{i_0} \times_U \ldots \times_U U_{i_p})
=
\Mor_\varphi(V, U_{i_0}) \times \ldots
\times \Mor_\varphi(V, U_{i_p})
$$
Using this and the fact that $\mathbf{Z}[A] \oplus \mathbf{Z}[B] =
\mathbf{Z}[A \amalg B]$ we see that the complex becomes
$$
\xymatrix{
\ldots \ar[d] \\
\bigoplus_\varphi
\mathbf{Z}\left[
\coprod_{i_0i_1i_2}
\Mor_\varphi(V, U_{i_0}) \times \Mor_\varphi(V, U_{i_2})
\right]
\ar[d] \\
\bigoplus_\varphi
\mathbf{Z}\left[
\coprod_{i_0i_1}
\Mor_\varphi(V, U_{i_0}) \times \Mor_\varphi(V, U_{i_1})
\right]
\ar[d] \\
\bigoplus_\varphi
\mathbf{Z}\left[
\coprod_{i_0}
\Mor_\varphi(V, U_{i_0})
\right] \ar[d] \\
0
}
$$
Finally, on setting $S_\varphi = \coprod_{i \in I} \Mor_\varphi(V, U_i)$
we see that we get
$$
\bigoplus\nolimits_\varphi \left(\ldots \to
\mathbf{Z}[S_\varphi \times S_\varphi \times S_\varphi] \to
\mathbf{Z}[S_\varphi \times S_\varphi] \to
\mathbf{Z}[S_\varphi] \to 0 \to \ldots
\right)
$$
Thus we have simplified our task. Namely, it suffices to show that
for any nonempty set $S$ the (extended) complex of free abelian groups
$$
\ldots \to
\mathbf{Z}[S \times S \times S] \to
\mathbf{Z}[S \times S] \to
\mathbf{Z}[S] \xrightarrow{\Sigma} \mathbf{Z} \to 0 \to \ldots
$$
is exact in all degrees. To see this fix an element $s \in S$, and
use the homotopy
$$
n_{(s_0, \ldots, s_p)} \longmapsto n_{(s, s_0, \ldots, s_p)}
$$
with obvious notations.
\end{proof}

\begin{lemma}
\label{lemma-complex-tensored-still-exact}
Let $\mathcal{C}$ be a category. Let
$\mathcal{U} = \{f_i : U_i \to U\}_{i \in I}$ be a family of morphisms
with fixed target such that all fibre products
$U_{i_0} \times_U \ldots \times_U U_{i_p}$ exist in $\mathcal{C}$.
Let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$.
The chain complex
$$
\mathbf{Z}_{\mathcal{U}, \bullet}
\otimes_{p, \mathbf{Z}}
\mathcal{O}
$$
is exact in positive degrees. Here $\mathbf{Z}_{\mathcal{U}, \bullet}$
is the cochain complex of Lemma \ref{lemma-cech-map-into}, and
the tensor product is over the constant presheaf of rings
with value $\mathbf{Z}$.
\end{lemma}

\begin{proof}
Let $V$ be an object of $\mathcal{C}$.
In the proof of Lemma \ref{lemma-homology-complex} we saw that
$\mathbf{Z}_{\mathcal{U}, \bullet}(V)$ is isomorphic as a complex
to a direct sum of complexes which are homotopic to $\mathbf{Z}$
placed in degree zero. Hence also
$\mathbf{Z}_{\mathcal{U}, \bullet}(V) \otimes_\mathbf{Z} \mathcal{O}(V)$
is isomorphic as a complex to a direct sum of complexes which are homotopic
to $\mathcal{O}(V)$ placed in degree zero.
Or you can use
Modules on Sites, Lemma \ref{sites-modules-lemma-flat-resolution-of-flat},
which applies since the presheaves $\mathbf{Z}_{\mathcal{U}, i}$ are flat,
and the proof of Lemma \ref{lemma-homology-complex} shows that
$H_0(\mathbf{Z}_{\mathcal{U}, \bullet})$ is a flat presheaf also.
\end{proof}

\begin{lemma}
\label{lemma-cech-cohomology-derived-presheaves}
Let $\mathcal{C}$ be a category. Let
$\mathcal{U} = \{f_i : U_i \to U\}_{i \in I}$ be a family of morphisms
with fixed target such that all fibre products
$U_{i_0} \times_U \ldots \times_U U_{i_p}$ exist in $\mathcal{C}$.
The {\v C}ech cohomology functors $\check{H}^p(\mathcal{U}, -)$
are canonically isomorphic as a $\delta$-functor to
the right derived functors of the functor
$$
\check{H}^0(\mathcal{U}, -) :
\textit{PAb}(\mathcal{C})
\longrightarrow
\textit{Ab}.
$$
Moreover, there is a functorial quasi-isomorphism
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
R\check{H}^0(\mathcal{U}, \mathcal{F})
$$
where the right hand side indicates the derived functor
$$
R\check{H}^0(\mathcal{U}, -) :
D^{+}(\textit{PAb}(\mathcal{C}))
\longrightarrow
D^{+}(\mathbf{Z})
$$
of the left exact functor $\check{H}^0(\mathcal{U}, -)$.
\end{lemma}

\begin{proof}
Note that the category of abelian presheaves has enough injectives, see
Injectives, Proposition \ref{injectives-proposition-presheaves-injectives}.
Note that $\check{H}^0(\mathcal{U}, -)$ is a left exact functor
from the category of abelian presheaves
to the category of $\mathbf{Z}$-modules.
Hence the derived functor and the right derived functor exist, see
Derived Categories, Section \ref{derived-section-right-derived-functor}.

\medskip\noindent
Let $\mathcal{I}$ be a injective abelian presheaf.
In this case the functor
$\Hom_{\textit{PAb}(\mathcal{C})}(-, \mathcal{I})$
is exact on $\textit{PAb}(\mathcal{C})$. By
Lemma \ref{lemma-cech-map-into} we have
$$
\Hom_{\textit{PAb}(\mathcal{C})}(
\mathbf{Z}_{\mathcal{U}, \bullet}, \mathcal{I})
=
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}).
$$
By Lemma \ref{lemma-homology-complex} we have that
$\mathbf{Z}_{\mathcal{U}, \bullet}$ is exact in positive degrees.
Hence by the exactness of Hom into $\mathcal{I}$ mentioned above we see
that $\check{H}^i(\mathcal{U}, \mathcal{I}) = 0$ for all
$i > 0$. Thus the $\delta$-functor $(\check{H}^n, \delta)$
(see Lemma \ref{lemma-cech-cohomology-delta-functor-presheaves})
satisfies the assumptions of
Homology, Lemma \ref{homology-lemma-efface-implies-universal},
and hence is a universal $\delta$-functor.

\medskip\noindent
By
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}
also the sequence $R^i\check{H}^0(\mathcal{U}, -)$
forms a universal $\delta$-functor. By the uniqueness of universal
$\delta$-functors, see
Homology, Lemma \ref{homology-lemma-uniqueness-universal-delta-functor}
we conclude that
$R^i\check{H}^0(\mathcal{U}, -) = \check{H}^i(\mathcal{U}, -)$.
This is enough for most applications
and the reader is suggested to skip the rest of the proof.

\medskip\noindent
Let $\mathcal{F}$ be any abelian presheaf on $\mathcal{C}$.
Choose an injective resolution $\mathcal{F} \to \mathcal{I}^\bullet$
in the category $\textit{PAb}(\mathcal{C})$.
Consider the double complex $A^{\bullet, \bullet}$ with terms
$$
A^{p, q} =
\check{\mathcal{C}}^p(\mathcal{U}, \mathcal{I}^q).
$$
Consider the simple complex $sA^\bullet$ associated to this double
complex. There is a map of complexes
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
sA^\bullet
$$
coming from the maps
$\check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})
\to A^{p, 0} = \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}^0)$
and there is a map of complexes
$$
\check{H}^0(\mathcal{U}, \mathcal{I}^\bullet)
\longrightarrow
sA^\bullet
$$
coming from the maps
$\check{H}^0(\mathcal{U}, \mathcal{I}^q) \to
A^{0, q} = \check{\mathcal{C}}^0(\mathcal{U}, \mathcal{I}^q)$.
Both of these maps are quasi-isomorphisms by an application of
Homology, Lemma \ref{homology-lemma-double-complex-gives-resolution}.
Namely, the columns of the double complex are exact in positive degrees
because the {\v C}ech complex as a functor is exact
(Lemma \ref{lemma-cech-exact-presheaves})
and the rows of the double complex are exact in positive degrees
since as we just saw the higher {\v C}ech cohomology groups of the injective
presheaves $\mathcal{I}^q$ are zero.
Since quasi-isomorphisms become invertible
in $D^{+}(\mathbf{Z})$ this gives the last displayed morphism
of the lemma. We omit the verification that this morphism is
functorial.
\end{proof}





\section{{\v C}ech cohomology and cohomology}
\label{section-cech-cohomology-cohomology}

\noindent
The relationship between cohomology and {\v C}ech cohomology comes from the fact
that the {\v C}ech cohomology of an injective abelian sheaf is zero. To see this
we note that an injective abelian sheaf is an injective abelian presheaf and
then we apply results in {\v C}ech cohomology in the preceding section.

\begin{lemma}
\label{lemma-injective-abelian-sheaf-injective-presheaf}
Let $\mathcal{C}$ be a site. An injective abelian sheaf is also injective as an
object in the category $\textit{PAb}(\mathcal{C})$.
\end{lemma}

\begin{proof}
Apply Homology, Lemma \ref{homology-lemma-adjoint-preserve-injectives}
to the categories $\mathcal{A} = \textit{Ab}(\mathcal{C})$,
$\mathcal{B} = \textit{PAb}(\mathcal{C})$, the inclusion functor
and sheafification. (See
Modules on Sites, Section \ref{sites-modules-section-abelian-sheaves} to see
that all assumptions of the lemma are satisfied.)
\end{proof}

\begin{lemma}
\label{lemma-injective-trivial-cech}
Let $\mathcal{C}$ be a site.
Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$ be a covering of $\mathcal{C}$.
Let $\mathcal{I}$ be an injective abelian sheaf, i.e., an injective
object of $\textit{Ab}(\mathcal{C})$.
Then
$$
\check{H}^p(\mathcal{U}, \mathcal{I}) =
\left\{
\begin{matrix}
\mathcal{I}(U) & \text{if} & p = 0 \\
0 & \text{if} & p > 0
\end{matrix}
\right.
$$
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-injective-abelian-sheaf-injective-presheaf}
we see that $\mathcal{I}$ is an injective object in
$\textit{PAb}(\mathcal{C})$.
Hence we can apply Lemma \ref{lemma-cech-cohomology-derived-presheaves}
(or its proof) to see the vanishing of higher {\v C}ech cohomology group.
For the zeroth see Lemma \ref{lemma-cech-h0}.
\end{proof}

\begin{lemma}
\label{lemma-cech-cohomology}
Let $\mathcal{C}$ be a site.
Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$ be a covering of $\mathcal{C}$.
There is a transformation
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, -)
\longrightarrow
R\Gamma(U, -)
$$
of functors
$\textit{Ab}(\mathcal{C}) \to D^{+}(\mathbf{Z})$.
In particular this gives a transformation of functors
$\check{H}^p(U, \mathcal{F}) \to H^p(U, \mathcal{F})$ for
$\mathcal{F}$ ranging over $\textit{Ab}(\mathcal{C})$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be an abelian sheaf. Choose an injective resolution
$\mathcal{F} \to \mathcal{I}^\bullet$. Consider the double complex
$A^{\bullet, \bullet}$ with terms
$A^{p, q} = \check{\mathcal{C}}^p(\mathcal{U}, \mathcal{I}^q)$.
Moreover, consider the associated simple complex
$sA^\bullet$, see
Homology, Definition \ref{homology-definition-associated-simple-complex}.
There is a map of complexes
$$
\alpha :
\Gamma(U, \mathcal{I}^\bullet)
\longrightarrow
sA^\bullet
$$
coming from the maps
$\mathcal{I}^q(U) \to \check{H}^0(\mathcal{U}, \mathcal{I}^q)$
and a map of complexes
$$
\beta :
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
sA^\bullet
$$
coming from the map $\mathcal{F} \to \mathcal{I}^0$.
We can apply
Homology, Lemma \ref{homology-lemma-double-complex-gives-resolution}
to see that $\alpha$ is a quasi-isomorphism.
Namely, Lemma \ref{lemma-injective-trivial-cech} implies that
the $q$th row of the double complex $A^{\bullet, \bullet}$ is a
resolution of $\Gamma(U, \mathcal{I}^q)$.
Hence $\alpha$ becomes invertible in $D^{+}(\mathbf{Z})$ and
the transformation of the lemma is the composition of $\beta$
followed by the inverse of $\alpha$. We omit the verification
that this is functorial.
\end{proof}

\begin{lemma}
\label{lemma-cech-h1}
Let $\mathcal{C}$ be a site. Let $\mathcal{G}$ be an abelian sheaf
on $\mathcal{C}$. Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$ be a
covering of $\mathcal{C}$. The map
$$
\check{H}^1(\mathcal{U}, \mathcal{G})
\longrightarrow
H^1(U, \mathcal{G})
$$
is injective and identifies $\check{H}^1(\mathcal{U}, \mathcal{G})$ via
the bijection of Lemma \ref{lemma-torsors-h1}
with the set of isomorphism classes of $\mathcal{G}|_U$-torsors
which restrict to trivial torsors over each $U_i$.
\end{lemma}

\begin{proof}
To see this we construct an inverse map. Namely, let $\mathcal{F}$ be a
$\mathcal{G}|_U$-torsor on $\mathcal{C}/U$ whose restriction to
$\mathcal{C}/U_i$ is trivial. By Lemma \ref{lemma-trivial-torsor}
this means there
exists a section $s_i \in \mathcal{F}(U_i)$. On $U_{i_0} \times_U U_{i_1}$
there is a unique section $s_{i_0i_1}$ of $\mathcal{G}$ such that
$s_{i_0i_1} \cdot s_{i_0}|_{U_{i_0} \times_U U_{i_1}} =
s_{i_1}|_{U_{i_0} \times_U U_{i_1}}$. An easy computation shows
that $s_{i_0i_1}$ is a {\v C}ech cocycle and that its class is well
defined (i.e., does not depend on the choice of the sections $s_i$).
The inverse maps the isomorphism class of $\mathcal{F}$ to the cohomology
class of the cocycle $(s_{i_0i_1})$.
We omit the verification that this map is indeed an inverse.
\end{proof}

\begin{lemma}
\label{lemma-include}
Let $\mathcal{C}$ be a site.
Consider the functor
$i : \textit{Ab}(\mathcal{C}) \to \textit{PAb}(\mathcal{C})$.
It is a left exact functor with right derived functors given by
$$
R^pi(\mathcal{F}) = \underline{H}^p(\mathcal{F}) :
U \longmapsto H^p(U, \mathcal{F})
$$
see discussion in Section \ref{section-locality}.
\end{lemma}

\begin{proof}
It is clear that $i$ is left exact.
Choose an injective resolution $\mathcal{F} \to \mathcal{I}^\bullet$.
By definition $R^pi$ is the $p$th cohomology {\it presheaf}
of the complex $\mathcal{I}^\bullet$. In other words, the
sections of $R^pi(\mathcal{F})$ over an object $U$ of $\mathcal{C}$
are given by
$$
\frac{\Ker(\mathcal{I}^n(U) \to \mathcal{I}^{n + 1}(U))}
{\Im(\mathcal{I}^{n - 1}(U) \to \mathcal{I}^n(U))}.
$$
which is the definition of $H^p(U, \mathcal{F})$.
\end{proof}

\begin{lemma}
\label{lemma-cech-spectral-sequence}
Let $\mathcal{C}$ be a site. Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$
be a covering of $\mathcal{C}$. For any abelian sheaf $\mathcal{F}$ there
is a spectral sequence $(E_r, d_r)_{r \geq 0}$ with
$$
E_2^{p, q} = \check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F}))
$$
converging to $H^{p + q}(U, \mathcal{F})$.
This spectral sequence is functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
This is a Grothendieck spectral sequence (see
Derived Categories, Lemma \ref{derived-lemma-grothendieck-spectral-sequence})
for the functors
$$
i :  \textit{Ab}(\mathcal{C}) \to \textit{PAb}(\mathcal{C})
\quad\text{and}\quad
\check{H}^0(\mathcal{U}, - ) : \textit{PAb}(\mathcal{C})
\to \textit{Ab}.
$$
Namely, we have $\check{H}^0(\mathcal{U}, i(\mathcal{F})) = \mathcal{F}(U)$
by Lemma \ref{lemma-cech-h0}. We have that $i(\mathcal{I})$ is
{\v C}ech acyclic by Lemma \ref{lemma-injective-trivial-cech}. And we
have that $\check{H}^p(\mathcal{U}, -) = R^p\check{H}^0(\mathcal{U}, -)$
as functors on $\textit{PAb}(\mathcal{C})$
by Lemma \ref{lemma-cech-cohomology-derived-presheaves}.
Putting everything together gives the lemma.
\end{proof}

\begin{lemma}
\label{lemma-cech-spectral-sequence-application}
Let $\mathcal{C}$ be a site.
Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$ be a covering.
Let $\mathcal{F} \in \Ob(\textit{Ab}(\mathcal{C}))$.
Assume that $H^i(U_{i_0} \times_U \ldots \times_U U_{i_p}, \mathcal{F}) = 0$
for all $i > 0$, all $p \geq 0$ and all $i_0, \ldots, i_p \in I$.
Then $\check{H}^p(\mathcal{U}, \mathcal{F}) = H^p(U, \mathcal{F})$.
\end{lemma}

\begin{proof}
We will use the spectral sequence of
Lemma \ref{lemma-cech-spectral-sequence}.
The assumptions mean that $E_2^{p, q} = 0$ for all $(p, q)$ with
$q \not = 0$. Hence the spectral sequence degenerates at $E_2$
and the result follows.
\end{proof}

\begin{lemma}
\label{lemma-ses-cech-h1}
Let $\mathcal{C}$ be a site.
Let
$$
0 \to \mathcal{F} \to \mathcal{G} \to \mathcal{H} \to 0
$$
be a short exact sequence of abelian sheaves on $\mathcal{C}$.
Let $U$ be an object of $\mathcal{C}$. If there exists a cofinal system
of coverings $\mathcal{U}$ of $U$ such that
$\check{H}^1(\mathcal{U}, \mathcal{F}) = 0$,
then the map $\mathcal{G}(U) \to \mathcal{H}(U)$ is
surjective.
\end{lemma}

\begin{proof}
Take an element $s \in \mathcal{H}(U)$. Choose a covering
$\mathcal{U} = \{U_i \to U\}_{i \in I}$ such that
(a) $\check{H}^1(\mathcal{U}, \mathcal{F}) = 0$ and (b)
$s|_{U_i}$ is the image of a section $s_i \in \mathcal{G}(U_i)$.
Since we can certainly find a covering such that (b) holds
it follows from the assumptions of the lemma that we can find
a covering such that (a) and (b) both hold.
Consider the sections
$$
s_{i_0i_1} =
s_{i_1}|_{U_{i_0} \times_U U_{i_1}} - s_{i_0}|_{U_{i_0} \times_U U_{i_1}}.
$$
Since $s_i$ lifts $s$ we see that
$s_{i_0i_1} \in \mathcal{F}(U_{i_0} \times_U U_{i_1})$.
By the vanishing of $\check{H}^1(\mathcal{U}, \mathcal{F})$ we can
find sections $t_i \in \mathcal{F}(U_i)$ such that
$$
s_{i_0i_1} =
t_{i_1}|_{U_{i_0} \times_U U_{i_1}} - t_{i_0}|_{U_{i_0} \times_U U_{i_1}}.
$$
Then clearly the sections $s_i - t_i$ satisfy the sheaf condition
and glue to a section of $\mathcal{G}$ over $U$ which maps to $s$.
Hence we win.
\end{proof}

\begin{lemma}
\label{lemma-cech-vanish-collection}
(Variant of Cohomology, Lemma \ref{cohomology-lemma-cech-vanish}.)
Let $\mathcal{C}$ be a site. Let $\text{Cov}_\mathcal{C}$ be the set
of coverings of $\mathcal{C}$ (see
Sites, Definition \ref{sites-definition-site}). Let
$\mathcal{B} \subset \Ob(\mathcal{C})$, and
$\text{Cov} \subset \text{Cov}_\mathcal{C}$
be subsets. Let $\mathcal{F}$ be an abelian sheaf on $\mathcal{C}$.
Assume that
\begin{enumerate}
\item For every $\mathcal{U} \in \text{Cov}$,
$\mathcal{U} = \{U_i \to U\}_{i \in I}$ we have
$U, U_i \in \mathcal{B}$ and every
$U_{i_0} \times_U \ldots \times_U U_{i_p} \in \mathcal{B}$.
\item For every $U \in \mathcal{B}$ the coverings of $U$
occurring in $\text{Cov}$ is a cofinal system of coverings of $U$.
\item For every $\mathcal{U} \in \text{Cov}$ we have
$\check{H}^p(\mathcal{U}, \mathcal{F}) = 0$ for all $p > 0$.
\end{enumerate}
Then $H^p(U, \mathcal{F}) = 0$ for all $p > 0$ and any $U \in \mathcal{B}$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ and $\text{Cov}$ be as in the lemma.
We will indicate this by saying ``$\mathcal{F}$ has vanishing higher
{\v C}ech cohomology for any $\mathcal{U} \in \text{Cov}$''.
Choose an embedding $\mathcal{F} \to \mathcal{I}$ into an
injective abelian sheaf.
By Lemma \ref{lemma-injective-trivial-cech} $\mathcal{I}$
has vanishing higher {\v C}ech cohomology for any $\mathcal{U} \in \text{Cov}$.
Let $\mathcal{Q} = \mathcal{I}/\mathcal{F}$
so that we have a short exact sequence
$$
0 \to \mathcal{F} \to \mathcal{I} \to \mathcal{Q} \to 0.
$$
By Lemma \ref{lemma-ses-cech-h1} and our assumption (2)
this sequence gives rise to an exact sequence
$$
0 \to \mathcal{F}(U) \to \mathcal{I}(U) \to \mathcal{Q}(U) \to 0.
$$
for every $U \in \mathcal{B}$. Hence for any $\mathcal{U} \in \text{Cov}$
we get a short exact sequence of {\v C}ech complexes
$$
0 \to
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) \to
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}) \to
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{Q}) \to 0
$$
since each term in the {\v C}ech complex is made up out of a product of
values over elements of $\mathcal{B}$ by assumption (1).
In particular we have a long exact sequence of {\v C}ech cohomology
groups for any covering $\mathcal{U} \in \text{Cov}$.
This implies that $\mathcal{Q}$ is also an abelian sheaf
with vanishing higher {\v C}ech cohomology for all
$\mathcal{U} \in \text{Cov}$.

\medskip\noindent
Next, we look at the long exact cohomology sequence
$$
\xymatrix{
0 \ar[r] &
H^0(U, \mathcal{F}) \ar[r] &
H^0(U, \mathcal{I}) \ar[r] &
H^0(U, \mathcal{Q}) \ar[lld] \\
&
H^1(U, \mathcal{F}) \ar[r] &
H^1(U, \mathcal{I}) \ar[r] &
H^1(U, \mathcal{Q}) \ar[lld] \\
&
\ldots & \ldots & \ldots \\
}
$$
for any $U \in \mathcal{B}$. Since $\mathcal{I}$ is injective we
have $H^n(U, \mathcal{I}) = 0$ for $n > 0$ (see
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}).
By the above we see that $H^0(U, \mathcal{I}) \to H^0(U, \mathcal{Q})$
is surjective and hence $H^1(U, \mathcal{F}) = 0$.
Since $\mathcal{F}$ was an arbitrary abelian sheaf with
vanishing higher {\v C}ech cohomology for all $\mathcal{U} \in \text{Cov}$
we conclude that also $H^1(U, \mathcal{Q}) = 0$ since $\mathcal{Q}$ is
another of these sheaves (see above). By the long exact sequence this in
turn implies that $H^2(U, \mathcal{F}) = 0$. And so on and so forth.
\end{proof}
















\section{Cohomology of modules}
\label{section-cohomology-modules}

\noindent
Everything that was said for cohomology of abelian sheaves
goes for cohomology of modules, since the two agree.

\begin{lemma}
\label{lemma-injective-module-injective-presheaf}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
An injective sheaf of modules is also injective as an
object in the category $\textit{PMod}(\mathcal{O})$.
\end{lemma}

\begin{proof}
Apply Homology, Lemma \ref{homology-lemma-adjoint-preserve-injectives}
to the categories $\mathcal{A} = \textit{Mod}(\mathcal{O})$,
$\mathcal{B} = \textit{PMod}(\mathcal{O})$, the inclusion functor
and sheafification. (See
Modules on Sites,
Section \ref{sites-modules-section-sheafification-presheaves-modules}
to see that all assumptions of the lemma are satisfied.)
\end{proof}

\begin{lemma}
\label{lemma-include-modules}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Consider the functor
$i : \textit{Mod}(\mathcal{C}) \to \textit{PMod}(\mathcal{C})$.
It is a left exact functor with right derived functors given by
$$
R^pi(\mathcal{F}) = \underline{H}^p(\mathcal{F}) :
U \longmapsto H^p(U, \mathcal{F})
$$
see discussion in
Section \ref{section-locality}.
\end{lemma}

\begin{proof}
It is clear that $i$ is left exact.
Choose an injective resolution $\mathcal{F} \to \mathcal{I}^\bullet$
in $\textit{Mod}(\mathcal{O})$.
By definition $R^pi$ is the $p$th cohomology {\it presheaf}
of the complex $\mathcal{I}^\bullet$. In other words, the
sections of $R^pi(\mathcal{F})$ over an object $U$ of $\mathcal{C}$
are given by
$$
\frac{\Ker(\mathcal{I}^n(U) \to \mathcal{I}^{n + 1}(U))}
{\Im(\mathcal{I}^{n - 1}(U) \to \mathcal{I}^n(U))}.
$$
which is the definition of $H^p(U, \mathcal{F})$.
\end{proof}

\begin{lemma}
\label{lemma-injective-module-trivial-cech}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{U} = \{U_i \to U\}_{i \in I}$ be a covering of $\mathcal{C}$.
Let $\mathcal{I}$ be an injective $\mathcal{O}$-module, i.e., an injective
object of $\textit{Mod}(\mathcal{O})$. Then
$$
\check{H}^p(\mathcal{U}, \mathcal{I}) =
\left\{
\begin{matrix}
\mathcal{I}(U) & \text{if} & p = 0 \\
0 & \text{if} & p > 0
\end{matrix}
\right.
$$
\end{lemma}

\begin{proof}
Lemma \ref{lemma-cech-map-into} gives the first equality in the following
sequence of equalities
\begin{align*}
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I})
& =
\Mor_{\textit{PAb}(\mathcal{C})}(
\mathbf{Z}_{\mathcal{U}, \bullet}, \mathcal{I}) \\
& =
\Mor_{\textit{PMod}(\mathbf{Z})}(
\mathbf{Z}_{\mathcal{U}, \bullet}, \mathcal{I}) \\
& =
\Mor_{\textit{PMod}(\mathcal{O})}(
\mathbf{Z}_{\mathcal{U}, \bullet} \otimes_{p, \mathbf{Z}} \mathcal{O},
\mathcal{I})
\end{align*}
The third equality by
Modules on Sites,
Lemma \ref{sites-modules-lemma-adjointness-tensor-restrict-presheaves}.
By Lemma \ref{lemma-injective-module-injective-presheaf}
we see that $\mathcal{I}$ is an injective object in
$\textit{PMod}(\mathcal{O})$.
Hence $\Hom_{\textit{PMod}(\mathcal{O})}(-, \mathcal{I})$
is an exact functor. By
Lemma \ref{lemma-complex-tensored-still-exact} we see the vanishing of
higher {\v C}ech cohomology groups.
For the zeroth see Lemma \ref{lemma-cech-h0}.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-modules-abelian-agree}
Let $\mathcal{C}$ be a site.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$.
Let $\mathcal{F}$ be an $\mathcal{O}$-module, and denote
$\mathcal{F}_{ab}$ the underlying sheaf of abelian groups.
Then we have
$$
H^i(\mathcal{C}, \mathcal{F}_{ab})
=
H^i(\mathcal{C}, \mathcal{F})
$$
and for any object $U$ of $\mathcal{C}$ we also have
$$
H^i(U, \mathcal{F}_{ab})
=
H^i(U, \mathcal{F}).
$$
Here the left hand side is cohomology computed in
$\textit{Ab}(\mathcal{C})$ and the right hand side
is cohomology computed in $\textit{Mod}(\mathcal{O})$.
\end{lemma}

\begin{proof}
By
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}
the $\delta$-functor $(\mathcal{F} \mapsto H^p(U, \mathcal{F}))_{p \geq 0}$
is universal. The functor
$\textit{Mod}(\mathcal{O}) \to \textit{Ab}(\mathcal{C})$,
$\mathcal{F} \mapsto \mathcal{F}_{ab}$ is exact. Hence
$(\mathcal{F} \mapsto H^p(U, \mathcal{F}_{ab}))_{p \geq 0}$
is a $\delta$-functor also. Suppose we show that
$(\mathcal{F} \mapsto H^p(U, \mathcal{F}_{ab}))_{p \geq 0}$
is also universal. This will imply the second statement of the lemma
by uniqueness of universal $\delta$-functors, see
Homology, Lemma \ref{homology-lemma-uniqueness-universal-delta-functor}.
Since $\textit{Mod}(\mathcal{O})$ has enough injectives,
it suffices to show that $H^i(U, \mathcal{I}_{ab}) = 0$
for any injective object $\mathcal{I}$ in $\textit{Mod}(\mathcal{O})$, see
Homology, Lemma \ref{homology-lemma-efface-implies-universal}.

\medskip\noindent
Let $\mathcal{I}$ be an injective object of $\textit{Mod}(\mathcal{O})$.
Apply Lemma \ref{lemma-cech-vanish-collection}
with $\mathcal{F} = \mathcal{I}$, $\mathcal{B} = \mathcal{C}$
and $\text{Cov} = \text{Cov}_\mathcal{C}$.
Assumption (3) of that lemma holds by
Lemma \ref{lemma-injective-module-trivial-cech}.
Hence we see that $H^i(U, \mathcal{I}_{ab}) = 0$
for every object $U$ of $\mathcal{C}$.

\medskip\noindent
If $\mathcal{C}$ has a final
object then this also implies the first equality. If not, then
according to Sites, Lemma \ref{sites-lemma-topos-good-site} we see that
the ringed topos $(\Sh(\mathcal{C}), \mathcal{O})$ is equivalent to a
ringed topos where the underlying site does have a final object.
Hence the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-products}
Let $\mathcal{C}$ be a site. Let $I$ be a set. For $i \in I$ let 
$\mathcal{F}_i$ be an abelian sheaf on $\mathcal{C}$. Let
$U \in \Ob(\mathcal{C})$. The canonical map
$$
H^p(U, \prod\nolimits_{i \in I} \mathcal{F}_i)
\longrightarrow
\prod\nolimits_{i \in I} H^p(U, \mathcal{F}_i)
$$
is an isomorphism for $p = 0$ and injective for $p = 1$.
\end{lemma}

\begin{proof}
The statement for $p = 0$ is true because the product of sheaves
is equal to the product of the underlying presheaves, see
Sites, Lemma \ref{sites-lemma-limit-sheaf}.
Proof for $p = 1$. Set $\mathcal{F} = \prod \mathcal{F}_i$.
Let $\xi \in H^1(U, \mathcal{F})$ map to zero in
$\prod H^1(U, \mathcal{F}_i)$. By locality of cohomology, see
Lemma \ref{lemma-kill-cohomology-class-on-covering},
there exists a covering $\mathcal{U} = \{U_j \to U\}$ such that
$\xi|_{U_j} = 0$ for all $j$. By Lemma \ref{lemma-cech-h1} this means
$\xi$ comes from an element
$\check \xi \in \check H^1(\mathcal{U}, \mathcal{F})$.
Since the maps
$\check H^1(\mathcal{U}, \mathcal{F}_i) \to H^1(U, \mathcal{F}_i)$
are injective for all $i$ (by Lemma \ref{lemma-cech-h1}), and since
the image of $\xi$ is zero in $\prod H^1(U, \mathcal{F}_i)$ we see
that the image
$\check \xi_i = 0$ in $\check H^1(\mathcal{U}, \mathcal{F}_i)$.
However, since $\mathcal{F} = \prod \mathcal{F}_i$ we see that
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$ is the
product of the complexes
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}_i)$,
hence by
Homology, Lemma \ref{homology-lemma-product-abelian-groups-exact}
we conclude that $\check \xi = 0$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-restriction-along-monomorphism-surjective}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $a : U' \to U$ be a
monomorphism in $\mathcal{C}$. Then for any injective $\mathcal{O}$-module
$\mathcal{I}$ the restriction mapping $\mathcal{I}(U) \to \mathcal{I}(U')$
is surjective.
\end{lemma}

\begin{proof}
Let $j : \mathcal{C}/U \to \mathcal{C}$ and
$j' : \mathcal{C}/U' \to \mathcal{C}$ be the localization morphisms
(Modules on Sites, Section \ref{sites-modules-section-localize}).
Since $j_!$ is a left adjoint to restriction we see that
for any sheaf $\mathcal{F}$ of $\mathcal{O}$-modules
$$
\Hom_\mathcal{O}(j_!\mathcal{O}_U, \mathcal{F})
=
\Hom_{\mathcal{O}_U}(\mathcal{O}_U, \mathcal{F}|_U)
=
\mathcal{F}(U)
$$
Similarly, the sheaf $j'_!\mathcal{O}_{U'}$ represents the
functor $\mathcal{F} \mapsto \mathcal{F}(U')$.
Moreover below we describe a canonical map of $\mathcal{O}$-modules
$$
j'_!\mathcal{O}_{U'} \longrightarrow j_!\mathcal{O}_U
$$
which corresponds to the restriction mapping
$\mathcal{F}(U) \to \mathcal{F}(U')$ via Yoneda's lemma
(Categories, Lemma \ref{categories-lemma-yoneda}).
It suffices to prove the displayed map of modules is injective, see
Homology, Lemma \ref{homology-lemma-characterize-injectives}.

\medskip\noindent
To construct our map it suffices to construct a map between the
presheaves which assign to an object $V$ of $\mathcal{C}$ the
$\mathcal{O}(V)$-module
$$
\bigoplus\nolimits_{\varphi' \in \Mor_\mathcal{C}(V, U')} \mathcal{O}(V)
\quad\text{and}\quad
\bigoplus\nolimits_{\varphi \in \Mor_\mathcal{C}(V, U)} \mathcal{O}(V)
$$
see Modules on Sites, Lemma \ref{sites-modules-lemma-extension-by-zero}.
We take the map which maps the summand corresponding to $\varphi'$
to the summand corresponding to $\varphi = a \circ \varphi'$
by the identity map on $\mathcal{O}(V)$. As $a$ is a monomorphism,
this map is injective. As sheafification is exact, the result
follows.
\end{proof}






\section{Limp sheaves}
\label{section-limp}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $K$ be a sheaf of sets on $\mathcal{C}$ (we intentionally use a
roman capital here to distinguish from abelian sheaves).
Given an abelian sheaf $\mathcal{F}$ we denote
$\mathcal{F}(K) = \Mor_{\Sh(\mathcal{C})}(K, \mathcal{F})$.
The functor $\mathcal{F} \mapsto \mathcal{F}(K)$ is a left exact functor
$\textit{Mod}(\mathcal{O}) \to \textit{Ab}$ hence we have its
right derived functors. We will denote these $H^p(K, \mathcal{F})$
so that $H^0(K, \mathcal{F}) = \mathcal{F}(K)$.

\medskip\noindent
We mention two special cases. The first is the case where
$K = h_U^\#$ for some object $U$ of $\mathcal{C}$. In this case
$H^p(K, \mathcal{F}) = H^p(U, \mathcal{F})$, because
$\Mor_{\Sh(\mathcal{C})}(h_U^\#, \mathcal{F}) = \mathcal{F}(U)$, see
Sites, Section \ref{sites-section-representable-sheaves}.
The second is the case $\mathcal{O} = \mathbf{Z}$ (the constant
sheaf). In this case the cohomology groups are functors
$H^p(K, - ) : \textit{Ab}(\mathcal{C}) \to \textit{Ab}$.
Here is the analogue of
Lemma \ref{lemma-cohomology-modules-abelian-agree}.

\begin{lemma}
\label{lemma-compute-cohomology-on-sheaf-sets}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $K$ be a sheaf of sets on $\mathcal{C}$.
Let $\mathcal{F}$ be an $\mathcal{O}$-module and denote
$\mathcal{F}_{ab}$ the underlying sheaf of abelian groups.
Then $H^p(K, \mathcal{F}) = H^p(K, \mathcal{F}_{ab})$.
\end{lemma}

\begin{proof}
Note that both $H^p(K, \mathcal{F})$ and $H^p(K, \mathcal{F}_{ab})$
depend only on the topos, not on the underlying site. Hence by
Sites, Lemma \ref{sites-lemma-topos-good-site}
we may replace $\mathcal{C}$ by a ``larger'' site such
that $K = h_U$ for some object $U$ of $\mathcal{C}$.
In this case the result follows from
Lemma \ref{lemma-cohomology-modules-abelian-agree}.
\end{proof}

\begin{lemma}
\label{lemma-cech-to-cohomology-sheaf-sets}
Let $\mathcal{C}$ be a site. Let $K' \to K$ be a surjective
map of sheaves of sets on $\mathcal{C}$. Set
$K'_p = K' \times_K \ldots \times_K K'$ ($p + 1$-factors).
For every abelian sheaf $\mathcal{F}$ there is a spectral sequence
with $E_1^{p, q} = H^q(K'_p, \mathcal{F})$ converging to
$H^{p + q}(K, \mathcal{F})$.
\end{lemma}

\begin{proof}
After replacing $\mathcal{C}$ by a ``larger'' site as in
Sites, Lemma \ref{sites-lemma-topos-good-site} 
we may assume that $K, K'$ are objects of $\mathcal{C}$ and that
$\mathcal{U} = \{K' \to K\}$ is a covering. Then we have the {\v C}ech
to cohomology spectral sequence of Lemma \ref{lemma-cech-spectral-sequence}
whose $E_1$ page is as indicated in the statement of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-on-sheaf-sets}
Let $\mathcal{C}$ be a site. Let $K$ be a sheaf of sets on $\mathcal{C}$.
Consider the morphism of topoi
$j : \Sh(\mathcal{C}/K) \to \Sh(\mathcal{C})$, see
Sites, Lemma \ref{sites-lemma-localize-topos-site}.
Then $j^{-1}$ preserves injectives and
$H^p(K, \mathcal{F}) = H^p(\mathcal{C}/K, j^{-1}\mathcal{F})$
for any abelian sheaf $\mathcal{F}$ on $\mathcal{C}$.
\end{lemma}

\begin{proof}
By
Sites, Lemmas \ref{sites-lemma-localize-topos} and
\ref{sites-lemma-localize-topos-site}
the morphism of topoi $j$ is
equivalent to a localization. Hence this follows from
Lemma \ref{lemma-cohomology-of-open}.
\end{proof}

\noindent
Keeping in mind Lemma \ref{lemma-compute-cohomology-on-sheaf-sets}
we see that the following definition is the ``correct one'' also
for sheaves of modules on ringed sites.

\begin{definition}
\label{definition-limp}
Let $\mathcal{C}$ be a site.
We say an abelian sheaf $\mathcal{F}$ is
{\it limp}\footnote{This is probably nonstandard notation. Please email
\href{mailto:stacks.project@gmail.com}{stacks.project@gmail.com}
if you know the correct terminology.}
if for every sheaf of sets $K$ we have $H^p(K, \mathcal{F}) = 0$
for all $p \geq 1$.
\end{definition}

\noindent
It is clear that being limp is an intrinsic property, i.e.,
preserved under equivalences of topoi.
A limp sheaf has vanishing higher cohomology on all objects of the site,
but in general the condition of being limp is strictly stronger.
Here is a characterization of limp sheaves which is sometimes useful.

\begin{lemma}
\label{lemma-characterize-limp}
Let $\mathcal{C}$ be a site. Let $\mathcal{F}$ be an abelian sheaf. If
\begin{enumerate}
\item $H^p(U, \mathcal{F}) = 0$ for $p> 0$ and $U \in \Ob(\mathcal{C})$, and
\item for every surjection $K' \to K$ of sheaves of sets the
extended {\v C}ech complex
$$
0 \to H^0(K, \mathcal{F}) \to H^0(K', \mathcal{F}) \to
H^0(K' \times_K K', \mathcal{F}) \to \ldots
$$
is exact,
\end{enumerate}
then $\mathcal{F}$ is limp (and the converse holds too).
\end{lemma}

\begin{proof}
By assumption (1) we have $H^p(h_U^\#, g^{-1}\mathcal{I}) = 0$ for all
$p > 0$ and all objects $U$ of $\mathcal{C}$. Note that if
$K = \coprod K_i$ is a coproduct of sheaves of sets on $\mathcal{C}$
then $H^p(K, g^{-1}\mathcal{I}) = \prod H^p(K_i, g^{-1}\mathcal{I})$.
For any sheaf of sets $K$ there exists a surjection
$$
K' = \coprod h_{U_i}^\# \longrightarrow K
$$
see Sites, Lemma \ref{sites-lemma-sheaf-coequalizer-representable}.
Thus we conclude that: (*) for every sheaf of sets $K$ there exists a
surjection $K' \to K$ of sheaves of sets such that $H^p(K', \mathcal{F}) = 0$
for $p > 0$. We claim that (*) and condition (2) imply that $\mathcal{F}$
is limp. Note that conditions (*) and (2) only depend on $\mathcal{F}$ as an
object of the topos $\Sh(\mathcal{C})$ and not on the underlying site.
(We will not use property (1) in the rest of the proof.)

\medskip\noindent
We are going to prove by induction on $n \geq 0$ that (*) and (2)
imply the following induction hypothesis $IH_n$:
$H^p(K, \mathcal{F}) = 0$ for all $0 < p \leq n$ and
all sheaves of sets $K$. Note that $IH_0$ holds. Assume $IH_n$. Pick
a sheaf of sets $K$. Pick a surjection $K' \to K$ such that
$H^p(K', \mathcal{F}) = 0$ for all $p > 0$. We have a
spectral sequence with
$$
E_1^{p, q} = H^q(K'_p, \mathcal{F})
$$
covering to $H^{p + q}(K, \mathcal{F})$, see
Lemma \ref{lemma-cech-to-cohomology-sheaf-sets}.
By $IH_n$ we see that $E_1^{p, q} = 0$ for $0 < q \leq n$ and by
assumption (2) we see that $E_2^{p, 0} = 0$ for $p > 0$. Finally, we have
$E_1^{0, q} = 0$ for $q > 0$ because $H^q(K', \mathcal{F}) = 0$ by
choice of $K'$. Hence we conclude that $H^{n + 1}(K, \mathcal{F}) = 0$
because all the terms $E_2^{p, q}$ with $p + q = n + 1$ are zero.
\end{proof}







\section{The Leray spectral sequence}
\label{section-leray}

\noindent
The key to proving the existence of the Leray spectral sequence is
the following lemma.

\begin{lemma}
\label{lemma-direct-image-injective-sheaf}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi.
Then for any injective object $\mathcal{I}$ in
$\textit{Mod}(\mathcal{O}_\mathcal{C})$
the pushforward $f_*\mathcal{I}$ is limp.
\end{lemma}

\begin{proof}
Let $K$ be a sheaf of sets on $\mathcal{D}$.
By
Modules on Sites, Lemma
\ref{sites-modules-lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
we may replace $\mathcal{C}$, $\mathcal{D}$ by ``larger'' sites such
that $f$ comes from a morphism of ringed sites induced by a continuous
functor $u : \mathcal{D} \to \mathcal{C}$ such that
$K = h_V$ for some object $V$ of $\mathcal{D}$.

\medskip\noindent
Thus we have to show that $H^q(V, f_*\mathcal{I})$ is zero
for $q > 0$ and all objects $V$ of $\mathcal{D}$ when $f$ is given
by a morphism of ringed sites. Let $\mathcal{V} = \{V_j \to V\}$
be any covering of $\mathcal{D}$. Since $u$ is continuous we see that
$\mathcal{U} = \{u(V_j) \to u(v)\}$ is a covering of $\mathcal{C}$.
Then we have an equality of {\v C}ech complexes
$$
\check{\mathcal{C}}^\bullet(\mathcal{V}, f_*\mathcal{I})
=
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I})
$$
by the definition of $f_*$. By
Lemma \ref{lemma-injective-module-trivial-cech}
we see that the cohomology of this complex is zero in positive degrees.
We win by
Lemma \ref{lemma-cech-vanish-collection}.
\end{proof}

\noindent
For flat morphisms the functor $f_*$ preserves injective modules.
In particular the functor
$f_* : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$ always
 transforms injective
abelian sheaves into injective abelian sheaves.

\begin{lemma}
\label{lemma-pushforward-injective-flat}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi.
If $f$ is flat, then $f_*\mathcal{I}$ is an injective
$\mathcal{O}_\mathcal{D}$-module
for any injective $\mathcal{O}_\mathcal{C}$-module $\mathcal{I}$.
\end{lemma}

\begin{proof}
In this case the functor $f^*$ is exact, see
Modules on Sites, Lemma \ref{sites-modules-lemma-flat-pullback-exact}.
Hence the result follows from
Homology, Lemma \ref{homology-lemma-adjoint-preserve-injectives}.
\end{proof}

\begin{lemma}
\label{lemma-limp-acyclic}
Let $(\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C})$ be a ringed topos.
A limp sheaf is right acyclic for the following functors:
\begin{enumerate}
\item the functor $H^0(U, -)$ for any object $U$ of $\mathcal{C}$,
\item the functor $\mathcal{F} \mapsto \mathcal{F}(K)$ for any
presheaf of sets $K$,
\item the functor $\Gamma(\mathcal{C}, -)$ of global sections,
\item the functor $f_*$ for any morphism
$f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ of ringed topoi.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (2) is the definition of a limp sheaf.
Part (1) is a consequence of (2) as pointed out in the discussion following the
definition of limp sheaves.
Part (3) is a special case of (2) where $K = e$ is the final object
of $\Sh(\mathcal{C})$.

\medskip\noindent
To prove (4) we may assume, by
Modules on Sites, Lemma
\ref{sites-modules-lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
that $f$ is given by a morphism of sites. In this case we see that
$R^if_*$, $i > 0$ of a limp sheaf are zero by the description of
higher direct images in
Lemma \ref{lemma-higher-direct-images}.
\end{proof}

\begin{remark}
\label{remark-before-Leray}
As a consequence of the results above we find that
Derived Categories, Lemma \ref{derived-lemma-compose-derived-functors}
applies to a number of situations. For example, given a
morphism $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ of ringed topoi we have
$$
R\Gamma(\mathcal{D}, Rf_*\mathcal{F}) = R\Gamma(\mathcal{C}, \mathcal{F})
$$
for any sheaf of $\mathcal{O}_\mathcal{C}$-modules $\mathcal{F}$.
Namely, for an injective $\mathcal{O}_\mathcal{X}$-module $\mathcal{I}$
the $\mathcal{O}_\mathcal{D}$-module $f_*\mathcal{I}$ is limp by
Lemma \ref{lemma-direct-image-injective-sheaf}
and a limp sheaf is acyclic for $\Gamma(\mathcal{D}, -)$ by
Lemma \ref{lemma-limp-acyclic}.
\end{remark}

\begin{lemma}[Leray spectral sequence]
\label{lemma-Leray}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi.
Let $\mathcal{F}^\bullet$ be a bounded below complex of
$\mathcal{O}_\mathcal{C}$-modules. There is a spectral sequence
$$
E_2^{p, q} = H^p(\mathcal{D}, R^qf_*(\mathcal{F}^\bullet))
$$
converging to $H^{p + q}(\mathcal{C}, \mathcal{F}^\bullet)$.
\end{lemma}

\begin{proof}
This is just the Grothendieck spectral sequence
Derived Categories, Lemma \ref{derived-lemma-grothendieck-spectral-sequence}
coming from the composition of functors
$\Gamma(\mathcal{C}, -) = \Gamma(\mathcal{D}, -) \circ f_*$.
To see that the assumptions of
Derived Categories, Lemma \ref{derived-lemma-grothendieck-spectral-sequence}
are satisfied, see
Lemmas \ref{lemma-direct-image-injective-sheaf} and
\ref{lemma-limp-acyclic}.
\end{proof}

\begin{lemma}
\label{lemma-apply-Leray}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi.
Let $\mathcal{F}$ be an $\mathcal{O}_\mathcal{C}$-module.
\begin{enumerate}
\item If $R^qf_*\mathcal{F} = 0$ for $q > 0$, then
$H^p(\mathcal{C}, \mathcal{F}) = H^p(\mathcal{D}, f_*\mathcal{F})$ for all $p$.
\item If $H^p(\mathcal{D}, R^qf_*\mathcal{F}) = 0$ for all $q$ and $p > 0$,
then $H^q(\mathcal{C}, \mathcal{F}) = H^0(\mathcal{D}, R^qf_*\mathcal{F})$
for all $q$.
\end{enumerate}
\end{lemma}

\begin{proof}
These are two simple conditions that force the Leray spectral sequence to
converge. You can also prove these facts directly (without using the
spectral sequence) which is a good exercise in cohomology of sheaves.
\end{proof}

\begin{lemma}[Relative Leray spectral sequence]
\label{lemma-relative-Leray}
Let
$f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$
and
$g : (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D}) \to
(\Sh(\mathcal{E}), \mathcal{O}_\mathcal{E})$
be morphisms of ringed topoi.
Let $\mathcal{F}$ be an $\mathcal{O}_\mathcal{C}$-module.
There is a spectral sequence with
$$
E_2^{p, q} = R^pg_*(R^qf_*\mathcal{F})
$$
converging to $R^{p + q}(g \circ f)_*\mathcal{F}$.
This spectral sequence is functorial in $\mathcal{F}$, and there
is a version for bounded below complexes of $\mathcal{O}_\mathcal{C}$-modules.
\end{lemma}

\begin{proof}
This is a Grothendieck spectral sequence for composition of functors, see
Derived Categories, Lemma \ref{derived-lemma-grothendieck-spectral-sequence}
and
Lemmas \ref{lemma-direct-image-injective-sheaf} and
\ref{lemma-limp-acyclic}.
\end{proof}







\section{The base change map}
\label{section-base-change-map}

\noindent
In this section we construct the base change map in some cases;
the general case is treated in Remark \ref{remark-base-change}.
The discussion in this section avoids using
derived pullback by restricting to the case of a base change
by a flat morphism of ringed sites.
Before we state the result, let us discuss flat pullback on the derived
category. Suppose
$g : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C})
\to (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$
is a flat morphism of ringed topoi. By
Modules on Sites, Lemma \ref{sites-modules-lemma-flat-pullback-exact}
the functor $g^* : \textit{Mod}(\mathcal{O}_\mathcal{D}) \to
\textit{Mod}(\mathcal{O}_\mathcal{C})$ is exact.
Hence it has a derived functor
$$
g^* : D(\mathcal{O}_\mathcal{C}) \to D(\mathcal{O}_\mathcal{D})
$$
which is computed by simply pulling back an representative of a given
object in $D(\mathcal{O}_\mathcal{D})$, see
Derived Categories, Lemma \ref{derived-lemma-right-derived-exact-functor}.
It preserved the bounded (above, below) subcategories.
Hence as indicated we indicate this functor by $g^*$ rather than $Lg^*$.

\begin{lemma}
\label{lemma-base-change-map-flat-case}
Let
$$
\xymatrix{
(\Sh(\mathcal{C}'), \mathcal{O}_{\mathcal{C}'})
\ar[r]_{g'} \ar[d]_{f'} &
(\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \ar[d]^f \\
(\Sh(\mathcal{D}'), \mathcal{O}_{\mathcal{D}'})
\ar[r]^g &
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})
}
$$
be a commutative diagram of ringed topoi.
Let $\mathcal{F}^\bullet$ be a bounded below complex of
$\mathcal{O}_\mathcal{C}$-modules.
Assume both $g$ and $g'$ are flat.
Then there exists a canonical base change map
$$
g^*Rf_*\mathcal{F}^\bullet
\longrightarrow
R(f')_*(g')^*\mathcal{F}^\bullet
$$
in $D^{+}(\mathcal{O}_{\mathcal{D}'})$.
\end{lemma}

\begin{proof}
Choose injective resolutions $\mathcal{F}^\bullet \to \mathcal{I}^\bullet$
and $(g')^*\mathcal{F}^\bullet \to \mathcal{J}^\bullet$.
By Lemma \ref{lemma-pushforward-injective-flat} we see that
$(g')_*\mathcal{J}^\bullet$ is a complex of injectives representing
$R(g')_*(g')^*\mathcal{F}^\bullet$. Hence by
Derived Categories, Lemmas \ref{derived-lemma-morphisms-lift}
and \ref{derived-lemma-morphisms-equal-up-to-homotopy}
the arrow $\beta$ in the diagram
$$
\xymatrix{
(g')_*(g')^*\mathcal{F}^\bullet \ar[r] &
(g')_*\mathcal{J}^\bullet \\
\mathcal{F}^\bullet \ar[u]^{adjunction} \ar[r] &
\mathcal{I}^\bullet \ar[u]_\beta
}
$$
exists and is unique up to homotopy.
Pushing down to $\mathcal{D}$ we get
$$
f_*\beta :
f_*\mathcal{I}^\bullet
\longrightarrow
f_*(g')_*\mathcal{J}^\bullet
=
g_*(f')_*\mathcal{J}^\bullet
$$
By adjunction of $g^*$ and $g_*$ we get a map of complexes
$g^*f_*\mathcal{I}^\bullet \to (f')_*\mathcal{J}^\bullet$.
Note that this map is unique up to homotopy since the only
choice in the whole process was the choice of the map $\beta$
and everything was done on the level of complexes.
\end{proof}








\section{Cohomology and colimits}
\label{section-limits}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{I} \to \textit{Mod}(\mathcal{O})$, $i \mapsto \mathcal{F}_i$
be a diagram over the index category $\mathcal{I}$, see
Categories, Section \ref{categories-section-limits}.
For each $i$ there is a canonical map
$\mathcal{F}_i \to \colim_i \mathcal{F}_i$ which induces
a map on cohomology. Hence we get a canonical map
$$
\colim_i H^p(U, \mathcal{F}_i)
\longrightarrow
H^p(U, \colim_i \mathcal{F}_i)
$$
for every $p \geq 0$ and every object $U$ of $\mathcal{C}$.
These maps are in general not isomorphisms, even for $p = 0$.

\medskip\noindent
The following lemma is the analogue of
Sites, Lemma \ref{sites-lemma-directed-colimits-sections}
for cohomology.

\begin{lemma}
\label{lemma-colim-works-over-collection}
Let $\mathcal{C}$ be a site. Let $\text{Cov}_\mathcal{C}$ be the set
of coverings of $\mathcal{C}$ (see
Sites, Definition \ref{sites-definition-site}). Let
$\mathcal{B} \subset \Ob(\mathcal{C})$, and
$\text{Cov} \subset \text{Cov}_\mathcal{C}$
be subsets. Assume that
\begin{enumerate}
\item For every $\mathcal{U} \in \text{Cov}$ we have
$\mathcal{U} = \{U_i \to U\}_{i \in I}$ with $I$ finite,
$U, U_i \in \mathcal{B}$ and every
$U_{i_0} \times_U \ldots \times_U U_{i_p} \in \mathcal{B}$.
\item For every $U \in \mathcal{B}$ the coverings of $U$
occurring in $\text{Cov}$ is a cofinal system of coverings of $U$.
\end{enumerate}
Then the map
$$
\colim_i H^p(U, \mathcal{F}_i)
\longrightarrow
H^p(U, \colim_i \mathcal{F}_i)
$$
is an isomorphism for every $p \geq 0$, every $U \in \mathcal{B}$, and
every filtered diagram $\mathcal{I} \to \textit{Ab}(\mathcal{C})$.
\end{lemma}

\begin{proof}
To prove the lemma we will argue by induction on $p$.
Note that we require in (1) the coverings $\mathcal{U} \in \text{Cov}$
to be finite, so that all the elements of $\mathcal{B}$ are quasi-compact.
Hence (2) and (1) imply that any $U \in \mathcal{B}$ satisfies the hypothesis
of Sites, Lemma \ref{sites-lemma-directed-colimits-sections} (4).
Thus we see that the result holds for $p = 0$.
Now we assume the lemma holds for $p$ and prove it for $p + 1$.

\medskip\noindent
Choose a filtered diagram
$\mathcal{F} : \mathcal{I} \to \textit{Ab}(\mathcal{C})$,
$i \mapsto \mathcal{F}_i$.
Since $\textit{Ab}(\mathcal{C})$ has functorial injective embeddings, see
Injectives, Theorem \ref{injectives-theorem-sheaves-injectives},
we can find a morphism of filtered diagrams
$\mathcal{F} \to \mathcal{I}$
such that each $\mathcal{F}_i \to \mathcal{I}_i$ is an injective map of
abelian sheaves into an injective abelian sheaf. Denote $\mathcal{Q}_i$
the cokernel so that we have short exact sequences
$$
0 \to
\mathcal{F}_i \to
\mathcal{I}_i \to
\mathcal{Q}_i \to 0.
$$
Since colimits of sheaves are the sheafification of colimits on the level
of presheaves, since sheafification is exact, and since filtered
colimits of abelian groups are exact
(see Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}),
we see the sequence
$$
0 \to
\colim_i \mathcal{F}_i \to
\colim_i \mathcal{I}_i \to
\colim_i \mathcal{Q}_i \to 0.
$$
is also a short exact sequence. We claim that
$H^q(U, \colim_i \mathcal{I}_i) = 0$ for all $U \in \mathcal{B}$
and all $q \geq 1$. Accepting this claim
for the moment consider the diagram
$$
\xymatrix{
\colim_i H^p(U, \mathcal{I}_i) \ar[d] \ar[r] &
\colim_i H^p(U, \mathcal{Q}_i) \ar[d] \ar[r] &
\colim_i H^{p + 1}(U, \mathcal{F}_i) \ar[d] \ar[r] &
0 \ar[d] \\
H^p(U, \colim_i \mathcal{I}_i) \ar[r] &
H^p(U, \colim_i \mathcal{Q}_i) \ar[r] &
H^{p + 1}(U, \colim_i \mathcal{F}_i) \ar[r] &
0
}
$$
The zero at the lower right corner comes from the claim and the
zero at the upper right corner comes from the fact that the sheaves
$\mathcal{I}_i$ are injective.
The top row is exact by an application of
Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}.
Hence by the snake lemma we deduce the
result for $p + 1$.

\medskip\noindent
It remains to show that the claim is true. We will use
Lemma \ref{lemma-cech-vanish-collection}.
By the result for $p = 0$ we see that for $\mathcal{U} \in \text{Cov}$
we have
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, \colim_i \mathcal{I}_i)
=
\colim_i \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}_i)
$$
because all the $U_{j_0} \times_U \ldots \times_U U_{j_p}$
are in $\mathcal{B}$. By
Lemma \ref{lemma-injective-trivial-cech}
each of the complexes in the colimit of {\v C}ech complexes is
acyclic in degree $\geq 1$. Hence by
Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}
we see that also the {\v C}ech complex
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \colim_i \mathcal{I}_i)$
is acyclic in degrees $\geq 1$. In other words we see that
$\check{H}^p(\mathcal{U}, \colim_i \mathcal{I}_i) = 0$
for all $p \geq 1$. Thus the assumptions of
Lemma \ref{lemma-cech-vanish-collection}.
are satisfied and the claim follows.
\end{proof}

\noindent
Let $\mathcal{C}$ be a limit of sites $\mathcal{C}_i$ as in
Sites, Situation \ref{sites-situation-inverse-limit-sites} and
Lemmas \ref{sites-lemma-colimit-sites},
\ref{sites-lemma-compute-pullback-to-limit}, and
\ref{sites-lemma-colimit}.
In particular, all coverings
in $\mathcal{C}$ and $\mathcal{C}_i$ have finite index sets.
Moreover, assume given
\begin{enumerate}
\item an abelian sheaf $\mathcal{F}_i$ on $\mathcal{C}_i$ for all
$i \in \Ob(\mathcal{I})$,
\item for $a : j \to i$ a map
$\varphi_a : f_a^{-1}\mathcal{F}_i \to \mathcal{F}_j$
of abelian sheaves on $\mathcal{C}_j$
\end{enumerate}
such that $\varphi_c = \varphi_b \circ f_b^{-1}\varphi_a$
whenever $c = a \circ b$.

\begin{lemma}
\label{lemma-colimit}
In the situation discussed above set
$\mathcal{F} = \colim f_i^{-1}\mathcal{F}_i$.
Let $i \in \Ob(\mathcal{I})$, $X_i \in \text{Ob}(\mathcal{C}_i)$. Then
$$
\colim_{a : j \to i} H^p(u_a(X_i), \mathcal{F}_j) =
H^p(u_i(X_i), \mathcal{F})
$$
for all $p \geq 0$.
\end{lemma}

\begin{proof}
The case $p = 0$ is Sites, Lemma \ref{sites-lemma-colimit}.

\medskip\noindent
In this paragraph we show that we can find a map of systems
$(\gamma_i) : (\mathcal{F}_i, \varphi_a) \to (\mathcal{G}_i, \psi_a)$
with $\mathcal{G}_i$ an injective abelian sheaf and $\gamma_i$ injective.
For each $i$ we pick an injection $\mathcal{F}_i \to \mathcal{I}_i$
where $\mathcal{I}_i$ is an injective abelian sheaf on $\mathcal{C}_i$.
Then we can consider the family of maps
$$
\gamma_i :
\mathcal{F}_i
\longrightarrow
\prod\nolimits_{b : k \to i} f_{b, *}\mathcal{I}_k = \mathcal{G}_i
$$
where the component maps are the maps adjoint to the maps
$f_b^{-1}\mathcal{F}_i \to \mathcal{F}_k \to \mathcal{I}_k$.
For $a : j \to i$ in $\mathcal{I}$ there is a canonical map
$$
\psi_a : f_a^{-1}\mathcal{G}_i \to \mathcal{G}_j
$$
whose components are the canonical maps
$f_b^{-1}f_{a \circ b, *}\mathcal{I}_k \to f_{b, *}\mathcal{I}_k$
for $b : k \to j$. Thus we find an injection
$\{\gamma_i\} : \{\mathcal{F}_i, \varphi_a) \to (\mathcal{G}_i, \psi_a)$
of systems of abelian sheaves. Note that $\mathcal{G}_i$ is an injective
sheaf of abelian groups on $\mathcal{C}_i$, see
Lemma \ref{lemma-pushforward-injective-flat} and
Homology, Lemma \ref{homology-lemma-product-injectives}.
This finishes the construction.

\medskip\noindent
Arguing exactly as in the proof of
Lemma \ref{lemma-colim-works-over-collection}
we see that it suffices to prove that
$H^p(X, \colim f_i^{-1}\mathcal{G}_i) = 0$ for $p > 0$.

\medskip\noindent
Set $\mathcal{G} = \colim f_i^{-1}\mathcal{G}_i$.
To show vanishing of cohomology of $\mathcal{G}$ on every object
of $\mathcal{C}$ we show that the {\v C}ech cohomology of $\mathcal{G}$
for any covering $\mathcal{U}$ of $\mathcal{C}$ is zero
(Lemma \ref{lemma-cech-vanish-collection}).
The covering $\mathcal{U}$ comes from a covering
$\mathcal{U}_i$ of $\mathcal{C}_i$ for some $i$. We have
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{G}) =
\colim_{a : j \to i}
\check{\mathcal{C}}^\bullet(u_a(\mathcal{U}_i), \mathcal{G}_j)
$$
by the case $p = 0$. The right hand side is acyclic in positive degrees
as a filtered colimit of acyclic complexes by
Lemma \ref{lemma-injective-trivial-cech}. See
Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}.
\end{proof}















\section{Flat resolutions}
\label{section-flat}

\noindent
In this section we redo the arguments of
Cohomology, Section \ref{cohomology-section-flat}
in the setting of ringed sites and ringed topoi.

\begin{lemma}
\label{lemma-derived-tor-exact}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{G}^\bullet$ be a complex of $\mathcal{O}$-modules.
The functor
$$
K(\textit{Mod}(\mathcal{O}))
\longrightarrow
K(\textit{Mod}(\mathcal{O})),
\quad
\mathcal{F}^\bullet \longmapsto
\text{Tot}(\mathcal{F}^\bullet \otimes_\mathcal{O} \mathcal{G}^\bullet)
$$
is an exact functor of triangulated categories.
\end{lemma}

\begin{proof}
Omitted. Hint: See
More on Algebra, Lemmas \ref{more-algebra-lemma-derived-tor-homotopy} and
\ref{more-algebra-lemma-derived-tor-exact}.
\end{proof}

\begin{definition}
\label{definition-K-flat}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
A complex $\mathcal{K}^\bullet$ of $\mathcal{O}$-modules is
called {\it K-flat} if for every acyclic complex $\mathcal{F}^\bullet$
of $\mathcal{O}$-modules the complex
$$
\text{Tot}(\mathcal{F}^\bullet \otimes_\mathcal{O} \mathcal{K}^\bullet)
$$
is acyclic.
\end{definition}

\begin{lemma}
\label{lemma-K-flat-quasi-isomorphism}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{K}^\bullet$ be a K-flat complex.
Then the functor
$$
K(\textit{Mod}(\mathcal{O}))
\longrightarrow
K(\textit{Mod}(\mathcal{O})), \quad
\mathcal{F}^\bullet
\longmapsto
\text{Tot}(\mathcal{F}^\bullet \otimes_\mathcal{O} \mathcal{K}^\bullet)
$$
transforms quasi-isomorphisms into quasi-isomorphisms.
\end{lemma}

\begin{proof}
Follows from
Lemma \ref{lemma-derived-tor-exact}
and the fact that quasi-isomorphisms are characterized by having
acyclic cones.
\end{proof}

\begin{lemma}
\label{lemma-tensor-product-K-flat}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
If $\mathcal{K}^\bullet$, $\mathcal{L}^\bullet$ are K-flat complexes
of $\mathcal{O}$-modules, then
$\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet)$
is a K-flat complex of $\mathcal{O}$-modules.
\end{lemma}

\begin{proof}
Follows from the isomorphism
$$
\text{Tot}(\mathcal{M}^\bullet \otimes_\mathcal{O}
\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet))
=
\text{Tot}(\text{Tot}(\mathcal{M}^\bullet \otimes_\mathcal{O}
\mathcal{K}^\bullet) \otimes_\mathcal{O} \mathcal{L}^\bullet)
$$
and the definition.
\end{proof}

\begin{lemma}
\label{lemma-K-flat-two-out-of-three}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $(\mathcal{K}_1^\bullet, \mathcal{K}_2^\bullet, \mathcal{K}_3^\bullet)$
be a distinguished triangle in $K(\textit{Mod}(\mathcal{O}))$.
If two out of three of $\mathcal{K}_i^\bullet$ are K-flat, so is the third.
\end{lemma}

\begin{proof}
Follows from
Lemma \ref{lemma-derived-tor-exact}
and the fact that in a distinguished triangle in
$K(\textit{Mod}(\mathcal{O}))$
if two out of three are acyclic, so is the third.
\end{proof}

\begin{lemma}
\label{lemma-bounded-flat-K-flat}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. A bounded above complex
of flat $\mathcal{O}$-modules is K-flat.
\end{lemma}

\begin{proof}
Let $\mathcal{K}^\bullet$ be a bounded above complex of flat
$\mathcal{O}$-modules. Let $\mathcal{L}^\bullet$ be an acyclic complex
of $\mathcal{O}$-modules. Note that
$\mathcal{L}^\bullet = \colim_m \tau_{\leq m}\mathcal{L}^\bullet$
where we take termwise colimits. Hence also
$$
\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet)
=
\colim_m \text{Tot}(
\mathcal{K}^\bullet \otimes_\mathcal{O} \tau_{\leq m}\mathcal{L}^\bullet)
$$
termwise. Hence to prove the complex on the left is acyclic it suffices
to show each of the complexes on the right is acyclic. Since
$\tau_{\leq m}\mathcal{L}^\bullet$ is acyclic this reduces us to the
case where $\mathcal{L}^\bullet$ is bounded above.
In this case the spectral sequence of
Homology, Lemma \ref{homology-lemma-first-quadrant-ss}
has
$$
{}'E_1^{p, q} = H^p(\mathcal{L}^\bullet \otimes_R \mathcal{K}^q)
$$
which is zero as $\mathcal{K}^q$ is flat and $\mathcal{L}^\bullet$ acyclic.
Hence we win.
\end{proof}

\begin{lemma}
\label{lemma-colimit-K-flat}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{K}_1^\bullet \to \mathcal{K}_2^\bullet \to \ldots$
be a system of K-flat complexes.
Then $\colim_i \mathcal{K}_i^\bullet$ is K-flat.
\end{lemma}

\begin{proof}
Because we are taking termwise colimits it is clear that
$$
\colim_i \text{Tot}(
\mathcal{F}^\bullet \otimes_\mathcal{O} \mathcal{K}_i^\bullet)
=
\text{Tot}(\mathcal{F}^\bullet \otimes_\mathcal{O}
\colim_i \mathcal{K}_i^\bullet)
$$
Hence the lemma follows from the fact that filtered colimits are
exact.
\end{proof}

\begin{lemma}
\label{lemma-resolution-by-direct-sums-extensions-by-zero}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
For any complex $\mathcal{G}^\bullet$ of $\mathcal{O}$-modules
there exists a commutative diagram of complexes of $\mathcal{O}$-modules
$$
\xymatrix{
\mathcal{K}_1^\bullet \ar[d] \ar[r] &
\mathcal{K}_2^\bullet \ar[d] \ar[r] & \ldots \\
\tau_{\leq 1}\mathcal{G}^\bullet \ar[r] &
\tau_{\leq 2}\mathcal{G}^\bullet \ar[r] & \ldots
}
$$
with the following properties: (1) the vertical arrows are quasi-isomorphisms,
(2) each $\mathcal{K}_n^\bullet$ is a bounded above complex whose terms
are direct sums of $\mathcal{O}$-modules of the form $j_{U!}\mathcal{O}_U$, and
(3) the maps $\mathcal{K}_n^\bullet \to \mathcal{K}_{n + 1}^\bullet$ are
termwise split injections whose cokernels are direct sums of
$\mathcal{O}$-modules of the form $j_{U!}\mathcal{O}_U$. Moreover, the map
$\colim \mathcal{K}_n^\bullet \to \mathcal{G}^\bullet$ is a quasi-isomorphism.
\end{lemma}

\begin{proof}
The existence of the diagram and properties (1), (2), (3) follows immediately
from
Modules on Sites, Lemma \ref{sites-modules-lemma-module-quotient-flat}
and
Derived Categories, Lemma \ref{derived-lemma-special-direct-system}.
The induced map
$\colim \mathcal{K}_n^\bullet \to \mathcal{G}^\bullet$
is a quasi-isomorphism because filtered colimits are exact.
\end{proof}

\begin{lemma}
\label{lemma-K-flat-resolution}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
For any complex $\mathcal{G}^\bullet$ of $\mathcal{O}$-modules
there exists a $K$-flat complex
$\mathcal{K}^\bullet$ and a quasi-isomorphism
$\mathcal{K}^\bullet \to \mathcal{G}^\bullet$.
\end{lemma}

\begin{proof}
Choose a diagram as in
Lemma \ref{lemma-resolution-by-direct-sums-extensions-by-zero}.
Each complex $\mathcal{K}_n^\bullet$ is a bounded
above complex of flat modules, see
Modules on Sites, Lemma \ref{sites-modules-lemma-j-shriek-flat}.
Hence $\mathcal{K}_n^\bullet$ is K-flat by
Lemma \ref{lemma-bounded-flat-K-flat}.
The induced map
$\colim \mathcal{K}_n^\bullet \to \mathcal{G}^\bullet$
is a quasi-isomorphism by construction. Since
$\colim \mathcal{K}_n^\bullet$ is K-flat by
Lemma \ref{lemma-colimit-K-flat}
we win.
\end{proof}

\begin{lemma}
\label{lemma-derived-tor-quasi-isomorphism-other-side}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let
$\alpha : \mathcal{P}^\bullet \to \mathcal{Q}^\bullet$ be a
quasi-isomorphism of K-flat complexes of $\mathcal{O}$-modules.
For every complex $\mathcal{F}^\bullet$ of $\mathcal{O}$-modules
the induced map
$$
\text{Tot}(\text{id}_{\mathcal{F}^\bullet} \otimes \alpha) :
\text{Tot}(\mathcal{F}^\bullet \otimes_\mathcal{O} \mathcal{P}^\bullet)
\longrightarrow
\text{Tot}(\mathcal{F}^\bullet \otimes_\mathcal{O} \mathcal{Q}^\bullet)
$$
is a quasi-isomorphism.
\end{lemma}

\begin{proof}
Choose a quasi-isomorphism $\mathcal{K}^\bullet \to \mathcal{F}^\bullet$
with $\mathcal{K}^\bullet$ a K-flat complex, see
Lemma \ref{lemma-K-flat-resolution}.
Consider the commutative diagram
$$
\xymatrix{
\text{Tot}(\mathcal{K}^\bullet
\otimes_\mathcal{O} \mathcal{P}^\bullet) \ar[r] \ar[d] &
\text{Tot}(\mathcal{K}^\bullet
\otimes_\mathcal{O} \mathcal{Q}^\bullet) \ar[d] \\
\text{Tot}(\mathcal{F}^\bullet
\otimes_\mathcal{O} \mathcal{P}^\bullet) \ar[r] &
\text{Tot}(\mathcal{F}^\bullet
\otimes_\mathcal{O} \mathcal{Q}^\bullet)
}
$$
The result follows as by
Lemma \ref{lemma-K-flat-quasi-isomorphism}
the vertical arrows and the top horizontal arrow are quasi-isomorphisms.
\end{proof}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}^\bullet$ be an object of $D(\mathcal{O})$.
Choose a K-flat resolution $\mathcal{K}^\bullet \to \mathcal{F}^\bullet$, see
Lemma \ref{lemma-K-flat-resolution}.
By
Lemma \ref{lemma-derived-tor-exact}
we obtain an exact functor of triangulated categories
$$
K(\mathcal{O})
\longrightarrow
K(\mathcal{O}),
\quad
\mathcal{G}^\bullet
\longmapsto
\text{Tot}(\mathcal{G}^\bullet \otimes_\mathcal{O} \mathcal{K}^\bullet)
$$
By
Lemma \ref{lemma-K-flat-quasi-isomorphism}
this functor induces a functor
$D(\mathcal{O}) \to D(\mathcal{O})$ simply because
$D(\mathcal{O})$ is the localization of $K(\mathcal{O})$
at quasi-isomorphisms. By
Lemma \ref{lemma-derived-tor-quasi-isomorphism-other-side}
the resulting functor (up to isomorphism)
does not depend on the choice of the K-flat resolution.

\begin{definition}
\label{definition-derived-tor}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}^\bullet$ be an object of $D(\mathcal{O})$.
The {\it derived tensor product}
$$
- \otimes_\mathcal{O}^{\mathbf{L}} \mathcal{F}^\bullet :
D(\mathcal{O})
\longrightarrow
D(\mathcal{O})
$$
is the exact functor of triangulated categories described above.
\end{definition}

\noindent
It is clear from our explicit constructions that
there is a canonical isomorphism
$$
\mathcal{F}^\bullet \otimes_\mathcal{O}^{\mathbf{L}} \mathcal{G}^\bullet
\cong
\mathcal{G}^\bullet \otimes_\mathcal{O}^{\mathbf{L}} \mathcal{F}^\bullet
$$
for $\mathcal{G}^\bullet$ and $\mathcal{F}^\bullet$ in $D(\mathcal{O})$.
Hence when we write
$\mathcal{F}^\bullet \otimes_\mathcal{O}^{\mathbf{L}} \mathcal{G}^\bullet$
we will usually be agnostic about which variable we are using to
define the derived tensor product with.

\begin{definition}
\label{definition-tor}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$, $\mathcal{G}$ be $\mathcal{O}$-modules.
The {\it Tor}'s of $\mathcal{F}$ and $\mathcal{G}$ are define by
the formula
$$
\text{Tor}_p^\mathcal{O}(\mathcal{F}, \mathcal{G}) =
H^{-p}(\mathcal{F} \otimes_\mathcal{O}^\mathbf{L} \mathcal{G})
$$
with derived tensor product as defined above.
\end{definition}

\noindent
This definition implies that for every short exact sequence
of $\mathcal{O}$-modules
$0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0$
we have a long exact cohomology sequence
$$
\xymatrix{
\mathcal{F}_1 \otimes_\mathcal{O} \mathcal{G} \ar[r] &
\mathcal{F}_2 \otimes_\mathcal{O} \mathcal{G} \ar[r] &
\mathcal{F}_3 \otimes_\mathcal{O} \mathcal{G} \ar[r] & 0 \\
\text{Tor}_1^\mathcal{O}(\mathcal{F}_1, \mathcal{G}) \ar[r] &
\text{Tor}_1^\mathcal{O}(\mathcal{F}_2, \mathcal{G}) \ar[r] &
\text{Tor}_1^\mathcal{O}(\mathcal{F}_3, \mathcal{G}) \ar[ull]
}
$$
for every $\mathcal{O}$-module $\mathcal{G}$. This will be called
the long exact sequence of $\text{Tor}$ associated to the situation.

\begin{lemma}
\label{lemma-flat-tor-zero}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$ be an $\mathcal{O}$-module.
The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is a flat $\mathcal{O}$-module, and
\item $\text{Tor}_1^\mathcal{O}(\mathcal{F}, \mathcal{G}) = 0$
for every $\mathcal{O}$-module $\mathcal{G}$.
\end{enumerate}
\end{lemma}

\begin{proof}
If $\mathcal{F}$ is flat, then $\mathcal{F} \otimes_\mathcal{O} -$
is an exact functor and the satellites vanish. Conversely assume (2)
holds. Then if $\mathcal{G} \to \mathcal{H}$ is injective with cokernel
$\mathcal{Q}$, the long exact sequence of $\text{Tor}$ shows that
the kernel of
$\mathcal{F} \otimes_\mathcal{O} \mathcal{G} \to
\mathcal{F} \otimes_\mathcal{O} \mathcal{H}$
is a quotient of
$\text{Tor}_1^\mathcal{O}(\mathcal{F}, \mathcal{Q})$
which is zero by assumption. Hence $\mathcal{F}$ is flat.
\end{proof}












\section{Derived pullback}
\label{section-derived-pullback}

\noindent
Let
$f : (\Sh(\mathcal{C}), \mathcal{O}) \to
(\Sh(\mathcal{C}'), \mathcal{O}')$
be a morphism of ringed topoi. We can use K-flat resolutions to define
a derived pullback functor
$$
Lf^* : D(\mathcal{O}') \to D(\mathcal{O})
$$
However, we have to be a little careful since we haven't yet proved
the pullback of a flat module is flat in complete generality, see
Modules on Sites, Section \ref{sites-modules-section-pullback-flat}.
In this section, we will use the hypothesis that our
sites have enough points, but once we improve the result of the
aforementioned section, all of the results in this section will
hold without the assumption on the existence of points.

\begin{lemma}
\label{lemma-pullback-K-flat}
Let $f : \Sh(\mathcal{C}) \to \Sh(\mathcal{C}')$
be a morphism of topoi. Let $\mathcal{O}'$ be a sheaf of rings on
$\mathcal{C}'$.
Assume $\mathcal{C}$ has enough points.
For any complex of $\mathcal{O}'$-modules $\mathcal{G}^\bullet$, there
exists a quasi-isomorphism $\mathcal{K}^\bullet \to \mathcal{G}^\bullet$
such that $\mathcal{K}^\bullet$ is a K-flat complex of $\mathcal{O}'$-modules
and $f^{-1}\mathcal{K}^\bullet$ is a K-flat complex of
$f^{-1}\mathcal{O}'$-modules.
\end{lemma}

\begin{proof}
In the proof of
Lemma \ref{lemma-K-flat-resolution}
we find a quasi-isomorphism
$\mathcal{K}^\bullet = \colim_i \mathcal{K}_i^\bullet \to
\mathcal{G}^\bullet$
where each $\mathcal{K}_i^\bullet$ is a bounded above complex of
flat $\mathcal{O}'$-modules. By
Modules on Sites, Lemma \ref{sites-modules-lemma-pullback-flat}
applied to the morphism of ringed topoi
$(\Sh(\mathcal{C}), f^{-1}\mathcal{O}')
\to (\Sh(\mathcal{C}'), \mathcal{O}')$
we see that $f^{-1}\mathcal{F}_i^\bullet$ is a bounded above complex
of flat $f^{-1}\mathcal{O}'$-modules. Hence
$f^{-1}\mathcal{K}^\bullet  = \colim_i f^{-1}\mathcal{K}_i^\bullet$
is K-flat by
Lemmas \ref{lemma-bounded-flat-K-flat} and \ref{lemma-colimit-K-flat}.
\end{proof}

\begin{remark}
\label{remark-pullback-K-flat}
It is straightforward to show that the pullback of a K-flat complex
is K-flat for a morphism of ringed topoi with enough points; this slightly
improves the result of
Lemma \ref{lemma-pullback-K-flat}.
However, in applications it seems rather that the explicit form of the K-flat
complexes constructed in
Lemma \ref{lemma-K-flat-resolution}
is what is useful (as in the proof above) and not the plain fact that they
are K-flat. Note for example that the terms of the complex constructed
are each direct sums of modules of the form $j_{U!}\mathcal{O}_U$, see
Lemma \ref{lemma-resolution-by-direct-sums-extensions-by-zero}.
\end{remark}

\begin{lemma}
\label{lemma-derived-base-change}
Let
$f : (\Sh(\mathcal{C}), \mathcal{O}) \to
(\Sh(\mathcal{C}'), \mathcal{O}')$
be a morphism of ringed topoi. Assume $\mathcal{C}$ has enough points.
There exists an exact functor
$$
Lf^* : D(\mathcal{O}') \longrightarrow D(\mathcal{O})
$$
of triangulated categories so that
$Lf^*\mathcal{K}^\bullet = f^*\mathcal{K}^\bullet$ for any complex as in
Lemma \ref{lemma-pullback-K-flat}
in particular for any bounded above complex of flat $\mathcal{O}'$-modules.
\end{lemma}

\begin{proof}
To see this we use the general theory developed in
Derived Categories, Section \ref{derived-section-derived-functors}.
Set $\mathcal{D} = K(\mathcal{O}')$ and $\mathcal{D}' = D(\mathcal{O})$.
Let us write $F : \mathcal{D} \to \mathcal{D}'$ the exact functor
of triangulated categories defined by the rule
$F(\mathcal{G}^\bullet) = f^*\mathcal{G}^\bullet$.
We let $S$ be the set of quasi-isomorphisms in
$\mathcal{D} = K(\mathcal{O}')$.
This gives a situation as in
Derived Categories, Situation \ref{derived-situation-derived-functor}
so that
Derived Categories, Definition
\ref{derived-definition-right-derived-functor-defined}
applies. We claim that $LF$ is everywhere defined.
This follows from
Derived Categories, Lemma \ref{derived-lemma-find-existence-computes}
with $\mathcal{P} \subset \Ob(\mathcal{D})$ the collection
of complexes $\mathcal{K}^\bullet$ such that $f^{-1}\mathcal{K}^\bullet$
is a K-flat complex of $f^{-1}\mathcal{O}'$-modules: (1) follows from
Lemma \ref{lemma-pullback-K-flat}
and to see (2) we have to show that for a quasi-isomorphism
$\mathcal{K}_1^\bullet  \to \mathcal{K}_2^\bullet$ between
elements of $\mathcal{P}$ the map
$f^*\mathcal{K}_1^\bullet  \to f^*\mathcal{K}_2^\bullet$ is a
quasi-isomorphism. To see this write this as
$$
f^{-1}\mathcal{K}_1^\bullet \otimes_{f^{-1}\mathcal{O}'} \mathcal{O}
\longrightarrow
f^{-1}\mathcal{K}_2^\bullet \otimes_{f^{-1}\mathcal{O}'} \mathcal{O}
$$
The functor $f^{-1}$ is exact, hence the map
$f^{-1}\mathcal{K}_1^\bullet  \to f^{-1}\mathcal{K}_2^\bullet$ is a
quasi-isomorphism. The complexes
$f^{-1}\mathcal{K}_1^\bullet$ and $f^{-1}\mathcal{K}_2^\bullet$
are K-flat complexes of $f^{-1}\mathcal{O}'$-modules by our choice of
$\mathcal{P}$. Hence
Lemma \ref{lemma-derived-tor-quasi-isomorphism-other-side}
guarantees that the displayed map is a quasi-isomorphism.
Thus we obtain a derived functor
$$
LF :
D(\mathcal{O}') = S^{-1}\mathcal{D}
\longrightarrow
\mathcal{D}' = D(\mathcal{O})
$$
see
Derived Categories, Equation (\ref{derived-equation-everywhere}).
Finally,
Derived Categories, Lemma \ref{derived-lemma-find-existence-computes}
also guarantees that
$LF(\mathcal{K}^\bullet) = F(\mathcal{K}^\bullet) = f^*\mathcal{K}^\bullet$
when $\mathcal{K}^\bullet$ is in $\mathcal{P}$.
Since the proof of
Lemma \ref{lemma-pullback-K-flat}
shows that bounded above complexes of flat modules are in $\mathcal{P}$
we win.
\end{proof}

\begin{lemma}
\label{lemma-pullback-tensor-product}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$
be a morphism of ringed topoi. Assume $\mathcal{C}$ has enough points.
There is a canonical bifunctorial isomorphism
$$
Lf^*(
\mathcal{F}^\bullet \otimes_{\mathcal{O}'}^{\mathbf{L}} \mathcal{G}^\bullet
) =
Lf^*\mathcal{F}^\bullet 
\otimes_{\mathcal{O}}^{\mathbf{L}}
Lf^*\mathcal{G}^\bullet 
$$
for $\mathcal{F}^\bullet, \mathcal{G}^\bullet \in \Ob(D(\mathcal{O}'))$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-pullback-K-flat} we may assume that $\mathcal{F}^\bullet$
and $\mathcal{G}^\bullet$ are K-flat complexes of $\mathcal{O}'$-modules
such that $f^*\mathcal{F}^\bullet$ and $f^*\mathcal{G}^\bullet$
are K-flat complexes of $\mathcal{O}$-modules. In this case
$\mathcal{F}^\bullet \otimes_{\mathcal{O}'}^{\mathbf{L}} \mathcal{G}^\bullet$
is just the total complex associated to the double complex
$\mathcal{F}^\bullet \otimes_{\mathcal{O}'} \mathcal{G}^\bullet$. By
Lemma \ref{lemma-tensor-product-K-flat}
$\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}'} \mathcal{G}^\bullet)$
is K-flat also. Hence the isomorphism of the lemma comes from the
isomorphism
$$
\text{Tot}(f^*\mathcal{F}^\bullet \otimes_{\mathcal{O}}
f^*\mathcal{G}^\bullet)
\longrightarrow
f^*\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}'} \mathcal{G}^\bullet)
$$
whose constituents are the isomorphisms
$f^*\mathcal{F}^p \otimes_{\mathcal{O}} f^*\mathcal{G}^q \to
f^*(\mathcal{F}^p \otimes_{\mathcal{O}'} \mathcal{G}^q)$ of
Modules on Sites, Lemma \ref{sites-modules-lemma-tensor-product-pullback}.
\end{proof}

\begin{lemma}
\label{lemma-variant-derived-pullback}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{C}'), \mathcal{O}')$
be a morphism of ringed topoi. There is a canonical bifunctorial
isomorphism
$$
\mathcal{F}^\bullet
\otimes_\mathcal{O}^{\mathbf{L}}
Lf^*\mathcal{G}^\bullet
=
\mathcal{F}^\bullet 
\otimes_{f^{-1}\mathcal{O}_Y}^{\mathbf{L}}
f^{-1}\mathcal{G}^\bullet 
$$
for $\mathcal{F}^\bullet$ in $D(\mathcal{O})$ and
$\mathcal{G}^\bullet$ in $D(\mathcal{O}')$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be an $\mathcal{O}$-module and let $\mathcal{G}$
be an $\mathcal{O}'$-module. Then
$\mathcal{F} \otimes_{\mathcal{O}} f^*\mathcal{G} =
\mathcal{F} \otimes_{f^{-1}\mathcal{O}'} f^{-1}\mathcal{G}$
because
$f^*\mathcal{G} =
\mathcal{O} \otimes_{f^{-1}\mathcal{O}'} f^{-1}\mathcal{G}$.
The lemma follows from this and the definitions.
\end{proof}








\section{Cohomology of unbounded complexes}
\label{section-unbounded}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
The category $\textit{Mod}(\mathcal{O})$ is a Grothendieck
abelian category: it has all colimits,
filtered colimits are exact, and it has a generator, namely
$$
\bigoplus\nolimits_{U \in \Ob(\mathcal{C})} j_{U!}\mathcal{O}_U,
$$
see Modules on Sites, Section \ref{sites-modules-section-kernels} and
Lemmas \ref{sites-modules-lemma-j-shriek-flat} and
\ref{sites-modules-lemma-module-quotient-flat}.
By
Injectives, Theorem
\ref{injectives-theorem-K-injective-embedding-grothendieck}
for every complex $\mathcal{F}^\bullet$ of $\mathcal{O}$-modules
there exists an injective quasi-isomorphism
$\mathcal{F}^\bullet \to \mathcal{I}^\bullet$ to a K-injective complex
of $\mathcal{O}$-modules. Hence we can define
$$
R\Gamma(\mathcal{C}, \mathcal{F}^\bullet) =
\Gamma(\mathcal{C}, \mathcal{I}^\bullet)
$$
and similarly for any left exact functor, see
Derived Categories, Lemma \ref{derived-lemma-enough-K-injectives-implies}.
For any morphism of
ringed topoi
$f : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$
we obtain
$$
Rf_* : D(\mathcal{O}) \longrightarrow D(\mathcal{O}')
$$
on the unbounded derived categories.

\begin{lemma}
\label{lemma-adjoint}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$
be a morphism of ringed topoi. Assume $\mathcal{C}$ has enough points.
The functor $Rf_*$ defined above and
the functor $Lf^*$ defined in
Lemma \ref{lemma-derived-base-change} are adjoint:
$$
\Hom_{D(\mathcal{O})}(Lf^*\mathcal{G}^\bullet, \mathcal{F}^\bullet)
=
\Hom_{D(\mathcal{O}')}(\mathcal{G}^\bullet, Rf_*\mathcal{F}^\bullet)
$$
bifunctorially in $\mathcal{F}^\bullet \in \Ob(D(\mathcal{O}))$ and
$\mathcal{G}^\bullet \in \Ob(D(\mathcal{O}'))$.
\end{lemma}

\begin{proof}
This follows formally from the fact that $Rf_*$ and $Lf^*$ exist, see
Derived Categories, Lemma \ref{derived-lemma-derived-adjoint-functors}.
\end{proof}

\begin{remark}
\label{remark-base-change}
The construction of unbounded derived functor $Lf^*$ and $Rf_*$
allows one to construct the base change map in full generality.
Namely, suppose that
$$
\xymatrix{
(\Sh(\mathcal{C}'), \mathcal{O}_{\mathcal{C}'})
\ar[r]_{g'} \ar[d]_{f'} &
(\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \ar[d]^f \\
(\Sh(\mathcal{D}'), \mathcal{O}_{\mathcal{D}'})
\ar[r]^g &
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})
}
$$
is a commutative diagram of ringed topoi. Let $K$ be an object of
$D(\mathcal{O}_\mathcal{C})$.
Then there exists a canonical base change map
$$
Lg^*Rf_*K \longrightarrow R(f')_*L(g')^*K
$$
in $D(\mathcal{O}_{\mathcal{D}'})$. Namely, this map is adjoint to a map
$L(f')^*Lg^*Rf_*K \to L(g')^*K$.
Since $L(f')^* \circ Lg^* = L(g')^* \circ Lf^*$ we see this is the same
as a map $L(g')^*Lf^*Rf_*K \to L(g')^*K$
which we can take to be $L(g')^*$ of the adjunction map
$Lf^*Rf_*K \to K$.
\end{remark}

\begin{remark}
\label{remark-cup-product}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of
ringed topoi. The adjointness of $Lf^*$ and $Rf_*$ allows us to construct
a relative cup product
$$
Rf_*K \otimes_{\mathcal{O}_\mathcal{D}}^\mathbf{L} Rf_*L
\longrightarrow
Rf_*(K \otimes_{\mathcal{O}_\mathcal{C}}^\mathbf{L} L)
$$
in $D(\mathcal{O}_\mathcal{D})$ for all $K, L$ in $D(\mathcal{O}_\mathcal{C})$.
Namely, this map is adjoint to a map
$Lf^*(Rf_*K \otimes_{\mathcal{O}_\mathcal{D}}^\mathbf{L} Rf_*L) \to
K \otimes_{\mathcal{O}_\mathcal{C}}^\mathbf{L} L$ for which we can take the
composition of the isomorphism
$Lf^*(Rf_*K \otimes_{\mathcal{O}_\mathcal{D}}^\mathbf{L} Rf_*L) =
Lf^*Rf_*K \otimes_{\mathcal{O}_\mathcal{C}}^\mathbf{L} Lf^*Rf_*L$
(Lemma \ref{lemma-pullback-tensor-product})
with the map
$Lf^*Rf_*K \otimes_{\mathcal{O}_\mathcal{C}}^\mathbf{L} Lf^*Rf_*L
\to K \otimes_{\mathcal{O}_\mathcal{C}}^\mathbf{L} L$
coming from the counit $Lf^* \circ Rf_* \to \text{id}$.
\end{remark}

\begin{lemma}
\label{lemma-sheafification-cohomology}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K$ be an object of
$D(\mathcal{O})$. The sheafification of $U \mapsto H^q(U, K)$
is the $q$th cohomology sheaf $H^q(K)$ of $K$.
\end{lemma}

\begin{proof}
Choose a K-injective complex $\mathcal{I}^\bullet$ representing $K$.
Then
$$
H^q(U, K) =
\frac{\Ker(\mathcal{I}^q(U) \to \mathcal{I}^{q + 1}(U))}
{\Im(\mathcal{I}^{q - 1}(U) \to \mathcal{I}^q(U))}.
$$
by the discussion above. Since
$H^q(K) = \Ker(\mathcal{I}^q \to \mathcal{I}^{q + 1})/
\Im(\mathcal{I}^{q - 1} \to \mathcal{I}^q)$ the result is clear.
\end{proof}




\section{Some properties of K-injective complexes}
\label{section-properties-K-injective}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be an
object of $\mathcal{C}$. Denote
$j : (\Sh(\mathcal{C}/U), \mathcal{O}_U) \to (\Sh(\mathcal{C}), \mathcal{O})$
the corresponding localization morphism. The pullback functor $j^*$ is exact
as it is just the restriction functor. Thus derived pullback $Lj^*$ is
computed on any complex by simply restricting the complex. We often
simply denote the corresponding functor
$$
D(\mathcal{O}) \to D(\mathcal{O}_U),
\quad
E \mapsto j^*E = E|_U
$$
Similarly, extension by zero
$j_! : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$ (see
Modules on Sites, Definition
\ref{sites-modules-definition-localize-ringed-site})
is an exact functor
(Modules on Sites, Lemma \ref{sites-modules-lemma-extension-by-zero-exact}).
Thus it induces a functor
$$
j_! : D(\mathcal{O}_U) \to D(\mathcal{O}), \quad
F \mapsto j_!F
$$
by simply applying $j_!$ to any complex representing the object $F$.

\begin{lemma}
\label{lemma-restrict-K-injective-to-open}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be an object of
$\mathcal{C}$. The restriction of a K-injective complex of
$\mathcal{O}$-modules to $\mathcal{C}/U$ is a K-injective complex of
$\mathcal{O}_U$-modules.
\end{lemma}

\begin{proof}
Follows immediately from
Derived Categories, Lemma \ref{derived-lemma-adjoint-preserve-K-injectives}
and the fact that the restriction functor has the
exact left adjoint $j_!$. See discussion above.
\end{proof}

\begin{lemma}
\label{lemma-adjoint-lower-shriek-restrict}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be an
object of $\mathcal{C}$. Denote
$j : (\Sh(\mathcal{C}/U), \mathcal{O}_U) \to (\Sh(\mathcal{C}), \mathcal{O})$
the corresponding localization morphism. The restriction functor
$D(\mathcal{O}) \to D(\mathcal{O}_U)$ is a right adjoint to
extension by zero $j_! : D(\mathcal{O}_U) \to D(\mathcal{O})$.
\end{lemma}

\begin{proof}
We have to show that
$$
\Hom_{D(\mathcal{O})}(j_!E, F) = \Hom_{D(\mathcal{O}_U)}(E, F|_U)
$$
Choose a complex $\mathcal{E}^\bullet$ of $\mathcal{O}_U$-modules
representing $E$ and choose
a K-injective complex $\mathcal{I}^\bullet$ representing $F$.
By Lemma \ref{lemma-restrict-K-injective-to-open} the complex
$\mathcal{I}^\bullet|_U$ is K-injective as well. Hence we see that
the formula above becomes
$$
\Hom_{D(\mathcal{O})}(j_!\mathcal{E}^\bullet, \mathcal{I}^\bullet) =
\Hom_{D(\mathcal{O}_U)}(\mathcal{E}^\bullet, \mathcal{I}^\bullet|_U)
$$
which holds as $|_U$ and $j_!$ are adjoint functors
(Modules on Sites, Lemma \ref{sites-modules-lemma-extension-by-zero})
and
Derived Categories, Lemma \ref{derived-lemma-K-injective}.
\end{proof}

\begin{lemma}
\label{lemma-K-injective-flat}
Let $\mathcal{C}$ be a site. Let $\mathcal{O} \to \mathcal{O}'$ be a flat
map of sheaves of rings. If $\mathcal{I}^\bullet$ is a K-injective
complex of $\mathcal{O}'$-modules, then $\mathcal{I}^\bullet$ is K-injective
as a complex of $\mathcal{O}$-modules.
\end{lemma}

\begin{proof}
This is true because
$\Hom_{K(\mathcal{O})}(\mathcal{F}^\bullet, \mathcal{I}^\bullet) =
\Hom_{K(\mathcal{O}')}(\mathcal{F}^\bullet \otimes_\mathcal{O} \mathcal{O}',
\mathcal{I}^\bullet)$ by
Modules on Sites, Lemma \ref{sites-modules-lemma-adjointness-tensor-restrict}
and the fact that tensoring with $\mathcal{O}'$ is exact.
\end{proof}

\begin{lemma}
\label{lemma-hom-K-injective}
Let $\mathcal{C}$ be a site. Let $\mathcal{O} \to \mathcal{O}'$ be a map
of sheaves of rings. If $\mathcal{I}^\bullet$ is a K-injective complex of
$\mathcal{O}$-modules, then $\SheafHom_\mathcal{O}(\mathcal{O}', I^\bullet)$
is a K-injective complex of $\mathcal{O}'$-modules.
\end{lemma}

\begin{proof}
This is true because
$\Hom_{K(\mathcal{O}')}(\mathcal{G}^\bullet,
\Hom_\mathcal{O}(\mathcal{O}', \mathcal{I}^\bullet)) =
\Hom_{K(\mathcal{O})}(\mathcal{G}^\bullet, \mathcal{I}^\bullet)$
by Modules on Sites, Lemma \ref{sites-modules-lemma-adjoint-hom-restrict}.
\end{proof}






\section{Derived and homotopy limits}
\label{section-derived-limits}

\noindent
Let $\mathcal{C}$ be a site. Consider the category
$\mathcal{C} \times \mathbf{N}$ with
$\Mor((U, n), (V, m)) = \emptyset$ if $n > m$ and
$\Mor((U, n), (V, m)) = \Mor(U, V)$ else. We endow this with the
structure of a site by letting coverings
be families $\{(U_i, n) \to (U, n)\}$ such that
$\{U_i \to U\}$ is a covering of $\mathcal{C}$.
Then the reader verifies immediately that
sheaves on $\mathcal{C} \times \mathbf{N}$ are the same thing
as inverse systems of sheaves on $\mathcal{C}$.
In particular $\textit{Ab}(\mathcal{C} \times \mathbf{N})$
is inverse systems of abelian sheaves on $\mathcal{C}$.
Consider now the functor
$$
\lim : \textit{Ab}(\mathcal{C} \times \mathbf{N}) \to \textit{Ab}(\mathcal{C})
$$
which takes an inverse system to its limit. This is nothing but
$g_*$ where $g : \Sh(\mathcal{C} \times \mathbf{N}) \to \Sh(\mathcal{C})$
is the morphism of topoi associated to the continuous and cocontinuous functor
$\mathcal{C} \times \mathbf{N} \to \mathcal{C}$. (Observe that
$g^{-1}$ assigns to a sheaf on $\mathcal{C}$ the corresponding
constant inverse system.)

\medskip\noindent
By the general machinery explained above we obtain a derived functor
$$
R\lim = Rg_* : D(\mathcal{C} \times \mathbf{N}) \to D(\mathcal{C}).
$$
As indicated this functor is often denoted $R\lim$.

\medskip\noindent
On the other hand, the continuous and cocontinuous functors
$\mathcal{C} \to \mathcal{C} \times \mathbf{N}$,
$U \mapsto (U, n)$ define morphisms of topoi
$i_n : \Sh(\mathcal{C}) \to \Sh(\mathcal{C} \times \mathbf{N})$.
Of course $i_n^{-1}$ is the functor which picks the $n$th term of
the inverse system. Thus there are transformations of functors
$i_{n + 1}^{-1} \to i_n^{-1}$. Hence given
$K \in D(\mathcal{C} \times \mathbf{N})$ we get
$K_n = i_n^{-1}K \in D(\mathcal{C})$ and maps $K_{n + 1} \to K_n$.
In Derived Categories, Definition \ref{derived-definition-derived-limit}
we have defined the notion of a homotopy limit
$$
R\lim K_n \in D(\mathcal{C})
$$
We claim the two notions agree (as far as it makes sense).

\begin{lemma}
\label{lemma-derived-limit-is-ok}
Let $\mathcal{C}$ be a site. Let $K$ be an object of
$D(\mathcal{C} \times \mathbf{N})$. Set $K_n = i_n^{-1}K$ as above.
Then
$$
R\lim K \cong R\lim K_n
$$
in $D(\mathcal{C})$.
\end{lemma}

\begin{proof}
To calculate $R\lim$ on an object $K$ of $D(\mathcal{C} \times \mathbf{N})$
we choose a K-injective representative $\mathcal{I}^\bullet$ whose terms are
injective objects of $\textit{Ab}(\mathcal{C} \times \mathbf{N})$, see
Injectives, Theorem
\ref{injectives-theorem-K-injective-embedding-grothendieck}.
We may and do think of $\mathcal{I}^\bullet$ as an inverse system of
complexes $(\mathcal{I}_n^\bullet)$ and then we see that
$$
R\lim K = \lim \mathcal{I}_n^\bullet
$$
where the right hand side is the termwise inverse limit.

\medskip\noindent
Let $\mathcal{J} = (\mathcal{J}_n)$ be an injective object of
$\textit{Ab}(\mathcal{C} \times \mathbf{N})$. The morphisms
$(U, n) \to (U, n + 1)$ are monomorphisms of
$\mathcal{C} \times \mathbf{N}$, hence
$\mathcal{J}(U, n + 1) \to \mathcal{J}(U, n)$ is surjective
(Lemma \ref{lemma-restriction-along-monomorphism-surjective}).
It follows that $\mathcal{J}_{n + 1} \to \mathcal{J}_n$ is
surjective as a map of presheaves.

\medskip\noindent
Note that the functor $i_n^{-1}$ has an exact left adjoint $i_{n, !}$.
Namely, $i_{n, !}\mathcal{F}$ is the inverse system
$\ldots 0 \to 0 \to \mathcal{F} \to \ldots \to \mathcal{F}$.
Thus the complexes $i_n^{-1}\mathcal{I}^\bullet = \mathcal{I}_n^\bullet$
are K-injective by
Derived Categories, Lemma \ref{derived-lemma-adjoint-preserve-K-injectives}.

\medskip\noindent
Because we chose our K-injective complex to have injective terms
we conclude that
$$
0 \to  \lim \mathcal{I}_n^\bullet \to \prod \mathcal{I}_n^\bullet
\to \prod \mathcal{I}_n^\bullet \to 0
$$
is a short exact sequence of complexes of abelian sheaves as it
is a short exact sequence of complexes of abelian presheaves.
Moreover, the products in the middle and the right represent
the products in $D(\mathcal{C})$, see
Injectives, Lemma \ref{injectives-lemma-derived-products} and its
proof (this is where we use that $\mathcal{I}_n^\bullet$ is K-injective).
Thus $R\lim K$ is a homotopy limit of the inverse system $(K_n)$
by definition of homotopy limits in triangulated categories.
\end{proof}

\begin{lemma}
\label{lemma-Rf-commutes-with-Rlim}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{D}), \mathcal{O}')$
be a morphism of ringed topoi. Then $Rf_*$ commutes with $R\lim$, i.e.,
$Rf_*$ commutes with derived limits.
\end{lemma}

\begin{proof}
Let $(K_n)$ be an inverse system of objects of $D(\mathcal{O})$.
By induction on $n$ we may choose actual complexes $\mathcal{K}_n^\bullet$
of $\mathcal{O}$-modules and maps of complexes
$\mathcal{K}_{n + 1}^\bullet \to \mathcal{K}_n^\bullet$ representing the
maps $K_{n + 1} \to K_n$ in $D(\mathcal{O})$. In other words, there exists
an object $K$ in $D(\mathcal{C} \times \mathbf{N})$ whose associated inverse
system is the given one. Next, consider the commutative diagram
$$
\xymatrix{
\Sh(\mathcal{C} \times \mathbf{N}) \ar[r]_g \ar[d]_{f \times 1} &
\Sh(\mathcal{C}) \ar[d]_f \\
\Sh(\mathcal{C}' \times \mathbf{N}) \ar[r]^{g'} &
\Sh(\mathcal{C}')
}
$$
of morphisms of topoi. It follows that
$R\lim R(f \times 1)_*K = Rf_* R\lim K$. Working through the definitions
and using Lemma \ref{lemma-derived-limit-is-ok}
we obtain that $R\lim (Rf_*K_n) = Rf_*(R\lim K_n)$.

\medskip\noindent
Alternate proof in case $\mathcal{C}$ has enough points. Consider the defining
distinguished triangle
$$
R\lim K_n \to \prod K_n \to \prod K_n
$$
in $D(\mathcal{O})$. Applying the exact functor $Rf_*$ we obtain
the distinguished triangle
$$
Rf_*(R\lim K_n) \to Rf_*\left(\prod K_n\right) \to Rf_*\left(\prod K_n\right)
$$
in $D(\mathcal{O}')$. Thus we see that it suffices to prove that
$Rf_*$ commutes with products in the derived category (which are not just
given by products of complexes, see
Injectives, Lemma \ref{injectives-lemma-derived-products}).
However, since $Rf_*$ is a right adjoint by Lemma \ref{lemma-adjoint}
this follows formally (see
Categories, Lemma \ref{categories-lemma-adjoint-exact}).
Caution: Note that we cannot apply
Categories, Lemma \ref{categories-lemma-adjoint-exact}
directly as $R\lim K_n$ is not a limit in $D(\mathcal{O})$.
\end{proof}

\begin{remark}
\label{remark-discuss-derived-limit}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $(K_n)$ be an inverse
system in $D(\mathcal{O})$. Set $K = R\lim K_n$. For each $n$ and $m$
let $\mathcal{H}^m_n = H^m(K_n)$ be the $m$th cohomology sheaf of
$K_n$ and similarly set $\mathcal{H}^m = H^m(K)$. Let us denote
$\underline{\mathcal{H}}^m_n$ the presheaf
$$
U \longmapsto \underline{\mathcal{H}}^m_n(U) = H^m(U, K_n)
$$
Similarly we set $\underline{\mathcal{H}}^m(U) = H^m(U, K)$.
By Lemma \ref{lemma-sheafification-cohomology} we see that
$\mathcal{H}^m_n$ is the sheafification of
$\underline{\mathcal{H}}^m_n$ and $\mathcal{H}^m$ is the
sheafification of $\underline{\mathcal{H}}^m$.
Here is a diagram
$$
\xymatrix{
K \ar@{=}[d] &
\underline{\mathcal{H}}^m \ar[d] \ar[r] & 
\mathcal{H}^m \ar[d] \\
R\lim K_n &
\lim \underline{\mathcal{H}}^m_n \ar[r] & 
\lim \mathcal{H}^m_n
}
$$
In general it may not be the case that
$\lim \mathcal{H}^m_n$ is the sheafification of
$\lim \underline{\mathcal{H}}^m_n$.
If $U \subset X$ is an open, then we have short exact
sequences
\begin{equation}
\label{equation-ses-Rlim-over-U}
0 \to
R^1\lim \underline{\mathcal{H}}^{m - 1}_n(U) \to
\underline{\mathcal{H}}^m(U) \to
\lim \underline{\mathcal{H}}^m_n(U) \to 0
\end{equation}
This follows from the fact that $R\Gamma(U, -)$ commutes with derived limits
(Injectives, Lemma \ref{injectives-lemma-RF-commutes-with-Rlim})
and More on Algebra, Remark \ref{more-algebra-remark-compare-derived-limit}.
\end{remark}

\noindent
The following lemma applies to an inverse system of quasi-coherent
modules with surjective transition maps on an algebraic space or
an algebraic stack.

\begin{lemma}
\label{lemma-inverse-limit-is-derived-limit}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $(\mathcal{F}_n)$ be an
inverse system of $\mathcal{O}$-modules. Let
$\mathcal{B} \subset \Ob(\mathcal{C})$ be a subset. Assume
\begin{enumerate}
\item every object of $\mathcal{C}$ has a covering whose members are elements
of $\mathcal{B}$,
\item $H^p(U, \mathcal{F}_n) = 0$ for $p > 0$ and $U \in \mathcal{B}$,
\item the inverse system $\mathcal{F}_n(U)$ has vanishing $R^1\lim$
for $U \in \mathcal{B}$.
\end{enumerate}
Then $R\lim \mathcal{F}_n = \lim \mathcal{F}_n$.
\end{lemma}

\begin{proof}
Set $K_n = \mathcal{F}_n$ and $K = R\lim \mathcal{F}_n$. Using the notation
of Remark \ref{remark-discuss-derived-limit} and assumption (2) we see that for
$U \in \mathcal{B}$ we have $\underline{\mathcal{H}}_n^m(U) = 0$
when $m \not = 0$ and $\underline{\mathcal{H}}_n^0(U) = \mathcal{F}_n(U)$.
From Equation (\ref{equation-ses-Rlim-over-U}) and assumption (3)
we see that $\underline{\mathcal{H}}^m(U) = 0$
when $m \not = 0$ and equal to $\lim \mathcal{F}_n(U)$
when $m = 0$. Sheafifying using (1) we find that
$\mathcal{H}^m = 0$ when $m \not = 0$ and equal to
$\lim \mathcal{F}_n$ when $m = 0$.
\end{proof}

\begin{lemma}
\label{lemma-is-limit}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $E \in D(\mathcal{O})$.
Assume there exists a subset $\mathcal{B} \subset \Ob(\mathcal{C})$ such that
\begin{enumerate}
\item every object of $\mathcal{C}$ has a covering whose members are
elements of $\mathcal{B}$,
\item $\forall m$, $\exists p(m)$ such that
$H^p(U, H^{m - p}(E)) = 0$ for all $p > p(m)$ and $U \in \mathcal{B}$.
(For example if $H^p(U, H^q(E)) = 0$ for all
$p > 0$, $q < 0$, $U \in \mathcal{B}$.)
\end{enumerate}
Then the canonical map
$$
E \longrightarrow R\lim \tau_{\geq -n} E
$$
is an isomorphism in $D(\mathcal{O})$.
\end{lemma}

\begin{proof}
(The parenthetical statement holds because the condition
$H^p(U, H^q(E)) = 0$ for all $p > 0$, $q < 0$, $U \in \mathcal{B}$
is equivalent to $p(m) = \max(0, m)$ in the lemma.)
The canonical map $E \to R\lim \tau_{\geq -n}E$
comes from the canonical maps $E \to \tau_{\geq -n}E$.
Set $K_n = \tau_{\geq -n}E$ and $K = R\lim K_n$.
We will use the notation introduced in
Remark \ref{remark-discuss-derived-limit}.
Fix $m \in \mathbf{Z}$.
Recall (Derived Categories, Remark
\ref{derived-remark-truncation-distinguished-triangle})
that we have distinguished triangles
$$
K_{n + 1} \to K_n \to \mathcal{E}^{-n}[n] \to K_{n + 1}[1]
$$
where $\mathcal{E}^i = H^i(E)$ denotes the $i$th cohomology sheaf of $E$.
Let $U \in \mathcal{B}$.
The associated long exact cohomology sequence gives
$$
H^m(U, \mathcal{E}^{-n}[n - 1]) \to
H^m(U, K_{n + 1}) \to H^m(U, K_n) \to
H^m(U, \mathcal{E}^{-n}[n])
$$
The first and the last groups are equal to
$H^{m + n - 1}(U, \mathcal{E}^{-n})$ and
$H^{m + n}(U, \mathcal{E}^{-n})$.
By assumption (2) if $m + n - 1 > p(m - 1)$ and $m + n > p(m)$, i.e., if
$n \geq n_m = 1 + \max(p(m - 1) - m + 1, p(m) - m)$, then these two groups
are zero. We conclude that the inverse system
$$
\ldots \to
\underline{\mathcal{H}}^m_3(U) \to
\underline{\mathcal{H}}^m_2(U) \to
\underline{\mathcal{H}}^m_1(U)
$$
is constant for $n \geq n_m$. We conclude that these inverse systems have
vanishing $R^1\lim$ (for all $m$). By Equation (\ref{equation-ses-Rlim-over-U})
$$
\underline{\mathcal{H}}^m(U) =
\ldots =
\underline{\mathcal{H}}^m_{n_m + 2}(U) =
\underline{\mathcal{H}}^m_{n_m + 1}(U) =
\underline{\mathcal{H}}^m_{n_m}(U)
$$
for all $U \in \mathcal{B}$. By property (1) we find that
$\underline{\mathcal{H}}^m$ and $\underline{\mathcal{H}}^m_{n_m + i}$
have the same sheafification for $i \geq 0$. If $-n_m - i < m$, then
this sheafification is equal to $\mathcal{E}^m$ by
Lemma \ref{lemma-sheafification-cohomology}
applied to $K_{n_m + i} = \tau_{\geq -n_m - i}E$.
This implies that $E \to K$ induces an isomorphism
on cohomology sheaves which is what we wanted to prove.
\end{proof}

\noindent
The lemma above can be used to compute cohomology
in certain situations.

\begin{lemma}
\label{lemma-cohomology-over-U-trivial}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K$
be an object of $D(\mathcal{O})$.
Let $\mathcal{B} \subset \Ob(\mathcal{C})$ be a subset. Assume
\begin{enumerate}
\item every object of $\mathcal{C}$ has a covering whose members are
elements of $\mathcal{B}$,
\item $H^p(U, H^q(K)) = 0$ for all $p > 0$, $q \in \mathbf{Z}$, and
$U \in \mathcal{B}$.
\end{enumerate}
Then $H^q(U, K) = H^0(U, H^q(K))$ for $q \in \mathbf{Z}$
and $U \in \mathcal{B}$.
\end{lemma}

\begin{proof}
Observe that $K = R\lim \tau_{\geq -n} K$ by Lemma \ref{lemma-is-limit}.
Let $U \in \mathcal{B}$. By Equation (\ref{equation-ses-Rlim-over-U})
we get a short exact sequence
$$
0 \to R^1\lim H^{q - 1}(U, \tau_{\geq -n}K) \to
H^q(U, K) \to \lim H^q(U, \tau_{\geq -n}K) \to 0
$$
Condition (2) implies
$H^q(U, \tau_{\geq -n} K) = H^0(U, H^q(\tau_{\geq -n} K))$
for all $q$ by using the spectral sequence of
Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor}.
The spectral sequence converges because $\tau_{\geq -n}K$ is bounded
below. If $n > -q$ then we have $H^q(\tau_{\geq -n}K) = H^q(K)$.
Thus the systems on the left and the right of the displayed
short exact sequence are eventually constant with values
$H^0(U, H^{q - 1}(K))$ and $H^0(U, H^q(K))$ and the lemma follows.
\end{proof}

\noindent
Here is another case where we can describe the derived limit.

\begin{lemma}
\label{lemma-derived-limit-suitable-system}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $(K_n)$
be an inverse system of objects of $D(\mathcal{O})$.
Let $\mathcal{B} \subset \Ob(\mathcal{C})$ be a subset. Assume
\begin{enumerate}
\item every object of $\mathcal{C}$ has a covering whose members are
elements of $\mathcal{B}$,
\item for all $U \in \mathcal{B}$ and all $q \in \mathbf{Z}$ we have
\begin{enumerate}
\item $H^p(U, H^q(K_n)) = 0$ for $p > 0$,
\item the inverse system $H^0(U, H^q(K_n))$ has vanishing $R^1\lim$.
\end{enumerate}
\end{enumerate}
Then $H^q(R\lim K_n) = \lim H^q(K_n)$ for $q \in \mathbf{Z}$
and $R^t\lim H^q(K_n) = 0$ for $t > 0$.
\end{lemma}

\begin{proof}
Set $K = R\lim K_n$. We will use notation as in
Remark \ref{remark-discuss-derived-limit}. Let $U \in \mathcal{B}$.
By Lemma \ref{lemma-cohomology-over-U-trivial} and (2)(a)
we have $H^q(U, K_n) = H^0(U, H^q(K_n))$.
Using that the functor $R\Gamma(U, -)$ commutes with
derived limits we have
$$
H^q(U, K) = H^q(R\lim R\Gamma(U, K_n)) = \lim H^0(U, H^q(K_n))
$$
where the final equality follows from
More on Algebra, Remark \ref{more-algebra-remark-compare-derived-limit}
and assumption (2)(b). Thus $H^q(U, K)$ is the inverse limit
the sections of the sheaves $H^q(K_n)$ over $U$. Since
$\lim H^q(K_n)$ is a sheaf we find using assumption (1) that $H^q(K)$,
which is the sheafification of the presheaf $U \mapsto H^q(U, K)$,
is equal to $\lim H^q(K_n)$. This proves the first statement.
The second is Lemma \ref{lemma-inverse-limit-is-derived-limit}.
\end{proof}







\section{Producing K-injective resolutions}
\label{section-K-injective}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}^\bullet$ be a complex of $\mathcal{O}$-modules.
The category $\textit{Mod}(\mathcal{O})$ has enough injectives, hence
we can use
Derived Categories, Lemma \ref{derived-lemma-special-inverse-system}
produce a diagram
$$
\xymatrix{
\ldots \ar[r] &
\tau_{\geq -2}\mathcal{F}^\bullet \ar[r] \ar[d] &
\tau_{\geq -1}\mathcal{F}^\bullet \ar[d] \\
\ldots \ar[r] & \mathcal{I}_2^\bullet \ar[r] & \mathcal{I}_1^\bullet
}
$$
in the category of complexes of $\mathcal{O}$-modules such that
\begin{enumerate}
\item the vertical arrows are quasi-isomorphisms,
\item $\mathcal{I}_n^\bullet$ is a bounded below complex of injectives,
\item the arrows $\mathcal{I}_{n + 1}^\bullet \to \mathcal{I}_n^\bullet$
are termwise split surjections.
\end{enumerate}
The category of $\mathcal{O}$-modules has limits (they are computed
on the level of presheaves), hence we can form the termwise limit
$\mathcal{I}^\bullet = \lim_n \mathcal{I}_n^\bullet$. By
Derived Categories, Lemmas
\ref{derived-lemma-bounded-below-injectives-K-injective} and
\ref{derived-lemma-limit-K-injectives}
this is a K-injective complex. In general the canonical map
\begin{equation}
\label{equation-into-candidate-K-injective}
\mathcal{F}^\bullet \to \mathcal{I}^\bullet
\end{equation}
may not be a quasi-isomorphism. In the following lemma we describe some
conditions under which it is.

\begin{lemma}
\label{lemma-K-injective}
In the situation described above. Denote
$\mathcal{H}^m = H^m(\mathcal{F}^\bullet)$ the $m$th cohomology sheaf.
Let $\mathcal{B} \subset \Ob(\mathcal{C})$ be a subset.
Let $d \in \mathbf{N}$.
Assume
\begin{enumerate}
\item every object of $\mathcal{C}$ has a covering whose members are
elements of $\mathcal{B}$,
\item for every $U \in \mathcal{B}$ we have $H^p(U, \mathcal{H}^q) = 0$
for $p > d$ and $q < 0$\footnote{It suffices if
$\forall m$, $\exists p(m)$, $H^p(U. \mathcal{H}^{m - p}) = 0$ for
$p > p(m)$.}.
\end{enumerate}
Then (\ref{equation-into-candidate-K-injective}) is a quasi-isomorphism.
\end{lemma}

\begin{proof}
By Derived Categories, Lemma \ref{derived-lemma-difficulty-K-injectives}
it suffices to show that the canonical map
$\mathcal{F}^\bullet \to R\lim \tau_{\geq -n} \mathcal{F}^\bullet$
is an isomorphism. This follows from Lemma \ref{lemma-is-limit}
with $p(m) = \max(d, m)$.
\end{proof}

\noindent
Here is a technical lemma about cohomology sheaves of termwise limits of
inverse systems of complexes of modules. We should avoid using this lemma
as much as possible and instead use arguments with derived inverse
limits.

\begin{lemma}
\label{lemma-inverse-limit-complexes}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let
$(\mathcal{F}_n^\bullet)$ be an inverse system of complexes of
$\mathcal{O}$-modules. Let $m \in \mathbf{Z}$. Suppose given
$\mathcal{B} \subset \Ob(\mathcal{C})$ and an integer
$n_0$ such that
\begin{enumerate}
\item every object of $\mathcal{C}$ has a covering whose members are
elements of $\mathcal{B}$,
\item for every $U \in \mathcal{B}$
\begin{enumerate}
\item the systems of abelian groups
$\mathcal{F}_n^{m - 2}(U)$ and $\mathcal{F}_n^{m - 1}(U)$
have vanishing $R^1\lim$ (for example these have the Mittag-Leffler property),
\item the system of abelian groups $H^{m - 1}(\mathcal{F}_n^\bullet(U))$
has vanishing $R^1\lim$ (for example it has the Mittag-Leffler property), and
\item we have
$H^m(\mathcal{F}_n^\bullet(U)) = H^m(\mathcal{F}_{n_0}^\bullet(U))$
for all $n \geq n_0$.
\end{enumerate}
\end{enumerate}
Then the maps $H^m(\mathcal{F}^\bullet) \to \lim H^m(\mathcal{F}_n^\bullet)
\to H^m(\mathcal{F}_{n_0}^\bullet)$ are isomorphisms of sheaves where
$\mathcal{F}^\bullet = \lim \mathcal{F}_n^\bullet$ is the termwise
inverse limit. 
\end{lemma}

\begin{proof}
Let $U \in \mathcal{B}$. Note that
$H^m(\mathcal{F}^\bullet(U))$ is the cohomology of
$$
\lim_n \mathcal{F}_n^{m - 2}(U) \to
\lim_n \mathcal{F}_n^{m - 1}(U) \to
\lim_n \mathcal{F}_n^m(U) \to
\lim_n \mathcal{F}_n^{m + 1}(U)
$$
in the third spot from the left. By assumptions (2)(a) and (2)(b)
we may apply
More on Algebra, Lemma \ref{more-algebra-lemma-apply-Mittag-Leffler-again}
to conclude that
$$
H^m(\mathcal{F}^\bullet(U)) = \lim H^m(\mathcal{F}_n^\bullet(U))
$$
By assumption (2)(c) we conclude
$$
H^m(\mathcal{F}^\bullet(U)) = H^m(\mathcal{F}_n^\bullet(U))
$$
for all $n \geq n_0$. By assumption (1) we conclude that the sheafification of
$U \mapsto H^m(\mathcal{F}^\bullet(U))$ is equal to the sheafification
of $U \mapsto H^m(\mathcal{F}_n^\bullet(U))$ for all $n \geq n_0$.
Thus the inverse system of sheaves $H^m(\mathcal{F}_n^\bullet)$ is
constant for $n \geq n_0$ with value $H^m(\mathcal{F}^\bullet)$ which
proves the lemma.
\end{proof}

\noindent
The construction above can be used in the following setting.
Let $\mathcal{C}$ be a category. Let
$\text{Cov}(\mathcal{C}) \supset \text{Cov}'(\mathcal{C})$
be two ways to endow $\mathcal{C}$ with the structure of a site.
Denote $\tau$ the topology corresponding to $\text{Cov}(\mathcal{C})$
and $\tau'$ the topology corresponding to $\text{Cov}'(\mathcal{C})$.
Then the identity functor on $\mathcal{C}$ defines a morphism
of sites
$$
\epsilon : \mathcal{C}_\tau \longrightarrow \mathcal{C}_{\tau'}
$$
where $\epsilon_*$ is the identity functor on underlying presheaves and
where $\epsilon^{-1}$ is the $\tau$-sheafification of a $\tau'$-sheaf
(hence clearly exact). Let $\mathcal{O}$ be a sheaf of rings for the
$\tau$-topology. Then $\mathcal{O}$ is also a sheaf for the $\tau'$-topology
and $\epsilon$ becomes a morphism of ringed sites
$$
\epsilon :
(\mathcal{C}_\tau, \mathcal{O}_\tau)
\longrightarrow
(\mathcal{C}_{\tau'}, \mathcal{O}_{\tau'})
$$
In this situation we can sometimes point out subcategories of
$D(\mathcal{O}_\tau)$ and $D(\mathcal{O}_{\tau'})$ which are
identified by the functors $\epsilon^*$ and $R\epsilon_*$.

\begin{lemma}
\label{lemma-compare-topologies-derived-adequate-modules}
With $\epsilon :
(\mathcal{C}_\tau, \mathcal{O}_\tau)
\longrightarrow
(\mathcal{C}_{\tau'}, \mathcal{O}_{\tau'})$
as above. Let $\mathcal{B} \subset \Ob(\mathcal{C})$ be a subset.
Let $\mathcal{A} \subset \textit{PMod}(\mathcal{O})$
be a full subcategory. Assume
\begin{enumerate}
\item every object of $\mathcal{A}$ is a sheaf for the $\tau$-topology,
\item $\mathcal{A}$ is a weak Serre subcategory of
$\textit{Mod}(\mathcal{O}_\tau)$,
\item every object of $\mathcal{C}$ has a $\tau'$-covering whose
members are elements of $\mathcal{B}$, and
\item for every $U \in \mathcal{B}$ we have $H^p_\tau(U, \mathcal{F}) = 0$,
$p > 0$ for all $\mathcal{F} \in \mathcal{A}$.
\end{enumerate}
Then $\mathcal{A}$ is a weak Serre subcategory of
$\textit{Mod}(\mathcal{O}_\tau)$ and there is an equivalence
of triangulated categories
$D_\mathcal{A}(\mathcal{O}_\tau) = D_\mathcal{A}(\mathcal{O}_{\tau'})$
given by $\epsilon^*$ and $R\epsilon_*$.
\end{lemma}

\begin{proof}
Note that for $A \in \mathcal{A}$ we can think of $A$ as a sheaf in either
topology and (abusing notation) that $\epsilon_*A = A$ and $\epsilon^*A = A$.
Consider an exact sequence
$$
A_0 \to A_1 \to A_2 \to A_3 \to A_4
$$
in $\textit{Mod}(\mathcal{O}_{\tau'})$ with $A_0, A_1, A_3, A_4$ in
$\mathcal{A}$. We have to show that $A_2$ is an element of $\mathcal{A}$, see
Homology, Definition \ref{homology-definition-serre-subcategory}.
Apply the exact functor $\epsilon^* = \epsilon^{-1}$
to conclude that $\epsilon^*A_2$ is an object of $\mathcal{A}$.
Consider the map of sequences
$$
\xymatrix{
A_0 \ar[r] \ar[d] & A_1 \ar[r] \ar[d] &
A_2 \ar[r] \ar[d] & A_3 \ar[r] \ar[d] & A_4 \ar[d] \\
A_0 \ar[r] & A_1 \ar[r] &
\epsilon_*\epsilon^*A_2 \ar[r] & A_3 \ar[r] & A_4
}
$$
to conclude that $A_2 = \epsilon_*\epsilon^*A_2$ is an object
of $\mathcal{A}$. At this point it makes sense to talk about the
derived categories $D_\mathcal{A}(\mathcal{O}_\tau)$ and
$D_\mathcal{A}(\mathcal{O}_{\tau'})$, see
Derived Categories, Section \ref{derived-section-triangulated-sub}.

\medskip\noindent
Since $\epsilon^*$ is exact and preserves $\mathcal{A}$, it is clear that
we obtain a functor $\epsilon^* : D_\mathcal{A}(\mathcal{O}_{\tau'}) \to
D_\mathcal{A}(\mathcal{O}_\tau)$. We claim that $R\epsilon_*$ is a
quasi-inverse. Namely, let $\mathcal{F}^\bullet$ be an
object of $D_\mathcal{A}(\mathcal{O}_\tau)$. Construct a map
$\mathcal{F}^\bullet \to \mathcal{I}^\bullet = \lim \mathcal{I}_n^\bullet$
as in (\ref{equation-into-candidate-K-injective}). By
Lemma \ref{lemma-K-injective} and assumption (4) we see that
$\mathcal{F}^\bullet \to \mathcal{I}^\bullet$ is a quasi-isomorphism.
Then
$$
R\epsilon_*\mathcal{F}^\bullet = \epsilon_*\mathcal{I}^\bullet =
\lim_n \epsilon_*\mathcal{I}_n^\bullet
$$
For every $U \in \mathcal{B}$ we have
$$
H^m(\epsilon_*\mathcal{I}_n^\bullet(U)) =
H^m(\mathcal{I}_n^\bullet(U)) =
\left\{
\begin{matrix}
H^m(\mathcal{F}^\bullet)(U) & \text{if} & m \geq -n \\
0 & \text{if} & m < n
\end{matrix}
\right.
$$
by the assumed vanishing of (4), the spectral sequence
Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor},
and the fact that
$\tau_{\geq -n}\mathcal{F}^\bullet \to \mathcal{I}_n^\bullet$
is a quasi-isomorphism. The maps
$\epsilon_*\mathcal{I}_{n + 1}^\bullet \to \epsilon_*\mathcal{I}_n^\bullet$
are termwise split surjections as $\epsilon_*$ is a functor.
Hence we can apply
Homology, Lemma \ref{homology-lemma-apply-Mittag-Leffler-again}
to the sequence of complexes
$$
\lim_n \epsilon_*\mathcal{I}_n^{m - 2}(U) \to
\lim_n \epsilon_*\mathcal{I}_n^{m - 1}(U) \to
\lim_n \epsilon_*\mathcal{I}_n^m(U) \to
\lim_n \epsilon_*\mathcal{I}_n^{m + 1}(U)
$$
to conclude that
$H^m(\epsilon_*\mathcal{I}^\bullet(U)) = H^m(\mathcal{F}^\bullet)(U)$
for $U \in \mathcal{B}$.
Sheafifying and using property (3) this proves that
$H^m(\epsilon_*\mathcal{I}^\bullet)$ is isomorphic
to $\epsilon_*H^m(\mathcal{F}^\bullet)$, i.e., is an object of
$\mathcal{A}$. Thus $R\epsilon_*$ indeed gives rise to a functor
$$
R\epsilon_* : 
D_\mathcal{A}(\mathcal{O}_\tau)
\longrightarrow
D_\mathcal{A}(\mathcal{O}_{\tau'})
$$
For $\mathcal{F}^\bullet \in D_\mathcal{A}(\mathcal{O}_\tau)$
the adjunction map
$\epsilon^*R\epsilon_*\mathcal{F}^\bullet \to \mathcal{F}^\bullet$
is a quasi-isomorphism as we've seen above that the cohomology sheaves
of $R\epsilon_*\mathcal{F}^\bullet$ are
$\epsilon_*H^m(\mathcal{F}^\bullet)$. For
$\mathcal{G}^\bullet \in D_\mathcal{A}(\mathcal{O}_{\tau'})$ the
adjunction map
$\mathcal{G}^\bullet \to R\epsilon_*\epsilon^*\mathcal{G}^\bullet$
is a quasi-isomorphism for the same reason, i.e., because
the cohomology sheaves of $R\epsilon_*\epsilon^*\mathcal{G}^\bullet$
are isomorphic to
$\epsilon_*H^m(\epsilon^*\mathcal{G}) = H^m(\mathcal{G}^\bullet)$.
\end{proof}









\section{Cohomology on Hausdorff and locally quasi-compact spaces}
\label{section-cohomology-LC}

\noindent
We continue our convention to say ``Hausdorff and locally quasi-compact''
instead of saying ``locally compact'' as is often done in the literature.
Let $\textit{LC}$ denote the category whose objects are Hausdorff and
locally quasi-compact topological spaces and whose morphisms are continuous
maps.

\begin{lemma}
\label{lemma-LC-basic}
The category $\textit{LC}$ has fibre products and a final object and hence
has arbitrary finite limits. Given morphisms $X \to Z$ and $Y \to Z$
in $\textit{LC}$ with
$X$ and $Y$ quasi-compact, then $X \times_Z Y$ is quasi-compact.
\end{lemma}

\begin{proof}
The final object is the singleton space. Given morphisms $X \to Z$ and
$Y \to Z$ of $\textit{LC}$ the fibre product $X \times_Z Y$ is
a subspace of $X \times Y$. Hence $X \times_Z Y$ is Hausdorff as
$X \times Y$ is Hausdorff by
Topology, Section \ref{topology-section-Hausdorff}.

\medskip\noindent
If $X$ and $Y$ are quasi-compact, then $X \times Y$ is quasi-compact by 
Topology, Theorem \ref{topology-theorem-tychonov}.
Since $X \times_Z Y$ is a closed subset of $X \times Y$
(Topology, Lemma \ref{topology-lemma-fibre-product-closed})
we find that $X \times_Z Y$ is quasi-compact by
Topology, Lemma \ref{topology-lemma-closed-in-quasi-compact}.

\medskip\noindent
Finally, returning to the general case, if $x \in X$ and $y \in Y$
we can pick quasi-compact neighbourhoods $x \in E \subset X$ and
$y \in F \subset Y$ and we find that $E \times_Z F$ is a quasi-compact
neighbourhood of $(x, y)$ by the result above. Thus $X \times_Z Y$
is an object of $\textit{LC}$ by
Topology, Lemma \ref{topology-lemma-locally-quasi-compact-Hausdorff}.
\end{proof}

\noindent
We can endow $\textit{LC}$ with a stronger topology than the usual one.

\begin{definition}
\label{definition-covering-LC}
Let $\{f_i : X_i \to X\}$ be a family of morphisms with fixed target
in the category $\textit{LC}$. We say this family is a
{\it qc covering}\footnote{This is nonstandard notation.
We chose it to remind the reader of fpqc coverings of schemes.}
if for every $x \in X$ there exist $i_1, \ldots, i_n \in I$ and
quasi-compact subsets $E_j \subset X_{i_j}$ such that
$\bigcup f_{i_j}(E_j)$ is a neighbourhood of $x$.
\end{definition}

\noindent
Observe that an open covering $X = \bigcup U_i$ of an object of $\textit{LC}$
gives a qc covering $\{U_i \to X\}$ because $X$ is locally quasi-compact.
We start with the obligatory lemma.

\begin{lemma}
\label{lemma-qc}
Let $X$ be a Hausdorff and locally quasi-compact space, in other words,
an object of $\textit{LC}$.
\begin{enumerate}
\item If $X' \to X$ is an isomorphism in $\textit{LC}$ then
$\{X' \to X\}$ is a qc covering.
\item If $\{f_i : X_i \to X\}_{i\in I}$ is a qc covering and for each
$i$ we have a qc covering $\{g_{ij} : X_{ij} \to X_i\}_{j\in J_i}$, then
$\{X_{ij} \to X\}_{i \in I, j\in J_i}$ is a qc covering.
\item If $\{X_i \to X\}_{i\in I}$ is a qc covering
and $X' \to X$ is a morphism of $\textit{LC}$ then
$\{X' \times_X X_i \to X'\}_{i\in I}$ is a qc covering.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) holds by the remark above that open coverings are qc coverings.

\medskip\noindent
Proof of (2). Let $x \in X$. Choose $i_1, \ldots, i_n \in I$ and
$E_a \subset X_{i_a}$ quasi-compact such that $\bigcup f_{i_a}(E_a)$
is a neighbourhood of $x$. For every $e \in E_a$ we can find
a finite subset $J_e \subset J_{i_a}$ and quasi-compact
$F_{e, j} \subset X_{ij}$, $j \in J_e$ such that $\bigcup g_{ij}(F_{e, j})$
is a neighbourhood of $e$. Since $E_a$ is quasi-compact we find
a finite collection $e_1, \ldots, e_{m_a}$ such that
$$
E_a \subset
\bigcup\nolimits_{k = 1, \ldots, m_a}
\bigcup\nolimits_{j \in J_{e_k}} g_{ij}(F_{e_k, j})
$$
Then we find that
$$
\bigcup\nolimits_{a = 1, \ldots, n}
\bigcup\nolimits_{k = 1, \ldots, m_a}
\bigcup\nolimits_{j \in J_{e_k}} f_i(g_{ij}(F_{e_k, j}))
$$
is a neighbourhood of $x$.

\medskip\noindent
Proof of (3). Let $x' \in X'$ be a point. Let $x \in X$ be its image.
Choose $i_1, \ldots, i_n \in I$ and quasi-compact subsets
$E_j \subset X_{i_j}$ such that $\bigcup f_{i_j}(E_j)$ is a
neighbourhood of $x$. Choose a quasi-compact neighbourhood $F \subset X'$
of $x'$ which maps into the quasi-compact neighbourhood
$\bigcup f_{i_j}(E_j)$ of $x$. Then
$F \times_X E_j \subset X' \times_X X_{i_j}$ is a
quasi-compact subset and $F$ is the image of the map
$\coprod F \times_X E_j \to F$. Hence the base change is a
qc covering and the proof is finished.
\end{proof}

\noindent
Besides some set theoretic issues the lemma above shows that
$\textit{LC}$ with the collection of qc coverings forms a site.
We will denote this site (suitably modified to overcome the
set theoretical issues)
$\textit{LC}_{qc}$.

\begin{remark}[Set theoretic issues]
\label{remark-set-theoretic-LC}
The category $\textit{LC}$ is a ``big'' category as its objects form
a proper class. Similarly, the coverings form a proper class.
Let us define the {\it size} of a topological space $X$ to be the
cardinality of the set of points of $X$. Choose a function
$Bound$ on cardinals, for example as in
Sets, Equation (\ref{sets-equation-bound}).
Finally, let $S_0$ be an initial set of objects objects of $\textit{LC}$,
for example $S_0 = \{(\mathbf{R}, \text{euclidean topology})\}$.
Exactly as in Sets, Lemma \ref{sets-lemma-construct-category}
we can choose a limit ordinal $\alpha$ such that
$\textit{LC}_\alpha = \textit{LC} \cap V_\alpha$
contains $S_0$ and is preserved under all countable limits and
colimits which exist in $\textit{LC}$. Moreover, if $X \in \textit{LC}_\alpha$
and if $Y \in \textit{LC}$ and
$\text{size}(Y) \leq Bound(\text{size}(X))$, then $Y$ is isomorphic
to an object of $\textit{LC}_\alpha$.
Next, we apply Sets, Lemma \ref{sets-lemma-coverings-site}
to choose set $\text{Cov}$ of qc covering on $\textit{LC}_\alpha$
such that every qc covering in $\textit{LC}_\alpha$ is
combinatorially equivalent to a covering this set.
In this way we obtain a site $(\textit{LC}_\alpha, \text{Cov})$
which we will denote $\textit{LC}_{qc}$.
\end{remark}

\noindent
There is a second topology on the site $\textit{LC}_{qc}$ of
Remark \ref{remark-set-theoretic-LC}. Namely, given an object
$X$ we can consider all coverings $\{X_i \to X\}$ of $\textit{LC}_{qc}$
such that $X_i \to X$ is an open immersion. We denote this site
$\textit{LC}_{Zar}$. The identity functor
$\textit{LC}_{Zar} \to \textit{LC}_{qc}$ is continuous and defines
a morphism of sites
$$
\epsilon : \textit{LC}_{qc} \to \textit{LC}_{Zar}
$$
by an application of Sites, Proposition \ref{sites-proposition-get-morphism}.

\medskip\noindent
Consider an object $X$ of the site $\textit{LC}_{qc}$ constructed in
Remark \ref{remark-set-theoretic-LC}. (Translation for those not worried
about set theoretic issues: Let $X$ be a Hausdorff and locally quasi-compact
space.) Let $X_{Zar}$ be the site whose objects are opens of $X$, see
Sites, Example \ref{sites-example-site-topological}.
There is a morphism of sites
$$
\pi : \textit{LC}_{Zar}/X \to X_{Zar}
$$
given by the continuous functor
$$
X_{Zar} \longrightarrow \textit{LC}_{Zar}/X,\quad
U \longmapsto U
$$
Namely, $X_{Zar}$ has fibre products and a final object and the
functor above commutes with these and
Sites, Proposition \ref{sites-proposition-get-morphism} applies.

\begin{lemma}
\label{lemma-describe-pullback-pi}
Let $X$ be an object of $\textit{LC}_{qc}$. Let $\mathcal{F}$ be a
sheaf on $X_{Zar}$. Then the sheaf $\pi^{-1}\mathcal{F}$ on
$\textit{LC}_{Zar}/X$ is given by the rule
$$
\pi^{-1}\mathcal{F}(Y) = \Gamma(Y_{Zar}, f^{-1}\mathcal{F})
$$
for $f : Y \to X$ in $\textit{LC}_{qc}$. Moreover $\pi^{-1}\mathcal{F}$
is a sheaf for the qc topology, i.e., the sheaf
$\epsilon^{-1}\pi^{-1}\mathcal{F}$ on $\textit{LC}_{qc}$
is given by the same formula.
\end{lemma}

\begin{proof}
Of course the pullback $f^{-1}$ on the right hand side indicates
usual pullback of sheaves on topological spaces
(Sites, Example \ref{sites-example-continuous-map}).
The equality of the lemma follows directly from the defintions.

\medskip\noindent
Let $\mathcal{V} = \{g_i : Y_i \to Y\}_{i \in I}$ be a covering of
$\textit{LC}_{qc}/X$. It suffices to show that
$\pi^{-1}\mathcal{F}(Y) \to H^0(\mathcal{V}, \pi^{-1}\mathcal{F})$
is an isomorphism, see Sites, Section \ref{sites-section-sheafification}.
We first point out that the map is injective as a qc covering
is surjective and we can detect equality of sections at stalks
(use Sheaves, Lemmas \ref{sheaves-lemma-sheaf-subset-stalks} and
\ref{sheaves-lemma-stalk-pullback-presheaf}). Thus we see that
$\pi^{-1}\mathcal{F}$ is a separated presheaf on $\textit{LC}_{qc}$
hence it suffices to show that any element
$(s_i) \in H^0(\mathcal{V}, \pi^{-1}\mathcal{F})$
maps to an element in the image of $\pi^{-1}\mathcal{F}(Y)$
after replacing $\mathcal{V}$ by a refinement
(Sites, Theorem \ref{sites-theorem-plus}).

\medskip\noindent
Observe that $\pi^{-1}\mathcal{F}|_{Y_{i, Zar}}$ is the pullback
of $f^{-1}\mathcal{F} = \pi^{-1}\mathcal{F}|_{Y_{Zar}}$ under
the continuous map $g_i : Y_i \to Y$. Thus we can choose an open covering
$Y_i = \bigcup V_{ij}$ such that for each $j$ there is an open
$W_{ij} \subset Y$ and a section $t_{ij} \in \pi^{-1}\mathcal{F}(W_{ij})$
such that $s|_{U_{ij}}$ is the pullback of $t_{ij}$. In other words,
after refining the covering $\{Y_i \to Y\}$ we may assume there
are opens $W_i \subset Y$ such that $Y_i \to Y$ factors through $W_i$
and sections $t_i$ of $\pi^{-1}\mathcal{F}$ over $W_i$ which restrict
to the given sections $s_i$. Moreover, if $y \in Y$ is in the image
of both $Y_i \to Y$ and $Y_j \to Y$, then the images $t_{i, y}$
and $t_{j, y}$ in the stalk $f^{-1}\mathcal{F}_y$ agree
(because $s_i$ and $s_j$ agree over $Y_i \times_Y Y_j$).
Thus for $y \in Y$ there is a well defined element $t_y$ of
$f^{-1}\mathcal{F}_y$ agreeing with $t_{i, y}$ whenever $y \in Y_i$.
We will show that the element $(t_y)$ comes from a global section
of $f^{-1}\mathcal{F}$ over $Y$ which will finish the proof of the lemma.

\medskip\noindent
It suffices to show that this is true locally on $Y$, see
Sheaves, Section \ref{sheaves-section-sheafification}. Let $y_0 \in Y$.
Pick $i_1, \ldots, i_n \in I$ and
quasi-compact subsets $E_j \subset Y_{i_j}$ such that
$\bigcup g_{i_j}(E_j)$ is a neighbourhood of $y_0$.
Then we can find an open neighbourhood $V \subset Y$ of $y_0$
contained in $W_{i_1} \cap \ldots \cap W_{i_n}$ such that
the sections $t_{i_j}|_V$, $j = 1, \ldots, n$ agree.
Hence we see that $(t_y)_{y \in V}$ comes from this section
and the proof is finished.
\end{proof}

\begin{lemma}
\label{lemma-compare-cohomology-LC}
Let $X$ be an object of $\textit{LC}_{qc}$. Let $\mathcal{F}$ be an
abelian sheaf on $X_{Zar}$. Then we have
$$
H^q(X_{Zar}, \mathcal{F}) =
H^q(\textit{LC}_{qc}/X, \epsilon^{-1}\pi^{-1}\mathcal{F})
$$
In particular, if $A$ is an abelian group, then we have
$H^q(X, \underline{A}) = H^q(\textit{LC}_{qc}/X, \underline{A})$.
\end{lemma}

\begin{proof}
The statement is more precisely that the canonical map
$$
H^q(X_{Zar}, \mathcal{F}) \longrightarrow
H^q(\textit{LC}_{qc}/X, \epsilon^{-1}\pi^{-1}\mathcal{F})
$$
is an isomorphism for all $q$.
The result holds for $q = 0$ by Lemma \ref{lemma-describe-pullback-pi}.
We argue by induction on $q$. Pick $q_0 > 0$. We will assume the result
holds for $q < q_0$ and prove it for $q_0$.

\medskip\noindent
Injective. Let $\xi \in H^{q_0}(X, \mathcal{F})$. We may choose an open
covering $\mathcal{U} : X = \bigcup U_i$ such that $\xi|_{U_i}$ is zero
for all $i$
(Cohomology, Lemma \ref{cohomology-lemma-kill-cohomology-class-on-covering}).
Then $\mathcal{U}$ is also a covering for the qc topology.
Hence we obtain a map
$$
E_2^{p, q} = \check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F}))
\longrightarrow
E_2^{p, q} =
\check{H}^p(\mathcal{U}, \underline{H}^q(\epsilon^{-1}\pi^{-1}\mathcal{F}))
$$
between the spectral sequences of
Cohomology, Lemma \ref{cohomology-lemma-cech-spectral-sequence} and
Lemma \ref{lemma-cech-spectral-sequence}.
Since the maps
$\underline{H}^q(\mathcal{F})(U_{i_0 \ldots i_p}) \to
\underline{H}^q(\epsilon^{-1}\pi^{-1}\mathcal{F}))(U_{i_0 \ldots i_p})$
are isomorphisms for $q < q_0$ we see that
$$
\text{Ker}(H^{q_0}(X, \mathcal{F}) \to \prod H^{q_0}(U_i, \mathcal{F}))
$$
maps isomorphically to the corresponding subgroup of
$H^{q_0}(\textit{LC}_{qc}/X, \epsilon^{-1}\pi^{-1}\mathcal{F})$.
In this way we conclude that our map is injective for $q_0$.

\medskip\noindent
Surjective.
Let $\xi \in H^{q_0}(\textit{LC}_{qc}/X, \epsilon^{-1}\pi^{-1}\mathcal{F})$.
If for every $x \in X$ we can find a neighbourhood $x \in U \subset X$
such that $\xi|_U = 0$, then we can use the {\v C}ech complex argument
of the previous paragraph to conclude that $\xi$ is in the image of
our map. Fix $x \in X$.
We can find a qc covering $\{f_i : X_i \to X\}_{i \in I}$ such that
$\xi|_{X_i}$ is zero (Lemma \ref{lemma-kill-cohomology-class-on-covering}).
Pick $i_1, \ldots, i_n \in I$ and $E_j \subset X_{i_j}$ such that
$\bigcup f_{i_j}(E_j)$ is a neighbourhood of $x$.
We may replace $X$ by $\bigcup f_{i_j}(E_j)$ and set $Y = \coprod E_{i_j}$.
Then $Y \to X$ is a surjective continuous map of Hausdorff and
quasi-compact topological spaces,
$\xi \in H^{q_0}(\textit{LC}_{qc}/X, \epsilon^{-1}\pi^{-1}\mathcal{F})$,
and $\xi|_Y = 0$. Set $Y_p = Y \times_X \ldots \times_X Y$ ($p + 1$-factors)
and denote $\mathcal{F}_p$ the pullback of $\mathcal{F}$ to $Y_p$.
Then the spectral sequence
$$
E_1^{p, q} =
\check{C}^p(\{Y \to X\}, \underline{H}^q(\epsilon^{-1}\pi^{-1}\mathcal{F}))
$$
of Lemma \ref{lemma-cech-spectral-sequence} has
rows for $q < q_0$ which are (by induction) the complexes
$$
H^q(Y_0, \mathcal{F}_0) \to
H^q(Y_1, \mathcal{F}_1) \to
H^q(Y_2, \mathcal{F}_2) \to \ldots
$$
If these complexes were exact in degree $p = q_0 - q$, then
the spectral sequence would show that $\xi$ is zero.
This is not true in general, but we don't need to show $\xi$ is
zero, we just need to show $\xi$ becomes zero after restricting
$X$ to a neighbourhood of $x$. Thus it suffices to show that the
complexes
$$
\colim_{x \in U \subset X} 
\left(
H^q(Y_0 \times_X U, \mathcal{F}_0) \to
H^q(Y_1 \times_X U, \mathcal{F}_1) \to
H^q(Y_2 \times_X U, \mathcal{F}_2) \to \ldots\right)
$$
are exact (some details omitted). By the proper base change
theorem in topology
(for example Cohomology, Lemma \ref{cohomology-lemma-proper-base-change})
the colimit is equal to
$$
H^q(Y_x, \underline{\mathcal{F}_x}) \to
H^q(Y_x^2, \underline{\mathcal{F}_x}) \to
H^q(Y_x^3, \underline{\mathcal{F}_x}) \to \ldots
$$
where $Y_x \subset Y$ is the fibre of $Y \to X$ over $x$
and where $\underline{\mathcal{F}_x}$ denotes the constant sheaf
with value $\mathcal{F}_x$. But the simplicial topological space
$(Y_x^n)$ is homotopy equivalent to the constant simplicial space
on the singleton $\{x\}$, see
Simplicial, Lemma
\ref{simplicial-lemma-fibre-products-simplicial-object-w-section}.
Since $H^q(-, \underline{\mathcal{F}_x})$ is a functor on the
category of topological spaces, we conclude that the cosimplicial
abelian group with values $H^q(Y_x^n, \underline{\mathcal{F}_x})$
is homotopy equivalent to the constant cosimplicial
abelian group with value
$$
H^q(\{x\}, \mathcal{F}_x) =
\left\{
\begin{matrix}
\mathcal{F}_x & \text{if }q = 0 \\
0 & \text{else}
\end{matrix}
\right.
$$
As the complex associated to a constant cosimplicial group
has the required exactness properties this finishes the proof of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-proper-surjective-is-qc-covering}
Let $f : X \to Y$ be a morphism of $\textit{LC}$.
If $f$ is proper and surjective, then $\{f : X \to Y\}$
is a qc covering.
\end{lemma}

\begin{proof}
Let $y \in Y$ be a point. For each $x \in X_y$ choose a quasi-compact
neighbourhood $E_x \subset X$. Choose $x \in U_x \subset E_x$ open.
Since $f$ is proper the fibre $X_y$ is quasi-compact and we find
$x_1, \ldots, x_n \in X_y$ such that
$X_y \subset U_{x_1} \cup \ldots \cup U_{x_n}$.
We claim that $f(E_{x_1}) \cup \ldots \cup f(E_{x_n})$ is a neighbourhood of
$y$. Namely, as $f$ is closed
(Topology, Theorem \ref{topology-theorem-characterize-proper})
we see that $Z = f(X \setminus U_{x_1} \cup \ldots \cup U_{x_n})$
is a closed subset of $Y$ not containing $y$. As $f$ is surjective
we see that $Y \setminus Z$ is contained in
$f(E_{x_1}) \cup \ldots \cup f(E_{x_n})$ as desired.
\end{proof}










\section{Spectral sequences for Ext}
\label{section-spectral-sequence-ext}

\noindent
In this section we collect various spectral sequences that come up
when considering the Ext functors. For any pair of complexes
$\mathcal{G}^\bullet, \mathcal{F}^\bullet$ of complexes of modules
on a ringed site $(\mathcal{C}, \mathcal{O})$ we denote
$$
\text{Ext}^n_\mathcal{O}(\mathcal{G}^\bullet, \mathcal{F}^\bullet)
=
\Hom_{D(\mathcal{O})}(\mathcal{G}^\bullet, \mathcal{F}^\bullet[n])
$$
according to our general conventions in
Derived Categories, Section \ref{derived-section-ext}.

\begin{example}
\label{example-hom-complex-into-sheaf}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{K}^\bullet$ be a bounded above complex of $\mathcal{O}$-modules.
Let $\mathcal{F}$ be an $\mathcal{O}$-module. Then there is a
spectral sequence with $E_2$-page
$$
E_2^{i, j} =
\text{Ext}_\mathcal{O}^i(H^{-j}(\mathcal{K}^\bullet), \mathcal{F})
\Rightarrow
\text{Ext}_\mathcal{O}^{i + j}(\mathcal{K}^\bullet, \mathcal{F})
$$
and another spectral sequence with $E_1$-page
$$
E_1^{i, j} =
\text{Ext}_\mathcal{O}^j(\mathcal{K}^{-i}, \mathcal{F})
\Rightarrow
\text{Ext}_\mathcal{O}^{i + j}(\mathcal{K}^\bullet, \mathcal{F}).
$$
To construct these spectral sequences choose an injective resolution
$\mathcal{F} \to \mathcal{I}^\bullet$ and consider the two spectral
sequences coming from the double complex
$\Hom_\mathcal{O}(\mathcal{K}^\bullet, \mathcal{I}^\bullet)$, see
Homology, Section \ref{homology-section-double-complex}.
\end{example}






\section{Hom complexes}
\label{section-hom-complexes}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let
$\mathcal{L}^\bullet$ and $\mathcal{M}^\bullet$ be two complexes
of $\mathcal{O}$-modules. We construct a complex
of $\mathcal{O}$-modules
$\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{M}^\bullet)$.
Namely, for each $n$ we set
$$
\SheafHom^n(\mathcal{L}^\bullet, \mathcal{M}^\bullet) =
\prod\nolimits_{n = p + q}
\SheafHom_\mathcal{O}(\mathcal{L}^{-q}, \mathcal{M}^p)
$$
It is a good idea to think of $\SheafHom^n$ as the
sheaf of $\mathcal{O}$-modules of all $\mathcal{O}$-linear
maps from $\mathcal{L}^\bullet$ to $\mathcal{M}^\bullet$
(viewed as graded $\mathcal{O}$-modules) which are homogenous
of degree $n$. In this terminology, we define the differential by the rule
$$
\text{d}(f) =
\text{d}_\mathcal{M} \circ f - (-1)^n f \circ \text{d}_\mathcal{L}
$$
for
$f \in \SheafHom^n_\mathcal{O}(\mathcal{L}^\bullet, \mathcal{M}^\bullet)$.
We omit the verification that $\text{d}^2 = 0$.
This construction is a special case of
Differential Graded Algebra, Example \ref{dga-example-category-complexes}.
It follows immediately from the construction that we have
\begin{equation}
\label{equation-cohomology-hom-complex}
H^n(\Gamma(U, \SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{M}^\bullet))) =
\Hom_{K(\mathcal{O}_U)}(\mathcal{L}^\bullet, \mathcal{M}^\bullet[n])
\end{equation}
for all $n \in \mathbf{Z}$ and every $U \in \Ob(\mathcal{C})$. Similarly,
we have
\begin{equation}
\label{equation-global-cohomology-hom-complex}
H^n(\Gamma(\mathcal{C},
\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{M}^\bullet))) =
\Hom_{K(\mathcal{O})}(\mathcal{L}^\bullet, \mathcal{M}^\bullet[n])
\end{equation}
for the complex of global sections.

\begin{lemma}
\label{lemma-compose}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Given complexes $\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$
of $\mathcal{O}$-modules there is an isomorphism
$$
\SheafHom^\bullet(\mathcal{K}^\bullet,
\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{M}^\bullet))
=
\SheafHom^\bullet(\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O}
\mathcal{L}^\bullet), \mathcal{M}^\bullet)
$$
of complexes of $\mathcal{O}$-modules functorial in
$\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$.
\end{lemma}

\begin{proof}
Omitted. Hint: This is proved in exactly the same way as
More on Algebra, Lemma \ref{more-algebra-lemma-compose}.
\end{proof}

\begin{lemma}
\label{lemma-composition}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Given complexes
$\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$
of $\mathcal{O}$-modules there is a canonical morphism
$$
\text{Tot}\left(
\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{M}^\bullet)
\otimes_\mathcal{O}
\SheafHom^\bullet(\mathcal{K}^\bullet, \mathcal{L}^\bullet)
\right)
\longrightarrow
\SheafHom^\bullet(\mathcal{K}^\bullet, \mathcal{M}^\bullet)
$$
of complexes of $\mathcal{O}$-modules.
\end{lemma}

\begin{proof}
Omitted. Hint: This is proved in exactly the same way as
More on Algebra, Lemma \ref{more-algebra-lemma-composition}.
\end{proof}

\begin{lemma}
\label{lemma-evaluate-and-more}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Given complexes
$\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$
of $\mathcal{O}$-modules there is a canonical morphism
$$
\text{Tot}(\SheafHom^\bullet(\mathcal{L}^\bullet,
\mathcal{M}^\bullet) \otimes_\mathcal{O} \mathcal{K}^\bullet)
\longrightarrow
\SheafHom^\bullet(\SheafHom^\bullet(\mathcal{K}^\bullet,
\mathcal{L}^\bullet), \mathcal{M}^\bullet)
$$
of complexes of $\mathcal{O}$-modules functorial in all three complexes.
\end{lemma}

\begin{proof}
Omitted. Hint: This is proved in exactly the same way as
More on Algebra, Lemma \ref{more-algebra-lemma-evaluate-and-more}.
\end{proof}

\begin{lemma}
\label{lemma-diagonal}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Given complexes
$\mathcal{K}^\bullet, \mathcal{L}^\bullet, \mathcal{M}^\bullet$
of $\mathcal{O}$-modules there is a canonical morphism
$$
\mathcal{K}^\bullet
\longrightarrow
\SheafHom^\bullet(\mathcal{L}^\bullet,
\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet))
$$
of complexes of $\mathcal{O}$-modules functorial in both complexes.
\end{lemma}

\begin{proof}
Omitted. Hint: This is proved in exactly the same way as
More on Algebra, Lemma \ref{more-algebra-lemma-diagonal}.
\end{proof}

\begin{lemma}
\label{lemma-RHom-into-K-injective}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{I}^\bullet$
be a K-injective complex of $\mathcal{O}$-modules. Let
$\mathcal{L}^\bullet$ be a complex of $\mathcal{O}$-modules.
Then
$$
H^0(\Gamma(U, \SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet))) =
\Hom_{D(\mathcal{O}_U)}(L|_U, M|_U)
$$
for all $U \in \Ob(\mathcal{C})$. Similarly,
$H^0(\Gamma(\mathcal{C},
\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet))) =
\Hom_{D(\mathcal{O}_U)}(L, M)$.
\end{lemma}

\begin{proof}
We have
\begin{align*}
H^0(\Gamma(U, \SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet)))
& =
\Hom_{K(\mathcal{O}_U)}(L|_U, M|_U) \\
& =
\Hom_{D(\mathcal{O}_U)}(L|_U, M|_U)
\end{align*}
The first equality is (\ref{equation-cohomology-hom-complex}).
The second equality is true because $\mathcal{I}^\bullet|_U$
is K-injective by Lemma \ref{lemma-restrict-K-injective-to-open}.
The proof of the last equation is similar except that it uses
(\ref{equation-global-cohomology-hom-complex}).
\end{proof}

\begin{lemma}
\label{lemma-RHom-well-defined}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let
$(\mathcal{I}')^\bullet \to \mathcal{I}^\bullet$
be a quasi-isomorphism of K-injective complexes of $\mathcal{O}$-modules.
Let $(\mathcal{L}')^\bullet \to \mathcal{L}^\bullet$
be a quasi-isomorphism of complexes of $\mathcal{O}$-modules.
Then
$$
\SheafHom^\bullet(\mathcal{L}^\bullet, (\mathcal{I}')^\bullet)
\longrightarrow
\SheafHom^\bullet((\mathcal{L}')^\bullet, \mathcal{I}^\bullet)
$$
is a quasi-isomorphism.
\end{lemma}

\begin{proof}
Let $M$ be the object of $D(\mathcal{O})$ represented by
$\mathcal{I}^\bullet$ and $(\mathcal{I}')^\bullet$.
Let $L$ be the object of $D(\mathcal{O})$ represented by
$\mathcal{L}^\bullet$ and $(\mathcal{L}')^\bullet$.
By Lemma \ref{lemma-RHom-into-K-injective}
we see that the sheaves
$$
H^0(\SheafHom^\bullet(\mathcal{L}^\bullet, (\mathcal{I}')^\bullet))
\quad\text{and}\quad
H^0(\SheafHom^\bullet((\mathcal{L}')^\bullet, \mathcal{I}^\bullet))
$$
are both equal to the sheaf associated to the presheaf
$$
U \longmapsto \Hom_{D(\mathcal{O}_U)}(L|_U, M|_U)
$$
Thus the map is a quasi-isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-RHom-from-K-flat-into-K-injective}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{I}^\bullet$
be a K-injective complex of $\mathcal{O}$-modules. Let
$\mathcal{L}^\bullet$ be a K-flat complex of $\mathcal{O}$-modules.
Then $\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet)$
is a K-injective complex of $\mathcal{O}$-modules.
\end{lemma}

\begin{proof}
Namely, if $\mathcal{K}^\bullet$ is an acyclic complex of
$\mathcal{O}$-modules, then
\begin{align*}
\Hom_{K(\mathcal{O})}(\mathcal{K}^\bullet,
\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet))
& =
H^0(\Gamma(\mathcal{C},
\SheafHom^\bullet(\mathcal{K}^\bullet,
\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet)))) \\
& =
H^0(\Gamma(\mathcal{C}, \SheafHom^\bullet(\text{Tot}(
\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet),
\mathcal{I}^\bullet))) \\
& =
\Hom_{K(\mathcal{O})}(
\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet),
\mathcal{I}^\bullet) \\
& =
0
\end{align*}
The first equality by (\ref{equation-global-cohomology-hom-complex}).
The second equality by Lemma \ref{lemma-compose}.
The third equality by (\ref{equation-global-cohomology-hom-complex}).
The final equality because
$\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet)$
is acyclic because $\mathcal{L}^\bullet$ is K-flat
(Definition \ref{definition-K-flat}) and because $\mathcal{I}^\bullet$
is K-injective.
\end{proof}








\section{Internal hom in the derived category}
\label{section-internal-hom}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $L, M$ be objects
of $D(\mathcal{O})$. We would like to construct an object
$R\SheafHom(L, M)$ of $D(\mathcal{O})$ such that for every third
object $K$ of $D(\mathcal{O})$ there exists a canonical bijection
\begin{equation}
\label{equation-internal-hom}
\Hom_{D(\mathcal{O})}(K, R\SheafHom(L, M))
=
\Hom_{D(\mathcal{O})}(K \otimes_\mathcal{O}^\mathbf{L} L, M)
\end{equation}
Observe that this formula defines $R\SheafHom(L, M)$ up to unique
isomorphism by the Yoneda lemma
(Categories, Lemma \ref{categories-lemma-yoneda}).

\medskip\noindent
To construct such an object, choose a K-injective complex of
$\mathcal{O}$-modules $\mathcal{I}^\bullet$ representing $M$ and any
complex of $\mathcal{O}$-modules $\mathcal{L}^\bullet$ representing $L$.
Then we set
Then we set
$$
R\SheafHom(L, M) = \SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet)
$$
where the right hand side is the complex of $\mathcal{O}$-modules
constructed in Section \ref{section-hom-complexes}.
This is well defined by Lemma \ref{lemma-RHom-well-defined}.
We get a functor
$$
D(\mathcal{O})^{opp} \times D(\mathcal{O}) \longrightarrow D(\mathcal{O}),
\quad
(K, L) \longmapsto R\SheafHom(K, L)
$$
As a prelude to proving (\ref{equation-internal-hom})
we compute the cohomology groups of $R\SheafHom(K, L)$.

\begin{lemma}
\label{lemma-section-RHom-over-U}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K, L$ be objects
of $D(\mathcal{O})$. For every object $U$ of $\mathcal{C}$ we have
$$
H^0(U, R\SheafHom(L, M)) =
\Hom_{D(\mathcal{O}_U)}(L|_U, M|_U)
$$
and we have $H^0(\mathcal{C}, R\SheafHom(L, M)) =
\Hom_{D(\mathcal{O})}(L, M)$.
\end{lemma}

\begin{proof}
Choose a K-injective complex $\mathcal{I}^\bullet$ of
$\mathcal{O}$-modules representing $M$ and a K-flat complex
$\mathcal{L}^\bullet$ representing $L$. Then
$\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet)$
is K-injective by Lemma \ref{lemma-RHom-from-K-flat-into-K-injective}.
Hence we can compute cohomology over $U$ by simply taking sections over $U$
and the result follows from Lemma \ref{lemma-RHom-into-K-injective}.
\end{proof}

\begin{lemma}
\label{lemma-internal-hom}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K, L, M$ be objects
of $D(\mathcal{O})$. With the construction as described above
there is a canonical isomorphism
$$
R\SheafHom(K, R\SheafHom(L, M)) =
R\SheafHom(K \otimes_\mathcal{O}^\mathbf{L} L, M)
$$
in $D(\mathcal{O})$ functorial in $K, L, M$
which recovers (\ref{equation-internal-hom}) on taking $H^0(\mathcal{C}, -)$.
\end{lemma}

\begin{proof}
Choose a K-injective complex $\mathcal{I}^\bullet$ representing
$M$ and a K-flat complex of $\mathcal{O}$-modules $\mathcal{L}^\bullet$
representing $L$. Let $\mathcal{H}^\bullet$ be the complex described above.
For any complex of $\mathcal{O}$-modules $\mathcal{K}^\bullet$
we have
$$
\SheafHom^\bullet(\mathcal{K}^\bullet,
\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet))
=
\SheafHom^\bullet(
\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet),
\mathcal{I}^\bullet)
$$
by Lemma \ref{lemma-compose}.
Note that the left hand side represents
$R\SheafHom(K, R\SheafHom(L, M))$ (use
Lemma \ref{lemma-RHom-from-K-flat-into-K-injective})
and that the right hand side represents
$R\SheafHom(K \otimes_\mathcal{O}^\mathbf{L} L, M)$.
This proves the displayed formula of the lemma.
Taking global sections and using Lemma \ref{lemma-section-RHom-over-U}
we obtain (\ref{equation-internal-hom}).
\end{proof}

\begin{lemma}
\label{lemma-restriction-RHom-to-U}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K, L$ be objects
of $D(\mathcal{O})$. The construction of $R\SheafHom(K, L)$
commutes with restrictions, i.e.,
for every object $U$ of $\mathcal{C}$ we have
$R\SheafHom(K|_U, L|_U) = R\SheafHom(K, L)|_U$.
\end{lemma}

\begin{proof}
This is clear from the construction and
Lemma \ref{lemma-restrict-K-injective-to-open}.
\end{proof}

\begin{lemma}
\label{lemma-RHom-triangulated}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. The bifunctor
$R\SheafHom(- , -)$ transforms distinguished triangles into
distinguished triangles in both variables.
\end{lemma}

\begin{proof}
This follows from the observation that the assignment
$$
(\mathcal{L}^\bullet, \mathcal{M}^\bullet) \longmapsto
\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{M}^\bullet)
$$
transforms a termwise split short exact sequences of complexes in either
variable into a termwise split short exact sequence. Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-internal-hom-evaluate}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K, L, M$ be objects of
$D(\mathcal{O})$. There is a canonical morphism
$$
R\SheafHom(L, M) \otimes_\mathcal{O}^\mathbf{L} K
\longrightarrow
R\SheafHom(R\SheafHom(K, L), M)
$$
in $D(\mathcal{O})$ functorial in $K, L, M$.
\end{lemma}

\begin{proof}
Choose
a K-injective complex $\mathcal{I}^\bullet$ representing $M$,
a K-injective complex $\mathcal{J}^\bullet$ representing $L$, and
a K-flat complex $\mathcal{K}^\bullet$ representing $K$.
The map is defined using the map
$$
\text{Tot}(\SheafHom^\bullet(\mathcal{J}^\bullet,
\mathcal{I}^\bullet) \otimes_\mathcal{O} \mathcal{K}^\bullet)
\longrightarrow
\SheafHom^\bullet(\SheafHom^\bullet(\mathcal{K}^\bullet,
\mathcal{J}^\bullet), \mathcal{I}^\bullet)
$$
of Lemma \ref{lemma-evaluate-and-more}. By our particular
choice of complexes the left hand side represents
$R\SheafHom(L, M) \otimes_\mathcal{O}^\mathbf{L} K$
and the right hand side represents
$R\SheafHom(R\SheafHom(K, L), M)$. We omit the proof that
this is functorial in all three objects of $D(\mathcal{O})$.
\end{proof}

\begin{lemma}
\label{lemma-internal-hom-composition}
\begin{slogan}
Composition on RSheafHom.
\end{slogan}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Given $K, L, M$ in
$D(\mathcal{O})$ there is a canonical morphism
$$
R\SheafHom(L, M) \otimes_\mathcal{O}^\mathbf{L} R\SheafHom(K, L)
\longrightarrow R\SheafHom(K, M)
$$
in $D(\mathcal{O})$.
\end{lemma}

\begin{proof}
In general (without suitable finiteness conditions) we do not see how to
get this map from Lemma \ref{lemma-composition}. Instead, we use the maps
$$
\xymatrix{
R\SheafHom(L, M) \otimes_\mathcal{O}^\mathbf{L}
R\SheafHom(K, L) \otimes_\mathcal{O}^\mathbf{L} K \ar[d] \\
R\SheafHom(L, M) \otimes_\mathcal{O}^\mathbf{L}
R\SheafHom(R\SheafHom(K, K), L) \ar[d] \\
R\SheafHom(L, M) \otimes_\mathcal{O}^\mathbf{L} L \ar[d] \\
R\SheafHom(R\SheafHom(L, L), M) \ar[d] \\
M
}
$$
gotten by applying Lemma \ref{lemma-internal-hom-evaluate} twice
as well as the maps $\mathcal{O} \to R\SheafHom(K, K)$ and
$\mathcal{O} \to R\SheafHom(L, L)$.
Finally, we use Lemma \ref{lemma-internal-hom}
to translate the composition
$$
R\SheafHom(L, M) \otimes_\mathcal{O}^\mathbf{L}
R\SheafHom(K, L) \otimes_\mathcal{O}^\mathbf{L} K
\longrightarrow M
$$
into a map as in the statement of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-internal-hom-diagonal}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Given $K, L$ in $D(\mathcal{O})$ there is a canonical morphism
$$
K \longrightarrow R\SheafHom(L, K \otimes_\mathcal{O}^\mathbf{L} L)
$$
in $D(\mathcal{O})$ functorial in both $K$ and $L$.
\end{lemma}

\begin{proof}
Choose K-flat complexes $\mathcal{K}^\bullet$ and $\mathcal{L}^\bullet$
represeting $K$ and $L$. Choose a K-injective complex $\mathcal{I}^\bullet$
and a quasi-isomorphism
$\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet)
\to \mathcal{I}^\bullet$. Then we use
$$
\mathcal{K}^\bullet \to
\SheafHom^\bullet(\mathcal{L}^\bullet,
\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet))
\to
\SheafHom^\bullet(\mathcal{L}^\bullet, \mathcal{I}^\bullet)
$$
where the first map comes from Lemma \ref{lemma-diagonal}.
\end{proof}

\begin{lemma}
\label{lemma-dual}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $L$ be an
object of $D(\mathcal{O})$. Set $L^\vee = R\SheafHom(L, \mathcal{O})$.
For $M$ in $D(\mathcal{O})$ there is a canonical map
\begin{equation}
\label{equation-eval}
L^\vee \otimes^\mathbf{L}_\mathcal{O} M \longrightarrow R\SheafHom(L, M)
\end{equation}
which induces a canonical map
$$
H^0(\mathcal{C}, L^\vee \otimes_\mathcal{O}^\mathbf{L} M)
\longrightarrow
\Hom_{D(\mathcal{O})}(L, M)
$$
functorial in $M$ in $D(\mathcal{O})$.
\end{lemma}

\begin{proof}
The map (\ref{equation-eval}) is a special case of
Lemma \ref{lemma-internal-hom-composition}
using the identification $M = R\SheafHom(\mathcal{O}, M)$.
\end{proof}

\begin{remark}
\label{remark-projection-formula-for-internal-hom}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi.
Let $K, L$ be objects of $D(\mathcal{O}_\mathcal{C})$. We claim there is
a canonical map
$$
Rf_*R\SheafHom(L, K) \longrightarrow R\SheafHom(Rf_*L, Rf_*K)
$$
Namely, by (\ref{equation-internal-hom}) this is the same thing
as a map
$Rf_*R\SheafHom(L, K) \otimes_{\mathcal{O}_\mathcal{D}}^\mathbf{L} Rf_*L
\to Rf_*K$.
For this we can use the composition
$$
Rf_*R\SheafHom(L, K) \otimes_{\mathcal{O}_\mathcal{D}}^\mathbf{L} Rf_*L \to
Rf_*(R\SheafHom(L, K) \otimes_{\mathcal{O}_\mathcal{C}}^\mathbf{L} L) \to
Rf_*K
$$
where the first arrow is the relative cup product
(Remark \ref{remark-cup-product}) and the second arrow is $Rf_*$ applied
to the canonical map
$R\SheafHom(L, K) \otimes_{\mathcal{O}_\mathcal{C}}^\mathbf{L} L \to K$
coming from Lemma \ref{lemma-internal-hom-composition}
(with $\mathcal{O}_\mathcal{C}$ in one of the spots).
\end{remark}

\begin{remark}
\label{remark-prepare-fancy-base-change}
Let $h : (\Sh(\mathcal{C}), \mathcal{O}) \to (\Sh(\mathcal{C}'), \mathcal{O}')$
be a morphism of ringed topoi. Let $K, L$ be objects of $D(\mathcal{O}')$.
We claim there is a canonical map
$$
Lh^*R\SheafHom(K, L) \longrightarrow R\SheafHom(Lh^*K, Lh^*L)
$$
in $D(\mathcal{O})$. Namely, by (\ref{equation-internal-hom})
proved in Lemma \ref{lemma-internal-hom}
such a map is the same thing as a map
$$
Lh^*R\SheafHom(K, L) \otimes^\mathbf{L} Lh^*K \longrightarrow Lh^*L
$$
The source of this arrow is $Lh^*(\SheafHom(K, L) \otimes^\mathbf{L} K)$
by Lemma \ref{lemma-pullback-tensor-product}
hence it suffices to construct a canonical map
$$
R\SheafHom(K, L) \otimes^\mathbf{L} K \longrightarrow L.
$$
For this we take the arrow corresponding to
$$
\text{id} :
R\SheafHom(K, L)
\longrightarrow
R\SheafHom(K, L)
$$
via (\ref{equation-internal-hom}).
\end{remark}

\begin{remark}
\label{remark-fancy-base-change}
Suppose that
$$
\xymatrix{
(\Sh(\mathcal{C}'), \mathcal{O}_{\mathcal{C}'})
\ar[r]_h \ar[d]_{f'} &
(\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \ar[d]^f \\
(\Sh(\mathcal{D}'), \mathcal{O}_{\mathcal{D}'})
\ar[r]^g &
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})
}
$$
is a commutative diagram of ringed topoi. Let $K, L$ be objects
of $D(\mathcal{O}_\mathcal{C})$. We claim there exists a canonical base change
map
$$
Lg^*Rf_*R\SheafHom(K, L)
\longrightarrow
R(f')_*R\SheafHom(Lh^*K, Lh^*L)
$$
in $D(\mathcal{O}_{\mathcal{D}'})$. Namely, we take the map adjoint to
the composition
\begin{align*}
L(f')^*Lg^*Rf_*R\SheafHom(K, L)
& =
Lh^*Lf^*Rf_*R\SheafHom(K, L) \\
& \to
Lh^*R\SheafHom(K, L) \\
& \to
R\SheafHom(Lh^*K, Lh^*L)
\end{align*}
where the first arrow uses the adjunction mapping
$Lf^*Rf_* \to \text{id}$ and the second arrow is the canonical map
constructed in Remark \ref{remark-prepare-fancy-base-change}.
\end{remark}




\section{Global derived hom}
\label{section-global-RHom}

\noindent
Let $(\Sh(\mathcal{C}), \mathcal{O})$ be a ringed topos.
Let $K, L \in D(\mathcal{O})$.
Using the construction of the internal hom in the derived category we
obtain a well defined object
$$
R\Hom(K, L) = R\Gamma(X, R\SheafHom(K, L))
$$
in $D(\Gamma(\mathcal{C}, \mathcal{O}))$. We will sometimes write
$R\Hom_\mathcal{O}(K, L)$ for this object. By
Lemma \ref{lemma-section-RHom-over-U}
we have
$$
H^0(R\Hom(K, L)) = \Hom_{D(\mathcal{O})}(K, L)
$$
and
$$
H^p(R\Hom(K, L)) = \text{Ext}_{D(\mathcal{O})}^p(K, L)
$$









\section{Derived lower shriek}
\label{section-derived-lower-shriek}

\noindent
In this section we study some situations where besides $Lf^*$ and
$Rf_*$ there also a derived functor $Lf_!$.

\begin{lemma}
\label{lemma-existence-derived-lower-shriek}
Let $u : \mathcal{C} \to \mathcal{D}$ be a continuous and cocontinuous
functor of sites which induces a morphism of topoi
$g : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$. Let $\mathcal{O}_\mathcal{D}$
be a sheaf of rings and set
$\mathcal{O}_\mathcal{C} = g^{-1}\mathcal{O}_\mathcal{D}$.
The functor $g_! : \textit{Mod}(\mathcal{O}_\mathcal{C}) \to
\textit{Mod}(\mathcal{O}_\mathcal{D})$
(see
Modules on Sites, Lemma \ref{sites-modules-lemma-lower-shriek-modules})
has a left derived functor
$$
Lg_! : D(\mathcal{O}_\mathcal{C}) \longrightarrow D(\mathcal{O}_\mathcal{D})
$$
which is left adjoint to $g^*$. Moreover, for $U \in \Ob(\mathcal{C})$ we
have
$$
Lg_!(j_{U!}\mathcal{O}_U) =
g_!j_{U!}\mathcal{O}_U =
j_{u(U)!} \mathcal{O}_{u(U)}.
$$
where $j_{U!}$ and $j_{u(U)!}$ are extension by zero associated to the
localization morphism
$j_U : \mathcal{C}/U \to \mathcal{C}$ and
$j_{u(U)} : \mathcal{D}/u(U) \to \mathcal{D}$.
\end{lemma}

\begin{proof}
We are going to use
Derived Categories, Proposition \ref{derived-proposition-left-derived-exists}
to construct $Lg_!$. To do this we have to verify assumptions
(1), (2), (3), (4), and (5) of that proposition.
First, since $g_!$ is a left adjoint
we see that it is right exact and commutes with all colimits, so
(5) holds. Conditions (3) and (4) hold because the category of modules
on a ringed site is a Grothendieck abelian category.
Let $\mathcal{P} \subset \Ob(\textit{Mod}(\mathcal{O}_\mathcal{C}))$
be the collection of $\mathcal{O}_\mathcal{C}$-modules which are direct
sums of modules of the form $j_{U!}\mathcal{O}_U$. Note that
$g_!j_{U!}\mathcal{O}_U = j_{u(U)!} \mathcal{O}_{u(U)}$, see proof of
Modules on Sites, Lemma \ref{sites-modules-lemma-lower-shriek-modules}.
Every $\mathcal{O}_\mathcal{C}$-module is a quotient of an object of
$\mathcal{P}$, see
Modules on Sites, Lemma \ref{sites-modules-lemma-module-quotient-flat}.
Thus (1) holds. Finally, we have to prove (2).
Let $\mathcal{K}^\bullet$ be a bounded above acyclic complex of
$\mathcal{O}_\mathcal{C}$-modules with $\mathcal{K}^n \in \mathcal{P}$
for all $n$. We have to show that $g_!\mathcal{K}^\bullet$ is
exact. To do this it suffices to show, for every injective
$\mathcal{O}_\mathcal{D}$-module $\mathcal{I}$ that
$$
\Hom_{D(\mathcal{O}_\mathcal{D})}(
g_!\mathcal{K}^\bullet, \mathcal{I}[n]) = 0
$$
for all $n \in \mathbf{Z}$. Since $\mathcal{I}$ is injective we have
\begin{align*}
\Hom_{D(\mathcal{O}_\mathcal{D})}(
g_!\mathcal{K}^\bullet, \mathcal{I}[n])
& =
\Hom_{K(\mathcal{O}_\mathcal{D})}(
g_!\mathcal{K}^\bullet, \mathcal{I}[n]) \\
& =
H^n(\Hom_{\mathcal{O}_\mathcal{D}}(
g_!\mathcal{K}^\bullet, \mathcal{I})) \\
& =
H^n(\Hom_{\mathcal{O}_\mathcal{C}}(
\mathcal{K}^\bullet, g^{-1}\mathcal{I}))
\end{align*}
the last equality by the adjointness of $g_!$ and $g^{-1}$.

\medskip\noindent
The vanishing of this group would be clear if $g^{-1}\mathcal{I}$
were an injective $\mathcal{O}_\mathcal{C}$-module. But
$g^{-1}\mathcal{I}$ isn't necessarily an injective
$\mathcal{O}_\mathcal{C}$-module as $g_!$ isn't exact in
general. We do know that
$$
\text{Ext}^p_{\mathcal{O}_\mathcal{C}}(
j_{U!}\mathcal{O}_U, g^{-1}\mathcal{I}) =
H^p(U, g^{-1}\mathcal{I}) = 0 \text{ for }p \geq 1
$$
Namely, the first equality follows from
$\Hom_{\mathcal{O}_\mathcal{C}}(j_{U!}\mathcal{O}_U, \mathcal{H}) =
\mathcal{H}(U)$ and taking derived functors. The vanishing of
$H^p(U, g^{-1}\mathcal{I})$ for all $U \in \Ob(\mathcal{C})$
comes from the vanishing of all higher {\v C}ech cohomology groups
$\check H^p(\mathcal{U}, g^{-1}\mathcal{I})$ via
Lemma \ref{lemma-cech-vanish-collection}.
Namely, for a covering $\mathcal{U} = \{U_i \to U\}_{i \in I}$
in $\mathcal{C}$ we have $\check H^p(\mathcal{U}, g^{-1}\mathcal{I}) =
\check H^p(u(\mathcal{U}), \mathcal{I})$. Since $\mathcal{I}$ is an injective
$\mathcal{O}$-module these {\v C}ech cohomology groups vanish, see
Lemma \ref{lemma-injective-module-trivial-cech}.
Since each $\mathcal{K}^{-q}$ is a direct sum of modules of the form
$j_{U!}\mathcal{O}_U$ we see that
$$
\text{Ext}^p_{\mathcal{O}_\mathcal{C}}(\mathcal{K}^{-q}, g^{-1}\mathcal{I}) = 0
\text{ for }p \geq 1\text{ and all }q
$$
Let us use the spectral sequence (see
Example
\ref{example-hom-complex-into-sheaf})
$$
E_1^{p, q} = \text{Ext}^p_{\mathcal{O}_\mathcal{C}}(
\mathcal{K}^{-q}, g^{-1}\mathcal{I})
\Rightarrow
\text{Ext}^{p + q}_{\mathcal{O}_\mathcal{C}}(
\mathcal{K}^\bullet, g^{-1}\mathcal{I}) = 0.
$$
Note that the spectral sequence abuts to zero as $\mathcal{K}^\bullet$
is acyclic (hence vanishes in the derived category, hence produces
vanishing ext groups). By the vanishing of higher exts proved above
the only nonzero terms on the $E_1$ page are the terms
$E_1^{0, q} = \Hom_{\mathcal{O}_\mathcal{C}}(
\mathcal{K}^{-q}, g^{-1}\mathcal{I})$.
We conclude that the complex
$\Hom_{\mathcal{O}_\mathcal{C}}(
\mathcal{K}^\bullet, g^{-1}\mathcal{I})$
is acyclic as desired.

\medskip\noindent
Thus the left derived functor $Lg_!$ exists. We still have to show that
it is left adjoint to $g^{-1} = g^* = Rg^* = Lg^*$, i.e., that we have
\begin{equation}
\label{equation-to-prove}
\Hom_{D(\mathcal{O}_\mathcal{C})}(
\mathcal{H}^\bullet, g^{-1}\mathcal{E}^\bullet)
=
\Hom_{D(\mathcal{O}_\mathcal{D})}(
Lg_!\mathcal{H}^\bullet, \mathcal{E}^\bullet)
\end{equation}
This is actually a formal consequence of the discussion above.
Choose a quasi-isomorphism
$\mathcal{K}^\bullet \to \mathcal{H}^\bullet$
such that $\mathcal{K}^\bullet$ computes $Lg_!$.
Moreover, choose a quasi-isomorphism
$\mathcal{E}^\bullet \to \mathcal{I}^\bullet$ into a K-injective
complex of $\mathcal{O}_\mathcal{D}$-modules $\mathcal{I}^\bullet$.
Then the RHS of (\ref{equation-to-prove}) is
$$
\Hom_{K(\mathcal{O}_\mathcal{D})}(
g_!\mathcal{K}^\bullet, \mathcal{I}^\bullet)
$$
On the other hand, by the definition of morphisms in
the derived category the LHS of (\ref{equation-to-prove}) is
\begin{align*}
\Hom_{D(\mathcal{O}_\mathcal{C})}(
\mathcal{K}^\bullet, g^{-1}\mathcal{I}^\bullet)
& =
\colim_{s : \mathcal{L}^\bullet \to \mathcal{K}^\bullet}
\Hom_{K(\mathcal{O}_\mathcal{C})}(
\mathcal{L}^\bullet, g^{-1}\mathcal{I}^\bullet) \\
& =
\colim_{s : \mathcal{L}^\bullet \to \mathcal{K}^\bullet}
\Hom_{K(\mathcal{O}_\mathcal{D})}(
g_!\mathcal{L}^\bullet, \mathcal{I}^\bullet)
\end{align*}
by the adjointness of $g_!$ and $g^*$ on the level of sheaves of modules.
The colimit is over all quasi-isomorphisms with target
$\mathcal{K}^\bullet$. Since for every complex $\mathcal{L}^\bullet$
there exists a quasi-isomorphism
$(\mathcal{K}')^\bullet \to \mathcal{L}^\bullet$ such that
$(\mathcal{K}')^\bullet$ computes $Lg_!$ we see that we may as well
take the colimit over quasi-isomorphisms of the form
$s : (\mathcal{K}')^\bullet \to \mathcal{K}^\bullet$ where
$(\mathcal{K}')^\bullet$ computes $Lg_!$. In this case
$$
\Hom_{K(\mathcal{O}_\mathcal{D})}(
g_!\mathcal{K}^\bullet, \mathcal{I}^\bullet)
\longrightarrow
\Hom_{K(\mathcal{O}_\mathcal{D})}(
g_!(\mathcal{K}')^\bullet, \mathcal{I}^\bullet)
$$
is an isomorphism as $g_!(\mathcal{K}')^\bullet \to g_!\mathcal{K}^\bullet$
is a quasi-isomorphism and $\mathcal{I}^\bullet$ is K-injective. This finishes
the proof.
\end{proof}

\begin{remark}
\label{remark-when-derived-shriek-equal}
Warning! Let $u : \mathcal{C} \to \mathcal{D}$, $g$, $\mathcal{O}_\mathcal{D}$,
and $\mathcal{O}_\mathcal{C}$ be as in
Lemma \ref{lemma-existence-derived-lower-shriek}.
In general it is {\bf not} the case that the diagram
$$
\xymatrix{
D(\mathcal{O}_\mathcal{C}) \ar[r]_{Lg_!} \ar[d]_{forget} &
D(\mathcal{O}_\mathcal{D}) \ar[d]^{forget} \\
D(\mathcal{C}) \ar[r]^{Lg^{Ab}_!} &
D(\mathcal{D})
}
$$
commutes where the functor $Lg_!^{Ab}$ is the one constructed in
Lemma \ref{lemma-existence-derived-lower-shriek}
but using the constant sheaf $\mathbf{Z}$ as the structure sheaf
on both $\mathcal{C}$ and $\mathcal{D}$. In general it isn't even
the case that $g_! = g_!^{Ab}$ (see
Modules on Sites, Remark \ref{sites-modules-remark-when-shriek-equal}),
but this phenomenon {\bf can occur even if $g_! = g_!^{Ab}$}! Namely,
the construction of $Lg_!$ in the proof of
Lemma \ref{lemma-existence-derived-lower-shriek}
shows that $Lg_!$ agrees with $Lg_!^{\textit{Ab}}$ if and only if
the canonical maps
$$
Lg^{Ab}_!j_{U!}\mathcal{O}_U \longrightarrow j_{u(U)!}\mathcal{O}_{u(U)}
$$
are isomorphisms in $D(\mathcal{D})$ for all objects $U$ in $\mathcal{C}$.
In general all we can say is that there exists a natural transformation
$$
Lg_!^{Ab} \circ forget \longrightarrow forget \circ Lg_!
$$
\end{remark}









\section{Derived lower shriek for fibred categories}
\label{section-derived-lower-shriek-fibred}

\noindent
In this section we work out some special cases of the situation
discussed in Section \ref{section-derived-lower-shriek}.
We make sure that we have equality between lower shriek on modules
and sheaves of abelian groups. We encourage the reader to skip
this section on a first reading.

\begin{situation}
\label{situation-fibred-category}
Here $(\mathcal{D}, \mathcal{O}_\mathcal{D})$ be a ringed site
and $p : \mathcal{C} \to \mathcal{D}$ is a fibred category. We endow
$\mathcal{C}$ with the topology inherited from $\mathcal{D}$
(Stacks, Section \ref{stacks-section-topology}). We denote
$\pi : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$ the morphism of
topoi associated to $p$
(Stacks, Lemma \ref{stacks-lemma-topology-inherited-functorial}).
We set $\mathcal{O}_\mathcal{C} = \pi^{-1}\mathcal{O}_\mathcal{D}$
so that we obtain a morphism of ringed topoi
$$
\pi :
(\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C})
\longrightarrow
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})
$$
\end{situation}

\begin{lemma}
\label{lemma-fibred-category-with-object}
Assumptions and notation as in Situation \ref{situation-fibred-category}.
For $U \in \Ob(\mathcal{C})$ consider the induced morphism
of topoi
$$
\pi_U : \Sh(\mathcal{C}/U) \longrightarrow \Sh(\mathcal{D}/p(U))
$$
Then there exists a morphism of topoi
$$
\sigma : \Sh(\mathcal{D}/p(U)) \to \Sh(\mathcal{C}/U)
$$
such that $\pi_U \circ \sigma = \text{id}$ and $\sigma^{-1} = \pi_{U, *}$.
\end{lemma}

\begin{proof}
Observe that $\pi_U$ is the restriction of $\pi$ to the localizations, see
Sites, Lemma \ref{sites-lemma-localize-cocontinuous}.
For an object $V \to p(U)$ of $\mathcal{D}/p(U)$ denote
$V \times_{p(U)} U \to U$ the strongly cartesian morphism of $\mathcal{C}$
over $\mathcal{D}$ which exists as $p$ is a fibred category.
The functor
$$
v : \mathcal{D}/p(U) \to \mathcal{C}/U,\quad
V/p(U) \mapsto V \times_{p(U)} U/U
$$
is continuous by the definition of the topology on $\mathcal{C}$.
Moreover, it is a right adjoint to $p$ by the definition of strongly
cartesian morphisms. Hence we are in the situation discussed in
Sites, Section \ref{sites-section-cocontinuous-adjoint}
and we see that the sheaf $\pi_{U, *}\mathcal{F}$
is equal to $V \mapsto \mathcal{F}(V \times_{p(U)} U)$
(see especially Sites, Lemma
\ref{sites-lemma-have-functor-other-way-morphism}).

\medskip\noindent
But here we have more. Namely, the functor $v$
is also cocontinuous (as all morphisms in coverings of $\mathcal{C}$ 
are strongly cartesian). Hence $v$ defines a morphism $\sigma$ as
indicated in the lemma. The equality $\sigma^{-1} = \pi_{U, *}$
is immediate from the definition. Since $\pi_U^{-1}\mathcal{G}$
is given by the rule $U'/U \mapsto \mathcal{G}(p(U')/p(U))$
it follows that $\sigma^{-1} \circ \pi_U^{-1} = \text{id}$
which proves the equality
$\pi_U \circ \sigma = \text{id}$.
\end{proof}

\begin{situation}
\label{situation-morphism-fibred-categories}
Let $(\mathcal{D}, \mathcal{O}_\mathcal{D})$ be a ringed site.
Let $u : \mathcal{C}' \to \mathcal{C}$ be a $1$-morphism of fibred
categories over $\mathcal{D}$
(Categories, Definition \ref{categories-definition-fibred-categories-over-C}).
Endow $\mathcal{C}$ and $\mathcal{C}'$ with their inherited topologies
(Stacks, Definition \ref{stacks-definition-topology-inherited})
and let
$\pi : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$,
$\pi' : \Sh(\mathcal{C}') \to \Sh(\mathcal{D})$, and
$g : \Sh(\mathcal{C}') \to \Sh(\mathcal{C})$
be the corresponding morphisms of topoi
(Stacks, Lemma \ref{stacks-lemma-topology-inherited-functorial}).
Set $\mathcal{O}_\mathcal{C} = \pi^{-1}\mathcal{O}_\mathcal{D}$
and $\mathcal{O}_{\mathcal{C}'} = (\pi')^{-1}\mathcal{O}_\mathcal{D}$.
Observe that $g^{-1}\mathcal{O}_\mathcal{C} = \mathcal{O}_{\mathcal{C}'}$
so that
$$
\xymatrix{
(\Sh(\mathcal{C}'), \mathcal{O}_{\mathcal{C}'}) \ar[rd]_{\pi'} \ar[rr]_g & &
(\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \ar[ld]^\pi \\
& (\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})
}
$$
is a commutative diagram of morphisms of ringed topoi.
\end{situation}

\begin{lemma}
\label{lemma-morphism-fibred-categories-with-object}
Assumptions and notation as in
Situation \ref{situation-morphism-fibred-categories}.
For $U' \in \Ob(\mathcal{C}')$ set $U = u(U')$ and $V = p'(U')$ and
consider the induced morphisms of ringed topoi
$$
\xymatrix{
(\Sh(\mathcal{C}'/U'), \mathcal{O}_{U'}) \ar[rd]_{\pi'_{U'}} \ar[rr]_{g'} & &
(\Sh(\mathcal{C}), \mathcal{O}_U) \ar[ld]^{\pi_U} \\
& (\Sh(\mathcal{D}/V), \mathcal{O}_V)
}
$$
Then there exists a morphism of topoi
$$
\sigma' : \Sh(\mathcal{D}/V) \to \Sh(\mathcal{C}'/U'),
$$
such that setting $\sigma = g' \circ \sigma'$ we have
$\pi'_{U'} \circ \sigma' = \text{id}$, $\pi_U \circ \sigma = \text{id}$,
$(\sigma')^{-1} = \pi'_{U', *}$, and $\sigma^{-1} = \pi_{U, *}$.
\end{lemma}

\begin{proof}
Let $v' : \mathcal{D}/V \to \mathcal{C}'/U'$ be the functor constructed
in the proof of Lemma \ref{lemma-fibred-category-with-object} starting
with $p' : \mathcal{C}' \to \mathcal{D}'$ and the object $U'$.
Since $u$ is a $1$-morphism of fibred categories over $\mathcal{D}$
it transforms strongly cartesian morphisms into strongly cartesian morphisms,
hence the functor $v = u \circ v'$ is the functor of
the proof of Lemma \ref{lemma-fibred-category-with-object}
relative to $p : \mathcal{C} \to \mathcal{D}$ and $U$. Thus our lemma
follows from that lemma.
\end{proof}

\begin{lemma}
\label{lemma-properties-lower-shriek-fibred-category}
Assumption and notation as in
Situation \ref{situation-morphism-fibred-categories}.
\begin{enumerate}
\item There are left adjoints
$g_! : \textit{Mod}(\mathcal{O}_{\mathcal{C}'}) \to
\textit{Mod}(\mathcal{O}_\mathcal{C})$ and
$g_!^{\textit{Ab}} : \textit{Ab}(\mathcal{C}') \to \textit{Ab}(\mathcal{C})$
to $g^* = g^{-1}$ on modules and on abelian sheaves.
\item The diagram
$$
\xymatrix{
\textit{Mod}(\mathcal{O}_{\mathcal{C}'}) \ar[d] \ar[r]_{g_!} &
\textit{Mod}(\mathcal{O}_\mathcal{C}) \ar[d] \\
\textit{Ab}(\mathcal{C}') \ar[r]^{g_!^{\textit{Ab}}} &
\textit{Ab}(\mathcal{C})
}
$$
commutes.
\item There are left adjoints
$Lg_! : D(\mathcal{O}_{\mathcal{C}'}) \to D(\mathcal{O}_\mathcal{C})$
and
$Lg_!^{\textit{Ab}} : D(\mathcal{C}') \to D(\mathcal{C})$
to $g^* = g^{-1}$ on derived categories of modules and abelian sheaves.
\item The diagram
$$
\xymatrix{
D(\mathcal{O}_{\mathcal{C}'}) \ar[d] \ar[r]_{Lg_!} &
D(\mathcal{O}_\mathcal{C}) \ar[d] \\
D(\mathcal{C}') \ar[r]^{Lg_!^{\textit{Ab}}} &
D(\mathcal{C})
}
$$
commutes.
\end{enumerate}
\end{lemma}

\begin{proof}
The functor $u$ is continuous and cocontinuous
Stacks, Lemma \ref{stacks-lemma-topology-inherited-functorial}.
Hence the existence of the functors $g_!$, $g_!^{\textit{Ab}}$,
$Lg_!$, and $Lg_!^{\textit{Ab}}$ can be found in
Modules on Sites, Sections
\ref{sites-modules-section-exactness-lower-shriek} and
\ref{sites-modules-section-lower-shriek-modules}
and
Section \ref{section-derived-lower-shriek}.

\medskip\noindent
To prove (2) it suffices to show that the canonical map
$$
g_!^{\textit{Ab}}j_{U'!}\mathcal{O}_{U'} \to j_{u(U')!}\mathcal{O}_{u(U')}
$$
is an isomorphism for all objects $U'$ of $\mathcal{C}'$, see
Modules on Sites, Remark \ref{sites-modules-remark-when-shriek-equal}.
Similarly, to prove (4) it suffices to show that the canonical map
$$
Lg_!^{\textit{Ab}}j_{U'!}\mathcal{O}_{U'} \to j_{u(U')!}\mathcal{O}_{u(U')}
$$
is an isomorphism in $D(\mathcal{C})$ for all objects $U'$ of
$\mathcal{C}'$, see Remark \ref{remark-when-derived-shriek-equal}.
This will also imply the previous formula hence this is what we will show.

\medskip\noindent
We will use that for a localization morphism $j$ the
functors $j_!$ and $j_!^{\textit{Ab}}$ agree (see
Modules on Sites, Remark \ref{sites-modules-remark-localize-shriek-equal})
and that $j_!$ is exact
(Modules on Sites, Lemma \ref{sites-modules-lemma-extension-by-zero-exact}).
Let us adopt the notation of
Lemma \ref{lemma-morphism-fibred-categories-with-object}.
Since $Lg_!^{\textit{Ab}} \circ j_{U'!} = j_{U!} \circ L(g')^{\textit{Ab}}_!$
(by commutativity of Sites, Lemma \ref{sites-lemma-localize-cocontinuous}
and uniqueness of adjoint functors) it suffices to prove that
$L(g')^{\textit{Ab}}_!\mathcal{O}_{U'} = \mathcal{O}_U$. Using the
results of
Lemma \ref{lemma-morphism-fibred-categories-with-object}
we have for any object $E$ of $D(\mathcal{C}/u(U'))$ the following
sequence of equalities
\begin{align*}
\Hom_{D(\mathcal{C}/U)}(L(g')_!^{\textit{Ab}}\mathcal{O}_{U'}, E)
& =
\Hom_{D(\mathcal{C}'/U')}(\mathcal{O}_{U'}, (g')^{-1}E) \\
& =
\Hom_{D(\mathcal{C}'/U')}((\pi'_{U'})^{-1}\mathcal{O}_V, (g')^{-1}E) \\
& =
\Hom_{D(\mathcal{D}/V)}(\mathcal{O}_V, R\pi'_{U', *}(g')^{-1}E) \\
& =
\Hom_{D(\mathcal{D}/V)}(\mathcal{O}_V, (\sigma')^{-1}(g')^{-1}E) \\
& =
\Hom_{D(\mathcal{D}/V)}(\mathcal{O}_V, \sigma^{-1}E) \\
& =
\Hom_{D(\mathcal{D}/V)}(\mathcal{O}_V, \pi_{U, *}E) \\
& =
\Hom_{D(\mathcal{C}/U)}(\pi_U^{-1}\mathcal{O}_V, E) \\
& =
\Hom_{D(\mathcal{C}/U)}(\mathcal{O}_U, E)
\end{align*}
By Yoneda's lemma we conclude.
\end{proof}

\begin{remark}
\label{remark-fibred-category}
Assumptions and notation as in Situation \ref{situation-fibred-category}.
Note that setting $\mathcal{C}' = \mathcal{D}$ and $u$ equal to the
structure functor of $\mathcal{C}$ gives a situation as in
Situation \ref{situation-morphism-fibred-categories}. Hence
Lemma \ref{lemma-properties-lower-shriek-fibred-category}
tells us we have functors  $\pi_!$, $\pi_!^{\textit{Ab}}$, $L\pi_!$, and
$L\pi_!^{\textit{Ab}}$ such that
$forget \circ \pi_! = \pi_!^{\textit{Ab}} \circ forget$ and
$forget \circ L\pi_! = L\pi_!^{\textit{Ab}} \circ forget$.
\end{remark}

\begin{remark}
\label{remark-morphism-fibred-categories}
Assumptions and notation as in
Situation \ref{situation-morphism-fibred-categories}.
Let $\mathcal{F}$ be an abelian sheaf on $\mathcal{C}$,
let $\mathcal{F}'$ be an abelian sheaf on $\mathcal{C}'$,
and let $t : \mathcal{F}' \to g^{-1}\mathcal{F}$ be a map.
Then we obtain a canonical map
$$
L\pi'_!(\mathcal{F}') \longrightarrow L\pi_!(\mathcal{F})
$$
by using the adjoint $g_!\mathcal{F}' \to \mathcal{F}$ of $t$,
the map $Lg_!(\mathcal{F}') \to g_!\mathcal{F}'$, and the
equality $L\pi'_! = L\pi_! \circ Lg_!$.
\end{remark}

\begin{lemma}
\label{lemma-compute-pi-shriek}
Assumptions and notation as in
Situation \ref{situation-fibred-category}.
For $\mathcal{F}$ in $\textit{Ab}(\mathcal{C})$
the sheaf $\pi_!\mathcal{F}$ is the
sheaf associated to the presheaf
$$
V \longmapsto \colim_{\mathcal{C}_V^{opp}} \mathcal{F}|_{\mathcal{C}_V}
$$
with restriction maps as indicated in the proof.
\end{lemma}

\begin{proof}
Denote $\mathcal{H}$ be the rule of the lemma.
For a morphism $h : V' \to V$ of $\mathcal{D}$ there is a
pullback functor $h^* : \mathcal{C}_V \to \mathcal{C}_{V'}$ of fibre
categories (Categories, Definition
\ref{categories-definition-pullback-functor-fibred-category}).
Moreover for $U \in \Ob(\mathcal{C}_V)$ there is a
strongly cartesian morphism $h^*U \to U$ covering $h$.
Restriction along these strongly cartesian morphisms defines a
transformation of functors
$$
\mathcal{F}|_{\mathcal{C}_V}
\longrightarrow
\mathcal{F}|_{\mathcal{C}_{V'}} \circ h^*.
$$
Hence a map $\mathcal{H}(V) \to \mathcal{H}(V')$ between colimits, see
Categories, Lemma \ref{categories-lemma-functorial-colimit}.

\medskip\noindent
To prove the lemma we show that
$$
\Mor_{\textit{PSh}(\mathcal{D})}(\mathcal{H}, \mathcal{G}) =
\Mor_{\Sh(\mathcal{C})}(\mathcal{F}, \pi^{-1}\mathcal{G})
$$
for every sheaf $\mathcal{G}$ on $\mathcal{C}$. An element of the
left hand side is a compatible system of maps
$\mathcal{F}(U) \to \mathcal{G}(p(U))$ for all $U$ in $\mathcal{C}$.
Since $\pi^{-1}\mathcal{G}(U) = \mathcal{G}(p(U))$ by our choice
of topology on $\mathcal{C}$ we see the same thing is true for the
right hand side and we win.
\end{proof}





\section{Homology on a category}
\label{section-homology}

\noindent
In the case of a category over a point we will baptize the left derived
lower shriek functors the homology functors.

\begin{example}[Category over point]
\label{example-category-to-point}
Let $\mathcal{C}$ be a category. Endow $\mathcal{C}$ with the chaotic
topology (Sites, Example \ref{sites-example-indiscrete}). Thus
presheaves and sheaves agree on $\mathcal{C}$.
The functor $p : \mathcal{C} \to *$ where $*$ is the category with a single
object and a single morphism is cocontinuous and continuous. Let
$\pi : \Sh(\mathcal{C}) \to \Sh(*)$ be the corresponding morphism
of topoi. Let $B$ be a ring. We endow $*$ with the sheaf of rings $B$
and $\mathcal{C}$ with $\mathcal{O}_\mathcal{C} = \pi^{-1}B$ which
we will denote $\underline{B}$. In this way
$$
\pi : (\Sh(\mathcal{C}), \underline{B}) \to (*, B)
$$
is an example of Situation \ref{situation-fibred-category}.
By Remark \ref{remark-fibred-category} we do not need to distinguish
between $\pi_!$ on modules or abelian sheaves. By
Lemma \ref{lemma-compute-pi-shriek} we see that
$\pi_!\mathcal{F} = \colim_{\mathcal{C}^{opp}} \mathcal{F}$.
Thus $L_n\pi_!$ is the $n$th left derived functor of taking colimits.
In the following, we write
$$
H_n(\mathcal{C}, \mathcal{F}) = L_n\pi_!(\mathcal{F})
$$
and we will name this the {\it $n$th homology group of $\mathcal{F}$}
on $\mathcal{C}$.
\end{example}

\begin{example}[Computing homology]
\label{example-left-derived-colimits}
In Example \ref{example-category-to-point} we can compute
the functors $H_n(\mathcal{C}, -)$ as follows. Let
$\mathcal{F} \in \Ob(\textit{Ab}(\mathcal{C}))$.
Consider the chain complex
$$
K_\bullet(\mathcal{F}) :
\ \ldots \to
\bigoplus\nolimits_{U_2 \to U_1 \to U_0} \mathcal{F}(U_0)
\to
\bigoplus\nolimits_{U_1 \to U_0} \mathcal{F}(U_0)
\to
\bigoplus\nolimits_{U_0} \mathcal{F}(U_0)
$$
where the transition maps are given by
$$
(U_2 \to U_1 \to U_0, s)
\longmapsto
(U_1 \to U_0, s) - (U_2 \to U_0, s) + (U_2 \to U_1, s|_{U_1})
$$
and similarly in other degrees. By construction
$$
H_0(\mathcal{C}, \mathcal{F}) =
\colim_{\mathcal{C}^{opp}} \mathcal{F} =
H_0(K_\bullet(\mathcal{F})),
$$
see Categories, Lemma \ref{categories-lemma-colimits-coproducts-coequalizers}.
The construction of $K_\bullet(\mathcal{F})$ is functorial in $\mathcal{F}$
and transforms short exact sequences of $\textit{Ab}(\mathcal{C})$ into
short exact sequences of complexes. Thus the sequence of functors
$\mathcal{F} \mapsto H_n(K_\bullet(\mathcal{F}))$ forms a $\delta$-functor, see
Homology, Definition \ref{homology-definition-cohomological-delta-functor} and
Lemma \ref{homology-lemma-long-exact-sequence-cochain}.
For $\mathcal{F} = j_{U!}\mathbf{Z}_U$ the complex $K_\bullet(\mathcal{F})$
is the complex associated to the free $\mathbf{Z}$-module on the simplicial
set $X_\bullet$ with terms
$$
X_n = \coprod\nolimits_{U_n \to \ldots \to U_1 \to U_0}
\Mor_\mathcal{C}(U_0, U)
$$
This simplicial set is homotopy equivalent to the constant simplicial
set on a singleton $\{*\}$. Namely, the map $X_\bullet \to \{*\}$
is obvious, the map $\{*\} \to X_n$ is given
by mapping $*$ to $(U \to \ldots \to U, \text{id}_U)$, and the
maps
$$
h_{n, i} : X_n \longrightarrow X_n
$$
(Simplicial, Lemma \ref{simplicial-lemma-relations-homotopy})
defining the homotopy between the two maps $X_\bullet \to X_\bullet$
are given by the rule
$$
h_{n, i} :
(U_n \to \ldots \to U_0, f)
\longmapsto
(U_n \to \ldots \to U_i \to U \to \ldots \to U, \text{id})
$$
for $i > 0$ and $h_{n, 0} = \text{id}$. Verifications omitted.
This implies that $K_\bullet(j_{U!}\mathbf{Z}_U)$ has trivial
cohomology in negative degrees
(by the functoriality of
Simplicial, Remark \ref{simplicial-remark-homotopy-better}
and the result of
Simplicial, Lemma \ref{simplicial-lemma-homotopy-s-N}).
Thus $K_\bullet(\mathcal{F})$ computes the left derived functors
$H_n(\mathcal{C}, -)$ of $H_0(\mathcal{C}, -)$
for example by (the duals of)
Homology, Lemma \ref{homology-lemma-efface-implies-universal}
and
Derived Categories, Lemma \ref{derived-lemma-right-derived-delta-functor}.
\end{example}

\begin{example}
\label{example-morphism-categories}
Let $u : \mathcal{C}' \to \mathcal{C}$ be a functor.
Endow $\mathcal{C}'$ and $\mathcal{C}$ with the chaotic
topology as in Example \ref{example-category-to-point}.
The functors $u$, $\mathcal{C}' \to *$, and $\mathcal{C} \to *$
where $*$ is the category with a single object and a single morphism
are cocontinuous and continuous. Let
$g : \Sh(\mathcal{C}') \to \Sh(\mathcal{C})$,
$\pi' : \Sh(\mathcal{C}') \to \Sh(*)$, and
$\pi : \Sh(\mathcal{C}) \to \Sh(*)$,
be the corresponding morphisms of topoi.
Let $B$ be a ring. We endow $*$ with the sheaf of rings $B$ and
$\mathcal{C}'$, $\mathcal{C}$ with the constant sheaf $\underline{B}$.
In this way
$$
\xymatrix{
(\Sh(\mathcal{C}'), \underline{B}) \ar[rd]_{\pi'} \ar[rr]_g & &
(\Sh(\mathcal{C}), \underline{B}) \ar[ld]^\pi \\
& (\Sh(*), B)
}
$$
is an example of Situation \ref{situation-morphism-fibred-categories}.
Thus
Lemma \ref{lemma-properties-lower-shriek-fibred-category}
applies to $g$ so we do not need to distinguish between $g_!$ on
modules or abelian sheaves. In particular
Remark \ref{remark-morphism-fibred-categories}
produces canonical maps
$$
H_n(\mathcal{C}', \mathcal{F}')
\longrightarrow
H_n(\mathcal{C}, \mathcal{F})
$$
whenever we have $\mathcal{F}$ in $\textit{Ab}(\mathcal{C})$,
$\mathcal{F}'$ in $\textit{Ab}(\mathcal{C}')$,
and a map $t : \mathcal{F}' \to g^{-1}\mathcal{F}$. In terms of the
computation of homology given in
Example \ref{example-left-derived-colimits}
we see that these maps come from a map of complexes
$$
K_\bullet(\mathcal{F}') \longrightarrow K_\bullet(\mathcal{F})
$$
given by the rule
$$
(U'_n \to \ldots \to U'_0, s') \longmapsto
(u(U'_n) \to \ldots \to u(U'_0), t(s'))
$$
with obvious notation.
\end{example}

\begin{remark}
\label{remark-map-evaluation-to-derived}
Notation and assumptions as in Example \ref{example-category-to-point}.
Let $\mathcal{F}^\bullet$ be a bounded complex of abelian sheaves on
$\mathcal{C}$. For any object $U$ of $\mathcal{C}$ there is a canonical
map
$$
\mathcal{F}^\bullet(U) \longrightarrow L\pi_!(\mathcal{F}^\bullet)
$$
in $D(\textit{Ab})$. If $\mathcal{F}^\bullet$ is a complex of
$\underline{B}$-modules then this map is in $D(B)$. To prove this, note
that we compute $L\pi_!(\mathcal{F}^\bullet)$ by taking a quasi-isomorphism
$\mathcal{P}^\bullet \to \mathcal{F}^\bullet$ where $\mathcal{P}^\bullet$
is a complex of projectives. However, since the topology is chaotic
this means that $\mathcal{P}^\bullet(U) \to \mathcal{F}^\bullet(U)$
is a quasi-isomorphism hence can be inverted in
$D(\textit{Ab})$, resp.\ $D(B)$. Composing with the canonical map
$\mathcal{P}^\bullet(U) \to \pi_!(\mathcal{P}^\bullet)$ coming from
the computation of $\pi_!$ as a colimit we obtain the desired arrow.
\end{remark}

\begin{lemma}
\label{lemma-initial-final}
Notation and assumptions as in Example \ref{example-category-to-point}.
If $\mathcal{C}$ has either an initial or a final object, then
$L\pi_! \circ \pi^{-1} = \text{id}$ on $D(\textit{Ab})$, resp.\ $D(B)$.
\end{lemma}

\begin{proof}
If $\mathcal{C}$ has an initial object, then $\pi_!$ is computed by
evaluating on this object and the statement is clear. If $\mathcal{C}$
has a final object, then $R\pi_*$ is computed by evaluating on this
object, hence $R\pi_* \circ \pi^{-1} \cong \text{id}$ on
$D(\textit{Ab})$, resp.\ $D(B)$. This implies that
$\pi^{-1} : D(\textit{Ab}) \to D(\mathcal{C})$,
resp.\ $\pi^{-1} : D(B) \to D(\underline{B})$ is fully faithful, see
Categories, Lemma \ref{categories-lemma-adjoint-fully-faithful}.
Then the same lemma implies that $L\pi_! \circ \pi^{-1} = \text{id}$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-change-of-rings}
Notation and assumptions as in Example \ref{example-category-to-point}.
Let $B \to B'$ be a ring map. Consider the commutative diagram
of ringed topoi
$$
\xymatrix{
(\Sh(\mathcal{C}), \underline{B}) \ar[d]_\pi &
(\Sh(\mathcal{C}), \underline{B'}) \ar[d]^{\pi'} \ar[l]^h \\
(*, B) & (*, B') \ar[l]_f
}
$$
Then $L\pi_! \circ Lh^* = Lf^* \circ L\pi'_!$.
\end{lemma}

\begin{proof}
Both functors are right adjoint to the obvious functor
$D(B') \to D(\underline{B})$.
\end{proof}

\begin{lemma}
\label{lemma-compute-by-cosimplicial-resolution}
Notation and assumptions as in Example \ref{example-category-to-point}.
Let $U_\bullet$ be a cosimplicial object in $\mathcal{C}$ such that
for every $U \in \Ob(\mathcal{C})$ the simplicial set
$\Mor_\mathcal{C}(U_\bullet, U)$
is homotopy equivalent to the constant simplicial set on a singleton. Then
$$
L\pi_!(\mathcal{F}) = \mathcal{F}(U_\bullet)
$$
in $D(\textit{Ab})$, resp.\ $D(B)$ functorially in $\mathcal{F}$ in
$\textit{Ab}(\mathcal{C})$, resp.\ $\textit{Mod}(\underline{B})$.
\end{lemma}

\begin{proof}
As $L\pi_!$ agrees for modules and abelian sheaves by
Lemma \ref{lemma-properties-lower-shriek-fibred-category}
it suffices to prove this when $\mathcal{F}$ is an abelian sheaf.
For $U \in \Ob(\mathcal{C})$ the abelian sheaf $j_{U!}\mathbf{Z}_U$
is a projective object of $\textit{Ab}(\mathcal{C})$ since
$\Hom(j_{U!}\mathbf{Z}_U, \mathcal{F}) = \mathcal{F}(U)$
and taking sections is an exact functor as the topology is chaotic.
Every abelian sheaf is a quotient of a direct sum of $j_{U!}\mathbf{Z}_U$
by Modules on Sites, Lemma \ref{sites-modules-lemma-module-quotient-flat}.
Thus we can compute $L\pi_!(\mathcal{F})$ by choosing a resolution
$$
\ldots \to \mathcal{G}^{-1} \to \mathcal{G}^0 \to \mathcal{F} \to 0
$$
whose terms are direct sums of sheaves of the form above and taking
$L\pi_!(\mathcal{F}) = \pi_!(\mathcal{G}^\bullet)$. Consider the
double complex
$A^{\bullet, \bullet} = \mathcal{G}^\bullet(U_\bullet)$.
The map $\mathcal{G}^0 \to \mathcal{F}$ gives a map of complexes
$A^{0, \bullet} \to \mathcal{F}(U_\bullet)$.
Since $\pi_!$ is computed by taking the colimit over
$\mathcal{C}^{opp}$ (Lemma \ref{lemma-compute-pi-shriek})
we see that the two compositions
$\mathcal{G}^m(U_1) \to \mathcal{G}^m(U_0) \to \pi_!\mathcal{G}^m$
are equal. Thus we obtain a canonical map of complexes
$$
\text{Tot}(A^{\bullet, \bullet})
\longrightarrow
\pi_!(\mathcal{G}^\bullet) = L\pi_!(\mathcal{F})
$$
To prove the lemma it suffices to show that the complexes
$$
\ldots \to \mathcal{G}^m(U_1) \to \mathcal{G}^m(U_0) \to
\pi_!\mathcal{G}^m \to 0
$$
are exact, see Homology, Lemma
\ref{homology-lemma-double-complex-gives-resolution}.
Since the sheaves $\mathcal{G}^m$ are direct sums of the sheaves
$j_{U!}\mathbf{Z}_U$ we reduce to $\mathcal{G} = j_{U!}\mathbf{Z}_U$.
The complex $j_{U!}\mathbf{Z}_U(U_\bullet)$
is the complex of abelian groups associated to the free
$\mathbf{Z}$-module on the simplicial set
$\Mor_\mathcal{C}(U_\bullet, U)$ which we assumed to be homotopy
equivalent to a singleton. We conclude that
$$
j_{U!}\mathbf{Z}_U(U_\bullet) \to \mathbf{Z}
$$
is a homotopy equivalence of abelian groups hence a quasi-isomorphism
(Simplicial, Remark \ref{simplicial-remark-homotopy-better} and
Lemma \ref{simplicial-lemma-homotopy-s-N}). This finishes the proof
since $\pi_!j_{U!}\mathbf{Z}_U = \mathbf{Z}$
as was shown in the proof of
Lemma \ref{lemma-properties-lower-shriek-fibred-category}.
\end{proof}

\begin{lemma}
\label{lemma-get-it-now}
Notation and assumptions as in Example \ref{example-morphism-categories}.
If there exists a cosimplicial object $U'_\bullet$ of $\mathcal{C}'$
such that Lemma \ref{lemma-compute-by-cosimplicial-resolution}
applies to both $U'_\bullet$ in $\mathcal{C}'$
and $u(U'_\bullet)$ in $\mathcal{C}$, then we have
$L\pi'_! \circ g^{-1} = L\pi_!$ as functors
$D(\mathcal{C}) \to D(\textit{Ab})$,
resp.\ $D(\mathcal{C}, \underline{B}) \to D(B)$.
\end{lemma}

\begin{proof}
Follows immediately from
Lemma \ref{lemma-compute-by-cosimplicial-resolution}
and the fact that $g^{-1}$ is given by precomposing with $u$.
\end{proof}

\begin{lemma}
\label{lemma-product-categories}
Let $\mathcal{C}_i$, $i = 1, 2$ be categories. Let
$u_i : \mathcal{C}_1 \times \mathcal{C}_2 \to \mathcal{C}_i$ be the
projection functors. Let $B$ be a ring. Let
$g_i : (\Sh(\mathcal{C}_1 \times \mathcal{C}_2), \underline{B}) \to
(\Sh(\mathcal{C}_i), \underline{B})$ be the corresponding morphisms
of ringed topoi, see Example \ref{example-morphism-categories}. For
$K_i \in D(\mathcal{C}_i, B)$ we have
$$
L(\pi_1 \times \pi_2)_!(
g_1^{-1}K_1 \otimes_{\underline{B}}^\mathbf{L} g_2^{-1}K_2)
=
L\pi_{1, !}(K_1) \otimes_B^\mathbf{L} L\pi_{2, !}(K_2)
$$
in $D(B)$ with obvious notation.
\end{lemma}

\begin{proof}
As both sides commute with colimits, it suffices to prove this for
$K_1 = j_{U!}\underline{B}_U$ and $K_2 = j_{V!}\underline{B}_V$
for $U \in \Ob(\mathcal{C}_1)$ and $V \in \Ob(\mathcal{C}_2)$.
See construction of $L\pi_!$ in
Lemma \ref{lemma-existence-derived-lower-shriek}.
In this case
$$
g_1^{-1}K_1 \otimes_{\underline{B}}^\mathbf{L} g_2^{-1}K_2 =
g_1^{-1}K_1 \otimes_{\underline{B}} g_2^{-1}K_2 =
j_{(U, V)!}\underline{B}_{(U, V)}
$$
Verification omitted. Hence the result follows as both the left and
the right hand side of the formula of the lemma evaluate to $B$, see
construction of $L\pi_!$ in Lemma \ref{lemma-existence-derived-lower-shriek}.
\end{proof}

\begin{lemma}
\label{lemma-eilenberg-zilber}
Notation and assumptions as in Example \ref{example-category-to-point}.
If there exists a cosimplicial object $U_\bullet$ of $\mathcal{C}$
such that Lemma \ref{lemma-compute-by-cosimplicial-resolution}
applies, then
$$
L\pi_!(K_1 \otimes^\mathbf{L}_{\underline{B}} K_2) =
L\pi_!(K_1) \otimes^\mathbf{L}_B L\pi_!(K_2)
$$
for all $K_i \in D(\underline{B})$.
\end{lemma}

\begin{proof}
Consider the diagram of categories and functors
$$
\xymatrix{
& & \mathcal{C} \\
\mathcal{C} \ar[r]^-u &
\mathcal{C} \times \mathcal{C} \ar[rd]^{u_2} \ar[ru]_{u_1} \\
& & \mathcal{C}
}
$$
where $u$ is the diagonal functor and $u_i$ are the projection functors.
This gives morphisms of ringed topoi $g$, $g_1$, $g_2$.
For any object $(U_1, U_2)$ of $\mathcal{C}$ we have
$$
\Mor_{\mathcal{C} \times \mathcal{C}}(u(U_\bullet), (U_1, U_2)) =
\Mor_\mathcal{C}(U_\bullet, U_1) \times \Mor_\mathcal{C}(U_\bullet, U_2)
$$
which is homotopy equivalent to a point by
Simplicial, Lemma \ref{simplicial-lemma-products-homotopy}.
Thus Lemma \ref{lemma-get-it-now} gives
$L\pi_!(g^{-1}K) = L(\pi \times \pi)_!(K)$ for any $K$ in
$D(\mathcal{C} \times \mathcal{C}, B)$.
Take $K = g_1^{-1}K_1 \otimes_B^\mathbf{L} g_2^{-1}K_2$.
Then $g^{-1}K = K_1 \otimes^\mathbf{L}_{\underline{B}} K_2$
because $g^{-1} = g^* = Lg^*$ commutes with derived tensor product
(Lemma \ref{lemma-pullback-tensor-product}
-- a site with chaotic topology has enough points).
To finish we apply Lemma \ref{lemma-product-categories}.
\end{proof}

\begin{remark}[Simplicial modules]
\label{remark-simplicial-modules}
Let $\mathcal{C} = \Delta$ and let $B$ be any ring. This is a special
case of Example \ref{example-category-to-point} where the assumptions
of Lemma \ref{lemma-compute-by-cosimplicial-resolution} hold.
Namely, let $U_\bullet$ be the cosimplicial object of $\Delta$ given by
the identity functor. To verify the condition we have to show that for
$[m] \in \Ob(\Delta)$ the simplicial set
$\Delta[m] : n \mapsto \Mor_\Delta([n], [m])$ is homotopy equivalent
to a point. This is explained in
Simplicial, Example \ref{simplicial-example-simplex-contractible}.

\medskip\noindent
In this situation the category $\textit{Mod}(\underline{B})$
is just the category of simplicial $B$-modules and the
functor $L\pi_!$ sends a simplicial $B$-module $M_\bullet$ to its associated
complex $s(M_\bullet)$ of $B$-modules. Thus the results above can be
reinterpreted in terms of results on simplicial modules. For example
a special case of Lemma \ref{lemma-eilenberg-zilber} is:
if $M_\bullet$, $M'_\bullet$ are flat simplicial
$B$-modules, then the complex $s(M_\bullet \otimes_B M'_\bullet)$ is
quasi-isomorphic to the total complex associated to the double complex
$s(M_\bullet) \otimes_B s(M'_\bullet)$.
(Hint: use flatness to convert from derived tensor products to usual
tensor products.)
This is a special case of the Eilenberg-Zilber theorem
which can be found in \cite{Eilenberg-Zilber}.
\end{remark}

\begin{lemma}
\label{lemma-O-homology-qis}
Let $\mathcal{C}$ be a category (endowed with chaotic topology).
Let $\mathcal{O} \to \mathcal{O}'$ be a map of sheaves of rings on
$\mathcal{C}$. Assume
\begin{enumerate}
\item there exists a cosimplicial object $U_\bullet$ in $\mathcal{C}$
as in Lemma \ref{lemma-compute-by-cosimplicial-resolution}, and
\item $L\pi_!\mathcal{O} \to L\pi_!\mathcal{O}'$ is an isomorphism.
\end{enumerate}
For $K$ in $D(\mathcal{O})$ we have
$$
L\pi_!(K) = L\pi_!(K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}')
$$
in $D(\textit{Ab})$.
\end{lemma}

\begin{proof}
Note: in this proof $L\pi_!$ denotes the left derived functor
of $\pi_!$ on abelian sheaves.
Since $L\pi_!$ commutes with colimits, it suffices
to prove this for bounded above complexes of $\mathcal{O}$-modules
(compare with argument of
Derived Categories, Proposition \ref{derived-proposition-left-derived-exists}
or just stick to bounded above complexes).
Every such complex is quasi-isomorphic to a bounded above complex
whose terms are direct sums of $j_{U!}\mathcal{O}_U$ with
$U \in \Ob(\mathcal{C})$, see
Modules on Sites, Lemma \ref{sites-modules-lemma-module-quotient-flat}.
Thus it suffices to prove the lemma
for $j_{U!}\mathcal{O}_U$. By assumption
$$
S_\bullet = \Mor_\mathcal{C}(U_\bullet, U)
$$
is a simplicial set homotopy equivalent to the constant simplicial
set on a singleton. Set $P_n = \mathcal{O}(U_n)$ and
$P'_n = \mathcal{O}'(U_n)$. Observe that the complex associated to the
simplicial abelian group
$$
X_\bullet : n \longmapsto \bigoplus\nolimits_{s \in S_n} P_n
$$
computes $L\pi_!(j_{U!}\mathcal{O}_U)$ by
Lemma \ref{lemma-compute-by-cosimplicial-resolution}.
Since $j_{U!}\mathcal{O}_U$ is a flat $\mathcal{O}$-module we have
$j_{U!}\mathcal{O}_U \otimes^\mathbf{L}_\mathcal{O} \mathcal{O}' =
j_{U!}\mathcal{O}'_U$ and $L\pi_!$ of this is computed by the complex
associated to the simplicial abelian group
$$
X'_\bullet : n \longmapsto \bigoplus\nolimits_{s \in S_n} P'_n
$$
As the rule which to a simplicial set $T_\bullet$ associated the simplicial
abelian group with terms $\bigoplus_{t \in T_n} P_n$ is a functor, we see
that $X_\bullet \to P_\bullet$ is a homotopy equivalence of simplicial
abelian groups. Similarly, the rule which to a simplicial set
$T_\bullet$ associates the simplicial abelian group with terms
$\bigoplus_{t \in T_n} P'_n$ is a functor. Hence $X'_\bullet \to P'_\bullet$
is a homotopy equivalence of simplicial abelian groups.
By assumption $P_\bullet \to P'_\bullet$ is a quasi-isomorphism
(since $P_\bullet$, resp.\ $P'_\bullet$ computes $L\pi_!\mathcal{O}$,
resp. $L\pi_!\mathcal{O}'$ by
Lemma \ref{lemma-compute-by-cosimplicial-resolution}).
We conclude that $X_\bullet$ and $X'_\bullet$ are quasi-isomorphic as desired.
\end{proof}

\begin{remark}
\label{remark-O-homology-B-homology-general}
Let $\mathcal{C}$ and $B$ be as in Example \ref{example-category-to-point}.
Assume there exists a cosimplicial object as in
Lemma \ref{lemma-compute-by-cosimplicial-resolution}.
Let $\mathcal{O} \to \underline{B}$ be a map sheaf of rings on
$\mathcal{C}$ which induces an isomorphism
$L\pi_!\mathcal{O} \to L\pi_!\underline{B}$.
In this case we obtain an exact functor of triangulated categories
$$
L\pi_! : D(\mathcal{O}) \longrightarrow D(B)
$$
Namely, for any object $K$ of $D(\mathcal{O})$ we have
$L\pi^{\textit{Ab}}_!(K) =
L\pi^{\textit{Ab}}_!(K \otimes_{\mathcal{O}}^\mathbf{L} \underline{B})$
by Lemma \ref{lemma-O-homology-qis}.
Thus we can define the displayed functor as the composition of
$- \otimes^\mathbf{L}_\mathcal{O} \underline{B}$ with the functor
$L\pi_! : D(\underline{B}) \to D(B)$.
In other words, we obtain a $B$-module structure on $L\pi_!(K)$ coming
from the (canonical, functorial) identification of $L\pi_!(K)$ with
$L\pi_!(K \otimes_\mathcal{O}^\mathbf{L} \underline{B})$ of the lemma.
\end{remark}







\section{Calculating derived lower shriek}
\label{section-calculate}

\noindent
In this section we apply the results from
Section \ref{section-homology}
to compute
$L\pi_!$ in Situation \ref{situation-fibred-category} and
$Lg_!$ in Situation \ref{situation-morphism-fibred-categories}.

\begin{lemma}
\label{lemma-compute-left-derived-pi-shriek-pre}
Assumptions and notation as in Situation \ref{situation-fibred-category}.
For $\mathcal{F}$ in $\textit{PAb}(\mathcal{C})$ and $n \geq 0$
consider the abelian sheaf $L_n(\mathcal{F})$ on $\mathcal{D}$
which is the sheaf associated to the presheaf
$$
V \longmapsto H_n(\mathcal{C}_V, \mathcal{F}|_{\mathcal{C}_V})
$$
with restriction maps as indicated in the proof. Then
$L_n(\mathcal{F}) = L_n(\mathcal{F}^\#)$.
\end{lemma}

\begin{proof}
For a morphism $h : V' \to V$ of $\mathcal{D}$ there is a
pullback functor $h^* : \mathcal{C}_V \to \mathcal{C}_{V'}$ of fibre
categories (Categories, Definition
\ref{categories-definition-pullback-functor-fibred-category}).
Moreover for $U \in \Ob(\mathcal{C}_V)$ there is a
strongly cartesian morphism $h^*U \to U$ covering $h$.
Restriction along these strongly cartesian morphisms defines a
transformation of functors
$$
\mathcal{F}|_{\mathcal{C}_V}
\longrightarrow
\mathcal{F}|_{\mathcal{C}_{V'}} \circ h^*.
$$
By Example \ref{example-morphism-categories}
we obtain the desired restriction map
$$
H_n(\mathcal{C}_V, \mathcal{F}|_{\mathcal{C}_V})
\longrightarrow
H_n(\mathcal{C}_{V'}, \mathcal{F}|_{\mathcal{C}_{V'}})
$$
Let us denote $L_{n, p}(\mathcal{F})$ this presheaf, so that
$L_n(\mathcal{F}) = L_{n, p}(\mathcal{F})^\#$.
The canonical map $\gamma : \mathcal{F} \to \mathcal{F}^+$
(Sites, Theorem \ref{sites-theorem-plus})
defines a canonical
map $L_{n, p}(\mathcal{F}) \to L_{n, p}(\mathcal{F}^+)$.
We have to prove this map becomes an isomorphism after sheafification.

\medskip\noindent
Let us use the computation of homology given in
Example \ref{example-left-derived-colimits}. Denote
$K_\bullet(\mathcal{F}|_{\mathcal{C}_V})$ the complex associated to
the restriction of $\mathcal{F}$ to the fibre category $\mathcal{C}_V$.
By the remarks above we obtain a presheaf $K_\bullet(\mathcal{F})$
of complexes
$$
V \longmapsto K_\bullet(\mathcal{F}|_{\mathcal{C}_V})
$$
whose cohomology presheaves are the presheaves $L_{n, p}(\mathcal{F})$.
Thus it suffices to show that
$$
K_\bullet(\mathcal{F}) \longrightarrow K_\bullet(\mathcal{F}^+)
$$
becomes an isomorphism on sheafification.

\medskip\noindent
Injectivity. Let $V$ be an object of $\mathcal{D}$ and let
$\xi \in K_n(\mathcal{F})(V)$ be an element which maps
to zero in $K_n(\mathcal{F}^+)(V)$. We have to show there exists a
covering $\{V_j \to V\}$ such that $\xi|_{V_j}$ is zero in
$K_n(\mathcal{F})(V_j)$. We write
$$
\xi = \sum (U_{i, n + 1} \to \ldots \to U_{i, 0}, \sigma_i)
$$
with $\sigma_i \in \mathcal{F}(U_{i, 0})$. We arrange it so that
each sequence of morphisms $U_n \to \ldots \to U_0$ of $\mathcal{C}_V$
occurs are most once. Since the sums in the definition
of the complex $K_\bullet$ are direct sums, the only way this can map
to zero in $K_\bullet(\mathcal{F}^+)(V)$ is if all $\sigma_i$ map
to zero in $\mathcal{F}^+(U_{i, 0})$. By construction of
$\mathcal{F}^+$ there exist coverings $\{U_{i, 0, j} \to U_{i, 0}\}$
such that $\sigma_i|_{U_{i, 0, j}}$ is zero. By our construction of
the topology on $\mathcal{C}$ we can write $U_{i, 0, j} \to U_{i, 0}$
as the pullback (Categories, Definition
\ref{categories-definition-pullback-functor-fibred-category})
of some morphisms $V_{i, j} \to V$ and moreover each
$\{V_{i, j} \to V\}$ is a covering. Choose a covering
$\{V_j \to V\}$ dominating each of the coverings $\{V_{i, j} \to V\}$.
Then it is clear that $\xi|_{V_j} = 0$.

\medskip\noindent
Surjectivity. Proof omitted. Hint: Argue as in the proof of
injectivity.
\end{proof}

\begin{lemma}
\label{lemma-compute-left-derived-pi-shriek}
Assumptions and notation as in Situation \ref{situation-fibred-category}.
For $\mathcal{F}$ in $\textit{Ab}(\mathcal{C})$ and $n \geq 0$
the sheaf $L_n\pi_!(\mathcal{F})$ is equal to the sheaf
$L_n(\mathcal{F})$ constructed in
Lemma \ref{lemma-compute-left-derived-pi-shriek-pre}.
\end{lemma}

\begin{proof}
Consider the sequence of functors $\mathcal{F} \mapsto L_n(\mathcal{F})$
from $\textit{PAb}(\mathcal{C}) \to \textit{Ab}(\mathcal{C})$.
Since for each $V \in \Ob(\mathcal{D})$ the sequence of functors
$H_n(\mathcal{C}_V, - )$ forms a $\delta$-functor
so do the functors $\mathcal{F} \mapsto L_n(\mathcal{F})$.
Our goal is to show these form a universal $\delta$-functor.
In order to do this we construct some abelian presheaves
on which these functors vanish.

\medskip\noindent
For $U' \in \Ob(\mathcal{C})$ consider the abelian presheaf
$\mathcal{F}_{U'} = j_{U'!}^{\textit{PAb}}\mathbf{Z}_{U'}$
(Modules on Sites, Remark \ref{sites-modules-remark-localize-presheaves}).
Recall that
$$
\mathcal{F}_{U'}(U) =
\bigoplus\nolimits_{\Mor_\mathcal{C}(U, U')} \mathbf{Z}
$$
If $U$ lies over $V = p(U)$ in $\mathcal{D})$ and $U'$ lies over $V' = p(U')$
then any morphism $a : U \to U'$ factors uniquely as $U \to h^*U' \to U'$
where $h = p(a) : V \to V'$ (see
Categories, Definition
\ref{categories-definition-pullback-functor-fibred-category}).
Hence we see that
$$
\mathcal{F}_{U'}|_{\mathcal{C}_V}
=
\bigoplus\nolimits_{h \in \Mor_\mathcal{D}(V, V')}
j_{h^*U'!}\mathbf{Z}_{h^*U'}
$$
where $j_{h^*U'} : \Sh(\mathcal{C}_V/h^*U') \to \Sh(\mathcal{C}_V)$
is the localization morphism. The sheaves $j_{h^*U'!}\mathbf{Z}_{h^*U'}$
have vanishing higher homology groups (see
Example \ref{example-left-derived-colimits}).
We conclude that $L_n(\mathcal{F}_{U'}) = 0$ for all $n > 0$ and all $U'$.
It follows that any abelian presheaf $\mathcal{F}$ is a quotient
of an abelian presheaf $\mathcal{G}$ with $L_n(\mathcal{G}) = 0$ for
all $n > 0$ (Modules on Sites, Lemma
\ref{sites-modules-lemma-module-quotient-flat}).
Since $L_n(\mathcal{F}) = L_n(\mathcal{F}^\#)$ we see
that the same thing is true for abelian sheaves. Thus
the sequence of functors $L_n(-)$ is a universal delta functor
on $\textit{Ab}(\mathcal{C})$
(Homology, Lemma \ref{homology-lemma-efface-implies-universal}).
Since we have agreement with
$H^{-n}(L\pi_!(-))$ for $n = 0$ by
Lemma \ref{lemma-compute-pi-shriek}
we conclude by uniqueness of universal $\delta$-functors
(Homology, Lemma \ref{homology-lemma-uniqueness-universal-delta-functor})
and
Derived Categories, Lemma \ref{derived-lemma-right-derived-delta-functor}.
\end{proof}

\begin{lemma}
\label{lemma-compute-left-derived-g-shriek}
Assumptions and notation as in
Situation \ref{situation-morphism-fibred-categories}.
For an abelian sheaf $\mathcal{F}'$ on $\mathcal{C}'$ the sheaf
$L_ng_!(\mathcal{F}')$ is the sheaf associated to the presheaf
$$
U \longmapsto H_n(\mathcal{I}_U, \mathcal{F}'_U)
$$
For notation and restriction maps see proof.
\end{lemma}

\begin{proof}
Say $p(U) = V$. The category $\mathcal{I}_U$ is the category of pairs
$(U', \varphi)$ where $\varphi : U \to u(U')$ is a morphism of $\mathcal{C}$
with $p(\varphi) = \text{id}_V$, i.e., $\varphi$ is a morphism of the
fibre category $\mathcal{C}_V$. Morphisms
$(U'_1, \varphi_1) \to (U'_2, \varphi_2)$ are given by morphisms
$a : U'_1 \to U'_2$ of the fibre category $\mathcal{C}'_V$ such that
$\varphi_2 = u(a) \circ \varphi_1$. The presheaf $\mathcal{F}'_U$ sends
$(U', \varphi)$ to $\mathcal{F}'(U')$.
We will construct the restriction mappings below.

\medskip\noindent
Choose a factorization
$$
\xymatrix{
\mathcal{C}' \ar@<1ex>[r]^{u'} &
\mathcal{C}'' \ar[r]^{u''} \ar@<1ex>[l]^w & \mathcal{C}
}
$$
of $u$ as in
Categories, Lemma \ref{categories-lemma-ameliorate-morphism-fibred-categories}.
Then $g_! = g''_! \circ g'_!$ and similarly for derived functors.
On the other hand, the functor $g'_!$ is exact, see
Modules on Sites, Lemma \ref{sites-modules-lemma-have-left-adjoint}.
Thus we get $Lg_!(\mathcal{F}') = Lg''_!(\mathcal{F}'')$ where
$\mathcal{F}'' = g'_!\mathcal{F}'$. Note that
$\mathcal{F}'' = h^{-1}\mathcal{F}'$ where
$h : \Sh(\mathcal{C}'') \to \Sh(\mathcal{C}')$ is the morphism of topoi
associated to $w$, see
Sites, Lemma \ref{sites-lemma-have-left-adjoint}.
The functor $u''$ turns $\mathcal{C}''$ into a fibred category
over $\mathcal{C}$, hence
Lemma \ref{lemma-compute-left-derived-pi-shriek}
applies to the computation of $L_ng''_!$. The result follows as the
construction of $\mathcal{C}''$ in the proof of
Categories, Lemma \ref{categories-lemma-ameliorate-morphism-fibred-categories}
shows that the fibre category $\mathcal{C}''_U$ is equal to
$\mathcal{I}_U$. Moreover, $h^{-1}\mathcal{F}'|_{\mathcal{C}''_U}$
is given by the rule described above
(as $w$ is continuous and cocontinuous by
Stacks, Lemma \ref{stacks-lemma-topology-inherited-functorial}
so we may apply
Sites, Lemma \ref{sites-lemma-when-shriek}).
\end{proof}








\section{Simplicial modules}
\label{section-simplicial-modules}

\noindent
Let $A_\bullet$ be a simplicial ring. Recall that we may think of $A_\bullet$
as a sheaf on $\Delta$ (endowed with the chaotic topology), see
Simplicial, Section \ref{simplicial-section-simplicial-presheaves}.
Then a simplicial module $M_\bullet$ over $A_\bullet$ is just a sheaf of
$A_\bullet$-modules on $\Delta$. In other words, for every $n \geq 0$ we have
an $A_n$-module $M_n$ and for every map $\varphi : [n] \to [m]$ we have
a corresponding map
$$
M_\bullet(\varphi) : M_m \longrightarrow M_n
$$
which is $A_\bullet(\varphi)$-linear such that these maps compose in the
usual manner.

\medskip\noindent
Let $\mathcal{C}$ be a site. A {\it simplicial sheaf of rings}
$\mathcal{A}_\bullet$ on $\mathcal{C}$
is a simplicial object in the category of sheaves of rings on $\mathcal{C}$.
In this case the assignment $U \mapsto \mathcal{A}_\bullet(U)$ is a sheaf
of simplicial rings and in fact the two notions are equivalent.
A similar discussion holds for simplicial abelian sheaves, simplicial
sheaves of Lie algebras, and so on.

\medskip\noindent
However, as in the case of simplicial rings above, there is another way
to think about simplicial sheaves. Namely, consider the projection
$$
p : \Delta \times \mathcal{C} \longrightarrow \mathcal{C}
$$
This defines a fibred category with strongly cartesian morphisms
exactly the morphisms of the form $([n], U) \to ([n], V)$. We endow the category
$\Delta \times \mathcal{C}$ with the topology inherited from $\mathcal{C}$
(see Stacks, Section \ref{stacks-section-topology}). The simple description
of the coverings in $\Delta \times \mathcal{C}$
(Stacks, Lemma \ref{stacks-lemma-topology-inherited}) immediately
implies that a simplicial sheaf of rings on $\mathcal{C}$ is the
same thing as a sheaf of rings on $\Delta \times \mathcal{C}$.

\medskip\noindent
By analogy with the case of simplicial modules over a simplicial
ring, we define simplicial modules over simplicial sheaves of rings
as follows.

\begin{definition}
\label{definition-simplicial-module}
Let $\mathcal{C}$ be a site. Let $\mathcal{A}_\bullet$ be a simplicial
sheaf of rings on $\mathcal{C}$. A
{\it simplicial $\mathcal{A}_\bullet$-module} $\mathcal{F}_\bullet$
(sometimes called a
{\it simplicial sheaf of $\mathcal{A}_\bullet$-modules})
is a sheaf of modules over the sheaf of rings on $\Delta \times \mathcal{C}$
associated to $\mathcal{A}_\bullet$.
\end{definition}

\noindent
We obtain a category $\textit{Mod}(\mathcal{A}_\bullet)$ of
simplicial modules and a corresponding derived category
$D(\mathcal{A}_\bullet)$. Given a map
$\mathcal{A}_\bullet \to \mathcal{B}_\bullet$ of simplicial sheaves
of rings we obtain a functor
$$
- \otimes^\mathbf{L}_{\mathcal{A}_\bullet} \mathcal{B}_\bullet :
D(\mathcal{A}_\bullet)
\longrightarrow
D(\mathcal{B}_\bullet)
$$
Moreover, the material of the preceding sections determines a functor
$$
L\pi_! : D(\mathcal{A}_\bullet) \longrightarrow D(\mathcal{C})
$$
Given a simplicial module $\mathcal{F}_\bullet$ the object
$L\pi_!(\mathcal{F}_\bullet)$ is represented by the associated
chain complex $s(\mathcal{F}_\bullet)$
(Simplicial, Section \ref{simplicial-section-complexes}).
This follows from 
Lemmas \ref{lemma-compute-left-derived-pi-shriek} and
\ref{lemma-compute-by-cosimplicial-resolution}.

\begin{lemma}
\label{lemma-base-change-by-qis}
Let $\mathcal{C}$ be a site. Let $\mathcal{A}_\bullet \to \mathcal{B}_\bullet$
be a homomorphism of simplicial sheaves of rings on $\mathcal{C}$.
If $L\pi_!\mathcal{A}_\bullet \to L\pi_!\mathcal{B}_\bullet$ is an
isomorphism in $D(\mathcal{C})$, then we have
$$
L\pi_!(K) =
L\pi_!(K \otimes^\mathbf{L}_{\mathcal{A}_\bullet} \mathcal{B}_\bullet)
$$
for all $K$ in $D(\mathcal{A}_\bullet)$.
\end{lemma}

\begin{proof}
Let $([n], U)$ be an object of $\Delta \times \mathcal{C}$. Since $L\pi_!$
commutes with colimits, it suffices to prove this for bounded above complexes
of $\mathcal{O}$-modules (compare with argument of
Derived Categories, Proposition \ref{derived-proposition-left-derived-exists}
or just stick to bounded above complexes). Every such complex is
quasi-isomorphic to a bounded above complex whose terms are flat modules, see
Modules on Sites, Lemma \ref{sites-modules-lemma-module-quotient-flat}.
Thus it suffices to prove the lemma for a flat $\mathcal{A}_\bullet$-module
$\mathcal{F}$. In this case the derived tensor product is the usual
tensor product and is a sheaf also. Hence by
Lemma \ref{lemma-compute-left-derived-pi-shriek}
we can compute the cohomology
sheaves of both sides of the equation by the procedure of
Lemma \ref{lemma-compute-left-derived-pi-shriek-pre}.
Thus it suffices to prove the result for the restriction of
$\mathcal{F}$ to the fibre categories (i.e., to $\Delta \times U$).
In this case the result follows from Lemma \ref{lemma-O-homology-qis}.
\end{proof}

\begin{remark}
\label{remark-homology-augmentation}
Let $\mathcal{C}$ be a site. Let
$\epsilon : \mathcal{A}_\bullet \to \mathcal{O}$ be an augmentation
(Simplicial, Definition \ref{simplicial-definition-augmentation})
in the category of sheaves of rings.
Assume $\epsilon$ induces a quasi-isomorphism
$s(\mathcal{A}_\bullet) \to \mathcal{O}$.
In this case we obtain an exact functor of triangulated categories
$$
L\pi_! : D(\mathcal{A}_\bullet) \longrightarrow D(\mathcal{O})
$$
Namely, for any object $K$ of $D(\mathcal{A}_\bullet)$ we have
$L\pi_!(K) = L\pi_!(K \otimes_{\mathcal{A}_\bullet}^\mathbf{L} \mathcal{O})$
by Lemma \ref{lemma-base-change-by-qis}.
Thus we can define the displayed functor as the composition of
$- \otimes^\mathbf{L}_{\mathcal{A}_\bullet} \mathcal{O}$ with the functor
$L\pi_! : D(\Delta \times \mathcal{C}, \pi^{-1}\mathcal{O}) \to
D(\mathcal{O})$ of Remark \ref{remark-fibred-category}.
In other words, we obtain a $\mathcal{O}$-module structure on $L\pi_!(K)$
coming from the (canonical, functorial) identification of $L\pi_!(K)$ with
$L\pi_!(K \otimes_{\mathcal{A}_\bullet}^\mathbf{L} \mathcal{O})$ of the lemma.
\end{remark}






\section{Cohomology on a category}
\label{section-cohomology}

\noindent
In the situation of Example \ref{example-category-to-point}
in addition to the derived functor $L\pi_!$, we also have the functor
$R\pi_*$. For an abelian sheaf $\mathcal{F}$ on $\mathcal{C}$
we have $H_n(\mathcal{C}, \mathcal{F}) = H^{-n}(L\pi_!\mathcal{F})$
and $H^n(\mathcal{C}, \mathcal{F}) = H^n(R\pi_*\mathcal{F})$.

\begin{example}[Computing cohomology]
\label{example-right-derived-limits}
In Example \ref{example-category-to-point} we can compute
the functors $H^n(\mathcal{C}, -)$ as follows. Let
$\mathcal{F} \in \Ob(\textit{Ab}(\mathcal{C}))$.
Consider the cochain complex
$$
K^\bullet(\mathcal{F}) :
\prod\nolimits_{U_0} \mathcal{F}(U_0)
\to
\prod\nolimits_{U_0 \to U_1} \mathcal{F}(U_0)
\to
\prod\nolimits_{U_0 \to U_1 \to U_2} \mathcal{F}(U_0)
\to \ldots
$$
where the transition maps are given by
$$
(s_{U_0 \to U_1})
\longmapsto
((U_0 \to U_1 \to U_2) \mapsto s_{U_0 \to U_1} - s_{U_0 \to U_2}
+ s_{U_1 \to U_2}|_{U_0})
$$
and similarly in other degrees. By construction
$$
H^0(\mathcal{C}, \mathcal{F}) =
\lim_{\mathcal{C}^{opp}} \mathcal{F} =
H^0(K^\bullet(\mathcal{F})),
$$
see Categories, Lemma \ref{categories-lemma-limits-products-equalizers}.
The construction of $K^\bullet(\mathcal{F})$ is functorial in $\mathcal{F}$
and transforms short exact sequences of $\textit{Ab}(\mathcal{C})$ into
short exact sequences of complexes. Thus the sequence of functors
$\mathcal{F} \mapsto H^n(K^\bullet(\mathcal{F}))$ forms a $\delta$-functor, see
Homology, Definition \ref{homology-definition-cohomological-delta-functor} and
Lemma \ref{homology-lemma-long-exact-sequence-cochain}.
For an object $U$ of $\mathcal{C}$ denote $p_U : \Sh(*) \to \Sh(\mathcal{C})$
the corresponding point with $p_U^{-1}$ equal to evaluation at $U$, see
Sites, Example \ref{sites-example-indiscrete-points}.
Let $A$ be an abelian group and set $\mathcal{F} = p_{U, *}A$. In this case
the complex $K^\bullet(\mathcal{F})$ is the complex with terms
$\text{Map}(X_n, A)$ where
$$
X_n = \coprod\nolimits_{U_0 \to \ldots \to U_{n - 1} \to U_n}
\Mor_\mathcal{C}(U, U_0)
$$
This simplicial set is homotopy equivalent to the constant simplicial
set on a singleton $\{*\}$. Namely, the map $X_\bullet \to \{*\}$
is obvious, the map $\{*\} \to X_n$ is given
by mapping $*$ to $(U \to \ldots \to U, \text{id}_U)$, and the
maps
$$
h_{n, i} : X_n \longrightarrow X_n
$$
(Simplicial, Lemma \ref{simplicial-lemma-relations-homotopy})
defining the homotopy between the two maps $X_\bullet \to X_\bullet$
are given by the rule
$$
h_{n, i} :
(U_0 \to \ldots \to U_n, f)
\longmapsto
(U \to \ldots \to U \to U_i \to \ldots \to U_n, \text{id})
$$
for $i > 0$ and $h_{n, 0} = \text{id}$. Verifications omitted.
Since $\text{Map}(-, A)$ is a contravariant functor, implies that
$K^\bullet(p_{U, *}A)$ has trivial cohomology in positive degrees
(by the functoriality of
Simplicial, Remark \ref{simplicial-remark-homotopy-better}
and the result of
Simplicial, Lemma \ref{simplicial-lemma-homotopy-s-Q}).
This implies that $K^\bullet(\mathcal{F})$ is acyclic in positive
degrees also if $\mathcal{F}$ is a product of sheaves of the form
$p_{U, *}A$. As every abelian sheaf on $\mathcal{C}$ embeds
into such a product we conclude that $K^\bullet(\mathcal{F})$
computes the left derived functors
$H^n(\mathcal{C}, -)$ of $H^0(\mathcal{C}, -)$
for example by
Homology, Lemma \ref{homology-lemma-efface-implies-universal}
and
Derived Categories, Lemma \ref{derived-lemma-right-derived-delta-functor}.
\end{example}

\begin{example}[Computing Exts]
\label{example-computing-exts}
In Example \ref{example-category-to-point} assume we are moreover given
a sheaf of rings $\mathcal{O}$ on $\mathcal{C}$. Let
$\mathcal{F}$, $\mathcal{G}$ be $\mathcal{O}$-modules.
Consider the complex $K^\bullet(\mathcal{G}, \mathcal{F})$
with degree $n$ term
$$
\prod\nolimits_{U_0 \to U_1 \to \ldots \to U_n}
\Hom_{\mathcal{O}(U_n)}(\mathcal{G}(U_n), \mathcal{F}(U_0))
$$
and transition map given by
$$
(\varphi_{U_0 \to U_1})
\longmapsto
((U_0 \to U_1 \to U_2) \mapsto
\varphi_{U_0 \to U_1} \circ \rho^{U_2}_{U_1}
- \varphi_{U_0 \to U_2}
+ \rho^{U_1}_{U_0} \circ \varphi_{U_1 \to U_2}
$$
and similarly in other degrees. Here the $\rho$'s indicate restriction maps.
By construction
$$
\Hom_\mathcal{O}(\mathcal{G}, \mathcal{F}) =
H^0(K^\bullet(\mathcal{G}, \mathcal{F}))
$$
for all pairs of $\mathcal{O}$-modules $\mathcal{F}, \mathcal{G}$.
The assignment
$(\mathcal{G}, \mathcal{F}) \mapsto K^\bullet(\mathcal{G}, \mathcal{F})$
is a bifunctor which transforms direct sums in the first variable into
products and commutes with products in the second variable.
We claim that
$$
\text{Ext}^i_\mathcal{O}(\mathcal{G}, \mathcal{F}) =
H^i(K^\bullet(\mathcal{G}, \mathcal{F}))
$$
for $i \geq 0$ provided either
\begin{enumerate}
\item $\mathcal{G}(U)$ is a projective $\mathcal{O}(U)$-module
for all $U \in \Ob(\mathcal{C})$, or
\item $\mathcal{F}(U)$ is an injective $\mathcal{O}(U)$-module
for all $U \in \Ob(\mathcal{C})$.
\end{enumerate}
Namely, case (1) the functor $K^\bullet(\mathcal{G}, -)$
is an exact functor from the category of $\mathcal{O}$-modules
to the category of cochain complexes of abelian groups.
Thus, arguing as in Example \ref{example-right-derived-limits},
it suffices to show that $K^\bullet(\mathcal{G}, \mathcal{F})$
is acyclic in positive degrees when $\mathcal{F}$ is $p_{U, *}A$
for an $\mathcal{O}(U)$-module $A$.
Choose a short exact sequence
\begin{equation}
\label{equation-split}
0 \to \mathcal{G}' \to \bigoplus j_{U_i!}\mathcal{O}_{U_i} \to
\mathcal{G} \to 0
\end{equation}
see Modules on Sites, Lemma \ref{sites-modules-lemma-module-quotient-flat}.
Since (1) holds for the middle and right sheaves, it also holds for
$\mathcal{G}'$ and evaluating (\ref{equation-split})
on an object of $\mathcal{C}$
gives a split exact sequence of modules.
We obtain a short exact sequence of complexes
$$
0 \to
K^\bullet(\mathcal{G}, \mathcal{F}) \to
\prod K^\bullet(j_{U_i!}\mathcal{O}_{U_i}, \mathcal{F}) \to
K^\bullet(\mathcal{G}', \mathcal{F}) \to 0
$$
for any $\mathcal{F}$, in particular $\mathcal{F} = p_{U, *}A$.
On $H^0$ we obtain
$$
0 \to \Hom(\mathcal{G}, p_{U, *}A) \to
\Hom(\prod j_{U_i!}\mathcal{O}_{U_i}, p_{U, *}A) \to
\Hom(\mathcal{G}', p_{U, *}A) \to 0
$$
which is exact as
$\Hom(\mathcal{H}, p_{U, *}A) = \Hom_{\mathcal{O}(U)}(\mathcal{H}(U), A)$
and the sequence of sections of (\ref{equation-split}) over $U$ is split exact.
Thus we can use dimension shifting to see that it suffices to prove
$K^\bullet(j_{U'!}\mathcal{O}_{U'}, p_{U, *}A)$ is acyclic in positive
degrees for all $U, U' \in \Ob(\mathcal{C})$. In this case
$K^n(j_{U'!}\mathcal{O}_{U'}, p_{U, *}A)$ is equal to
$$
\prod\nolimits_{U \to U_0 \to U_1 \to \ldots \to U_n \to U'} A
$$
In other words, $K^\bullet(j_{U'!}\mathcal{O}_{U'}, p_{U, *}A)$
is the complex with terms $\text{Map}(X_\bullet, A)$ where
$$
X_n = \coprod\nolimits_{U_0 \to \ldots \to U_{n - 1} \to U_n}
\Mor_\mathcal{C}(U, U_0) \times \Mor_\mathcal{C}(U_n, U')
$$
This simplicial set is homotopy equivalent to the constant simplicial
set on a singleton $\{*\}$ as can be proved in exactly the same way
as the corresponding statement in Example \ref{example-right-derived-limits}.
This finishes the proof of the claim.

\medskip\noindent
The argument in case (2) is similar (but dual).
\end{example}










\section{Strictly perfect complexes}
\label{section-strictly-perfect}

\noindent
This section is the analogue of
Cohomology, Section \ref{cohomology-section-strictly-perfect}.

\begin{definition}
\label{definition-strictly-perfect}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{E}^\bullet$ be a complex of $\mathcal{O}$-modules.
We say $\mathcal{E}^\bullet$ is {\it strictly perfect}
if $\mathcal{E}^i$ is zero for all but finitely many $i$ and
$\mathcal{E}^i$ is a direct summand of a finite free
$\mathcal{O}$-module for all $i$.
\end{definition}

\noindent
Let $U$ be an object of $\mathcal{C}$. We will often say
``Let $\mathcal{E}^\bullet$ be a strictly perfect complex of
$\mathcal{O}_U$-modules'' to mean $\mathcal{E}^\bullet$ is a strictly perfect
complex of modules on the ringed site $(\mathcal{C}/U, \mathcal{O}_U)$, see
Modules on Sites, Definition
\ref{sites-modules-definition-localize-ringed-site}.

\begin{lemma}
\label{lemma-cone}
The cone on a morphism of strictly perfect complexes is
strictly perfect.
\end{lemma}

\begin{proof}
This is immediate from the definitions.
\end{proof}

\begin{lemma}
\label{lemma-tensor}
The total complex associated to the tensor product of two
strictly perfect complexes is strictly perfect.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-strictly-perfect-pullback}
Let $(f, f^\sharp) : (\mathcal{C}, \mathcal{O}_\mathcal{C}) \to
(\mathcal{D}, \mathcal{O}_\mathcal{D})$
be a morphism of ringed topoi. If $\mathcal{F}^\bullet$ is a strictly
perfect complex of $\mathcal{O}_\mathcal{D}$-modules, then
$f^*\mathcal{F}^\bullet$ is a strictly perfect complex of
$\mathcal{O}_\mathcal{C}$-modules.
\end{lemma}

\begin{proof}
We have seen in
Modules on Sites, Lemma \ref{sites-modules-lemma-global-pullback}
that the pullback of a finite free module is finite free. The functor
$f^*$ is additive functor hence preserves direct summands. The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-local-lift-map}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be an object of
$\mathcal{C}$. Given a solid diagram of $\mathcal{O}_U$-modules
$$
\xymatrix{
\mathcal{E} \ar@{..>}[dr] \ar[r] & \mathcal{F} \\
& \mathcal{G} \ar[u]_p
}
$$
with $\mathcal{E}$ a direct summand of a finite free
$\mathcal{O}_U$-module and $p$ surjective, then there exists a
covering $\{U_i \to U\}$ such that a dotted arrow
making the diagram commute exists over each $U_i$.
\end{lemma}

\begin{proof}
We may assume $\mathcal{E} = \mathcal{O}_U^{\oplus n}$ for some $n$.
In this case finding the dotted arrow is equivalent to lifting the
images of the basis elements in $\Gamma(U, \mathcal{F})$. This is
locally possible by the characterization of surjective maps of
sheaves (Sites, Section \ref{sites-section-sheaves-injective}).
\end{proof}

\begin{lemma}
\label{lemma-local-homotopy}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be an object
of $\mathcal{C}$.
\begin{enumerate}
\item Let $\alpha : \mathcal{E}^\bullet \to \mathcal{F}^\bullet$
be a morphism of complexes of $\mathcal{O}_U$-modules
with $\mathcal{E}^\bullet$ strictly perfect and $\mathcal{F}^\bullet$
acyclic. Then there exists a covering $\{U_i \to U\}$ such that each
$\alpha|_{U_i}$ is homotopic to zero.
\item Let $\alpha : \mathcal{E}^\bullet \to \mathcal{F}^\bullet$
be a morphism of complexes of $\mathcal{O}_U$-modules
with $\mathcal{E}^\bullet$ strictly perfect, $\mathcal{E}^i = 0$
for $i < a$, and $H^i(\mathcal{F}^\bullet) = 0$ for $i \geq a$.
Then there exists a covering $\{U_i \to U\}$ such that each
$\alpha|_{U_i}$ is homotopic to zero.
\end{enumerate}
\end{lemma}

\begin{proof}
The first statement follows from the second, hence we only prove (2).
We will prove this by induction on the length of the complex
$\mathcal{E}^\bullet$. If $\mathcal{E}^\bullet \cong \mathcal{E}[-n]$
for some direct summand $\mathcal{E}$ of a finite free
$\mathcal{O}$-module and integer $n \geq a$, then the result follows from
Lemma \ref{lemma-local-lift-map} and the fact that
$\mathcal{F}^{n - 1} \to \Ker(\mathcal{F}^n \to \mathcal{F}^{n + 1})$
is surjective by the assumed vanishing of $H^n(\mathcal{F}^\bullet)$.
If $\mathcal{E}^i$ is zero except for $i \in [a, b]$, then we have a
split exact sequence of complexes
$$
0 \to \mathcal{E}^b[-b] \to \mathcal{E}^\bullet \to
\sigma_{\leq b - 1}\mathcal{E}^\bullet \to 0
$$
which determines a distinguished triangle in
$K(\mathcal{O}_U)$. Hence an exact sequence
$$
\Hom_{K(\mathcal{O}_U)}(
\sigma_{\leq b - 1}\mathcal{E}^\bullet, \mathcal{F}^\bullet)
\to
\Hom_{K(\mathcal{O}_U)}(\mathcal{E}^\bullet, \mathcal{F}^\bullet)
\to
\Hom_{K(\mathcal{O}_U)}(\mathcal{E}^b[-b], \mathcal{F}^\bullet)
$$
by the axioms of triangulated categories. The composition
$\mathcal{E}^b[-b] \to \mathcal{F}^\bullet$ is homotopic to zero
on the members of a covering of $U$ by the above,
whence we may assume our map comes from an element in the
left hand side of the displayed exact sequence above. This element
is zero on the members of a covering of $U$ by induction hypothesis.
\end{proof}

\begin{lemma}
\label{lemma-lift-through-quasi-isomorphism}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be an object of
$\mathcal{C}$. Given a solid diagram of complexes of $\mathcal{O}_U$-modules
$$
\xymatrix{
\mathcal{E}^\bullet \ar@{..>}[dr] \ar[r]_\alpha & \mathcal{F}^\bullet \\
& \mathcal{G}^\bullet \ar[u]_f
}
$$
with $\mathcal{E}^\bullet$ strictly perfect, $\mathcal{E}^j = 0$ for
$j < a$ and $H^j(f)$ an isomorphism for $j > a$ and surjective for
$j = a$, then there exists a covering $\{U_i \to U\}$ and for each $i$
a dotted arrow over $U_i$ making the diagram commute up to homotopy.
\end{lemma}

\begin{proof}
Our assumptions on $f$ imply the cone $C(f)^\bullet$ has vanishing
cohomology sheaves in degrees $\geq a$.
Hence Lemma \ref{lemma-local-homotopy} guarantees there is a
covering $\{U_i \to U\}$ such that the composition
$\mathcal{E}^\bullet \to \mathcal{F}^\bullet \to C(f)^\bullet$
is homotopic to zero over $U_i$. Since
$$
\mathcal{G}^\bullet \to \mathcal{F}^\bullet \to C(f)^\bullet \to
\mathcal{G}^\bullet[1]
$$
restricts to a distinguished triangle in $K(\mathcal{O}_{U_i})$
we see that we can lift $\alpha|_{U_i}$ up to homotopy to a map
$\alpha_i : \mathcal{E}^\bullet|_{U_i} \to \mathcal{G}^\bullet|_{U_i}$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-local-actual}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be an object
of $\mathcal{C}$. Let $\mathcal{E}^\bullet$, $\mathcal{F}^\bullet$ be
complexes of $\mathcal{O}_U$-modules with $\mathcal{E}^\bullet$ strictly
perfect.
\begin{enumerate}
\item For any element
$\alpha \in \Hom_{D(\mathcal{O}_U)}(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$
there exists a covering $\{U_i \to U\}$ such that
$\alpha|_{U_i}$ is given by a morphism of complexes
$\alpha_i : \mathcal{E}^\bullet|_{U_i} \to \mathcal{F}^\bullet|_{U_i}$.
\item Given a morphism of complexes
$\alpha : \mathcal{E}^\bullet \to \mathcal{F}^\bullet$
whose image in the group
$\Hom_{D(\mathcal{O}_U)}(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$
is zero, there exists a covering $\{U_i \to U\}$ such that
$\alpha|_{U_i}$ is homotopic to zero.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1).
By the construction of the derived category we can find a quasi-isomorphism
$f : \mathcal{F}^\bullet \to \mathcal{G}^\bullet$ and a map of complexes
$\beta : \mathcal{E}^\bullet \to \mathcal{G}^\bullet$ such that
$\alpha = f^{-1}\beta$. Thus the result follows from
Lemma \ref{lemma-lift-through-quasi-isomorphism}.
We omit the proof of (2).
\end{proof}

\begin{lemma}
\label{lemma-Rhom-strictly-perfect}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{E}^\bullet$, $\mathcal{F}^\bullet$ be complexes
of $\mathcal{O}$-modules with $\mathcal{E}^\bullet$ strictly perfect.
Then the internal hom $R\SheafHom(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$
is represented by the complex $\mathcal{H}^\bullet$ with terms
$$
\mathcal{H}^n =
\bigoplus\nolimits_{n = p + q}
\SheafHom_\mathcal{O}(\mathcal{E}^{-q}, \mathcal{F}^p)
$$
and differential as described in Section \ref{section-internal-hom}.
\end{lemma}

\begin{proof}
Choose a quasi-isomorphism $\mathcal{F}^\bullet \to \mathcal{I}^\bullet$
into a K-injective complex. Let $(\mathcal{H}')^\bullet$ be the
complex with terms
$$
(\mathcal{H}')^n =
\prod\nolimits_{n = p + q}
\SheafHom_\mathcal{O}(\mathcal{L}^{-q}, \mathcal{I}^p)
$$
which represents $R\SheafHom(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$
by the construction in Section \ref{section-internal-hom}. It suffices
to show that the map
$$
\mathcal{H}^\bullet \longrightarrow (\mathcal{H}')^\bullet
$$
is a quasi-isomorphism. Given an object $U$ of $\mathcal{C}$ we have
by inspection
$$
H^0(\mathcal{H}^\bullet(U)) =
\Hom_{K(\mathcal{O}_U)}(\mathcal{E}^\bullet|_U, \mathcal{K}^\bullet|_U)
\to
H^0((\mathcal{H}')^\bullet(U)) =
\Hom_{D(\mathcal{O}_U)}(\mathcal{E}^\bullet|_U, \mathcal{K}^\bullet|_U)
$$
By Lemma \ref{lemma-local-actual} the sheafification of
$U \mapsto H^0(\mathcal{H}^\bullet(U))$
is equal to the sheafification of
$U \mapsto H^0((\mathcal{H}')^\bullet(U))$. A similar argument can be
given for the other cohomology sheaves. Thus $\mathcal{H}^\bullet$
is quasi-isomorphic to $(\mathcal{H}')^\bullet$ which proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-Rhom-complex-of-direct-summands-finite-free}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{E}^\bullet$, $\mathcal{F}^\bullet$ be complexes
of $\mathcal{O}$-modules with
\begin{enumerate}
\item $\mathcal{F}^n = 0$ for $n \ll 0$,
\item $\mathcal{E}^n = 0$ for $n \gg 0$, and
\item $\mathcal{E}^n$ isomorphic to a direct summand of a finite
free $\mathcal{O}$-module.
\end{enumerate}
Then the internal hom $R\SheafHom(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$
is represented by the complex $\mathcal{H}^\bullet$ with terms
$$
\mathcal{H}^n =
\bigoplus\nolimits_{n = p + q}
\SheafHom_\mathcal{O}(\mathcal{E}^{-q}, \mathcal{F}^p)
$$
and differential as described in Section \ref{section-internal-hom}.
\end{lemma}

\begin{proof}
Choose a quasi-isomorphism $\mathcal{F}^\bullet \to \mathcal{I}^\bullet$
where $\mathcal{I}^\bullet$ is a bounded below complex of injectives.
Note that $\mathcal{I}^\bullet$ is K-injective
(Derived Categories, Lemma
\ref{derived-lemma-bounded-below-injectives-K-injective}).
Hence the construction in Section \ref{section-internal-hom}
shows that
$R\SheafHom(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$ is 
represented by the complex $(\mathcal{H}')^\bullet$ with terms
$$
(\mathcal{H}')^n =
\prod\nolimits_{n = p + q}
\SheafHom_\mathcal{O}(\mathcal{E}^{-q}, \mathcal{I}^p) =
\bigoplus\nolimits_{n = p + q}
\SheafHom_\mathcal{O}(\mathcal{E}^{-q}, \mathcal{I}^p)
$$
(equality because there are only finitely many nonzero terms).
Note that $\mathcal{H}^\bullet$ is the total complex associated to
the double complex with terms
$\SheafHom_\mathcal{O}(\mathcal{E}^{-q}, \mathcal{F}^p)$
and similarly for $(\mathcal{H}')^\bullet$.
The natural map $(\mathcal{H}')^\bullet \to \mathcal{H}^\bullet$
comes from a map of double complexes.
Thus to show this map is a quasi-isomorphism, we may use the spectral
sequence of a double complex
(Homology, Lemma \ref{homology-lemma-first-quadrant-ss})
$$
{}'E_1^{p, q} =
H^p(\SheafHom_\mathcal{O}(\mathcal{E}^{-q}, \mathcal{F}^\bullet))
$$
converging to $H^{p + q}(\mathcal{H}^\bullet)$ and similarly for
$(\mathcal{H}')^\bullet$. To finish the proof of the lemma it
suffices to show that $\mathcal{F}^\bullet \to \mathcal{I}^\bullet$
induces an isomorphism
$$
H^p(\SheafHom_\mathcal{O}(\mathcal{E}, \mathcal{F}^\bullet))
\longrightarrow
H^p(\SheafHom_\mathcal{O}(\mathcal{E}, \mathcal{I}^\bullet))
$$
on cohomology sheaves whenever $\mathcal{E}$ is a direct summand of a
finite free $\mathcal{O}$-module. Since this is clear when $\mathcal{E}$
is finite free the result follows.
\end{proof}









\section{Pseudo-coherent modules}
\label{section-pseudo-coherent}

\noindent
In this section we discuss pseudo-coherent complexes.

\begin{definition}
\label{definition-pseudo-coherent}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $\mathcal{E}^\bullet$
be a complex of $\mathcal{O}$-modules. Let $m \in \mathbf{Z}$.
\begin{enumerate}
\item We say $\mathcal{E}^\bullet$ is {\it $m$-pseudo-coherent}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}$ and for each $i$ a morphism of complexes
$\alpha_i : \mathcal{E}_i^\bullet \to \mathcal{E}^\bullet|_{U_i}$
where $\mathcal{E}_i$ is a strictly perfect complex of
$\mathcal{O}_{U_i}$-modules and $H^j(\alpha_i)$ is an isomorphism
for $j > m$ and $H^m(\alpha_i)$ is surjective.
\item We say $\mathcal{E}^\bullet$ is {\it pseudo-coherent}
if it is $m$-pseudo-coherent for all $m$.
\item We say an object $E$ of $D(\mathcal{O})$ is
{\it $m$-pseudo-coherent} (resp.\ {\it pseudo-coherent})
if and only if it can be represented by a $m$-pseudo-coherent
(resp.\ pseudo-coherent) complex of $\mathcal{O}$-modules.
\end{enumerate}
\end{definition}

\noindent
If $\mathcal{C}$ has a final object $X$ which is quasi-compact
(i.e., every covering of $X$ can be refined by a finite covering),
then an $m$-pseudo-coherent object of $D(\mathcal{O})$ is in
$D^-(\mathcal{O})$. But this need not be the case in general.

\begin{lemma}
\label{lemma-pseudo-coherent-independent-representative}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $E$ be an object of $D(\mathcal{O})$.
\begin{enumerate}
\item If $\mathcal{C}$ has a final object $X$ and if there exist a covering
$\{U_i \to X\}$, strictly perfect complexes $\mathcal{E}_i^\bullet$ of
$\mathcal{O}_{U_i}$-modules, and
maps $\alpha_i : \mathcal{E}_i^\bullet \to E|_{U_i}$ in
$D(\mathcal{O}_{U_i})$ with $H^j(\alpha_i)$ an isomorphism for $j > m$
and $H^m(\alpha_i)$ surjective, then $E$ is $m$-pseudo-coherent.
\item If $E$ is $m$-pseudo-coherent, then any complex of $\mathcal{O}$-modules
representing $E$ is $m$-pseudo-coherent.
\item If for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}$ such that $E|_{U_i}$ is $m$-pseudo-coherent, then
$E$ is $m$-pseudo-coherent.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\mathcal{F}^\bullet$ be any complex representing $E$
and let $X$, $\{U_i \to X\}$, and $\alpha_i : \mathcal{E}_i \to E|_{U_i}$
be as in (1). We will show that $\mathcal{F}^\bullet$ is $m$-pseudo-coherent
as a complex, which will prove (1) and (2) in case $\mathcal{C}$ has a
final object. By Lemma \ref{lemma-local-actual}
we can after refining the covering $\{U_i \to X\}$
represent the maps $\alpha_i$ by maps of complexes
$\alpha_i : \mathcal{E}_i^\bullet \to \mathcal{F}^\bullet|_{U_i}$.
By assumption
$H^j(\alpha_i)$ are isomorphisms for $j > m$, and $H^m(\alpha_i)$
is surjective whence $\mathcal{F}^\bullet$ is
$m$-pseudo-coherent.

\medskip\noindent
Proof of (2). By the above we see that $\mathcal{F}^\bullet|_U$ is
$m$-pseudo-coherent as a complex of $\mathcal{O}_U$-modules for all
objects $U$ of $\mathcal{C}$. It is a formal consequence of the definitions
that $\mathcal{F}^\bullet$ is $m$-pseudo-coherent.

\medskip\noindent
Proof of (3). Follows from the definitions and
Sites, Definition \ref{sites-definition-site} part (2).
\end{proof}

\begin{lemma}
\label{lemma-pseudo-coherent-pullback}
Let $(f, f^\sharp) : (\mathcal{C}, \mathcal{O}_\mathcal{C}) \to
(\mathcal{D}, \mathcal{O}_\mathcal{D})$
be a morphism of ringed sites. Let $E$ be an object of
$D(\mathcal{O}_\mathcal{C})$. If $E$ is $m$-pseudo-coherent,
then $Lf^*E$ is $m$-pseudo-coherent.
\end{lemma}

\begin{proof}
Say $f$ is given by the functor $u : \mathcal{D} \to \mathcal{C}$.
Let $U$ be an object of $\mathcal{C}$. By
Sites, Lemma \ref{sites-lemma-morphism-of-sites-covering}
we can find a covering $\{U_i \to U\}$ and for each $i$ a morphism
$U_i \to u(V_i)$ for some object $V_i$ of $\mathcal{D}$.
By Lemma \ref{lemma-pseudo-coherent-independent-representative}
it suffices to show that $Lf^*E|_{U_i}$ is $m$-pseudo-coherent.
To do this it is enough to show that $Lf^*E|_{u(V_i)}$ is
$m$-pseudo-coherent, since $Lf^*E|_{U_i}$ is the restriction
of $Lf^*E|_{u(V_i)}$ to $\mathcal{C}/U_i$ (via
Modules on Sites, Lemma
\ref{sites-modules-lemma-relocalize}).
By the commutative diagram of
Modules on Sites, Lemma
\ref{sites-modules-lemma-localize-morphism-ringed-sites}
it suffices to prove the lemma for the morphism of ringed
sites $(\mathcal{C}/u(V_i), \mathcal{O}_{u(V_i)}) \to
(\mathcal{D}/V_i, \mathcal{O}_{V_i})$.
Thus we may assume $\mathcal{D}$ has a final object $Y$ such that
$X = u(Y)$ is a final object of $\mathcal{C}$.

\medskip\noindent
Let $\{V_i \to Y\}$ be a covering such that for each $i$ there exists
a strictly perfect complex $\mathcal{F}_i^\bullet$ of
$\mathcal{O}_{V_i}$-modules and a morphism
$\alpha_i : \mathcal{F}_i^\bullet \to E|_{V_i}$ of $D(\mathcal{O}_{V_i})$
such that $H^j(\alpha_i)$ is an isomorphism
for $j > m$ and $H^m(\alpha_i)$ is surjective.
Arguing as above it suffices to prove the result for
$(\mathcal{C}/u(V_i), \mathcal{O}_{u(V_i)}) \to
(\mathcal{D}/V_i, \mathcal{O}_{V_i})$. Hence we may assume that
there exists a strictly perfect complex $\mathcal{F}^\bullet$ of
$\mathcal{O}_\mathcal{D}$-modules and a morphism
$\alpha : \mathcal{F}^\bullet \to E$ of $D(\mathcal{O}_\mathcal{D})$
such that $H^j(\alpha)$ is an isomorphism
for $j > m$ and $H^m(\alpha)$ is surjective. In this case, choose
a distinguished triangle
$$
\mathcal{F}^\bullet \to E \to C \to \mathcal{F}^\bullet[1]
$$
The assumption on $\alpha$ means exactly that the cohomology sheaves
$H^j(C)$ are zero for all $j \geq m$. Applying $Lf^*$ we obtain
the distinguished triangle
$$
Lf^*\mathcal{F}^\bullet \to Lf^*E \to Lf^*C \to Lf^*\mathcal{F}^\bullet[1]
$$
By the construction of $Lf^*$ as a left derived functor we see that
$H^j(Lf^*C) = 0$ for $j \geq m$ (by the dual of Derived Categories, Lemma
\ref{derived-lemma-negative-vanishing}). Hence $H^j(Lf^*\alpha)$ is an
isomorphism for $j > m$ and $H^m(Lf^*\alpha)$ is surjective.
On the other hand, since
$\mathcal{F}^\bullet$ is a bounded above complex of flat
$\mathcal{O}_\mathcal{D}$-modules we see that
$Lf^*\mathcal{F}^\bullet = f^*\mathcal{F}^\bullet$.
Applying Lemma \ref{lemma-strictly-perfect-pullback} we conclude.
\end{proof}

\begin{lemma}
\label{lemma-cone-pseudo-coherent}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site and $m \in \mathbf{Z}$.
Let $(K, L, M, f, g, h)$ be a distinguished triangle in $D(\mathcal{O})$.
\begin{enumerate}
\item If $K$ is $(m + 1)$-pseudo-coherent and $L$ is $m$-pseudo-coherent
then $M$ is $m$-pseudo-coherent.
\item If $K$ anf $M$ are $m$-pseudo-coherent, then $L$ is $m$-pseudo-coherent.
\item If $L$ is $(m + 1)$-pseudo-coherent and $M$
is $m$-pseudo-coherent, then $K$ is $(m + 1)$-pseudo-coherent.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $U$ be an object of $\mathcal{C}$. Choose a covering
$\{U_i \to U\}$ and maps $\alpha_i : \mathcal{K}_i^\bullet \to K|_{U_i}$
in $D(\mathcal{O}_{U_i})$ with $\mathcal{K}_i^\bullet$ strictly perfect and
$H^j(\alpha_i)$ isomorphisms for $j > m + 1$ and surjective for $j = m + 1$.
We may replace $\mathcal{K}_i^\bullet$ by
$\sigma_{\geq m + 1}\mathcal{K}_i^\bullet$
and hence we may assume that $\mathcal{K}_i^j = 0$
for $j < m + 1$. After refining the covering we may choose
maps $\beta_i : \mathcal{L}_i^\bullet \to L|_{U_i}$ in $D(\mathcal{O}_{U_i})$
with $\mathcal{L}_i^\bullet$ strictly perfect such that
$H^j(\beta)$ is an isomorphism for $j > m$ and
surjective for $j = m$. By
Lemma \ref{lemma-lift-through-quasi-isomorphism}
we can, after refining the covering, find maps of complexes
$\gamma_i : \mathcal{K}^\bullet \to \mathcal{L}^\bullet$
such that the diagrams
$$
\xymatrix{
K|_{U_i} \ar[r] & L|_{U_i} \\
\mathcal{K}_i^\bullet \ar[u]^{\alpha_i} \ar[r]^{\gamma_i} &
\mathcal{L}_i^\bullet \ar[u]_{\beta_i}
}
$$
are commutative in $D(\mathcal{O}_{U_i})$ (this requires representing the
maps $\alpha_i$, $\beta_i$ and $K|_{U_i} \to L|_{U_i}$
by actual maps of complexes; some details omitted).
The cone $C(\gamma_i)^\bullet$ is strictly perfect (Lemma \ref{lemma-cone}).
The commutativity of the diagram implies that there exists a morphism
of distinguished triangles
$$
(\mathcal{K}_i^\bullet, \mathcal{L}_i^\bullet, C(\gamma_i)^\bullet)
\longrightarrow
(K|_{U_i}, L|_{U_i}, M|_{U_i}).
$$
It follows from the induced map on long exact cohomology sequences and
Homology, Lemmas \ref{homology-lemma-four-lemma} and
\ref{homology-lemma-five-lemma}
that $C(\gamma_i)^\bullet \to M|_{U_i}$ induces an isomorphism
on cohomology in degrees $> m$ and a surjection in degree $m$.
Hence $M$ is $m$-pseudo-coherent by
Lemma \ref{lemma-pseudo-coherent-independent-representative}.

\medskip\noindent
Assertions (2) and (3) follow from (1) by rotating the distinguished
triangle.
\end{proof}

\begin{lemma}
\label{lemma-tensor-pseudo-coherent}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K, L$ be objects
of $D(\mathcal{O})$.
\begin{enumerate}
\item If $K$ is $n$-pseudo-coherent and $H^i(K) = 0$ for $i > a$
and $L$ is $m$-pseudo-coherent and $H^j(L) = 0$ for $j > b$, then
$K \otimes_\mathcal{O}^\mathbf{L} L$ is $t$-pseudo-coherent
with $t = \max(m + a, n + b)$.
\item If $K$ and $L$ are pseudo-coherent, then
$K \otimes_\mathcal{O}^\mathbf{L} L$ is pseudo-coherent.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $U$ be an object of $\mathcal{C}$.
By replacing $U$ by the members of a covering
and replacing $\mathcal{C}$ by the localization $\mathcal{C}/U$
we may assume there exist strictly perfect complexes $\mathcal{K}^\bullet$
and $\mathcal{L}^\bullet$ and maps
$\alpha : \mathcal{K}^\bullet \to K$ and
$\beta : \mathcal{L}^\bullet \to L$ with $H^i(\alpha)$ and isomorphism
for $i > n$ and surjective for $i = n$ and with
$H^i(\beta)$ and isomorphism for $i > m$ and surjective for $i = m$.
Then the map
$$
\alpha \otimes^\mathbf{L} \beta :
\text{Tot}(\mathcal{K}^\bullet \otimes_\mathcal{O} \mathcal{L}^\bullet)
\to K \otimes_\mathcal{O}^\mathbf{L} L
$$
induces isomorphisms on cohomology sheaves in degree $i$ for
$i > t$ and a surjection for $i = t$. This follows from the
spectral sequence of tors (details omitted).

\medskip\noindent
Proof of (2). Let $U$ be an object of $\mathcal{C}$.
We may first replace $U$ by the members of a covering
and $\mathcal{C}$ by the localization $\mathcal{C}/U$
to reduce to the case that $K$ and $L$ are bounded above.
Then the statement follows immediately from case (1).
\end{proof}

\begin{lemma}
\label{lemma-summands-pseudo-coherent}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $m \in \mathbf{Z}$.
If $K \oplus L$ is $m$-pseudo-coherent (resp.\ pseudo-coherent)
in $D(\mathcal{O})$ so are $K$ and $L$.
\end{lemma}

\begin{proof}
Assume that $K \oplus L$ is $m$-pseudo-coherent. Let $U$ be an object of
$\mathcal{C}$. After replacing $U$ by the members of a covering we may
assume $K \oplus L \in D^-(\mathcal{O}_U)$, hence $L \in D^-(\mathcal{O}_U)$.
Note that there is a distinguished triangle
$$
(K \oplus L, K \oplus L, L \oplus L[1]) =
(K, K, 0) \oplus (L, L, L \oplus L[1])
$$
see
Derived Categories, Lemma \ref{derived-lemma-direct-sum-triangles}.
By
Lemma \ref{lemma-cone-pseudo-coherent}
we see that $L \oplus L[1]$ is $m$-pseudo-coherent.
Hence also $L[1] \oplus L[2]$ is $m$-pseudo-coherent.
By induction $L[n] \oplus L[n + 1]$ is $m$-pseudo-coherent.
Since $L$ is bounded above we see that $L[n]$ is $m$-pseudo-coherent
for large $n$. Hence working backwards, using the distinguished triangles
$$
(L[n], L[n] \oplus L[n - 1], L[n - 1])
$$
we conclude that $L[n - 1], L[n - 2], \ldots, L$ are $m$-pseudo-coherent
as desired.
\end{proof}

\begin{lemma}
\label{lemma-finite-cohomology}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K$ be an object of
$D(\mathcal{O})$. Let $m \in \mathbf{Z}$.
\begin{enumerate}
\item If $K$ is $m$-pseudo-coherent and $H^i(K) = 0$
for $i > m$, then $H^m(K)$ is a finite type $\mathcal{O}$-module.
\item If $K$ is $m$-pseudo-coherent and $H^i(K) = 0$
for $i > m + 1$, then $H^{m + 1}(K)$ is a finitely presented
$\mathcal{O}$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $U$ be an object of $\mathcal{C}$. We have to show that
$H^m(K)$ is can be generated by finitely many sections over the members of
a covering of $U$ (see
Modules on Sites, Definition \ref{sites-modules-definition-site-local}).
Thus during the proof we may (finitely often) choose a covering
$\{U_i \to U\}$ and replace $\mathcal{C}$ by $\mathcal{C}/U_i$ and
$U$ by $U_i$. In particular, by our definitions we may assume there exists
a strictly perfect complex $\mathcal{E}^\bullet$ and a map
$\alpha : \mathcal{E}^\bullet \to K$ which induces
an isomorphism on cohomology in degrees $> m$ and a surjection in degree $m$.
It suffices to prove the result for $\mathcal{E}^\bullet$.
Let $n$ be the largest integer such that $\mathcal{E}^n \not = 0$.
If $n = m$, then $H^m(\mathcal{E}^\bullet)$ is a quotient of
$\mathcal{E}^n$ and the result is clear.
If $n > m$, then $\mathcal{E}^{n - 1} \to \mathcal{E}^n$ is surjective as
$H^n(E^\bullet) = 0$. By Lemma \ref{lemma-local-lift-map}
we can (after replacing $U$ by the members of a covering)
find a section of this surjection and write
$\mathcal{E}^{n - 1} = \mathcal{E}' \oplus \mathcal{E}^n$.
Hence it suffices to prove the result for the complex
$(\mathcal{E}')^\bullet$ which is the same as $\mathcal{E}^\bullet$
except has $\mathcal{E}'$ in degree $n - 1$ and $0$ in degree $n$.
We win by induction on $n$.

\medskip\noindent
Proof of (2). Pick an object $U$ of $\mathcal{C}$.
As in the proof of (1) we may work locally on $U$.
Hence we may assume there exists a strictly perfect complex
$\mathcal{E}^\bullet$ and a map
$\alpha : \mathcal{E}^\bullet \to K$ which induces
an isomorphism on cohomology in degrees $> m$ and a surjection in degree $m$.
As in the proof of (1) we can reduce to the case that $\mathcal{E}^i = 0$
for $i > m + 1$. Then we see that
$H^{m + 1}(K) \cong H^{m + 1}(\mathcal{E}^\bullet) =
\Coker(\mathcal{E}^m \to \mathcal{E}^{m + 1})$
which is of finite presentation.
\end{proof}








\section{Tor dimension}
\label{section-tor}

\noindent
In this section we take a closer look at resolutions by flat modules.

\begin{definition}
\label{definition-tor-amplitude}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $E$ be an object of $D(\mathcal{O})$.
Let $a, b \in \mathbf{Z}$ with $a \leq b$.
\begin{enumerate}
\item We say $E$ has {\it tor-amplitude in $[a, b]$}
if $H^i(E \otimes_\mathcal{O}^\mathbf{L} \mathcal{F}) = 0$
for all $\mathcal{O}$-modules $\mathcal{F}$ and all $i \not \in [a, b]$.
\item We say $E$ has {\it finite tor dimension}
if it has tor-amplitude in $[a, b]$ for some $a, b$.
\item We say $E$ {\it locally has finite tor dimension} if for any
object $U$ of $\mathcal{C}$ there exists a covering $\{U_i \to U\}$
such that $E|_{U_i}$ has finite tor dimension for all $i$.
\end{enumerate}
\end{definition}

\noindent
Note that if $E$ has finite tor dimension, then $E$ is an object of
$D^b(\mathcal{O})$ as can be seen by taking $\mathcal{F} = \mathcal{O}$
in the definition above.

\begin{lemma}
\label{lemma-last-one-flat}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{E}^\bullet$ be a bounded above complex of flat
$\mathcal{O}$-modules with tor-amplitude in $[a, b]$.
Then $\Coker(d_{\mathcal{E}^\bullet}^{a - 1})$ is a flat
$\mathcal{O}$-module.
\end{lemma}

\begin{proof}
As $\mathcal{E}^\bullet$ is a bounded above complex of flat modules we see that
$\mathcal{E}^\bullet \otimes_\mathcal{O} \mathcal{F} =
\mathcal{E}^\bullet \otimes_\mathcal{O}^{\mathbf{L}} \mathcal{F}$
for any $\mathcal{O}$-module $\mathcal{F}$.
Hence for every $\mathcal{O}$-module $\mathcal{F}$ the sequence
$$
\mathcal{E}^{a - 2} \otimes_\mathcal{O} \mathcal{F} \to
\mathcal{E}^{a - 1} \otimes_\mathcal{O} \mathcal{F} \to
\mathcal{E}^a \otimes_\mathcal{O} \mathcal{F}
$$
is exact in the middle. Since
$\mathcal{E}^{a - 2} \to \mathcal{E}^{a - 1} \to \mathcal{E}^a \to
\Coker(d^{a - 1}) \to 0$
is a flat resolution this implies that
$\text{Tor}_1^\mathcal{O}(\Coker(d^{a - 1}), \mathcal{F}) = 0$
for all $\mathcal{O}$-modules $\mathcal{F}$. This means that
$\Coker(d^{a - 1})$ is flat, see Lemma \ref{lemma-flat-tor-zero}.
\end{proof}

\begin{lemma}
\label{lemma-tor-amplitude}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $E$ be an object of
$D(\mathcal{O})$. Let $a, b \in \mathbf{Z}$ with $a \leq b$. The following
are equivalent
\begin{enumerate}
\item $E$ has tor-amplitude in $[a, b]$.
\item $E$ is represented by a complex
$\mathcal{E}^\bullet$ of flat $\mathcal{O}$-modules with
$\mathcal{E}^i = 0$ for $i \not \in [a, b]$.
\end{enumerate}
\end{lemma}

\begin{proof}
If (2) holds, then we may compute
$E \otimes_\mathcal{O}^\mathbf{L} \mathcal{F} =
\mathcal{E}^\bullet \otimes_\mathcal{O} \mathcal{F}$
and it is clear that (1) holds.

\medskip\noindent
Assume that (1) holds. We may represent $E$ by a bounded above complex
of flat $\mathcal{O}$-modules $\mathcal{K}^\bullet$, see
Section \ref{section-flat}.
Let $n$ be the largest integer such that $\mathcal{K}^n \not = 0$.
If $n > b$, then $\mathcal{K}^{n - 1} \to \mathcal{K}^n$ is surjective as
$H^n(\mathcal{K}^\bullet) = 0$. As $\mathcal{K}^n$ is flat we see that
$\Ker(\mathcal{K}^{n - 1} \to \mathcal{K}^n)$ is flat
(Modules on Sites, Lemma \ref{sites-modules-lemma-flat-ses}).
Hence we may replace $\mathcal{K}^\bullet$ by
$\tau_{\leq n - 1}\mathcal{K}^\bullet$. Thus, by induction on $n$, we
reduce to the case that $K^\bullet$ is a complex of flat
$\mathcal{O}$-modules with $\mathcal{K}^i = 0$ for $i > b$.

\medskip\noindent
Set $\mathcal{E}^\bullet = \tau_{\geq a}\mathcal{K}^\bullet$.
Everything is clear except that $\mathcal{E}^a$ is flat
which follows immediately from Lemma \ref{lemma-last-one-flat}
and the definitions.
\end{proof}

\begin{lemma}
\label{lemma-tor-amplitude-pullback}
Let $(f, f^\sharp) : (\mathcal{C}, \mathcal{O}_\mathcal{C}) \to
(\mathcal{D}, \mathcal{O}_\mathcal{D})$
be a morphism of ringed sites. Assume $\mathcal{C}$ has enough points.
Let $E$ be an object of $D(\mathcal{O}_\mathcal{D})$.
If $E$ has tor amplitude in $[a, b]$,
then $Lf^*E$ has tor amplitude in $[a, b]$.
\end{lemma}

\begin{proof}
Assume $E$ has tor amplitude in $[a, b]$. By
Lemma \ref{lemma-tor-amplitude}
we can represent $E$ by a complex of
$\mathcal{E}^\bullet$ of flat $\mathcal{O}$-modules with
$\mathcal{E}^i = 0$ for $i \not \in [a, b]$. Then
$Lf^*E$ is represented by $f^*\mathcal{E}^\bullet$.
By Modules on Sites, Lemma \ref{sites-modules-lemma-pullback-flat}
the module $f^*\mathcal{E}^i$ are flat (this is where we need
the assumption on the existence of points).
Thus by Lemma \ref{lemma-tor-amplitude}
we conclude that $Lf^*E$ has tor amplitude in $[a, b]$.
\end{proof}

\begin{lemma}
\label{lemma-cone-tor-amplitude}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $(K, L, M, f, g, h)$ be a distinguished
triangle in $D(\mathcal{O})$. Let $a, b \in \mathbf{Z}$.
\begin{enumerate}
\item If $K$ has tor-amplitude in $[a + 1, b + 1]$ and
$L$ has tor-amplitude in $[a, b]$ then $M$ has
tor-amplitude in $[a, b]$.
\item If $K$ and $M$ have tor-amplitude in $[a, b]$, then
$L$ has tor-amplitude in $[a, b]$.
\item If $L$ has tor-amplitude in $[a + 1, b + 1]$
and $M$ has tor-amplitude in $[a, b]$, then
$K$ has tor-amplitude in $[a + 1, b + 1]$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: This just follows from the long exact cohomology sequence
associated to a distinguished triangle and the fact that
$- \otimes_\mathcal{O}^{\mathbf{L}} \mathcal{F}$
preserves distinguished triangles.
The easiest one to prove is (2) and the others follow from it by
translation.
\end{proof}

\begin{lemma}
\label{lemma-tensor-tor-amplitude}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K, L$ be objects of
$D(\mathcal{O})$. If $K$ has tor-amplitude in $[a, b]$ and
$L$ has tor-amplitude in $[c, d]$ then $K \otimes_\mathcal{O}^\mathbf{L} L$
has tor amplitude in $[a + c, b + d]$.
\end{lemma}

\begin{proof}
Omitted. Hint: use the spectral sequence for tors.
\end{proof}

\begin{lemma}
\label{lemma-summands-tor-amplitude}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $a, b \in \mathbf{Z}$.
For $K$, $L$ objects of $D(\mathcal{O})$ if $K \oplus L$ has tor
amplitude in $[a, b]$ so do $K$ and $L$.
\end{lemma}

\begin{proof}
Clear from the fact that the Tor functors are additive.
\end{proof}

\begin{lemma}
\label{lemma-bounded}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{I} \subset \mathcal{O}$ be a sheaf of ideals.
Let $K$ be an object of $D(\mathcal{O})$.
\begin{enumerate}
\item If $K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}$
is bounded above, then
$K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n$
is uniformly bounded above for all $n$.
\item If $K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}$
as an object of $D(\mathcal{O}/\mathcal{I})$ has tor amplitude in $[a, b]$,
then $K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n$
as an object of $D(\mathcal{O}/\mathcal{I}^n)$
has tor amplitude in $[a, b]$ for all $n$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Assume that
$K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}$
is bounded above, say
$H^i(K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}) = 0$
for $i > b$. Note that we have distinguished triangles
$$
K \otimes_\mathcal{O}^\mathbf{L}
\mathcal{I}^n/\mathcal{I}^{n + 1} \to
K \otimes_\mathcal{O}^\mathbf{L}
\mathcal{O}/\mathcal{I}^{n + 1} \to
K \otimes_\mathcal{O}^\mathbf{L}
\mathcal{O}/\mathcal{I}^n \to
K \otimes_\mathcal{O}^\mathbf{L}
\mathcal{I}^n/\mathcal{I}^{n + 1}[1]
$$
and that
$$
K \otimes_\mathcal{O}^\mathbf{L}
\mathcal{I}^n/\mathcal{I}^{n + 1} =
\left(
K \otimes_\mathcal{O}^\mathbf{L}
\mathcal{O}/\mathcal{I}\right)
\otimes_{\mathcal{O}/\mathcal{I}}^\mathbf{L}
\mathcal{I}^n/\mathcal{I}^{n + 1}
$$
By induction we conclude that
$H^i(K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n) = 0$
for $i > b$ for all $n$.

\medskip\noindent
Proof of (2). Assume $K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}$
as an object of $D(\mathcal{O}/\mathcal{I})$ has tor amplitude in $[a, b]$.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}/\mathcal{I}^n$-modules.
Then we have a finite filtration
$$
0 \subset \mathcal{I}^{n - 1}\mathcal{F} \subset \ldots
\subset \mathcal{I}\mathcal{F} \subset \mathcal{F}
$$
whose successive quotients are sheaves of $\mathcal{O}/\mathcal{I}$-modules.
Thus to prove that $K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n$
has tor amplitude in $[a, b]$ it suffices to show
$H^i(K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n
\otimes_{\mathcal{O}/\mathcal{I}^n}^\mathbf{L} \mathcal{G})$
is zero for $i \not \in [a, b]$ for all $\mathcal{O}/\mathcal{I}$-modules
$\mathcal{G}$. Since
$$
\left(K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n\right)
\otimes_{\mathcal{O}/\mathcal{I}^n}^\mathbf{L} \mathcal{G}
=
\left(K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}\right)
\otimes_{\mathcal{O}/\mathcal{I}}^\mathbf{L} \mathcal{G}
$$
for every sheaf of $\mathcal{O}/\mathcal{I}$-modules $\mathcal{G}$
the result follows.
\end{proof}










\section{Perfect complexes}
\label{section-perfect}

\noindent
In this section we discuss properties of perfect complexes on
ringed sites.

\begin{definition}
\label{definition-perfect}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{E}^\bullet$ be a complex of $\mathcal{O}$-modules.
We say $\mathcal{E}^\bullet$ is {\it perfect} if for every object $U$ of
$\mathcal{C}$ there exists a covering $\{U_i \to U\}$ such that for each $i$
there exists a morphism of complexes
$\mathcal{E}_i^\bullet \to \mathcal{E}^\bullet|_{U_i}$
which is a quasi-isomorphism with $\mathcal{E}_i^\bullet$
strictly perfect.
An object $E$ of of $D(\mathcal{O})$ is {\it perfect}
if it can be represented by a perfect complex of $\mathcal{O}$-modules.
\end{definition}

\begin{lemma}
\label{lemma-perfect-independent-representative}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $E$ be an object of $D(\mathcal{O})$.
\begin{enumerate}
\item If $\mathcal{C}$ has a final object $X$ and there exist a
covering $\{U_i \to X\}$, strictly perfect complexes $\mathcal{E}_i^\bullet$
of $\mathcal{O}_{U_i}$-modules, and isomorphisms
 $\alpha_i : \mathcal{E}_i^\bullet \to E|_{U_i}$ in
$D(\mathcal{O}_{U_i})$, then $E$ is perfect.
\item If $E$ is perfect, then any complex representing $E$ is perfect.
\end{enumerate}
\end{lemma}

\begin{proof}
Identical to the proof of
Lemma \ref{lemma-pseudo-coherent-independent-representative}.
\end{proof}

\begin{lemma}
\label{lemma-perfect-precise}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $E$ be an object of $D(\mathcal{O})$.
Let $a \leq b$ be integers. If $E$ has tor amplitude in $[a, b]$
and is $(a - 1)$-pseudo-coherent, then $E$ is perfect.
\end{lemma}

\begin{proof}
Let $U$ be an object of $\mathcal{C}$. After replacing $U$ by the members
of a covering and $\mathcal{C}$ by the localization $\mathcal{C}/U$
we may assume there exists a strictly perfect complex $\mathcal{E}^\bullet$
and a map $\alpha : \mathcal{E}^\bullet \to E$ such that $H^i(\alpha)$ is
an isomorphism for $i \geq a$. We may and do replace
$\mathcal{E}^\bullet$ by $\sigma_{\geq a - 1}\mathcal{E}^\bullet$. Choose a
distinguished triangle
$$
\mathcal{E}^\bullet \to E \to C \to \mathcal{E}^\bullet[1]
$$
From the vanishing of cohomology sheaves of $E$ and $\mathcal{E}^\bullet$
and the assumption on $\alpha$ we obtain $C \cong \mathcal{K}[a - 2]$ with
$\mathcal{K} = \Ker(\mathcal{E}^{a - 1} \to \mathcal{E}^a)$.
Let $\mathcal{F}$ be an $\mathcal{O}$-module.
Applying $- \otimes_\mathcal{O}^\mathbf{L} \mathcal{F}$
the assumption that $E$ has tor amplitude in $[a, b]$
implies $\mathcal{K} \otimes_\mathcal{O} \mathcal{F} \to
\mathcal{E}^{a - 1} \otimes_\mathcal{O} \mathcal{F}$ has image
$\Ker(\mathcal{E}^{a - 1} \otimes_\mathcal{O} \mathcal{F}
\to \mathcal{E}^a \otimes_\mathcal{O} \mathcal{F})$.
It follows that $\text{Tor}_1^\mathcal{O}(\mathcal{E}', \mathcal{F}) = 0$
where $\mathcal{E}' = \Coker(\mathcal{E}^{a - 1} \to \mathcal{E}^a)$.
Hence $\mathcal{E}'$ is flat (Lemma \ref{lemma-flat-tor-zero}).
Thus there exists a covering $\{U_i \to U\}$ such that
$\mathcal{E}'|_{U_i}$ is a direct summand of a finite free module by
Modules on Sites, Lemma
\ref{sites-modules-lemma-flat-locally-finite-presentation}.
Thus the complex
$$
\mathcal{E}'|_{U_i} \to \mathcal{E}^{a - 1}|_{U_i} \to \ldots \to
\mathcal{E}^b|_{U_i}
$$
is quasi-isomorphic to $E|_{U_i}$ and $E$ is perfect.
\end{proof}

\begin{lemma}
\label{lemma-perfect}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $E$ be an object of $D(\mathcal{O})$.
The following are equivalent
\begin{enumerate}
\item $E$ is perfect, and
\item $E$ is pseudo-coherent and locally has finite tor dimension.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1). Let $U$ be an object of $\mathcal{C}$.
By definition there exists a covering $\{U_i \to U\}$ such that
$E|_{U_i}$ is represented by a strictly perfect complex.
Thus $E$ is pseudo-coherent (i.e., $m$-pseudo-coherent for all $m$) by
Lemma \ref{lemma-pseudo-coherent-independent-representative}.
Moreover, a direct summand of a finite free module is flat, hence
$E|_{U_i}$ has finite Tor dimension by
Lemma \ref{lemma-tor-amplitude}. Thus (2) holds.

\medskip\noindent
Assume (2). Let $U$ be an object of $\mathcal{C}$.
After replacing $U$ by the members of a covering
we may assume there exist integers $a \leq b$ such that $E|_U$
has tor amplitude in $[a, b]$. Since $E|_U$ is $m$-pseudo-coherent
for all $m$ we conclude using Lemma \ref{lemma-perfect-precise}.
\end{proof}

\begin{lemma}
\label{lemma-perfect-pullback}
Let $(f, f^\sharp) : (\mathcal{C}, \mathcal{O}_\mathcal{C}) \to
(\mathcal{D}, \mathcal{O}_\mathcal{D})$
be a morphism of ringed sites. Assume $\mathcal{C}$ has enough points.
Let $E$ be an object of $D(\mathcal{O}_\mathcal{D})$.
If $E$ is perfect in $D(\mathcal{O}_\mathcal{D})$,
then $Lf^*E$ is perfect in $D(\mathcal{O}_\mathcal{C})$.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-perfect},
\ref{lemma-tor-amplitude-pullback}, and
\ref{lemma-pseudo-coherent-pullback}.
(An alternative proof is to copy the proof of
Lemma \ref{lemma-pseudo-coherent-pullback}. This gives a proof
of the result without assuming the site $\mathcal{C}$ has enough points.)
\end{proof}

\begin{lemma}
\label{lemma-two-out-of-three-perfect}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $(K, L, M, f, g, h)$
be a distinguished triangle in $D(\mathcal{O})$. If two out of three of
$K, L, M$ are perfect then the third is also perfect.
\end{lemma}

\begin{proof}
First proof: Combine
Lemmas \ref{lemma-perfect}, \ref{lemma-cone-pseudo-coherent}, and
\ref{lemma-cone-tor-amplitude}.
Second proof (sketch): Say $K$ and $L$ are perfect. Let $U$ be an object
of $\mathcal{C}$. After replacing
$U$ by the members of a covering we may assume that $K|_U$ and $L|_U$
are represented by strictly perfect complexes $\mathcal{K}^\bullet$
and $\mathcal{L}^\bullet$. After replacing $U$ by the members
of a covering we may assume the map $K|_U \to L|_U$ is given by
a map of complexes $\alpha : \mathcal{K}^\bullet \to \mathcal{L}^\bullet$,
see Lemma \ref{lemma-local-actual}.
Then $M|_U$ is isomorphic to the cone of $\alpha$ which is strictly
perfect by Lemma \ref{lemma-cone}.
\end{proof}

\begin{lemma}
\label{lemma-tensor-perfect}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
If $K, L$ are perfect objects of $D(\mathcal{O})$, then
so is $K \otimes_\mathcal{O}^\mathbf{L} L$.
\end{lemma}

\begin{proof}
Follows from
Lemmas \ref{lemma-perfect}, \ref{lemma-tensor-pseudo-coherent}, and
\ref{lemma-tensor-tor-amplitude}.
\end{proof}

\begin{lemma}
\label{lemma-summands-perfect}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
If $K \oplus L$ is a perfect object of $D(\mathcal{O})$, then
so are $K$ and $L$.
\end{lemma}

\begin{proof}
Follows from
Lemmas \ref{lemma-perfect}, \ref{lemma-summands-pseudo-coherent}, and
\ref{lemma-summands-tor-amplitude}.
\end{proof}

\begin{lemma}
\label{lemma-dual-perfect-complex}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $K$ be a perfect object of $D(\mathcal{O})$.
Then $K^\vee = R\SheafHom(K, \mathcal{O})$ is a
perfect object too and $(K^\vee)^\vee = K$. There are
functorial isomorphisms
$$
K^\vee \otimes^\mathbf{L}_\mathcal{O} M = R\SheafHom_\mathcal{O}(K, M)
$$
and
$$
H^0(\mathcal{C}, K^\vee \otimes_\mathcal{O}^\mathbf{L} M) =
\Hom_{D(\mathcal{O})}(K, M)
$$
for $M$ in $D(\mathcal{O})$.
\end{lemma}

\begin{proof}
We will us without further mention that formation of internal hom commutes
with restriction (Lemma \ref{lemma-restriction-RHom-to-U}).
In particular we may check the first two statements locally, i.e., given
any object $U$ of $\mathcal{C}$ it suffices to prove there is a covering
$\{U_i \to U\}$ such that the statement is true after restricting to
$\mathcal{C}/U_i$ for each $i$.
By Lemma \ref{lemma-dual} to see the final statement it suffices to check
that the map (\ref{equation-eval})
$$
K^\vee \otimes^\mathbf{L}_\mathcal{O} M
\longrightarrow
R\SheafHom(K, M)
$$
is an isomorphism. This is a local question as well.
Hence it suffices to prove the lemma when $K$ is represented
by a strictly perfect complex.

\medskip\noindent
Assume $K$ is represented by the strictly perfect complex
$\mathcal{E}^\bullet$. Then it follows from
Lemma \ref{lemma-Rhom-strictly-perfect}
that $K^\vee$ is represented by the complex whose terms are
$(\mathcal{E}^n)^\vee =
\SheafHom_\mathcal{O}(\mathcal{E}^n, \mathcal{O})$
in degree $-n$. Since $\mathcal{E}^n$ is a direct summand of a finite
free $\mathcal{O}$-module, so is $(\mathcal{E}^n)^\vee$.
Hence $K^\vee$ is represented by a strictly perfect complex too.
It is also clear that $(K^\vee)^\vee = K$ as we have
$((\mathcal{E}^n)^\vee)^\vee = \mathcal{E}^n$.
To see that (\ref{equation-eval}) is an isomorphism, represent
$M$ by a K-flat complex $\mathcal{F}^\bullet$.
By Lemma \ref{lemma-Rhom-strictly-perfect} the complex
$R\SheafHom(K, M)$ is represented by the complex with terms
$$
\bigoplus\nolimits_{n = p + q}
\SheafHom_\mathcal{O}(\mathcal{E}^{-q}, \mathcal{F}^p)
$$
On the other hand, the object $K^\vee \otimes^\mathbf{L} M$
is represented by the complex with terms
$$
\bigoplus\nolimits_{n = p + q}
\mathcal{F}^p \otimes_\mathcal{O} (\mathcal{E}^{-q})^\vee
$$
Thus the assertion that (\ref{equation-eval}) is an isomorphism
reduces to the assertion that the canonical map
$$
\mathcal{F}
\otimes_\mathcal{O}
\SheafHom_\mathcal{O}(\mathcal{E}, \mathcal{O})
\longrightarrow
\SheafHom_\mathcal{O}(\mathcal{E}, \mathcal{F})
$$
is an isomorphism when $\mathcal{E}$ is a direct summand of a finite
free $\mathcal{O}$-module and $\mathcal{F}$ is any $\mathcal{O}$-module.
This follows immediately from the corresponding statement when
$\mathcal{E}$ is finite free.
\end{proof}

\begin{lemma}
\label{lemma-colim-and-lim-of-duals}
\begin{slogan}
Trivial duality for systems of perfect objects.
\end{slogan}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let
$(K_n)_{n \in \mathbf{N}}$ be a system of perfect objects of $D(\mathcal{O})$.
Let $K = \text{hocolim} K_n$ be the derived colimit
(Derived Categories, Definition \ref{derived-definition-derived-colimit}).
Then for any object $E$ of $D(\mathcal{O})$ we have
$$
R\SheafHom(K, E) = R\lim E \otimes^\mathbf{L}_\mathcal{O} K_n^\vee
$$
where $(K_n^\vee)$ is the inverse system of dual perfect complexes.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-dual-perfect-complex} we have
$R\lim E \otimes^\mathbf{L}_\mathcal{O} K_n^\vee =
R\lim R\SheafHom(K_n, E)$
which fits into the distinguished triangle
$$
R\lim R\SheafHom(K_n, E) \to
\prod R\SheafHom(K_n, E) \to
\prod R\SheafHom(K_n, E)
$$
Because $K$ similarly fits into the distinguished triangle
$\bigoplus K_n \to \bigoplus K_n \to K$ it suffices to show that
$\prod R\SheafHom(K_n, E) = R\SheafHom(\bigoplus K_n, E)$.
This is a formal consequence of (\ref{equation-internal-hom})
and the fact that derived tensor product commutes with direct sums.
\end{proof}




\section{Projection formula}
\label{section-projection-formula}

\noindent
Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi.
Let $E \in D(\mathcal{O}_\mathcal{C})$ and $K \in D(\mathcal{O}_\mathcal{D})$.
Without any further assumptions there is a map
\begin{equation}
\label{equation-projection-formula-map}
Rf_*E \otimes^\mathbf{L}_{\mathcal{O}_\mathcal{D}} K
\longrightarrow
Rf_*(E \otimes^\mathbf{L}_{\mathcal{O}_\mathcal{C}} Lf^*K)
\end{equation}
Namely, it is the adjoint to the canonical map
$$
Lf^*(Rf_*E \otimes^\mathbf{L}_{\mathcal{O}_\mathcal{D}} K) =
Lf^*Rf_*E \otimes^\mathbf{L}_{\mathcal{O}_\mathcal{C}} Lf^*K
\longrightarrow
E \otimes^\mathbf{L}_{\mathcal{O}_\mathcal{C}} Lf^*K
$$
coming from the map $Lf^*Rf_*E \to E$ and Lemmas
\ref{lemma-pullback-tensor-product} and \ref{lemma-adjoint}.
A reasonably general version of the projection formula is the following.

\begin{lemma}
\label{lemma-projection-formula}
Let $f : (\Sh(\mathcal{C}), \mathcal{O}_\mathcal{C}) \to
(\Sh(\mathcal{D}), \mathcal{O}_\mathcal{D})$ be a morphism of ringed topoi.
Let $E \in D(\mathcal{O}_\mathcal{C})$ and $K \in D(\mathcal{O}_\mathcal{D})$.
If $K$ is perfect, then
$$
Rf_*E \otimes^\mathbf{L}_{\mathcal{O}_\mathcal{D}} K =
Rf_*(E \otimes^\mathbf{L}_{\mathcal{O}_\mathcal{C}} Lf^*K)
$$
in $D(\mathcal{O}_\mathcal{D})$.
\end{lemma}

\begin{proof}
To check (\ref{equation-projection-formula-map}) is an isomorphism
we may work locally on $\mathcal{D}$, i.e.,
for any object $V$ of $\mathcal{D}$ we have to find a covering $\{V_j \to V\}$
such that the map restricts to an isomorphism on $V_j$. By definition
of perfect objects, this means we may assume $K$ is represented by
a strictly perfect complex of $\mathcal{O}_\mathcal{D}$-modules.
Note that, completely generally, the statement is true for
$K = K_1 \oplus K_2$, if and only if the statement is true for
$K_1$ and $K_2$. Hence we may assume $K$ is a finite
complex of finite free $\mathcal{O}_\mathcal{D}$-modules.
In this case a simple argument involving stupid truncations reduces
the statement to the case where $K$ is represented by a finite
free $\mathcal{O}_\mathcal{D}$-module. Since the statement is invariant
under finite direct summands in the $K$ variable, we conclude
it suffices to prove it for $K = \mathcal{O}_\mathcal{D}[n]$
in which case it is trivial.
\end{proof}



\section{Weakly contractible objects}
\label{section-w-contractible}

\noindent
An object $U$ of a site is {\it weakly contractible} if every surjection
$\mathcal{F} \to \mathcal{G}$ of sheaves of sets gives rise to a surjection
$\mathcal{F}(U) \to \mathcal{G}(U)$, see
Sites, Definition \ref{sites-definition-w-contractible}.

\begin{lemma}
\label{lemma-w-contractible}
Let $\mathcal{C}$ be a site. Let $U$ be a weakly contractible
object of $\mathcal{C}$. Then
\begin{enumerate}
\item the functor $\mathcal{F} \mapsto \mathcal{F}(U)$ is an exact
functor $\textit{Ab}(\mathcal{C}) \to \textit{Ab}$,
\item $H^p(U, \mathcal{F}) = 0$
for every abelian sheaf $\mathcal{F}$ and all $p \geq 1$, and
\item for any sheaf of groups $\mathcal{G}$ any $\mathcal{G}$-torsor
has a section over $U$.
\end{enumerate}
\end{lemma}

\begin{proof}
The first statement follows immediately from the definition
(see also Homology, Section \ref{homology-section-functors}).
The higher derived functors vanish by
Derived Categories, Lemma \ref{derived-lemma-right-derived-exact-functor}.
Let $\mathcal{F}$ be a $\mathcal{G}$-torsor. Then $\mathcal{F} \to *$
is a surjective map of sheaves. Hence (3) follows from the
definition as well.
\end{proof}

\noindent
It is convenient to list some consequences of having enough
weakly contractible objects here.

\begin{proposition}
\label{proposition-enough-weakly-contractibles}
Let $\mathcal{C}$ be a site. Let $\mathcal{B} \subset \Ob(\mathcal{C})$
such that every $U \in \mathcal{B}$ is weakly contractible and
every object of $\mathcal{C}$ has a covering by elements of $\mathcal{B}$.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$. Then
\begin{enumerate}
\item A complex $\mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3$
of $\mathcal{O}$-modules is exact, if and only if
$\mathcal{F}_1(U) \to \mathcal{F}_2(U) \to \mathcal{F}_3(U)$
is exact for all $U \in \mathcal{B}$.
\item Every object $K$ of $D(\mathcal{O})$ is a derived limit
of its canonical truncations: $K = R\lim \tau_{\geq -n} K$.
\item Given an inverse system
$\ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1$
with surjective transition maps, the projection
$\lim \mathcal{F}_n \to \mathcal{F}_1$ is surjective.
\item Products are exact on $\textit{Mod}(\mathcal{O})$.
\item Products on $D(\mathcal{O})$ can be computed by taking
products of any representative complexes.
\item If $(\mathcal{F}_n)$ is an inverse system of $\mathcal{O}$-modules,
then $R^p\lim \mathcal{F}_n = 0$ for all $p > 1$ and
$$
R^1\lim \mathcal{F}_n  =
\Coker(\prod \mathcal{F}_n \to \prod \mathcal{F}_n)
$$
where the map is $(x_n) \mapsto (x_n - f(x_{n + 1}))$.
\item If $(K_n)$ is an inverse system of objects of $D(\mathcal{O})$,
then there are short exact sequences
$$
0 \to R^1\lim H^{p - 1}(K_n) \to H^p(R\lim K_n) \to
\lim H^p(K_n) \to 0
$$
\end{enumerate}
\end{proposition}

\begin{proof}
Proof of (1). If the sequence is exact, then evaluating at any
weakly contractible element of $\mathcal{C}$ gives an exact
sequence by Lemma \ref{lemma-w-contractible}. Conversely, assume that
$\mathcal{F}_1(U) \to \mathcal{F}_2(U) \to \mathcal{F}_3(U)$
is exact for all $U \in \mathcal{B}$.
Let $V$ be an object of $\mathcal{C}$ and let
$s \in \mathcal{F}_2(V)$ be an element of the kernel of
$\mathcal{F}_2 \to \mathcal{F}_3$. By assumption there exists
a covering $\{U_i \to V\}$ with $U_i \in \mathcal{B}$.
Then $s|_{U_i}$ lifts to a section $s_i \in \mathcal{F}_1(U_i)$.
Thus $s$ is a section of the image sheaf
$\Im(\mathcal{F}_1 \to \mathcal{F}_2)$.
In other words, the sequence
$\mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3$
is exact.

\medskip\noindent
Proof of (2). This holds by Lemma \ref{lemma-is-limit}.

\medskip\noindent
Proof of (3). Let $(\mathcal{F}_n)$ be a system as in (2) and set
$\mathcal{F} = \lim \mathcal{F}_n$. If $U \in \mathcal{B}$, then
$\mathcal{F}(U) = \lim \mathcal{F}_n(U)$
surjects onto $\mathcal{F}_1(U)$ as all the transition maps
$\mathcal{F}_{n + 1}(U) \to \mathcal{F}_n(U)$ are surjective.
Thus $\mathcal{F} \to \mathcal{F}_1$ is surjective by
Sites, Definition \ref{sites-definition-sheaves-injective-surjective}
and the assumption that every object
has a covering by elements of $\mathcal{B}$.

\medskip\noindent
Proof of (4). Let
$\mathcal{F}_{i, 1} \to \mathcal{F}_{i, 2} \to \mathcal{F}_{i, 3}$
be a family of exact sequences of $\mathcal{O}$-modules.
We want to show that
$\prod \mathcal{F}_{i, 1} \to \prod \mathcal{F}_{i, 2} \to
\prod \mathcal{F}_{i, 3}$ is exact. We use the criterion of (1).
Let $U \in \mathcal{B}$. Then
$$
(\prod \mathcal{F}_{i, 1})(U) \to
(\prod \mathcal{F}_{i, 2})(U) \to
(\prod \mathcal{F}_{i, 3})(U)
$$
is the same as
$$
\prod \mathcal{F}_{i, 1}(U) \to
\prod \mathcal{F}_{i, 2}(U) \to
\prod \mathcal{F}_{i, 3}(U)
$$
Each of the sequences
$\mathcal{F}_{i, 1}(U) \to \mathcal{F}_{i, 2}(U) \to \mathcal{F}_{i, 3}(U)$
are exact by (1). Thus the displayed sequences are exact by
Homology, Lemma \ref{homology-lemma-product-abelian-groups-exact}.
We conclude by (1) again.

\medskip\noindent
Proof of (5). Follows from (4) and (slightly generalized)
Derived Categories, Lemma \ref{derived-lemma-products}.

\medskip\noindent
Proof of (6) and (7). We refer to Section \ref{section-derived-limits}
for a discussion of derived and homotopy limits and their relationship.
By Derived Categories, Definition \ref{derived-definition-derived-limit}
we have a distinguished
triangle
$$
R\lim K_n \to \prod K_n \to \prod K_n \to R\lim K_n[1]
$$
Taking the long exact sequence of cohomology sheaves we obtain
$$
H^{p - 1}(\prod K_n) \to H^{p - 1}(\prod K_n) \to
H^p(R\lim K_n) \to H^p(\prod K_n) \to H^p(\prod K_n)
$$
Since products are exact by (4) this becomes
$$
\prod H^{p - 1}(K_n) \to \prod H^{p - 1}(K_n) \to
H^p(R\lim K_n) \to \prod H^p(K_n) \to \prod H^p(K_n)
$$
Now we first apply this to the case $K_n = \mathcal{F}_n[0]$
where $(\mathcal{F}_n)$ is as in (6). We conclude that (6) holds.
Next we apply it to $(K_n)$ as in (7) and we conclude (7) holds.
\end{proof}






\section{Compact objects}
\label{section-compact}

\noindent
In this section we study compact objects in the derived category of modules
on a ringed site. We recall that compact objects are defined in
Derived Categories, Definition \ref{derived-definition-compact-object}.

\begin{lemma}
\label{lemma-perfect-is-compact}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Assume
$\mathcal{C}$ has the following properties
\begin{enumerate}
\item $\mathcal{C}$ has a quasi-compact final object $X$,
\item every object of $\mathcal{C}$ can be covered by quasi-compact objects,
\item for a finite covering $\{U_i \to U\}_{i \in I}$
with $U$, $U_i$ quasi-compact the fibre products $U_i \times_U U_j$ are
quasi-compact.
\end{enumerate}
Then any perfect object of $D(\mathcal{O})$ is compact.
\end{lemma}

\begin{proof}
Let $K$ be a perfect object and let $K^\vee$ be its dual, see
Lemma \ref{lemma-dual-perfect-complex}. Then we have
$$
\Hom_{D(\mathcal{O}_X)}(K, M) =
H^0(X, K^\vee \otimes_{\mathcal{O}_X}^\mathbf{L} M)
$$
functorially in $M$ in $D(\mathcal{O}_X)$. Since
$K^\vee \otimes_{\mathcal{O}_X}^\mathbf{L} -$ commutes with
direct sums (by construction) and $H^0$ does by
Lemma \ref{lemma-colim-works-over-collection}
and the construction of direct sums in
Injectives, Lemma \ref{injectives-lemma-derived-products}
we obtain the result of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-compact-in-terms-of-generators}
Let $\mathcal{A}$ be a Grothendieck abelian category. Let
$S \subset \Ob(\mathcal{A})$ be a set of objects such that
\begin{enumerate}
\item any object of $\mathcal{A}$ is a quotient of a direct sum
of elements of $S$, and
\item for any $E \in S$ the functor $\Hom_\mathcal{A}(E, -)$
commutes with direct sums.
\end{enumerate}
Then every compact object of $D(\mathcal{A})$ is a direct summand
in $D(\mathcal{A})$ of a finite complex of finite direct sums of
elements of $S$.
\end{lemma}

\begin{proof}
Assume $K \in D(\mathcal{A})$ is a compact object. Represent $K$ by a complex
$K^\bullet$ and consider the map
$$
K^\bullet
\longrightarrow
\bigoplus\nolimits_{n \geq 0} \tau_{\geq n} K^\bullet
$$
where we have used the canonical truncations, see
Homology, Section \ref{homology-section-truncations}.
This makes sense as in each degree the direct sum on the right is finite.
By assumption this map factors through a finite direct sum.
We conclude that $K \to \tau_{\geq n} K$ is zero for at least one $n$,
i.e., $K$ is in $D^{-}(R)$.

\medskip\noindent
We may represent $K$ by a bounded above complex $K^\bullet$ each of whose
terms is a direct sum of objects from $S$, see
Derived Categories, Lemma \ref{derived-lemma-subcategory-left-resolution}.
Note that we have
$$
K^\bullet = \bigcup\nolimits_{n \leq 0} \sigma_{\geq n}K^\bullet
$$
where we have used the stupid truncations, see
Homology, Section \ref{homology-section-truncations}.
Hence by Derived Categories, Lemmas \ref{derived-lemma-colim-hocolim} and
\ref{derived-lemma-commutes-with-countable-sums}
we see that $1 : K^\bullet \to K^\bullet$ factors through
$\sigma_{\geq n}K^\bullet \to K^\bullet$ in $D(R)$.
Thus we see that $1 : K^\bullet \to K^\bullet$ factors as
$$
K^\bullet \xrightarrow{\varphi} L^\bullet \xrightarrow{\psi} K^\bullet
$$
in $D(\mathcal{A})$ for some complex $L^\bullet$ which is bounded and
whose terms are direct sums of elements of $S$. Say $L^i$ is zero for
$i \not \in [a, b]$. Let $c$ be the largest integer $\leq b + 1$ such
that $L^i$ a finite direct sum of elements of $S$ for $i < c$.
Claim: if $c < b + 1$, then we can modify $L^\bullet$ to increase $c$.
By induction this claim will show we have a factorization
of $1_K$ as
$$
K \xrightarrow{\varphi} L \xrightarrow{\psi} K
$$
in $D(\mathcal{A})$ where $L$ can be represented by a finite
complex of finite direct sums of elements of $S$. Note that
$e = \varphi \circ \psi \in \text{End}_{D(\mathcal{A})}(L)$
is an idempotent. By Derived Categories,
Lemma \ref{derived-lemma-projectors-have-images-triangulated}
we see that $L = \Ker(e) \oplus \Ker(1 - e)$.
The map $\varphi : K \to L$ induces an isomorphism with
$\Ker(1 - e)$ in $D(R)$ and we conclude.

\medskip\noindent
Proof of the claim. Write $L^c = \bigoplus_{\lambda \in \Lambda} E_\lambda$.
Since $L^{c - 1}$ is a finite direct sum of elements of $S$
we can by assumption (2) find a finite subset
$\Lambda' \subset \Lambda$ such that $L^{c - 1} \to L^c$ factors
through $\bigoplus_{\lambda \in \Lambda'} E_\lambda \subset L^c$.
Consider the map of complexes
$$
\pi :
L^\bullet
\longrightarrow
(\bigoplus\nolimits_{\lambda \in \Lambda \setminus \Lambda'} E_\lambda)[-i]
$$
given by the projection onto the factors corresponding to
$\Lambda \setminus \Lambda'$ in degree $i$.
By our assumption on $K$ we see that, after possibly replacing $\Lambda'$ by
a larger finite subset, we may assume that $\pi \circ \varphi = 0$
in $D(\mathcal{A})$.
Let $(L')^\bullet \subset L^\bullet$ be the kernel of $\pi$.
Since $\pi$ is surjective we get a short exact sequence of complexes,
which gives a distinguished triangle in $D(\mathcal{A})$ (see
Derived Categories, Lemma \ref{derived-lemma-derived-canonical-delta-functor}).
Since $\Hom_{D(\mathcal{A})}(K, -)$ is homological (see
Derived Categories, Lemma \ref{derived-lemma-representable-homological})
and $\pi \circ \varphi = 0$, we can find a morphism
$\varphi' : K^\bullet \to (L')^\bullet$ in $D(\mathcal{A})$ whose
composition with $(L')^\bullet \to L^\bullet$ gives $\varphi$.
Setting $\psi'$ equal to the composition of $\psi$ with
$(L')^\bullet \to L^\bullet$ we obtain a new factorization.
Since $(L')^\bullet$ agrees with $L^\bullet$ except in degree $c$
and since $(L')^c = \bigoplus_{\lambda \in \Lambda'} E_\lambda$ the
claim is proved.
\end{proof}

\begin{lemma}
\label{lemma-compact-objects-if-enough-qc}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Assume every object of
$\mathcal{C}$ has a covering by quasi-compact objects. Then every
compact object of $D(\mathcal{O})$ is a direct summand in $D(\mathcal{O})$
of a finite complex whose terms are finite direct sums of
$\mathcal{O}$-modules of the form $j_!\mathcal{O}_U$
where $U$ is a quasi-compact object of $\mathcal{C}$.
\end{lemma}

\begin{proof}
Apply Lemma \ref{lemma-compact-in-terms-of-generators}
where $S \subset \Ob(\textit{Mod}(\mathcal{O}))$ is the set of modules
of the form $j_!\mathcal{O}_U$ with $U \in \Ob(\mathcal{C})$
quasi-compact. Assumption (1) holds by
Modules on Sites, Lemma \ref{sites-modules-lemma-module-quotient-flat}
and the assumption that every $U$ can be covered by quasi-compact
objects. Assumption (2) follows as
$$
\Hom_\mathcal{O}(j_!\mathcal{O}_U, \mathcal{F}) = \mathcal{F}(U)
$$
which commutes with direct sums by
Sites, Lemma \ref{sites-lemma-directed-colimits-sections}.
\end{proof}

\noindent
In the situation of the lemma above it is not always true that the
modules $j_!\mathcal{O}_U$ are compact objects of $D(\mathcal{O})$
(even if $U$ is a quasi-compact object of $\mathcal{C}$).
Here is a criterion.

\begin{lemma}
\label{lemma-when-jshriek-compact}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$ be an object of
$\mathcal{C}$. The $\mathcal{O}$-module
$j_!\mathcal{O}_U$ is a compact object of $D(\mathcal{O})$ if
there exists an integer $d$ such that
\begin{enumerate}
\item $H^p(U, \mathcal{F}) = 0$ for all $p > d$, and
\item the functors $\mathcal{F} \mapsto H^p(U, \mathcal{F})$
commute with direct sums.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1) and (2). The first means that the functor $F = H^0(U, -)$ has
finite cohomological dimension. Moreover, any direct sum of injective
modules is acyclic for $F$ by (2). Since we may compute $RF$ by
applying $F$ to any complex of acyclics
(Derived Categories, Lemma \ref{derived-lemma-unbounded-right-derived}).
Thus, if $K_i$ be a family of objects of $D(\mathcal{O})$,
then we can choose K-injective representatives $I_i^\bullet$
and we see that $\bigoplus K_i$ is represented by $\bigoplus I_i^\bullet$.
Thus $H^0(U, -)$ commutes with direct sums.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact-weakly-contractible-compact}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $U$
be an object of $\mathcal{C}$ which is quasi-compact and
weakly contractible. Then
$j_!\mathcal{O}_U$ is a compact object of $D(\mathcal{O})$.
\end{lemma}

\begin{proof}
Combine Lemmas \ref{lemma-when-jshriek-compact} and
\ref{lemma-w-contractible} with
Modules on Sites, Lemma \ref{sites-modules-lemma-sections-over-quasi-compact}.
\end{proof}






\section{Complexes with locally constant cohomology sheaves}
\label{section-locally-constant}

\noindent
Locally constant sheaves are introduced in
Modules on Sites, Section \ref{sites-modules-section-locally-constant}.
Let $\mathcal{C}$ be a site.
Let $\Lambda$ be a ring.
We denote $D(\mathcal{C}, \Lambda)$ the derived category of the
abelian category of $\underline{\Lambda}$-modules on $\mathcal{C}$.

\begin{lemma}
\label{lemma-locally-constant}
Let $\mathcal{C}$ be a site with final object $X$.
Let $\Lambda$ be a Noetherian ring.
Let $K \in D^b(\mathcal{C}, \Lambda)$
with $H^i(K)$ locally constant sheaves of $\Lambda$-modules
of finite type. Then there exists a covering $\{U_i \to X\}$
such that each $K|_{U_i}$ is represented by
a complex of locally constant sheaves of $\Lambda$-modules
of finite type.
\end{lemma}

\begin{proof}
Let $a \leq b$ be such that $H^i(K) = 0$ for $i \not \in [a, b]$.
By induction on $b - a$ we will prove there exists a covering
$\{U_i \to X\}$ such that $K|_{U_i}$ can be represented by a complex
$\underline{M^\bullet}_{U_i}$ with $M^p$ a finite type $\Lambda$-module
and $M^p = 0$ for $p \not \in [a, b]$. If $b = a$, then
this is clear. In general, we may replace $X$ by the members
of a covering and assume that $H^b(K)$ is constant, say
$H^b(K) = \underline{M}$. By Modules on Sites, Lemma
\ref{sites-modules-lemma-locally-constant-finite-type}
the module $M$ is a finite $\Lambda$-module. Choose a surjection
$\Lambda^{\oplus r} \to M$ given by generators $x_1, \ldots, x_r$
of $M$.

\medskip\noindent
By a slight generalization of
Lemma \ref{lemma-kill-cohomology-class-on-covering} (details omitted)
there exists a covering $\{U_i \to X\}$ such that $x_i \in H^0(X, H^b(K))$
lifts to an element of $H^b(U_i, K)$. Thus, after replacing $X$ by the
$U_i$ we reach the situation where there is a map
$\underline{\Lambda^{\oplus r}}[-b] \to K$
inducing a surjection on cohomology sheaves in degree $b$.
Choose a distinguished triangle
$$
\underline{\Lambda^{\oplus r}}[-b] \to K \to L \to
\underline{\Lambda^{\oplus r}}[-b + 1]
$$
Now the cohomology sheaves of $L$ are nonzero only in the interval
$[a, b - 1]$, agree with the cohomology sheaves of $K$ in the interval
$[a, b - 2]$ and there is a short exact sequence
$$
0 \to H^{b - 1}(K) \to H^{b - 1}(L) \to
\underline{\Ker(\Lambda^{\oplus r} \to M)} \to 0
$$
in degree $b - 1$. By
Modules on Sites, Lemma
\ref{sites-modules-lemma-kernel-finite-locally-constant}
we see that $H^{b - 1}(L)$ is locally constant of finite type.
By induction hypothesis we obtain an isomorphism
$\underline{M^\bullet} \to L$ in $D(\mathcal{C}, \underline{\Lambda})$
with $M^p$ a finite $\Lambda$-module and $M^p = 0$ for
$p \not \in [a, b - 1]$. The map $L \to \Lambda^{\oplus r}[-b + 1]$
gives a map $\underline{M^{b - 1}} \to \underline{\Lambda^{\oplus r}}$
which locally is constant
(Modules on Sites, Lemma
\ref{sites-modules-lemma-morphism-locally-constant}).
Thus we may assume it is given by a map $M^{b - 1} \to \Lambda^{\oplus r}$.
The distinguished triangle shows that the composition
$M^{b - 2} \to M^{b - 1} \to \Lambda^{\oplus r}$ is zero
and the axioms of triangulated categories produce an isomorphism
$$
\underline{M^a \to \ldots \to M^{b - 1} \to \Lambda^{\oplus r}}
\longrightarrow K
$$
in $D(\mathcal{C}, \Lambda)$.
\end{proof}

\noindent
Let $\mathcal{C}$ be a site. Let $\Lambda$ be a ring. Using the
morphism $\Sh(\mathcal{C}) \to \Sh(pt)$ we see that there is a
functor $D(\Lambda) \to D(\mathcal{C}, \Lambda)$, $K \mapsto \underline{K}$.

\begin{lemma}
\label{lemma-map-out-of-locally-constant}
Let $\mathcal{C}$ be a site with final object $X$. Let $\Lambda$ be a ring. Let
\begin{enumerate}
\item $K$ a perfect object of $D(\Lambda)$,
\item a finite complex $K^\bullet$ of finite projective $\Lambda$-modules
representing $K$,
\item $\mathcal{L}^\bullet$ a complex of sheaves of $\Lambda$-modules, and
\item $\varphi : \underline{K} \to \mathcal{L}^\bullet$ a map in
$D(\mathcal{C}, \Lambda)$.
\end{enumerate}
Then there exists a covering $\{U_i \to X\}$ and maps of complexes
$\alpha_i : \underline{K}^\bullet|_{U_i} \to \mathcal{L}^\bullet|_{U_i}$
representing $\varphi|_{U_i}$.
\end{lemma}

\begin{proof}
Follows immediately from Lemma \ref{lemma-local-actual}.
\end{proof}

\begin{lemma}
\label{lemma-locally-constant-map}
Let $\mathcal{C}$ be a site with final object $X$.
Let $\Lambda$ be a ring. Let $K, L$ be objects of
$D(\Lambda)$ with $K$ perfect. Let $\varphi : \underline{K} \to \underline{L}$
be map in $D(\mathcal{C}, \Lambda)$. There exists a covering $\{U_i \to X\}$
such that $\varphi|_{U_i}$ is equal to $\underline{\alpha_i}$
for some map $\alpha_i : K \to L$ in $D(\Lambda)$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-map-out-of-locally-constant} and
Modules on Sites, Lemma \ref{sites-modules-lemma-morphism-locally-constant}.
\end{proof}

\begin{lemma}
\label{lemma-locally-constant-tensor-product}
Let $\mathcal{C}$ be a site. Let $\Lambda$ be a Noetherian ring.
Let $K, L \in D^-(\mathcal{C}, \Lambda)$. If the cohomology sheaves of
$K$ and $L$ are locally constant sheaves of $\Lambda$-modules of
finite type, then the cohomology sheaves of
$K \otimes_\Lambda^\mathbf{L} L$
are locally constant sheaves of $\Lambda$-modules of finite type.
\end{lemma}

\begin{proof}
We'll prove this as an application of Lemma \ref{lemma-locally-constant}.
Note that $H^i(K \otimes_\Lambda^\mathbf{L} L)$ is the same as
$H^i(\tau_{\geq i - 1}K \otimes_\Lambda^\mathbf{L} \tau_{\geq i - 1}L)$.
Thus we may assume $K$ and $L$ are bounded. By
Lemma \ref{lemma-locally-constant}
we may assume that $K$ and $L$ are represented by
complexes of locally constant sheaves of $\Lambda$-modules
of finite type. Then we can replace these complexes by
bounded above complexes of finite free $\Lambda$-modules.
In this case the result is clear.
\end{proof}

\begin{lemma}
\label{lemma-locally-constant-bounded}
Let $\mathcal{C}$ be a site. Let $\Lambda$ be a Noetherian ring.
Let $I \subset \Lambda$ be an ideal.
Let $K \in D^-(\mathcal{C}, \Lambda)$. If the cohomology sheaves of
$K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I}$ are locally constant
sheaves of $\Lambda/I$-modules of finite type, then the cohomology sheaves of
$K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n}$
are locally constant sheaves of $\Lambda/I^n$-modules of finite type for all
$n \geq 1$.
\end{lemma}

\begin{proof}
Recall that the locally constant sheaves of $\Lambda$-modules of finite type
form a weak Serre subcategory of all $\underline{\Lambda}$-modules, see
Modules on Sites, Lemma
\ref{sites-modules-lemma-kernel-finite-locally-constant}.
Thus the subcategory of $D(\mathcal{C}, \Lambda)$ consisting of
complexes whose cohomology sheaves are locally constant sheaves
of $\Lambda$-modules of finite type forms a strictly full, saturated
triangulated subcategory of $D(\mathcal{C}, \Lambda)$, see
Derived Categories, Lemma \ref{derived-lemma-cohomology-in-serre-subcategory}.
Next, consider the distinguished triangles
$$
K \otimes_\Lambda^\mathbf{L} \underline{I^n/I^{n + 1}} \to
K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^{n + 1}} \to
K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n} \to
K \otimes_\Lambda^\mathbf{L} \underline{I^n/I^{n + 1}}[1]
$$
and the isomorphisms
$$
K \otimes_\Lambda^\mathbf{L} \underline{I^n/I^{n + 1}}
=
\left(K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I}\right)
\otimes_{\Lambda/I}^\mathbf{L} \underline{I^n/I^{n + 1}}
$$
Combined with Lemma \ref{lemma-locally-constant-tensor-product}
we obtain the result.
\end{proof}






\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
