\input{preamble}

% OK, start here.
%
\begin{document}

\title{Obsolete}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents




\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we put some lemmas that have become ``obsolete''
(see \cite{Miller}).


\section{Homological algebra}
\label{section-homological-algebra}

\begin{remark}
\label{remark-weak-serre-subcategory}
The following remarks are obsolete as they are subsumed in
Homology, Lemmas \ref{homology-lemma-biregular-ss-converges} and
\ref{homology-lemma-first-quadrant-ss}.
Let $\mathcal{A}$ be an abelian category.
Let $\mathcal{C} \subset \mathcal{A}$
be a weak Serre subcategory (see
Homology, Definition \ref{homology-definition-serre-subcategory}).
Suppose that $K^{\bullet, \bullet}$ is a double complex to which
Homology, Lemma \ref{homology-lemma-first-quadrant-ss}
applies such that for some $r \geq 0$ all the objects
${}'E_r^{p, q}$ belong to $\mathcal{C}$. Then all the cohomology groups
$H^n(sK^\bullet)$ belong to $\mathcal{C}$. Namely, the assumptions imply
that the kernels and images of ${}'d_r^{p, q}$ are in $\mathcal{C}$.
Whereupon we see that each ${}'E_{r + 1}^{p, q}$ is in $\mathcal{C}$.
By induction we see that each ${}'E_\infty^{p, q}$ is in $\mathcal{C}$.
Hence each $H^n(sK^\bullet)$ has a finite filtration whose subquotients
are in $\mathcal{C}$. Using that $\mathcal{C}$ is closed under extensions
we conclude that $H^n(sK^\bullet)$ is in $\mathcal{C}$ as claimed.
The same result holds for the second spectral sequence associated
to $K^{\bullet, \bullet}$. Similarly, if $(K^\bullet, F)$ is a filtered
complex to which
Homology, Lemma \ref{homology-lemma-biregular-ss-converges}
applies and for some $r \geq 0$ all the objects $E_r^{p, q}$
belong to $\mathcal{C}$, then each $H^n(K^\bullet)$ is
an object of $\mathcal{C}$.
\end{remark}




\section{Obsolete algebra lemmas}
\label{section-algebra}

\begin{lemma}
\label{lemma-finite-presentation-module-independent}
Let $M$ be an $R$-module of finite presentation.
For any surjection $\alpha : R^{\oplus n} \to M$ the
kernel of $\alpha$ is a finite $R$-module.
\end{lemma}

\begin{proof}
This is a special case of Algebra, Lemma \ref{algebra-lemma-extension}.
\end{proof}

\begin{lemma}
\label{lemma-p-ring-map}
Let $\varphi : R \to S$ be a ring map. If
\begin{enumerate}
\item for any $x \in S$ there exists $n > 0$ such that
$x^n$ is in the image of $\varphi$, and
\item for any $x \in \Ker(\varphi)$ there exists $n > 0$
such that $x^n = 0$,
\end{enumerate}
then $\varphi$ induces a homeomorphism on spectra. Given a
prime number $p$ such that
\begin{enumerate}
\item[(a)] $S$ is generated as an $R$-algebra by elements $x$ such
that there exists an $n > 0$ with $x^{p^n} \in \varphi(R)$ and
$p^nx \in \varphi(R)$, and
\item[(b)] the kernel of $\varphi$ is generated by nilpotent elements,
\end{enumerate}
then (1) and (2) hold, and for any ring map $R \to R'$
the ring map $R' \to R' \otimes_R S$ also satisfies (a), (b), (1), and (2)
and in particular induces a homeomorphism on spectra.
\end{lemma}

\begin{proof}
This is a combination of
Algebra, Lemmas \ref{algebra-lemma-powers} and
\ref{algebra-lemma-p-ring-map}.
\end{proof}

\noindent
The following technical lemma says that you can lift any sequence
of relations from a fibre to the whole space of a ring
map which is essentially of finite type, in a suitable sense.

\begin{lemma}
\label{lemma-lift-elements-ideal}
Let $R \to S$ be a ring map.
Let $\mathfrak p \subset R$ be a prime.
Let $\mathfrak q \subset S$ be a prime lying over $\mathfrak p$.
Assume $S_{\mathfrak q}$ is essentially of finite type over $R_\mathfrak p$.
Assume given
\begin{enumerate}
\item an integer $n \geq 0$,
\item a prime $\mathfrak a \subset \kappa(\mathfrak p)[x_1, \ldots, x_n]$,
\item a surjective $\kappa(\mathfrak p)$-homomorphism
$$
\psi : (\kappa(\mathfrak p)[x_1, \ldots, x_n])_{\mathfrak a}
\longrightarrow
S_{\mathfrak q}/\mathfrak p S_{\mathfrak q},
$$
and
\item elements $\overline{f}_1, \ldots, \overline{f}_e$ in $\Ker(\psi)$.
\end{enumerate}
Then there exist
\begin{enumerate}
\item an integer $m \geq 0$,
\item and element $g \in S$, $g \not\in \mathfrak q$,
\item a map
$$
\Psi :
R[x_1, \ldots, x_n, x_{n + 1}, \ldots, x_{n + m}]
\longrightarrow
S_g,
$$
and
\item elements $f_1, \ldots, f_e, f_{e + 1}, \ldots, f_{e + m}$
of $\Ker(\Psi)$
\end{enumerate}
such that
\begin{enumerate}
\item the following diagram commutes
$$
\xymatrix{
R[x_1, \ldots, x_{n + m}] \ar[d]_\Psi
\ar[rr]_-{x_{n + j} \mapsto 0} & &
(\kappa(\mathfrak p)[x_1, \ldots, x_n])_{\mathfrak a} \ar[d]^\psi \\
S_g \ar[rr] & &
S_{\mathfrak q}/\mathfrak p S_{\mathfrak q}
},
$$
\item the element $f_i$, $i \leq n$ maps to a unit times
$\overline{f}_i$ in the local ring
$$
(\kappa(\mathfrak p)[x_1, \ldots, x_{n + m}])_{
(\mathfrak a, x_{n + 1}, \ldots, x_{n + m})},
$$
\item the element $f_{e + j}$ maps to
a unit times $x_{n + j}$ in the same local ring, and
\item the induced map $R[x_1, \ldots, x_{n + m}]_{\mathfrak b}
\to S_{\mathfrak q}$ is surjective, where
$\mathfrak b = \Psi^{-1}(\mathfrak qS_g)$.
\end{enumerate}
\end{lemma}

\begin{proof}
We claim that it suffices to prove the lemma in case $R$
and $S$ are local with maximal ideals $\mathfrak p$ and $\mathfrak q$.
Namely, suppose we have constructed
$$
\Psi' : R_{\mathfrak p}[x_1, \ldots, x_{n + m}]
\longrightarrow
S_{\mathfrak q}
$$
and $f_1', \ldots, f_{e + m}' \in R_{\mathfrak p}[x_1, \ldots, x_{n + m}]$
with all the required properties. Then there exists an element
$f \in R$, $f \not \in \mathfrak p$ such that each
$ff_k'$ comes from an element $f_k \in R[x_1, \ldots, x_{n + m}]$.
Moreover, for a suitable $g \in S$, $g \not \in \mathfrak q$
the elements $\Psi'(x_i)$ are the image of elements
$y_i \in S_g$. Let $\Psi$ be the $R$-algebra map defined
by the rule $\Psi(x_i) = y_i$. Since $\Psi(f_i)$ is zero
in the localization $S_{\mathfrak q}$ we may after possibly
replacing $g$ assume that $\Psi(f_i) = 0$. This proves the claim.

\medskip\noindent
Thus we may assume $R$ and $S$ are local
with maximal ideals $\mathfrak p$ and $\mathfrak q$.
Pick $y_1, \ldots, y_n \in S$ such that
$y_i \bmod \mathfrak pS = \psi(x_i)$.
Let $y_{n + 1}, \ldots, y_{n + m} \in S$ be elements which generate
an $R$-subalgebra of which $S$ is the localization.
These exist by the assumption that $S$ is essentially of
finite type over $R$. Since $\psi$ is surjective we
may write $y_{n + j} \bmod \mathfrak pS = \psi(h_j)$ for
some $h_j \in \kappa(\mathfrak p)[x_1, \ldots, x_n]_{\mathfrak a}$.
Write $h_j = g_j/d$, $g_j \in \kappa(\mathfrak p)[x_1, \ldots, x_n]$
for some common denominator $d \in \kappa(\mathfrak p)[x_1, \ldots, x_n]$,
$d \not \in \mathfrak a$. Choose lifts $G_j, D \in R[x_1, \ldots, x_n]$
of $g_j$ and $d$. Set
$y_{n + j}' = D(y_1, \ldots, y_n) y_{n + j} - G_j(y_1, \ldots, y_n)$.
By construction $y_{n + j}' \in \mathfrak p S$.
It is clear that $y_1, \ldots, y_n, y_n', \ldots, y_{n + m}'$
generate an $R$-subalgebra of $S$ whose localization is $S$.
We define
$$
\Psi : R[x_1, \ldots, x_{n + m}] \to S
$$
to be the map that sends $x_i$ to $y_i$ for $i = 1, \ldots, n$
and $x_{n + j}$ to $y'_{n + j}$ for $j = 1, \ldots, m$. Properties
(1) and (4) are clear by construction. Moreover the ideal
$\mathfrak b$ maps onto the ideal
$(\mathfrak a, x_{n + 1}, \ldots, x_{n + m})$
in the polynomial ring $\kappa(\mathfrak p)[x_1, \ldots, x_{n + m}]$.

\medskip\noindent
Denote $J = \Ker(\Psi)$. We have a short exact sequence
$$
0 \to J_{\mathfrak b}
\to R[x_1, \ldots, x_{n + m}]_{\mathfrak b}
\to S_{\mathfrak q}
\to 0.
$$
The surjectivity comes from our choice of
$y_1, \ldots, y_n, y_n', \ldots, y_{n + m}'$ above.
This implies that
$$
J_{\mathfrak b}/ \mathfrak pJ_{\mathfrak b}
\to \kappa(\mathfrak p)[x_1, \ldots, x_{n + m}]_{
(\mathfrak a, x_{n + 1}, \ldots, x_{n + m})}
\to S_{\mathfrak q}/\mathfrak pS_{\mathfrak q}
\to 0
$$
is exact. By construction $x_i$ maps to $\psi(x_i)$ and
$x_{n + j}$ maps to zero under the last map.
Thus it is easy to choose $f_i$ as in
(2) and (3) of the lemma.
\end{proof}

\begin{remark}[Projective resolutions]
\label{remark-projective-resolution}
Let $R$ be a ring.
For any set $S$ we let $F(S)$ denote the free $R$-module on $S$.
Then any left $R$-module has the following two step resolution
$$
F(M \times M) \oplus F(R \times M) \to F(M) \to M \to 0.
$$
The first map is given by the rule
$$
[m_1, m_2] \oplus [r, m] \mapsto [m_1 + m_2] - [m_1] - [m_2] + [rm] - r[m].
$$
\end{remark}

\begin{lemma}
\label{lemma-spec-localization-first}
Let $S$ be a multiplicative set of $A$. Then the map
$$
f: \Spec(S^{-1}A)\longrightarrow \Spec(A)
$$
induced by the canonical ring map
$A \to S^{-1}A$ is a homeomorphism onto its image and
$\Im(f) = \{ \mathfrak p \in \Spec(A) : \mathfrak p\cap S = \emptyset \}$.
\end{lemma}

\begin{proof}
This is a duplicate of Algebra, Lemma \ref{algebra-lemma-spec-localization}.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-flat-over-integral-algebra}
Let $A \to B$ be a finite type, flat ring map with $A$ an integral
domain. Then $B$ is a finitely presented $A$-algebra.
\end{lemma}

\begin{proof}
Special case of More on Flatness, Proposition
\ref{flat-proposition-flat-finite-type-finite-presentation-domain}.
\end{proof}

\begin{lemma}
\label{lemma-helper-finite-type-flat-finite-presentation}
Let $R$ be a domain with fraction field $K$.
Let $S = R[x_1, \ldots, x_n]$ be a polynomial ring over $R$.
Let $M$ be a finite $S$-module. Assume that $M$ is flat over $R$.
If for every subring $R \subset R' \subset K$, $R \not = R'$
the module $M \otimes_R R'$ is finitely presented
over $S \otimes_R R'$, then $M$ is finitely presented over $S$.
\end{lemma}

\begin{proof}
This lemma is true because $M$ is finitely presented even without the
assumption that $M \otimes_R R'$ is finitely presented for every $R'$
as in the statement of the lemma. This follows from More on Flatness,
Proposition \ref{flat-proposition-flat-finite-type-finite-presentation-domain}.
Originally this lemma had an erroneous proof (thanks to Ofer Gabber
for finding the gap) and was used in an alternative proof of
the proposition cited. To reinstate this lemma, we need a correct argument
in case $R$ is a local normal domain using only
results from the chapters on commutative algebra; please email
\href{mailto:stacks.project@gmail.com}{stacks.project@gmail.com}
if you have an argument.
\end{proof}

\begin{lemma}
\label{lemma-relative-effective-cartier-algebra}
Let $A \to B$ be a ring map. Let $f \in B$. Assume that
\begin{enumerate}
\item $A \to B$ is flat,
\item $f$ is a nonzerodivisor, and
\item $A \to B/fB$ is flat.
\end{enumerate}
Then for every ideal $I \subset A$ the map
$f : B/IB \to B/IB$ is injective.
\end{lemma}

\begin{proof}
Note that $IB = I \otimes_A B$ and $I(B/fB) = I \otimes_A B/fB$
by the flatness of $B$ and $B/fB$ over $A$.
In particular $IB/fIB \cong I \otimes_A B/fB$ maps injectively
into $B/fB$. Hence the result follows from the snake lemma applied
to the diagram
$$
\xymatrix{
0 \ar[r] &
I \otimes_A B \ar[r] \ar[d]^f &
B \ar[r] \ar[d]^f &
B/IB \ar[r] \ar[d]^f &
0 \\
0 \ar[r] &
I \otimes_A B \ar[r] &
B \ar[r] &
B/IB \ar[r] &
0
}
$$
with exact rows.
\end{proof}

\begin{lemma}
\label{lemma-faithfully-flat-injective}
If $R \to S$ is a faithfully flat ring map then for every $R$-module
$M$ the map $M \to S \otimes_R M$, $x \mapsto 1 \otimes x$ is injective.
\end{lemma}

\begin{proof}
This lemma is a duplicate of
Algebra, Lemma \ref{algebra-lemma-faithfully-flat-universally-injective}.
\end{proof}

\begin{remark}
\label{remark-section-colimits}
This reference/tag used to refer to a Section in
the chapter Smoothing Ring Maps, but the material has
since been subsumed in Algebra, Section \ref{algebra-section-colimits-flat}.
\end{remark}

\begin{lemma}
\label{lemma-bound-primes}
Let $A$ be a Noetherian local normal domain of dimension $2$.
For $f \in \mathfrak m$ nonzero denote
$\text{div}(f) = \sum n_i (\mathfrak p_i)$
the divisor associated to $f$ on the punctured spectrum of $A$.
We set $|f| = \sum n_i$. There exist integers $N$ and $M$
such that $|f + g| \leq M$ for all $g \in \mathfrak m^N$.
\end{lemma}

\begin{proof}
Pick $h \in \mathfrak m$ such that $f, h$ is a regular sequence in $A$
(this follows from Algebra, Lemmas \ref{algebra-lemma-criterion-normal} and
\ref{algebra-lemma-depth-drops-by-one}).
We will prove the lemma with $M = \text{length}_A(A/(f, h))$ and with
$N$ any integer such that $\mathfrak m^N \subset (f, h)$. Such
an integer $N$ exists because $\sqrt{(f, h)} = \mathfrak m$. Note that
$M = \text{length}_A(A/(f + g, h))$ for all $g \in \mathfrak m^N$
because $(f, h) = (f + g, h)$. This moreover implies that $f + g, h$
is a regular sequence in $A$ too, see
Algebra, Lemma \ref{algebra-lemma-reformulate-CM}.
Now suppose that $\text{div}(f + g ) = \sum m_j (\mathfrak q_j)$.
Then consider the map
$$
c : A/(f + g) \longrightarrow \prod A/\mathfrak q_j^{(m_j)}
$$
where $\mathfrak q_j^{(m_j)}$ is the symbolic power, see
Algebra, Section \ref{algebra-section-symbolic-power}.
Since $A$ is normal, we see that $A_{\mathfrak q_i}$ is
a discrete valuation ring and hence
$$
A_{\mathfrak q_i}/(f + g) =
A_{\mathfrak q_i}/\mathfrak q_i^{m_i} A_{\mathfrak q_i} =
(A/\mathfrak q_i^{(m_i)})_{\mathfrak q_i}
$$
Since $V(f + g, h) = \{\mathfrak m\}$ this implies that $c$ becomes
an isomorphism on inverting $h$ (small detail omitted). Since $h$ is a
nonzerodivisor on $A/(f + g)$ we see that the length of $A/(f + g, h)$
equals the Herbrand quotient $e_A(A/(f + g), 0, h)$
as defined in Chow Homology, Section
\ref{chow-section-periodic-complexes}).
Similarly the length of $A/(h, \mathfrak q_j^{(m_j)})$ equals
$e_A(A/\mathfrak q_j^{(m_j)}, 0, h)$. Then we have
\begin{align*}
M & = \text{length}_A(A/(f + g, h) \\
& =
e_A(A/(f + g), 0, h) \\
& =
\sum\nolimits_i e_A(A/\mathfrak q_j^{(m_j)}, 0, h) \\
& =
\sum\nolimits_i \sum\nolimits_{m = 0, \ldots, m_j - 1}
e_A(\mathfrak q_j^{(m)}/\mathfrak q_j^{(m + 1)}, 0, h)
\end{align*}
The equalities follow from Chow Homology, Lemma
\ref{chow-lemma-periodic-length} using in particular that
the cokernel of $c$ has finite length as discussed above.
It is straightforward to prove that
$e_A(\mathfrak q^{(m)}/\mathfrak q^{(m + 1)}, 0, h)$
is at least $1$ by Nakayama's lemma. This finishes the proof of the lemma.
\end{proof}



\section{Lemmas related to ZMT}
\label{section-ZMT}

\noindent
The lemmas in this section were originally used in the proof of the
(algebraic version of) Zariski's Main Theorem,
Algebra, Theorem \ref{algebra-theorem-main-theorem}.

\begin{lemma}
\label{lemma-make-integral-less-trivial}
Let $\varphi : R \to S$ be a ring map.
Suppose $t \in S$ satisfies the
relation $\varphi(a_0) + \varphi(a_1)t + \ldots + \varphi(a_n) t^n = 0$.
Set $u_n = \varphi(a_n)$, $u_{n-1} = u_n t + \varphi(a_{n-1})$,
and so on till $u_1 = u_2 t + \varphi(a_1)$.
Then all of $u_n, u_{n-1}, \ldots, u_1$ and
$u_nt, u_{n-1}t, \ldots, u_1t$ are integral over $R$,
and the ideals $(\varphi(a_0), \ldots, \varphi(a_n))$ and
$(u_n, \ldots, u_1)$ of $S$ are equal.
\end{lemma}

\begin{proof}
We prove this by induction on $n$. As $u_n = \varphi(a_n)$ we
conclude from
Algebra, Lemma \ref{algebra-lemma-make-integral-trivial}
that $u_nt$ is integral over $R$. Of course
$u_n = \varphi(a_n)$ is integral over $R$. Then
$u_{n - 1} = u_n t  + \varphi(a_{n - 1})$ is integral over $R$ (see
Algebra, Lemma \ref{algebra-lemma-integral-closure-is-ring})
and we have
$$
\varphi(a_0) + \varphi(a_1)t + \ldots + \varphi(a_{n - 1})t^{n - 1} +
u_{n - 1}t^{n - 1} = 0.
$$
Hence by the induction hypothesis applied to the map
$S' \to S$ where $S'$ is the integral closure of $R$ in $S$
and the displayed equation we see that
$u_{n-1}, \ldots, u_1$ and $u_{n-1}t, \ldots, u_1t$
are all in $S'$ too. The statement on the ideals is immediate from the
shape of the elements and the fact that $u_1t + \varphi(a_0) = 0$.
\end{proof}

\begin{lemma}
\label{lemma-make-integral-not-in-ideal}
Let $\varphi : R \to S$ be a ring map.
Suppose $t \in S$ satisfies the
relation $\varphi(a_0) + \varphi(a_1)t + \ldots + \varphi(a_n) t^n = 0$.
Let $J \subset S$ be an ideal such that for at
least one $i$ we have $\varphi(a_i) \not \in J$.
Then there exists a $u \in S$, $u \not\in J$ such
that both $u$ and $ut$ are integral over $R$.
\end{lemma}

\begin{proof}
This is immediate from Lemma \ref{lemma-make-integral-less-trivial}
since one of the elements $u_i$ will not be in $J$.
\end{proof}

\noindent
The following two lemmas are a way of describing closed
subschemes of $\mathbf{P}^1_R$ cut out by one (nondegenerate)
equation.

\begin{lemma}
\label{lemma-P1}
Let $R$ be a ring.
Let $F(X, Y) \in R[X, Y]$ be homogeneous of degree
$d$. Assume that for every prime $\mathfrak p$ of $R$
at least one coefficient of $F$ is not in $\mathfrak p$.
Let $S = R[X, Y]/(F)$ as a graded ring.
Then for all $n \geq d$ the $R$-module $S_n$
is finite locally free of rank $d$.
\end{lemma}

\begin{proof}
The $R$-module $S_n$ has a presentation
$$
R[X, Y]_{n-d} \to R[X, Y]_n \to S_n \to 0.
$$
Thus by Algebra, Lemma \ref{algebra-lemma-cokernel-flat}
it is enough to show that multiplication
by $F$ induces an injective map
$\kappa(\mathfrak p)[X, Y]
\to \kappa(\mathfrak p)[X, Y]$
for all primes $\mathfrak p$.
This is clear from the assumption that
$F$ does not map to the zero polynomial mod $\mathfrak p$.
The assertion on ranks is clear from this as well.
\end{proof}

\begin{lemma}
\label{lemma-rel-prime-pols}
Let $k$ be a field. Let $F, G \in k[X, Y]$ be homogeneous
of degrees $d, e$. Assume $F, G$ relatively prime.
Then multiplication by $G$ is injective on $S = k[X, Y]/(F)$.
\end{lemma}

\begin{proof}
This is one way to define ``relatively prime''. If you have another
definition, then you can show it is equivalent to this one.
\end{proof}

\begin{lemma}
\label{lemma-P1-localize}
Let $R$ be a ring. Let $F(X, Y) \in R[X, Y]$ be homogeneous of degree
$d$. Let $S = R[X, Y]/(F)$ as a graded ring.
Let $\mathfrak p \subset R$ be a prime such that
some coefficient of $F$ is not in $\mathfrak p$.
There exists an $f \in R$ $f \not\in \mathfrak p$,
an integer $e$, and a $G \in R[X, Y]_e$
such that multiplication by $G$ induces isomorphisms
$(S_n)_f \to (S_{n + e})_f$ for all $n \geq d$.
\end{lemma}

\begin{proof}
During the course of the proof we may replace $R$ by $R_f$
for $f\in R$, $f\not\in \mathfrak p$ (finitely often).
As a first step we do such a replacement such that
some coefficient of $F$ is invertible in $R$.
In particular the modules $S_n$ are now locally
free of rank $d$ for $n \geq d$ by Lemma \ref{lemma-P1}.
Pick any $G \in R[X, Y]_e$ such that the image of
$G$ in $\kappa(\mathfrak p)[X, Y]$ is relatively
prime to the image of $F(X, Y)$ (this is possible for some $e$).
Apply Algebra, Lemma \ref{algebra-lemma-cokernel-flat} to the map
induced by multiplication by $G$ from $S_d \to S_{d + e}$.
By our choice of $G$ and Lemma \ref{lemma-rel-prime-pols}
we see
$S_d \otimes \kappa(\mathfrak p) \to S_{d + e} \otimes \kappa(\mathfrak p)$
is bijective. Thus, after replacing $R$ by $R_f$ for a suitable
$f$ we may assume that $G : S_d \to S_{d + e}$
is bijective. This in turn implies that the image
of $G$ in $\kappa(\mathfrak p')[X, Y]$ is relatively
prime to the image of $F$ for all primes $\mathfrak p'$
of $R$. And then by Algebra, Lemma \ref{algebra-lemma-cokernel-flat}
again we see that all the maps
$G : S_d \to S_{d + e}$, $n \geq d$ are isomorphisms.
\end{proof}

\begin{remark}
\label{remark-algebra}
Let $R$ be a ring. Suppose that we have $F \in R[X, Y]_d$
and $G \in R[X, Y]_e$ such that, setting $S = R[X, Y]/(F)$
we have (1) $S_n$ is finite locally free of rank $d$ for
all $n \geq d$, and (2) multiplication by $G$ defines
isomorphisms $S_n \to S_{n + e}$ for all $n \geq d$. In this
case we may define a finite, locally free $R$-algebra
$A$ as follows:
\begin{enumerate}
\item as an $R$-module $A = S_{ed}$, and
\item multiplication $A \times A \to A$ is given by
the rule that $H_1 H_2 = H_3$ if and only if $G^d H_3 = H_1 H_2$
in $S_{2ed}$.
\end{enumerate}
This makes sense because multiplication by $G^d$
induces a bijective map $S_{de} \to S_{2de}$.
It is easy to see that this defines a ring structure.
Note the confusing fact that the element $G^d$
defines the unit element of the ring $A$.
\end{remark}

\begin{lemma}
\label{lemma-finite-after-localization}
Let $R$ be a ring, let $f \in R$.
Suppose we have $S$, $S'$ and the solid arrows
forming the following commutative diagram of rings
$$
\xymatrix{
& S'' \ar@{-->}[rd] \ar@{-->}[dd] &
\\
R \ar[rr] \ar@{-->}[ru] \ar[d] &  & S \ar[d]
\\
R_f \ar[r] & S' \ar[r] & S_f
}
$$
Assume that $R_f \to S'$ is finite. Then we can find
a finite ring map $R \to S''$ and dotted arrows as
in the diagram such that $S' = (S'')_f$.
\end{lemma}

\begin{proof}
Namely, suppose that $S'$ is generated by
$x_i$ over $R_f$, $i = 1, \ldots, w$. Let $P_i(t) \in R_f[t]$
be a monic polynomial such that $P_i(x_i) = 0$.
Say $P_i$ has degree $d_i > 0$. Write
$P_i(t) = t^{d_i} + \sum_{j < d_i} (a_{ij}/f^n) t^j$
for some uniform $n$. Also write
the image of $x_i$ in $S_f$ as $g_i / f^n$
for suitable $g_i \in S$. Then we know
that the element
$\xi_i = f^{nd_i} g_i^{d_i} + \sum_{j < d_i} f^{n(d_i - j)} a_{ij} g_i^j$
of $S$ is killed by a power of $f$.
Hence upon increasing $n$ to $n'$, which replaces
$g_i$ by $f^{n' - n}g_i$ we may assume $\xi_i = 0$.
Then $S'$ is generated by the elements
$f^n x_i$, each of which is a zero of the
monic polynomial $Q_i(t) = t^{d_i} +
\sum_{j < d_i} f^{n(d_i - j)} a_{ij} t^j$
with coefficients in $R$. Also, by construction
$Q_i(f^ng_i) = 0$ in $S$. Thus we get a finite $R$-algebra
$S'' = R[z_1, \ldots, z_w]/(Q_1(z_1), \ldots, Q_w(z_w))$
which fits into a commutative diagram as above.
The map $\alpha : S'' \to S$ maps $z_i$ to $f^ng_i$ and
the map $\beta : S'' \to S'$ maps $z_i$ to $f^nx_i$.
It may not yet be the case that $\beta$ induces an
isomorphism $(S'')_f \cong S'$.
For the moment we only know that this map
is surjective. The problem is that there could be
elements $h/f^n \in (S'')_f$ which map to zero
in $S'$ but are not zero. In this case $\beta(h)$
is an element of $S$ such that $f^N \beta(h) = 0$
for some $N$. Thus $f^N h$ is an element ot the ideal
$J = \{h \in S'' \mid \alpha(h) = 0 \text{ and }
\beta(h) = 0\}$ of $S''$. OK, and it is easy to see that
$S''/J$ does the job.
\end{proof}


\section{Formally smooth ring maps}
\label{section-formally-smooth}

\begin{lemma}
\label{lemma-formally-smooth-smooth}
Let $R$ be a ring. Let $S$ be a $R$-algebra.
If $S$ is of finite presentation and formally smooth over $R$
then $S$ is smooth over $R$.
\end{lemma}

\begin{proof}
See Algebra, Proposition \ref{algebra-proposition-smooth-formally-smooth}.
\end{proof}



\section{Cohomology}
\label{section-cohomology}


\noindent
The following lemma computes the cohomology sheaves of the
derived limit in a special case.

\begin{lemma}
\label{lemma-Rlim-of-system}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $(K_n)$
be an inverse system of objects of $D(\mathcal{O})$.
Let $\mathcal{B} \subset \Ob(\mathcal{C})$ be a subset.
Let $d \in \mathbf{N}$. Assume
\begin{enumerate}
\item $K_n$ is an object of $D^+(\mathcal{O})$ for all $n$,
\item for $q \in \mathbf{Z}$ there exists
$n(q)$ such that $H^q(K_{n + 1}) \to H^q(K_n)$ is an isomorphism for
$n \geq n(q)$,
\item every object of $\mathcal{C}$ has a covering whose members are
elements of $\mathcal{B}$,
\item for every $U \in \mathcal{B}$ we have $H^p(U, H^q(K_n)) = 0$
for $p > d$ and all $q$.
\end{enumerate}
Then we have $H^m(R\lim K_n) = \lim H^m(K_n)$ for all $m \in \mathbf{Z}$.
\end{lemma}

\begin{proof}
Set $K = R\lim K_n$. Let $U \in \mathcal{B}$. For each $n$ there is a spectral
sequence
$$
H^p(U, H^q(K_n)) \Rightarrow H^{p + q}(U, K_n)
$$
which converges as $K_n$ is bounded below, see
Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor}.
If we fix $m \in \mathbf{Z}$, then we see from our assumption (4)
that only $H^p(U, H^q(K_n))$ contribute to $H^m(U, K_n)$
for $0 \leq p \leq d$ and $m - d \leq q \leq m$. By assumption (2)
this implies that $H^m(U, K_{n + 1}) \to H^m(U, K_n)$ is an isomorphism
as soon as $n \geq \max{n(m), \ldots, n(m - d)}$. The functor $R\Gamma(U, -)$
commutes with derived limits by
Injectives, Lemma \ref{injectives-lemma-RF-commutes-with-Rlim}.
Thus we have
$$
H^m(U, K) = H^m(R\lim R\Gamma(U, K_n))
$$
On the other hand we have just seen that the complexes $R\Gamma(U, K_n)$
have eventually constant cohomology groups. Thus by
More on Algebra, Remark \ref{more-algebra-remark-compare-derived-limit}
we find that $H^m(U, K)$ is equal to $H^m(U, K_n)$ for
all $n \gg 0$ for some bound independent of $U \in \mathcal{B}$.
Pick such an $n$. Finally, recall that $H^m(K)$ is the sheafification of
the presheaf $U \mapsto H^m(U, K)$ and $H^m(K_n)$ is the sheafification
of the presheaf $U \mapsto H^m(U, K_n)$. On the elements
of $\mathcal{B}$ these presheaves have the same values. Therefore assumption
(3) guarantees that the sheafifications are the same too.
The lemma follows.
\end{proof}




\section{Simplicial methods}
\label{section-simplicial}


\begin{lemma}
\label{lemma-equiv}
Assumptions and notation as in
Simplicial, Lemma \ref{simplicial-lemma-section}.
There exists a section $g : U \to V$ to the morphism $f$ and
the composition $g \circ f$ is homotopy equivalent to the identity
on $V$. In particular, the morphism $f$ is a homotopy equivalence.
\end{lemma}

\begin{proof}
Immediate from Simplicial, Lemmas \ref{simplicial-lemma-section} and
\ref{simplicial-lemma-trivial-kan-homotopy}.
\end{proof}

\begin{lemma}
\label{lemma-cosk-hom-deltak}
Let $\mathcal{C}$ be a category with finite coproducts
and finite limits. Let $X$ be an object of $\mathcal{C}$.
Let $k \geq 0$. The canonical map
$$
\Hom(\Delta[k], X)
\longrightarrow
\text{cosk}_1 \text{sk}_1 \Hom(\Delta[k], X)
$$
is an isomorphism.
\end{lemma}

\begin{proof}
For any simplicial object $V$ we have
\begin{eqnarray*}
\Mor(V, \text{cosk}_1 \text{sk}_1 \Hom(\Delta[k], X))
& = &
\Mor(\text{sk}_1 V, \text{sk}_1 \Hom(\Delta[k], X)) \\
& = &
\Mor(i_{1!} \text{sk}_1 V, \Hom(\Delta[k], X)) \\
& = &
\Mor(i_{1!} \text{sk}_1 V \times \Delta[k], X)
\end{eqnarray*}
The first equality by the adjointness of $\text{sk}$ and $\text{cosk}$,
the second equality by the adjointness of $i_{1!}$ and $\text{sk}_1$, and
the first equality by
Simplicial, Definition \ref{simplicial-definition-hom-from-simplicial-set}
where the last $X$ denotes the constant simplicial object with value $X$.
By Simplicial, Lemma \ref{simplicial-lemma-augmentation-howto} an element
in this set depends only on the terms of degree $0$ and $1$
of $i_{1!} \text{sk}_1 V \times \Delta[k]$. These
agree with the degree $0$ and $1$ terms of
$V \times \Delta[k]$, see
Simplicial, Lemma \ref{simplicial-lemma-recovering-U-for-real}.
Thus the set above is equal to
$\Mor(V \times \Delta[k], X) = \Mor(V, \Hom(\Delta[k], X))$.
\end{proof}

\begin{lemma}
\label{lemma-cosk0-hom-deltak}
Let $\mathcal{C}$ be a category. Let $X$ be an object of $\mathcal{C}$
such that the self products $X \times \ldots \times X$ exist.
Let $k \geq 0$ and let $C[k]$ be as in
Simplicial, Example \ref{simplicial-example-simplex-cosimplicial-set}.
With notation as in
Simplicial, Lemma \ref{simplicial-lemma-morphism-into-product}
the canonical map
$$
\Hom(C[k], X)_1
\longrightarrow
(\text{cosk}_0 \text{sk}_0 \Hom(C[k], X))_1
$$
is identified with the map
$$
\prod\nolimits_{\alpha : [k] \to [1]} X
\longrightarrow
X \times X
$$
which is the projection onto the factors where $\alpha$
is a constant map.
\end{lemma}

\begin{proof}
This is shown in the proof of
Hypercoverings, Lemma \ref{hypercovering-lemma-covering}.
\end{proof}




\section{Obsolete lemmas on schemes}
\label{section-devissage}

\noindent
Lemmas that seem superfluous.

\begin{lemma}
\label{lemma-stein-projective}
Let $(R, \mathfrak m, \kappa)$ be a local ring.
Let $X \subset \mathbf{P}^n_R$ be a closed subscheme.
Assume that $R = \Gamma(X, \mathcal{O}_X)$. Then the special fibre
$X_k$ is geometrically connected.
\end{lemma}

\begin{proof}
This is a special case of
More on Morphisms, Theorem
\ref{more-morphisms-theorem-stein-factorization-general}.
\end{proof}

\begin{lemma}
\label{lemma-property-irreducible-higher-rank}
Let $X$ be a Noetherian scheme.
Let $Z_0 \subset X$ be an irreducible closed subset with generic point $\xi$.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves if two
out of three of them have property $\mathcal{P}$ then so does the
third.
\item If $\mathcal{P}$ holds for a direct sum of coherent sheaves
then it holds for both.
\item For every integral closed subscheme $Z \subset Z_0 \subset X$,
$Z \not = Z_0$ and every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Z$ we have
$\mathcal{P}$ for $(Z \to X)_*\mathcal{I}$.
\item There exists some coherent sheaf $\mathcal{G}$ on $X$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z_0$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$, and
\item property $\mathcal{P}$ holds for $\mathcal{G}$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
$\mathcal{F}$ on $X$ whose support is contained in $Z_0$.
\end{lemma}

\begin{proof}
The proof is a variant on the proof of
Cohomology of Schemes, Lemma \ref{coherent-lemma-property-irreducible}.
In exactly the same manner as in that proof we see that
any coherent sheaf whose support is strictly contained in $Z_0$
has property $\mathcal{P}$.

\medskip\noindent
Consider a coherent sheaf $\mathcal{G}$ as in (3).
By Cohomology of Schemes, Lemma \ref{coherent-lemma-prepare-filter-irreducible}
there exists a sheaf of ideals $\mathcal{I}$ on $Z_0$ and
a short exact sequence
$$
0 \to
\left((Z_0 \to X)_*\mathcal{I}\right)^{\oplus r} \to
\mathcal{G} \to
\mathcal{Q} \to 0
$$
where the support of $\mathcal{Q}$ is strictly contained in $Z_0$.
In particular $r > 0$ and $\mathcal{I}$ is nonzero
because the support of $\mathcal{G}$ is equal to $Z$.
Since $\mathcal{Q}$ has property $\mathcal{P}$ we conclude that
also $\left((Z_0 \to X)_*\mathcal{I}\right)^{\oplus r}$
has property $\mathcal{P}$.
By (2) we deduce property $\mathcal{P}$ for
$(Z_0 \to X)_*\mathcal{I}$. Slotting this into the proof of
Cohomology of Schemes, Lemma \ref{coherent-lemma-property-irreducible}
at the appropriate point gives the lemma.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-property-higher-rank}
Let $X$ be a Noetherian scheme.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves if two
out of three of them have property $\mathcal{P}$ then so does the
third.
\item If $\mathcal{P}$ holds for a direct sum of coherent sheaves
then it holds for both.
\item For every integral closed subscheme $Z \subset X$
with generic point $\xi$ there exists
some coherent sheaf $\mathcal{G}$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$, and
\item property $\mathcal{P}$ holds for $\mathcal{G}$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
on $X$.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-property-irreducible-higher-rank}
in exactly the same way that
Cohomology of Schemes, Lemma \ref{coherent-lemma-property} follows from
Cohomology of Schemes, Lemma \ref{coherent-lemma-property-irreducible}.
\end{proof}

\begin{lemma}
\label{lemma-section-maps-back-into}
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Let $s \in \Gamma(X, \mathcal{L})$ be a section.
Let $\mathcal{F}' \subset \mathcal{F}$ be quasi-coherent
$\mathcal{O}_X$-modules. Assume that
\begin{enumerate}
\item $X$ is quasi-compact,
\item $\mathcal{F}$ is of finite type, and
\item $\mathcal{F}'|_{X_s} = \mathcal{F}|_{X_s}$.
\end{enumerate}
Then there exists an $n \geq 0$ such that
multiplication by $s^n$ on $\mathcal{F}$ factors
through $\mathcal{F}'$.
\end{lemma}

\begin{proof}
In other words we claim that
$s^n\mathcal{F} \subset
\mathcal{F}' \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
for some $n \geq 0$. In other words, we claim that the quotient map
$\mathcal{F} \to \mathcal{F}/\mathcal{F}'$ becomes
zero after multiplying by a power of $s$.
This follows from Properties, Lemma
\ref{properties-lemma-section-maps-backwards}.
\end{proof}






\section{Functor of quotients}
\label{section-quotients}

\begin{lemma}
\label{lemma-factors-through-quotient}
Let $S = \Spec(R)$ be an affine scheme. Let $X$ be an algebraic space over
$S$. Let $q_i : \mathcal{F} \to \mathcal{Q}_i$, $i = 1, 2$
be surjective maps of quasi-coherent $\mathcal{O}_X$-modules.
Assume $\mathcal{Q}_1$ flat over $S$. Let $T \to S$ be a quasi-compact
morphism of schemes such that there exists a factorization
$$
\xymatrix{
& \mathcal{F}_T \ar[rd]^{q_{2, T}} \ar[ld]_{q_{1, T}} \\
\mathcal{Q}_{1, T} & & \mathcal{Q}_{2, T} \ar@{..>}[ll]
}
$$
Then exists a closed subscheme $Z \subset S$ such that
(a) $T \to S$ factors through $Z$ and (b)
$q_{1, Z}$ factors through $q_{2, Z}$.
If $\Ker(q_2)$ is a finite type $\mathcal{O}_X$-module and $X$
quasi-compact, then we can take $Z \to S$ of finite presentation.
\end{lemma}

\begin{proof}
Apply Quot, Lemma \ref{quot-lemma-F-zero-somewhat-closed}
to the map $\Ker(q_2) \to \mathcal{Q}_1$.
\end{proof}







\section{Spaces and fpqc coverings}
\label{section-fpqc}

\noindent
The material here was made obsolete by Gabber's argument showing that
algebraic spaces satisfy the sheaf condition with respect to fpqc
coverings. Please visit
Properties of Spaces, Section \ref{spaces-properties-section-fpqc}.

\begin{lemma}
\label{lemma-separated-fpqc}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\{f_i : T_i \to T\}_{i \in I}$ be a fpqc covering of schemes over $S$.
Then the map
$$
\Mor_S(T, X)
\longrightarrow
\prod\nolimits_{i \in I} \Mor_S(T_i, X)
$$
is injective.
\end{lemma}

\begin{proof}
Immediate consequence of
Properties of Spaces, Proposition
\ref{spaces-properties-proposition-sheaf-fpqc}.
\end{proof}

\begin{lemma}
\label{lemma-sheaf-fpqc-open-covering}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $X = \bigcup_{j \in J} X_j$ be a Zariski covering, see
Spaces, Definition \ref{spaces-definition-Zariski-open-covering}.
If each $X_j$ satisfies the sheaf property for the fpqc topology
then $X$ satisfies the sheaf property for the fpqc topology.
\end{lemma}

\begin{proof}
This is true because all algebraic spaces satisfy the sheaf property
for the fpqc topology, see
Properties of Spaces, Proposition
\ref{spaces-properties-proposition-sheaf-fpqc}.
\end{proof}

\begin{lemma}
\label{lemma-sheaf-fpqc-quasi-separated}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
If $X$ is Zariski locally quasi-separated over $S$, then $X$ satisfies
the sheaf condition for the fpqc topology.
\end{lemma}

\begin{proof}
Immediate consequence of the general
Properties of Spaces, Proposition
\ref{spaces-properties-proposition-sheaf-fpqc}.
\end{proof}

\begin{remark}
\label{remark-proof-works-when}
This remark used to discuss to what extend the original proof of
Lemma \ref{lemma-sheaf-fpqc-quasi-separated} (of December 18, 2009)
generalizes.
\end{remark}






\section{Very reasonable algebraic spaces}
\label{section-very-reasonable}

\noindent
Material that is somewhat obsolete.

\begin{lemma}
\label{lemma-reasonable-kolmogorov}
Let $S$ be a scheme.
Let $X$ be a reasonable algebraic space over $S$.
Then $|X|$ is Kolmogorov (see
Topology, Definition \ref{topology-definition-generic-point}).
\end{lemma}

\begin{proof}
Follows from the definitions and
Decent Spaces, Lemma \ref{decent-spaces-lemma-kolmogorov}.
\end{proof}

\noindent
In the rest of this section we make some remarks about very reasonable
algebraic spaces. If there exists a scheme $U$ and a
surjective, \'etale, quasi-compact
morphism $U \to X$, then $X$ is very reasonable, see
Decent Spaces, Lemma \ref{decent-spaces-lemma-characterize-very-reasonable}.

\begin{lemma}
\label{lemma-scheme-very-reasonable}
A scheme is very reasonable.
\end{lemma}

\begin{proof}
This is true because the identity map is a quasi-compact, surjective
\'etale morphism.
\end{proof}

\begin{lemma}
\label{lemma-very-reasonable-Zariski-local}
Let $S$ be a scheme.
Let $X$ be an algebraic space over $S$.
If there exists a Zariski open covering $X = \bigcup X_i$ such that
each $X_i$ is very reasonable, then $X$ is very reasonable.
\end{lemma}

\begin{proof}
This is case $(\epsilon)$ of
Decent Spaces, Lemma \ref{decent-spaces-lemma-properties-local}.
\end{proof}

\begin{lemma}
\label{lemma-quasi-separated-very-reasonable}
An algebraic space which is Zariski locally quasi-separated is very reasonable.
In particular any quasi-separated algebraic space is very reasonable.
\end{lemma}

\begin{proof}
This is one of the implications of
Decent Spaces, Lemma \ref{decent-spaces-lemma-bounded-fibres}.
\end{proof}

\begin{lemma}
\label{lemma-representable-very-reasonable}
Let $S$ be a scheme.
Let $X$, $Y$ be algebraic spaces over $S$.
Let $Y \to X$ be a representable morphism.
If $X$ is very reasonable, so is $Y$.
\end{lemma}

\begin{proof}
This is case $(\epsilon)$ of
Decent Spaces, Lemma \ref{decent-spaces-lemma-representable-properties}.
\end{proof}

\begin{remark}
\label{remark-very-reasonable-Zariski-locally-quasi-separated}
Very reasonable algebraic spaces form a strictly larger collection than
Zariski locally quasi-separated algebraic spaces. Consider
an algebraic space of the form $X = [U/G]$ (see
Spaces, Definition \ref{spaces-definition-quotient})
where $G$ is a finite group acting without fixed points on a
non-quasi-separated scheme $U$. Namely, in this case
$U \times_X U = U \times G$ and clearly both projections to $U$ are
quasi-compact, hence $X$ is very reasonable. On the other hand, the diagonal
$U \times_X U \to U \times U$ is not quasi-compact, hence this
algebraic space is not quasi-separated. Now, take $U$ the infinite
affine space over a field $k$ of characteristic $\not = 2$ with
zero doubled, see
Schemes, Example \ref{schemes-example-not-quasi-separated}.
Let $0_1, 0_2$ be the two zeros of $U$. Let $G = \{+1, -1\}$, and
let $-1$ act by $-1$ on all coordinates, and by switching
$0_1$ and $0_2$. Then $[U/G]$ is very reasonable but not Zariski locally
quasi-separated (details omitted).
\end{remark}

\noindent
Warning: The following lemma should be used with caution, as the schemes
$U_i$ in it are not necessarily separated or even quasi-separated.

\begin{lemma}
\label{lemma-very-reasonable-quasi-compact-pieces}
Let $S$ be a scheme.
Let $X$ be a very reasonable algebraic space over $S$.
There exists a set of schemes
$U_i$ and morphisms $U_i \to X$ such that
\begin{enumerate}
\item each $U_i$ is a quasi-compact scheme,
\item each $U_i \to X$ is \'etale,
\item both projections $U_i \times_X U_i \to U_i$ are quasi-compact, and
\item the morphism $\coprod U_i \to X$ is surjective (and \'etale).
\end{enumerate}
\end{lemma}

\begin{proof}
Decent Spaces, Definition \ref{decent-spaces-definition-very-reasonable}
says that there exist $U_i \to X$ such that (2), (3) and (4) hold.
Fix $i$, and set $R_i = U_i \times_X U_i$, and denote $s, t : R_i \to U_i$
the projections.
For any affine open $W \subset U_i$ the open $W' = t(s^{-1}(W)) \subset U_i$
is a quasi-compact $R_i$-invariant open (see
Groupoids, Lemma \ref{groupoids-lemma-constructing-invariant-opens}).
Hence $W'$ is a quasi-compact scheme, $W' \to X$ is \'etale, and
$W' \times_X W' = s^{-1}(W') = t^{-1}(W')$ so both projections
$W' \times_X W' \to W'$ are quasi-compact. This means the family of
$W' \to X$, where $W \subset U_i$ runs through the members of affine
open coverings of the $U_i$ gives what we want.
\end{proof}



\section{Variants of cotangent complexes for schemes}
\label{section-cotangent-schemes-variant}

\noindent
This section gives an alternative construction of the cotangent complex
of a morphism of schemes. This section is currently in the obsolete
chapter as we can get by with the easier version discussed in
Cotangent, Section \ref{cotangent-section-cotangent-schemes-variant}
for applications.

\medskip\noindent
Let $f : X \to Y$ be a morphism of schemes. Let $\mathcal{C}_{X/Y}$ be the
category whose objects are commutative diagrams
\begin{equation}
\label{equation-object}
\vcenter{
\xymatrix{
X \ar[d] & U \ar[l] \ar[d] \ar[r]_i & A \ar[ld] \\
Y & V \ar[l]
}
}
\end{equation}
of schemes where
\begin{enumerate}
\item $U$ is an open subscheme of $X$,
\item $V$ is an open subscheme of $Y$, and
\item there exists an isomorphism $A = V \times \Spec(P)$ over $V$
where $P$ is a polynomial algebra over $\mathbf{Z}$ (on some set
of variables).
\end{enumerate}
In other words, $A$ is an (infinite dimensional) affine space over $V$.
Morphisms are given by commutative diagrams.

\medskip\noindent
{\bf Notation.} An object of $\mathcal{C}_{X/Y}$, i.e., a diagram
(\ref{equation-object}), is often denoted $U \to A$ where it is
understood that (a) $U$ is an open subscheme of $X$, (b)
$U \to A$ is a morphism over $Y$, (c) the image of the
structure morphism $A \to Y$ is an open $V \subset Y$, and (d)
$A \to V$ is an affine space. We'll write $U \to A/V$ to indicate
$V \subset Y$ is the image of $A \to Y$.
Recall that $X_{Zar}$ denotes the small Zariski site $X$.
There are forgetful functors
$$
\mathcal{C}_{X/Y} \to X_{Zar},\ (U \to A) \mapsto U
\quad\text{and}\quad
\mathcal{C}_{X/Y} \mapsto Y_{Zar},\ (U \to A/V) \mapsto V.
$$

\begin{lemma}
\label{lemma-category-fibred}
Let $X \to Y$ be a morphism of schemes.
\begin{enumerate}
\item The category $\mathcal{C}_{X/Y}$ is fibred over $X_{Zar}$.
\item The category $\mathcal{C}_{X/Y}$ is fibred over $Y_{Zar}$.
\item The category $\mathcal{C}_{X/Y}$ is fibred over the
category of pairs $(U, V)$ where $U \subset X$, $V \subset Y$ are
open and $f(U) \subset V$.
\end{enumerate}
\end{lemma}

\begin{proof}
Ad (1). Given an object $U \to A$ of $\mathcal{C}_{X/Y}$ and a morphism
$U' \to U$ of $X_{Zar}$ consider the object $i' : U' \to A$ of
$\mathcal{C}_{X/Y}$ where $i'$ is the composition of $i$ and $U' \to U$.
The morphism $(U' \to A) \to (U \to A)$ of $\mathcal{C}_{X/Y}$
is strongly cartesian over $X_{Zar}$.

\medskip\noindent
Ad (2). Given an object $U \to A/V$ and $V' \to V$ we can set
$U' = U \cap f^{-1}(V')$ and $A' = V' \times_V A$ to obtain a strongly
cartesian morphism $(U' \to A') \to (U \to A)$ over $V' \to V$.

\medskip\noindent
Ad (3). Denote $(X/Y)_{Zar}$ the category in (3). Given $U \to A/V$
and a morphism $(U', V') \to (U, V)$ in $(X/Y)_{Zar}$ we can consider
$A' = V' \times_V A$. Then the morphism $(U' \to A'/V') \to (U \to A/V)$
is strongly cartesian in $\mathcal{C}_{X/Y}$ over $(X/Y)_{Zar}$.
\end{proof}

\noindent
We obtain a topology $\tau_X$ on $\mathcal{C}_{X/Y}$ by
using the topology inherited from $X_{Zar}$ (see
Stacks, Section \ref{stacks-section-topology}). If not otherwise
stated this is the topology on $\mathcal{C}_{X/Y}$ we will consider.
To be precise, a family of morphisms $\{(U_i \to A_i) \to (U \to A)\}$
is a covering of $\mathcal{C}_{X/Y}$ if and only if
\begin{enumerate}
\item $U = \bigcup U_i$, and
\item $A_i = A$ for all $i$.
\end{enumerate}
We obtain the same collection of sheaves if we allow $A_i \cong A$ in (2).
The functor $u$ defines a morphism of topoi
$\pi : \Sh(\mathcal{C}_{X/Y}) \to \Sh(X_{Zar})$.

\medskip\noindent
The site $\mathcal{C}_{X/Y}$ comes with several sheaves of rings.
\begin{enumerate}
\item The sheaf $\mathcal{O}$ given by the rule
$(U \to A) \mapsto \mathcal{O}(A)$.
\item The sheaf $\underline{\mathcal{O}}_X = \pi^{-1}\mathcal{O}_X$ given by
the rule $(U \to A) \mapsto \mathcal{O}(U)$.
\item The sheaf $\underline{\mathcal{O}}_Y$ given by the rule
$(U \to A/V) \mapsto \mathcal{O}(V)$.
\end{enumerate}
We obtain morphisms of ringed topoi
\begin{equation}
\label{equation-pi-schemes}
\vcenter{
\xymatrix{
(\Sh(\mathcal{C}_{X/Y}), \underline{\mathcal{O}}_X) \ar[r]_i \ar[d]_\pi &
(\Sh(\mathcal{C}_{X/Y}), \mathcal{O}) \\
(\Sh(X_{Zar}), \mathcal{O}_X)
}
}
\end{equation}
The morphism $i$ is the identity on underlying topoi and
$i^\sharp : \mathcal{O} \to \underline{\mathcal{O}}_X$
is the obvious map.
The map $\pi$ is a special case of Cohomology on Sites, Situation
\ref{sites-cohomology-situation-fibred-category}.
An important role will be played in the following
by the derived functors
$
Li^* : D(\mathcal{O}) \longrightarrow D(\underline{\mathcal{O}}_X)
$
left adjoint to $Ri_* = i_* : D(\underline{\mathcal{O}}_X) \to D(\mathcal{O})$
and
$
L\pi_! : D(\underline{\mathcal{O}}_X) \longrightarrow D(\mathcal{O}_X)
$
left adjoint to
$\pi^* = \pi^{-1} : D(\mathcal{O}_X) \to D(\underline{\mathcal{O}}_X)$.

\begin{remark}
\label{remark-different-topologies}
We obtain a second topology $\tau_Y$ on $\mathcal{C}_{X/Y}$
by taking the topology inherited from $Y_{Zar}$.
There is a third topology $\tau_{X \to Y}$ where a family of morphisms
$\{(U_i \to A_i) \to (U \to A)\}$ is a covering if and only
if $U = \bigcup U_i$, $V = \bigcup V_i$ and $A_i \cong V_i \times_V A$.
This is the topology inherited from the topology on the site
$(X/Y)_{Zar}$ whose underlying category is the category of pairs
$(U, V)$ as in Lemma \ref{lemma-category-fibred} part (3). The coverings
of $(X/Y)_{Zar}$ are families $\{(U_i, V_i) \to (U, V)\}$ such that
$U = \bigcup U_i$ and $V = \bigcup V_i$. There are morphisms of topoi
$$
\xymatrix{
\Sh(\mathcal{C}_{X/Y})
= \Sh(\mathcal{C}_{X/Y}, \tau_X) &
\Sh(\mathcal{C}_{X/Y}, \tau_{X \to Y}) \ar[l] \ar[r] &
\Sh(\mathcal{C}_{X/Y}, \tau_Y)
}
$$
(recall that $\tau_X$ is our ``default'' topology). The pullback functors
for these arrows are sheafification and pushforward is the identity on
underlying presheaves. The diagram of topoi
$$
\xymatrix{
\Sh(X_{Zar}) \ar[d]^f & \Sh(\mathcal{C}_{X/Y}) \ar[l]^\pi &
\Sh(\mathcal{C}_{X/Y}, \tau_{X \to Y}) \ar[l] \ar[d] \\
\Sh(Y_{Zar}) & & \Sh(\mathcal{C}_{X/Y}, \tau_Y) \ar[ll]
}
$$
is {\bf not} commutative. Namely, the pullback of a nonzero abelian sheaf on
$Y$ is a nonzero abelian sheaf on $(\mathcal{C}_{X/Y}, \tau_{X \to Y})$,
but we can certainly find examples where such a sheaf pulls back to zero
on $X$. Note that any presheaf $\mathcal{F}$ on
$Y_{Zar}$ gives a sheaf $\underline{\mathcal{F}}$ on $\mathcal{C}_{Y/X}$
by the rule which assigns to $(U \to A/V)$ the set $\mathcal{F}(V)$.
Even if $\mathcal{F}$ happens to be a sheaf it isn't true in general that
$\underline{\mathcal{F}} = \pi^{-1}f^{-1}\mathcal{F}$. This is related
to the noncommutativity of the diagram above, as we can describe
$\underline{\mathcal{F}}$ as the pushforward of the pullback
of $\mathcal{F}$ to $\Sh(\mathcal{C}_{X/Y}, \tau_{X \to Y})$ via
the lower horizontal and right vertical arrows. An
example is the sheaf $\underline{\mathcal{O}}_Y$.
But what is true is that there is a map
$\underline{\mathcal{F}} \to \pi^{-1}f^{-1}\mathcal{F}$
which is transformed (as we shall see later)
into an isomorphism after applying $\pi_!$.
\end{remark}










\section{Deformations and obstructions of flat modules}
\label{section-modules}

\noindent
In this section we sketch a construction of a deformation theory for the
stack of coherent sheaves for any algebraic space $X$ over a ring $\Lambda$.
This material is obsolete due to the improved discussion in
Quot, Section \ref{quot-section-not-flat}.

\medskip\noindent
Our setup will be the following. We assume given
\begin{enumerate}
\item a ring $\Lambda$,
\item an algebraic space $X$ over $\Lambda$,
\item a $\Lambda$-algebra $A$, set
$X_A = X \times_{\Spec(\Lambda)} \Spec(A)$, and
\item a finitely presented $\mathcal{O}_{X_A}$-module $\mathcal{F}$
flat over $A$.
\end{enumerate}
In this situation we will consider all possible surjections
$$
0 \to I \to A' \to A \to 0
$$
where $A'$ is a $\Lambda$-algebra whose kernel $I$ is an ideal of square zero
in $A'$. Given $A'$ we obtain a first order thickening $X_A \to X_{A'}$
of algebraic spaces over $\Spec(\Lambda)$. For each of these we consider
the problem of lifting $\mathcal{F}$ to a finitely presented module
$\mathcal{F}'$ on $X_{A'}$ flat over $A'$. We would like to replicate the
results of Deformation Theory, Lemma \ref{defos-lemma-flat-ringed-topoi}
in this setting.

\medskip\noindent
To be more precise let $\textit{Lift}(\mathcal{F}, A')$ denote the category
of pairs $(\mathcal{F}', \alpha)$ where $\mathcal{F}'$ is a
finitely presented module on $X_{A'}$ flat over $A'$ and
$\alpha : \mathcal{F}'|_{X_A} \to \mathcal{F}$ is an isomorphism.
Morphisms $(\mathcal{F}'_1, \alpha_1) \to (\mathcal{F}'_2, \alpha_2)$
are isomorphisms $\mathcal{F}'_1 \to \mathcal{F}'_2$ which are compatible
with $\alpha_1$ and $\alpha_2$.
The set of isomorphism classes of $\textit{Lift}(\mathcal{F}, A')$
is denoted $\text{Lift}(\mathcal{F}, A')$.

\medskip\noindent
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_X \otimes_\Lambda A$-modules
on $X_\etale$ flat over $A$. We introduce the category
$\textit{Lift}(\mathcal{G}, A')$ of pairs
$(\mathcal{G}', \beta)$ where $\mathcal{G}'$ is a sheaf of
$\mathcal{O}_X \otimes_\Lambda A'$-modules flat over $A'$ and $\beta$
is an isomorphism $\mathcal{G}' \otimes_{A'} A \to \mathcal{G}$.

\begin{lemma}
\label{lemma-equivalence}
Notation and assumptions as above. Let $p : X_A \to X$ denote the projection.
Given $A'$ denote $p' : X_{A'} \to X$ the projection. The functor $p'_*$
induces an equivalence of categories between
\begin{enumerate}
\item the category $\textit{Lift}(\mathcal{F}, A')$, and
\item the category $\textit{Lift}(p_*\mathcal{F}, A')$.
\end{enumerate}
\end{lemma}

\begin{proof}
FIXME.
\end{proof}

\noindent
Let $\mathcal{H}$ be a sheaf of $\mathcal{O} \otimes_\Lambda A$-modules
on $\mathcal{C}_{X/\Lambda}$ flat over $A$. We introduce the category
$\textit{Lift}_\mathcal{O}(\mathcal{H}, A')$
whose objects are pairs $(\mathcal{H}', \gamma)$ where $\mathcal{H}'$
is a sheaf of $\mathcal{O} \otimes_\Lambda A'$-modules flat over $A'$
and $\gamma : \mathcal{H}' \otimes_A A' \to \mathcal{H}$
is an isomorphism of $\mathcal{O} \otimes_\Lambda A$-modules.

\medskip\noindent
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_X \otimes_\Lambda A$-modules
on $X_\etale$ flat over $A$.
Consider the morphisms $i$ and $\pi$ of
Cotangent, Equation (\ref{cotangent-equation-pi-spaces}).
Denote $\underline{\mathcal{G}} = \pi^{-1}(\mathcal{G})$. It is
simply given by the rule $(U \to \mathbf{A}) \mapsto \mathcal{G}(U)$
hence it is a sheaf of $\underline{\mathcal{O}}_X \otimes_\Lambda A$-modules.
Denote $i_*\underline{\mathcal{G}}$ the same sheaf but viewed as a
sheaf of $\mathcal{O} \otimes_\Lambda A$-modules.

\begin{lemma}
\label{lemma-second-equivalence}
Notation and assumptions as above.
The functor $\pi_!$ induces an equivalence of categories between
\begin{enumerate}
\item the category
$\textit{Lift}_\mathcal{O}(i_*\underline{\mathcal{G}}, A')$, and
\item the category $\textit{Lift}(\mathcal{G}, A')$.
\end{enumerate}
\end{lemma}

\begin{proof}
FIXME.
\end{proof}

\begin{lemma}
\label{lemma-second-equivalence-obs}
Notation and assumptions as in Lemma \ref{lemma-second-equivalence}.
Consider the object
$$
L = L(\Lambda, X, A, \mathcal{G}) = L\pi_!(Li^*(i_*(\underline{\mathcal{G}})))
$$
of $D(\mathcal{O}_X \otimes_\Lambda A)$. Given a surjection $A' \to A$ of
$\Lambda$-algebras with square zero kernel $I$ we have
\begin{enumerate}
\item The category $\textit{Lift}(\mathcal{G}, A')$ is nonempty
if and only if a certain class
$\xi \in \text{Ext}^2_{\mathcal{O}_X \otimes A}(L, \mathcal{G} \otimes_A I)$
is zero.
\item If $\textit{Lift}(\mathcal{G}, A')$ is nonempty, then
$\text{Lift}(\mathcal{G}, A')$ is principal homogeneous under
$\text{Ext}^1_{\mathcal{O}_X \otimes A}(L, \mathcal{G} \otimes_A I)$.
\item Given a lift $\mathcal{G}'$, the set of automorphisms of
$\mathcal{G}'$ which pull back to $\text{id}_\mathcal{G}$ is canonically
isomorphic to
$\text{Ext}^0_{\mathcal{O}_X \otimes A}(L, \mathcal{G} \otimes_A I)$.
\end{enumerate}
\end{lemma}

\begin{proof}
FIXME.
\end{proof}

\noindent
Finally, we put everything together as follows.

\begin{proposition}
\label{proposition-conclusion}
With $\Lambda$, $X$, $A$, $\mathcal{F}$ as above. There exists a canonical
object $L = L(\Lambda, X, A, \mathcal{F})$ of $D(X_A)$ such that given a
surjection $A' \to A$ of $\Lambda$-algebras with square zero kernel $I$ we
have
\begin{enumerate}
\item The category $\textit{Lift}(\mathcal{F}, A')$ is nonempty
if and only if a certain class $\xi \in \text{Ext}^2_{X_A}(L,
\mathcal{F} \otimes_A I)$ is zero.
\item If $\textit{Lift}(\mathcal{F}, A')$ is nonempty, then
$\text{Lift}(\mathcal{F}, A')$ is principal homogeneous under
$\text{Ext}^1_{X_A}(L, \mathcal{F} \otimes_A I)$.
\item Given a lift $\mathcal{F}'$, the set of automorphisms of
$\mathcal{F}'$ which pull back to $\text{id}_\mathcal{F}$ is canonically
isomorphic to
$\text{Ext}^0_{X_A}(L, \mathcal{F} \otimes_A I)$.
\end{enumerate}
\end{proposition}

\begin{proof}
FIXME.
\end{proof}

\begin{lemma}
\label{lemma-pseudo-coherent}
In the situation of Proposition \ref{proposition-conclusion}, if
$X \to \Spec(\Lambda)$ is locally of finite type and $\Lambda$ is Noetherian,
then $L$ is pseudo-coherent.
\end{lemma}

\begin{proof}
FIXME.
\end{proof}




\section{Modifications}
\label{section-modifications}

\noindent
Here is a obsolete result on the category of
Restricted Power Series, Equation (\ref{restricted-equation-modification}).
Please visit Restricted Power Series, Section
\ref{restricted-section-modifications}
for the current material.

\begin{lemma}
\label{lemma-henselian}
Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring.
The category of
Restricted Power Series, Equation (\ref{restricted-equation-modification})
for $A$ is equivalent to the category
Restricted Power Series, Equation (\ref{restricted-equation-modification})
for the henselization $A^h$ of $A$.
\end{lemma}

\begin{proof}
This is a special case of Restricted Power Series, Lemma
\ref{restricted-lemma-equivalence-to-completion}.
\end{proof}

\noindent
The following lemma on rational singularities is no longer needed
in the chapter on resolving surface singularities.

\begin{lemma}
\label{lemma-double-dual-rational}
In Resolution of Surfaces, Situation \ref{resolve-situation-rational}.
Let $M$ be a finite reflexive $A$-module. Let $M \otimes_A \mathcal{O}_X$
denote the pullback of the associated $\mathcal{O}_S$-module. Then
$M \otimes_A \mathcal{O}_X$ maps onto its double dual.
\end{lemma}

\begin{proof}
Let $\mathcal{F} = (M \otimes_A \mathcal{O}_X)^{**}$ be the double dual and
let $\mathcal{F}' \subset \mathcal{F}$ be the image of the evaluation map
$M \otimes_A \mathcal{O}_X \to \mathcal{F}$. Then we have a short exact
sequence
$$
0 \to \mathcal{F}' \to \mathcal{F} \to \mathcal{Q} \to 0
$$
Since $X$ is normal, the local rings $\mathcal{O}_{X, x}$ are discrete
valuation rings for points of codimension $1$ (see
Properties, Lemma \ref{properties-lemma-criterion-normal}).
Hence $\mathcal{Q}_x = 0$ for such points by
More on Algebra, Lemma \ref{more-algebra-lemma-cokernel-map-double-dual-dvr}.
Thus $\mathcal{Q}$ is supported in finitely many closed points and is
globally generated by
Cohomology of Schemes, Lemma \ref{coherent-lemma-coherent-support-dimension-0}.
We obtain the exact sequence
$$
0 \to H^0(X, \mathcal{F}') \to H^0(X, \mathcal{F}) \to H^0(X, \mathcal{Q}) \to 0
$$
because $\mathcal{F}'$ is generated by global sections
(Resolution of Surfaces, Lemma \ref{resolve-lemma-globally-generated}).
Since $X \to \Spec(A)$ is an isomorphism over the complement of the
closed point, and since $M$ is reflexive, we see that the maps
$$
M \to H^0(X, \mathcal{F}') \to H^0(X, \mathcal{F})
$$
induce isomorphisms after localization at any nonmaximal prime of $A$.
Hence these maps are isomorphisms by More on Algebra, Lemma
\ref{more-algebra-lemma-check-isomorphism-via-depth-and-ass}
and the fact that reflexive modules over normal rings have property $(S_2)$
(More on Algebra, Lemma \ref{more-algebra-lemma-reflexive-over-normal}).
Thus we conclude that $\mathcal{Q} = 0$ as desired.
\end{proof}



\section{Intersection theory}
\label{section-intersection-theory}

\begin{lemma}
\label{lemma-gysin-factors-principal}
Let $(S, \delta)$ be as in Chow Homology, Situation \ref{chow-situation-setup}.
Let $X$ be locally of finite type over $S$.
Let $X$ be integral and $n = \dim_\delta(X)$.
Let $a \in \Gamma(X, \mathcal{O}_X)$ be a nonzero function.
Let $i : D = Z(a) \to X$ be the closed immersion of the zero scheme of $a$.
Let $f \in R(X)^*$.
In this case $i^*\text{div}_X(f) = 0$ in $A_{n - 2}(D)$.
\end{lemma}

\begin{proof}
Special case of Chow Homology, Lemma \ref{chow-lemma-gysin-factors-general}.
\end{proof}






\section{Duplicate references}
\label{section-duplicates}

\noindent
This section is a place where we collect duplicates.

\begin{lemma}
\label{lemma-points-monomorphism}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
The map $\{\Spec(k) \to X \text{ monomorphism}\} \to |X|$ is injective.
\end{lemma}

\begin{proof}
This is a duplicate of
Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-monomorphism}.
\end{proof}

\begin{theorem}
\label{theorem-equivalence-sheaves-point}
Let $S = \Spec(K)$ with $K$ a field.
Let $\overline{s}$ be a geometric point of $S$.
Let $G = \text{Gal}_{\kappa(s)}$ denote the absolute Galois group.
Then there is an equivalence of categories
$\Sh(S_\etale) \to G\textit{-Sets}$,
$\mathcal{F} \mapsto \mathcal{F}_{\overline{s}}$.
\end{theorem}

\begin{proof}
This is a duplicate of \'Etale Cohomology, Theorem
\ref{etale-cohomology-theorem-equivalence-sheaves-point}.
\end{proof}

\begin{remark}
\label{remark-tangent-spaces}
You got here because of a duplicate tag. Please see
Formal Deformation Theory, Section \ref{formal-defos-section-tangent-spaces}
for the actual content.
\end{remark}








\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
