\input{preamble}

% OK, start here.
%
\begin{document}

\title{Local Cohomology}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This chapter continues the study of local cohomology.
A reference is \cite{SGA2}.
The definition of local cohomology can be found in
Dualizing Complexes, Section \ref{dualizing-section-local-cohomology}.
For Noetherian rings taking local cohomology is the same
as deriving a suitable torsion functor as is shown in
Dualizing Complexes, Section
\ref{dualizing-section-local-cohomology-noetherian}.
The relationship with depth can be found in
Dualizing Complexes, Section
\ref{dualizing-section-depth}.

\medskip\noindent
We discuss finiteness properties of local cohomology leading to a proof
of a fairly general version of
Grothendieck's finiteness theorem, see Theorem \ref{theorem-finiteness}
and Lemma \ref{lemma-finiteness-Rjstar} (higher direct images
of coherent modules under open immersions).
Our methods incorporate a few very slick arguments the reader
can find in papers of Faltings, see
\cite{Faltings-annulators} and \cite{Faltings-finiteness}.

\medskip\noindent
As applications we offer a discussion of
Hartshorne-Lichtenbaum vanishing. We also discuss
the action of Frobenius and of differential operators
on local cohomology.




\section{Generalities}
\label{section-generalities}

\noindent
The following lemma tells us that the functor $R\Gamma_Z$
is related to cohomology with supports.

\begin{lemma}
\label{lemma-local-cohomology-is-local-cohomology}
Let $A$ be a ring and let $I$ be a finitely generated ideal.
Set $Z = V(I) \subset X = \Spec(A)$. For $K \in D(A)$ corresponding
to $\widetilde{K} \in D_\QCoh(\mathcal{O}_X)$ via
Derived Categories of Schemes, Lemma \ref{perfect-lemma-affine-compare-bounded}
there is a functorial isomorphism
$$
R\Gamma_Z(K) = R\Gamma_Z(X, \widetilde{K})
$$
where on the left we have
Dualizing Complexes, Equation (\ref{dualizing-equation-local-cohomology})
and on the right we have the functor of
Cohomology, Section \ref{cohomology-section-cohomology-support}.
\end{lemma}

\begin{proof}
By Cohomology, Section \ref{cohomology-section-cohomology-support}
there exists a distinguished triangle
$$
R\Gamma_Z(X, \widetilde{K})
\to R\Gamma(X, \widetilde{K})
\to R\Gamma(U, \widetilde{K})
\to R\Gamma_Z(X, \widetilde{K})[1]
$$
where $U = X \setminus Z$. We know that $R\Gamma(X, \widetilde{K}) = K$
by Derived Categories of Schemes, Lemma
\ref{perfect-lemma-affine-compare-bounded}.
Say $I = (f_1, \ldots, f_r)$. Then we obtain a finite affine
open covering $\mathcal{U} : U = D(f_1) \cup \ldots \cup D(f_r)$.
By Derived Categories of Schemes, Lemma
\ref{perfect-lemma-alternating-cech-complex-complex-computes-cohomology}
the alternating {\v C}ech complex
$\text{Tot}(\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U},
\widetilde{K^\bullet}))$
computes $R\Gamma(U, \widetilde{K})$ where $K^\bullet$ is any
complex of $A$-modules representing $K$. Working through the
definitions we find
$$
R\Gamma(U, \widetilde{K}) =
\text{Tot}\left(
K^\bullet \otimes_A
(\prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r})\right)
$$
It is clear that
$K^\bullet = R\Gamma(X, \widetilde{K^\bullet}) \to
R\Gamma(U, \widetilde{K}^\bullet)$
is induced by the diagonal map from $A$ into $\prod A_{f_i}$.
Hence we conclude that
$$
R\Gamma_Z(X, \mathcal{F}^\bullet) =
\text{Tot}\left(
K^\bullet \otimes_A
(A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r})\right)
$$
By Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-adjoint}
this complex computes $R\Gamma_Z(K)$ and we see the lemma holds.
\end{proof}

\begin{lemma}
\label{lemma-local-cohomology}
Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal.
Set $X = \Spec(A)$, $Z = V(I)$, $U = X \setminus Z$, and $j : U \to X$
the inclusion morphism. Let $\mathcal{F}$ be a quasi-coherent
$\mathcal{O}_U$-module. Then
\begin{enumerate}
\item there exists an $A$-module $M$ such that $\mathcal{F}$ is the
restriction of $\widetilde{M}$ to $U$,
\item given $M$ there is an exact sequence
$$
0 \to H^0_Z(M) \to M \to H^0(U, \mathcal{F}) \to H^1_Z(M) \to 0
$$
and isomorphisms $H^p(U, \mathcal{F}) = H^{p + 1}_Z(M)$ for $p \geq 1$,
\item we may take $M = H^0(U, \mathcal{F})$ in which case
we have $H^0_Z(M) = H^1_Z(M) = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
The existence of $M$ follows from
Properties, Lemma \ref{properties-lemma-extend-trivial}
and the fact that quasi-coherent sheaves on $X$ correspond
to $A$-modules (Schemes, Lemma \ref{schemes-lemma-equivalence-quasi-coherent}).
Then we look at the distinguished triangle
$$
R\Gamma_Z(X, \widetilde{M}) \to R\Gamma(X, \widetilde{M}) \to
R\Gamma(U, \widetilde{M}|_U) \to R\Gamma_Z(X, \widetilde{M})[1]
$$
of Cohomology, Section \ref{cohomology-section-cohomology-support}.
Since $X$ is affine we have $R\Gamma(X, \widetilde{M}) = M$
by Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherent-affine-cohomology-zero}.
By our choice of $M$ we have $\mathcal{F} = \widetilde{M}|_U$
and hence this produces an exact sequence
$$
0 \to H^0_Z(X, \widetilde{M}) \to M \to H^0(U, \mathcal{F}) \to
H^1_Z(X, \widetilde{M}) \to 0
$$
and isomorphisms $H^p(U, \mathcal{F}) = H^{p + 1}_Z(X, \widetilde{M})$
for $p \geq 1$. By Lemma \ref{lemma-local-cohomology-is-local-cohomology}
we have $H^i_Z(M) = H^i_Z(X, \widetilde{M})$ for all $i$.
Thus (1) and (2) do hold.
Finally, setting $M' = H^0(U, \mathcal{F})$ we see that
the kernel and cokernel of $M \to M'$ are $I$-power torsion.
Therefore $\widetilde{M}|_U \to \widetilde{M'}|_U$ is an isomorphism
and we can indeed use $M'$ as predicted in (3). It goes without saying
that we obtain zero for both $H^0_Z(M')$ and $H^0_Z(M')$.
\end{proof}

\begin{lemma}
\label{lemma-already-torsion}
Let $I, J \subset A$ be finitely generated ideals of a ring $A$.
If $M$ is an $I$-power torsion module, then the
canonical map
$$
H^i_{V(I) \cap V(J)}(M) \to H^i_{V(J)}(M)
$$
is an isomorphism for all $i$.
\end{lemma}

\begin{proof}
Use the spectral sequence of
Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-ss}
to reduce to the statement $R\Gamma_I(M) = M$ which is immediate
from the construction of local cohomology
in Dualizing Complexes, Section \ref{dualizing-section-local-cohomology}.
\end{proof}

\begin{lemma}
\label{lemma-multiplicative}
Let $S \subset A$ be a multiplicative set of a ring $A$.
Let $M$ be an $A$-module with $S^{-1}M = 0$. Then
$\colim_{f \in S} H^0_{V(f)}(M) = M$ and
$\colim_{f \in S} H^1_{V(f)}(M) = 0$.
\end{lemma}

\begin{proof}
The statement on $H^0$ follows directly from the definitions.
To see the statement on $H^1$ observe that $R\Gamma_{V(f)}$
and $H^1_{V(f)}$ commute with colimits. Hence we may assume
$M$ is annihilated by some $f \in S$. Then
$H^1_{V(ff')}(M) = 0$ for all $f' \in S$ (for example by
Lemma \ref{lemma-already-torsion}).
\end{proof}

\begin{lemma}
\label{lemma-elements-come-from-bigger}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
Let $\mathfrak p$ be a prime ideal. Let $M$ be an $A$-module.
Let $i \geq 0$ be an integer and consider the map
$$
\Psi :
\colim_{f \in A, f \not \in \mathfrak p} H^i_{V((I, f))}(M)
\longrightarrow
H^i_{V(I)}(M)
$$
Then
\begin{enumerate}
\item $\Im(\Psi)$ is the set of elements which map to zero in
$H^i_{V(I)}(M)_\mathfrak p$,
\item if $H^{i - 1}_{V(I)}(M)_\mathfrak p = 0$, then $\Psi$ is injective,
\item if $H^{i - 1}_{V(I)}(M)_\mathfrak p = H^i_{V(I)}(M)_\mathfrak p = 0$,
then $\Psi$ is an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
For $f \in A$, $f \not \in \mathfrak p$ the spectral sequence of
Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-ss}
degenerates to give short exact sequences
$$
0 \to H^1_{V(f)}(H^{i - 1}_{V(I)}(M)) \to
H^i_{V((I, f))}(M) \to H^0_{V(f)}(H^i_{V(I)}(M)) \to 0
$$
This proves (1) and part (2) follows from this and
Lemma \ref{lemma-multiplicative}.
Part (3) is a formal consequence.
\end{proof}

\begin{lemma}
\label{lemma-isomorphism}
Let $I \subset I' \subset A$ be finitely generated ideals of a
Noetherian ring $A$. Let $M$ be an $A$-module. Let $i \geq 0$ be an integer.
Consider the map
$$
\Psi : H^i_{V(I')}(M) \to H^i_{V(I)}(M)
$$
The following are true:
\begin{enumerate}
\item if $H^i_{\mathfrak pA_\mathfrak p}(M_\mathfrak p) = 0$
for all $\mathfrak p \in V(I) \setminus V(I')$, then
$\Psi$ is surjective,
\item if $H^{i - 1}_{\mathfrak pA_\mathfrak p}(M_\mathfrak p) = 0$
for all $\mathfrak p \in V(I) \setminus V(I')$, then
$\Psi$ is injective,
\item if $H^i_{\mathfrak pA_\mathfrak p}(M_\mathfrak p) =
H^{i - 1}_{\mathfrak pA_\mathfrak p}(M_\mathfrak p) = 0$
for all $\mathfrak p \in V(I) \setminus V(I')$, then
$\Psi$ is an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1).
Let $\xi \in H^i_{V(I)}(M)$. Since $A$ is Noetherian, there exists a
largest ideal $I \subset I'' \subset I'$ such that $\xi$ is the image
of some $\xi'' \in H^i_{V(I'')}(M)$. If $V(I'') = V(I')$, then we are
done. If not, choose a generic point $\mathfrak p \in V(I'')$ not in $V(I')$.
Then we have $H^i_{V(I'')}(M)_\mathfrak p =
H^i_{\mathfrak pA_\mathfrak p}(M_\mathfrak p) = 0$ by assumption.
By Lemma \ref{lemma-elements-come-from-bigger} we can increase $I''$
which contradicts maximality.

\medskip\noindent
Proof of (2). Let $\xi' \in H^i_{V(I')}(M)$ be in the kernel of $\Psi$.
Since $A$ is Noetherian, there exists a
largest ideal $I \subset I'' \subset I'$ such that $\xi'$
maps to zero in $H^i_{V(I'')}(M)$. If $V(I'') = V(I')$, then we are
done. If not, then choose a generic point $\mathfrak p  \in V(I'')$
not in $V(I')$. Then we have $H^{i - 1}_{V(I'')}(M)_\mathfrak p =
H^{i - 1}_{\mathfrak pA_\mathfrak p}(M_\mathfrak p) = 0$ by assumption.
By Lemma \ref{lemma-elements-come-from-bigger} we can increase $I''$
which contradicts maximality.

\medskip\noindent
Part (3) is formal from parts (1) and (2).
\end{proof}








\section{Cohomological dimension}
\label{section-cd}

\noindent
A quick section about cohomological dimension.

\begin{lemma}
\label{lemma-cd}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
Set $Y = V(I) \subset X = \Spec(A)$. Let $d \geq -1$ be an integer.
The following are equivalent
\begin{enumerate}
\item $H^i_Y(A) = 0$ for $i > d$,
\item $H^i_Y(M) = 0$ for $i > d$ for every $A$-module $M$, and
\item if $d = -1$, then $Y = \emptyset$, if $d = 0$, then
$Y$ is open and closed in $X$, and if $d > 0$ then
$H^i(X \setminus Y, \mathcal{F}) = 0$ for $i \geq d$
for every quasi-coherent $\mathcal{O}_{X \setminus Y}$-module $\mathcal{F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Observe that $R\Gamma_Y(-)$ has finite cohomological dimension by
Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-adjoint}
for example. Hence we can choose a large integer $N$ such that
$H^i_Y(M) = 0$ for all $A$-modules $M$.

\medskip\noindent
Let us prove that (1) and (2) are equivalent. It is immediate that
(2) implies (1). Assume (1). Choose any $A$-module $M$ and fit it into
a short exact sequence $0 \to N \to F \to M \to 0$ where $F$ is a
free $A$-module. Since $R\Gamma_Y$ is a right adjoint, we see that
$H^i_Y(-)$ commutes with direct sums. Hence $H^i_Y(F) = 0$
for $i > d$ by assumption (1). Then we see that
$H^i_Y(M) = H^{i + 1}_Y(N)$ for all $i > d$.
Thus if we've shown the vanishing of $H^j_Y(N)$ for some
$j > d + 1$ and all $A$-modules $N$, then we obtain the
vanishing of $H^{j - 1}_Y(M)$ for all $A$-modules $M$.
By induction we find that (2) is true.

\medskip\noindent
Assume $d = -1$ and (2) holds. Then $0 = H^0_Y(A/I) = A/I \Rightarrow A = I
\Rightarrow Y = \emptyset$. Thus (3) holds. We omit the proof of the converse.

\medskip\noindent
Assume $d = 0$ and (2) holds. Set
$J = H^0_I(A) = \{x \in A \mid I^nx = 0 \text{ for some }n > 0\}$.
Then
$$
H^1_Y(A) = \Coker(A \to \Gamma(X \setminus Y, \mathcal{O}_{X \setminus Y}))
\quad\text{and}\quad
H^1_Y(I) = \Coker(I \to \Gamma(X \setminus Y, \mathcal{O}_{X \setminus Y}))
$$
and the kernel of the first map is equal to $J$. See
Lemma \ref{lemma-local-cohomology}.
We conclude from (2) that $I(A/J) = A/J$.
Thus we may pick $f \in I$
mapping to $1$ in $A/J$. Then $1 - f \in J$ so $I^n(1 - f) = 0$ for some
$n > 0$. Hence $f^n = f^{n + 1}$. Then $e = f^n \in I$ is an idempotent.
Consider the complementary idempotent $e' = 1 - f^n \in J$.
For any element $g \in I$ we have $g^m e' = 0$ for some $m > 0$.
Thus $I$ is contained in the radical of ideal $(e) \subset I$.
This means $Y = V(I) = V(e)$ is open and closed in $X$ as predicted in (3).
Conversely, if $Y = V(I)$ is open and closed, then the functor
$H^0_Y(-)$ is exact and has vanshing higher derived functors.

\medskip\noindent
If $d > 0$, then we see immediately from
Lemma \ref{lemma-local-cohomology} that (2) is equivalent to (3).
\end{proof}

\begin{definition}
\label{definition-cd}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
The smallest integer $d \geq -1$ satisfying the equivalent conditions
of Lemma \ref{lemma-cd} is called the
{\it cohomological dimension of $I$ in $A$} and is
denoted $\text{cd}(A, I)$.
\end{definition}

\noindent
Thus we have $\text{cd}(A, I) = -1$ if
$I = A$ and $\text{cd}(A, I) = 0$ if $I$ is locally nilpotent
or generated by an idempotent.
Observe that $\text{cd}(A, I)$ exists by the following lemma.

\begin{lemma}
\label{lemma-bound-cd}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
Then
\begin{enumerate}
\item $\text{cd}(A, I)$ is at most equal to the number of
generators of $I$,
\item $\text{cd}(A, I) \leq r$ if there exist $f_1, \ldots, f_r \in A$
such that $V(f_1, \ldots, f_r) = V(I)$,
\item $\text{cd}(A, I) \leq c$ if $\Spec(A) \setminus V(I)$
can be covered by $c$ affine opens.
\end{enumerate}
\end{lemma}

\begin{proof}
The explicit description for $R\Gamma_Y(-)$ given in
Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-adjoint}
shows that (1) is true. We can deduce (2) from (1) using the
fact that $R\Gamma_Z$ depends only on the closed subset
$Z$ and not on the choice of the finitely generated ideal
$I \subset A$ with $V(I) = Z$. This follows either from the
construction of local cohomology in
Dualizing Complexes, Section \ref{dualizing-section-local-cohomology}
combined with
More on Algebra, Lemma \ref{more-algebra-lemma-local-cohomology-closed}.
or it follows from Lemma \ref{lemma-local-cohomology-is-local-cohomology}.
To see (3) we use Lemma \ref{lemma-cd}
and the vanishing result of Cohomology of Schemes, Lemma
\ref{coherent-lemma-vanishing-nr-affines}.
\end{proof}

\begin{lemma}
\label{lemma-cd-sum}
Let $I, J \subset A$ be finitely generated ideals of a ring $A$.
Then $\text{cd}(A, I + J) \leq \text{cd}(A, I) + \text{cd}(A, J)$.
\end{lemma}

\begin{proof}
Use the definition and Dualizing Complexes, Lemma
\ref{dualizing-lemma-local-cohomology-ss}.
\end{proof}

\begin{lemma}
\label{lemma-cd-change-rings}
Let $A \to B$ be a ring map. Let $I \subset A$ be a finitely generated ideal.
Then $\text{cd}(B, IB) \leq \text{cd}(A, I)$. If $A \to B$ is faithfully
flat, then equality holds.
\end{lemma}

\begin{proof}
Use the definition and
Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}.
\end{proof}

\begin{lemma}
\label{lemma-cd-local}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
Then $\text{cd}(A, I) = \max \text{cd}(A_\mathfrak p, I_\mathfrak p)$.
\end{lemma}

\begin{proof}
Let $Y = V(I)$ and $Y' = V(I_\mathfrak p) \subset \Spec(A_\mathfrak p)$.
Recall that
$R\Gamma_Y(A) \otimes_A A_\mathfrak p = R\Gamma_{Y'}(A_\mathfrak p)$
by Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}.
Thus we conclude by Algebra, Lemma \ref{algebra-lemma-characterize-zero-local}.
\end{proof}

\begin{lemma}
\label{lemma-cd-dimension}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
If $M$ is a finite $A$-module, then
$H^i_{V(I)}(M) = 0$ for $i > \dim(\text{Supp}(M))$.
In particular, we have $\text{cd}(A, I) \leq \dim(A)$.
\end{lemma}

\begin{proof}
We first prove the second statement.
Recall that $\dim(A)$ denotes the Krull dimension. By
Lemma \ref{lemma-cd-local} we may assume $A$ is local.
If $V(I) = \emptyset$, then the result is true.
If $V(I) \not = \emptyset$, then
$\dim(\Spec(A) \setminus V(I)) < \dim(A)$ because
the closed point is missing. Observe that
$U = \Spec(A) \setminus V(I)$ is a quasi-compact
open of the spectral space $\Spec(A)$, hence a spectral space itself.
See Algebra, Lemma \ref{algebra-lemma-spec-spectral} and
Topology, Lemma \ref{topology-lemma-spectral-sub}.
Thus Cohomology, Proposition
\ref{cohomology-proposition-cohomological-dimension-spectral}
implies $H^i(U, \mathcal{F}) = 0$ for $i \geq \dim(A)$
which implies what we want by Lemma \ref{lemma-cd}.
In the Noetherian case the reader may use
Grothendieck's Cohomology, Proposition
\ref{cohomology-proposition-vanishing-Noetherian}.

\medskip\noindent
We will deduce the first statement from the second.
Let $\mathfrak a$ be the annihilator of the finite $A$-module $M$.
Set $B = A/\mathfrak a$. Recall that $\Spec(B) = \text{Supp}(M)$, see
Algebra, Lemma \ref{algebra-lemma-support-closed}.
Set $J = IB$. Then $M$ is a $B$-module
and $H^i_{V(I)}(M) = H^i_{V(J)}(M)$, see
Dualizing Complexes, Lemma
\ref{dualizing-lemma-local-cohomology-and-restriction}.
Since $\text{cd}(B, J) \leq \dim(B) = \dim(\text{Supp}(M))$
by the first part we conclude.
\end{proof}

\begin{lemma}
\label{lemma-cd-is-one}
Let $I \subset A$ be a finitely generated ideal of a ring $A$. If
$\text{cd}(A, I) = 1$ then $\Spec(A) \setminus V(I)$ is nonempty affine.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-cd} and
Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-compact-h1-zero-covering}.
\end{proof}

\begin{lemma}
\label{lemma-cd-maximal}
Let $(A, \mathfrak m)$ be a Noetherian local ring of dimension $d$.
Then $H^d_\mathfrak m(A)$ is nonzero and $\text{cd}(A, \mathfrak m) = d$.
\end{lemma}

\begin{proof}
By one of the characterizations of dimension, there exists
an ideal of definition for $A$ generated by $d$ elements, see
Algebra, Proposition \ref{algebra-proposition-dimension}.
Hence $\text{cd}(A, \mathfrak m) \leq d$ by
Lemma \ref{lemma-bound-cd}. Thus $H^d_\mathfrak m(A)$ is
nonzero if and only if $\text{cd}(A, \mathfrak m) = d$ if and only if
$\text{cd}(A, \mathfrak m) \geq d$.

\medskip\noindent
Let $A \to A^\wedge$ be the map from $A$ to its completion.
Observe that $A^\wedge$ is a Noetherian local ring of the
same dimension as $A$ with maximal ideal $\mathfrak m A^\wedge$.
See Algebra, Lemmas
\ref{algebra-lemma-completion-Noetherian-Noetherian},
\ref{algebra-lemma-completion-complete}, and
\ref{algebra-lemma-completion-faithfully-flat} and
More on Algebra, Lemma \ref{more-algebra-lemma-completion-dimension}.
By Lemma \ref{lemma-cd-change-rings}
it suffices to prove the lemma for $A^\wedge$.

\medskip\noindent
By the previous paragraph we may assume that $A$ is
a complete local ring. Then $A$ has a normalized dualizing complex
$\omega_A^\bullet$ (Dualizing Complexes, Lemma
\ref{dualizing-lemma-ubiquity-dualizing}).
The local duality theorem (in the form of
Dualizing Complexes, Lemma \ref{dualizing-lemma-special-case-local-duality})
tells us $H^d_\mathfrak m(A)$ is Matlis dual to
$\text{Ext}^{-d}(A, \omega_A^\bullet) = H^{-d}(\omega_A^\bullet)$
which is nonzero for example by
Dualizing Complexes, Lemma
\ref{dualizing-lemma-nonvanishing-generically-local}.
\end{proof}

\begin{lemma}
\label{lemma-cd-bound-dim-local}
Let $(A, \mathfrak m)$ be a Noetherian local ring.
Let $I \subset A$ be a proper ideal.
Let $\mathfrak p \subset A$ be a prime ideal
such that $V(\mathfrak p) \cap V(I) = \{\mathfrak m\}$.
Then $\dim(A/\mathfrak p) \leq \text{cd}(A, I)$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-cd-change-rings} we have
$\text{cd}(A, I) \geq \text{cd}(A/\mathfrak p, I(A/\mathfrak p))$.
Since $V(I) \cap V(\mathfrak p) = \{\mathfrak m\}$ we have
$\text{cd}(A/\mathfrak p, I(A/\mathfrak p)) =
\text{cd}(A/\mathfrak p, \mathfrak m/\mathfrak p)$.
By Lemma \ref{lemma-cd-maximal} this is equal to $\dim(A/\mathfrak p)$.
\end{proof}

\begin{lemma}
\label{lemma-cd-sequence-Koszul}
Let $I$ be an ideal of a Noetherian ring $A$. Set $d = \text{cd}(A, I)$.
For $n \geq 1$ choose a finite free resolution
$$
\ldots \to
P_n^{-2} \to
P_n^{-1} \to
P_n^0 \to A/I^n \to 0
$$
For every $n \geq 1$ there exists an $m > n$ such that
$A/I^m \to A/I^n$ can be represented by a map of complexes
$\alpha^\bullet : P^\bullet_m \to P^\bullet_n$ with
$\alpha^i = 0$ for $i < -d$.
\end{lemma}

\begin{proof}
We assume $d \geq 1$; the proof in the cases $d = -1, 0$ is omitted.
Denote $d_n^i : P^i \to P^{i + 1}$ the differentials.
Set $M = \Im(d_n^{-d - 1} : P_n^{-d - 1} \to P_n^{-d})$.
Denote $\xi = d_n^{-d - 1} \in \Hom_A(P_n^{-d - 1}, M)$.
Since $\xi \circ d_n^{-d - 2} = 0$ we see that
$\xi$ defines an element $\overline{\xi}$ of $\Ext^{d + 1}_A(A/I^n, M)$.
Since $\text{cd}(A, I) = d$ we have
$0 = H^{d + 1}_Z(M) = H^{d + 1}_I(M) = \colim \Ext^{d + 1}(A/I^m, M)$.
Here we have used Dualizing Complexes, Lemmas
\ref{dualizing-lemma-local-cohomology-noetherian} and
\ref{dualizing-lemma-local-cohomology-ext}.
Thus we may pick $m$ such that $\overline{\xi}$ maps to
zero in $\Ext^{d + 1}_A(A/I^m, M)$. Choose any map
of complexes $\alpha^\bullet : P_m^\bullet \to P_n^\bullet$
representing $A/I^m \to A/I^n$. The choice of $m$ implies
we can find $\varphi : P_m^{-d} \to M$
such that
$$
\xi \circ \alpha^{-d - 1} = \varphi \circ d_m^{-d - 1}
$$
If we think of $\varphi$ as a map $P_m^{-d} \to P_n^{-d}$, then
we see that $d_n^{-d} \circ \varphi = 0$ and
$\alpha^{-d} \circ d_m^{-d - 1} = d_n^{-d - 1} \circ \alpha^{-d - 1}
= \varphi \circ d_m^{-d - 1}$.
Thus we obtain a map of complexes
$$
\xymatrix{
\ldots \ar[r] &
P_n^{-d - 1} \ar[r] &
P_n^{-d} \ar[r] &
P_n^{-d + 1} \ar[r] &
\ldots \\
\ldots \ar[r] &
P_m^{-d - 1} \ar[r] \ar[u]_0 &
P_m^{-d} \ar[r] \ar[u]_{\alpha^{-d} - \varphi} &
P_m^{-d + 1} \ar[u]_{\alpha^{-d + 1}} \ar[r] &
\ldots
}
$$
and everything is clear.
\end{proof}

\begin{lemma}
\label{lemma-cd-blowup}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $b : X' \to X = \Spec(A)$ be the blowing up of $I$.
If the fibres of $b$ have dimension $\leq d - 1$, then
$\text{cd}(A, I) \leq d$.
\end{lemma}

\begin{proof}
Set $U = X \setminus V(I)$. Denote $j : U \to X'$ the canonical open
immersion, see Divisors, Section \ref{divisors-section-blowing-up}.
Since the exceptional divisor is an effective Cartier divisor
(Divisors, Lemma
\ref{divisors-lemma-blowing-up-gives-effective-Cartier-divisor})
we see that $j$ is affine, see
Divisors, Lemma
\ref{divisors-lemma-complement-locally-principal-closed-subscheme}.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_U$-module.
Then $R^pj_*\mathcal{F} = 0$ for $p > 0$, see
Cohomology of Schemes, Lemma
\ref{coherent-lemma-relative-affine-vanishing}.
On the other hand, we have $R^qb_*(j_*\mathcal{F}) = 0$ for
$q \geq d$ by Limits, Lemma
\ref{limits-lemma-higher-direct-images-zero-above-dimension-fibre}.
Thus by the Leray spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-relative-Leray})
we conclude that $R^n(b \circ j)_*\mathcal{F} = 0$ for
$n \geq d$. Thus $H^n(U, \mathcal{F}) = 0$ for $n \geq d$
(by Cohomology, Lemma \ref{cohomology-lemma-apply-Leray}).
This means that $\text{cd}(A, I) \leq d$ by definition.
\end{proof}







\section{More general supports}
\label{section-supports}

\noindent
Let $A$ be a Noetherian ring. Let $M$ be an $A$-module.
Let $T \subset \Spec(A)$ be a subset stable under specialization
(Topology, Definition \ref{topology-definition-specialization}).
Let us define
$$
H^0_T(M) = \colim_{Z \subset T} H^0_Z(M)
$$
where the colimit is over the directed partially ordered set of
closed subsets $Z$ of $\Spec(A)$ contained in
$T$\footnote{Since $T$ is stable under specialization
we have $T = \bigcup_{Z \subset T} Z$, see
Topology, Lemma \ref{topology-lemma-stable-specialization}.}.
In other words, an element $m$ of $M$ is in $H^0_T(M) \subset M$
if and only if the support $V(\text{Ann}_R(m))$ of $m$
is contained in $T$.

\begin{lemma}
\label{lemma-support}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$ be a subset stable
under specialization. For an $A$-module $M$ the following are equivalent
\begin{enumerate}
\item $H^0_T(M) = M$, and
\item $\text{Supp}(M) \subset T$.
\end{enumerate}
The category of such $A$-modules is a Serre subcategory
of the category $A$-modules closed under direct sums.
\end{lemma}

\begin{proof}
The equivalence holds because the support of an element of $M$
is contained in the support of $M$ and conversely the support of
$M$ is the union of the supports of its elements.
The category of these modules is a Serre subcategory
(Homology, Definition \ref{homology-definition-serre-subcategory})
of $\text{Mod}_A$ by
Algebra, Lemma \ref{algebra-lemma-support-quotient}.
We omit the proof of the statement on direct sums.
\end{proof}

\noindent
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$ be a subset stable
under specialization. Let us denote $\text{Mod}_{A, T} \subset \text{Mod}_A$
the Serre subcategory described in Lemma \ref{lemma-support}.
Let us denote $D_T(A) \subset D(A)$ the
strictly full saturated triangulated subcategory of $D(A)$
(Derived Categories, Lemma \ref{derived-lemma-cohomology-in-serre-subcategory})
consisting of complexes of $A$-modules whose cohomology modules
are in $\text{Mod}_{A, T}$. We obtain functors
$$
D(\text{Mod}_{A, T}) \to D_T(A) \to D(A)
$$
See discussion in
Derived Categories, Section \ref{derived-section-triangulated-sub}.
Denote $RH^0_T : D(A) \to D(\text{Mod}_{A, T})$ the right
derived extension of $H^0_T$. We will denote
$$
R\Gamma_T : D^+(A) \to D^+_T(A),
$$
the composition of $RH^0_T : D^+(A) \to D^+(\text{Mod}_{A, T})$ with
$D^+(\text{Mod}_{A, T}) \to D^+_T(A)$. If the dimension of $A$ is
finite\footnote{If $\dim(A) = \infty$ the construction
may have unexpected properties on unbounded complexes.},
then we will denote
$$
R\Gamma_T : D(A) \to D_T(A)
$$
the composition of $RH^0_T$ with
$D(\text{Mod}_{A, T}) \to D_T(A)$.

\begin{lemma}
\label{lemma-adjoint}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$
be a subset stable under specialization. The functor
$RH^0_T$ is the right adjoint to the functor
$D(\text{Mod}_{A, T}) \to D(A)$.
\end{lemma}

\begin{proof}
This follows from the fact that the functor $H^0_T(-)$ is
the right adjoint to the inclusion functor
$\text{Mod}_{A, T} \to \text{Mod}_A$, see
Derived Categories, Lemma \ref{derived-lemma-derived-adjoint-functors}.
\end{proof}

\begin{lemma}
\label{lemma-adjoint-ext}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$
be a subset stable under specialization.
For any object $K$ of $D(A)$ we have
$$
H^i(RH^0_T(K)) = \colim_{Z \subset T\text{ closed}} H^i_Z(K)
$$
\end{lemma}

\begin{proof}
Let $J^\bullet$ be a K-injective complex representing $K$.
By definition $RH^0_T$ is represented by the complex
$$
H^0_T(J^\bullet) = \colim H^0_Z(J^\bullet)
$$
where the equality follows from our definition of $H^0_T$.
Since filtered colimits are exact the cohomology of this
complex in degree $i$ is
$\colim H^i(H^0_Z(J^\bullet)) = \colim H^i_Z(K)$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-equal-plus}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$ be a subset stable
under specialization. The functor $D^+(\text{Mod}_{A, T}) \to D^+_T(A)$
is an equivalence.
\end{lemma}

\begin{proof}
Let $M$ be an object of $\text{Mod}_{A, T}$. Choose an embedding
$M \to J$ into an injective $A$-module. By
Dualizing Complexes, Proposition
\ref{dualizing-proposition-structure-injectives-noetherian}
the module $J$ is a direct sum of injective hulls of residue fields.
Let $E$ be an injective hull of the residue field of $\mathfrak p$.
Since $E$ is $\mathfrak p$-power torsion we see that
$H^0_T(E) = 0$ if $\mathfrak p \not \in T$ and
$H^0_T(E) = E$ if $\mathfrak p \in T$.
Thus $H^0_T(J)$ is injective as a direct sum of injective hulls
(by the proposition) and we have an embedding $M \to H^0_T(J)$.
Thus every object $M$ of $\text{Mod}_{A, T}$ has an injective resolution
$M \to J^\bullet$ with $J^n$ also in $\text{Mod}_{A, T}$. It follows
that $RH^0_T(M) = M$.

\medskip\noindent
Next, suppose that $K \in D_T^+(A)$. Then the spectral sequence
$$
R^qH^0_T(H^p(K)) \Rightarrow R^{p + q}H^0_T(K)
$$
(Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor})
converges and above we have seen that only the terms with $q = 0$
are nonzero. Thus we see that $RH^0_T(K) \to K$ is an isomorphism.
Thus the functor $D^+(\text{Mod}_{A, T}) \to D^+_T(A)$
is an equivalence with quasi-inverse given by $RH^0_T$.
\end{proof}

\begin{lemma}
\label{lemma-equal-full}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$ be a subset stable
under specialization. If $\dim(A) < \infty$, then functor
$D(\text{Mod}_{A, T}) \to D_T(A)$ is an equivalence.
\end{lemma}

\begin{proof}
Say $\dim(A) = d$. Then we see that $H^i_Z(M) = 0$ for $i > d$
for every closed subset $Z$ of $\Spec(A)$, see
Lemma \ref{lemma-cd-dimension}.
By Lemma \ref{lemma-adjoint-ext} we find that $H^0_T$ has bounded
cohomological dimension.

\medskip\noindent
Let $K \in D_T(A)$. We claim that $RH^0_T(K) \to K$ is an
isomorphism. We know this is true when $K$ is bounded below, see
Lemma \ref{lemma-equal-plus}. However, since $H^0_T$ has bounded
cohomological dimension, we see that the $i$th cohomology of
$RH_T^0(K)$ only depends on $\tau_{\geq -d + i}K$ and we conclude.
Thus $D(\text{Mod}_{A, T}) \to D_T(A)$ is an equivalence with
quasi-inverse $RH^0_T$.
\end{proof}

\begin{remark}
\label{remark-upshot}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$ be a
subset stable under specialization.
The upshot of the discussion above is that
$R\Gamma_T : D^+(A) \to D_T^+(A)$ is the right adjoint
to the inclusion functor $D_T^+(A) \to D^+(A)$.
If $\dim(A) < \infty$, then
$R\Gamma_T : D(A) \to D_T(A)$ is the right adjoint
to the inclusion functor $D_T(A) \to D(A)$.
In both cases we have
$$
H^i_T(K) = H^i(R\Gamma_T(K)) = R^iH^0_T(K) =
\colim_{Z \subset T\text{ closed}} H^i_Z(K)
$$
This follows by combining
Lemmas \ref{lemma-adjoint}, \ref{lemma-adjoint-ext},
\ref{lemma-equal-plus}, and \ref{lemma-equal-full}.
\end{remark}

\begin{lemma}
\label{lemma-torsion-change-rings}
Let $A \to B$ be a flat homomorphism of Noetherian rings.
Let $T \subset \Spec(A)$ be a subset stable under specialization.
Let $T' \subset \Spec(B)$ be the inverse image of $T$.
Then the canonical map
$$
R\Gamma_T(K) \otimes_A^\mathbf{L} B
\longrightarrow
R\Gamma_{T'}(K \otimes_A^\mathbf{L} B)
$$
is an isomorphism for $K \in D^+(A)$. If $A$ and $B$ have finite
dimension, then this is true for $K \in D(A)$.
\end{lemma}

\begin{proof}
From the map $R\Gamma_T(K) \to K$ we get a map
$R\Gamma_T(K) \otimes_A^\mathbf{L} B \to K \otimes_A^\mathbf{L} B$.
The cohomology modules of $R\Gamma_T(K) \otimes_A^\mathbf{L} B$
are supported on $T'$ and hence we get the arrow of the lemma.
This arrow is an isomorphism if $T$ is a closed subset of $\Spec(A)$ by
Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}.
Recall that $H^i_T(K)$ is the colimit of $H^i_Z(K)$ where $Z$ runs over
the (directed set of) closed subsets of $T$, see
Lemma \ref{lemma-adjoint-ext}.
Correspondingly
$H^i_{T'}(K \otimes_A^\mathbf{L} B) =
\colim H^i_{Z'}(K \otimes_A^\mathbf{L} B)$ where $Z'$ is the inverse
image of $Z$. Thus the result because $\otimes_A B$ commutes
with filtered colimits and there are no higher Tors.
\end{proof}

\begin{lemma}
\label{lemma-local-cohomology-ss}
Let $A$ be a ring and let $T, T' \subset \Spec(A)$ subsets
stable under specialization. For $K \in D^+(A)$
there is a spectral sequence
$$
E_2^{p, q} = H^p_T(H^p_{T'}(K)) \Rightarrow H^{p + q}_{T \cap T'}(K)
$$
as in Derived Categories, Lemma
\ref{derived-lemma-grothendieck-spectral-sequence}.
\end{lemma}

\begin{proof}
Let $E$ be an object of $D_{T \cap T'}(A)$. Then we have
$$
\Hom(E, R\Gamma_T(R\Gamma_{T'}(K))) =
\Hom(E, R\Gamma_{T'}(K)) =
\Hom(E, K)
$$
The first equality by the adjointness property of $R\Gamma_T$
and the second by the adjointness property of $R\Gamma_{T'}$.
On the other hand, if $J^\bullet$ is a bounded below complex
of injectives representing $K$, then $H^0_{T'}(J^\bullet)$
is a complex of injective $A$-modules representing $R\Gamma_{T'}(K)$
and hence $H^0_T(H^0_{T'}(J^\bullet))$ is a complex representing
$R\Gamma_T(R\Gamma_{T'}(K))$. Thus $R\Gamma_T(R\Gamma_{T'}(K))$
is an object of $D^+_{T \cap T'}(A)$. Combining these two
facts we find that $R\Gamma_{T \cap T'} = R\Gamma_T \circ R\Gamma_{T'}$.
This produces the spectral sequence by the lemma referenced
in the statement.
\end{proof}

\begin{lemma}
\label{lemma-torsion-tensor-product}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$ be a subset
stable under specialization. Assume $A$ has finite dimension. Then
$$
R\Gamma_T(K) = R\Gamma_T(A) \otimes_A^\mathbf{L} K
$$
for $K \in D(A)$. For $K, L \in D(A)$ we have
$$
R\Gamma_T(K \otimes_A^\mathbf{L} L) =
K \otimes_A^\mathbf{L} R\Gamma_T(L) =
R\Gamma_T(K) \otimes_A^\mathbf{L} L =
R\Gamma_T(K) \otimes_A^\mathbf{L} R\Gamma_T(L)
$$
If $K$ or $L$ is in $D_T(A)$ then so is $K \otimes_A^\mathbf{L} L$.
\end{lemma}

\begin{proof}
By construction we may represent $R\Gamma_T(A)$ by a complex $J^\bullet$ in
$\text{Mod}_{A, T}$. Thus if we represent $K$ by a K-flat complex $K^\bullet$
then we see that $R\Gamma_T(A) \otimes_A^\mathbf{L} K$ is represented
by the complex $\text{Tot}(J^\bullet \otimes_A K^\bullet)$ in
$\text{Mod}_{A, T}$. Using the map $R\Gamma_T(A) \to A$ we obtain
a map $R\Gamma_T(A) \otimes_A^\mathbf{L} K\to K$. Thus by the adjointness
property of $R\Gamma_T$ we obtain a canonical map
$$
R\Gamma_T(A) \otimes_A^\mathbf{L} K \longrightarrow R\Gamma_T(K)
$$
factoring the just constructed map. Observe that $R\Gamma_T$ commutes
with direct sums in $D(A)$ for example by Lemma \ref{lemma-adjoint-ext},
the fact that directed colimits commute with direct sums, and the
fact that usual local cohomology commutes with direct sums
(for example by Dualizing Complexes, Lemma
\ref{dualizing-lemma-local-cohomology-adjoint}).
Thus by More on Algebra, Remark \ref{more-algebra-remark-P-resolution}
it suffices to check the map is an isomorphism for
$K = A[k]$ where $k \in \mathbf{Z}$. This is clear.

\medskip\noindent
The final statements follow from the result we've just shown
by transitivity of derived tensor products.
\end{proof}





\section{Filtrations on local cohomology}
\label{section-filter-local-cohomology}

\noindent
Some tricks related to the spectral sequence of
Lemma \ref{lemma-local-cohomology-ss}.

\begin{lemma}
\label{lemma-filter-local-cohomology}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$
be a subset stable under specialization. Let $T' \subset T$ be
the set of nonminimal primes in $T$. Then $T'$
is a subset of $\Spec(A)$ stable under specialization
and for every $A$-module $M$ there is an exact sequence
$$
0 \to
\colim_{Z, f} H^1_f(H^{i - 1}_Z(M)) \to
H^i_{T'}(M) \to H^i_T(M) \to
\bigoplus\nolimits_{\mathfrak p \in T \setminus T'}
H^i_{\mathfrak p A_\mathfrak p}(M_\mathfrak p)
$$
where the colimit is over closed subsets $Z \subset T$
and $f \in A$ with $V(f) \cap Z \subset T'$.
\end{lemma}

\begin{proof}
For every $Z$ and $f$ the spectral sequence of
Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-ss}
degenerates to give short exact sequences
$$
0 \to H^1_f(H^{i - 1}_Z(M)) \to
H^i_{Z \cap V(f)}(M) \to H^0_f(H^i_Z(M)) \to 0
$$
We will use this without further mention below.

\medskip\noindent
Let $\xi \in H^i_T(M)$ map to zero in the direct sum.
Then we first write $\xi$ as the image of some $\xi' \in H^i_Z(M)$
for some closed subset $Z \subset T$, see Lemma \ref{lemma-adjoint-ext}.
Then $\xi'$ maps to zero in $H^i_{\mathfrak p A_\mathfrak p}(M_\mathfrak p)$
for every $\mathfrak p \in Z$, $\mathfrak p \not \in T'$.
Since there are finitely many of these primes,
we may choose $f \in A$ not contained in any of these
such that $f$ annihilates $\xi'$. Then $\xi'$
is the image of some $\xi'' \in H^i_{Z'}(M)$
where $Z' = Z \cap V(f)$. By our choice of $f$ we have
$Z' \subset T'$ and we get exactness at the penultimate spot.

\medskip\noindent
Let $\xi \in H^i_{T'}(M)$ map to zero in $H^i_T(M)$.
Choose closed subsets $Z' \subset Z$ with $Z' \subset T'$
and $Z \subset T$ such that $\xi$ comes from $\xi' \in H^i_{Z'}(M)$
and maps to zero in $H^i_Z(M)$. Then we can find $f \in A$
with $V(f) \cap Z = Z'$ and we conclude.
\end{proof}

\begin{lemma}
\label{lemma-zero}
Let $A$ be a Noetherian ring of finite dimension.
Let $T \subset \Spec(A)$ be a subset stable under specialization.
Let $\{M_n\}_{n \geq 0}$ be an inverse system of $A$-modules.
Let $i \geq 0$ be an integer. Assume that for every $m$ there
exists an integer $m'(m) \geq m$ such  that for all
$\mathfrak p \in T$ the induced map
$$
H^i_{\mathfrak p A_\mathfrak p}(M_{k, \mathfrak p})
\longrightarrow
H^i_{\mathfrak p A_\mathfrak p}(M_{m, \mathfrak p})
$$
is zero for $k \geq m'(m)$. Let $m'' : \mathbf{N} \to \mathbf{N}$
be the $2^{\dim(T)}$-fold self-composition of $m'$. Then the map
$H^i_T(M_k) \to H^i_T(M_m)$ is zero for all $k \geq m''(m)$.
\end{lemma}

\begin{proof}
We first make a general remark: suppose we have an exact
sequence
$$
(A_n) \to (B_n) \to (C_n)
$$
of inverse systems of abelian groups. Suppose that for every
$m$ there exists an integer $m'(m) \geq m$ such that
$$
A_k \to A_m
\quad\text{and}\quad
C_k \to C_m
$$
are zero for $k \geq m'(m)$. Then for $k \geq m'(m'(m))$
the map $B_k \to B_m$ is zero.

\medskip\noindent
We will prove the lemma by induction on $\dim(T)$ which is
finite because $\dim(A)$ is finite. Let $T' \subset T$ be
the set of nonminimal primes in $T$. Then $T'$
is a subset of $\Spec(A)$ stable under specialization
and the hypotheses of the lemma apply to $T'$.
Since $\dim(T') < \dim(T)$ we know the lemma holds for $T'$.
For every $A$-module $M$ there is an exact sequence
$$
H^i_{T'}(M) \to H^i_T(M) \to
\bigoplus\nolimits_{\mathfrak p \in T \setminus T'}
H^i_{\mathfrak p A_\mathfrak p}(M_\mathfrak p)
$$
by Lemma \ref{lemma-filter-local-cohomology}.
Thus we conclude by the initial remark of the proof.
\end{proof}

\begin{lemma}
\label{lemma-essential-image}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$ be a subset
stable under specialization. Let $\{M_n\}_{n \geq 0}$ be an inverse system
of $A$-modules. Let $i \geq 0$ be an integer. Assume the dimension of $A$
is finite and that for every $m$ there exists an integer $m'(m) \geq m$
such that for all $\mathfrak p \in T$ we have
\begin{enumerate}
\item $H^{i - 1}_{\mathfrak p A_\mathfrak p}(M_{k, \mathfrak p})
\to H^{i - 1}_{\mathfrak p A_\mathfrak p}(M_{m, \mathfrak p})$
is zero for $k \geq m'(m)$, and
\item $ H^i_{\mathfrak p A_\mathfrak p}(M_{k, \mathfrak p}) \to
H^i_{\mathfrak p A_\mathfrak p}(M_{m, \mathfrak p})$
has image $G(\mathfrak p, m)$ independent of $k \geq m'(m)$ and moreover
$G(\mathfrak p, m)$ maps injectively into
$H^i_{\mathfrak p A_\mathfrak p}(M_{0, \mathfrak p})$.
\end{enumerate}
Then there exists an integer $m_0$ such that for every $m \geq m_0$
there exists an integer $m''(m) \geq m$ such that
for $k \geq m''(m)$ the image of $H^i_T(M_k) \to H^i_T(M_m)$
maps injectively into $H^i_T(M_{m_0})$.
\end{lemma}

\begin{proof}
We first make a general remark: suppose we have an exact
sequence
$$
(A_n) \to (B_n) \to (C_n) \to (D_n)
$$
of inverse systems of abelian groups. Suppose that there exists
an integer $m_0$ such that for every $m \geq m_0$
there exists an integer $m'(m) \geq m$ such that the maps
$$
\Im(B_k \to B_m) \longrightarrow B_{m_0}
\quad\text{and}\quad
\Im(D_k \to D_m) \longrightarrow D_{m_0}
$$
are injective for $k \geq m'(m)$ and $A_k \to A_m$ is zero
for $k \geq m'(m)$. Then for $m \geq m'(m_0)$ and $k \geq m'(m'(m))$
the map
$$
\Im(C_k \to C_m) \to C_{m'(m_0)}
$$
is injective. Namely, let $c_0 \in C_m$ be the image of $c_3 \in C_k$
and say $c_0$ maps to zero in $C_{m'(m_0)}$. Picture
$$
C_k \to C_{m'(m'(m))} \to C_{m'(m)} \to C_m \to C_{m'(m_0)},\quad
c_3 \mapsto c_2 \mapsto c_1 \mapsto c_0 \mapsto 0
$$
We have to show $c_0 = 0$.
The image $d_3$ of $c_3$ maps to zero in $C_{m_0}$ and hence
we see that the image $d_1 \in D_{m'(m)}$ is zero.
Thus we can choose $b_1 \in B_{m'(m)}$ mapping to
the image $c_1$. Since $c_3$ maps to zero in
$C_{m'(m_0)}$ we find an element $a_{-1} \in A_{m'(m_0)}$
which maps to the image $b_{-1} \in B_{m'(m_0)}$ of $b_1$.
Since $a_{-1}$ maps to zero in $A_{m_0}$ we conclude that
$b_1$ maps to zero in $B_{m_0}$. Thus the image $b_0 \in B_m$
is zero which of course implies $c_0 = 0$ as desired.

\medskip\noindent
We will prove the lemma by induction on $\dim(T)$ which is
finite because $\dim(A)$ is finite. Let $T' \subset T$ be
the set of nonminimal primes in $T$. Then $T'$ is a subset
of $\Spec(A)$ stable under specialization and the hypotheses
of the lemma apply to $T'$. Since $\dim(T') < \dim(T)$ we know
the lemma holds for $T'$. For every $A$-module $M$ there is an
exact sequence
$$
0 \to \colim_{Z, f} H^1_f(H^{i - 1}_Z(M)) \to
H^i_{T'}(M) \to H^i_T(M) \to
\bigoplus\nolimits_{\mathfrak p \in T \setminus T'}
H^i_{\mathfrak p A_\mathfrak p}(M_\mathfrak p)
$$
by Lemma \ref{lemma-filter-local-cohomology}.
Thus we conclude by the initial remark of the proof
and the fact that we've seen the system of groups
$$
\left\{\colim_{Z, f} H^1_f(H^{i - 1}_Z(M_n))\right\}_{n \geq 0}
$$
is pro-zero in Lemma \ref{lemma-zero}; this uses that the function
$m''(m)$ in that lemma for $H^{i - 1}_Z(M)$ is independent of $Z$.
\end{proof}










\section{Finiteness of local cohomology, I}
\label{section-finiteness}

\noindent
We will follow Faltings approach to finiteness of local cohomology
modules, see \cite{Faltings-annulators} and \cite{Faltings-finiteness}.
Here is a lemma which shows that it suffices to prove
local cohomology modules have an annihilator in order to prove that
they are finite modules.

\begin{lemma}
\label{lemma-check-finiteness-local-cohomology-by-annihilator}
\begin{reference}
\cite[Lemma 3]{Faltings-annulators}
\end{reference}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$ be a subset stable
under specialization. Let $M$ be a finite $A$-module. Let $n \geq 0$.
The following are equivalent
\begin{enumerate}
\item $H^i_T(M)$ is finite for $i \leq n$,
\item there exists an ideal $J \subset A$ with $V(J) \subset T$
such that $J$ annihilates $H^i_T(M)$ for $i \leq n$.
\end{enumerate}
If $T = V(I) = Z$ for an ideal $I \subset A$, then these are also
equivalent to
\begin{enumerate}
\item[(3)] there exists an $e \geq 0$ such that $I^e$ annihilates
$H^i_Z(M)$ for $i \leq n$.
\end{enumerate}
\end{lemma}

\begin{proof}
We prove the equivalence of (1) and (2) by induction on $n$.
For $n = 0$ we have $H^0_T(M) \subset M$ is finite. Hence (1) is true.
Since $H^0_T(M) = \colim H^0_{V(J)}(M)$ with $J$ as in (2) we see
that (2) is true. Assume that $n > 0$.

\medskip\noindent
Assume (1) is true. Recall that $H^i_J(M) = H^i_{V(J)}(M)$, see
Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-noetherian}.
Thus $H^i_T(M) = \colim H^i_J(M)$ where the colimit is over ideals
$J \subset A$ with $V(J) \subset T$, see
Lemma \ref{lemma-adjoint-ext}. Since $H^i_T(M)$ is finitely generated
for $i \leq n$ we can find a $J \subset A$ as in (2) such that
$H^i_J(M) \to H^i_T(M)$ is surjective for $i \leq n$.
Thus the finite list of generators are $J$-power torsion elements
and we see that (2) holds with $J$ replaced by some power.

\medskip\noindent
Assume we have $J$ as in (2). Let $N = H^0_T(M)$ and $M' = M/N$.
By construction of $R\Gamma_T$ we find that
$H^i_T(N) = 0$ for $i > 0$ and $H^0_T(N) = N$, see
Remark \ref{remark-upshot}. Thus we find that
$H^0_T(M') = 0$ and $H^i_T(M') = H^i_T(M)$ for $i > 0$.
We conclude that we may replace $M$ by $M'$.
Thus we may assume that $H^0_T(M) = 0$.
This means that the finite set of associated primes of $M$
are not in $T$. By prime avoidance (Algebra, Lemma \ref{algebra-lemma-silly})
we can find $f \in J$ not contained in any of the associated primes of $M$.
Then the long exact local cohomology sequence associated to the short
exact sequence
$$
0 \to M \to M \to M/fM \to 0
$$
turns into short exact sequences
$$
0 \to H^i_T(M) \to H^i_T(M/fM) \to H^{i + 1}_T(M) \to 0
$$
for $i < n$. We conclude that $J^2$ annihilates $H^i_T(M/fM)$
for $i < n$. By induction hypothesis we see that $H^i_T(M/fM)$
is finite for $i < n$. Using the short exact sequence once more
we see that $H^{i + 1}_T(M)$ is finite for $i < n$ as desired.

\medskip\noindent
We omit the proof of the equivalence of (2) and (3)
in case $T = V(I)$.
\end{proof}

\noindent
The following result of Faltings allows us to prove finiteness
of local cohomology at the level of local rings.

\begin{lemma}
\label{lemma-check-finiteness-local-cohomology-locally}
\begin{reference}
This is a special case of \cite[Satz 1]{Faltings-finiteness}.
\end{reference}
Let $A$ be a Noetherian ring, $I \subset A$ an ideal, $M$ a finite
$A$-module, and $n \geq 0$ an integer. Let $Z = V(I)$.
The following are equivalent
\begin{enumerate}
\item the modules $H^i_Z(M)$ are finite for $i \leq n$, and
\item for all $\mathfrak p \in \Spec(A)$ the modules
$H^i_Z(M)_\mathfrak p$, $i \leq n$ are finite $A_\mathfrak p$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
The implication (1) $\Rightarrow$ (2) is immediate. We prove the converse
by induction on $n$. The case $n = 0$ is clear because both (1) and
(2) are always true in that case.

\medskip\noindent
Assume $n > 0$ and that (2) is true. Let $N = H^0_Z(M)$ and $M' = M/N$.
By Dualizing Complexes, Lemma \ref{dualizing-lemma-divide-by-torsion}
we may replace $M$ by $M'$.
Thus we may assume that $H^0_Z(M) = 0$.
This means that $\text{depth}_I(M) > 0$
(Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}).
Pick $f \in I$ a nonzerodivisor on $M$ and consider the short
exact sequence
$$
0 \to M \to M \to M/fM \to 0
$$
which produces a long exact sequence
$$
0 \to H^0_Z(M/fM) \to H^1_Z(M) \to H^1_Z(M) \to H^1_Z(M/fM) \to
H^2_Z(M) \to \ldots
$$
and similarly after localization. Thus assumption (2) implies that
the modules $H^i_Z(M/fM)_\mathfrak p$ are finite for $i < n$. Hence
by induction assumption $H^i_Z(M/fM)$ are finite for $i < n$.

\medskip\noindent
Let $\mathfrak p$ be a prime of $A$ which is associated to
$H^i_Z(M)$ for some $i \leq n$. Say $\mathfrak p$ is the annihilator
of the element $x \in H^i_Z(M)$. Then $\mathfrak p \in Z$, hence
$f \in \mathfrak p$. Thus $fx = 0$ and hence $x$ comes from an
element of $H^{i - 1}_Z(M/fM)$ by the boundary map $\delta$ in the long
exact sequence above. It follows that $\mathfrak p$ is an associated
prime of the finite module $\Im(\delta)$. We conclude that
$\text{Ass}(H^i_Z(M))$ is finite for $i \leq n$, see
Algebra, Lemma \ref{algebra-lemma-finite-ass}.

\medskip\noindent
Recall that
$$
H^i_Z(M) \subset
\prod\nolimits_{\mathfrak p \in \text{Ass}(H^i_Z(M))}
H^i_Z(M)_\mathfrak p
$$
by Algebra, Lemma \ref{algebra-lemma-zero-at-ass-zero}. Since by
assumption the modules on the right hand side are finite and $I$-power
torsion, we can find integers $e_{\mathfrak p, i} \geq 0$, $i \leq n$,
$\mathfrak p \in \text{Ass}(H^i_Z(M))$ such that
$I^{e_{\mathfrak p, i}}$ annihilates $H^i_Z(M)_\mathfrak p$. We conclude
that $I^e$ with $e = \max\{e_{\mathfrak p, i}\}$ annihilates $H^i_Z(M)$
for $i \leq n$. By
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator}
we see that $H^i_Z(M)$ is finite for $i \leq n$.
\end{proof}

\begin{lemma}
\label{lemma-annihilate-local-cohomology}
Let $A$ be a ring and let $J \subset I \subset A$ be finitely generated ideals.
Let $i \geq 0$ be an integer. Set $Z = V(I)$. If
$H^i_Z(A)$ is annihilated by $J^n$ for some $n$, then
$H^i_Z(M)$ annihilated by $J^m$ for some $m = m(M)$
for every finitely presented $A$-module $M$ such that
$M_f$ is a finite locally free $A_f$-module for all $f \in I$.
\end{lemma}

\begin{proof}
Consider the annihilator $\mathfrak a$ of $H^i_Z(M)$.
Let $\mathfrak p \subset A$ with $\mathfrak p \not \in Z$.
By assumption there exists an $f \in I$, $f \not \in \mathfrak p$
and an isomorphism $\varphi : A_f^{\oplus r} \to M_f$
of $A_f$-modules. Clearing denominators (and using that
$M$ is of finite presentation) we find maps
$$
a : A^{\oplus r} \longrightarrow M
\quad\text{and}\quad
b : M \longrightarrow A^{\oplus r}
$$
with $a_f = f^N \varphi$ and $b_f = f^N \varphi^{-1}$ for some $N$.
Moreover we may assume that $a \circ b$ and $b \circ a$ are equal to
multiplication by $f^{2N}$. Thus we see that $H^i_Z(M)$ is annihilated by
$f^{2N}J^n$, i.e., $f^{2N}J^n \subset \mathfrak a$.

\medskip\noindent
As $U = \Spec(A) \setminus Z$ is quasi-compact we can find finitely many
$f_1, \ldots, f_t$ and $N_1, \ldots, N_t$ such that $U = \bigcup D(f_j)$ and
$f_j^{2N_j}J^n \subset \mathfrak a$. Then $V(I) = V(f_1, \ldots, f_t)$
and since $I$ is finitely generated we conclude
$I^M \subset (f_1, \ldots, f_t)$ for some $M$.
All in all we see that $J^m \subset \mathfrak a$ for
$m \gg 0$, for example $m = M (2N_1 + \ldots + 2N_t) n$ will do.
\end{proof}

\begin{lemma}
\label{lemma-local-finiteness-for-finite-locally-free}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Set $Z = V(I)$.
Let $n \geq 0$ be an integer. If $H^i_Z(A)$ is finite for $0 \leq i \leq n$,
then the same is true for $H^i_Z(M)$, $0 \leq i \leq n$ for
any finite $A$-module $M$ such that $M_f$ is a finite locally free
$A_f$-module for all $f \in I$.
\end{lemma}

\begin{proof}
The assumption that $H^i_Z(A)$ is finite for $0 \leq i \leq n$
implies there exists an $e \geq 0$ such that $I^e$ annihilates
$H^i_Z(A)$ for $0 \leq i \leq n$, see
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator}.
Then Lemma \ref{lemma-annihilate-local-cohomology}
implies that $H^i_Z(M)$, $0 \leq i \leq n$ is annihilated
by $I^m$ for some $m = m(M, i)$. We may take the same $m$
for all $0 \leq i \leq n$. Then
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator}
implies that $H^i_Z(M)$ is finite for $0 \leq i \leq n$
as desired.
\end{proof}





\section{Finiteness of pushforwards, I}
\label{section-finiteness-pushforward}

\noindent
In this section we discuss the easiest nontrivial case of the
finiteness theorem, namely, the finiteness of the first local
cohomology or what is equivalent, finiteness of $j_*\mathcal{F}$
where $j : U \to X$ is an open immersion, $X$ is locally Noetherian, and
$\mathcal{F}$ is a coherent sheaf on $U$. Following a method of Koll\'ar
(\cite{Kollar-variants} and \cite{Kollar-local-global-hulls})
we find a necessary and sufficient condition, see
Proposition \ref{proposition-kollar}. The reader who is interested
in higher direct images or higher local cohomology groups should skip
ahead to Section \ref{section-finiteness-pushforward-II} or
Section \ref{section-finiteness-II} (which are developed
independently of the rest of this section).

\begin{lemma}
\label{lemma-check-finiteness-pushforward-on-associated-points}
Let $X$ be a locally Noetherian scheme. Let $j : U \to X$ be the inclusion
of an open subscheme with complement $Z$. For $x \in U$ let
$i_x : W_x \to U$ be the integral closed subscheme with generic point $x$.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_U$-module.
The following are equivalent
\begin{enumerate}
\item for all $x \in \text{Ass}(\mathcal{F})$ the
$\mathcal{O}_X$-module $j_*i_{x, *}\mathcal{O}_{W_x}$ is coherent,
\item $j_*\mathcal{F}$ is coherent.
\end{enumerate}
\end{lemma}

\begin{proof}
We first prove that (1) implies (2). Assume (1) holds.
The statement is local on $X$, hence we may assume $X$ is affine.
Then $U$ is quasi-compact, hence $\text{Ass}(\mathcal{F})$ is finite
(Divisors, Lemma \ref{divisors-lemma-finite-ass}). Thus we may argue by
induction on the number of associated points. Let $x \in U$ be a generic
point of an irreducible component of the support of $\mathcal{F}$.
By Divisors, Lemma \ref{divisors-lemma-finite-ass} we have
$x \in \text{Ass}(\mathcal{F})$. By our choice of $x$ we have
$\dim(\mathcal{F}_x) = 0$ as $\mathcal{O}_{X, x}$-module.
Hence $\mathcal{F}_x$ has finite length as an $\mathcal{O}_{X, x}$-module
(Algebra, Lemma \ref{algebra-lemma-support-point}).
Thus we may use induction on this length.

\medskip\noindent
Set $\mathcal{G} = j_*i_{x, *}\mathcal{O}_{W_x}$. This is a coherent
$\mathcal{O}_X$-module by assumption. We have $\mathcal{G}_x = \kappa(x)$.
Choose a nonzero map
$\varphi_x : \mathcal{F}_x \to \kappa(x) = \mathcal{G}_x$.
By Cohomology of Schemes, Lemma \ref{coherent-lemma-map-stalks-local-map}
there is an open $x \in V \subset U$ and a map
$\varphi_V : \mathcal{F}|_V \to \mathcal{G}|_V$ whose stalk
at $x$ is $\varphi_x$. Choose $f \in \Gamma(X, \mathcal{O}_X)$
which does not vanish at $x$ such that $D(f) \subset V$. By
Cohomology of Schemes, Lemma \ref{coherent-lemma-homs-over-open}
(for example) we see that $\varphi_V$ extends to
$f^n\mathcal{F} \to \mathcal{G}|_U$ for some $n$.
Precomposing with multiplication by $f^n$ we obtain a map
$\mathcal{F} \to \mathcal{G}|_U$ whose stalk at $x$ is nonzero.
Let $\mathcal{F}' \subset \mathcal{F}$ be the kernel.
Note that $\text{Ass}(\mathcal{F}') \subset \text{Ass}(\mathcal{F})$, see
Divisors, Lemma \ref{divisors-lemma-ses-ass}.
Since
$\text{length}_{\mathcal{O}_{X, x}}(\mathcal{F}') = 
\text{length}_{\mathcal{O}_{X, x}}(\mathcal{F}) - 1$
we may apply the
induction hypothesis to conclude $j_*\mathcal{F}'$ is coherent.
Since $\mathcal{G} = j_*(\mathcal{G}|_U) = j_*i_{x, *}\mathcal{O}_{W_x}$
is coherent, we can consider the exact sequence
$$
0 \to j_*\mathcal{F}' \to j_*\mathcal{F} \to \mathcal{G}
$$
By Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}
the sheaf $j_*\mathcal{F}$ is quasi-coherent.
Hence the image of $j_*\mathcal{F}$ in $j_*(\mathcal{G}|_U)$
is coherent by Cohomology of Schemes, Lemma
\ref{coherent-lemma-coherent-Noetherian-quasi-coherent-sub-quotient}.
Finally, $j_*\mathcal{F}$ is coherent by
Cohomology of Schemes, Lemma \ref{coherent-lemma-coherent-abelian-Noetherian}.

\medskip\noindent
Assume (2) holds. Exactly in the same manner as above we reduce
to the case $X$ affine. We pick $x \in \text{Ass}(\mathcal{F})$
and we set $\mathcal{G} = j_*i_{x, *}\mathcal{O}_{W_x}$.
Then we choose a nonzero map
$\varphi_x : \mathcal{G}_x = \kappa(x) \to \mathcal{F}_x$
which exists exactly because $x$ is an associated point of $\mathcal{F}$.
Arguing exactly as above we may assume $\varphi_x$
extends to an $\mathcal{O}_U$-module map
$\varphi : \mathcal{G}|_U \to \mathcal{F}$.
Then $\varphi$ is injective (for example by
Divisors, Lemma \ref{divisors-lemma-check-injective-on-ass})
and we find and injective map
$\mathcal{G} = j_*(\mathcal{G}|_V) \to j_*\mathcal{F}$.
Thus (1) holds.
\end{proof}

\begin{lemma}
\label{lemma-finiteness-pushforwards-and-H1-local}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Set $X = \Spec(A)$, $Z = V(I)$, $U = X \setminus Z$, and $j : U \to X$
the inclusion morphism. Let $\mathcal{F}$ be a coherent $\mathcal{O}_U$-module.
Then
\begin{enumerate}
\item there exists a finite $A$-module $M$ such that $\mathcal{F}$ is the
restriction of $\widetilde{M}$ to $U$,
\item given $M$ there is an exact sequence
$$
0 \to H^0_Z(M) \to M \to H^0(U, \mathcal{F}) \to H^1_Z(M) \to 0
$$
and isomorphisms $H^p(U, \mathcal{F}) = H^{p + 1}_Z(M)$ for $p \geq 1$,
\item given $M$ and $p \geq 0$ the following are equivalent
\begin{enumerate}
\item $R^pj_*\mathcal{F}$ is coherent,
\item $H^p(U, \mathcal{F})$ is a finite $A$-module,
\item $H^{p + 1}_Z(M)$ is a finite $A$-module,
\end{enumerate}
\item if the equivalent conditions in (3) hold for $p = 0$, we may take
$M = \Gamma(U, \mathcal{F})$ in which case we have $H^0_Z(M) = H^1_Z(M) = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
By Properties, Lemma \ref{properties-lemma-extend-finite-presentation}
there exists a coherent $\mathcal{O}_X$-module $\mathcal{F}'$
whose restriction to $U$ is isomorphic to $\mathcal{F}$.
Say $\mathcal{F}'$ corresponds to the finite $A$-module $M$
as in (1).
Note that $R^pj_*\mathcal{F}$ is quasi-coherent
(Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherence-higher-direct-images})
and corresponds to the $A$-module $H^p(U, \mathcal{F})$.
By Lemma \ref{lemma-local-cohomology-is-local-cohomology}
and the general facts in
Cohomology, Section \ref{cohomology-section-cohomology-support}
we obtain an exact sequence
$$
0 \to H^0_Z(M) \to M \to H^0(U, \mathcal{F}) \to H^1_Z(M) \to 0
$$
and isomorphisms $H^p(U, \mathcal{F}) = H^{p + 1}_Z(M)$ for $p \geq 1$.
Here we use that $H^j(X, \mathcal{F}') = 0$ for $j > 0$ as $X$ is affine
and $\mathcal{F}'$ is quasi-coherent (Cohomology of Schemes,
Lemma \ref{coherent-lemma-quasi-coherent-affine-cohomology-zero}).
This proves (2).
Parts (3) and (4) are straightforward from (2); see also
Lemma \ref{lemma-local-cohomology}.
\end{proof}

\begin{lemma}
\label{lemma-finiteness-pushforward}
Let $X$ be a locally Noetherian scheme.
Let $j : U \to X$ be the inclusion of an
open subscheme with complement $Z$. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_U$-module. Assume
\begin{enumerate}
\item $X$ is Nagata,
\item $X$ is universally catenary, and
\item for $x \in \text{Ass}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ we have
$\dim(\mathcal{O}_{\overline{\{x\}}, z}) \geq 2$.
\end{enumerate}
Then $j_*\mathcal{F}$ is coherent.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-check-finiteness-pushforward-on-associated-points}
it suffices to prove $j_*i_{x, *}\mathcal{O}_{W_x}$ is coherent
for $x \in \text{Ass}(\mathcal{F})$.
Let $\pi : Y \to X$ be the normalization of $X$ in $\Spec(\kappa(x))$, see
Morphisms, Section \ref{morphisms-section-normalization}. By
Morphisms, Lemma \ref{morphisms-lemma-nagata-normalization-finite-general}
the morphism $\pi$ is finite. Since $\pi$ is finite
$\mathcal{G} = \pi_*\mathcal{O}_Y$ is a coherent $\mathcal{O}_X$-module by
Cohomology of Schemes, Lemma \ref{coherent-lemma-finite-pushforward-coherent}.
Observe that $W_x = U \cap \pi(Y)$. Thus
$\pi|_{\pi^{-1}(U)} : \pi^{-1}(U) \to U$ factors through $i_x : W_x \to U$
and we obtain a canonical map
$$
i_{x, *}\mathcal{O}_{W_x}
\longrightarrow
(\pi|_{\pi^{-1}(U)})_*(\mathcal{O}_{\pi^{-1}(U)}) =
(\pi_*\mathcal{O}_Y)|_U = \mathcal{G}|_U
$$
This map is injective (for example by Divisors, Lemma
\ref{divisors-lemma-check-injective-on-ass}). Hence
$j_*i_{x, *}\mathcal{O}_{W_x} \subset j_*\mathcal{G}|_U$
and it suffices to show that $j_*\mathcal{G}|_U$ is coherent.

\medskip\noindent
It remains to prove that $j_*(\mathcal{G}|_U)$ is coherent. We claim
Divisors, Lemma \ref{divisors-lemma-depth-2-hartog}
applies to
$$
\mathcal{G} \longrightarrow j_*(\mathcal{G}|_U)
$$
which finishes the proof. It suffices to show that
$\text{depth}(\mathcal{G}_z) \geq 2$ for $z \in Z$.
Let $y_1, \ldots, y_n \in Y$ be the points mapping to $z$.
By Algebra, Lemma \ref{algebra-lemma-depth-goes-down-finite}
it suffices to show that
$\text{depth}(\mathcal{O}_{Y, y_i}) \geq 2$ for $i = 1, \ldots, n$.
If not, then by Properties, Lemma \ref{properties-lemma-criterion-normal}
we see that $\dim(\mathcal{O}_{Y, y_i}) = 1$ for some $i$.
This is impossible by the dimension formula
(Morphisms, Lemma \ref{morphisms-lemma-dimension-formula})
for $\pi : Y \to \overline{\{x\}}$ and assumption (3).
\end{proof}

\begin{lemma}
\label{lemma-sharp-finiteness-pushforward}
Let $X$ be an integral locally Noetherian scheme. Let $j : U \to X$
be the inclusion of a nonempty open subscheme with complement $Z$. Assume
that for all $z \in Z$ and any associated prime $\mathfrak p$ of
the completion $\mathcal{O}_{X, z}^\wedge$
we have $\dim(\mathcal{O}_{X, z}^\wedge/\mathfrak p) \geq 2$.
Then $j_*\mathcal{O}_U$ is coherent.
\end{lemma}

\begin{proof}
We may assume $X$ is affine.
Using Lemmas \ref{lemma-check-finiteness-local-cohomology-locally} and
\ref{lemma-finiteness-pushforwards-and-H1-local} we reduce to
$X = \Spec(A)$ where $(A, \mathfrak m)$ is a Noetherian local domain
and $\mathfrak m \in Z$.
Then we can use induction on $d = \dim(A)$.
(The base case is $d = 0, 1$ which do not happen by
our assumption on the local rings.)
Set $V = \Spec(A) \setminus \{\mathfrak m\}$.
Observe that the local rings of $V$ have dimension strictly smaller than $d$.
Repeating the arguments for $j' : U \to V$ we
and using induction we conclude that $j'_*\mathcal{O}_U$ is
a coherent $\mathcal{O}_V$-module.
Pick a nonzero $f \in A$ which vanishes on $Z$.
Since $D(f) \cap V \subset U$ we find an $n$ such that
multiplication by $f^n$ on $U$ extends to a map
$f^n : j'_*\mathcal{O}_U \to \mathcal{O}_V$ over $V$
(for example by Cohomology of Schemes, Lemma
\ref{coherent-lemma-homs-over-open}). This map is injective
hence there is an injective map
$$
j_*\mathcal{O}_U = j''_* j'_* \mathcal{O}_U \to j''_*\mathcal{O}_V
$$
on $X$ where $j'' : V \to X$ is the inclusion morphism.
Hence it suffices to show that $j''_*\mathcal{O}_V$ is coherent.
In other words, we may assume that $X$ is the spectrum
of a local Noetherian domain and that $Z$
consists of the closed point.

\medskip\noindent
Assume $X = \Spec(A)$ with $(A, \mathfrak m)$ local and $Z = \{\mathfrak m\}$.
Let $A^\wedge$ be the completion of $A$.
Set $X^\wedge = \Spec(A^\wedge)$, $Z^\wedge = \{\mathfrak m^\wedge\}$,
$U^\wedge = X^\wedge \setminus Z^\wedge$, and
$\mathcal{F}^\wedge = \mathcal{O}_{U^\wedge}$.
The ring $A^\wedge$ is universally catenary and Nagata (Algebra, Remark
\ref{algebra-remark-Noetherian-complete-local-ring-universally-catenary} and
Lemma \ref{algebra-lemma-Noetherian-complete-local-Nagata}).
Moreover, condition (3) of Lemma \ref{lemma-finiteness-pushforward}
for $X^\wedge, Z^\wedge, U^\wedge, \mathcal{F}^\wedge$
holds by assumption! Thus we see that
$(U^\wedge \to X^\wedge)_*\mathcal{O}_{U^\wedge}$
is coherent. Since the morphism $c : X^\wedge \to X$
is flat we conclude that the pullback of $j_*\mathcal{O}_U$ is
$(U^\wedge \to X^\wedge)_*\mathcal{O}_{U^\wedge}$
(Cohomology of Schemes, Lemma
\ref{coherent-lemma-flat-base-change-cohomology}).
Finally, since $c$ is faithfully flat we conclude that
$j_*\mathcal{O}_U$ is coherent by
Descent, Lemma \ref{descent-lemma-finite-type-descends}.
\end{proof}

\begin{remark}
\label{remark-closure}
Let $j : U \to X$ be an open immersion of locally Noetherian schemes.
Let $x \in U$. Let $i_x : W_x \to U$ be the integral closed subscheme
with generic point $x$ and let $\overline{\{x\}}$ be the closure in $X$.
Then we have a commutative diagram
$$
\xymatrix{
W_x \ar[d]_{i_x} \ar[r]_{j'} & \overline{\{x\}} \ar[d]^i \\
U \ar[r]^j & X
}
$$
We have $j_*i_{x, *}\mathcal{O}_{W_x} = i_*j'_*\mathcal{O}_{W_x}$.
As the left vertical arrow is a closed immersion we see that
$j_*i_{x, *}\mathcal{O}_{W_x}$ is coherent if and only of
$j'_*\mathcal{O}_{W_x}$ is coherent.
\end{remark}

\begin{remark}
\label{remark-no-finiteness-pushforward}
Let $X$ be a locally Noetherian scheme. Let $j : U \to X$ be the inclusion of
an open subscheme with complement $Z$. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_U$-module. If there exists an $x \in \text{Ass}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ such that
$\dim(\mathcal{O}_{\overline{\{x\}}, z}) \leq 1$, then $j_*\mathcal{F}$ is not
coherent. To prove this we can do a flat base change to the spectrum
of $\mathcal{O}_{X, z}$. Let $X' = \overline{\{x\}}$.
The assumption implies $\mathcal{O}_{X' \cap U} \subset \mathcal{F}$.
Thus it suffices to see that $j_*\mathcal{O}_{X' \cap U}$ is not
coherent. This is clear because $X' = \{x, z\}$, hence
$j_*\mathcal{O}_{X' \cap U}$ corresponds to $\kappa(x)$ as an
$\mathcal{O}_{X, z}$-module which cannot be finite as $x$ is not
a closed point.

\medskip\noindent
In fact, the converse of Lemma \ref{lemma-sharp-finiteness-pushforward}
holds true: given an open immersion $j : U \to X$ of integral Noetherian
schemes and there exists a $z \in X \setminus U$ and an associated prime
$\mathfrak p$ of the completion $\mathcal{O}_{X, z}^\wedge$
with $\dim(\mathcal{O}_{X, z}^\wedge/\mathfrak p) = 1$,
then $j_*\mathcal{O}_U$ is not coherent. Namely, you can pass to
the local ring, you can enlarge $U$ to the punctured spectrum,
you can pass to the completion, and then the argument above gives
the nonfiniteness.
\end{remark}

\begin{proposition}[Koll\'ar]
\label{proposition-kollar}
\begin{reference}
Theorem of Koll\'ar stated in an email dated Wed, 1 Jul 2015.
See \cite[IV, Proposition 7.2.2]{EGA} for a special case.
\end{reference}
\begin{slogan}
Weak analogue of Hartogs' Theorem: On Noetherian schemes, the
restriction of a coherent sheaf to an open set with complement
of codimension 2 in the sheaf's support, is coherent.
\end{slogan}
Let $j : U \to X$ be an open immersion of locally Noetherian schemes
with complement $Z$. Let $\mathcal{F}$ be a coherent $\mathcal{O}_U$-module.
The following are equivalent
\begin{enumerate}
\item $j_*\mathcal{F}$ is coherent,
\item for $x \in \text{Ass}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ and any associated prime
$\mathfrak p$ of the completion $\mathcal{O}_{\overline{\{x\}}, z}^\wedge$
we have $\dim(\mathcal{O}_{\overline{\{x\}}, z}^\wedge/\mathfrak p) \geq 2$.
\end{enumerate}
\end{proposition}

\begin{proof}
If (2) holds we get (1) by a combination of
Lemmas \ref{lemma-check-finiteness-pushforward-on-associated-points},
Remark \ref{remark-closure}, and
Lemma \ref{lemma-sharp-finiteness-pushforward}.
If (2) does not hold, then $j_*i_{x, *}\mathcal{O}_{W_x}$ is not finite
for some $x \in \text{Ass}(\mathcal{F})$ by the discussion in
Remark \ref{remark-no-finiteness-pushforward}
(and Remark \ref{remark-closure}).
Thus $j_*\mathcal{F}$ is not coherent by
Lemma \ref{lemma-check-finiteness-pushforward-on-associated-points}.
\end{proof}

\begin{lemma}
\label{lemma-kollar-finiteness-H1-local}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Set $Z = V(I)$. Let $M$ be a finite $A$-module. The following
are equivalent
\begin{enumerate}
\item $H^1_Z(M)$ is a finite $A$-module, and
\item for all $\mathfrak p \in \text{Ass}(M)$, $\mathfrak p \not \in Z$
and all $\mathfrak q \in V(\mathfrak p + I)$ the completion of
$(A/\mathfrak p)_\mathfrak q$ does not have associated primes
of dimension $1$.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows immediately from Proposition \ref{proposition-kollar}
via Lemma \ref{lemma-finiteness-pushforwards-and-H1-local}.
\end{proof}

\noindent
The formulation in the following lemma has the advantage that conditions
(1) and (2) are inherited by schemes of finite type over $X$.
Moreover, this is the form of finiteness which we will generalize
to higher direct images in Section \ref{section-finiteness-pushforward-II}.

\begin{lemma}
\label{lemma-finiteness-pushforward-general}
Let $X$ be a locally Noetherian scheme.
Let $j : U \to X$ be the inclusion of an
open subscheme with complement $Z$. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_U$-module. Assume
\begin{enumerate}
\item $X$ is universally catenary,
\item for every $z \in Z$ the formal fibres of $\mathcal{O}_{X, z}$
are $(S_1)$.
\end{enumerate}
In this situation the following are equivalent
\begin{enumerate}
\item[(a)] for $x \in \text{Ass}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ we have
$\dim(\mathcal{O}_{\overline{\{x\}}, z}) \geq 2$, and
\item[(b)] $j_*\mathcal{F}$ is coherent.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $x \in \text{Ass}(\mathcal{F})$. By Proposition \ref{proposition-kollar}
it suffices to check that $A = \mathcal{O}_{\overline{\{x\}}, z}$ satisfies
the condition of the proposition on associated primes of its completion
if and only if $\dim(A) \geq 2$.
Observe that $A$ is universally catenary (this is clear)
and that its formal fibres are $(S_1)$ as follows from
More on Algebra, Lemma \ref{more-algebra-lemma-formal-fibres-normal} and
Proposition \ref{more-algebra-proposition-finite-type-over-P-ring}.
Let $\mathfrak p' \subset A^\wedge$ be an associated prime.
As $A \to A^\wedge$ is flat,
by Algebra, Lemma \ref{algebra-lemma-bourbaki},
we find that $\mathfrak p'$ lies over $(0) \subset A$.
The formal fibre $A^\wedge \otimes_A F$ is $(S_1)$ where $F$ is
the fraction field of $A$. We conclude that $\mathfrak p'$ is a
minimal prime, see
Algebra, Lemma \ref{algebra-lemma-criterion-no-embedded-primes}.
Since $A$ is universally catenary it is formally catenary
by More on Algebra, Proposition \ref{more-algebra-proposition-ratliff}.
Hence $\dim(A^\wedge/\mathfrak p') = \dim(A)$ which
proves the equivalence.
\end{proof}






\section{Depth and dimension}
\label{section-dept-dimension}

\noindent
Some helper lemmas.

\begin{lemma}
\label{lemma-ideal-depth-function}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $M$ be a finite $A$-module. Let $\mathfrak p \in V(I)$
be a prime ideal. Assume
$e = \text{depth}_{IA_\mathfrak p}(M_\mathfrak p) < \infty$.
Then there exists a nonempty open $U \subset V(\mathfrak p)$
such that $\text{depth}_{IA_\mathfrak q}(M_\mathfrak q) \geq e$
for all $\mathfrak q \in U$.
\end{lemma}

\begin{proof}
By definition of depth we have $IM_\mathfrak p \not = M_\mathfrak p$
and there exists an $M_\mathfrak p$-regular sequence
$f_1, \ldots, f_e \in IA_\mathfrak p$. After replacing $A$ by
a principal localization we may assume $f_1, \ldots, f_e \in I$
form an $M$-regular sequence, see
Algebra, Lemma \ref{algebra-lemma-regular-sequence-in-neighbourhood}.
Consider the module $M' = M/IM$. Since $\mathfrak p \in \text{Supp}(M')$
and since the support of a finite module is closed, we find
$V(\mathfrak p) \subset \text{Supp}(M')$. Thus
for $\mathfrak q \in V(\mathfrak p)$ we get
$IM_\mathfrak q \not = M_\mathfrak q$. Hence, using that
localization is exact, we see that
$\text{depth}_{IA_\mathfrak q}(M_\mathfrak q) \geq e$
for any $\mathfrak q \in V(I)$ by definition of depth.
\end{proof}

\begin{lemma}
\label{lemma-depth-function}
Let $A$ be a Noetherian ring. Let $M$ be a finite $A$-module.
Let $\mathfrak p$ be a prime ideal. Assume
$e = \text{depth}_{A_\mathfrak p}(M_\mathfrak p) < \infty$.
Then there exists a nonempty open $U \subset V(\mathfrak p)$
such that $\text{depth}_{A_\mathfrak q}(M_\mathfrak q) \geq e$
for all $\mathfrak q \in U$ and
for all but finitely many $\mathfrak q \in U$ we have
$\text{depth}_{A_\mathfrak q}(M_\mathfrak q) > e$.
\end{lemma}

\begin{proof}
By definition of depth we have $\mathfrak p M_\mathfrak p \not = M_\mathfrak p$
and there exists an $M_\mathfrak p$-regular sequence
$f_1, \ldots, f_e \in \mathfrak p A_\mathfrak p$. After replacing $A$ by
a principal localization we may assume $f_1, \ldots, f_e \in \mathfrak p$
form an $M$-regular sequence, see
Algebra, Lemma \ref{algebra-lemma-regular-sequence-in-neighbourhood}.
Consider the module $M' = M/(f_1, \ldots, f_e)M$.
Since $\mathfrak p \in \text{Supp}(M')$
and since the support of a finite module is closed, we find
$V(\mathfrak p) \subset \text{Supp}(M')$. Thus
for $\mathfrak q \in V(\mathfrak p)$ we get
$\mathfrak q M_\mathfrak q \not = M_\mathfrak q$. Hence, using that
localization is exact, we see that
$\text{depth}_{A_\mathfrak q}(M_\mathfrak q) \geq e$
for any $\mathfrak q \in V(I)$ by definition of depth.
Moreover, as soon as $\mathfrak q$ is not an associated
prime of the module $M'$, then the depth goes up.
Thus we see that the final statement holds by
Algebra, Lemma \ref{algebra-lemma-finite-ass}.
\end{proof}

\begin{lemma}
\label{lemma-finite-nr-points-next-S}
Let $X$ be a Noetherian scheme with dualizing complex $\omega_X^\bullet$.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module. Let $k \geq 0$
be an integer. Assume $\mathcal{F}$ is $(S_k)$.
Then there is a finite number of points $x \in X$ such that
$$
\text{depth}(\mathcal{F}_x) = k
\quad\text{and}\quad
\dim(\text{Supp}(\mathcal{F}_x)) > k
$$
\end{lemma}

\begin{proof}
We will prove this lemma by induction on $k$. The base case $k = 0$
says that $\mathcal{F}$ has a finite number of embedded associated points,
which follows from Divisors, Lemma \ref{divisors-lemma-finite-ass}.

\medskip\noindent
Assume $k > 0$ and the result holds for all smaller $k$.
We can cover $X$ by finitely many affine opens, hence we may
assume $X = \Spec(A)$ is affine. Then $\mathcal{F}$ is the
coherent $\mathcal{O}_X$-module associated to a finite $A$-module $M$
which satisfies $(S_k)$. We will use
Algebra, Lemmas \ref{algebra-lemma-one-equation-module} and
\ref{algebra-lemma-depth-drops-by-one}
without further mention.

\medskip\noindent
Let $f \in A$ be a nonzerodivisor on $M$. Then $M/fM$ has $(S_{k - 1})$.
By induction we see that there are finitely many
primes $\mathfrak p \in V(f)$ with
$\text{depth}((M/fM)_\mathfrak p) = k - 1$ and
$\dim(\text{Supp}((M/fM)_\mathfrak p)) > k - 1$.
These are exactly the primes $\mathfrak p \in V(f)$ with
$\text{depth}(M_\mathfrak p) = k$ and
$\dim(\text{Supp}(M_\mathfrak p)) > k$.
Thus we may replace $A$ by $A_f$ and $M$ by $M_f$
in trying to prove the finiteness statement.

\medskip\noindent
Since $M$ satisfies $(S_k)$ and $k > 0$ we see that $M$ has no
embedded associated primes
(Algebra, Lemma \ref{algebra-lemma-criterion-no-embedded-primes}).
Thus $\text{Ass}(M)$ is the set of generic points of the support
of $M$. Thus Dualizing Complexes, Lemma \ref{dualizing-lemma-CM-open}
shows the set
$U = \{\mathfrak q \mid M_\mathfrak q\text{ is Cohen-Macaulay}\}$
is an open containing $\text{Ass}(M)$.
By prime avoidance (Algebra, Lemma \ref{algebra-lemma-silly})
we can pick $f \in A$ with
$f \not \in \mathfrak p$ for $\mathfrak p \in \text{Ass}(M)$
such that $D(f) \subset U$.
Then $f$ is a nonzerodivisor on $M$
(Algebra, Lemma \ref{algebra-lemma-ass-zero-divisors}).
After replacing $A$ by $A_f$ and $M$ by $M_f$ (see above) we
find that $M$ is Cohen-Macaulay.
Thus for all $\mathfrak q \subset A$ we have
$\dim(M_\mathfrak q) = \text{depth}(M_\mathfrak q)$
and hence the set described in the lemma is empty
and a fortiori finite.
\end{proof}

\begin{lemma}
\label{lemma-sitting-in-degrees}
Let $(A, \mathfrak m)$ be a Noetherian local ring with
normalized dualizing complex $\omega_A^\bullet$.
Let $M$ be a finite $A$-module.
Set $E^i = \text{Ext}_A^{-i}(M, \omega_A^\bullet)$.
Then
\begin{enumerate}
\item $E^i$ is a finite $A$-module nonzero only for
$0 \leq i \leq \dim(\text{Supp}(M))$,
\item $\dim(\text{Supp}(E^i)) \leq i$,
\item $\text{depth}(M)$ is the smallest integer $\delta \geq 0$ such that
$E^\delta \not = 0$,
\item $\mathfrak p \in \text{Supp}(E^0 \oplus \ldots \oplus E^i)
\Leftrightarrow
\text{depth}_{A_\mathfrak p}(M_\mathfrak p) + \dim(A/\mathfrak p) \leq i$,
\item the annihilator of $E^i$ is equal to the annihilator
of $H^i_\mathfrak m(M)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (1), (2), and (3) are copies of the statements in
Dualizing Complexes, Lemma \ref{dualizing-lemma-sitting-in-degrees}.
For a prime $\mathfrak p$ of $A$ we have that
$(\omega_A^\bullet)_\mathfrak p[-\dim(A/\mathfrak p)]$
is a normalized dualzing complex for $A_\mathfrak p$.
See Dualizing Complexes, Lemma \ref{dualizing-lemma-dimension-function}.
Thus
$$
E^i_\mathfrak p =
\text{Ext}^{-i}_A(M, \omega_A^\bullet)_\mathfrak p =
\text{Ext}^{-i + \dim(A/\mathfrak p)}_{A_\mathfrak p}
(M_\mathfrak p, (\omega_A^\bullet)_\mathfrak p[-\dim(A/\mathfrak p)])
$$
is zero for
$i - \dim(A/\mathfrak p) < \text{depth}_{A_\mathfrak p}(M_\mathfrak p)$
and nonzero for
$i = \dim(A/\mathfrak p) + \text{depth}_{A_\mathfrak p}(M_\mathfrak p)$
by part (3) over $A_\mathfrak p$.
This proves part (4).
If $E$ is an injective hull of the residue field of $A$, then we have
$$
\Hom_A(H^i_\mathfrak m(M), E) =
\text{Ext}^{-i}_A(M, \omega_A^\bullet)^\wedge =
(E^i)^\wedge =
E^i \otimes_A A^\wedge
$$
by the local duality theorem (in the form of
Dualizing Complexes, Lemma \ref{dualizing-lemma-special-case-local-duality}).
Since $A \to A^\wedge$ is faithfully flat, we find (5) is true by
Matlis duality
(Dualizing Complexes, Proposition \ref{dualizing-proposition-matlis}).
\end{proof}






\section{Annihilators of local chomology, I}
\label{section-annihilators}

\noindent
This section discusses a result due to Faltings, see
\cite{Faltings-annulators}.

\begin{proposition}
\label{proposition-annihilator}
\begin{reference}
\cite{Faltings-annulators}.
\end{reference}
Let $A$ be a Noetherian ring which has a dualizing complex.
Let $T \subset T' \subset \Spec(A)$ be subsets stable under
specialization. Let $s \geq 0$ an integer. Let $M$ be a finite $A$-module.
The following are equivalent
\begin{enumerate}
\item there exists an ideal $J \subset A$ with $V(J) \subset T'$
such that $J$ annihilates $H^i_T(M)$ for $i \leq s$, and
\item for all $\mathfrak p \not \in T'$,
$\mathfrak q \in T$ with $\mathfrak p \subset \mathfrak q$
we have
$$
\text{depth}_{A_\mathfrak p}(M_\mathfrak p) +
\dim((A/\mathfrak p)_\mathfrak q) > s
$$
\end{enumerate}
\end{proposition}

\begin{proof}
Let $\omega_A^\bullet$ be a dualizing complex. Let $\delta$ be its
dimension function, see Dualizing Complexes, Section
\ref{dualizing-section-dimension-function}.
An important role will be played by the finite $A$-modules
$$
E^i = \Ext_A^i(M, \omega_A^\bullet)
$$
For $\mathfrak p \subset A$ we will write $H^i_\mathfrak p$ to denote the
local cohomology of an $A_\mathfrak p$-module with respect to
$\mathfrak pA_\mathfrak p$. Then we see that
the $\mathfrak pA_\mathfrak p$-adic completion of
$$
(E^i)_\mathfrak p =
\Ext^{\delta(\mathfrak p) + i}_{A_\mathfrak p}(M_\mathfrak p,
(\omega_A^\bullet)_\mathfrak p[-\delta(\mathfrak p)])
$$
is Matlis dual to
$$
H^{-\delta(\mathfrak p) - i}_{\mathfrak p}(M_\mathfrak p)
$$
by
Dualizing Complexes, Lemma \ref{dualizing-lemma-special-case-local-duality}.
In particular we deduce from this the
following fact: an ideal $J \subset A$ annihilates
$(E^i)_\mathfrak p$ if and only if $J$ annihilates
$H^{-\delta(\mathfrak p) - i}_{\mathfrak p}(M_\mathfrak p)$.

\medskip\noindent
Set $T_n = \{\mathfrak p \in T \mid \delta(\mathfrak p) \leq n\}$.
As $\delta$ is a bounded function, we see that
$T_a = \emptyset$ for $a \ll 0$ and $T_b = T$ for $b \gg 0$.

\medskip\noindent
Assume (2). Let us prove the existence of $J$ as in (1).
We will use a double induction to do this. For $i \leq s$
consider the induction hypothesis $IH_i$:
$H^a_T(M)$ is annihilated by some $J \subset A$ with $V(J) \subset T'$
for $0 \leq a \leq i$. The case $IH_0$ is trivial
because $H^0_T(M)$ is a submodule of $M$ and hence finite
and hence is annihilated by some ideal $J$ with $V(J) \subset T$.

\medskip\noindent
Induction step. Assume $IH_{i - 1}$ holds for some $0 < i \leq s$.
Pick $J'$ with $V(J') \subset T'$ annihilating $H^a_T(M)$ for
$0 \leq a \leq i - 1$ (the induction hypothesis guarantees we can
do this). We will show by descending induction on $n$
that there exists an ideal $J$ with $V(J) \subset T'$ such that the
associated primes of $J H^i_T(M)$ are in $T_n$.
For $n \ll 0$ this implies $JH^i_T(M) = 0$ 
(Algebra, Lemma \ref{algebra-lemma-ass-zero})
and hence $IH_i$ will hold.
The base case $n \gg 0$ is trivial because $T = T_n$ in this case
and all associated primes of $H^i_T(M)$ are in $T$.

\medskip\noindent
Thus we assume given $J$ with the property for $n$.
Let $\mathfrak q \in T_n$. Let $T_\mathfrak q \subset \Spec(A_\mathfrak q)$
be the inverse image of $T$. We have
$H^j_T(M)_\mathfrak q = H^j_{T_\mathfrak q}(M_\mathfrak q)$
by Lemma \ref{lemma-torsion-change-rings}.
Consider the spectral sequence
$$
H_\mathfrak q^p(H^q_{T_\mathfrak q}(M_\mathfrak q))
\Rightarrow
H^{p + q}_\mathfrak q(M_\mathfrak q)
$$
of Lemma \ref{lemma-local-cohomology-ss}.
Below we will find an ideal $J'' \subset A$ with $V(J'') \subset T'$
such that $H^i_\mathfrak q(M_\mathfrak q)$ is annihilated by $J''$ for all
$\mathfrak q \in T_n \setminus T_{n - 1}$.
Claim: $J (J')^i J''$ will work for $n - 1$.
Namely, let $\mathfrak q \in T_n \setminus T_{n - 1}$.
The spectral sequence above defines a filtration
$$
E_\infty^{0, i} = E_{i + 2}^{0, i} \subset \ldots \subset E_3^{0, i} \subset
E_2^{0, i} = H^0_\mathfrak q(H^i_{T_\mathfrak q}(M_\mathfrak q))
$$
The module $E_\infty^{0, i}$ is annihilated by $J''$.
The subquotients $E_j^{0, i}/E_{j + 1}^{0, i}$ for $i + 1 \geq j \geq 2$
are annihilated by $J'$ because the target of $d_j^{0, i}$
is a subquotient of
$$
H^j_\mathfrak q(H^{i - j + 1}_{T_\mathfrak q}(M_\mathfrak q)) =
H^j_\mathfrak q(H^{i - j + 1}_T(M)_\mathfrak q)
$$
and $H^{i - j + 1}_T(M)_\mathfrak q$ is annihilated by $J'$ by choice of $J'$.
Finally, by our choice of $J$ we have
$J H^i_T(M)_\mathfrak q \subset H^0_\mathfrak q(H^i_T(M)_\mathfrak q)$
since the non-closed points of $\Spec(A_\mathfrak q)$ have higher
$\delta$ values. Thus $\mathfrak q$ cannot be an associated prime of
$J(J')^iJ'' H^i_T(M)$ as desired.

\medskip\noindent
By our initial remarks we see that $J''$ should annihilate
$$
(E^{-\delta(\mathfrak q) - i})_\mathfrak q =
(E^{-n - i})_\mathfrak q
$$
for all $\mathfrak q \in T_n \setminus T_{n - 1}$.
But if $J''$ works for one $\mathfrak q$, then it works for all
$\mathfrak q$ in an open neighbourhood of $\mathfrak q$
as the modules $E^{-n - i}$ are finite.
Since every subset of $\Spec(A)$ is Noetherian with the induced
topology (Topology, Lemma \ref{topology-lemma-Noetherian}),
we conclude that it suffices
to prove the existence of $J''$ for one $\mathfrak q$.

\medskip\noindent
Since the ext modules are finite the existence of $J''$ is
equivalent to
$$
\text{Supp}(E^{-n - i}) \cap \Spec(A_\mathfrak q) \subset T'.
$$
This is equivalent to showing the localization of $E^{-n - i}$ at every
$\mathfrak p \subset \mathfrak q$, $\mathfrak p \not \in T'$
is zero. Using local duality over $A_\mathfrak p$ we find that we need
to prove that
$$
H^{i + n - \delta(\mathfrak p)}_\mathfrak p(M_\mathfrak p) =
H^{i - \dim((A/\mathfrak p)_\mathfrak q)}_\mathfrak p(M_\mathfrak p)
$$
is zero (this uses that $\delta$ is a dimension function).
This vanishes by the assumption in the lemma and $i \leq s$ and
Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}.

\medskip\noindent
To prove the converse implication we assume (2) does not hold
and we work backwards through the arguments above. First, we pick a
$\mathfrak q \in T$, $\mathfrak p \subset \mathfrak q$
with $\mathfrak p \not \in T'$ such that
$$
i = \text{depth}_{A_\mathfrak p}(M_\mathfrak p) +
\dim((A/\mathfrak p)_\mathfrak q) \leq s
$$
is minimal. Then
$H^{i - \dim((A/\mathfrak p)_\mathfrak q)}_\mathfrak p(M_\mathfrak p)$
is nonzero by the nonvanishing in
Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}.
Set $n = \delta(\mathfrak q)$. Then
there does not exist an ideal $J \subset A$ with $V(J) \subset T'$
such that $J(E^{-n - i})_\mathfrak q = 0$.
Thus $H^i_\mathfrak q(M_\mathfrak q)$ is not
annihilated by an ideal $J \subset A$ with $V(J) \subset T'$.
By minimality of $i$ it follows from the spectral sequence displayed above
that the module $H^i_T(M)_\mathfrak q$
is not annihilated by an ideal $J \subset A$
with $V(J) \subset T'$. Thus $H^i_T(M)$
is not annihilated by an ideal $J \subset A$
with $V(J) \subset T'$. This finishes the proof of the proposition.
\end{proof}

\begin{lemma}
\label{lemma-kill-local-cohomology-at-prime}
Let $I$ be an ideal of a Noetherian ring $A$.
Let $M$ be a finite $A$-module, let $\mathfrak p \subset A$ be a prime
ideal, and let $s \geq 0$ be an integer. Assume
\begin{enumerate}
\item $A$ has a dualizing complex,
\item $\mathfrak p \not \in V(I)$, and
\item for all primes $\mathfrak p' \subset \mathfrak p$
and $\mathfrak q \in V(I)$ with $\mathfrak p' \subset \mathfrak q$ we have
$$
\text{depth}_{A_{\mathfrak p'}}(M_{\mathfrak p'}) +
\dim((A/\mathfrak p')_\mathfrak q) > s
$$
\end{enumerate}
Then there exists an $f \in A$, $f \not \in \mathfrak p$ which annihilates
$H^i_{V(I)}(M)$ for $i \leq s$.
\end{lemma}

\begin{proof}
Consider the sets
$$
T = V(I)
\quad\text{and}\quad
T' = \bigcup\nolimits_{f \in A, f \not \in \mathfrak p} V(f)
$$
These are subsets of $\Spec(A)$ stable under specialization.
Observe that $T \subset T'$ and $\mathfrak p \not \in T'$.
Assumption (3) says that hypothesis (2) of
Proposition \ref{proposition-annihilator} holds.
Hence we can find $J \subset A$ with $V(J) \subset T'$
such that $J H^i_{V(I)}(M) = 0$ for $i \leq s$.
Choose $f \in A$, $f \not \in \mathfrak p$ with $V(J) \subset V(f)$.
A power of $f$ annihilates $H^i_{V(I)}(M)$ for $i \leq s$.
\end{proof}





\section{Finiteness of local cohomology, II}
\label{section-finiteness-II}

\noindent
We continue the discussion of finiteness of local cohomology started in
Section \ref{section-finiteness}. Using
Faltings Annihilator Theorem
we easily prove the following fundamental result.

\begin{proposition}
\label{proposition-finiteness}
\begin{reference}
\cite{Faltings-annulators}.
\end{reference}
Let $A$ be a Noetherian ring which has a dualizing complex.
Let $T \subset \Spec(A)$ be a subset stable under specialization.
Let $s \geq 0$ an integer. Let $M$ be a finite $A$-module.
The following are equivalent
\begin{enumerate}
\item $H^i_T(M)$ is a finite $A$-module for $i \leq s$, and
\item for all $\mathfrak p \not \in T$, $\mathfrak q \in T$ with
$\mathfrak p \subset \mathfrak q$ we have
$$
\text{depth}_{A_\mathfrak p}(M_\mathfrak p) +
\dim((A/\mathfrak p)_\mathfrak q) > s
$$
\end{enumerate}
\end{proposition}

\begin{proof}
Formal consequence of Proposition \ref{proposition-annihilator} and
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator}.
\end{proof}

\noindent
Besides some lemmas for later use, the rest of this section is
concerned with the question to what extend the condition in
Proposition \ref{proposition-finiteness}
that $A$ has a dualizing complex can be weakened. The answer is roughly
that one has to assume the formal fibres of $A$ are $(S_n)$
for sufficiently large $n$.

\medskip\noindent
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Set $X = \Spec(A)$ and $Z = V(I) \subset X$. Let $M$ be a finite $A$-module.
We define
\begin{equation}
\label{equation-cutoff}
s_{A, I}(M) =
\min \{
\text{depth}_{A_\mathfrak p}(M_\mathfrak p) + \dim((A/\mathfrak p)_\mathfrak q)
\mid
\mathfrak p \in X \setminus Z, \mathfrak q \in Z,
\mathfrak p \subset \mathfrak q
\}
\end{equation}
Our conventions on depth are that the depth of $0$ is $\infty$
thus we only need to consider primes $\mathfrak p$ in the support
of $M$. It will turn out that $s_{A, I}(M)$ is an important invariant of
the situation.

\begin{lemma}
\label{lemma-cutoff}
Let $A \to B$ be a finite homomorphism of Noetherian rings.
Let $I \subset A$ be an ideal and set $J = IB$. Let $M$ be
a finite $B$-module. If $A$ is universally catenary, then
$s_{B, J}(M) = s_{A, I}(M)$.
\end{lemma}

\begin{proof}
Let $\mathfrak p \subset \mathfrak q \subset A$ be primes with
$I \subset \mathfrak q$ and $I \not \subset \mathfrak p$.
Since $A \to B$ is finite there are finitely many primes
$\mathfrak p_i$ lying over $\mathfrak p$. By
Algebra, Lemma \ref{algebra-lemma-depth-goes-down-finite}
we have
$$
\text{depth}(M_\mathfrak p) = \min \text{depth}(M_{\mathfrak p_i})
$$
Let $\mathfrak p_i \subset \mathfrak q_{ij}$ be primes lying
over $\mathfrak q$. By going up for $A \to B$
(Algebra, Lemma \ref{algebra-lemma-integral-going-up})
there is at least one $\mathfrak q_{ij}$ for each $i$.
Then we see that
$$
\dim((B/\mathfrak p_i)_{\mathfrak q_{ij}}) =
\dim((A/\mathfrak p)_\mathfrak q)
$$
by the dimension formula, see
Algebra, Lemma \ref{algebra-lemma-dimension-formula}.
This implies that the minimum of the quantities
used to define $s_{B, J}(M)$
for the pairs $(\mathfrak p_i, \mathfrak q_{ij})$
is equal to the quantity for the pair $(\mathfrak p, \mathfrak q)$.
This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-change-completion}
Let $A$ be a Noetherian ring which has a dualizing complex.
Let $I \subset A$ be an ideal.
Let $M$ be a finite $A$-module. Let $A', M'$ be the $I$-adic
completions of $A, M$. Let $\mathfrak p' \subset \mathfrak q'$
be prime ideals of $A'$ with $\mathfrak q' \in V(IA')$
lying over $\mathfrak p \subset \mathfrak q$ in $A$. Then
$$
\text{depth}_{A_{\mathfrak p'}}(M'_{\mathfrak p'})
\geq
\text{depth}_{A_\mathfrak p}(M_\mathfrak p)
$$
and
$$
\text{depth}_{A_{\mathfrak p'}}(M'_{\mathfrak p'}) +
\dim((A'/\mathfrak p')_{\mathfrak q'}) =
\text{depth}_{A_\mathfrak p}(M_\mathfrak p) +
\dim((A/\mathfrak p)_\mathfrak q)
$$
\end{lemma}

\begin{proof}
We have
$$
\text{depth}(M'_{\mathfrak p'}) =
\text{depth}(M_\mathfrak p) +
\text{depth}(A'_{\mathfrak p'}/\mathfrak p A'_{\mathfrak p'})
\geq \text{depth}(M_\mathfrak p)
$$
by flatness of $A \to A'$, see
Algebra, Lemma \ref{algebra-lemma-apply-grothendieck-module}.
Since the fibres of $A \to A'$ are Cohen-Macaulay
(Dualizing Complexes, Lemma
\ref{dualizing-lemma-dualizing-gorenstein-formal-fibres} and
More on Algebra, Section
\ref{more-algebra-section-properties-formal-fibres})
we see that
$\text{depth}(A'_{\mathfrak p'}/\mathfrak p A'_{\mathfrak p'}) =
\dim(A'_{\mathfrak p'}/\mathfrak p A'_{\mathfrak p'})$.
Thus we obtain
\begin{align*}
\text{depth}(M'_{\mathfrak p'}) +
\dim((A'/\mathfrak p')_{\mathfrak q'})
& =
\text{depth}(M_\mathfrak p) +
\dim(A'_{\mathfrak p'}/\mathfrak p A'_{\mathfrak p'}) +
\dim((A'/\mathfrak p')_{\mathfrak q'}) \\
& =
\text{depth}(M_\mathfrak p) +
\dim((A'/\mathfrak p A')_{\mathfrak q'}) \\
& =
\text{depth}(M_\mathfrak p) +
\dim((A/\mathfrak p)_\mathfrak q)
\end{align*}
Second equality because $A'$ is catenary and third equality by
More on Algebra, Lemma \ref{more-algebra-lemma-completion-dimension}
as $(A/\mathfrak p)_\mathfrak q$ and $(A'/\mathfrak p A')_{\mathfrak q'}$
have the same $I$-adic completions.
\end{proof}





\begin{lemma}
\label{lemma-cutoff-completion}
Let $A$ be a universally catenary Noetherian local ring.
Let $I \subset A$ be an ideal. Let $M$ be
a finite $A$-module. Then
$$
s_{A, I}(M) \geq s_{A^\wedge, I^\wedge}(M^\wedge)
$$
If the formal fibres of $A$ are $(S_n)$, then
$\min(n + 1, s_{A, I}(M)) \leq s_{A^\wedge, I^\wedge}(M^\wedge)$.
\end{lemma}

\begin{proof}
Write $X = \Spec(A)$, $X^\wedge = \Spec(A^\wedge)$, $Z = V(I) \subset X$, and
$Z^\wedge = V(I^\wedge)$.
Let $\mathfrak p' \subset \mathfrak q' \subset A^\wedge$
be primes with $\mathfrak p' \not \in Z^\wedge$ and
$\mathfrak q' \in Z^\wedge$. Let $\mathfrak p \subset \mathfrak q$
be the corresponding primes of $A$. Then $\mathfrak p \not \in Z$
and $\mathfrak q \in Z$. Picture
$$
\xymatrix{
\mathfrak p' \ar[r] & \mathfrak q' \ar[r] & A^\wedge \\
\mathfrak p \ar[r] \ar@{-}[u] &
\mathfrak q \ar[r] \ar@{-}[u] & A \ar[u]
}
$$
Let us write
\begin{align*}
a & = \dim(A/\mathfrak p) = \dim(A^\wedge/\mathfrak pA^\wedge),\\
b & = \dim(A/\mathfrak q) = \dim(A^\wedge/\mathfrak qA^\wedge),\\
a' & = \dim(A^\wedge/\mathfrak p'),\\
b' & = \dim(A^\wedge/\mathfrak q')
\end{align*}
Equalities by
More on Algebra, Lemma \ref{more-algebra-lemma-completion-dimension}.
We also write
\begin{align*}
p & = \dim(A^\wedge_{\mathfrak p'}/\mathfrak p A^\wedge_{\mathfrak p'}) =
\dim((A^\wedge/\mathfrak p A^\wedge)_{\mathfrak p'}) \\
q & = \dim(A^\wedge_{\mathfrak q'}/\mathfrak p A^\wedge_{\mathfrak q'}) =
\dim((A^\wedge/\mathfrak q A^\wedge)_{\mathfrak q'})
\end{align*}
Since $A$ is universally catenary we see that
$A^\wedge/\mathfrak pA^\wedge = (A/\mathfrak p)^\wedge$
is equidimensional of dimension $a$
(More on Algebra, Proposition \ref{more-algebra-proposition-ratliff}).
Hence $a = a' + p$. Similarly $b = b' + q$.
By Algebra, Lemma \ref{algebra-lemma-apply-grothendieck-module}
applied to the flat local ring map
$A_\mathfrak p \to A^\wedge_{\mathfrak p'}$
we have
$$
\text{depth}(M^\wedge_{\mathfrak p'})
=
\text{depth}(M_\mathfrak p) +
\text{depth}(A^\wedge_{\mathfrak p'} / \mathfrak p A^\wedge_{\mathfrak p'})
$$
The quantity we are minimizing for $s_{A, I}(M)$ is
$$
s(\mathfrak p, \mathfrak q) =
\text{depth}(M_\mathfrak p) + \dim((A/\mathfrak p)_\mathfrak q) =
\text{depth}(M_\mathfrak p) + a - b
$$
(last equality as $A$ is catenary). The quantity we are minimizing
for $s_{A^\wedge, I^\wedge}(M^\wedge)$
is
$$
s(\mathfrak p', \mathfrak q') =
\text{depth}(M^\wedge_{\mathfrak p'}) +
\dim((A^\wedge/\mathfrak p')_{\mathfrak q'}) =
\text{depth}(M^\wedge_{\mathfrak p'}) + a' - b'
$$
(last equality as $A^\wedge$ is catenary).
Now we have enough notation in place to start the proof.

\medskip\noindent
Let $\mathfrak p \subset \mathfrak q \subset A$ be primes
with $\mathfrak p \not \in Z$ and $\mathfrak q \in Z$ such that
$s_{A, I}(M) = s(\mathfrak p, \mathfrak q)$.
Then we can pick $\mathfrak q'$ minimal over $\mathfrak q A^\wedge$
and $\mathfrak p' \subset \mathfrak q'$ minimal over
$\mathfrak p A^\wedge$ (using going down for $A \to A^\wedge$).
Then we have four primes as above with $p = 0$ and $q = 0$.
Moreover, we have
$\text{depth}(A^\wedge_{\mathfrak p'} / \mathfrak p A^\wedge_{\mathfrak p'})=0$
also because $p = 0$. This means that
$s(\mathfrak p', \mathfrak q') = s(\mathfrak p, \mathfrak q)$.
Thus we get the first inequality.

\medskip\noindent
Assume that the formal fibres of $A$ are $(S_n)$. Then
$\text{depth}(A^\wedge_{\mathfrak p'} / \mathfrak p A^\wedge_{\mathfrak p'})
\geq \min(n, p)$.
Hence
$$
s(\mathfrak p', \mathfrak q') \geq
s(\mathfrak p, \mathfrak q) + q + \min(n, p) - p \geq
s_{A, I}(M) + q + \min(n, p) - p
$$
Thus the only way we can get in trouble is if $p > n$. If this happens
then
\begin{align*}
s(\mathfrak p', \mathfrak q')
& =
\text{depth}(M^\wedge_{\mathfrak p'}) +
\dim((A^\wedge/\mathfrak p')_{\mathfrak q'}) \\
& =
\text{depth}(M_\mathfrak p) +
\text{depth}(A^\wedge_{\mathfrak p'} / \mathfrak p A^\wedge_{\mathfrak p'}) +
\dim((A^\wedge/\mathfrak p')_{\mathfrak q'}) \\
& \geq
0 + n + 1
\end{align*}
because $(A^\wedge/\mathfrak p')_{\mathfrak q'}$ has at least two primes.
This proves the second inequality.
\end{proof}

\noindent
The method of proof of the following lemma works more generally,
but the stronger results one gets will be subsumed in
Theorem \ref{theorem-finiteness} below.

\begin{lemma}
\label{lemma-local-annihilator}
\begin{reference}
This is a special case of
\cite[Satz 1]{Faltings-annulators}.
\end{reference}
Let $A$ be a Gorenstein Noetherian local ring. Let $I \subset A$
be an ideal and set $Z = V(I) \subset \Spec(A)$.
Let $M$ be a finite $A$-module. Let $s = s_{A, I}(M)$ as in
(\ref{equation-cutoff}). Then $H^i_Z(M)$ is finite for $i < s$,
but $H^s_Z(M)$ is not finite.
\end{lemma}

\begin{proof}
Since a Gorenstein local ring has a dualizing complex,
this is a special case of Proposition \ref{proposition-finiteness}.
It would be helpful to have a short proof of this special case,
which will be used in the proof of a general finiteness theorem below.
\end{proof}

\noindent
Observe that the hypotheses of the following theorem are satisfied
by excellent Noetherian rings (by definition),
by Noetherian rings which have a dualizing complex
(Dualizing Complexes, Lemma \ref{dualizing-lemma-universally-catenary} and
Dualizing Complexes, Lemma
\ref{dualizing-lemma-dualizing-gorenstein-formal-fibres}), and
by quotients of regular Noetherian rings.

\begin{theorem}
\label{theorem-finiteness}
\begin{reference}
This is a special case of \cite[Satz 2]{Faltings-finiteness}.
\end{reference}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Set $Z = V(I) \subset \Spec(A)$. Let $M$ be a finite $A$-module.
Set $s = s_{A, I}(M)$ as in (\ref{equation-cutoff}).
Assume that
\begin{enumerate}
\item $A$ is universally catenary,
\item the formal fibres of the local rings of $A$ are Cohen-Macaulay.
\end{enumerate}
Then $H^i_Z(M)$ is finite for $0 \leq i < s$ and
$H^s_Z(M)$ is not finite.
\end{theorem}

\begin{proof}
By Lemma \ref{lemma-check-finiteness-local-cohomology-locally}
we may assume that $A$ is a local ring.

\medskip\noindent
If $A$ is a Noetherian complete local ring, then we can write $A$
as the quotient of a regular complete local ring $B$ by
Cohen's structure theorem
(Algebra, Theorem \ref{algebra-theorem-cohen-structure-theorem}).
Using Lemma \ref{lemma-cutoff} and
Dualizing Complexes, Lemma
\ref{dualizing-lemma-local-cohomology-and-restriction}
we reduce to the case
of a regular local ring which is a consequence of
Lemma \ref{lemma-local-annihilator}
because a regular local ring is Gorenstein
(Dualizing Complexes, Lemma \ref{dualizing-lemma-regular-gorenstein}).

\medskip\noindent
Let $A$ be a Noetherian local ring. Let $\mathfrak m$ be the maximal ideal.
We may assume $I \subset \mathfrak m$, otherwise the lemma is trivial.
Let $A^\wedge$ be the completion of $A$, let $Z^\wedge = V(IA^\wedge)$, and
let $M^\wedge = M \otimes_A A^\wedge$ be the completion of $M$
(Algebra, Lemma \ref{algebra-lemma-completion-tensor}).
Then $H^i_Z(M) \otimes_A A^\wedge = H^i_{Z^\wedge}(M^\wedge)$ by
Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}
and flatness of $A \to A^\wedge$
(Algebra, Lemma \ref{algebra-lemma-completion-flat}).
Hence it suffices to show that $H^i_{Z^\wedge}(M^\wedge)$ is
finite for $i < s$ and not finite for $i = s$, see
Algebra, Lemma \ref{algebra-lemma-descend-properties-modules}.
Since we know the result is true for $A^\wedge$ it suffices
to show that $s_{A, I}(M) = s_{A^\wedge, I^\wedge}(M^\wedge)$.
This follows from Lemma \ref{lemma-cutoff-completion}.
\end{proof}

\begin{remark}
\label{remark-astute-reader}
The astute reader will have realized that we can get away with a
slightly weaker condition on the formal fibres of the local rings
of $A$. Namely, in the situation of Theorem \ref{theorem-finiteness}
assume $A$ is universally catenary but make no assumptions on
the formal fibres. Suppose we have an $n$ and we want to prove that
$H^i_Z(M)$ are finite for $i \leq n$. Then the exact same proof
shows that it suffices that $s_{A, I}(M) > n$ and that
the formal fibres of local rings of $A$ are $(S_n)$.
On the other hand, if we want to show that $H^s_Z(M)$
is not finite where $s = s_{A, I}(M)$, then our arguments prove
this if the formal fibres are $(S_{s - 1})$.
\end{remark}







\section{Finiteness of pushforwards, II}
\label{section-finiteness-pushforward-II}

\noindent
This section is the continuation of
Section \ref{section-finiteness-pushforward}.
In this section we reap the fruits of the labor done in
Section \ref{section-finiteness-II}.

\begin{lemma}
\label{lemma-finiteness-Rjstar}
Let $X$ be a locally Noetherian scheme. Let $j : U \to X$ be the inclusion
of an open subscheme with complement $Z$. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_U$-module. Let $n \geq 0$ be an integer. Assume
\begin{enumerate}
\item $X$ is universally catenary,
\item for every $z \in Z$ the formal fibres of
$\mathcal{O}_{X, z}$ are $(S_n)$.
\end{enumerate}
In this situation the following are equivalent
\begin{enumerate}
\item[(a)] for $x \in \text{Supp}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ we have
$\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}_x) +
\dim(\mathcal{O}_{\overline{\{x\}}, z}) > n$,
\item[(b)] $R^pj_*\mathcal{F}$ is coherent for $0 \leq p < n$.
\end{enumerate}
\end{lemma}

\begin{proof}
The statement is local on $X$, hence we may assume $X$ is affine.
Say $X = \Spec(A)$ and $Z = V(I)$. Let $M$ be a finite $A$-module
whose associated coherent $\mathcal{O}_X$-module restricts
to $\mathcal{F}$ over $U$, see
Lemma \ref{lemma-finiteness-pushforwards-and-H1-local}.
This lemma also tells us that $R^pj_*\mathcal{F}$ is coherent
if and only if $H^{p + 1}_Z(M)$ is a finite $A$-module.
Observe that the minimum of the expressions
$\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}_x) +
\dim(\mathcal{O}_{\overline{\{x\}}, z})$
is the number $s_{A, I}(M)$ of (\ref{equation-cutoff}).
Having said this the lemma follows from
Theorem \ref{theorem-finiteness}
as elucidated by Remark \ref{remark-astute-reader}.
\end{proof}

\begin{lemma}
\label{lemma-finiteness-for-finite-locally-free}
Let $X$ be a locally Noetherian scheme. Let $j : U \to X$ be the inclusion
of an open subscheme with complement $Z$. Let $n \geq 0$ be an integer.
If $R^pj_*\mathcal{O}_U$ is coherent for $0 \leq p < n$, then
the same is true for $R^pj_*\mathcal{F}$, $0 \leq p < n$
for any finite locally free $\mathcal{O}_U$-module $\mathcal{F}$.
\end{lemma}

\begin{proof}
The question is local on $X$, hence we may assume $X$ is affine.
Say $X = \Spec(A)$ and $Z = V(I)$. Via
Lemma \ref{lemma-finiteness-pushforwards-and-H1-local}
our lemma follows from
Lemma \ref{lemma-local-finiteness-for-finite-locally-free}.
\end{proof}

\begin{lemma}
\label{lemma-annihilate-Hp}
\begin{reference}
\cite[Lemma 1.9]{Bhatt-local}
\end{reference}
Let $A$ be a ring and let $J \subset I \subset A$ be finitely generated ideals.
Let $p \geq 0$ be an integer. Set $U = \Spec(A) \setminus V(I)$. If
$H^p(U, \mathcal{O}_U)$ is annihilated by $J^n$ for some $n$, then
$H^p(U, \mathcal{F})$ annihilated by $J^m$ for some $m = m(\mathcal{F})$
for every finite locally free $\mathcal{O}_U$-module $\mathcal{F}$.
\end{lemma}

\begin{proof}
Consider the annihilator $\mathfrak a$ of $H^p(U, \mathcal{F})$.
Let $u \in U$. There exists an open neighbourhood $u \in U' \subset U$
and an isomorphism
$\varphi : \mathcal{O}_{U'}^{\oplus r} \to \mathcal{F}|_{U'}$.
Pick $f \in A$ such that $u \in D(f) \subset U'$.
There exist maps
$$
a : \mathcal{O}_U^{\oplus r} \longrightarrow \mathcal{F}
\quad\text{and}\quad
b : \mathcal{F} \longrightarrow \mathcal{O}_U^{\oplus r}
$$
whose restriction to $D(f)$ are equal to $f^N \varphi$
and $f^N \varphi^{-1}$ for some $N$. Moreover we may assume that
$a \circ b$ and $b \circ a$ are equal to multiplication by $f^{2N}$.
This follows from Properties, Lemma
\ref{properties-lemma-section-maps-backwards}
since $U$ is quasi-compact ($I$ is finitely generated), separated, and
$\mathcal{F}$ and $\mathcal{O}_U^{\oplus r}$ are finitely presented.
Thus we see that $H^p(U, \mathcal{F})$ is annihilated by
$f^{2N}J^n$, i.e., $f^{2N}J^n \subset \mathfrak a$.

\medskip\noindent
As $U$ is quasi-compact we can find finitely many $f_1, \ldots, f_t$
and $N_1, \ldots, N_t$ such that $U = \bigcup D(f_i)$ and
$f_i^{2N_i}J^n \subset \mathfrak a$. Then $V(I) = V(f_1, \ldots, f_t)$
and since $I$ is finitely generated we conclude
$I^M \subset (f_1, \ldots, f_t)$ for some $M$.
All in all we see that $J^m \subset \mathfrak a$ for
$m \gg 0$, for example $m = M (2N_1 + \ldots + 2N_t) n$  will do.
\end{proof}











\section{Annihilators of local chomology, II}
\label{section-annihilators-II}

\noindent
We extend the discussion of annihilators of local cohomology in
Section \ref{section-annihilators}
to bounded below complexes with finite cohomology modules.

\begin{definition}
\label{definition-depth-complex}
Let $I$ be an ideal of a Noetherian ring $A$. Let
$K \in D^+_{\textit{Coh}}(A)$. We define the {\it $I$-depth} of $K$,
denoted $\text{depth}_I(K)$, to be the maximal
$m \in \mathbf{Z} \cup \{\infty\}$ such that $H^i_I(K) = 0$ for all $i < m$.
If $A$ is local with maximal ideal $\mathfrak m$
then we call $\text{depth}_\mathfrak m(K)$ simply the {\it depth} of $K$.
\end{definition}

\noindent
This definition does not conflict with
Algebra, Definition \ref{algebra-definition-depth}
by Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}.

\begin{proposition}
\label{proposition-annihilator-complex}
Let $A$ be a Noetherian ring which has a dualizing complex.
Let $T \subset T' \subset \Spec(A)$ be subsets stable under
specialization. Let $s \in \mathbf{Z}$. Let $K$ be an object of
$D_{\textit{Coh}}^+(A)$. The following are equivalent
\begin{enumerate}
\item there exists an ideal $J \subset A$ with $V(J) \subset T'$
such that $J$ annihilates $H^i_T(K)$ for $i \leq s$, and
\item for all $\mathfrak p \not \in T'$,
$\mathfrak q \in T$ with $\mathfrak p \subset \mathfrak q$
we have
$$
\text{depth}_{A_\mathfrak p}(K_\mathfrak p) +
\dim((A/\mathfrak p)_\mathfrak q) > s
$$
\end{enumerate}
\end{proposition}

\begin{proof}
This lemma is the natural generalization of
Proposition \ref{proposition-annihilator}
whose proof the reader should read first.
Let $\omega_A^\bullet$ be a dualizing complex. Let $\delta$ be its
dimension function, see Dualizing Complexes, Section
\ref{dualizing-section-dimension-function}.
An important role will be played by the finite $A$-modules
$$
E^i = \Ext_A^i(K, \omega_A^\bullet)
$$
For $\mathfrak p \subset A$ we will write $H^i_\mathfrak p$ to denote the
local cohomology of an object of $D(A_\mathfrak p)$ with respect to
$\mathfrak pA_\mathfrak p$. Then we see that
the $\mathfrak pA_\mathfrak p$-adic completion of
$$
(E^i)_\mathfrak p =
\Ext^{\delta(\mathfrak p) + i}_{A_\mathfrak p}(K_\mathfrak p,
(\omega_A^\bullet)_\mathfrak p[-\delta(\mathfrak p)])
$$
is Matlis dual to
$$
H^{-\delta(\mathfrak p) - i}_{\mathfrak p}(K_\mathfrak p)
$$
by
Dualizing Complexes, Lemma \ref{dualizing-lemma-special-case-local-duality}.
In particular we deduce from this the
following fact: an ideal $J \subset A$ annihilates
$(E^i)_\mathfrak p$ if and only if $J$ annihilates
$H^{-\delta(\mathfrak p) - i}_{\mathfrak p}(K_\mathfrak p)$.

\medskip\noindent
Set $T_n = \{\mathfrak p \in T \mid \delta(\mathfrak p) \leq n\}$.
As $\delta$ is a bounded function, we see that
$T_a = \emptyset$ for $a \ll 0$ and $T_b = T$ for $b \gg 0$.

\medskip\noindent
Assume (2). Let us prove the existence of $J$ as in (1).
We will use a double induction to do this. For $i \leq s$
consider the induction hypothesis $IH_i$:
$H^a_T(K)$ is annihilated by some $J \subset A$ with $V(J) \subset T'$
for $a \leq i$. The case $IH_i$ is trivial for $i$ small
enough because $K$ is bounded below.

\medskip\noindent
Induction step. Assume $IH_{i - 1}$ holds for some $i \leq s$.
Pick $J'$ with $V(J') \subset T'$ annihilating $H^a_T(K)$ for
$a \leq i - 1$ (the induction hypothesis guarantees we can
do this). We will show by descending induction on $n$
that there exists an ideal $J$ with $V(J) \subset T'$ such that the
associated primes of $J H^i_T(K)$ are in $T_n$.
For $n \ll 0$ this implies $JH^i_T(K) = 0$ 
(Algebra, Lemma \ref{algebra-lemma-ass-zero})
and hence $IH_i$ will hold.
The base case $n \gg 0$ is trivial because $T = T_n$ in this case
and all associated primes of $H^i_T(K)$ are in $T$.

\medskip\noindent
Thus we assume given $J$ with the property for $n$.
Let $\mathfrak q \in T_n$. Let $T_\mathfrak q \subset \Spec(A_\mathfrak q)$
be the inverse image of $T$. We have
$H^j_T(K)_\mathfrak q = H^j_{T_\mathfrak q}(K_\mathfrak q)$
by Lemma \ref{lemma-torsion-change-rings}.
Consider the spectral sequence
$$
H_\mathfrak q^p(H^q_{T_\mathfrak q}(K_\mathfrak q))
\Rightarrow
H^{p + q}_\mathfrak q(K_\mathfrak q)
$$
of Lemma \ref{lemma-local-cohomology-ss}.
Below we will find an ideal $J'' \subset A$ with $V(J'') \subset T'$
such that $H^i_\mathfrak q(K_\mathfrak q)$ is annihilated by $J''$ for all
$\mathfrak q \in T_n \setminus T_{n - 1}$.
Claim: $J (J')^i J''$ will work for $n - 1$.
Namely, let $\mathfrak q \in T_n \setminus T_{n - 1}$.
The spectral sequence above defines a filtration
$$
E_\infty^{0, i} = E_{i + 2}^{0, i} \subset \ldots \subset E_3^{0, i} \subset
E_2^{0, i} = H^0_\mathfrak q(H^i_{T_\mathfrak q}(K_\mathfrak q))
$$
The module $E_\infty^{0, i}$ is annihilated by $J''$.
The subquotients $E_j^{0, i}/E_{j + 1}^{0, i}$ for $i + 1 \geq j \geq 2$
are annihilated by $J'$ because the target of $d_j^{0, i}$
is a subquotient of
$$
H^j_\mathfrak q(H^{i - j + 1}_{T_\mathfrak q}(K_\mathfrak q)) =
H^j_\mathfrak q(H^{i - j + 1}_T(K)_\mathfrak q)
$$
and $H^{i - j + 1}_T(K)_\mathfrak q$ is annihilated by $J'$ by choice of $J'$.
Finally, by our choice of $J$ we have
$J H^i_T(K)_\mathfrak q \subset H^0_\mathfrak q(H^i_T(K)_\mathfrak q)$
since the non-closed points of $\Spec(A_\mathfrak q)$ have higher
$\delta$ values. Thus $\mathfrak q$ cannot be an associated prime of
$J(J')^iJ'' H^i_T(K)$ as desired.

\medskip\noindent
By our initial remarks we see that $J''$ should annihilate
$$
(E^{-\delta(\mathfrak q) - i})_\mathfrak q =
(E^{-n - i})_\mathfrak q
$$
for all $\mathfrak q \in T_n \setminus T_{n - 1}$.
But if $J''$ works for one $\mathfrak q$, then it works for all
$\mathfrak q$ in an open neighbourhood of $\mathfrak q$
as the modules $E^{-n - i}$ are finite.
Since every subset of $\Spec(A)$ is Noetherian with the induced
topology (Topology, Lemma \ref{topology-lemma-Noetherian}),
we conclude that it suffices
to prove the existence of $J''$ for one $\mathfrak q$.

\medskip\noindent
Since the ext modules are finite the existence of $J''$ is
equivalent to
$$
\text{Supp}(E^{-n - i}) \cap \Spec(A_\mathfrak q) \subset T'.
$$
This is equivalent to showing the localization of $E^{-n - i}$ at every
$\mathfrak p \subset \mathfrak q$, $\mathfrak p \not \in T'$
is zero. Using local duality over $A_\mathfrak p$ we find that we need
to prove that
$$
H^{i + n - \delta(\mathfrak p)}_\mathfrak p(K_\mathfrak p) =
H^{i - \dim((A/\mathfrak p)_\mathfrak q)}_\mathfrak p(K_\mathfrak p)
$$
is zero (this uses that $\delta$ is a dimension function).
This vanishes by the assumption in the lemma and $i \leq s$ and
our definition of depth in Definition \ref{definition-depth-complex}.

\medskip\noindent
To prove the converse implication we assume (2) does not hold
and we work backwards through the arguments above. First, we pick a
$\mathfrak q \in T$, $\mathfrak p \subset \mathfrak q$
with $\mathfrak p \not \in T'$ such that
$$
i = \text{depth}_{A_\mathfrak p}(K_\mathfrak p) +
\dim((A/\mathfrak p)_\mathfrak q) \leq s
$$
is minimal. Then
$H^{i - \dim((A/\mathfrak p)_\mathfrak q)}_\mathfrak p(K_\mathfrak p)$
is nonzero by the our definition of depth in
Definition \ref{definition-depth-complex}.
Set $n = \delta(\mathfrak q)$. Then
there does not exist an ideal $J \subset A$ with $V(J) \subset T'$
such that $J(E^{-n - i})_\mathfrak q = 0$.
Thus $H^i_\mathfrak q(K_\mathfrak q)$ is not
annihilated by an ideal $J \subset A$ with $V(J) \subset T'$.
By minimality of $i$ it follows from the spectral sequence displayed above
that the module $H^i_T(K)_\mathfrak q$
is not annihilated by an ideal $J \subset A$
with $V(J) \subset T'$. Thus $H^i_T(K)$
is not annihilated by an ideal $J \subset A$
with $V(J) \subset T'$. This finishes the proof of the proposition.
\end{proof}







\section{Finiteness of local cohomology, III}
\label{section-finiteness-III}

\noindent
We extend the discussion of finiteness of local cohomology
in Sections \ref{section-finiteness} and \ref{section-finiteness-II}
to bounded below complexes with finite cohomology modules.

\begin{lemma}
\label{lemma-check-finiteness-local-cohomology-by-annihilator-complex}
Let $A$ be a Noetherian ring. Let $T \subset \Spec(A)$ be a subset stable
under specialization. Let $K$ be an object of $D_{\textit{Coh}}^+(A)$.
Let $n \in \mathbf{Z}$. The following are equivalent
\begin{enumerate}
\item $H^i_T(K)$ is finite for $i \leq n$,
\item there exists an ideal $J \subset A$ with $V(J) \subset T$
such that $J$ annihilates $H^i_T(K)$ for $i \leq n$.
\end{enumerate}
If $T = V(I) = Z$ for an ideal $I \subset A$, then these are also
equivalent to
\begin{enumerate}
\item[(3)] there exists an $e \geq 0$ such that $I^e$ annihilates
$H^i_Z(K)$ for $i \leq n$.
\end{enumerate}
\end{lemma}

\begin{proof}
This lemma is the natural generalization of
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator}
whose proof the reader should read first.
Assume (1) is true. Recall that $H^i_J(K) = H^i_{V(J)}(K)$, see
Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-noetherian}.
Thus $H^i_T(K) = \colim H^i_J(K)$ where the colimit is over ideals
$J \subset A$ with $V(J) \subset T$, see
Lemma \ref{lemma-adjoint-ext}. Since $H^i_T(K)$ is finitely generated
for $i \leq n$ we can find a $J \subset A$ as in (2) such that
$H^i_J(K) \to H^i_T(K)$ is surjective for $i \leq n$.
Thus the finite list of generators are $J$-power torsion elements
and we see that (2) holds with $J$ replaced by some power.

\medskip\noindent
Let $a \in \mathbf{Z}$ be an integer such that $H^i(K) = 0$ for $i < a$.
We prove (2) $\Rightarrow$ (1) by descending induction on $a$.
If $a > n$, then we have $H^i_T(K) = 0$ for $i \leq n$ hence both
(1) and (2) are true and there is nothing to prove.

\medskip\noindent
Assume we have $J$ as in (2). Observe that $N = H^a_T(K) = H^0_T(H^a(K))$
is finite as a submodule of the finite $A$-module $H^a(K)$.
If $n = a$ we are done; so assume $a < n$ from now on. By construction of
$R\Gamma_T$ we find that $H^i_T(N) = 0$ for $i > 0$ and $H^0_T(N) = N$, see
Remark \ref{remark-upshot}. Choose a distinguished triangle
$$
N[-a] \to K \to K' \to N[-a + 1]
$$
Then we see that $H^a_T(K') = 0$ and $H^i_T(K) = H^i_T(K')$ for $i > a$.
We conclude that we may replace $K$ by $K'$. Thus we may assume that
$H^a_T(K) = 0$. This means that the finite set of associated primes of
$H^a(K)$ are not in $T$. By prime avoidance
(Algebra, Lemma \ref{algebra-lemma-silly}) we can find $f \in J$
not contained in any of the associated primes of $H^a(K)$.
Choose a distinguished triangle
$$
L \to K \xrightarrow{f} K \to L[1]
$$
By construction we see that $H^i(L) = 0$ for $i \leq a$.
On the other hand we have a long exact cohomology sequence
$$
0 \to H^{a + 1}_T(L) \to H^{a + 1}_T(K) \xrightarrow{f}
H^{a + 1}_T(K) \to H^{a + 2}_T(L) \to H^{a + 2}_T(K) \xrightarrow{f} \ldots
$$
which breaks into the identification $H^{a + 1}_T(L) = H^{a + 1}_T(K)$
and short exact sequences
$$
0 \to H^{i - 1}_T(K) \to H^i_T(L) \to H^i_T(K) \to 0
$$
for $i \leq n$ since $f \in J$.
We conclude that $J^2$ annihilates $H^i_T(L)$ for $i \leq n$.
By induction hypothesis applied to $L$ we see that $H^i_T(L)$
is finite for $i \leq n$. Using the short exact sequence once more
we see that $H^i_T(K)$ is finite for $i \leq n$ as desired.

\medskip\noindent
We omit the proof of the equivalence of (2) and (3)
in case $T = V(I)$.
\end{proof}

\begin{proposition}
\label{proposition-finiteness-complex}
Let $A$ be a Noetherian ring which has a dualizing complex.
Let $T \subset \Spec(A)$ be a subset stable under specialization.
Let $s \in \mathbf{Z}$. Let $K \in D_{\textit{Coh}}^+(A)$.
The following are equivalent
\begin{enumerate}
\item $H^i_T(K)$ is a finite $A$-module for $i \leq s$, and
\item for all $\mathfrak p \not \in T$, $\mathfrak q \in T$ with
$\mathfrak p \subset \mathfrak q$ we have
$$
\text{depth}_{A_\mathfrak p}(K_\mathfrak p) +
\dim((A/\mathfrak p)_\mathfrak q) > s
$$
\end{enumerate}
\end{proposition}

\begin{proof}
Formal consequence of
Proposition \ref{proposition-annihilator-complex} and
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator-complex}.
\end{proof}






\section{Improving coherent modules}
\label{section-improve}

\noindent
Similar constructions can be found in \cite{EGA} and more recently in
\cite{Kollar-local-global-hulls} and \cite{Kollar-variants}.

\begin{lemma}
\label{lemma-get-depth-1-along-Z}
Let $X$ be a Noetherian scheme. Let $T \subset X$ be a subset
stable under specialization. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_X$-module. Then there is a unique map
$\mathcal{F} \to \mathcal{F}'$ of coherent $\mathcal{O}_X$-modules
such that
\begin{enumerate}
\item $\mathcal{F} \to \mathcal{F}'$ is surjective,
\item $\mathcal{F}_x \to \mathcal{F}'_x$ is an isomorphism for $x \not \in T$,
\item $\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}'_x) \geq 1$ for $x \in T$.
\end{enumerate}
If $f : Y \to X$ is a flat morphism with $Y$ Noetherian, then
$f^*\mathcal{F} \to f^*\mathcal{F}'$ is the corresponding
quotient for $f^{-1}(T) \subset Y$ and $f^*\mathcal{F}$.
\end{lemma}

\begin{proof}
Condition (3) just means that $\text{Ass}(\mathcal{F}') \cap T = \emptyset$.
Thus $\mathcal{F} \to \mathcal{F}'$ is the quotient of $\mathcal{F}$
by the subsheaf of sections whose support is contained in $T$.
This proves uniqueness. The statement on pullbacks follows from
Divisors, Lemma \ref{divisors-lemma-bourbaki}
and the uniqueness.

\medskip\noindent
Existence of $\mathcal{F} \to \mathcal{F}'$.
By the uniqueness it suffices to prove the
existence and uniqueness locally on $X$; small detail omitted.
Thus we may assume $X = \Spec(A)$ is affine and $\mathcal{F}$
is the coherent module associated to the finite $A$-module $M$.
Set $M' = M / H^0_T(M)$ with $H^0_T(M)$ as in Section \ref{section-supports}.
Then $M_\mathfrak p = M'_\mathfrak p$ for $\mathfrak p \not \in T$
which proves (1). On the other hand, we have
$H^0_T(M) = \colim H^0_Z(M)$ where $Z$ runs over the closed
subsets of $X$ contained in $T$. Thus by
Dualizing Complexes, Lemmas \ref{dualizing-lemma-divide-by-torsion}
we have $H^0_T(M') = 0$, i.e., no associated prime
of $M'$ is in $T$. Therefore $\text{depth}(M'_\mathfrak p) \geq 1$
for $\mathfrak p \in T$.
\end{proof}

\begin{lemma}
\label{lemma-get-depth-2-along-Z}
Let $j : U \to X$ be an open immersion of Noetherian schemes.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Assume $\mathcal{F}' = j_*(\mathcal{F}|_U)$ is coherent.
Then $\mathcal{F} \to \mathcal{F}'$ is the unique map
of coherent $\mathcal{O}_X$-modules such that
\begin{enumerate}
\item $\mathcal{F}|_U \to \mathcal{F}'|_U$
is an isomorphism,
\item $\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}'_x) \geq 2$
for $x \in X$, $x \not \in U$.
\end{enumerate}
If $f : Y \to X$ is a flat morphism with $Y$ Noetherian, then
$f^*\mathcal{F} \to f^*\mathcal{F}'$ is the corresponding
map for $f^{-1}(U) \subset Y$.
\end{lemma}

\begin{proof}
Let us show that $\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}'_x) \geq 2$
for $x \in X$, $x \not \in U$. Namely, let $V$ be the punctured spectrum of
$\mathcal{O}_{X, x}$. Then $V$ contains the inverse image of
$U$ along $\Spec(\mathcal{O}_{X, x}) \to X$.
Since $\mathcal{F}' = j_*(\mathcal{F}|_U) =
j_*(\mathcal{F}'|_U)$, the same is true after
base change by the flat morphism $\Spec(\mathcal{O}_{X, z}) \to X$
(Cohomology of Schemes, Lemma
\ref{coherent-lemma-flat-base-change-cohomology}).
A fortiori, the canonical map
$\mathcal{F}'_x \to H^0(V, \mathcal{F}'|_V)$
is an isomorphism. This means that $H^i_{\mathfrak m_x}(\mathcal{F}'_x)$
is zero for $i = 0, 1$, see
Lemma \ref{lemma-finiteness-pushforwards-and-H1-local}.
Thus the depth is at least $2$ by
Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}.

\medskip\noindent
The uniqueness of $\mathcal{F} \to \mathcal{F}'$ follows from
Divisors, Lemma \ref{divisors-lemma-depth-2-hartog}.
The compatibility with flat pullbacks follows from
flat base change, see Cohomology of Schemes, Lemma
\ref{coherent-lemma-flat-base-change-cohomology}.
\end{proof}

\begin{lemma}
\label{lemma-make-S2-along-Z}
Let $X$ be a Noetherian scheme. Let $Z \subset X$ be a closed subscheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module. Assume
$X$ is universally catenary and the formal fibres of local rings have $(S_1)$.
Then there exists a unique map $\mathcal{F} \to \mathcal{F}''$
of coherent $\mathcal{O}_X$-modules such that
\begin{enumerate}
\item $\mathcal{F}_x \to \mathcal{F}''_x$
is an isomorphism for $x \in X \setminus Z$,
\item $\mathcal{F}_x \to \mathcal{F}''_x$ is surjective and
$\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}''_x) = 1$
for $x \in Z$ such that there exists an immediate specialization
$x' \leadsto x$ with $x' \not \in Z$ and $x' \in \text{Ass}(\mathcal{F})$,
\item $\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}''_x) \geq 2$
for the remaining $x \in Z$.
\end{enumerate}
If $f : Y \to X$ is a Cohen-Macaulay morphism with $Y$ Noetherian,
then $f^*\mathcal{F} \to f^*\mathcal{F}''$ satisfies the same properties
with respect to $f^{-1}(Z) \subset Y$.
\end{lemma}

\begin{proof}
Let $\mathcal{F} \to \mathcal{F}'$ be the map constructed in
Lemma \ref{lemma-get-depth-1-along-Z} for the subset $Z$ of $X$.
Recall that $\mathcal{F}'$ is the quotient of $\mathcal{F}$
by the subsheaf of sections supported on $Z$.

\medskip\noindent
We first prove uniqueness. Let $\mathcal{F} \to \mathcal{F}''$
be as in the lemma. We get a factorization
$\mathcal{F} \to \mathcal{F}' \to \mathcal{F}''$
since $\text{Ass}(\mathcal{F}'') \cap Z = \emptyset$
by conditions (2) and (3). Let $U \subset X$ be a maximal open
subscheme such that $\mathcal{F}'|_U \to \mathcal{F}''|_U$
is an isomorphism. We see that $U$ contains all the points
as in (2). Then by Divisors, Lemma \ref{divisors-lemma-depth-2-hartog}
we conclude that $\mathcal{F}'' = j_*(\mathcal{F}'|_U)$.
In this way we get uniqueness (small detail: if we have two
of these $\mathcal{F}''$ then we take the intersection of the opens $U$
we get from either).

\medskip\noindent
Proof of existence. Recall that
$\text{Ass}(\mathcal{F}') = \{x_1, \ldots, x_n\}$
is finite and $x_i \not \in Z$.
Let $Y_i$ be the closure of $\{x_i\}$. Let
$Z_{i, j}$ be the irreducible components of $Z \cap Y_i$.
Observe that $\text{Supp}(\mathcal{F}') \cap Z = \bigcup Z_{i, j}$.
Let $z_{i, j} \in Z_{i, j}$ be the generic point.
Let
$$
d_{i, j} = \dim(\mathcal{O}_{\overline{\{x_i\}}, z_{i, j}})
$$
If $d_{i, j} = 1$, then $z_{i, j}$ is one of the points as in (2).
Thus we do not need to modify $\mathcal{F}'$ at these points.
Furthermore, still assuming $d_{i, j} = 1$, using
Lemma \ref{lemma-depth-function}
we can find an open neighbourhood
$z_{i, j} \in V_{i, j} \subset X$ such that
$\text{depth}_{\mathcal{O}_{X, z}}(\mathcal{F}'_z) \geq 2$
for $z \in Z_{i, j} \cap V_{i, j}$, $z \not = z_{i, j}$.
Set
$$
Z' = X \setminus
\left(
X \setminus Z \cup \bigcup\nolimits_{d_{i, j} = 1} V_{i, j})
\right)
$$
Denote $j' : X \setminus Z' \to X$. By our choice of $Z'$
the assumptions of Lemma \ref{lemma-finiteness-pushforward-general}
are satisfied.
We conclude by setting $\mathcal{F}'' = j'_*(\mathcal{F}'|_{X \setminus Z'})$
and applying Lemma \ref{lemma-get-depth-2-along-Z}.

\medskip\noindent
The final statement follows from the formula for the change in
depth along a flat local homomorphism, see
Algebra, Lemma \ref{algebra-lemma-apply-grothendieck-module}
and the assumption on the fibres of $f$ inherent in $f$ being
Cohen-Macaulay. Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-make-S2-along-T-simple}
Let $X$ be a Noetherian scheme which locally has a dualizing complex.
Let $T' \subset X$ be a subset stable under specialization.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Assume that if $x \leadsto x'$ is an immediate specialization
of points in $X$ with $x' \in T'$ and $x \not \in T'$, then
$\text{depth}(\mathcal{F}_x) \geq 1$.
Then there exists a unique map $\mathcal{F} \to \mathcal{F}''$
of coherent $\mathcal{O}_X$-modules such that
\begin{enumerate}
\item $\mathcal{F}_x \to \mathcal{F}''_x$ is an isomorphism
for $x \not \in T'$,
\item $\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}''_x) \geq 2$
for $x \in T'$.
\end{enumerate}
If $f : Y \to X$ is a Cohen-Macaulay morphism with $Y$ Noetherian,
then $f^*\mathcal{F} \to f^*\mathcal{F}''$ satisfies the same properties
with respect to $f^{-1}(T') \subset Y$.
\end{lemma}

\begin{proof}
Let $\mathcal{F} \to \mathcal{F}'$ be the quotient of $\mathcal{F}$
constructed in Lemma \ref{lemma-get-depth-1-along-Z} using $T'$.
Recall that $\mathcal{F}'$ is the quotient of $\mathcal{F}$
by the subsheaf of sections supported on $T'$.

\medskip\noindent
Proof of uniqueness. Let $\mathcal{F} \to \mathcal{F}''$
be as in the lemma. We get a factorization
$\mathcal{F} \to \mathcal{F}' \to \mathcal{F}''$
since $\text{Ass}(\mathcal{F}'') \cap T' = \emptyset$
by condition (2). Let $U \subset X$ be a maximal open
subscheme such that $\mathcal{F}'|_U \to \mathcal{F}''|_U$
is an isomorphism. We see that $U$ contains all the points of $T'$.
Then by Divisors, Lemma \ref{divisors-lemma-depth-2-hartog}
we conclude that $\mathcal{F}'' = j_*(\mathcal{F}'|_U)$.
In this way we get uniqueness (small detail: if we have two
of these $\mathcal{F}''$ then we take the intersection of the opens $U$
we get from either).

\medskip\noindent
Proof of existence. We will define
$$
\mathcal{F}'' = \colim j_*(\mathcal{F}'|_V)
$$
where $j : V \to X$ runs over the open subschemes such that
$X \setminus V \subset T'$. Observe that the colimit is filtered
as $T'$ is stable under specialization. Each of the
maps $\mathcal{F}' \to j_*(\mathcal{F}'|_V)$ is injective
as $\text{Ass}(\mathcal{F}')$ is disjoint from $T'$.
Thus $\mathcal{F}' \to \mathcal{F}''$ is injective.

\medskip\noindent
Suppose $X = \Spec(A)$ is affine and $\mathcal{F}$
corresponds to the finite $A$-module $M$. Then $\mathcal{F}'$
corresponds to $M' = M / H^0_{T'}(M)$, see proof of
Lemma \ref{lemma-get-depth-1-along-Z}. Applying
Lemmas \ref{lemma-local-cohomology} and \ref{lemma-adjoint-ext}
we see that $\mathcal{F}''$ corresponds to an $A$-module
$M''$ which fits into the short exact sequence
$$
0 \to M' \to M'' \to H^1_{T'}(M') \to 0
$$
By Proposition \ref{proposition-finiteness} and our condition
on immediate specializations in the statement of the lemma
we see that $M''$ is a finite $A$-module. In this way
we see that $\mathcal{F}''$ is coherent.

\medskip\noindent
The final statement follows from the formula for the change in
depth along a flat local homomorphism, see
Algebra, Lemma \ref{algebra-lemma-apply-grothendieck-module}
and the assumption on the fibres of $f$ inherent in $f$ being
Cohen-Macaulay. Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-make-S2-along-T}
Let $X$ be a Noetherian scheme which locally has a dualizing complex.
Let $T' \subset T \subset X$ be subsets stable under specialization
such that if $x \leadsto x'$ is an immediate specialization
of points in $X$ and $x' \in T'$, then $x \in T$. Let $\mathcal{F}$
be a coherent $\mathcal{O}_X$-module.
Then there exists a unique map $\mathcal{F} \to \mathcal{F}''$
of coherent $\mathcal{O}_X$-modules such that
\begin{enumerate}
\item $\mathcal{F}_x \to \mathcal{F}''_x$ is an isomorphism
for $x \not \in T$,
\item $\mathcal{F}_x \to \mathcal{F}''_x$ is surjective
and $\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}''_x) \geq 1$
for $x \in T$, $x \not \in T'$, and
\item $\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}''_x) \geq 2$
for $x \in T'$.
\end{enumerate}
If $f : Y \to X$ is a Cohen-Macaulay morphism with $Y$ Noetherian,
then $f^*\mathcal{F} \to f^*\mathcal{F}''$ satisfies the same properties
with respect to $f^{-1}(T') \subset f^{-1}(T) \subset Y$.
\end{lemma}

\begin{proof}
First, let $\mathcal{F} \to \mathcal{F}'$ be the quotient of $\mathcal{F}$
constructed in Lemma \ref{lemma-get-depth-1-along-Z} using $T$.
Second, let $\mathcal{F}' \to \mathcal{F}''$ be the unique
map of coherent modules construction in
Lemma \ref{lemma-make-S2-along-T-simple} using $T'$.
Then $\mathcal{F} \to \mathcal{F}''$ is as desired.
\end{proof}










\section{Hartshorne-Lichtenbaum vanishing}
\label{section-Hartshorne-Lichtenbaum-vanishing}

\noindent
This and much else besides can be found in \cite{CD}.

\begin{lemma}
\label{lemma-cd-top-vanishing}
Let $A$ be a Noetherian ring of dimension $d$. Let $I \subset I' \subset A$
be ideals. If $I'$ is contained in the Jacobson radical
of $A$ and $\text{cd}(A, I') < d$, then $\text{cd}(A, I) < d$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-cd-dimension} we know $\text{cd}(A, I) \leq d$.
We will use Lemma \ref{lemma-isomorphism} to show
$$
H^d_{V(I')}(A) \to H^d_{V(I)}(A)
$$
is surjective which will finish the proof. Pick
$\mathfrak p \in V(I) \setminus V(I')$. By our assumption
on $I'$ we see that $\mathfrak p$ is not a maximal ideal of $A$.
Hence $\dim(A_\mathfrak p) < d$. Then
$H^d_{\mathfrak pA_\mathfrak p}(A_\mathfrak p) = 0$
by Lemma \ref{lemma-cd-dimension}.
\end{proof}

\begin{lemma}
\label{lemma-cd-top-vanishing-some-module}
Let $A$ be a Noetherian ring of dimension $d$. Let $I \subset A$
be an ideal. If $H^d_{V(I)}(M) = 0$ for some finite $A$-module
whose support contains all the irreducible components of
dimension $d$, then $\text{cd}(A, I) < d$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-cd-dimension} we know $\text{cd}(A, I) \leq d$.
Thus for any finite $A$-module $N$ we have $H^i_{V(I)}(N) = 0$
for $i > d$. Let us say property $\mathcal{P}$ holds for the
finite $A$-module $N$ if $H^d_{V(I)}(N) = 0$.
One of our assumptions is that $\mathcal{P}(M)$ holds.
Observe that $\mathcal{P}(N_1 \oplus N_2)
\Leftrightarrow (\mathcal{P}(N_1) \wedge \mathcal{P}(N_2))$.
Observe that if $N \to N'$ is surjective, then
$\mathcal{P}(N) \Rightarrow \mathcal{P}(N')$ as we
have the vanishing of $H^{d + 1}_{V(I)}$ (see above).
Let $\mathfrak p_1, \ldots, \mathfrak p_n$ be the
minimal primes of $A$ with $\dim(A/\mathfrak p_i) = d$.
Observe that $\mathcal{P}(N)$ holds if the support
of $N$ is disjoint from $\{\mathfrak p_1, \ldots, \mathfrak p_n\}$
for dimension reasons, see Lemma \ref{lemma-cd-dimension}.
For each $i$ set $M_i = M/\mathfrak p_i M$.
This is a finite $A$-module annihilated by $\mathfrak p_i$
whose support is equal to
$V(\mathfrak p_i)$ (here we use the assumption on the support of $M$).
Finally, if $J \subset A$ is an ideal, then we have $\mathcal{P}(JM_i)$
as $JM_i$ is a quotient of a direct sum of copies of $M$.
Thus it follows from Cohomology of Schemes, Lemma
\ref{coherent-lemma-property-higher-rank-cohomological}
that $\mathcal{P}$ holds for every finite $A$-module.
\end{proof}

\begin{lemma}
\label{lemma-top-coh-divisible}
Let $A$ be a Noetherian local ring of dimension $d$. Let $f \in A$
be an element which is not contained in any minimal prime of
dimension $d$. Then $f : H^d_{V(I)}(M) \to H^d_{V(I)}(M)$
is surjective for any finite $A$-module $M$ and any ideal $I \subset A$.
\end{lemma}

\begin{proof}
The support of $M/fM$ has dimension $< d$ by our assumption on $f$.
Thus $H^d_{V(I)}(M/fM) = 0$ by Lemma \ref{lemma-cd-dimension}.
Thus $H^d_{V(I)}(fM) \to H^d_{V(I)}(M)$ is surjective.
Since by Lemma \ref{lemma-cd-dimension} we know $\text{cd}(A, I) \leq d$
we also see that the surjection $M \to fM$, $x \mapsto fx$
induces a surjection $H^d_{V(I)}(M) \to H^d_{V(I)}(fM)$.
\end{proof}

\begin{lemma}
\label{lemma-cd-bound-dualizing}
Let $A$ be a Noetherian local ring with
normalized dualizing complex $\omega_A^\bullet$.
Let $I \subset A$ be an ideal.
If $H^0_{V(I)}(\omega_A^\bullet) = 0$, then $\text{cd}(A, I) < \dim(A)$.
\end{lemma}

\begin{proof}
Set $d = \dim(A)$. Let $\mathfrak p_1, \ldots, \mathfrak p_n \subset A$
be the minimal primes of dimension $d$.
Recall that the finite $A$-module
$H^{-i}(\omega_A^\bullet)$ is nonzero only for
$i \in \{0, \ldots, d\}$ and that the support
of $H^{-i}(\omega_A^\bullet)$ has dimension $\leq i$, see
Lemma \ref{lemma-sitting-in-degrees}.
Set $\omega_A = H^{-d}(\omega_A^\bullet)$.
By prime avoidence (Algebra, Lemma \ref{algebra-lemma-silly})
we can find $f \in A$, $f \not \in \mathfrak p_i$
which annihilates $H^{-i}(\omega_A^\bullet)$ for $i < d$.
Consider the distinguished triangle
$$
\omega_A[d] \to \omega_A^\bullet \to
\tau_{\geq -d + 1}\omega_A^\bullet \to \omega_A[d + 1]
$$
See Derived Categories, Remark
\ref{derived-remark-truncation-distinguished-triangle}.
By Derived Categories, Lemma \ref{derived-lemma-trick-vanishing-composition}
we see that $f^d$ induces the zero endomorphism of
$\tau_{\geq -d + 1}\omega_A^\bullet$.
Using the axioms of a triangulated category, we find a map
$$
\omega_A^\bullet \to \omega_A[d]
$$
whose composition with $\omega_A[d] \to \omega_A^\bullet$ is
multiplication by $f^d$ on $\omega_A[d]$.
Thus we conclude that $f^d$ annihilates $H^d_{V(I)}(\omega_A)$.
By Lemma \ref{lemma-top-coh-divisible} we conlude $H^d_{V(I)}(\omega_A) = 0$.
Then we conclude by Lemma \ref{lemma-cd-top-vanishing-some-module}
and the fact that $(\omega_A)_{\mathfrak p_i}$ is nonzero
(see for example
Dualizing Complexes, Lemma
\ref{dualizing-lemma-nonvanishing-generically-local}).
\end{proof}

\begin{lemma}
\label{lemma-inverse-system-symbolic-powers}
Let $(A, \mathfrak m)$ be a complete Noetherian local domain. Let
$\mathfrak p \subset A$ be a prime ideal of dimension $1$.
For every $n \geq 1$ there is an $m \geq n$ such that
$\mathfrak p^{(m)} \subset \mathfrak p^n$.
\end{lemma}

\begin{proof}
Recall that the symbolic power $\mathfrak p^{(m)}$ is defined as the
kernel of $A \to A_\mathfrak p/\mathfrak p^mA_\mathfrak p$.
Since localization is exact we conclude that in the short exact sequence
$$
0 \to \mathfrak a_n \to A/\mathfrak p^n \to A/\mathfrak p^{(n)} \to 0
$$
the support of $\mathfrak a_n$ is contained in $\{\mathfrak m\}$.
In particular, the inverse system $(\mathfrak a_n)$ is Mittag-Leffler
as each $\mathfrak a_n$ is an Artinian $A$-module.
We conclude that the lemma is equivalent to the requirement
that $\lim \mathfrak a_n = 0$. Let $f \in \lim \mathfrak a_n$.
Then $f$ is an element of $A = \lim A/\mathfrak p^n$
(here we use that $A$ is complete)
which maps to zero in the completion $A_\mathfrak p^\wedge$
of $A_\mathfrak p$. Since $A_\mathfrak p \to A_\mathfrak p^\wedge$
is faithfully flat, we see that $f$ maps to zero in $A_\mathfrak p$.
Since $A$ is a domain we see that $f$ is zero as desired.
\end{proof}

\begin{proposition}
\label{proposition-Hartshorne-Lichtenbaum-vanishing}
\begin{reference}
\cite[Theorem 3.1]{CD}
\end{reference}
Let $A$ be a Noetherian local ring with completion $A^\wedge$.
Let $I \subset A$ be an ideal such that
$$
\dim V(IA^\wedge + \mathfrak p) \geq 1
$$
for every minimal prime $\mathfrak p \subset A^\wedge$ of dimension $\dim(A)$.
Then $\text{cd}(A, I) < \dim(A)$.
\end{proposition}

\begin{proof}
Since $A \to A^\wedge$ is faithfully flat we have
$H^d_{V(I)}(A) \otimes_A A^\wedge = H^d_{V(IA^\wedge)}(A^\wedge)$
by Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}.
Thus we may assume $A$ is complete.

\medskip\noindent
Assume $A$ is complete. Let $\mathfrak p_1, \ldots, \mathfrak p_n \subset A$
be the minimal primes of dimension $d$. Consider the complete local ring
$A_i = A/\mathfrak p_i$. We have $H^d_{V(I)}(A_i) = H^d_{V(IA_i)}(A_i)$
by Dualizing Complexes, Lemma
\ref{dualizing-lemma-local-cohomology-and-restriction}.
By Lemma \ref{lemma-cd-top-vanishing-some-module}
it suffices to prove the lemma for $(A_i, IA_i)$.
Thus we may assume $A$ is a complete local domain.

\medskip\noindent
Assume $A$ is a complete local domain. We can choose a prime ideal
$\mathfrak p \supset I$ with $\dim(A/\mathfrak p) = 1$.
By Lemma \ref{lemma-cd-top-vanishing}
it suffices to prove the lemma for $\mathfrak p$.

\medskip\noindent
By Lemma \ref{lemma-cd-bound-dualizing} it suffices to show that
$H^0_{V(\mathfrak p)}(\omega_A^\bullet) = 0$.
Recall that
$$
H^0_{V(\mathfrak p)}(\omega_A^\bullet) =
\colim \text{Ext}^0_A(A/\mathfrak p^n, \omega_A^\bullet)
$$
By Lemma \ref{lemma-inverse-system-symbolic-powers}
we see that the colimit is the same as
$$
\colim \text{Ext}^0_A(A/\mathfrak p^{(n)}, \omega_A^\bullet)
$$
Since $\text{depth}(A/\mathfrak p^{(n)}) = 1$ we see that
these ext groups are zero by Lemma \ref{lemma-sitting-in-degrees}
as desired.
\end{proof}

\begin{lemma}
\label{lemma-affine-complement}
Let $(A, \mathfrak m)$ be a Noetherian local ring.
Let $I \subset A$ be an ideal. Assume $A$ is excellent,
normal, and $\dim V(I) \geq 1$. Then $\text{cd}(A, I) < \dim(A)$.
In particular, if $\dim(A) = 2$, then $\Spec(A) \setminus V(I)$ is affine.
\end{lemma}

\begin{proof}
By More on Algebra, Lemma
\ref{more-algebra-lemma-completion-normal-local-ring}
the completion $A^\wedge$ is normal and hence a domain.
Thus the assumption of
Proposition \ref{proposition-Hartshorne-Lichtenbaum-vanishing}
holds and we conclude. The statement on affineness
follows from Lemma \ref{lemma-cd-is-one}.
\end{proof}
















\section{Frobenius action}
\label{section-frobenius}

\noindent
Let $p$ be a prime number. Let $A$ be a ring with $p = 0$ in $A$.
The {\it Frobenius endomorphism} of $A$ is the map
$$
F : A \longrightarrow A,
\quad
a \longmapsto a^p
$$
In this section we prove lemmas on modules which have
Frobenius actions.

\begin{lemma}
\label{lemma-annihilator-frobenius-module}
Let $p$ be a prime number. Let $(A, \mathfrak m, \kappa)$
be a Noetherian local ring
with $p = 0$ in $A$. Let $M$ be a finite $A$-module
such that $M \otimes_{A, F} A \cong M$. Then $M$ is finite free.
\end{lemma}

\begin{proof}
Choose a presentation $A^{\oplus m} \to A^{\oplus n} \to M$
which induces an isomorphism $\kappa^{\oplus n} \to M/\mathfrak m M$.
Let $T = (a_{ij})$ be the matrix of the map $A^{\oplus m} \to A^{\oplus n}$.
Observe that $a_{ij} \in \mathfrak m$. Applying base change by
$F$, using right exactness of base change, we get a presentation
$A^{\oplus m} \to A^{\oplus n} \to M$ where the matrix is
$T = (a_{ij}^p)$. Thus we have a presentation with
$a_{ij} \in \mathfrak m^p$. Repeating this construction we
find that for each $e \geq 1$ there exists a presentation with
$a_{ij} \in \mathfrak m^e$. This implies the fitting ideals
(More on Algebra, Definition \ref{more-algebra-definition-fitting-ideal})
$\text{Fit}_k(M)$ for $k < n$ are contained in
$\bigcap_{e \geq 1} \mathfrak m^e$. Since this is zero by
Krull's intersection theorem
(Algebra, Lemma \ref{algebra-lemma-intersect-powers-ideal-module-zero})
we conclude that
$M$ is free of rank $n$ by
More on Algebra, Lemma
\ref{more-algebra-lemma-fitting-ideal-finite-locally-free}.
\end{proof}

\noindent
In this section, we say elements $f_1, \ldots, f_r$ of a ring $A$
are {\it independent} if $\sum a_if_i = 0$ implies
$a_i \in (f_1, \ldots, f_r)$. In other words, with $I = (f_1, \ldots, f_r)$
we have $I/I^2$ is free over $A/I$ with basis $f_1, \ldots, f_r$.

\begin{lemma}
\label{lemma-1}
\begin{reference}
See \cite{Lech-inequalities} and \cite[Lemma 1 page 299]{MatCA}.
\end{reference}
Let $A$ be a ring. If $f_1, \ldots, f_{r - 1}, f_rg_r$
are independent, then $f_1, \ldots, f_r$ are independent.
\end{lemma}

\begin{proof}
Say $\sum a_if_i = 0$. Then $\sum a_ig_rf_i = 0$.
Hence $a_r \in (f_1, \ldots, f_{r - 1}, f_rg_r)$.
Write $a_r = \sum_{i < r} b_i f_i + b f_rg_r$.
Then $0 = \sum_{i < r} (a_i + b_if_r)f_i + bf_r^2g_r$.
Thus $a_i + b_i f_r \in (f_1, \ldots, f_{r - 1}, f_rg_r)$
which implies $a_i \in (f_1, \ldots, f_r)$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-2}
\begin{reference}
See \cite{Lech-inequalities} and \cite[Lemma 2 page 300]{MatCA}.
\end{reference}
Let $A$ be a ring. If $f_1, \ldots, f_{r - 1}, f_rg_r$
are independent and if the $A$-module
$A/(f_1, \ldots, f_{r - 1}, f_rg_r)$ has finite length, then
\begin{align*}
& \text{length}_A(A/(f_1, \ldots, f_{r - 1}, f_rg_r)) \\
& =
\text{length}_A(A/(f_1, \ldots, f_{r - 1}, f_r)) +
\text{length}_A(A/(f_1, \ldots, f_{r - 1}, g_r))
\end{align*}
\end{lemma}

\begin{proof}
We claim there is an exact sequence
$$
0 \to
A/(f_1, \ldots, f_{r - 1}, g_r) \xrightarrow{f_r}
A/(f_1, \ldots, f_{r - 1}, f_rg_r) \to
A/(f_1, \ldots, f_{r - 1}, f_r) \to 0
$$
Namely, if $a f_r \in (f_1, \ldots, f_{r - 1}, f_rg_r)$, then
$\sum_{i < r} a_i f_i + (a + bg_r)f_r = 0$
for some $b, a_i \in A$. Hence
$\sum_{i < r} a_i g_r f_i + (a + bg_r)g_rf_r = 0$
which implies $a + bg_r \in (f_1, \ldots, f_{r - 1}, f_rg_r)$
which means that $a$ maps to zero in $A/(f_1, \ldots, f_{r - 1}, g_r)$.
This proves the claim.
To finish use additivity of lengths
(Algebra, Lemma \ref{algebra-lemma-length-additive}).
\end{proof}

\begin{lemma}
\label{lemma-3}
\begin{reference}
See \cite{Lech-inequalities} and \cite[Lemma 3 page 300]{MatCA}.
\end{reference}
Let $(A, \mathfrak m)$ be a local ring. If $\mathfrak m = (x_1, \ldots, x_r)$
and $x_1^{e_1}, \ldots, x_r^{e_r}$ are independent for some $e_i > 0$,
then $\text{length}_A(A/(x_1^{e_1}, \ldots, x_r^{e_r})) = e_1\ldots e_r$.
\end{lemma}

\begin{proof}
Use Lemmas \ref{lemma-1} and \ref{lemma-2} and induction.
\end{proof}

\begin{lemma}
\label{lemma-flat-extension-independent}
Let $\varphi : A \to B$ be a flat ring map.
If $f_1, \ldots, f_r \in A$ are independent, then
$\varphi(f_1), \ldots, \varphi(f_r) \in B$ are independent.
\end{lemma}

\begin{proof}
Let $I = (f_1, \ldots, f_r)$ and $J = F(I)B$. By flatness we have
$I/I^2 \otimes_A B = J/J^2$. Hence freeness of $I/I^2$ over $A/I$
implies freeness of $J/J^2$ over $B/J$.
\end{proof}

\begin{lemma}[Kunz]
\label{lemma-frobenius-flat-regular}
\begin{reference}
\cite{Kunz-flat}
\end{reference}
Let $p$ be a prime number.
Let $A$ be a Noetherian ring with $p = 0$.
The following are equivalent
\begin{enumerate}
\item $A$ is regular, and
\item $F : A \to A$, $a \mapsto a^p$ is flat.
\end{enumerate}
\end{lemma}

\begin{proof}
Observe that $\Spec(F) : \Spec(A) \to \Spec(A)$ is the identity map.
Being regular is defined in terms of the local rings and being flat
is something about local rings, see
Algebra, Lemma \ref{algebra-lemma-flat-localization}.
Thus we may and do assume $A$ is a Noetherian
local ring with maximal ideal $\mathfrak m$.

\medskip\noindent
Assume $A$ is regular. Let $x_1, \ldots, x_d$ be a
system of parameters for $A$. Applying $F$ we find
$F(x_1), \ldots, F(x_d) = x_1^p, \ldots, x_d^p$,
which is a system of parameters for $A$. Hence $F$ is flat, see
Algebra, Lemmas \ref{algebra-lemma-CM-over-regular-flat} and
\ref{algebra-lemma-regular-ring-CM}.

\medskip\noindent
Conversely, assume $F$ is flat. Write $\mathfrak m = (x_1, \ldots, x_r)$
with $r$ minimal. Then $x_1, \ldots, x_r$ are independent in the sense
defined above. Since $F$ is flat, we see that $x_1^p, \ldots, x_r^p$
are independent, see Lemma \ref{lemma-flat-extension-independent}.
Hence $\text{length}_A(A/(x_1^p, \ldots, x_r^p)) = p^r$ by
Lemma \ref{lemma-3}.
Let $\chi(n) = \text{length}_A(A/\mathfrak m^n)$ and recall
that this is a numerical polynomial of degree $\dim(A)$, see
Algebra, Proposition \ref{algebra-proposition-dimension}.
Choose $n \gg 0$. Observe that
$$
\mathfrak m^{pn + pr} \subset F(\mathfrak m^n)A \subset \mathfrak m^{pn}
$$
as can be seen by looking at monomials in $x_1, \ldots, x_r$. We have
$$
A/F(\mathfrak m^n)A = A/\mathfrak m^n \otimes_{A, F} A
$$
By flatness of $F$ this has length $\chi(n) \text{length}_A(A/F(\mathfrak m)A)$
(Algebra, Lemma \ref{algebra-lemma-pullback-module})
which is equal to $p^r\chi(n)$ by the above. We conclude
$$
\chi(pn + pr) \geq p^r\chi(n) \geq \chi(pn)
$$
Looking at the leading terms this implies $r = \dim(A)$, i.e., $A$ is regular.
\end{proof}




\section{Structure of certain modules}
\label{section-structure}

\noindent
Some results on the structure of certain types of
modules over regular local rings. These types of
results and much more can be found in
\cite{Huneke-Sharp}, \cite{Lyubeznik}, \cite{Lyubeznik2}.

\begin{lemma}
\label{lemma-structure-torsion-D-module-regular}
\begin{reference}
Special case of \cite[Theorem 2.4]{Lyubeznik}
\end{reference}
Let $k$ be a field of characteristic $0$. Let $d \geq 1$.
Let $A = k[[x_1, \ldots, x_d]]$ with maximal ideal $\mathfrak m$.
Let $M$ be an $\mathfrak m$-power torsion $A$-module endowed with
additive operators $D_1, \ldots, D_d$ satisfying the leibniz rule
$$
D_i(fz) = \partial_i(f) z + f D_i(z)
$$
for $f \in A$ and $z \in M$. Here $\partial_i$ is
differentiation with respect to $x_i$.
Then $M$ is isomorphic to a direct sum
of copies of the injective hull $E$ of $k$.
\end{lemma}

\begin{proof}
Choose a set $J$ and an $A$-module homorphism
$\varphi : M \to \bigoplus_{j \in J} E$ which maps
$M[\mathfrak m]$ isomorphically onto
$(\bigoplus_{j \in J} E)[\mathfrak m] = \bigoplus_{j \in J} k$.
We claim that $\varphi$ is an isomorphism, i.e., bijective.

\medskip\noindent
Injective. Let $z \in M$ be nonzero. Since $M$ is $\mathfrak m$-power torsion
we can choose an element $f \in A$ such that $fz \in M[\mathfrak m]$ and
$fz \not = 0$. Then $\varphi(fz) = f\varphi(z)$ is nonzero, hence
$\varphi(z)$ is nonzero.

\medskip\noindent
Surjective. Let $z \in M$. Then $x_1^n z = 0$ for some $n \geq 0$.
We will prove that $z \in x_1M$ by induction on $n$.
If $n = 0$, then $z = 0$ and the result is true.
If $n > 0$, then applying $D_1$ we find $0 = n x_1^{n - 1} z + x_1^nD_1(z)$.
Hence $x_1^{n - 1}(nz + x_1D_1(z)) = 0$. By induction we get
$nz + x_1D_1(z) \in x_1M$. Since $n$ is invertible, we conclude
$z \in x_1M$. Thus we see that $M$ is $x_1$-divisible.
If $\varphi$ is not surjective, then we can choose
$e \in \bigoplus_{j \in J} E$ not in $M$.
Arguing as above we may assume $\mathfrak m e \subset M$,
in particular $x_1 e \in M$. There exists an element
$z_1 \in M$ with $x_1 z_1 = x_1 e$. Hence
$x_1(z_1 - e) = 0$. Replacing $e$ by $e - z_1$
we may assume $e$ is annihilated by $x_1$.
Thus it suffices to prove that
$$
\varphi[x_1] :
M[x_1]
\longrightarrow
\left(\bigoplus\nolimits_{j \in J} E\right)[x_1] =
\bigoplus\nolimits_{j \in J} E[x_1]
$$
is surjective. If $d = 1$, this is true by construction of $\varphi$.
If $d > 1$, then we observe that $E[x_1]$ is the injective hull
of the residue field of $k[[x_2, \ldots, x_d]]$, see
Dualizing Complexes, Lemma \ref{dualizing-lemma-quotient}.
Observe that $M[x_1]$ as a module over $k[[x_2, \ldots, x_d]]$
is $\mathfrak m/(x_1)$-power torsion and comes
equipped with operators $D_2, \ldots, D_d$ satisfying
the displayed Leibniz rule.
Thus by induction on $d$ we conclude that $\varphi[x_1]$
is surjective as desired.
\end{proof}

\begin{lemma}
\label{lemma-structure-torsion-Frobenius-regular}
\begin{reference}
Follows from \cite[Corollary 3.6]{Huneke-Sharp} with a
little bit of work. Also follows directly from
\cite[Theorem 1.4]{Lyubeznik2}.
\end{reference}
Let $p$ be a prime number. Let $(A, \mathfrak m, k)$
be a regular local ring with $p = 0$. Denote $F : A \to A$, $a \mapsto a^p$
be the Frobenius endomorphism. Let $M$ be a $\mathfrak m$-power torsion module
such that $M \otimes_{A, F} A \cong M$. Then $M$ is isomorphic to a direct sum
of copies of the injective hull $E$ of $k$.
\end{lemma}

\begin{proof}
Choose a set $J$ and an $A$-module homorphism
$\varphi : M \to \bigoplus_{j \in J} E$ which maps
$M[\mathfrak m]$ isomorphically onto
$(\bigoplus_{j \in J} E)[\mathfrak m] = \bigoplus_{j \in J} k$.
We claim that $\varphi$ is an isomorphism, i.e., bijective.

\medskip\noindent
Injective. Let $z \in M$ be nonzero. Since $M$ is $\mathfrak m$-power torsion
we can choose an element $f \in A$ such that $fz \in M[\mathfrak m]$ and
$fz \not = 0$. Then $\varphi(fz) = f\varphi(z)$ is nonzero, hence
$\varphi(z)$ is nonzero.

\medskip\noindent
Surjective. Recall that $F$ is flat, see
Lemma \ref{lemma-frobenius-flat-regular}.
Let $x_1, \ldots, x_d$ be a minimal system of generators of
$\mathfrak m$. Denote
$$
M_n = M[x_1^{p^n}, \ldots, x_d^{p^n}]
$$
the submodule of $M$ consisting of elements killed by
$x_1^{p^n}, \ldots, x_d^{p^n}$. So $M_0 = M[\mathfrak m]$
is a vector space over $k$. Also $M = \bigcup M_n$ by our
assumption that $M$ is $\mathfrak m$-power torsion. Since $F^n$ is flat and
$F^n(x_i) = x_i^{p^n}$ we have
$$
M_n \cong (M \otimes_{A, F^n} A)[x_1^{p^n}, \ldots, x_d^{p^n}] =
M[x_1, \ldots, x_d] \otimes_{A, F} A =
M_0 \otimes_k A/(x_1^{p^n}, \ldots, x_d^{p^n})
$$
Thus $M_n$ is free over $A/(x_1^{p^n}, \ldots, x_d^{p^n})$.
A computation shows that every element of $A/(x_1^{p^n}, \ldots, x_d^{p^n})$
annihilated by $x_1^{p^n - 1}$ is divisible by $x_1$; for example
you can use that $A/(x_1^{p^n}, \ldots, x_d^{p^n}) \cong
k[x_1, \ldots, x_d]/(x_1^{p^n}, \ldots, x_d^{p^n})$ by Algebra, Lemma
\ref{algebra-lemma-regular-complete-containing-coefficient-field}.
Thus the same is true for every element of $M_n$.
Since every element of $M$ is in $M_n$ for all $n \gg 0$
and since every element of $M$ is killed by some power of
$x_1$, we conclude that $M$ is $x_1$-divisible.

\medskip\noindent
Let $x = x_1$. Above we have seen that $M$ is $x$-divisible.
If $\varphi$ is not surjective, then we can choose
$e \in \bigoplus_{j \in J} E$ not in $M$.
Arguing as above we may assume $\mathfrak m e \subset M$,
in particular $x e \in M$. There exists an element
$z_1 \in M$ with $x z_1 = x e$. Hence
$x(z_1 - e) = 0$. Replacing $e$ by $e - z_1$
we may assume $e$ is annihilated by $x$.
Thus it suffices to prove that
$$
\varphi[x] :
M[x]
\longrightarrow
\left(\bigoplus\nolimits_{j \in J} E\right)[x] =
\bigoplus\nolimits_{j \in J} E[x]
$$
is surjective. If $d = 1$, this is true by construction of $\varphi$.
If $d > 1$, then we observe that $E[x]$ is the injective hull
of the residue field of the regular ring $A/xA$, see
Dualizing Complexes, Lemma \ref{dualizing-lemma-quotient}.
Observe that $M[x]$ as a module over $A/xA$
is $\mathfrak m/(x)$-power torsion and we have
\begin{align*}
M[x] \otimes_{A/xA, F} A/xA
& = M[x] \otimes_{A, F} A \otimes_A A/xA \\
& = (M \otimes_{A, F} A)[x^p] \otimes_A A/xA \\
& \cong M[x^p] \otimes_A A/xA
\end{align*}
Argue using flatness of $F$ as before.
We claim that $M[x^p] \otimes_A A/xA \to M[x]$,
$z \otimes 1 \mapsto x^{p - 1}z$ is an isomorphism.
This can be seen by proving it for
each of the modules $M_n$, $n > 0$ defined above
where it follows by the same result for
$A/(x_1^{p^n}, \ldots, x_d^{p^n})$ and $x = x_1$.
Thus by induction on $\dim(A)$ we conclude that $\varphi[x]$
is surjective as desired.
\end{proof}





\section{Additional structure on local cohomology}
\label{section-additional}

\noindent
Here is a sample result.

\begin{lemma}
\label{lemma-derivation}
Let $A$ be a ring. Let $I \subset A$ be a finitely generated ideal.
Set $Z = V(I)$.
For each derivation $\theta : A \to A$ there exists a canonical
additive operator $D$ on the local cohomology modules
$H^i_Z(A)$ satisfying the Leibniz rule with respect to $\theta$.
\end{lemma}

\begin{proof}
Let $f_1, \ldots, f_r$ be elements generating $I$.
Recall that $R\Gamma_Z(A)$ is computed by the complex
$$
A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}}
\to \ldots \to A_{f_1\ldots f_r}
$$
See Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-adjoint}.
Since $\theta$ extends uniquely to an additive operator on
any localization of $A$ satisfying the Leibniz rule with
respect to $\theta$, the lemma is clear.
\end{proof}

\begin{lemma}
\label{lemma-frobenius}
Let $p$ be a prime number. Let $A$ be a ring with $p = 0$.
Denote $F : A \to A$, $a \mapsto a^p$ the Frobenius endomorphism.
Let $I \subset A$ be a finitely generated ideal. Set $Z = V(I)$.
There exists an isomorphism
$R\Gamma_Z(A) \otimes_{A, F}^\mathbf{L} A \cong R\Gamma_Z(A)$.
\end{lemma}

\begin{proof}
Follows from Dualizing Complexes, Lemma
\ref{dualizing-lemma-torsion-change-rings}
and the fact that $Z = V(f_1^p, \ldots, f_r^p)$
if $I = (f_1, \ldots, f_r)$.
\end{proof}

\begin{lemma}
\label{lemma-etale-derivation}
Let $A$ be a ring. Let $V \to \Spec(A)$ be quasi-compact, quasi-separated,
and \'etale. For each derivation $\theta : A \to A$ there exists a canonical
additive operator $D$ on $H^i(V, \mathcal{O}_V)$
satisfying the Leibniz rule with respect to $\theta$.
\end{lemma}

\begin{proof}
If $V$ is separated, then we can argue using an affine open covering
$V = \bigcup_{j = 1, \ldots m} V_j$. Namely, because $V$ is separated
we may write $V_{j_0 \ldots j_p} = \Spec(B_{j_0 \ldots j_p})$.
See Schemes, Lemma \ref{schemes-lemma-characterize-separated}. Then we
find that the $A$-module $H^i(V, \mathcal{O}_V)$
is the $i$th cohomology group of the {\v C}ech complex
$$
\prod B_{j_0} \to
\prod B_{j_0j_1} \to
\prod B_{j_0j_1j_2} \to \ldots
$$
See Cohomology of Schemes, Lemma
\ref{coherent-lemma-cech-cohomology-quasi-coherent}.
Each $B = B_{j_0 \ldots j_p}$ is an \'etale $A$-algebra.
Hence $\Omega_B = \Omega_A \otimes_A B$ and we conclude
$\theta$ extends uniquely to a derivation $\theta_B : B \to B$.
These maps define an endomorphism of the {\v C}ech complex
and define the desired operators on the cohomology groups.

\medskip\noindent
In the general case we use a hypercovering of $V$ by
affine opens, exactly as in the first part of the proof of
Cohomology of Schemes, Lemma \ref{coherent-lemma-hypercoverings}.
We omit the details.
\end{proof}

\begin{remark}
\label{remark-higher-order-operators}
We can upgrade Lemmas \ref{lemma-derivation} and \ref{lemma-etale-derivation}
to include higher order differential operators.
If we ever need this we will state and prove a
precise lemma here.
\end{remark}

\begin{lemma}
\label{lemma-etale-frobenius}
Let $p$ be a prime number. Let $A$ be a ring with $p = 0$.
Denote $F : A \to A$, $a \mapsto a^p$ the Frobenius endomorphism.
If $V \to \Spec(A)$ is quasi-compact, quasi-separated,
and \'etale, then there exists an isomorphism
$R\Gamma(V, \mathcal{O}_V) \otimes_{A, F}^\mathbf{L} A \cong
R\Gamma(V, \mathcal{O}_V)$.
\end{lemma}

\begin{proof}
Observe that the relative Frobenius morphism
$$
V \longrightarrow V \times_{\Spec(A), \Spec(F)} \Spec(A)
$$
of $V$ over $A$ is an isomorphism, see
\'Etale Morphisms, Lemma \ref{etale-lemma-relative-frobenius-etale}.
Thus the lemma follows from cohomology and base change, see
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-compare-base-change}.
Observe that since $V$ is \'etale over $A$, it is flat over $A$.
\end{proof}





\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
