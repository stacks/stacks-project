\input{preamble}

% OK, start here.
%
\begin{document}

\title{Divided Power Algebra}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we talk about divided power algebras and what
you can do with them. A reference is the book \cite{Berthelot}.





\section{Divided powers}
\label{section-divided-powers}

\noindent
In this section we collect some results on divided power rings.
We will use the convention $0! = 1$ (as empty products should give $1$).

\begin{definition}
\label{definition-divided-powers}
Let $A$ be a ring. Let $I$ be an ideal of $A$. A collection of maps
$\gamma_n : I \to I$, $n > 0$ is called a {\it divided power structure}
on $I$ if for all $n \geq 0$, $m > 0$, $x, y \in I$, and $a \in A$ we have
\begin{enumerate}
\item $\gamma_1(x) = x$, we also set $\gamma_0(x) = 1$,
\item $\gamma_n(x)\gamma_m(x) = \frac{(n + m)!}{n! m!} \gamma_{n + m}(x)$,
\item $\gamma_n(ax) = a^n \gamma_n(x)$,
\item $\gamma_n(x + y) = \sum_{i = 0, \ldots, n} \gamma_i(x)\gamma_{n - i}(y)$,
\item $\gamma_n(\gamma_m(x)) = \frac{(nm)!}{n! (m!)^n} \gamma_{nm}(x)$.
\end{enumerate}
\end{definition}

\noindent
Note that the rational numbers $\frac{(n + m)!}{n! m!}$
and $\frac{(nm)!}{n! (m!)^n}$ occurring in the definition are in fact integers;
the first is the number of ways to choose $n$ out of $n + m$ and
the second counts the number of ways to divide a group of $nm$
objects into $n$ groups of $m$.
We make some remarks about the definition which show that
$\gamma_n(x)$ is a replacement for $x^n/n!$ in $I$.

\begin{lemma}
\label{lemma-silly}
Let $A$ be a ring. Let $I$ be an ideal of $A$.
\begin{enumerate}
\item If $\gamma$ is a divided power structure\footnote{Here
and in the following, $\gamma$ stands short for a sequence
of maps $\gamma_1, \gamma_2, \gamma_3, \ldots$ from $I$ to $I$.}
on $I$, then
$n! \gamma_n(x) = x^n$ for $n \geq 1$, $x \in I$.
\end{enumerate}
Assume $A$ is torsion free as a $\mathbf{Z}$-module.
\begin{enumerate}
\item[(2)] A divided power structure on $I$, if it exists, is unique.
\item[(3)] If $\gamma_n : I \to I$ are maps then
$$
\gamma\text{ is a divided power structure}
\Leftrightarrow
n! \gamma_n(x) = x^n\ \forall x \in I, n \geq 1.
$$
\item[(4)] The ideal $I$ has a divided power structure
if and only if there exists
a set of generators $x_i$ of $I$ as an ideal such that
for all $n \geq 1$ we have $x_i^n \in (n!)I$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). If $\gamma$ is a divided power structure, then condition
(2) (applied to $1$ and $n-1$ instead of $n$ and $m$)
implies that $n \gamma_n(x) = \gamma_1(x)\gamma_{n - 1}(x)$. Hence
by induction and condition (1) we get $n! \gamma_n(x) = x^n$.

\medskip\noindent
Assume $A$ is torsion free as a $\mathbf{Z}$-module.
Proof of (2). This is clear from (1).

\medskip\noindent
Proof of (3). Assume that $n! \gamma_n(x) = x^n$ for all $x \in I$ and
$n \geq 1$. Since $A \subset A \otimes_{\mathbf{Z}} \mathbf{Q}$ it suffices
to prove the axioms (1) -- (5) of Definition
\ref{definition-divided-powers} in case $A$ is a $\mathbf{Q}$-algebra.
In this case $\gamma_n(x) = x^n/n!$ and it is straightforward
to verify (1) -- (5); for example, (4) corresponds to the binomial
formula
$$
(x + y)^n = \sum_{i = 0, \ldots, n} \frac{n!}{i!(n - i)!} x^iy^{n - i}
$$
We encourage the reader to do the verifications
to make sure that we have the coefficients correct.

\medskip\noindent
Proof of (4). Assume we have generators $x_i$ of $I$ as an ideal
such that $x_i^n \in (n!)I$ for all $n \geq 1$. We claim that
for all $x \in I$ we have $x^n \in (n!)I$. If the claim holds then
we can set $\gamma_n(x) = x^n/n!$ which is a divided power structure by (3).
To prove the claim we note that it holds for $x = ax_i$. Hence we see
that the claim holds for a set of generators of $I$ as an abelian group.
By induction on the length of an expression in terms of these, it suffices
to prove the claim for $x + y$ if it holds for $x$ and $y$. This
follows immediately from the binomial theorem.
\end{proof}

\begin{example}
\label{example-ideal-generated-by-p}
Let $p$ be a prime number.
Let $A$ be a ring such that every integer $n$ not divisible by $p$
is invertible, i.e., $A$ is a $\mathbf{Z}_{(p)}$-algebra. Then
$I = pA$ has a canonical divided power structure. Namely, given
$x = pa \in I$ we set
$$
\gamma_n(x) = \frac{p^n}{n!} a^n
$$
The reader verifies immediately that $p^n/n! \in p\mathbf{Z}_{(p)}$
for $n \geq 1$ (for instance, this can be derived from the fact
that the exponent of $p$ in the prime factorization of $n!$ is
$\left\lfloor n/p \right\rfloor + \left\lfloor n/p^2 \right\rfloor
+ \left\lfloor n/p^3 \right\rfloor + \ldots$),
so that the definition makes sense and gives us a sequence of
maps $\gamma_n : I \to I$. It is a straightforward exercise to
verify that conditions (1) -- (5) of
Definition \ref{definition-divided-powers} are satisfied.
Alternatively, it is clear that the definition works for
$A_0 = \mathbf{Z}_{(p)}$ and then the result follows from
Lemma \ref{lemma-gamma-extends}.
\end{example}

\noindent
We notice that $\gamma_n\left(0\right) = 0$ for any ideal $I$ of
$A$ and any divided power structure $\gamma$ on $I$. (This follows
from axiom (3) in Definition \ref{definition-divided-powers},
applied to $a=0$.)

\begin{lemma}
\label{lemma-check-on-generators}
Let $A$ be a ring. Let $I$ be an ideal of $A$. Let $\gamma_n : I \to I$,
$n \geq 1$ be a sequence of maps. Assume
\begin{enumerate}
\item[(a)] (1), (3), and (4) of Definition \ref{definition-divided-powers}
hold for all $x, y \in I$, and
\item[(b)] properties (2) and (5) hold for $x$ in
some set of generators of $I$ as an ideal.
\end{enumerate}
Then $\gamma$ is a divided power structure on $I$.
\end{lemma}

\begin{proof}
The numbers (1), (2), (3), (4), (5) in this proof refer to the
conditions listed in Definition \ref{definition-divided-powers}.
Applying (3) we see that if (2) and (5) hold for $x$ then (2) and (5)
hold for $ax$ for all $a \in A$. Hence we see (b) implies
(2) and (5) hold for a set of generators
of $I$ as an abelian group. Hence, by induction of the length
of an expression in terms of these it suffices to prove that, given
$x, y \in I$ such that (2) and (5) hold for $x$ and $y$, then (2) and (5) hold
for $x + y$.

\medskip\noindent
Proof of (2) for $x + y$. By (4) we have
$$
\gamma_n(x + y)\gamma_m(x + y) =
\sum\nolimits_{i + j = n,\ k + l = m}
\gamma_i(x)\gamma_k(x)\gamma_j(y)\gamma_l(y)
$$
Using (2) for $x$ and $y$ this equals
$$
\sum \frac{(i + k)!}{i!k!}\frac{(j + l)!}{j!l!}
\gamma_{i + k}(x)\gamma_{j + l}(y)
$$
Comparing this with the expansion
$$
\gamma_{n + m}(x + y) = \sum \gamma_a(x)\gamma_b(y)
$$
we see that we have to prove that given $a + b = n + m$ we have
$$
\sum\nolimits_{i + k = a,\ j + l = b,\ i + j = n,\ k + l = m}
\frac{(i + k)!}{i!k!}\frac{(j + l)!}{j!l!}
=
\frac{(n + m)!}{n!m!}.
$$
Instead of arguing this directly, we note that the result is true
for the ideal $I = (x, y)$ in the polynomial ring $\mathbf{Q}[x, y]$
because $\gamma_n(f) = f^n/n!$, $f \in I$ defines a divided power
structure on $I$. Hence the equality of rational numbers above is true.

\medskip\noindent
Proof of (5) for $x + y$ given that (1) -- (4) hold and that (5)
holds for $x$ and $y$. We will again reduce the proof to an equality
of rational numbers. Namely, using (4) we can write
$\gamma_n(\gamma_m(x + y)) = \gamma_n(\sum \gamma_i(x)\gamma_j(y))$.
Using (4) we can write
$\gamma_n(\gamma_m(x + y))$ as a sum of terms which are products of
factors of the form $\gamma_k(\gamma_i(x)\gamma_j(y))$.
If $i > 0$ then
\begin{align*}
\gamma_k(\gamma_i(x)\gamma_j(y)) & =
\gamma_j(y)^k\gamma_k(\gamma_i(x)) \\
& = \frac{(ki)!}{k!(i!)^k} \gamma_j(y)^k \gamma_{ki}(x) \\
& =
\frac{(ki)!}{k!(i!)^k} \frac{(kj)!}{(j!)^k} \gamma_{ki}(x) \gamma_{kj}(y)
\end{align*}
using (3) in the first equality, (5) for $x$ in the second, and
(2) exactly $k$ times in the third. Using (5) for $y$ we see the
same equality holds when $i = 0$. Continuing like this using all
axioms but (5) we see that we can write
$$
\gamma_n(\gamma_m(x + y)) =
\sum\nolimits_{i + j = nm} c_{ij}\gamma_i(x)\gamma_j(y)
$$
for certain universal constants $c_{ij} \in \mathbf{Z}$. Again the fact
that the equality is valid in the polynomial ring $\mathbf{Q}[x, y]$
implies that the coefficients $c_{ij}$ are all equal to $(nm)!/n!(m!)^n$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-two-ideals}
Let $A$ be a ring with two ideals $I, J \subset A$.
Let $\gamma$ be a divided power structure on $I$ and let
$\delta$ be a divided power structure on $J$.
Then
\begin{enumerate}
\item $\gamma$ and $\delta$ agree on $IJ$,
\item if $\gamma$ and $\delta$ agree on $I \cap J$ then they are
the restriction of a unique divided power structure $\epsilon$
on $I + J$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $x \in I$ and $y \in J$. Then
$$
\gamma_n(xy) = y^n\gamma_n(x) = n! \delta_n(y) \gamma_n(x) =
\delta_n(y) x^n = \delta_n(xy).
$$
Hence $\gamma$ and $\delta$ agree on a set of (additive) generators
of $IJ$. By property (4) of Definition \ref{definition-divided-powers}
it follows that they agree on all of $IJ$.

\medskip\noindent
Assume $\gamma$ and $\delta$ agree on $I \cap J$.
Let $z \in I + J$. Write $z = x + y$ with $x \in I$ and $y \in J$.
Then we set
$$
\epsilon_n(z) = \sum \gamma_i(x)\delta_{n - i}(y)
$$
for all $n \geq 1$.
To see that this is well defined, suppose that $z = x' + y'$ is another
representation with $x' \in I$ and $y' \in J$. Then
$w = x - x' = y' - y \in I \cap J$. Hence
\begin{align*}
\sum\nolimits_{i + j = n} \gamma_i(x)\delta_j(y)
& =
\sum\nolimits_{i + j = n} \gamma_i(x' + w)\delta_j(y) \\
& =
\sum\nolimits_{i' + l + j = n} \gamma_{i'}(x')\gamma_l(w)\delta_j(y) \\
& =
\sum\nolimits_{i' + l + j = n} \gamma_{i'}(x')\delta_l(w)\delta_j(y) \\
& =
\sum\nolimits_{i' + j' = n} \gamma_{i'}(x')\delta_{j'}(y + w) \\
& =
\sum\nolimits_{i' + j' = n} \gamma_{i'}(x')\delta_{j'}(y')
\end{align*}
as desired. Hence, we have defined maps
$\epsilon_n : I + J \to I + J$ for all $n \geq 1$; it is easy
to see that $\epsilon_n \mid_{I} = \gamma_n$ and
$\epsilon_n \mid_{J} = \delta_n$.
Next, we prove conditions (1) -- (5) of
Definition \ref{definition-divided-powers} for the collection
of maps $\epsilon_n$.
Properties (1) and (3) are clear. To see (4), suppose
that $z = x + y$ and $z' = x' + y'$ with $x, x' \in I$ and $y, y' \in J$
and compute
\begin{align*}
\epsilon_n(z + z') & =
\sum\nolimits_{a + b = n} \gamma_a(x + x')\delta_b(y + y') \\
& =
\sum\nolimits_{i + i' + j + j' = n}
\gamma_i(x) \gamma_{i'}(x')\delta_j(y)\delta_{j'}(y') \\
& =
\sum\nolimits_{k = 0, \ldots, n}
\sum\nolimits_{i+j=k} \gamma_i(x)\delta_j(y)
\sum\nolimits_{i'+j'=n-k} \gamma_{i'}(x')\delta_{j'}(y') \\
& =
\sum\nolimits_{k = 0, \ldots, n}\epsilon_k(z)\epsilon_{n-k}(z')
\end{align*}
as desired. Now we see that it suffices to prove (2) and (5) for
elements of $I$ or $J$, see Lemma \ref{lemma-check-on-generators}.
This is clear because $\gamma$ and $\delta$ are divided power
structures.

\medskip\noindent
The existence of a divided power structure $\epsilon$ on $I+J$
whose restrictions to $I$ and $J$ are $\gamma$ and $\delta$ is
thus proven; its uniqueness is rather clear.
\end{proof}

\begin{lemma}
\label{lemma-nil}
Let $p$ be a prime number. Let $A$ be a ring, let $I \subset A$ be an ideal,
and let $\gamma$ be a divided power structure on $I$. Assume $p$ is nilpotent
in $A/I$. Then $I$ is locally nilpotent if and only if $p$ is nilpotent in $A$.
\end{lemma}

\begin{proof}
If $p^N = 0$ in $A$, then for $x \in I$ we have
$x^{pN} = (pN)!\gamma_{pN}(x) = 0$ because $(pN)!$ is
divisible by $p^N$. Conversely, assume $I$ is locally nilpotent.
We've also assumed that $p$ is nilpotent in $A/I$, hence
$p^r \in I$ for some $r$, hence $p^r$ nilpotent, hence $p$ nilpotent.
\end{proof}








\section{Divided power rings}
\label{section-divided-power-rings}

\noindent
There is a category of divided power rings.
Here is the definition.

\begin{definition}
\label{definition-divided-power-ring}
A {\it divided power ring} is a triple $(A, I, \gamma)$ where
$A$ is a ring, $I \subset A$ is an ideal, and $\gamma = (\gamma_n)_{n \geq 1}$
is a divided power structure on $I$.
A {\it homomorphism of divided power rings}
$\varphi : (A, I, \gamma) \to (B, J, \delta)$ is a ring homomorphism
$\varphi : A \to B$ such that $\varphi(I) \subset J$ and such that
$\delta_n(\varphi(x)) = \varphi(\gamma_n(x))$ for all $x \in I$ and
$n \geq 1$.
\end{definition}

\noindent
We sometimes say ``let $(B, J, \delta)$ be a divided power algebra over
$(A, I, \gamma)$'' to indicate that $(B, J, \delta)$ is a divided power ring
which comes equipped with a homomorphism of divided power rings
$(A, I, \gamma) \to (B, J, \delta)$.

\begin{lemma}
\label{lemma-limits}
The category of divided power rings has all limits and they agree with
limits in the category of rings.
\end{lemma}

\begin{proof}
The empty limit is the zero ring (that's weird but we need it).
The product of a collection of divided power rings $(A_t, I_t, \gamma_t)$,
$t \in T$ is given by $(\prod A_t, \prod I_t, \gamma)$ where
$\gamma_n((x_t)) = (\gamma_{t, n}(x_t))$.
The equalizer of $\alpha, \beta : (A, I, \gamma) \to (B, J, \delta)$
is just $C = \{a \in A \mid \alpha(a) = \beta(a)\}$ with ideal $C \cap I$
and induced divided powers. It follows that all limits exist, see
Categories, Lemma \ref{categories-lemma-limits-products-equalizers}.
\end{proof}

\noindent
The following lemma illustrates a very general category theoretic
phenomenon in the case of divided power algebras.

\begin{lemma}
\label{lemma-a-version-of-brown}
Let $\mathcal{C}$ be the category of divided power rings. Let
$F : \mathcal{C} \to \textit{Sets}$ be a functor.
Assume that
\begin{enumerate}
\item there exists a cardinal $\kappa$ such that for every
$f \in F(A, I, \gamma)$ there exists a morphism
$(A', I', \gamma') \to (A, I, \gamma)$ of $\mathcal{C}$ such that $f$
is the image of $f' \in F(A', I', \gamma')$ and $|A'| \leq \kappa$, and
\item $F$ commutes with limits.
\end{enumerate}
Then $F$ is representable, i.e., there exists an object $(B, J, \delta)$
of $\mathcal{C}$ such that
$$
F(A, I, \gamma) = \Hom_\mathcal{C}((B, J, \delta), (A, I, \gamma))
$$
functorially in $(A, I, \gamma)$.
\end{lemma}

\begin{proof}
This is a special case of
Categories, Lemma \ref{categories-lemma-a-version-of-brown}.
\end{proof}

\begin{lemma}
\label{lemma-colimits}
The category of divided power rings has all colimits.
\end{lemma}

\begin{proof}
The empty colimit is $\mathbf{Z}$ with divided power ideal $(0)$.
Let's discuss general colimits. Let $\mathcal{C}$ be a category and let
$c \mapsto (A_c, I_c, \gamma_c)$ be a diagram. Consider the functor
$$
F(B, J, \delta) = \lim_{c \in \mathcal{C}}
Hom((A_c, I_c, \gamma_c), (B, J, \delta))
$$
Note that any $f = (f_c)_{c \in C} \in F(B, J, \delta)$ has the property
that all the images $f_c(A_c)$ generate a subring $B'$ of $B$ of bounded
cardinality $\kappa$ and that all the images $f_c(I_c)$ generate a
divided power sub ideal $J'$ of $B'$. And we get a factorization of
$f$ as a $f'$ in $F(B')$ followed by the inclusion $B' \to B$. Also,
$F$ commutes with limits. Hence we may apply
Lemma \ref{lemma-a-version-of-brown}
to see that $F$ is representable and we win.
\end{proof}

\begin{remark}
\label{remark-forgetful}
The forgetful functor $(A, I, \gamma) \mapsto A$ does not commute with
colimits. For example, let
$$
\xymatrix{
(B, J, \delta) \ar[r] & (B'', J'', \delta'') \\
(A, I, \gamma) \ar[r] \ar[u] & (B', J', \delta') \ar[u]
}
$$
be a pushout in the category of divided power rings.
Then in general the map $B \otimes_A B' \to B''$ isn't an
isomorphism. (It is always surjective.)
An explicit example is given by
$(A, I, \gamma) = (\mathbf{Z}, (0), \emptyset)$,
$(B, J, \delta) = (\mathbf{Z}/4\mathbf{Z}, 2\mathbf{Z}/4\mathbf{Z}, \delta)$,
and
$(B', J', \delta') =
(\mathbf{Z}/4\mathbf{Z}, 2\mathbf{Z}/4\mathbf{Z}, \delta')$
where $\delta_2(2) = 2$ and $\delta'_2(2) = 0$ and all higher divided powers
equal to zero. Then $(B'', J'', \delta'') = (\mathbf{F}_2, (0), \emptyset)$
which doesn't agree with the tensor product. However, note that it is always
true that
$$
B''/J'' = B/J \otimes_{A/I} B'/J'
$$
as can be seen from the universal property of the pushout by considering
maps into divided power algebras of the form $(C, (0), \emptyset)$.
\end{remark}


\section{Extending divided powers}
\label{section-extend}

\noindent
Here is the definition.

\begin{definition}
\label{definition-extends}
Given a divided power ring $(A, I, \gamma)$ and a ring map
$A \to B$ we say $\gamma$ {\it extends} to $B$ if there exists a
divided power structure $\bar \gamma$ on $IB$ such that
$(A, I, \gamma) \to (B, IB, \bar\gamma)$ is a homomorphism of
divided power rings.
\end{definition}

\begin{lemma}
\label{lemma-gamma-extends}
Let $(A, I, \gamma)$ be a divided power ring.
Let $A \to B$ be a ring map.
If $\gamma$ extends to $B$ then it extends uniquely.
Assume (at least) one of the following conditions holds
\begin{enumerate}
\item $IB = 0$,
\item $I$ is principal, or
\item $A \to B$ is flat.
\end{enumerate}
Then $\gamma$ extends to $B$.
\end{lemma}

\begin{proof}
Any element of $IB$ can be written as a finite sum
$\sum\nolimits_{i=1}^t b_ix_i$ with
$b_i \in B$ and $x_i \in I$. If $\gamma$ extends to $\bar\gamma$ on $IB$
then $\bar\gamma_n(x_i) = \gamma_n(x_i)$.
Thus, conditions (3) and (4) in
Definition \ref{definition-divided-powers} imply that
$$
\bar\gamma_n(\sum\nolimits_{i=1}^t b_ix_i) =
\sum\nolimits_{n_1 + \ldots + n_t = n}
\prod\nolimits_{i = 1}^t b_i^{n_i}\gamma_{n_i}(x_i)
$$
Thus we see that $\bar\gamma$ is unique if it exists.

\medskip\noindent
If $IB = 0$ then setting $\bar\gamma_n(0) = 0$ works. If $I = (x)$
then we define $\bar\gamma_n(bx) = b^n\gamma_n(x)$. This is well defined:
if $b'x = bx$, i.e., $(b - b')x = 0$ then
\begin{align*}
b^n\gamma_n(x) - (b')^n\gamma_n(x)
& =
(b^n - (b')^n)\gamma_n(x) \\
& =
(b^{n - 1} + \ldots + (b')^{n - 1})(b - b')\gamma_n(x) = 0
\end{align*}
because $\gamma_n(x)$ is divisible by $x$ (since
$\gamma_n(I) \subset I$) and hence annihilated by $b - b'$.
Next, we prove conditions (1) -- (5) of
Definition \ref{definition-divided-powers}.
Parts (1), (2), (3), (5) are obvious from the construction.
For (4) suppose that $y, z \in IB$, say $y = bx$ and $z = cx$. Then
$y + z = (b + c)x$ hence
\begin{align*}
\bar\gamma_n(y + z)
& =
(b + c)^n\gamma_n(x) \\
& =
\sum \frac{n!}{i!(n - i)!}b^ic^{n -i}\gamma_n(x) \\
& =
\sum b^ic^{n - i}\gamma_i(x)\gamma_{n - i}(x) \\
& =
\sum \bar\gamma_i(y)\bar\gamma_{n -i}(z)
\end{align*}
as desired.

\medskip\noindent
Assume $A \to B$ is flat. Suppose that $b_1, \ldots, b_r \in B$ and
$x_1, \ldots, x_r \in I$. Then
$$
\bar\gamma_n(\sum b_ix_i) =
\sum b_1^{e_1} \ldots b_r^{e_r} \gamma_{e_1}(x_1) \ldots \gamma_{e_r}(x_r)
$$
where the sum is over $e_1 + \ldots + e_r = n$
if $\bar\gamma_n$ exists. Next suppose that we have $c_1, \ldots, c_s \in B$
and $a_{ij} \in A$ such that $b_i = \sum a_{ij}c_j$.
Setting $y_j = \sum a_{ij}x_i$ we claim that
$$
\sum b_1^{e_1} \ldots b_r^{e_r} \gamma_{e_1}(x_1) \ldots \gamma_{e_r}(x_r) =
\sum c_1^{d_1} \ldots c_s^{d_s} \gamma_{d_1}(y_1) \ldots \gamma_{d_s}(y_s)
$$
in $B$ where on the right hand side we are summing over
$d_1 + \ldots + d_s = n$. Namely, using the axioms of a divided power
structure we can expand both sides into a sum with coefficients
in $\mathbf{Z}[a_{ij}]$ of terms of the form
$c_1^{d_1} \ldots c_s^{d_s}\gamma_{e_1}(x_1) \ldots \gamma_{e_r}(x_r)$.
To see that the coefficients agree we note that the result is true
in $\mathbf{Q}[x_1, \ldots, x_r, c_1, \ldots, c_s, a_{ij}]$ with
$\gamma$ the unique divided power structure on $(x_1, \ldots, x_r)$.
By Lazard's theorem (Algebra, Theorem \ref{algebra-theorem-lazard})
we can write $B$ as a directed colimit of finite free $A$-modules.
In particular, if $z \in IB$ is written as $z = \sum x_ib_i$ and
$z = \sum x'_{i'}b'_{i'}$, then we can find $c_1, \ldots, c_s \in B$
and $a_{ij}, a'_{i'j} \in A$ such that $b_i = \sum a_{ij}c_j$
and $b'_{i'} = \sum a'_{i'j}c_j$ such that
$y_j = \sum x_ia_{ij} = \sum x'_{i'}a'_{i'j}$ holds\footnote{This
can also be proven without recourse to
Algebra, Theorem \ref{algebra-theorem-lazard}. Indeed, if
$z = \sum x_ib_i$ and $z = \sum x'_{i'}b'_{i'}$, then
$\sum x_ib_i - \sum x'_{i'}b'_{i'} = 0$ is a relation in the
$A$-module $B$. Thus, Algebra, Lemma \ref{algebra-lemma-flat-eq}
(applied to the $x_i$ and $x'_{i'}$ taking the place of the $f_i$,
and the $b_i$ and $b'_{i'}$ taking the role of the $x_i$) yields
the existence of the $c_1, \ldots, c_s \in B$
and $a_{ij}, a'_{i'j} \in A$ as required.}.
Hence the procedure above gives a well defined map $\bar\gamma_n$
on $IB$. By construction $\bar\gamma$ satisfies conditions (1), (3), and
(4). Moreover, for $x \in I$ we have $\bar\gamma_n(x) = \gamma_n(x)$. Hence
it follows from Lemma \ref{lemma-check-on-generators} that $\bar\gamma$
is a divided power structure on $IB$.
\end{proof}

\begin{lemma}
\label{lemma-kernel}
Let $(A, I, \gamma)$ be a divided power ring.
\begin{enumerate}
\item If $\varphi : (A, I, \gamma) \to (B, J, \delta)$ is a
homomorphism of divided power rings, then $\Ker(\varphi) \cap I$
is preserved by $\gamma_n$ for all $n \geq 1$.
\item Let $\mathfrak a \subset A$ be an ideal and set
$I' = I \cap \mathfrak a$. The following are equivalent
\begin{enumerate}
\item $I'$ is preserved by $\gamma_n$ for all $n > 0$,
\item $\gamma$ extends to $A/\mathfrak a$, and
\item there exist a set of generators $x_i$ of $I'$ as an ideal
such that $\gamma_n(x_i) \in I'$ for all $n > 0$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). This is clear. Assume (2)(a). Define
$\bar\gamma_n(x \bmod I') = \gamma_n(x) \bmod I'$ for $x \in I$.
This is well defined since $\gamma_n(x + y) = \gamma_n(x) \bmod I'$
for $y \in I'$ by Definition \ref{definition-divided-powers} (4) and
the fact that $\gamma_j(y) \in I'$ by assumption. It is clear that
$\bar\gamma$ is a divided power structure as $\gamma$ is one.
Hence (2)(b) holds. Also, (2)(b) implies (2)(a) by part (1).
It is clear that (2)(a) implies (2)(c). Assume (2)(c).
Note that $\gamma_n(x) = a^n\gamma_n(x_i) \in I'$ for $x = ax_i$.
Hence we see that $\gamma_n(x) \in I'$ for a set of generators of $I'$
as an abelian group. By induction on the length of an expression in
terms of these, it suffices to prove $\forall n : \gamma_n(x + y) \in I'$
if $\forall n : \gamma_n(x), \gamma_n(y) \in I'$. This
follows immediately from the fourth axiom of a divided power structure.
\end{proof}

\begin{lemma}
\label{lemma-sub-dp-ideal}
Let $(A, I, \gamma)$ be a divided power ring.
Let $E \subset I$ be a subset.
Then the smallest ideal $J \subset I$ preserved by $\gamma$
and containing all $f \in E$ is the ideal $J$ generated by
$\gamma_n(f)$, $n \geq 1$, $f \in E$.
\end{lemma}

\begin{proof}
Follows immediately from Lemma \ref{lemma-kernel}.
\end{proof}

\begin{lemma}
\label{lemma-extend-to-completion}
Let $(A, I, \gamma)$ be a divided power ring. Let $p$ be a prime.
If $p$ is nilpotent in $A/I$, then
\begin{enumerate}
\item the $p$-adic completion $A^\wedge = \lim_e A/p^eA$ surjects onto $A/I$,
\item the kernel of this map is the $p$-adic completion $I^\wedge$ of $I$, and
\item each $\gamma_n$ is continuous for the $p$-adic topology and extends
to $\gamma_n^\wedge : I^\wedge \to I^\wedge$ defining a divided power
structure on $I^\wedge$.
\end{enumerate}
If moreover $A$ is a $\mathbf{Z}_{(p)}$-algebra, then
\begin{enumerate}
\item[(4)] for $e$ large enough the ideal $p^eA \subset I$ is preserved by the
divided power structure $\gamma$ and
$$
(A^\wedge, I^\wedge, \gamma^\wedge) = \lim_e (A/p^eA, I/p^eA, \bar\gamma)
$$
in the category of divided power rings.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $t \geq 1$ be an integer such that $p^tA/I = 0$, i.e., $p^tA \subset I$.
The map $A^\wedge \to A/I$ is the composition $A^\wedge \to A/p^tA \to A/I$
which is surjective (for example by
Algebra, Lemma \ref{algebra-lemma-completion-generalities}).
As $p^eI \subset p^eA \cap I \subset p^{e - t}I$ for $e \geq t$ we see
that the kernel of the composition $A^\wedge \to A/I$ is the $p$-adic
completion of $I$. The map $\gamma_n$ is continuous because
$$
\gamma_n(x + p^ey) =
\sum\nolimits_{i + j = n} p^{je}\gamma_i(x)\gamma_j(y) =
\gamma_n(x) \bmod p^eI
$$
by the axioms of a divided power structure. It is clear that the axioms
for divided power structures are inherited by the maps $\gamma_n^\wedge$
from the maps $\gamma_n$. Finally, to see the last statement say $e > t$.
Then $p^eA \subset I$ and $\gamma_1(p^eA) \subset p^eA$ and for $n > 1$
we have
$$
\gamma_n(p^ea) = p^n \gamma_n(p^{e - 1}a) = \frac{p^n}{n!} p^{n(e - 1)}a^n
\in p^e A
$$
as $p^n/n! \in \mathbf{Z}_{(p)}$ and as $n \geq 2$ and $e \geq 2$ so
$n(e - 1) \geq e$.
This proves that $\gamma$ extends to $A/p^eA$, see Lemma \ref{lemma-kernel}.
The statement on limits is clear from the construction of limits in
the proof of Lemma \ref{lemma-limits}.
\end{proof}




\section{Divided power polynomial algebras}
\label{section-divided-power-polynomial-ring}

\noindent
A very useful example is the {\it divided power polynomial algebra}.
Let $A$ be a ring. Let $t \geq 1$. We will denote
$A\langle x_1, \ldots, x_t \rangle$ the following $A$-algebra:
As an $A$-module we set
$$
A\langle x_1, \ldots, x_t \rangle =
\bigoplus\nolimits_{n_1, \ldots, n_t \geq 0} A x_1^{[n_1]} \ldots x_t^{[n_t]}
$$
with multiplication given by
$$
x_i^{[n]}x_i^{[m]} = \frac{(n + m)!}{n!m!}x_i^{[n + m]}.
$$
We also set $x_i = x_i^{[1]}$. Note that
$1 = x_1^{[0]} \ldots x_t^{[0]}$. There is a similar construction
which gives the divided power polynomial algebra in infinitely many
variables. There is an canonical $A$-algebra map
$A\langle x_1, \ldots, x_t \rangle \to A$ sending $x_i^{[n]}$ to zero
for $n > 0$. The kernel of this map is denoted
$A\langle x_1, \ldots, x_t \rangle_{+}$.

\begin{lemma}
\label{lemma-divided-power-polynomial-algebra}
Let $(A, I, \gamma)$ be a divided power ring.
There exists a unique divided power structure $\delta$ on
$$
J = IA\langle x_1, \ldots, x_t \rangle + A\langle x_1, \ldots, x_t \rangle_{+}
$$
such that
\begin{enumerate}
\item $\delta_n(x_i) = x_i^{[n]}$, and
\item $(A, I, \gamma) \to (A\langle x_1, \ldots, x_t \rangle, J, \delta)$
is a homomorphism of divided power rings.
\end{enumerate}
Moreover, $(A\langle x_1, \ldots, x_t \rangle, J, \delta)$ has the
following universal property: A homomorphism of divided power rings
$\varphi : (A\langle x_1, \ldots, x_t \rangle, J, \delta) \to
(C, K, \epsilon)$ is
the same thing as a homomorphism of divided power rings
$A \to C$ and elements $k_1, \ldots, k_t \in K$.
\end{lemma}

\begin{proof}
We will prove the lemma in case of a divided power polynomial algebra
in one variable. The result for the general case can be argued in exactly
the same way, or by noting that $A\langle x_1, \ldots, x_t\rangle$ is
isomorphic to the ring obtained by adjoining the divided power variables
$x_1, \ldots, x_t$ one by one.

\medskip\noindent
Let $A\langle x \rangle_{+}$ be the ideal generated by
$x, x^{[2]}, x^{[3]}, \ldots$.
Note that $J = IA\langle x \rangle + A\langle x \rangle_{+}$
and that
$$
IA\langle x \rangle \cap A\langle x \rangle_{+} =
IA\langle x \rangle \cdot A\langle x \rangle_{+}
$$
Hence by Lemma \ref{lemma-two-ideals} it suffices to show that there
exist divided power structures on the ideals $IA\langle x \rangle$ and
$A\langle x \rangle_{+}$. The existence of the first follows from
Lemma \ref{lemma-gamma-extends} as $A \to A\langle x \rangle$ is flat.
For the second, note that if $A$ is torsion free, then we can apply
Lemma \ref{lemma-silly} (4) to see that $\delta$ exists. Namely, choosing
as generators the elements $x^{[m]}$ we see that
$(x^{[m]})^n = \frac{(nm)!}{(m!)^n} x^{[nm]}$
and $n!$ divides the integer $\frac{(nm)!}{(m!)^n}$.
In general write $A = R/\mathfrak a$ for some torsion free ring $R$
(e.g., a polynomial ring over $\mathbf{Z}$). The kernel of
$R\langle x \rangle \to A\langle x \rangle$ is
$\bigoplus \mathfrak a x^{[m]}$. Applying criterion (2)(c) of
Lemma \ref{lemma-kernel} we see that the divided power structure
on $R\langle x \rangle_{+}$ extends to $A\langle x \rangle$ as
desired.

\medskip\noindent
Proof of the universal property. Given a homomorphism $\varphi : A \to C$
of divided power rings and $k_1, \ldots, k_t \in K$ we consider
$$
A\langle x_1, \ldots, x_t \rangle \to C,\quad
x_1^{[n_1]} \ldots x_t^{[n_t]} \longmapsto
\epsilon_{n_1}(k_1) \ldots \epsilon_{n_t}(k_t)
$$
using $\varphi$ on coefficients. The only thing to check is that
this is an $A$-algebra homomorphism (details omitted). The inverse
construction is clear.
\end{proof}

\begin{remark}
\label{remark-divided-power-polynomial-algebra}
Let $(A, I, \gamma)$ be a divided power ring.
There is a variant of Lemma \ref{lemma-divided-power-polynomial-algebra}
for infinitely many variables. First note that if $s < t$ then there
is a canonical map
$$
A\langle x_1, \ldots, x_s \rangle \to A\langle x_1, \ldots, x_t\rangle
$$
Hence if $W$ is any set, then we set
$$
A\langle x_w: w \in W\rangle =
\colim_{E \subset W} A\langle x_e:e \in E\rangle
$$
(colimit over $E$ finite subset of $W$)
with transition maps as above. By the definition of a colimit we see
that the universal mapping property of $A\langle x_w: w \in W\rangle$ is
completely analogous to the mapping property stated in
Lemma \ref{lemma-divided-power-polynomial-algebra}.
\end{remark}

\noindent
The following lemma can be found in \cite{BO}.

\begin{lemma}
\label{lemma-need-only-gamma-p}
Let $p$ be a prime number. Let $A$ be a ring such that every integer $n$
not divisible by $p$ is invertible, i.e., $A$ is a $\mathbf{Z}_{(p)}$-algebra.
Let $I \subset A$ be an ideal. Two divided power structures
$\gamma, \gamma'$ on $I$ are equal if and only if $\gamma_p = \gamma'_p$.
Moreover, given a map $\delta : I \to I$ such that
\begin{enumerate}
\item $p!\delta(x) = x^p$ for all $x \in I$,
\item $\delta(ax) = a^p\delta(x)$ for all $a \in A$, $x \in I$, and
\item
$\delta(x + y) =
\delta(x) +
\sum\nolimits_{i + j = p, i,j \geq 1} \frac{1}{i!j!} x^i y^j +
\delta(y)$ for all $x, y \in I$,
\end{enumerate}
then there exists a unique divided power structure $\gamma$ on $I$ such
that $\gamma_p = \delta$.
\end{lemma}

\begin{proof}
If $n$ is not divisible by $p$, then $\gamma_n(x) = c x \gamma_{n - 1}(x)$
where $c$ is a unit in $\mathbf{Z}_{(p)}$. Moreover,
$$
\gamma_{pm}(x) = c \gamma_m(\gamma_p(x))
$$
where $c$ is a unit in $\mathbf{Z}_{(p)}$. Thus the first assertion is clear.
For the second assertion, we can, working backwards, use these equalities
to define all $\gamma_n$. More precisely, if
$n = a_0 + a_1p + \ldots + a_e p^e$ with $a_i \in \{0, \ldots, p - 1\}$ then
we set
$$
\gamma_n(x) = c_n x^{a_0} \delta(x)^{a_1} \ldots \delta^e(x)^{a_e}
$$
for $c_n \in \mathbf{Z}_{(p)}$ defined by
$$
c_n =
{(p!)^{a_1 + a_2(1 + p) + \ldots + a_e(1 + \ldots + p^{e - 1})}}/{n!}.
$$
Now we have to show the axioms (1) -- (5) of a divided power structure, see
Definition \ref{definition-divided-powers}. We observe that (1) and (3) are
immediate. Verification of (2) and (5) is by a direct calculation which
we omit. Let $x, y \in I$. We claim there is a ring map
$$
\varphi : \mathbf{Z}_{(p)}\langle u, v \rangle \longrightarrow A
$$
which maps $u^{[n]}$ to $\gamma_n(x)$ and $v^{[n]}$ to $\gamma_n(y)$.
By construction of $\mathbf{Z}_{(p)}\langle u, v \rangle$ this means
we have to check that
$$
\gamma_n(x)\gamma_m(x) = \frac{(n + m)!}{n!m!} \gamma_{n + m}(x)
$$
in $A$ and similarly for $y$. This is true because (2) holds for $\gamma$.
Let $\epsilon$ denote the divided power structure on the
ideal $\mathbf{Z}_{(p)}\langle u, v\rangle_{+}$ of
$\mathbf{Z}_{(p)}\langle u, v\rangle$.
Next, we claim that $\varphi(\epsilon_n(f)) = \gamma_n(\varphi(f))$
for $f \in \mathbf{Z}_{(p)}\langle u, v\rangle_{+}$ and all $n$.
This is clear for $n = 0, 1, \ldots, p - 1$. For $n = p$ it suffices
to prove it for a set of generators of the ideal
$\mathbf{Z}_{(p)}\langle u, v\rangle_{+}$ because both $\epsilon_p$
and $\gamma_p = \delta$ satisfy properties (1) and (3) of the lemma.
Hence it suffices to prove that
$\gamma_p(\gamma_n(x)) = \frac{(pn)!}{p!(n!)^p}\gamma_{pn}(x)$ and
similarly for $y$, which follows as (5) holds for $\gamma$.
Now, if $n = a_0 + a_1p + \ldots + a_e p^e$
is an arbitrary integer written in $p$-adic expansion as above, then
$$
\epsilon_n(f) =
c_n f^{a_0} \gamma_p(f)^{a_1} \ldots \gamma_p^e(f)^{a_e}
$$
because $\epsilon$ is a divided power structure. Hence we see that
$\varphi(\epsilon_n(f)) = \gamma_n(\varphi(f))$ holds for all $n$.
Applying this for $f = u + v$ we see that axiom (4) for $\gamma$
follows from the fact that $\epsilon$ is a divided power structure.
\end{proof}













\section{Tate resolutions}
\label{section-tate}

\noindent
In this section we briefly discuss the resolutions constructed in
\cite{Tate-homology} and \cite{AH}
which combine divided power structures with
differential graded algebras.
In this section we will use {\it homological notation} for
differential graded algebras.
Our differential graded algebras will sit in nonnegative homological
degrees. Thus our differential graded algebras $(A, \text{d})$
will be given as chain complexes
$$
\ldots \to A_2 \to A_1 \to A_0 \to 0 \to \ldots
$$
endowed with a multiplication.

\medskip\noindent
Let $R$ be a ring (commutative, as usual).
In this section we will often consider graded
$R$-algebras $A = \bigoplus_{d \geq 0} A_d$ whose components are
zero in negative degrees. We will set $A_+ = \bigoplus_{d > 0} A_d$.
We will write $A_{even} = \bigoplus_{d \geq 0} A_{2d}$ and
$A_{odd} = \bigoplus_{d \geq 0} A_{2d + 1}$.
Recall that $A$ is graded commutative if
$x y = (-1)^{\deg(x)\deg(y)} y x$ for homogeneous elements $x, y$.
Recall that $A$ is strictly graded commutative if in addition
$x^2 = 0$ for homogeneous elements $x$ of odd degree. Finally, to understand
the following definition, keep in mind that $\gamma_n(x) = x^n/n!$
if $A$ is a $\mathbf{Q}$-algebra.

\begin{definition}
\label{definition-divided-powers-graded}
Let $R$ be a ring. Let $A = \bigoplus_{d \geq 0} A_d$ be a graded
$R$-algebra which is strictly graded commutative. A collection of maps
$\gamma_n : A_{even, +} \to A_{even, +}$ defined for all $n > 0$ is called
a {\it divided power structure} on $A$ if we have
\begin{enumerate}
\item $\gamma_n(x) \in A_{2nd}$ if $x \in A_{2d}$,
\item $\gamma_1(x) = x$ for any $x$, we also set $\gamma_0(x) = 1$,
\item $\gamma_n(x)\gamma_m(x) = \frac{(n + m)!}{n! m!} \gamma_{n + m}(x)$,
\item $\gamma_n(xy) = x^n \gamma_n(y)$ for all $x \in A_{even}$ and
$y \in A_{even, +}$,
\item $\gamma_n(xy) = 0$ if $x, y \in A_{odd}$ homogeneous and $n > 1$
\item if $x, y \in A_{even, +}$ then
$\gamma_n(x + y) = \sum_{i = 0, \ldots, n} \gamma_i(x)\gamma_{n - i}(y)$,
\item $\gamma_n(\gamma_m(x)) =
\frac{(nm)!}{n! (m!)^n} \gamma_{nm}(x)$ for $x \in A_{even, +}$.
\end{enumerate}
\end{definition}

\noindent
Observe that conditions (2), (3), (4), (6), and (7) imply that
$\gamma$ is a ``usual'' divided power structure on the ideal
$A_{even, +}$ of the (commutative) ring $A_{even}$, see
Sections \ref{section-divided-powers},
\ref{section-divided-power-rings},
\ref{section-extend}, and
\ref{section-divided-power-polynomial-ring}.
In particular, we have $n! \gamma_n(x) = x^n$ for all $x \in A_{even, +}$.
Condition (1) states that $\gamma$ is compatible with grading and condition
(5) tells us $\gamma_n$ for $n > 1$ vanishes on products
of homogeneous elements of odd degree. But note that it may happen
that
$$
\gamma_2(z_1 z_2 + z_3 z_4) = z_1z_2z_3z_4
$$
is nonzero if $z_1, z_2, z_3, z_4$ are homogeneous elements of odd degree.

\begin{example}[Adjoining odd variable]
\label{example-adjoining-odd}
Let $R$ be a ring. Let $(A, \gamma)$ be a strictly graded commutative
graded $R$-algebra endowed with a divided power structure as in the
definition above. Let $d > 0$ be an odd integer.
In this setting we can adjoin a variable $T$ of degree $d$ to $A$.
Namely, set
$$
A\langle T \rangle = A \oplus AT
$$
with grading given by $A\langle T \rangle_m = A_m \oplus A_{m - d}T$.
We claim there is a unique divided power structure on
$A\langle T \rangle$ compatible with the given divided power
structure on $A$. Namely, we set
$$
\gamma_n(x + yT) = \gamma_n(x) + \gamma_{n - 1}(x)yT
$$
for $x \in A_{even, +}$ and $y \in A_{odd}$.
\end{example}

\begin{example}[Adjoining even variable]
\label{example-adjoining-even}
Let $R$ be a ring. Let $(A, \gamma)$ be a strictly graded commutative
graded $R$-algebra endowed with a divided power structure as in the
definition above. Let $d > 0$ be an even integer.
In this setting we can adjoin a variable $T$ of degree $d$ to $A$.
Namely, set
$$
A\langle T \rangle = A \oplus AT \oplus AT^{(2)} \oplus AT^{(3)} \oplus \ldots
$$
with multiplication given by
$$
T^{(n)} T^{(m)} = \frac{(n + m)!}{n!m!} T^{(n + m)}
$$
and with grading given by
$$
A\langle T \rangle_m =
A_m \oplus A_{m - d}T \oplus A_{m - 2d}T^{(2)} \oplus \ldots
$$
We claim there is a unique divided power structure on
$A\langle T \rangle$ compatible with the given divided power
structure on $A$ such that $\gamma_n(T^{(i)}) = T^{(ni)}$.
To define the divided power structure we first set
$$
\gamma_n\left(\sum\nolimits_{i > 0} x_i T^{(i)}\right) =
\sum \prod\nolimits_{n = \sum e_i} x_i^{e_i} T^{(ie_i)}
$$
if $x_i$ is in $A_{even}$. If $x_0 \in A_{even, +}$
then we take
$$
\gamma_n\left(\sum\nolimits_{i \geq 0} x_i T^{(i)}\right) =
\sum\nolimits_{a + b = n}
\gamma_a(x_0)\gamma_b\left(\sum\nolimits_{i > 0} x_iT^{(i)}\right)
$$
where $\gamma_b$ is as defined above.
\end{example}

\begin{remark}
\label{remark-adjoining-set-of-variables}
We can also adjoin a set (possibly infinite) of exterior or divided
power generators in a given degree $d > 0$, rather than just one
as in Examples \ref{example-adjoining-odd}
and \ref{example-adjoining-even}. Namely, 
following Remark \ref{remark-divided-power-polynomial-algebra}:
for $(A,\gamma)$
as above and a set $J$, let $A\langle
T_j:j\in J\rangle$ be the directed colimit of the algebras
$A\langle T_j:j\in S\rangle$ over all finite subsets $S$
of $J$. It is immediate that this algebra has a unique divided power
structure, compatible with the given structure on $A$ and on
each generator $T_j$.
\end{remark}

\noindent
At this point we tie in the definition of divided power structures
with differentials. To understand the definition note that
$\text{d}(x^n/n!) = \text{d}(x) x^{n - 1}/(n - 1)!$ if $A$
is a $\mathbf{Q}$-algebra and $x \in A_{even, +}$.

\begin{definition}
\label{definition-divided-powers-dga}
Let $R$ be a ring. Let $A = \bigoplus_{d \geq 0} A_d$ be a
differential graded $R$-algebra which is strictly graded commutative.
A divided power structure $\gamma$ on $A$ is {\it compatible with
the differential graded structure} if
$\text{d}(\gamma_n(x)) = \text{d}(x) \gamma_{n - 1}(x)$ for
all $x \in A_{even, +}$.
\end{definition}

\noindent
Warning: Let $(A, \text{d}, \gamma)$ be as in
Definition \ref{definition-divided-powers-dga}.
It may not be true that $\gamma_n(x)$ is a boundary, if
$x$ is a boundary. Thus $\gamma$ in general does not induce
a divided power structure on the homology algebra $H(A)$.
In some papers the authors put an additional compatibility
condition in order to ensure that this is the case, but we elect
not to do so.

\begin{lemma}
\label{lemma-dpdga-good}
Let $(A, \text{d}, \gamma)$ and $(B, \text{d}, \gamma)$ be as in
Definition \ref{definition-divided-powers-dga}. Let $f : A \to B$
be a map of differential graded algebras compatible with divided
power structures. Assume
\begin{enumerate}
\item $H_k(A) = 0$ for $k > 0$, and
\item $f$ is surjective.
\end{enumerate}
Then $\gamma$ induces a divided power structure on the graded
$R$-algebra $H(B)$.
\end{lemma}

\begin{proof}
Suppose that $x$ and $x'$ are homogeneous of the same degree $2d$
and define the same cohomology class in $H(B)$. Say $x' - x = \text{d}(w)$.
Choose a lift $y \in A_{2d}$ of $x$ and a lift $z \in A_{2d + 1}$
of $w$. Then $y' = y + \text{d}(z)$ is a lift of $x'$.
Hence
$$
\gamma_n(y') = \sum \gamma_i(y) \gamma_{n - i}(\text{d}(z))
= \gamma_n(y) +
\sum\nolimits_{i < n} \gamma_i(y) \gamma_{n - i}(\text{d}(z))
$$
Since $A$ is acyclic in positive degrees and since
$\text{d}(\gamma_j(\text{d}(z))) = 0$ for all $j$ we can write
this as
$$
\gamma_n(y') = \gamma_n(y) +
\sum\nolimits_{i < n} \gamma_i(y) \text{d}(z_i)
$$
for some $z_i$ in $A$. Moreover, for $0 < i < n$ we have
$$
\text{d}(\gamma_i(y) z_i) =
\text{d}(\gamma_i(y))z_i + \gamma_i(y)\text{d}(z_i) =
\text{d}(y) \gamma_{i - 1}(y) z_i + \gamma_i(y)\text{d}(z_i)
$$
and the first term maps to zero in $B$ as $\text{d}(y)$ maps to zero in $B$.
Hence $\gamma_n(x')$ and $\gamma_n(x)$ map to the same element of $H(B)$.
Thus we obtain a well defined map $\gamma_n : H_{2d}(B) \to H_{2nd}(B)$
for all $d > 0$ and $n > 0$. We omit the verification that this
defines a divided power structure on $H(B)$.
\end{proof}

\begin{lemma}
\label{lemma-base-change-div}
Let $(A, \text{d}, \gamma)$ be as in
Definition \ref{definition-divided-powers-dga}.
Let $R \to R'$ be a ring map.
Then $\text{d}$ and $\gamma$ induce similar structures on
$A' = A \otimes_R R'$ such that $(A', \text{d}, \gamma)$ is as in
Definition \ref{definition-divided-powers-dga}.
\end{lemma}

\begin{proof}
Observe that $A'_{even} = A_{even} \otimes_R R'$ and
$A'_{even, +} = A_{even, +} \otimes_R R'$. Hence we are trying to
show that the divided powers $\gamma$ extend to $A'_{even}$
(terminology as in Definition \ref{definition-extends}).
Once we have shown $\gamma$ extends it follows easily that this
extension has all the desired properties.

\medskip\noindent
Choose a polynomial $R$-algebra $P$ (on any set of generators)
and a surjection of $R$-algebras
$P \to R'$. The ring map $A_{even} \to A_{even} \otimes_R P$ is flat,
hence the divided powers $\gamma$ extend to $A_{even} \otimes_R P$
uniquely by Lemma \ref{lemma-gamma-extends}.
Let $J = \Ker(P \to R')$. To show that $\gamma$ extends
to $A \otimes_R R'$ it suffices to show that
$I' = \Ker(A_{even, +} \otimes_R P \to A_{even, +} \otimes_R R')$
is generated by elements $z$ such that $\gamma_n(z) \in I'$
for all $n > 0$. This is clear as $I'$ is generated by elements
of the form $x \otimes f$ with
$x \in A_{even, +}$ and $f \in \Ker(P \to R')$.
\end{proof}

\begin{lemma}
\label{lemma-extend-differential}
Let $(A, \text{d}, \gamma)$ be as in
Definition \ref{definition-divided-powers-dga}.
Let $d \geq 1$ be an integer.
Let $A\langle T \rangle$ be the graded divided power polynomial algebra
on $T$ with $\deg(T) = d$
constructed in Example \ref{example-adjoining-odd} or
\ref{example-adjoining-even}.
Let $f \in A_{d - 1}$ be an element with $\text{d}(f) = 0$.
There exists a unique differential $\text{d}$
on $A\langle T\rangle$ such that $\text{d}(T) = f$ and
such that $\text{d}$ is compatible with the divided power
structure on $A\langle T \rangle$.
\end{lemma}

\begin{proof}
This is proved by a direct computation which is omitted.
\end{proof}

\noindent
Here is Tate's construction, as extended
by Avramov and Halperin.

\begin{lemma}
\label{lemma-tate-resolution}
Let $R \to S$ be a homomorphism of commutative rings.
There exists a factorization
$$
R \to A \to S
$$
with the following properties:
\begin{enumerate}
\item $(A, \text{d}, \gamma)$ is as in
Definition \ref{definition-divided-powers-dga},
\item $A \to S$ is a quasi-isomorphism (if we endow $S$ with
the zero differential),
\item $A_0 = R[x_j: j\in J] \to S$ is any surjection of a polynomial
ring onto $S$, and
\item $A$ is a graded divided power polynomial algebra over $R$.
\end{enumerate}
The last condition means that $A$ is constructed out of $A_0$ by
successively adjoining a set of variables $T$ in each degree $> 0$ as in
Example \ref{example-adjoining-odd} or \ref{example-adjoining-even}.
Moreover, if $R$ is Noetherian and $R\to S$ is of finite type,
then $A$ can be taken to have only finitely many generators in
each degree.
\end{lemma}

\begin{proof}
We write out the construction for the case that $R$ is Noetherian
and $R\to S$ is of finite type. Without those assumptions, the proof
is the same, except that we have to use some set (possibly
infinite) of generators in each degree.

\medskip\noindent
Start of the construction: Let $A(0) = R[x_1, \ldots, x_n]$ be
a (usual) polynomial ring and let $A(0) \to S$ be a surjection.
As grading we take $A(0)_0 = A(0)$ and $A(0)_d = 0$ for $d \not = 0$.
Thus $\text{d} = 0$ and $\gamma_n$, $n > 0$, is zero as well.

\medskip\noindent
Choose generators $f_1, \ldots, f_m \in R[x_1, \ldots, x_n]$
for the kernel of the given map $A(0) = R[x_1, \ldots, x_n] \to S$.
We apply Example \ref{example-adjoining-odd} $m$ times to get
$$
A(1) = A(0)\langle T_1, \ldots, T_m\rangle
$$
with $\deg(T_i) = 1$ as a graded divided power polynomial algebra.
We set $\text{d}(T_i) = f_i$. Since $A(1)$ is a divided power polynomial
algebra over $A(0)$ and since $\text{d}(f_i) = 0$
this extends uniquely to a differential on $A(1)$ by
Lemma \ref{lemma-extend-differential}.

\medskip\noindent
Induction hypothesis: Assume we are given factorizations
$$
R \to A(0) \to A(1) \to \ldots \to A(m) \to S
$$
where $A(0)$ and $A(1)$ are as above and each $R \to A(m') \to S$
for $2 \leq m' \leq m$ satisfies properties (1) and (4)
of the statement of the lemma and (2) replaced by the condition that
$H_i(A(m')) \to H_i(S)$ is an isomorphism for
$m' > i \geq 0$. The base case is $m = 1$.

\medskip\noindent
Induction step: Assume we have $R \to A(m) \to S$
as in the induction hypothesis. Consider the
group $H_m(A(m))$. This is a module over $H_0(A(m)) = S$.
In fact, it is a subquotient of $A(m)_m$ which is a finite
type module over $A(m)_0 = R[x_1, \ldots, x_n]$.
Thus we can pick finitely many elements
$$
e_1, \ldots, e_t \in \Ker(\text{d} : A(m)_m \to A(m)_{m - 1})
$$
which map to generators of this module. Applying
Example \ref{example-adjoining-odd} or
\ref{example-adjoining-even} $t$ times we get
$$
A(m + 1) = A(m)\langle T_1, \ldots, T_t\rangle
$$
with $\deg(T_i) = m + 1$ as a graded divided power algebra. We set
$\text{d}(T_i) = e_i$. Since $A(m+1)$ is a divided power polynomial
algebra over $A(m)$ and since $\text{d}(e_i) = 0$
this extends uniquely to a differential on $A(m + 1)$
compatible with the divided power structure.
Since we've added only material in degree $m + 1$ and higher we see
that $H_i(A(m + 1)) = H_i(A(m))$ for $i < m$. Moreover, it is
clear that $H_m(A(m + 1)) = 0$ by construction.

\medskip\noindent
To finish the proof we observe that we have shown there exists
a sequence of maps
$$
R \to A(0) \to A(1) \to \ldots \to A(m) \to A(m + 1) \to \ldots \to S
$$
and to finish the proof we set $A = \colim A(m)$.
\end{proof}

\begin{lemma}
\label{lemma-tate-resoluton-pseudo-coherent-ring-map}
Let $R \to S$ be a pseudo-coherent ring map (More on Algebra, Definition
\ref{more-algebra-definition-pseudo-coherent-perfect}). Then
Lemma \ref{lemma-tate-resolution} holds, with the resolution $A$ of $S$
having finitely many generators in each degree.
\end{lemma}

\begin{proof}
This is proved in exactly the same way as Lemma \ref{lemma-tate-resolution}.
The only additional twist is that, given $A(m) \to S$ we have to
show that $H_m = H_m(A(m))$ is a finite $R[x_1, \ldots, x_m]$-module
(so that in the next step we need only add finitely many variables).
Consider the complex
$$
\ldots \to A(m)_{m - 1} \to A(m)_m \to A(m)_{m - 1} \to
\ldots \to A(m)_0 \to S \to 0
$$
Since $S$ is a pseudo-coherent $R[x_1, \ldots, x_n]$-module
and since $A(m)_i$ is a finite free $R[x_1, \ldots, x_n]$-module
we conclude that this is a pseudo-coherent complex, see
More on Algebra, Lemma \ref{more-algebra-lemma-complex-pseudo-coherent-modules}.
Since the complex is exact in (homological) degrees $> m$
we conclude that $H_m$ is a finite $R$-module by
More on Algebra, Lemma \ref{more-algebra-lemma-finite-cohomology}.
\end{proof}

\begin{lemma}
\label{lemma-uniqueness-tate-resolution}
Let $R$ be a commutative ring. Suppose that $(A, \text{d}, \gamma)$ and
$(B, \text{d}, \gamma)$ are as in
Definition \ref{definition-divided-powers-dga}.
Let $\overline{\varphi} : H_0(A) \to H_0(B)$ be an $R$-algebra map.
Assume
\begin{enumerate}
\item $A$ is a graded divided power polynomial algebra over $R$.
\item $H_k(B) = 0$ for $k > 0$.
\end{enumerate}
Then there exists a map $\varphi : A \to B$ of differential
graded $R$-algebras compatible with divided powers
that lifts $\overline{\varphi}$.
\end{lemma}

\begin{proof}
The assumption means that $A$ is obtained from $R$ by successively adjoining
some set of polynomial generators in degree zero, exterior generators
in positive odd degrees, and divided power generators
in positive even degrees. So we have a filtration
$R \subset A(0) \subset A(1) \subset \ldots$
of $A$ such that $A(m + 1)$ is obtained from $A(m)$ by adjoining
generators of the appropriate type (which we simply call
``divided power generators'') in degree $m + 1$.
In particular, $A(0) \to H_0(A)$ is a surjection from a (usual) polynomial
algebra over $R$ onto $H_0(A)$. Thus we can lift $\overline{\varphi}$
to an $R$-algebra map $\varphi(0) : A(0) \to B_0$.

\medskip\noindent
Write $A(1) = A(0)\langle T_j:j\in J\rangle$ for some
set $J$ of divided power variables $T_j$ of degree $1$. Let $f_j \in B_0$
be $f_j = \varphi(0)(\text{d}(T_j))$. Observe that $f_j$
maps to zero in $H_0(B)$ as $\text{d}T_j$ maps to zero in $H_0(A)$.
Thus we can find $b_j \in B_1$ with $\text{d}(b_j) = f_j$.
By the universal property of divided power polynomial algebras from
Lemma \ref{lemma-divided-power-polynomial-algebra},
we find a lift $\varphi(1) : A(1) \to B$ of $\varphi(0)$
mapping $T_j$ to $f_j$.

\medskip\noindent
Having constructed $\varphi(m)$ for some $m \geq 1$ we can construct
$\varphi(m + 1) : A(m + 1) \to B$ in exactly the same manner.
We omit the details.
\end{proof}

\begin{lemma}
\label{lemma-divided-powers-on-tor}
Let $R$ be a commutative ring. Let $S$ and $T$ be commutative $R$-algebras.
Then there is a canonical structure
of a strictly graded commutative $R$-algebra with divided powers on
$$
\operatorname{Tor}_*^R(S, T).
$$
\end{lemma}

\begin{proof}
Choose a factorization $R \to A \to S$ as above. Since $A \to S$
is a quasi-isomorphism and since $A_d$ is a free $R$-module,
we see that the differential graded algebra $B = A \otimes_R T$ computes
the Tor groups displayed in the lemma. Choose a surjection
$R[y_j:j\in J] \to T$. Then we see that
$B$ is a quotient of the differential graded algebra
$A[y_j:j\in J]$ whose homology sits in degree $0$ (it is equal
to $S[y_j:j\in J]$).
By Lemma \ref{lemma-base-change-div} the differential graded algebras $B$ and
$A[y_j:j\in J]$ have divided power structures compatible
with the differentials. Hence we obtain our divided
power structure on $H(B)$ by Lemma \ref{lemma-dpdga-good}.

\medskip\noindent
The divided power algebra structure constructed in this way is independent
of the choice of $A$. Namely, if $A'$ is a second choice, then
Lemma \ref{lemma-uniqueness-tate-resolution}
implies there is a map $A \to A'$ preserving all structure and the
augmentations towards $S$. Then the induced map
$B = A \otimes_R T \to A' \otimes_R T' = B'$ also preserves
all structure
and is a quasi-isomorphism. The induced isomorphism of
Tor algebras is therefore compatible with products
and divided powers.
\end{proof}





\section{Application to complete intersections}
\label{section-application-ci}

\noindent
Let $R$ be a ring. Let $(A, \text{d}, \gamma)$ be as in
Definition \ref{definition-divided-powers-dga}.
A {\it derivation} of degree $2$ is an $R$-linear
map $\theta : A \to A$ with the following
properties
\begin{enumerate}
\item $\theta(A_d) \subset A_{d - 2}$,
\item $\theta(xy) = \theta(x)y + x\theta(y)$,
\item $\theta$ commutes with $\text{d}$,
\item $\theta(\gamma_n(x)) = \theta(x) \gamma_{n - 1}(x)$
for all $x \in A_{2d}$ all $d$.
\end{enumerate}
In the following lemma we construct a derivation.

\begin{lemma}
\label{lemma-get-derivation}
Let $R$ be a ring. Let $(A, \text{d}, \gamma)$ be as in
Definition \ref{definition-divided-powers-dga}.
Let $R' \to R$ be a surjection of rings whose kernel
has square zero and is generated by one element $f$.
If $A$ is a graded divided power polynomial algebra over $R$
with finitely many variables in each degree,
then we obtain a derivation
$\theta : A/IA \to A/IA$ where $I$ is the annihilator
of $f$ in $R$.
\end{lemma}

\begin{proof}
Since $A$ is a divided power polynomial algebra, we can find a divided
power polynomial algebra $A'$ over $R'$ such that $A = A' \otimes_R R'$.
Moreover, we can lift $\text{d}$ to an $R$-linear
operator $\text{d}$ on $A'$ such that
\begin{enumerate}
\item  $\text{d}(xy) = \text{d}(x)y + (-1)^{\deg(x)}x \text{d}(y)$
for $x, y \in A'$ homogeneous, and
\item  $\text{d}(\gamma_n(x)) = \text{d}(x) \gamma_{n - 1}(x)$ for
$x \in A'_{even, +}$.
\end{enumerate}
We omit the details (hint: proceed one variable at the time).
However, it may not be the case that $\text{d}^2$
is zero on $A'$. It is clear that $\text{d}^2$ maps $A'$ into
$fA' \cong A/IA$. Hence $\text{d}^2$ annihilates $fA'$ and factors
as a map $A \to A/IA$. Since $\text{d}^2$ is $R$-linear we obtain
our map $\theta : A/IA \to A/IA$. The verification of the properties
of a derivation is immediate.
\end{proof}

\begin{lemma}
\label{lemma-compute-theta}
Assumption and notation as in Lemma \ref{lemma-get-derivation}.
Suppose $S = H_0(A)$ is isomorphic to
$R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$
for some $n$, $m$, and $f_j \in R[x_1, \ldots, x_n]$.
Moreover, suppose given a relation
$$
\sum r_j f_j = 0
$$
with $r_j \in R[x_1, \ldots, x_n]$.
Choose $r'_j, f'_j \in R'[x_1, \ldots, x_n]$ lifting $r_j, f_j$.
Write $\sum r'_j f'_j = gf$ for some $g \in R/I[x_1, \ldots, x_n]$.
If $H_1(A) = 0$ and all the coefficients of each $r_j$ are in $I$, then
there exists an element $\xi \in H_2(A/IA)$ such that
$\theta(\xi) = g$ in $S/IS$.
\end{lemma}

\begin{proof}
Let $A(0) \subset A(1) \subset A(2) \subset \ldots$ be the filtration
of $A$ such that $A(m)$ is gotten from $A(m - 1)$ by adjoining divided
power variables of degree $m$. Then $A(0)$ is a polynomial algebra
over $R$ equipped with an $R$-algebra surjection $A(0) \to S$.
Thus we can choose a map
$$
\varphi : R[x_1, \ldots, x_n] \to A(0)
$$
lifting the augmentations to $S$.
Next, $A(1) = A(0)\langle T_1, \ldots, T_t \rangle$ for some divided
power variables $T_i$ of degree $1$. Since $H_0(A) = S$ we
can pick $\xi_j \in \sum A(0)T_i$ with $\text{d}(\xi_j) = \varphi(f_j)$.
Then
$$
\text{d}\left(\sum \varphi(r_j) \xi_j\right) =
\sum  \varphi(r_j) \varphi(f_j) =  \sum \varphi(r_jf_j) = 0
$$
Since $H_1(A) = 0$ we can pick $\xi \in A_2$ with
$\text{d}(\xi) = \sum \varphi(r_j) \xi_j$.
If the coefficients of $r_j$ are in $I$, then the same
is true for $\varphi(r_j)$. In this case
$\text{d}(\xi)$ dies in $A_1/IA_1$ and
hence $\xi$ defines a class in $H_2(A/IA)$.

\medskip\noindent
The construction of $\theta$ in the proof of Lemma \ref{lemma-get-derivation}
proceeds by successively lifting $A(i)$ to $A'(i)$ and lifting the
differential $\text{d}$. We lift $\varphi$
to $\varphi' : R'[x_1, \ldots, x_n] \to A'(0)$.
Next, we have $A'(1) = A'(0)\langle T_1, \ldots, T_t\rangle$.
Moreover, we can lift $\xi_j$ to $\xi'_j \in \sum A'(0)T_i$.
Then $\text{d}(\xi'_j) = \varphi'(f'_j) + f a_j$ for some
$a_j \in A'(0)$.
Consider a lift $\xi' \in A'_2$ of $\xi$.
Then we know that
$$
\text{d}(\xi') = \sum \varphi'(r'_j)\xi'_j + \sum fb_iT_i
$$
for some $b_i \in A(0)$. Applying $\text{d}$ again we find
$$
\theta(\xi) = \sum \varphi'(r'_j)\varphi'(f'_j) +
\sum f \varphi'(r'_j) a_j + \sum fb_i \text{d}(T_i)
$$
The first term gives us what we want. The second term is zero
because the coefficients of $r_j$ are in $I$ and hence are
annihilated by $f$. The third term maps to zero in $H_0$
because $\text{d}(T_i)$ maps to zero.
\end{proof}

\noindent
The method of proof of the following lemma is apparently due to Gulliksen.

\begin{lemma}
\label{lemma-not-finite-pd}
Let $R' \to R$ be a surjection of Noetherian rings whose kernel has square
zero and is generated by one element $f$. Let
$S = R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$.
Let $\sum r_j f_j = 0$ be a relation in $R[x_1, \ldots, x_n]$.
Assume that
\begin{enumerate}
\item each $r_j$ has coefficients in the annihilator $I$ of $f$ in $R$,
\item for some lifts $r'_j, f'_j \in R'[x_1, \ldots, x_n]$ we have
$\sum r'_j f'_j = gf$ where $g$ is not nilpotent in $S$.
\end{enumerate}
Then $S$ does not have finite tor dimension over $R$ (i.e., $S$ is not
a perfect $R$-algebra).
\end{lemma}

\begin{proof}
Choose a Tate resolution $R \to A \to S$ as in
Lemma \ref{lemma-tate-resolution}.
Let $\xi \in H_2(A/IA)$ and $\theta : A/IA \to A/IA$ be the element
and derivation found in Lemmas \ref{lemma-get-derivation} and
\ref{lemma-compute-theta}.
Observe that
$$
\theta^n(\gamma_n(\xi)) = g^n
$$
Hence if $g$ is not nilpotent, then $\xi^n$ is nonzero in
$H_{2n}(A/IA)$ for all $n > 0$. Since
$H_{2n}(A/IA) = \text{Tor}^R_{2n}(S, R/I)$ we conclude.
\end{proof}

\noindent
The following result can be found in \cite{Rodicio}.

\begin{lemma}
\label{lemma-injective}
Let $(A, \mathfrak m)$ be a Noetherian local ring. Let
$I \subset J \subset A$ be proper ideals. If $A/J$ has finite
tor dimension over $A/I$, then $I/\mathfrak m I \to J/\mathfrak m J$
is injective.
\end{lemma}

\begin{proof}
Let $f \in I$ be an element mapping to a nonzero element of $I/\mathfrak m I$
which is mapped to zero in $J/\mathfrak mJ$. We can choose an ideal $I'$
with $\mathfrak mI \subset I' \subset I$ such that $I/I'$ is generated by
the image of $f$. Set $R = A/I$ and $R' = A/I'$. Let $J = (a_1, \ldots, a_m)$
for some $a_j \in A$. Then $f = \sum b_j a_j$ for some $b_j \in \mathfrak m$.
Let $r_j, f_j \in R$ resp.\ $r'_j, f'_j \in R'$ be the image of $b_j, a_j$.
Then we see we are
in the situation of Lemma \ref{lemma-not-finite-pd}
(with the ideal $I$ of that lemma equal to $\mathfrak m_R$)
and the lemma is proved.
\end{proof}

\begin{lemma}
\label{lemma-regular-sequence}
Let $(A, \mathfrak m)$ be a Noetherian local ring. Let
$I \subset J \subset A$ be proper ideals. Assume
\begin{enumerate}
\item $A/J$ has finite tor dimension over $A/I$, and
\item $J$ is generated by a regular sequence.
\end{enumerate}
Then $I$ is generated by a regular sequence and $J/I$
is generated by a regular sequence.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-injective} we see that
$I/\mathfrak m I \to J/\mathfrak m J$
is injective. Thus we can find $s \leq r$ and a minimal system of
generators $f_1, \ldots, f_r$ of $J$ such that $f_1, \ldots, f_s$ are in $I$
and form a minimal system of generators of $I$.
The lemma follows as any minimal system of generators of $J$
is a regular sequence by
More on Algebra, Lemmas
\ref{more-algebra-lemma-independence-of-generators} and
\ref{more-algebra-lemma-noetherian-finite-all-equivalent}.
\end{proof}

\begin{lemma}
\label{lemma-perfect-map-ci}
Let $R \to S$ be a local ring map of Noetherian local rings.
Let $I \subset R$ and $J \subset S$ be ideals with
$IS \subset J$. If $R \to S$ is flat and $S/\mathfrak m_RS$ is
regular, then the following are equivalent
\begin{enumerate}
\item $J$ is generated by a regular sequence and
$S/J$ has finite tor dimension as a module over $R/I$,
\item $J$ is generated by a regular sequence and
$\text{Tor}^{R/I}_p(S/J, R/\mathfrak m_R)$ is nonzero
for only finitely many $p$,
\item $I$ is generated by a regular sequence
and $J/IS$ is generated by a regular sequence in $S/IS$.
\end{enumerate}
\end{lemma}

\begin{proof}
If (3) holds, then $J$ is generated by a regular sequence, see for example
More on Algebra, Lemmas
\ref{more-algebra-lemma-join-koszul-regular-sequences} and
\ref{more-algebra-lemma-noetherian-finite-all-equivalent}.
Moreover, if (3) holds, then $S/J = (S/I)/(J/I)$
has finite projective dimension over $S/IS$ because the Koszul
complex will be a finite free resolution of $S/J$ over $S/IS$.
Since $R/I \to S/IS$ is flat, it then follows that $S/J$ has finite
tor dimension over $R/I$ by
More on Algebra, Lemma \ref{more-algebra-lemma-flat-push-tor-amplitude}.
Thus (3) implies (1).

\medskip\noindent
The implication (1) $\Rightarrow$ (2) is trivial.
Assume (2). By
More on Algebra, Lemma \ref{more-algebra-lemma-perfect-over-regular-local-ring}
we find that $S/J$ has finite tor dimension over $S/IS$.
Thus we can apply Lemma \ref{lemma-regular-sequence}
to conclude that $IS$ and $J/IS$ are generated by regular sequences.
Let $f_1, \ldots, f_r \in I$ be a minimal system of generators of $I$.
Since $R \to S$ is flat, we see that $f_1, \ldots, f_r$ form a minimal
system of generators for $IS$ in $S$. Thus $f_1, \ldots, f_r \in R$
is a sequence of elements whose images in $S$ form a regular sequence
by More on Algebra, Lemmas
\ref{more-algebra-lemma-independence-of-generators} and
\ref{more-algebra-lemma-noetherian-finite-all-equivalent}.
Thus $f_1, \ldots, f_r$ is a regular sequence in $R$ by
Algebra, Lemma \ref{algebra-lemma-flat-increases-depth}.
\end{proof}





\section{Local complete intersection rings}
\label{section-lci}

\noindent
Let $(A, \mathfrak m)$ be a Noetherian complete local ring.
By the Cohen structure theorem (see
Algebra, Theorem \ref{algebra-theorem-cohen-structure-theorem})
we can write $A$ as the quotient of a regular Noetherian
complete local ring $R$. Let us say that $A$ is a
{\it complete intersection}
if there exists some surjection $R \to A$
with $R$ a regular local ring such that the kernel
is generated by a regular sequence.
The following lemma shows this notion is independent of
the choice of the surjection.

\begin{lemma}
\label{lemma-ci-well-defined}
Let $(A, \mathfrak m)$ be a Noetherian complete local ring.
The following are equivalent
\begin{enumerate}
\item for every surjection of local rings $R \to A$ with $R$
a regular local ring, the kernel of $R \to A$ is generated
by a regular sequence, and
\item for some surjection of local rings $R \to A$ with $R$
a regular local ring, the kernel of $R \to A$ is generated
by a regular sequence.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $k$ be the residue field of $A$. If the characteristic of
$k$ is $p > 0$, then we denote $\Lambda$ a Cohen ring
(Algebra, Definition \ref{algebra-definition-cohen-ring})
with residue field $k$ (Algebra, Lemma \ref{algebra-lemma-cohen-rings-exist}).
If the characteristic of $k$ is $0$ we set $\Lambda = k$.
Recall that $\Lambda[[x_1, \ldots, x_n]]$ for any $n$
is formally smooth over $\mathbf{Z}$, resp.\ $\mathbf{Q}$
in the $\mathfrak m$-adic topology, see
More on Algebra, Lemma
\ref{more-algebra-lemma-power-series-ring-over-Cohen-fs}.
Fix a surjection $\Lambda[[x_1, \ldots, x_n]] \to A$ as in
the Cohen structure theorem
(Algebra, Theorem \ref{algebra-theorem-cohen-structure-theorem}).

\medskip\noindent
Let $R \to A$ be a surjection from a regular local ring $R$.
Let $f_1, \ldots, f_r$ be a minimal sequence of generators
of $\Ker(R \to A)$. We will use without further mention
that an ideal in a Noetherian local ring is generated by a regular
sequence if and only if any minimal set of generators is a
regular sequence. Observe that $f_1, \ldots, f_r$
is a regular sequence in $R$ if and only if $f_1, \ldots, f_r$
is a regular sequence in the completion $R^\wedge$ by
Algebra, Lemmas \ref{algebra-lemma-flat-increases-depth} and
\ref{algebra-lemma-completion-flat}.
Moreover, we have
$$
R^\wedge/(f_1, \ldots, f_r)R^\wedge =
(R/(f_1, \ldots, f_n))^\wedge = A^\wedge = A
$$
because $A$ is $\mathfrak m_A$-adically complete (first equality by
Algebra, Lemma \ref{algebra-lemma-completion-tensor}). Finally,
the ring $R^\wedge$ is regular since $R$ is regular
(More on Algebra, Lemma \ref{more-algebra-lemma-completion-regular}).
Hence we may assume $R$ is complete.

\medskip\noindent
If $R$ is complete we can choose a map
$\Lambda[[x_1, \ldots, x_n]] \to R$ lifting the given map
$\Lambda[[x_1, \ldots, x_n]] \to A$, see
More on Algebra, Lemma \ref{more-algebra-lemma-lift-continuous}.
By adding some more variables $y_1, \ldots, y_m$ mapping
to generators of the kernel of $R \to A$ we may assume that
$\Lambda[[x_1, \ldots, x_n, y_1, \ldots, y_m]] \to R$ is surjective
(some details omitted). Then we can consider the commutative diagram
$$
\xymatrix{
\Lambda[[x_1, \ldots, x_n, y_1, \ldots, y_m]] \ar[r] \ar[d] & R \ar[d] \\
\Lambda[[x_1, \ldots, x_n]] \ar[r] & A
}
$$
By Algebra, Lemma \ref{algebra-lemma-ci-well-defined} we see that
the condition for $R \to A$ is equivalent to the condition for
the fixed chosen map
$\Lambda[[x_1, \ldots, x_n]] \to A$. This finishes the proof of the lemma.
\end{proof}

\noindent
The following two lemmas are sanity checks on the definition given above.

\begin{lemma}
\label{lemma-quotient-regular-ring-by-regular-sequence}
Let $R$ be a regular ring. Let $\mathfrak p \subset R$ be a prime.
Let $f_1, \ldots, f_r \in \mathfrak p$ be a regular sequence.
Then the completion of
$$
A = (R/(f_1, \ldots, f_r))_\mathfrak p =
R_\mathfrak p/(f_1, \ldots, f_r)R_\mathfrak p
$$
is a complete intersection in the sense defined above.
\end{lemma}

\begin{proof}
The completion of $A$ is equal to
$A^\wedge = R_\mathfrak p^\wedge/(f_1, \ldots, f_r)R_\mathfrak p^\wedge$
because completion for finite modules over the Noetherian ring
$R_\mathfrak p$ is exact
(Algebra, Lemma \ref{algebra-lemma-completion-tensor}).
The image of the sequence $f_1, \ldots, f_r$ in $R_\mathfrak p$
is a regular sequence by
Algebra, Lemmas \ref{algebra-lemma-completion-flat} and
\ref{algebra-lemma-flat-increases-depth}.
Moreover, $R_\mathfrak p^\wedge$ is a regular local ring by
More on Algebra, Lemma \ref{more-algebra-lemma-completion-regular}.
Hence the result holds by our definition of complete
intersection for complete local rings.
\end{proof}

\noindent
The following lemma is the analogue of Algebra, Lemma \ref{algebra-lemma-lci}.

\begin{lemma}
\label{lemma-quotient-regular-ring}
Let $R$ be a regular ring. Let $\mathfrak p \subset R$ be a prime.
Let $I \subset \mathfrak p$ be an ideal.
Set $A = (R/I)_\mathfrak p = R_\mathfrak p/I_\mathfrak p$.
The following are equivalent
\begin{enumerate}
\item the completion of $A$
is a complete intersection in the sense above,
\item $I_\mathfrak p \subset R_\mathfrak p$ is generated
by a regular sequence,
\item the module $(I/I^2)_\mathfrak p$ can be generated by
$\dim(R_\mathfrak p) - \dim(A)$ elements,
\item add more here.
\end{enumerate}
\end{lemma}

\begin{proof}
We may and do replace $R$ by its localization at $\mathfrak p$.
Then $\mathfrak p = \mathfrak m$ is the maximal ideal of $R$
and $A = R/I$. Let $f_1, \ldots, f_r \in I$ be a minimal sequence
of generators.  The completion of $A$ is equal to
$A^\wedge = R^\wedge/(f_1, \ldots, f_r)R^\wedge$
because completion for finite modules over the Noetherian ring
$R_\mathfrak p$ is exact
(Algebra, Lemma \ref{algebra-lemma-completion-tensor}).

\medskip\noindent
If (1) holds, then the image of the sequence $f_1, \ldots, f_r$ in $R^\wedge$
is a regular sequence by assumption. Hence it is a regular sequence
in $R$ by Algebra, Lemmas \ref{algebra-lemma-completion-flat} and
\ref{algebra-lemma-flat-increases-depth}. Thus (1) implies (2).

\medskip\noindent
Assume (3) holds. Set $c = \dim(R) - \dim(A)$ and let $f_1, \ldots, f_c \in I$
map to generators of $I/I^2$. by Nakayama's lemma
(Algebra, Lemma \ref{algebra-lemma-NAK})
we see that $I = (f_1, \ldots, f_c)$. Since $R$ is regular and hence
Cohen-Macaulay (Algebra, Proposition \ref{algebra-proposition-CM-module})
we see that $f_1, \ldots, f_c$ is a regular sequence by
Algebra, Proposition \ref{algebra-proposition-CM-module}.
Thus (3) implies (2).
Finally, (2) implies (1) by
Lemma \ref{lemma-quotient-regular-ring-by-regular-sequence}.
\end{proof}

\noindent
The following result is due to Avramov, see \cite{Avramov}.

\begin{proposition}
\label{proposition-avramov}
Let $A \to B$ be a flat local homomorphism of Noetherian local rings.
Then the following are equivalent
\begin{enumerate}
\item $B^\wedge$ is a complete intersection,
\item $A^\wedge$ and $(B/\mathfrak m_A B)^\wedge$ are complete intersections.
\end{enumerate}
\end{proposition}

\begin{proof}
Consider the diagram
$$
\xymatrix{
B \ar[r] & B^\wedge \\
A \ar[u] \ar[r] & A^\wedge \ar[u]
}
$$
Since the horizontal maps are faithfully flat
(Algebra, Lemma \ref{algebra-lemma-completion-faithfully-flat})
we conclude that the right vertical arrow is flat
(for example by Algebra, Lemma
\ref{algebra-lemma-criterion-flatness-fibre-Noetherian}).
Moreover, we have
$(B/\mathfrak m_A B)^\wedge = B^\wedge/\mathfrak m_{A^\wedge} B^\wedge$
by Algebra, Lemma \ref{algebra-lemma-completion-tensor}.
Thus we may assume $A$ and $B$ are complete local Noetherian rings.

\medskip\noindent
Assume $A$ and $B$ are complete local Noetherian rings.
Choose a diagram
$$
\xymatrix{
S \ar[r] & B \\
R \ar[u] \ar[r] & A \ar[u]
}
$$
as in More on Algebra, Lemma
\ref{more-algebra-lemma-embed-map-Noetherian-complete-local-rings}.
Let $I = \Ker(R \to A)$ and $J = \Ker(S \to B)$.
Note that since $R/I = A \to B = S/J$ is flat the map
$J/IS \otimes_R R/\mathfrak m_R \to J/J \cap \mathfrak m_R S$
is an isomorphism. Hence a minimal system of generators of $J/IS$
maps to a minimal system of generators of
$\Ker(S/\mathfrak m_R S \to B/\mathfrak m_A B)$.
Finally, $S/\mathfrak m_R S$ is a regular local ring.

\medskip\noindent
Assume (1) holds, i.e., $J$ is generated by a regular sequence.
Since $A = R/I \to B = S/J$ is flat we see
Lemma \ref{lemma-perfect-map-ci} applies and we deduce
that $I$ and $J/IS$ are generated by regular sequences.
We have $\dim(B) = \dim(A) + \dim(B/\mathfrak m_A B)$ and
$\dim(S/IS) = \dim(A) + \dim(S/\mathfrak m_R S)$
(Algebra, Lemma \ref{algebra-lemma-dimension-base-fibre-equals-total}).
Thus $J/IS$ is generated by
$$
\dim(S/J) - \dim(S/IS) = \dim(S/\mathfrak m_R S) - \dim(B/\mathfrak m_A B)
$$
elements (Algebra, Lemma \ref{algebra-lemma-one-equation}).
It follows that $\Ker(S/\mathfrak m_R S \to B/\mathfrak m_A B)$
is generated by the same number of elements (see above).
Hence $\Ker(S/\mathfrak m_R S \to B/\mathfrak m_A B)$
is generated by a regular sequence, see for example
Lemma \ref{lemma-quotient-regular-ring}.
In this way we see that (2) holds.

\medskip\noindent
If (2) holds, then $I$ and $J/J \cap \mathfrak m_RS$
are generated by regular sequences. Lifting these generators
(see above), using flatness of $R/I \to S/IS$,
and using Grothendieck's lemma
(Algebra, Lemma \ref{algebra-lemma-grothendieck-regular-sequence})
we find that $J/IS$ is generated by a regular sequence in $S/IS$.
Thus Lemma \ref{lemma-perfect-map-ci} tells us that $J$
is generated by a regular sequence, whence (1) holds.
\end{proof}

\begin{definition}
\label{definition-lci}
Let $A$ be a Noetherian ring.
\begin{enumerate}
\item If $A$ is local, then we say $A$ is a {\it complete intersection}
if its completion is a complete intersection in the sense above.
\item In general we say $A$ is a {\it local complete intersection}
if all of its local rings are complete intersections.
\end{enumerate}
\end{definition}

\noindent
We will check below that this does not conflict with the terminology
introduced in
Algebra, Definitions \ref{algebra-definition-lci-field} and
\ref{algebra-definition-lci-local-ring}.
But first, we show this ``makes sense'' by showing
that if $A$ is a Noetherian
local complete intersection, then $A$ is a local complete intersection,
i.e., all of its local rings are complete intersections.

\begin{lemma}
\label{lemma-ci-good}
Let $(A, \mathfrak m)$ be a Noetherian local ring. Let
$\mathfrak p \subset A$ be a prime ideal. If $A$ is a complete
intersection, then $A_\mathfrak p$ is a complete intersection too.
\end{lemma}

\begin{proof}
Choose a prime $\mathfrak q$ of $A^\wedge$ lying over $\mathfrak p$
(this is possible as $A \to A^\wedge$ is faithfully flat by
Algebra, Lemma \ref{algebra-lemma-completion-faithfully-flat}).
Then $A_\mathfrak p \to (A^\wedge)_\mathfrak q$ is a flat local
ring homomorphism. Thus by Proposition \ref{proposition-avramov}
we see that $A_\mathfrak p$ is a complete intersection if and only if
$(A^\wedge)_\mathfrak q$ is a complete intersection. Thus it suffices
to prove the lemma in case $A$ is complete (this is the key step
of the proof).

\medskip\noindent
Assume $A$ is complete. By definition we may write
$A = R/(f_1, \ldots, f_r)$ for some regular sequence
$f_1, \ldots, f_r$ in a regular local ring $R$.
Let $\mathfrak q \subset R$ be the prime corresponding to $\mathfrak p$.
Observe that $f_1, \ldots, f_r \in \mathfrak q$ and that
$A_\mathfrak p = R_\mathfrak q/(f_1, \ldots, f_r)R_\mathfrak q$.
Hence $A_\mathfrak p$ is a complete intersection by
Lemma \ref{lemma-quotient-regular-ring-by-regular-sequence}.
\end{proof}

\begin{lemma}
\label{lemma-check-lci-at-maximal-ideals}
Let $A$ be a Noetherian ring. Then $A$ is a local complete intersection
if and only if $A_\mathfrak m$ is a complete intersection for every
maximal ideal $\mathfrak m$ of $A$.
\end{lemma}

\begin{proof}
This follows immediately from Lemma \ref{lemma-ci-good} and the definitions.
\end{proof}

\begin{lemma}
\label{lemma-check-lci-agrees}
Let $S$ be a finite type algebra over a field $k$.
\begin{enumerate}
\item for a prime $\mathfrak q \subset S$ the local ring $S_\mathfrak q$
is a complete intersection in the sense of
Algebra, Definition \ref{algebra-definition-lci-local-ring}
if and only if $S_\mathfrak q$ is a complete
intersection in the sense of Definition \ref{definition-lci}, and
\item $S$ is a local complete intersection in the sense of
Algebra, Definition \ref{algebra-definition-lci-field}
if and only if $S$ is a local complete
intersection in the sense of Definition \ref{definition-lci}.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $k[x_1, \ldots, x_n] \to S$ be a surjection.
Let $\mathfrak p \subset k[x_1, \ldots, x_n]$ be the prime ideal
corresponding to $\mathfrak q$.
Let $I \subset k[x_1, \ldots, x_n]$ be the kernel of our surjection.
Note that $k[x_1, \ldots, x_n]_\mathfrak p \to S_\mathfrak q$
is surjective with kernel $I_\mathfrak p$. Observe that
$k[x_1, \ldots, x_n]$ is a regular ring by
Algebra, Proposition \ref{algebra-proposition-finite-gl-dim-polynomial-ring}.
Hence the equivalence of the two notions in (1) follows by
combining
Lemma \ref{lemma-quotient-regular-ring}
with Algebra, Lemma \ref{algebra-lemma-lci-local}.

\medskip\noindent
Having proved (1) the equivalence in (2) follows from the
definition and Algebra, Lemma \ref{algebra-lemma-lci-global}.
\end{proof}

\begin{lemma}
\label{lemma-avramov}
Let $A \to B$ be a flat local homomorphism of Noetherian local rings.
Then the following are equivalent
\begin{enumerate}
\item $B$ is a complete intersection,
\item $A$ and $B/\mathfrak m_A B$ are complete intersections.
\end{enumerate}
\end{lemma}

\begin{proof}
Now that the definition makes sense this is a trivial reformulation
of the (nontrivial) Proposition \ref{proposition-avramov}.
\end{proof}









\section{Local complete intersection maps}
\label{section-lci-homomorphisms}

\noindent
Let $A \to B$ be a local homomorphism of Noetherian complete local rings.
A consequence of the Cohen structure theorem is that we can find a
commutative diagram
$$
\xymatrix{
S \ar[r] & B \\
& A \ar[lu] \ar[u]
}
$$
of Noetherian complete local rings with
$S \to B$ surjective, $A \to S$ flat, and
$S/\mathfrak m_A S$ a regular local ring. This follows from
More on Algebra, Lemma
\ref{more-algebra-lemma-embed-map-Noetherian-complete-local-rings}.
Let us (temporarily) say $A \to S \to B$ is a {\it good factorization}
of $A \to B$ if $S$ is a Noetherian local ring,
$A \to S \to B$ are local ring maps,
$S \to B$ surjective, $A \to S$ flat, and $S/\mathfrak m_AS$ regular.
Let us say that $A \to B$ is a
{\it complete intersection homomorphism}
if there exists some good factorization $A \to S \to B$
such that the kernel of $S \to B$ is generated by a regular sequence.
The following lemma shows this notion is independent of
the choice of the diagram.

\begin{lemma}
\label{lemma-ci-map-well-defined}
Let $A \to B$ be a local homomorphism of Noetherian complete local rings.
The following are equivalent
\begin{enumerate}
\item for some good factorization $A \to S \to B$ the kernel of
$S \to B$ is generated by a regular sequence, and
\item for every good factorization $A \to S \to B$ the kernel of
$S \to B$ is generated by a regular sequence.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $A \to S \to B$ be a good factorization.
As $B$ is complete we obtain a factorization
$A \to S^\wedge \to B$ where $S^\wedge$ is the completion of $S$.
Note that this is also a good factorization:
The ring map $S \to S^\wedge$ is flat
(Algebra, Lemma \ref{algebra-lemma-completion-flat}),
hence $A \to S^\wedge$ is flat.
The ring $S^\wedge/\mathfrak m_A S^\wedge = (S/\mathfrak m_A S)^\wedge$
is regular since $S/\mathfrak m_A S$ is regular
(More on Algebra, Lemma \ref{more-algebra-lemma-completion-regular}).
Let $f_1, \ldots, f_r$ be a minimal sequence of generators
of $\Ker(S \to B)$. We will use without further mention
that an ideal in a Noetherian local ring is generated by a regular
sequence if and only if any minimal set of generators is a
regular sequence. Observe that $f_1, \ldots, f_r$
is a regular sequence in $S$ if and only if $f_1, \ldots, f_r$
is a regular sequence in the completion $S^\wedge$ by
Algebra, Lemma \ref{algebra-lemma-flat-increases-depth}.
Moreover, we have
$$
S^\wedge/(f_1, \ldots, f_r)R^\wedge =
(S/(f_1, \ldots, f_n))^\wedge = B^\wedge = B
$$
because $B$ is $\mathfrak m_B$-adically complete (first equality by
Algebra, Lemma \ref{algebra-lemma-completion-tensor}).
Thus the kernel of $S \to B$ is generated by a regular sequence
if and only if the kernel of $S^\wedge \to B$ is generated by a
regular sequence.
Hence it suffices to consider good factorizations where $S$ is complete.

\medskip\noindent
Assume we have two factorizations $A \to S \to B$ and
$A \to S' \to B$ with $S$ and $S'$ complete. By
More on Algebra, Lemma \ref{more-algebra-lemma-dominate-two-surjections}
the ring $S \times_B S'$ is a Noetherian complete local ring.
Hence, using More on Algebra, Lemma
\ref{more-algebra-lemma-embed-map-Noetherian-complete-local-rings}
we can choose a good factorization $A \to S'' \to S \times_B S'$
with $S''$ complete. Thus it suffices to show:
If $A \to S' \to S \to B$ are comparable good factorizations,
then $\Ker(S \to B)$ is generated by a regular sequence
if and only if $\Ker(S' \to B)$ is generated by a regular sequence.

\medskip\noindent
Let $A \to S' \to S \to B$ be comparable good factorizations.
First, since $S'/\mathfrak m_R S' \to S/\mathfrak m_R S$ is
a surjection of regular local rings, the kernel is generated
by a regular sequence
$\overline{x}_1, \ldots, \overline{x}_c \in
\mathfrak m_{S'}/\mathfrak m_R S'$
which can be extended to a regular system of parameters for
the regular local ring $S'/\mathfrak m_R S'$, see
(Algebra, Lemma \ref{algebra-lemma-regular-quotient-regular}).
Set $I = \Ker(S' \to S)$. By flatness of $S$ over $R$ we have
$$
I/\mathfrak m_R I =
\Ker(S'/\mathfrak m_R S' \to S/\mathfrak m_R S) =
(\overline{x}_1, \ldots, \overline{x}_c).
$$
Choose lifts $x_1, \ldots, x_c \in I$. These lifts form a regular sequence
generating $I$ as $S'$ is flat over $R$, see
Algebra, Lemma \ref{algebra-lemma-grothendieck-regular-sequence}.

\medskip\noindent
We conclude that if also $\Ker(S \to B)$ is generated by a
regular sequence, then so is $\Ker(S' \to B)$, see
More on Algebra, Lemmas
\ref{more-algebra-lemma-join-koszul-regular-sequences} and
\ref{more-algebra-lemma-noetherian-finite-all-equivalent}.

\medskip\noindent
Conversely, assume that $J = \Ker(S' \to B)$ is generated
by a regular sequence. Because the generators $x_1, \ldots, x_c$
of $I$ map to linearly independent elements of
$\mathfrak m_{S'}/\mathfrak m_{S'}^2$ we see that
$I/\mathfrak m_{S'}I \to J/\mathfrak m_{S'}J$ is injective.
Hence there exists a minimal system of generators
$x_1, \ldots, x_c, y_1, \ldots, y_d$ for $J$.
Then $x_1, \ldots, x_c, y_1, \ldots, y_d$ is a regular sequence
and it follows that the images of $y_1, \ldots, y_d$ in $S$
form a regular sequence generating $\Ker(S \to B)$.
This finishes the proof of the lemma.
\end{proof}

\noindent
In the following proposition observe that the condition on vanishing of
Tor's applies in particular if $B$ has finite tor dimension over $A$ and
thus in particular if $B$ is flat over $A$.

\begin{proposition}
\label{proposition-avramov-map}
Let $A \to B$ be a local homomorphism of Noetherian local rings.
Then the following are equivalent
\begin{enumerate}
\item $B$ is a complete intersection and
$\text{Tor}^A_p(B, A/\mathfrak m_A)$ is nonzero for only finitely many $p$,
\item $A$ is a complete intersection and
$A^\wedge \to B^\wedge$ is a complete intersection homomorphism
in the sense defined above.
\end{enumerate}
\end{proposition}

\begin{proof}
Let $F_\bullet \to A/\mathfrak m_A$ be a resolution by finite
free $A$-modules. Observe that
$\text{Tor}^A_p(B, A/\mathfrak m_A)$
is the $p$th homology of the complex $F_\bullet \otimes_A B$.
Let $F_\bullet^\wedge = F_\bullet \otimes_A A^\wedge$ be the completion.
Then $F_\bullet^\wedge$ is a resolution of $A^\wedge/\mathfrak m_{A^\wedge}$
by finite free $A^\wedge$-modules (as $A \to A^\wedge$ is flat and completion
on finite modules is exact, see
Algebra, Lemmas \ref{algebra-lemma-completion-tensor} and
\ref{algebra-lemma-completion-flat}).
It follows that
$$
F_\bullet^\wedge \otimes_{A^\wedge} B^\wedge =
F_\bullet \otimes_A B \otimes_B B^\wedge
$$
By flatness of $B \to B^\wedge$ we conclude that
$$
\text{Tor}^{A^\wedge}_p(B^\wedge, A^\wedge/\mathfrak m_{A^\wedge}) =
\text{Tor}^A_p(B, A/\mathfrak m_A) \otimes_B B^\wedge
$$
In this way we see that the condition in (1) on the local ring map $A \to B$
is equivalent to the same condition for the local ring map
$A^\wedge \to B^\wedge$.
Thus we may assume $A$ and $B$ are complete local Noetherian rings
(since the other conditions are formulated in terms of the completions
in any case).

\medskip\noindent
Assume $A$ and $B$ are complete local Noetherian rings.
Choose a diagram
$$
\xymatrix{
S \ar[r] & B \\
R \ar[u] \ar[r] & A \ar[u]
}
$$
as in More on Algebra, Lemma
\ref{more-algebra-lemma-embed-map-Noetherian-complete-local-rings}.
Let $I = \Ker(R \to A)$ and $J = \Ker(S \to B)$.
The proposition now follows from Lemma \ref{lemma-perfect-map-ci}.
\end{proof}

\begin{remark}
\label{remark-no-good-ci-map}
It appears difficult to define an good notion of ``local complete
intersection homomorphisms'' for maps between general Noetherian rings.
The reason is that, for a local Noetherian ring $A$, the fibres of
$A \to A^\wedge$ are not local complete intersection rings.
Thus, if $A \to B$ is a local homomorphism of local Noetherian rings,
and the map of completions $A^\wedge \to B^\wedge$ is a
complete intersection homomorphism in the sense defined above,
then $(A_\mathfrak p)^\wedge \to (B_\mathfrak q)^\wedge$ is in general
{\bf not} a complete intersection homomorphism in the sense
defined above. A solution can be had by working exclusively with
excellent Noetherian rings. More generally, one could work with
those Noetherian rings whose formal fibres are complete
intersections, see \cite{Rodicio-ci}.
We will develop this theory in
Dualizing Complexes, Section \ref{dualizing-section-formal-fibres}.
\end{remark}

\noindent
To finish of this section we compare the notion defined above
with the notion introduced in
More on Algebra, Section \ref{section-lci}.

\begin{lemma}
\label{lemma-well-defined-if-you-can-find-good-factorization}
Consider a commutative diagram
$$
\xymatrix{
S \ar[r] & B \\
& A \ar[lu] \ar[u]
}
$$
of Noetherian local rings with $S \to B$ surjective, $A \to S$ flat, and
$S/\mathfrak m_A S$ a regular local ring. The following are equivalent
\begin{enumerate}
\item $\Ker(S \to B)$ is generated by a regular sequence, and
\item $A^\wedge \to B^\wedge$ is a complete intersection homomorphism
as defined above.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: the proof is identical to the argument given in
the first paragraph of the proof of Lemma \ref{lemma-ci-map-well-defined}.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-lci-map}
Let $A$ be a Noetherian ring.
Let $A \to B$ be a finite type ring map.
The following are equivalent
\begin{enumerate}
\item $A \to B$ is a local complete intersection in the sense of
More on Algebra, Definition
\ref{more-algebra-definition-local-complete-intersection},
\item for every prime $\mathfrak q \subset B$ and with
$\mathfrak p = A \cap \mathfrak q$ the ring map
$(A_\mathfrak p)^\wedge \to (B_\mathfrak q)^\wedge$ is
a complete intersection homomorphism in the sense defined above.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a surjection $R = A[x_1, \ldots, x_n] \to B$.
Observe that $A \to R$ is flat with regular fibres.
Let $I$ be the kernel of $R \to B$.
Assume (2). Then we see that
$I$ is locally generated by a regular sequence
by
Lemma \ref{lemma-well-defined-if-you-can-find-good-factorization}
and
Algebra, Lemma \ref{algebra-lemma-regular-sequence-in-neighbourhood}.
In other words, (1) holds.
Conversely, assume (1). Then after localizing on $R$ and $B$
we can assume that $I$ is generated by a Koszul regular sequence.
By More on Algebra, Lemma
\ref{more-algebra-lemma-noetherian-finite-all-equivalent}
we find that $I$ is locally generated by a regular sequence.
Hence (2) hold by
Lemma \ref{lemma-well-defined-if-you-can-find-good-factorization}.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-avramov-map-finite-type}
Let $A$ be a Noetherian ring. Let $A \to B$ be a finite type ring map
such that the image of $\Spec(B) \to \Spec(A)$ contains all closed
points of $\Spec(A)$. Then the following are equivalent
\begin{enumerate}
\item $B$ is a complete intersection and $A \to B$ has finite
tor dimension,
\item $A$ is a complete intersection and $A \to B$ is a local complete
intersection in the sense of More on Algebra, Definition
\ref{more-algebra-definition-local-complete-intersection}.
\end{enumerate}
\end{lemma}

\begin{proof}
This is a reformulation of Proposition \ref{proposition-avramov-map}
via Lemma \ref{lemma-finite-type-lci-map}.
We omit the details.
\end{proof}








\section{Smooth ring maps and diagonals}
\label{section-smooth-diagonal-perfect}

\noindent
In this section we use the material above to characterize smooth ring maps as
those whose diagonal is perfect.

\begin{lemma}
\label{lemma-local-perfect-diagonal}
Let $A \to B$ be a local ring homomorphism of Noetherian local rings such that
$B$ is flat and essentially of finite type over $A$. If
$$
B \otimes_A B \longrightarrow B
$$
is a perfect ring map, i.e., if $B$ has finite tor dimension over
$B \otimes_A B$, then $B$ is the localization of a smooth $A$-algebra.
\end{lemma}

\begin{proof}
As $B$ is essentially of finite type over $A$, so is $B \otimes_A B$ and
in particular $B \otimes_A B$ is Noetherian. Hence the quotient $B$ of
$B \otimes_A B$ is pseudo-coherent over $B \otimes_A B$
(More on Algebra, Lemma \ref{more-algebra-lemma-Noetherian-pseudo-coherent})
which explains why perfectness of the ring map (More on Algebra, Definition
\ref{more-algebra-definition-pseudo-coherent-perfect}) agrees with the
condition of finite tor dimension.

\medskip\noindent
We may write $B = R/K$ where $R$ is the localization of $A[x_1, \ldots, x_n]$
at a prime ideal and $K \subset R$ is an ideal. Denote
$\mathfrak m \subset R \otimes_A R$ the maximal ideal which is the inverse
image of the maximal ideal of $B$ via the surjection
$R \otimes_A R \to B \otimes_A B \to B$. Then we have surjections
$$
(R \otimes_A R)_\mathfrak m \to (B \otimes_A B)_\mathfrak m \to B
$$
and hence ideals $I \subset J \subset (R \otimes_A R)_\mathfrak m$
as in Lemma \ref{lemma-injective}. We conclude that
$I/\mathfrak m I \to J/\mathfrak m J$ is injective.

\medskip\noindent
Let $K = (f_1, \ldots, f_r)$ with $r$ minimal. We may and do assume that
$f_i \in R$ is the image of an element of $A[x_1, \ldots, x_n]$ which we
also denote $f_i$. Observe that $I$ is generated
by $f_1 \otimes 1, \ldots, f_r \otimes 1$ and
$1 \otimes f_1, \ldots, 1 \otimes f_r$. We claim that this is a minimal
set of generators of $I$. Namely, if $\kappa$ is the common residue field
of $R$, $B$, $(R \otimes_A R)_\mathfrak m$, and $(B \otimes_A B)_\mathfrak m$
then we have a map
$R \otimes_A R \to R \otimes_A \kappa \oplus \kappa \otimes_A R$
which factors through $(R \otimes_A R)_\mathfrak m$. Since $B$ is
flat over $A$ and since we have the short exact sequence
$0 \to K \to R \to B \to 0$ we see that
$K \otimes_A \kappa \subset R \otimes_A \kappa$, see
Algebra, Lemma \ref{algebra-lemma-flat-tor-zero}.
Thus restricting the map
$(R \otimes_A R)_\mathfrak m \to R \otimes_A \kappa \oplus \kappa \otimes_A R$
to $I$ we obtain a map
$$
I \to K \otimes_A \kappa \oplus \kappa \otimes_A K \to
K \otimes_B \kappa \oplus \kappa \otimes_B K.
$$
The elements
$f_1 \otimes 1, \ldots, f_r \otimes 1, 1 \otimes f_1, \ldots, 1 \otimes f_r$
map to a basis of the target of this map, since by Nakayama's lemma
(Algebra, Lemma \ref{algebra-lemma-NAK})
$f_1, \ldots, f_r$ map to a basis of $K \otimes_B \kappa$.
This proves our claim.

\medskip\noindent
The ideal $J$ is generated by $f_1 \otimes 1, \ldots, f_r \otimes 1$
and the elements $x_1 \otimes 1 - 1 \otimes x_1, \ldots,
x_n \otimes 1 - 1 \otimes x_n$ (for the proof it suffices to
see that these elements are contained in the ideal $J$).
Now we can write
$$
f_i \otimes 1 - 1 \otimes f_i =
\sum g_{ij} (x_j \otimes 1 - 1 \otimes x_j)
$$
for some $g_{ij}$ in $(R \otimes_A R)_\mathfrak m$. This is a general
fact about elements of $A[x_1, \ldots, x_n]$ whose proof we omit.
Denote $a_{ij} \in \kappa$ the image of $g_{ij}$. Another computation
shows that $a_{ij}$ is the image of $\partial f_i / \partial x_j$ in $\kappa$.
The injectivity of $I/\mathfrak m I \to J/\mathfrak m J$ and the remarks
made above forces the matrix $(a_{ij})$ to have maximal rank $r$.
Set
$$
C = A[x_1, \ldots, x_n]/(f_1, \ldots, f_r)
$$
and consider the naive cotangent complex
$\NL_{C/A} \cong (C^{\oplus r} \to C^{\oplus n})$
where the map is given by the matrix of partial derivatives.
Thus $\NL_{C/A} \otimes_A B$
is isomorphic to a free $B$-module of rank $n - r$ placed in degree $0$.
Hence $C_g$ is smooth over $A$ for some $g \in C$ mapping to a unit
in $B$, see Algebra, Lemma \ref{algebra-lemma-smooth-at-point}.
This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-perfect-diagonal}
Let $A \to B$ be a flat finite type ring map of Noetherian rings. If
$$
B \otimes_A B \longrightarrow B
$$
is a perfect ring map, i.e., if $B$ has finite tor dimension over
$B \otimes_A B$, then $B$ is a smooth $A$-algebra.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-local-perfect-diagonal}
and general facts about smooth ring maps, see
Algebra, Lemmas \ref{algebra-lemma-smooth-at-point} and
\ref{algebra-lemma-locally-smooth}.
Alternatively, the reader can slightly modify the proof of
Lemma \ref{lemma-local-perfect-diagonal} to prove
this lemma.
\end{proof}






\section{Freeness of the conormal module}
\label{section-freeness-conormal}

\noindent
Tate resolutions and derivations on them can be used to prove
(stronger) versions of the results in this section, see \cite{Iyengar}.
Two more elementary references are
\cite{Vasconcelos} and \cite{Ferrand-lci}.

\begin{lemma}
\label{lemma-free-summand-in-ideal-finite-proj-dim}
\begin{reference}
\cite{Vasconcelos}
\end{reference}
Let $R$ be a Noetherian local ring. Let $I \subset R$ be an ideal
of finite projective dimension over $R$. If $F \subset I/I^2$ is a
direct summand isomorphic to $R/I$, then there exists a nonzerodivisor
$x \in I$ such that the image of $x$ in $I/I^2$ generates $F$.
\end{lemma}

\begin{proof}
By assumption we may choose a finite free resolution
$$
0 \to R^{\oplus n_e} \to R^{\oplus n_{e-1}} \to \ldots \to
R^{\oplus n_1} \to R \to R/I \to 0
$$
Then $\varphi_1 : R^{\oplus n_1} \to R$ has rank $1$ and
we see that $I$ contains a nonzerodivisor $y$ by
Algebra, Proposition \ref{algebra-proposition-what-exact}.
Let $\mathfrak p_1, \ldots, \mathfrak p_n$ be the associated
primes of $R$, see Algebra, Lemma \ref{algebra-lemma-finite-ass}.
Let $I^2 \subset J \subset I$ be an ideal such that $J/I^2 = F$.
Then $J \not \subset \mathfrak p_i$ for all $i$
as $y^2 \in J$ and $y^2 \not \in \mathfrak p_i$, see
Algebra, Lemma \ref{algebra-lemma-ass-zero-divisors}.
By Nakayama's lemma (Algebra, Lemma \ref{algebra-lemma-NAK})
we have $J \not \subset \mathfrak m J + I^2$.
By Algebra, Lemma \ref{algebra-lemma-silly}
we can pick $x \in J$, $x \not \in \mathfrak m J + I^2$ and
$x \not \in \mathfrak p_i$ for $i = 1, \ldots, n$.
Then $x$ is a nonzerodivisor and the image
of $x$ in $I/I^2$ generates (by Nakayama's lemma)
the summand $J/I^2 \cong R/I$.
\end{proof}

\begin{lemma}
\label{lemma-vasconcelos}
\begin{reference}
Local version of \cite[Theorem 1.1]{Vasconcelos}
\end{reference}
Let $R$ be a Noetherian local ring. Let $I \subset R$ be an ideal
of finite projective dimension over $R$. If $F \subset I/I^2$
is a direct summand free of rank $r$, then there exists a regular sequence
$x_1, \ldots, x_r \in I$ such that $x_1 \bmod I^2, \ldots, x_r \bmod I^2$
generate $F$.
\end{lemma}

\begin{proof}
If $r = 0$ there is nothing to prove. Assume $r > 0$. We may pick
$x \in I$ such that $x$ is a nonzerodivisor and $x \bmod I^2$
generates a summand of $F$ isomorphic to $R/I$, see
Lemma \ref{lemma-free-summand-in-ideal-finite-proj-dim}.
Consider the ring $R' = R/(x)$ and the ideal $I' = I/(x)$.
Of course $R'/I' = R/I$. The short exact sequence
$$
0 \to R/I \xrightarrow{x} I/xI \to I' \to 0
$$
splits because the map $I/xI \to I/I^2$ sends $xR/xI$
to a direct summand. Now $I/xI = I \otimes_R^\mathbf{L} R'$ has
finite projective dimension over $R'$, see
More on Algebra, Lemmas \ref{more-algebra-lemma-perfect-module} and
\ref{more-algebra-lemma-pull-perfect}.
Hence the summand $I'$ has finite projective dimension over $R'$.
On the other hand, we have the short exact sequence
$0 \to xR/xI \to I/I^2 \to I'/(I')^2 \to 0$ and we conclude
$I'/(I')^2$ has the free direct summand $F' = F/(R/I \cdot x)$
of rank $r - 1$. By induction on $r$ we may
we pick a regular sequence $x'_2, \ldots, x'_r \in I'$
such that there congruence classes freely generate $F'$.
If $x_1 = x$ and $x_2, \ldots, x_r$ are any elements lifting
$x'_1, \ldots, x'_r$ in $R$, then we see that the lemma holds.
\end{proof}

\begin{proposition}
\label{proposition-regular-ideal}
\begin{reference}
Variant of \cite[Corollary 1]{Vasconcelos}. See also
\cite{Iyengar} and \cite{Ferrand-lci}.
\end{reference}
Let $R$ be a Noetherian ring. Let $I \subset R$ be an ideal
which has finite projective dimension and such that $I/I^2$ is
finite locally free over $R/I$. Then $I$ is a regular ideal
(More on Algebra, Definition \ref{more-algebra-definition-regular-ideal}).
\end{proposition}

\begin{proof}
By Algebra, Lemma \ref{algebra-lemma-regular-sequence-in-neighbourhood}
it suffices to show that $I_\mathfrak p \subset R_\mathfrak p$ is generated
by a regular sequence for every $\mathfrak p \supset I$. Thus we may
assume $R$ is local. If $I/I^2$ has rank $r$, then by
Lemma \ref{lemma-vasconcelos} we find a regular sequence
$x_1, \ldots, x_r \in I$ generating $I/I^2$. By
Nakayama (Algebra, Lemma \ref{algebra-lemma-NAK})
we conclude that $I$ is generated by $x_1, \ldots, x_r$.
\end{proof}

\noindent
For any local complete intersection homomorphism $A \to B$
of rings, the naive cotangent complex $\NL_{B/A}$ is perfect
of tor-amplitude in $[-1, 0]$, see
More on Algebra, Lemma \ref{more-algebra-lemma-lci-NL}.
Using the above, we can show that this sometimes
characterizes local complete intersection homomorphisms.

\begin{lemma}
\label{lemma-perfect-NL-lci}
Let $A \to B$ be a perfect (More on Algebra, Definition
\ref{more-algebra-definition-pseudo-coherent-perfect})
ring homomorphism of Noetherian rings. Then the following are equivalent
\begin{enumerate}
\item $\NL_{B/A}$ has tor-amplitude in $[-1, 0]$,
\item $\NL_{B/A}$ is a perfect object of $D(B)$
with tor-amplitude in $[-1, 0]$, and
\item $A \to B$ is a local complete intersection
(More on Algebra, Definition
\ref{more-algebra-definition-local-complete-intersection}).
\end{enumerate}
\end{lemma}

\begin{proof}
Write $B = A[x_1, \ldots, x_n]/I$. Then $\NL_{B/A}$ is represented by
the complex
$$
I/I^2 \longrightarrow \bigoplus B \text{d}x_i
$$
of $B$-modules with $I/I^2$ placed in degree $-1$. Since the term in
degree $0$ is finite free, this complex has tor-amplitude in $[-1, 0]$ if and
only if $I/I^2$ is a flat $B$-module, see
More on Algebra, Lemma \ref{more-algebra-lemma-last-one-flat}.
Since $I/I^2$ is a finite $B$-module and $B$ is Noetherian, this is true
if and only if $I/I^2$ is a finite locally free $B$-module
(Algebra, Lemma \ref{algebra-lemma-finite-projective}).
Thus the equivalence of (1) and (2) is clear. Moreover, the equivalence
of (1) and (3) also follows if we apply
Proposition \ref{proposition-regular-ideal}
(and the observation that a regular ideal is a Koszul regular
ideal as well as a quasi-regular ideal, see
More on Algebra, Section \ref{more-algebra-section-ideals}).
\end{proof}

\begin{lemma}
\label{lemma-flat-fp-NL-lci}
Let $A \to B$ be a flat ring map of finite presentation.
Then the following are equivalent
\begin{enumerate}
\item $\NL_{B/A}$ has tor-amplitude in $[-1, 0]$,
\item $\NL_{B/A}$ is a perfect object of $D(B)$
with tor-amplitude in $[-1, 0]$,
\item $A \to B$ is syntomic
(Algebra, Definition \ref{algebra-definition-lci}), and
\item $A \to B$ is a local complete intersection
(More on Algebra, Definition
\ref{more-algebra-definition-local-complete-intersection}).
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (3) and (4) is More on Algebra, Lemma
\ref{more-algebra-lemma-syntomic-lci}.

\medskip\noindent
If $A \to B$ is syntomic, then we can find a cocartesian diagram
$$
\xymatrix{
B_0 \ar[r] & B \\
A_0 \ar[r] \ar[u] & A \ar[u]
}
$$
such that $A_0 \to B_0$ is syntomic and $A_0$ is Noetherian, see
Algebra, Lemmas \ref{algebra-lemma-limit-module-finite-presentation} and
\ref{algebra-lemma-colimit-lci}. By Lemma \ref{lemma-perfect-NL-lci}
we see that $\NL_{B_0/A_0}$ is perfect of tor-amplitude in $[-1, 0]$.
By More on Algebra, Lemma \ref{more-algebra-lemma-base-change-NL-flat}
we conclude the same thing is true for
$\NL_{B/A} = \NL_{B_0/A_0} \otimes_{B_0}^\mathbf{L} B$ (see
also More on Algebra, Lemmas \ref{more-algebra-lemma-pull-tor-amplitude} and
\ref{more-algebra-lemma-pull-perfect}).
This proves that (3) implies (2).

\medskip\noindent
Assume (1). By More on Algebra, Lemma
\ref{more-algebra-lemma-base-change-NL-flat}
for every ring map $A \to k$ where
$k$ is a field, we see that $\NL_{B \otimes_A k/k}$ has
tor-amplitude in $[-1, 0]$ (see
More on Algebra, Lemma \ref{more-algebra-lemma-pull-tor-amplitude}).
Hence by Lemma \ref{lemma-perfect-NL-lci} we see that $k \to B \otimes_A k$ is
a local complete intersection homomorphism. Thus $A \to B$
is syntomic by definition. This proves (1) implies (3)
and finishes the proof.
\end{proof}








\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
