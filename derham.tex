\input{preamble}

% OK, start here
%
\begin{document}

\title{de Rham Cohomology}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we start with a discussion of the de Rham complex
of a morphism of schemes and we end with a proof that de Rham cohomology
defines a Weil cohomology theory when the base field has characteristic zero.




\section{The de Rham complex}
\label{section-de-rham-complex}

\noindent
Let $p : X \to S$ be a morphism of schemes. There is a complex
$$
\Omega^\bullet_{X/S} =
\mathcal{O}_{X/S} \to \Omega^1_{X/S} \to \Omega^2_{X/S} \to \ldots
$$
of $p^{-1}\mathcal{O}_S$-modules with
$\Omega^i_{X/S} = \wedge^i(\Omega_{X/S})$
placed in degree $i$ and differential determined by the rule
$\text{d}(g_0 \text{d}g_1 \wedge \ldots \wedge \text{d}g_p) =
\text{d}g_0 \wedge \text{d}g_1 \wedge \ldots \wedge \text{d}g_p$
on local sections.
See Modules, Section \ref{modules-section-de-rham-complex}.

\medskip\noindent
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes, there are canonical maps of complexes
$f^{-1}\Omega_{X/S}^\bullet \to \Omega^\bullet_{X'/S'}$ and
$\Omega_{X/S}^\bullet \to f_*\Omega^\bullet_{X'/S'}$.
See Modules, Section \ref{modules-section-de-rham-complex}.
Linearizing, for every $p$ we obtain a linear map
$f^*\Omega^p_{X/S} \to \Omega^p_{X'/S'}$.

\medskip\noindent
In particular, if $f : Y \to X$ be a morphism of schemes over
a base scheme $S$, then there is a map of complexes
$$
\Omega^\bullet_{X/S} \longrightarrow f_*\Omega^\bullet_{Y/S}
$$
Linearizing, we see that for every $p \geq 0$ we obtain a canonical map
$$
\Omega^p_{X/S} \otimes_{\mathcal{O}_X} f_*\mathcal{O}_Y
\longrightarrow
f_*\Omega^p_{Y/S}
$$

\begin{lemma}
\label{lemma-base-change-de-rham}
Let
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
be a cartesian diagram of schemes. Then the maps discussed
above induce isomorphisms
$f^*\Omega^p_{X/S} \to \Omega^p_{X'/S'}$.
\end{lemma}

\begin{proof}
Combine Morphisms, Lemma \ref{morphisms-lemma-base-change-differentials}
with the fact that formation of exterior power commutes with base change.
\end{proof}

\begin{lemma}
\label{lemma-etale}
Consider a commutative diagram of schemes
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
If $X' \to X$ and $S' \to S$ are \'etale, then the maps discussed
above induce isomorphisms
$f^*\Omega^p_{X/S} \to \Omega^p_{X'/S'}$.
\end{lemma}

\begin{proof}
We have $\Omega_{S'/S} = 0$ and $\Omega_{X'/X} = 0$, see for example
Morphisms, Lemma \ref{morphisms-lemma-etale-at-point}. Then by
the short exact sequences of Morphisms, Lemmas
\ref{morphisms-lemma-triangle-differentials} and
\ref{morphisms-lemma-triangle-differentials-smooth}
we see that $\Omega_{X'/S'} = \Omega_{X'/S} = f^*\Omega_{X/S}$.
Taking exterior powers we conclude.
\end{proof}






\section{de Rham cohomology}
\label{section-de-rham-cohomology}

\noindent
Let $p : X \to S$ be a morphism of schemes. We define the
{\it de Rham cohomology of $X$ over $S$} to be the cohomology
groups
$$
H^i_{dR}(X/S) = H^i(R\Gamma(X, \Omega^\bullet_{X/S}))
$$
Since $\Omega^\bullet_{X/S}$ is a complex of $p^{-1}\mathcal{O}_S$-modules,
these cohomology groups are naturally modules over $H^0(S, \mathcal{O}_S)$.

\medskip\noindent
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes, using the canonical maps of Section \ref{section-de-rham-complex}
we obtain pullback maps
$$
f^* :
R\Gamma(X, \Omega^\bullet_{X/S})
\longrightarrow
R\Gamma(X', \Omega^\bullet_{X'/S'})
$$
and
$$
f^* : H^i_{dR}(X/S) \longrightarrow H^i_{dR}(X'/S')
$$
These pullbacks satisfy an obvious composition law.
In particular, if we work over a fixed base scheme $S$, then de Rham
cohomology is a contravariant functor on the category of schemes over $S$.

\begin{lemma}
\label{lemma-de-rham-affine}
Let $X \to S$ be a morphism of affine schemes given by the ring map
$R \to A$. Then $R\Gamma(X, \Omega^\bullet_{X/S}) = \Omega^\bullet_{A/R}$
in $D(R)$ and $H^i_{dR}(X/S) = H^i(\Omega^\bullet_{A/R})$.
\end{lemma}

\begin{proof}
This follows from Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherent-affine-cohomology-zero}
and Leray's acyclicity lemma
(Derived Categories, Lemma \ref{derived-lemma-leray-acyclicity}).
\end{proof}

\begin{lemma}
\label{lemma-quasi-coherence-relative}
Let $p : X \to S$ be a morphism of schemes. If $p$ is quasi-compact
and quasi-separated, then $Rp_*\Omega^\bullet_{X/S}$ is an object
of $D_\QCoh(\mathcal{O}_S)$.
\end{lemma}

\begin{proof}
There is a spectral sequence with first page
$E_1^{a, b} = R^bp_*\Omega^a_{X/S}$ converging to
the cohomology of $Rp_*\Omega^\bullet_{X/S}$
(see Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor}).
Hence by Homology, Lemma \ref{homology-lemma-first-quadrant-ss}
it suffices to show that $R^bp_*\Omega^a_{X/S}$ is quasi-coherent.
This follows from Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherence-higher-direct-images}.
\end{proof}

\begin{lemma}
\label{lemma-coherence-relative}
Let $p : X \to S$ be a proper morphism of schemes with $S$ locally
Noetherian. Then $Rp_*\Omega^\bullet_{X/S}$ is an object
of $D_{\textit{Coh}}(\mathcal{O}_S)$.
\end{lemma}

\begin{proof}
In this case by Morphisms, Lemma \ref{morphisms-lemma-finite-type-differentials}
the modules $\Omega^i_{X/S}$ are coherent. Hence we can use exactly the
same argument as in the proof of Lemma \ref{lemma-quasi-coherence-relative}
using Cohomology of Schemes, Proposition
\ref{coherent-proposition-proper-pushforward-coherent}.
\end{proof}

\begin{lemma}
\label{lemma-finite-de-Rham}
Let $A$ be a Noetherian ring. Let $X$ be a proper scheme over $S = \Spec(A)$.
Then $H^i_{dR}(X/S)$ is a finite $A$-module for all $i$.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-coherence-relative}.
\end{proof}

\begin{lemma}
\label{lemma-proper-smooth-de-Rham}
Let $f : X \to S$ be a proper smooth morphism of schemes. Then
$Rf_*\Omega^p_{X/S}$, $p \geq 0$ and $Rf_*\Omega^\bullet_{X/S}$ are
perfect objects of $D(\mathcal{O}_S)$ whose formation commutes
with arbitrary change of base.
\end{lemma}

\begin{proof}
Since $f$ is smooth the modules $\Omega^p_{X/S}$ are finite locally
free $\mathcal{O}_X$-modules, see Morphisms, Lemma
\ref{morphisms-lemma-smooth-omega-finite-locally-free}. Their
formation commutes with arbitrary change of base by
Lemma \ref{lemma-base-change-de-rham}. Hence
$Rf_*\Omega^p_{X/S}$ is a perfect object of $D(\mathcal{O}_S)$
whose formation commutes with arbitrary base change, see
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-flat-proper-perfect-direct-image-general}.
This proves the first assertion of the lemma.

\medskip\noindent
To prove that $Rf_*\Omega^\bullet_{X/S}$ is perfect on $S$ we may work
locally on $S$. Thus we may assume $S$ is quasi-compact. This means
we may assume that $\Omega^n_{X/S}$ is zero for $n$ large enough.
For every $p \geq 0$ we claim that
$Rf_*\sigma_{\geq p}\Omega^\bullet_{X/S}$ is a
perfect object of $D(\mathcal{O}_S)$ whose formation commutes
with arbitrary change of base. By the above we see that
this is true for $p \gg 0$. Suppose the claim holds for $p$
and consider the distinguished triangle
$$
\sigma_{\geq p}\Omega^\bullet_{X/S} \to
\sigma_{\geq p - 1}\Omega^\bullet_{X/S} \to
\Omega^{p - 1}_{X/S}[-(p - 1)] \to
(\sigma_{\geq p}\Omega^\bullet_{X/S})[1]
$$
in $D(f^{-1}\mathcal{O}_S)$.
Applying the exact functor $Rf_*$ we obtain a distinguished triangle
in $D(\mathcal{O}_S)$.
Since we have the 2-out-of-3 property for being perfect
(Cohomology, Lemma \ref{cohomology-lemma-two-out-of-three-perfect})
we conclude $Rf_*\sigma_{\geq p - 1}\Omega^\bullet_{X/S}$ is a
perfect object of $D(\mathcal{O}_S)$. Similarly for the
commutation with arbitrary base change.
\end{proof}





\section{Cup product}
\label{section-cup-product}

\noindent
Consider the maps
$\Omega^p_{X/S} \times \Omega^q_{X/S} \to \Omega^{p + q}_{X/S}$
given by $(\omega , \eta) \longmapsto \omega \wedge \eta$.
Using the formula for $\text{d}$ given in Section \ref{section-de-rham-complex}
and the Leibniz rule for $\text{d} : \mathcal{O}_X \to \Omega_{X/S}$
we see that $\text{d}(\omega \wedge \eta) = \text{d}(\omega) \wedge \eta +
(-1)^{\deg(\omega)} \omega \wedge \text{d}(\eta)$. This means that
$\wedge$ defines a morphism
\begin{equation}
\label{equation-wedge}
\wedge :
\text{Tot}(
\Omega^\bullet_{X/S} \otimes_{p^{-1}\mathcal{O}_S} \Omega^\bullet_{X/S})
\longrightarrow
\Omega^\bullet_{X/S}
\end{equation}
of complexes of $p^{-1}\mathcal{O}_S$-modules.

\medskip\noindent
Combining the cup product of
Cohomology, Section \ref{cohomology-section-cup-product}
with (\ref{equation-wedge}) we find a
$H^0(S, \mathcal{O}_S)$-bilinear cup product map
$$
\cup : H^i_{dR}(X/S) \times H^j_{dR}(X/S) \longrightarrow H^{i + j}_{dR}(X/S)
$$
For example, if $\omega \in \Gamma(X, \Omega^i_{X/S})$ and
$\eta \in \Gamma(X, \Omega^j_{X/S})$ are closed, then
the cup product of the de Rham cohomology classes of
$\omega$ and $\eta$ is the de Rham cohomology class of $\omega \wedge \eta$,
see discussion in Cohomology, Section \ref{cohomology-section-cup-product}.

\medskip\noindent
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes, the pullback maps
$f^* : R\Gamma(X, \Omega^\bullet_{X/S}) \to R\Gamma(X', \Omega^\bullet_{X'/S'})$
and
$f^* : H^i_{dR}(X/S) \longrightarrow H^i_{dR}(X'/S')$
are compatible with the cup product defined above.

\begin{lemma}
\label{lemma-cup-product-graded-commutative}
Let $p : X \to S$ be a morphism of schemes.
The cup product on $H^*_{dR}(X/S)$ is associative and
graded commutative.
\end{lemma}

\begin{proof}
This follows from
Cohomology, Lemmas \ref{cohomology-lemma-cup-product-associative} and
\ref{cohomology-lemma-cup-product-commutative}
and the fact that $\wedge$ is associative and graded commutative.
\end{proof}

\begin{remark}
\label{remark-relative-cup-product}
Let $p : X \to S$ be a morphism of schemes. Then we can think of
$\Omega^\bullet_{X/S}$ as a sheaf of differential graded
$p^{-1}\mathcal{O}_S$-algebras, see
Differential Graded Sheaves, Definition \ref{sdga-definition-dga}.
In particular, the discussion in
Differential Graded Sheaves, Section \ref{sdga-section-misc}
applies. For example, this means that for any commutative diagram
$$
\xymatrix{
X \ar[d]_p \ar[r]_f & Y \ar[d]^q \\
S \ar[r]^h & T
}
$$
of schemes there is a canonical relative cup product
$$
\mu :
Rf_*\Omega^\bullet_{X/S}
\otimes_{q^{-1}\mathcal{O}_T}^\mathbf{L}
Rf_*\Omega^\bullet_{X/S}
\longrightarrow
Rf_*\Omega^\bullet_{X/S}
$$
in $D(Y, q^{-1}\mathcal{O}_T)$ which is associative and
which on cohomology reproduces the cup product discussed above.
\end{remark}

\begin{remark}
\label{remark-cup-product-as-a-map}
Let $f : X \to S$ be a morphism of schemes. Let $\xi \in H_{dR}^n(X/S)$.
According to the discussion
Differential Graded Sheaves, Section \ref{sdga-section-misc}
there exists a canonical morphism
$$
\xi' : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[n]
$$
in $D(f^{-1}\mathcal{O}_S)$ uniquely characterized by
(1) and (2) of the following list of properties:
\begin{enumerate}
\item $\xi'$ can be lifted to a map in the derived category of right
differential graded $\Omega^\bullet_{X/S}$-modules, and
\item $\xi'(1) = \xi$ in
$H^0(X, \Omega^\bullet_{X/S}[n]) = H^n_{dR}(X/S)$,
\item the map $\xi'$ sends $\eta \in H^m_{dR}(X/S)$
to $\xi \cup \eta$ in $H^{n + m}_{dR}(X/S)$,
\item the construction of $\xi'$ commutes with restrictions to
opens: for $U \subset X$ open the restriction $\xi'|_U$ is
the map corresponding to the image $\xi|_U \in H^n_{dR}(U/S)$,
\item for any diagram as in Remark \ref{remark-relative-cup-product}
we obtain a commutative diagram
$$
\xymatrix{
Rf_*\Omega^\bullet_{X/S}
\otimes_{q^{-1}\mathcal{O}_T}^\mathbf{L}
Rf_*\Omega^\bullet_{X/S} \ar[d]_{\xi' \otimes \text{id}}
\ar[r]_-\mu &
Rf_*\Omega^\bullet_{X/S} \ar[d]^{\xi'} \\
Rf_*\Omega^\bullet_{X/S}[n]
\otimes_{q^{-1}\mathcal{O}_T}^\mathbf{L}
Rf_*\Omega^\bullet_{X/S}
\ar[r]^-\mu &
Rf_*\Omega^\bullet_{X/S}[n]
}
$$
in $D(Y, q^{-1}\mathcal{O}_T)$.
\end{enumerate}
\end{remark}




\section{Hodge cohomology}
\label{section-hodge-cohomology}

\noindent
Let $p : X \to S$ be a morphism of schemes. We define the
{\it Hodge cohomology of $X$ over $S$} to be the cohomology groups
$$
H^n_{Hodge}(X/S) = \bigoplus\nolimits_{n = p + q} H^q(X, \Omega^p_{X/S})
$$
viewed as a graded $H^0(X, \mathcal{O}_X)$-module. The wedge product
of forms combined with the cup product of
Cohomology, Section \ref{cohomology-section-cup-product}
defines a $H^0(X, \mathcal{O}_X)$-bilinear cup product
$$
\cup :
H^i_{Hodge}(X/S) \times H^j_{Hodge}(X/S)
\longrightarrow
H^{i + j}_{Hodge}(X/S)
$$
Of course if  $\xi \in H^q(X, \Omega^p_{X/S})$ and
$\xi' \in H^{q'}(X, \Omega^{p'}_{X/S})$ then $\xi \cup \xi' \in
H^{q + q'}(X, \Omega^{p + p'}_{X/S})$.

\begin{lemma}
\label{lemma-cup-product-hodge-graded-commutative}
Let $p : X \to S$ be a morphism of schemes.
The cup product on $H^*_{Hodge}(X/S)$ is associative and graded commutative.
\end{lemma}

\begin{proof}
The proof is identical to the proof of
Lemma \ref{lemma-cup-product-graded-commutative}.
\end{proof}

\noindent
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes, there are pullback maps
$f^* : H^i_{Hodge}(X/S) \longrightarrow H^i_{Hodge}(X'/S')$
compatible with gradings and with the cup product defined above.







\section{Two spectral sequences}
\label{section-hodge-to-de-rham}

\noindent
Let $p : X \to S$ be a morphism of schemes. Since the category
of $p^{-1}\mathcal{O}_S$-modules on $X$ has enough injectives
there exist a Cartan-Eilenberg resolution for $\Omega^\bullet_{X/S}$.
See Derived Categories, Lemma \ref{derived-lemma-cartan-eilenberg}.
Hence we can apply Derived Categories, Lemma
\ref{derived-lemma-two-ss-complex-functor} to get two spectral sequences
both converging to the de Rham cohomology of $X$ over $S$.

\medskip\noindent
The first is customarily called {\it the Hodge-to-de Rham spectral sequence}.
The first page of this spectral sequence has
$$
E_1^{p, q} = H^q(X, \Omega^p_{X/S})
$$
which are the Hodge cohomology groups of $X/S$ (whence the name). The
differential $d_1$ on this page is given by the maps
$d_1^{p, q} : H^q(X, \Omega^p_{X/S}) \to H^q(X. \Omega^{p + 1}_{X/S})$
induced by the differential
$\text{d} : \Omega^p_{X/S} \to \Omega^{p + 1}_{X/S}$.
Here is a picture
$$
\xymatrix{
H^2(X, \mathcal{O}_X) \ar[r] \ar@{-->}[rrd] \ar@{..>}[rrrdd] &
H^2(X, \Omega^1_{X/S}) \ar[r] \ar@{-->}[rrd] &
H^2(X, \Omega^2_{X/S}) \ar[r] &
H^2(X, \Omega^3_{X/S}) \\
H^1(X, \mathcal{O}_X) \ar[r] \ar@{-->}[rrd] &
H^1(X, \Omega^1_{X/S}) \ar[r] \ar@{-->}[rrd] &
H^1(X, \Omega^2_{X/S}) \ar[r] &
H^1(X, \Omega^3_{X/S}) \\
H^0(X, \mathcal{O}_X) \ar[r] &
H^0(X, \Omega^1_{X/S}) \ar[r] &
H^0(X, \Omega^2_{X/S}) \ar[r] &
H^0(X, \Omega^3_{X/S})
}
$$
where we have drawn striped arrows to indicate the source and target of
the differentials on the $E_2$ page and a dotted arrow for a differential
on the $E_3$ page. Looking in degree $0$ we conclude that
$$
H^0_{dR}(X/S) =
\Ker(\text{d} : H^0(X, \mathcal{O}_X) \to H^0(X, \Omega^1_{X/S}))
$$
Of course, this is also immediately clear from the fact that the
de Rham complex starts in degree $0$ with $\mathcal{O}_X \to \Omega^1_{X/S}$.

\medskip\noindent
The second spectral sequence is usually called
{\it the conjugate spectral sequence}. The second page of this
spectral sequence has
$$
E_2^{p, q} = H^p(X, H^q(\Omega^\bullet_{X/S})) = H^p(X, \mathcal{H}^q)
$$
where $\mathcal{H}^q = H^q(\Omega^\bullet_{X/S})$ is the $q$th
cohomology sheaf of the de Rham complex of $X/S$. The differentials
on this page are given by $E_2^{p, q} \to E_2^{p + 2, q - 1}$.
Here is a picture
$$
\xymatrix{
H^0(X, \mathcal{H}^2) \ar[rrd] \ar@{..>}[rrrdd] &
H^1(X, \mathcal{H}^2) \ar[rrd] &
H^2(X, \mathcal{H}^2) &
H^3(X, \mathcal{H}^2) \\
H^0(X, \mathcal{H}^1) \ar[rrd] &
H^1(X, \mathcal{H}^1) \ar[rrd] &
H^2(X, \mathcal{H}^1) &
H^3(X, \mathcal{H}^1) \\
H^0(X, \mathcal{H}^0) &
H^1(X, \mathcal{H}^0) &
H^2(X, \mathcal{H}^0) &
H^3(X, \mathcal{H}^0)
}
$$
Looking in degree $0$ we conclude that
$$
H^0_{dR}(X/S) = H^0(X, \mathcal{H}^0)
$$
which is obvious if you think about it. In degree $1$ we get an exact sequence
$$
0 \to H^1(X, \mathcal{H}^0) \to H^1_{dR}(X/S) \to
H^0(X, \mathcal{H}^1) \to H^2(X, \mathcal{H}^0) \to H^2_{dR}(X/S)
$$
It turns out that if $X \to S$ is smooth and $S$ lives in characteristic $p$,
then the sheaves $\mathcal{H}^q$ are computable (in terms of a certain
sheaves of differentials) and the conjugate spectral sequence is a valuable
tool (insert future reference here).



\section{The Hodge filtration}
\label{section-hodge-filtration}

\noindent
Let $X \to S$ be a morphism of schemes. The Hodge filtration on $H^n_{dR}(X/S)$
is the filtration induced by the Hodge-to-de Rham spectral sequence
(Homology, Definition
\ref{homology-definition-filtration-cohomology-filtered-complex}).
To avoid misunderstanding, we explicitly define it as follows.

\begin{definition}
\label{definition-hodge-filtration}
Let $X \to S$ be a morphism of schemes. The {\it Hodge filtration}
on $H^n_{dR}(X/S)$ is the filtration with terms
$$
F^pH^n_{dR}(X/S) = \Im\left(H^n(X, \sigma_{\geq p}\Omega^\bullet_{X/S})
\longrightarrow H^n_{dR}(X/S)\right)
$$
where $\sigma_{\geq p}\Omega^\bullet_{X/S}$ is as in
Homology, Section \ref{homology-section-truncations}.
\end{definition}

\noindent
Of course $\sigma_{\geq p}\Omega^\bullet_{X/S}$ is a subcomplex of
the relative de Rham complex and we obtain a filtration
$$
\Omega^\bullet_{X/S} = \sigma_{\geq 0}\Omega^\bullet_{X/S} \supset
\sigma_{\geq 1}\Omega^\bullet_{X/S} \supset
\sigma_{\geq 2}\Omega^\bullet_{X/S} \supset
\sigma_{\geq 3}\Omega^\bullet_{X/S} \supset \ldots
$$
of the relative de Rham complex with
$\text{gr}^p(\Omega^\bullet_{X/S}) = \Omega^p_{X/S}[-p]$.
The spectral sequence constructed in
Cohomology, Lemma \ref{cohomology-lemma-spectral-sequence-filtered-object}
for $\Omega^\bullet_{X/S}$ viewed as a filtered complex of sheaves
is the same as the Hodge-to-de Rham spectral sequence constructed in
Section \ref{section-hodge-to-de-rham} by
Cohomology, Example \ref{cohomology-example-spectral-sequence-bis}. Further the
wedge product (\ref{equation-wedge}) sends
$\text{Tot}(\sigma_{\geq i}\Omega^\bullet_{X/S} \otimes_{p^{-1}\mathcal{O}_S}
\sigma_{\geq j}\Omega^\bullet_{X/S})$ into
$\sigma_{\geq i + j}\Omega^\bullet_{X/S}$. Hence we get
commutative diagrams
$$
\xymatrix{
H^n(X, \sigma_{\geq i}\Omega^\bullet_{X/S}))
\times 
H^m(X, \sigma_{\geq j}\Omega^\bullet_{X/S}))
\ar[r] \ar[d] &
H^{n + m}(X, \sigma_{\geq i + j}\Omega^\bullet_{X/S})) \ar[d] \\
H^n_{dR}(X/S) \times
H^m_{dR}(X/S)
\ar[r]^\cup &
H^{n + m}_{dR}(X/S)
}
$$
In particular we find that
$$
F^iH^n_{dR}(X/S) \cup F^jH^m_{dR}(X/S) \subset F^{i + j}H^{n + m}_{dR}(X/S)
$$






\section{K\"unneth formula}
\label{section-kunneth}

\noindent
An important feature of de Rham cohomology is that there is a
K\"unneth formula.

\medskip\noindent
Let $a : X \to S$ and $b : Y \to S$ be morphisms of schemes with the same
target. Let $p : X \times_S Y \to X$ and $q : X \times_S Y \to Y$ be the
projection morphisms and $f = a \circ p = b \circ q$. Here is a picture
$$
\xymatrix{
& X \times_S Y \ar[ld]^p \ar[rd]_q \ar[dd]^f \\
X \ar[rd]_a & & Y \ar[ld]^b \\
& S
}
$$
In this section, given an $\mathcal{O}_X$-module $\mathcal{F}$
and an $\mathcal{O}_Y$-module $\mathcal{G}$ let us set
$$
\mathcal{F} \boxtimes \mathcal{G} =
p^*\mathcal{F} \otimes_{\mathcal{O}_{X \times_S Y}} q^*\mathcal{G}
$$
The bifunctor
$(\mathcal{F}, \mathcal{G}) \mapsto \mathcal{F} \boxtimes \mathcal{G}$
on quasi-coherent modules extends to a bifunctor on quasi-coherent modules
and differential operators of finite over over $S$, see
Morphisms, Remark \ref{morphisms-remark-base-change-differential-operators}.
The differentials of the de Rham complexes $\Omega^\bullet_{X/S}$ and
$\Omega^\bullet_{Y/S}$ are differential operators of order $1$
over $S$ by Modules, Lemma
\ref{modules-lemma-differentials-relative-de-rham-complex-order-1}.
Thus it makes sense to consider the complex
$$
\text{Tot}(\Omega^\bullet_{X/S} \boxtimes \Omega^\bullet_{Y/S})
$$
Please see the discussion in Derived Categories of Schemes, Section
\ref{perfect-section-kunneth-complexes}.

\begin{lemma}
\label{lemma-de-rham-complex-product}
In the situation above there is a canonical isomorphism
$$
\text{Tot}(\Omega^\bullet_{X/S} \boxtimes \Omega^\bullet_{Y/S})
\longrightarrow
\Omega^\bullet_{X \times_S Y/S}
$$
of complexes of $f^{-1}\mathcal{O}_S$-modules.
\end{lemma}

\begin{proof}
We know that
$
\Omega_{X \times_S Y/S} = p^*\Omega_{X/S} \oplus q^*\Omega_{Y/S}
$
by Morphisms, Lemma \ref{morphisms-lemma-differential-product}.
Taking exterior powers we obtain
$$
\Omega^n_{X \times_S Y/S} =
\bigoplus\nolimits_{i + j = n}
p^*\Omega^i_{X/S} \otimes_{\mathcal{O}_{X \times_S Y}} q^*\Omega^j_{Y/S} =
\bigoplus\nolimits_{i + j = n}
\Omega^i_{X/S} \boxtimes \Omega^j_{Y/S}
$$
by elementary properties of exterior powers. These identifications determine
isomorphisms between the terms of the complexes on the left and the right
of the arrow in the lemma. We omit the verification that these maps
are compatible with differentials.
\end{proof}

\noindent
Set $A = \Gamma(S, \mathcal{O}_S)$. Combining the result of
Lemma \ref{lemma-de-rham-complex-product} with the map
Derived Categories of Schemes, Equation
(\ref{perfect-equation-de-rham-kunneth})
we obtain a cup product
$$
R\Gamma(X, \Omega^\bullet_{X/S})
\otimes_A^\mathbf{L}
R\Gamma(Y, \Omega^\bullet_{Y/S})
\longrightarrow
R\Gamma(X \times_S Y, \Omega^\bullet_{X \times_S Y/S})
$$
On the level of cohomology, using the discussion in
More on Algebra, Section \ref{more-algebra-section-products-tor},
we obtain a canonical map
$$
H^i_{dR}(X/S) \otimes_A H^j_{dR}(Y/S)
\longrightarrow
H^{i + j}_{dR}(X \times_S Y/S),\quad
(\xi, \zeta) \longmapsto p^*\xi \cup q^*\zeta
$$
We note that the construction above indeed proceeds by
first pulling back and then taking the cup product.

\begin{lemma}
\label{lemma-kunneth-de-rham}
Assume $X$ and $Y$ are smooth, quasi-compact, with affine diagonal over
$S = \Spec(A)$. Then the map
$$
R\Gamma(X, \Omega^\bullet_{X/S})
\otimes_A^\mathbf{L}
R\Gamma(Y, \Omega^\bullet_{Y/S})
\longrightarrow
R\Gamma(X \times_S Y, \Omega^\bullet_{X \times_S Y/S})
$$
is an isomorphism in $D(A)$.
\end{lemma}

\begin{proof}
By Morphisms, Lemma \ref{morphisms-lemma-smooth-omega-finite-locally-free}
the sheaves $\Omega^n_{X/S}$ and $\Omega^m_{Y/S}$ are finite locally free
$\mathcal{O}_X$ and $\mathcal{O}_Y$-modules. On the other hand, $X$ and $Y$
are flat over $S$ (Morphisms, Lemma \ref{morphisms-lemma-smooth-flat})
and hence we find that $\Omega^n_{X/S}$ and $\Omega^m_{Y/S}$ are flat over $S$.
Also, observe that $\Omega^\bullet_{X/S}$ is a locally bounded. Thus
the result by Lemma \ref{lemma-de-rham-complex-product} and
Derived Categories of Schemes, Lemma \ref{perfect-lemma-kunneth-special}.
\end{proof}

\noindent
There is a relative version of the cup product, namely a map
$$
Ra_*\Omega^\bullet_{X/S}
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rb_*\Omega^\bullet_{Y/S}
\longrightarrow
Rf_*\Omega^\bullet_{X \times_S Y/S}
$$
in $D(\mathcal{O}_S)$. The construction combines
Lemma \ref{lemma-de-rham-complex-product} with the map
Derived Categories of Schemes, Equation
(\ref{perfect-equation-relative-de-rham-kunneth}).
The construction shows that this map is given by the diagram
$$
\xymatrix{
Ra_*\Omega^\bullet_{X/S}
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rb_*\Omega^\bullet_{Y/S}
\ar[d]^{\text{units of adjunction}}  \\
Rf_*(p^{-1}\Omega^\bullet_{X/S})
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rf_*(q^{-1}\Omega^\bullet_{Y/S}) \ar[r] \ar[d]^{\text{relative cup product}} &
Rf_*(\Omega^\bullet_{X \times_S Y/S})
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rf_*(\Omega^\bullet_{X \times_S Y/S}) \ar[d]^{\text{relative cup product}} \\
Rf_*(p^{-1}\Omega^\bullet_{X/S}
\otimes_{f^{-1}\mathcal{O}_S}^\mathbf{L}
q^{-1}\Omega^\bullet_{Y/S})
\ar[d]^{\text{from derived to usual}} \ar[r] &
Rf_*(\Omega^\bullet_{X \times_S Y/S}
\otimes_{f^{-1}\mathcal{O}_S}^\mathbf{L}
\Omega^\bullet_{X \times_S Y/S})
\ar[d]^{\text{from derived to usual}} \\
Rf_*\text{Tot}(p^{-1}\Omega^\bullet_{X/S}
\otimes_{f^{-1}\mathcal{O}_S}
q^{-1}\Omega^\bullet_{Y/S}) \ar[r] \ar[d]^{\text{canonical map}} &
Rf_*\text{Tot}(\Omega^\bullet_{X \times_S Y/S}
\otimes_{f^{-1}\mathcal{O}_S}
\Omega^\bullet_{X \times_S Y/S})
\ar[d]^{\eta \otimes \omega \mapsto \eta \wedge \omega} \\
Rf_*\text{Tot}(\Omega^\bullet_{X/S} \boxtimes \Omega^\bullet_{Y/S})
\ar@{=}[r]
&
Rf_*\Omega^\bullet_{X \times_S Y/S}
}
$$
Here the first arrow uses the units $\text{id} \to Rp_* p^{-1}$
and $\text{id} \to Rq_* q^{-1}$ of adjunction as well as the
identifications $Rf_* p^{-1} = Ra_* Rp_* p^{-1}$ and
$Rf_* q^{-1} = Rb_* Rq_* q^{-1}$.
The second arrow is the relative cup product of
Cohomology, Remark \ref{cohomology-remark-cup-product}.
The third arrow is the map sending a derived tensor product
of complexes to the totalization of the tensor product of complexes.
The final equality is Lemma \ref{lemma-de-rham-complex-product}.
This construction recovers on global section the construction given earlier.

\begin{lemma}
\label{lemma-kunneth-de-rham-relative}
Assume $X \to S$ and $Y \to S$ are smooth and quasi-compact
and the morphisms $X \to X \times_S X$ and $Y \to Y \times_S Y$ are affine.
Then the relative cup product
$$
Ra_*\Omega^\bullet_{X/S}
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rb_*\Omega^\bullet_{Y/S}
\longrightarrow
Rf_*\Omega^\bullet_{X \times_S Y/S}
$$
is an isomorphism in $D(\mathcal{O}_S)$.
\end{lemma}

\begin{proof}
Immediate consequence of Lemma \ref{lemma-kunneth-de-rham}.
\end{proof}







\section{First Chern class in de Rham cohomology}
\label{section-first-chern-class}

\noindent
Let $X \to S$ be a morphism of schemes. There is a map of complexes
$$
\text{d}\log : \mathcal{O}_X^*[-1] \longrightarrow \Omega^\bullet_{X/S}
$$
which sends the section $g \in \mathcal{O}_X^*(U)$ to the section
$\text{d}\log(g) = g^{-1}\text{d}g$ of $\Omega^1_{X/S}(U)$.
Thus we can consider the map
$$
\Pic(X) = H^1(X, \mathcal{O}_X^*) =
H^2(X, \mathcal{O}_X^*[-1]) \longrightarrow H^2_{dR}(X/S)
$$
where the first equality is
Cohomology, Lemma \ref{cohomology-lemma-h1-invertible}.
The image of the isomorphism class of the invertible module
$\mathcal{L}$ is denoted $c^{dR}_1(\mathcal{L}) \in H^2_{dR}(X/S)$.

\medskip\noindent
We can also use the map $\text{d}\log : \mathcal{O}_X^* \to \Omega^1_{X/S}$
to define a Chern class in Hodge cohomology
$$
c_1^{Hodge} : \Pic(X) \longrightarrow H^1(X, \Omega^1_{X/S})
\subset H^2_{Hodge}(X/S)
$$
These constructions are compatible with pullbacks.

\begin{lemma}
\label{lemma-pullback-c1}
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes the diagrams
$$
\xymatrix{
\Pic(X') \ar[d]_{c_1^{dR}} &
\Pic(X) \ar[d]^{c_1^{dR}} \ar[l]^{f^*} \\
H^2_{dR}(X'/S') &
H^2_{dR}(X/S) \ar[l]_{f^*}
}
\quad
\xymatrix{
\Pic(X') \ar[d]_{c_1^{Hodge}} &
\Pic(X) \ar[d]^{c_1^{Hodge}} \ar[l]^{f^*} \\
H^1(X', \Omega^1_{X'/S'}) &
H^1(X, \Omega^1_{X/S}) \ar[l]_{f^*}
}
$$
commute.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Let us ``compute'' the element $c^{dR}_1(\mathcal{L})$ in {\v C}ech
cohomology (with sign rules for {\v C}ech differentials
as in Cohomology, Section
\ref{cohomology-section-cech-cohomology-of-complexes}).
Namely, choose an open covering
$\mathcal{U} : X = \bigcup_{i \in I} U_i$ such that
we have a trivializing section $s_i$ of $\mathcal{L}|_{U_i}$ for all $i$.
On the overlaps $U_{i_0i_1} = U_{i_0} \cap U_{i_1}$
we have an invertible function $f_{i_0i_1}$ such that
$f_{i_0i_1} = s_{i_1}|_{U_{i_0i_1}} s_{i_0}|_{U_{i_0i_1}}^{-1}$\footnote{The
{\v C}ech differential of a $0$-cycle $\{a_{i_0}\}$ has
$a_{i_1} - a_{i_0}$ over $U_{i_0i_1}$.}.
Of course we have
$$
f_{i_1i_2}|_{U_{i_0i_1i_2}}
f_{i_0i_2}^{-1}|_{U_{i_0i_1i_2}}
f_{i_0i_1}|_{U_{i_0i_1i_2}} = 1
$$
The cohomology class of $\mathcal{L}$ in $H^1(X, \mathcal{O}_X^*)$ is
the image of the {\v C}ech cohomology class of the cocycle $\{f_{i_0i_1}\}$ in
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{O}_X^*)$.
Therefore we see that $c_1^{dR}(\mathcal{L})$ is the image
of the cohomology class associated to the {\v C}ech cocycle
$\{\alpha_{i_0 \ldots i_p}\}$ in
$\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \Omega_{X/S}^\bullet))$
of degree $2$ given by
\begin{enumerate}
\item $\alpha_{i_0} = 0$ in $\Omega^2_{X/S}(U_{i_0})$,
\item $\alpha_{i_0i_1} = f_{i_0i_1}^{-1}\text{d}f_{i_0i_1}$ in
$\Omega^1_{X/S}(U_{i_0i_1})$, and
\item $\alpha_{i_0i_1i_2} = 0$ in $\mathcal{O}_{X/S}(U_{i_0i_1i_2})$.
\end{enumerate}
Suppose we have invertible modules $\mathcal{L}_k$, $k = 1, \ldots, a$
each trivialized over $U_i$ for all $i \in I$ giving rise to cocycles
$f_{k, i_0i_1}$ and $\alpha_k = \{\alpha_{k, i_0 \ldots i_p}\}$ as above.
Using the rule in
Cohomology, Section \ref{cohomology-section-cech-cohomology-of-complexes}
we can compute
$$
\beta = \alpha_1 \cup \alpha_2 \cup \ldots \cup \alpha_a
$$
to be given by the cocycle $\beta = \{\beta_{i_0 \ldots i_p}\}$
described as follows
\begin{enumerate}
\item $\beta_{i_0 \ldots i_p} = 0$ in
$\Omega^{2a - p}_{X/S}(U_{i_0 \ldots i_p})$ unless $p = a$, and
\item $\beta_{i_0 \ldots i_a} = (-1)^{a(a - 1)/2}
\alpha_{1, i_0i_1} \wedge \alpha_{2, i_1 i_2} \wedge \ldots \wedge
\alpha_{a, i_{a - 1}i_a}$ in
$\Omega^a_{X/S}(U_{i_0 \ldots i_a})$.
\end{enumerate}
Thus this is a cocycle representing
$c_1^{dR}(\mathcal{L}_1) \cup \ldots \cup c_1^{dR}(\mathcal{L}_a)$
Of course, the same computation shows that the cocycle
$\{\beta_{i_0 \ldots i_a}\}$ in
$\check{\mathcal{C}}^a(\mathcal{U}, \Omega_{X/S}^a))$
represents the cohomology class
$c_1^{Hodge}(\mathcal{L}_1) \cup \ldots \cup c_1^{Hodge}(\mathcal{L}_a)$

\begin{remark}
\label{remark-truncations}
Here is a reformulation of the calculations above in more abstract terms.
Let $p : X \to S$ be a morphism of schemes. Let $\mathcal{L}$ be an
invertible $\mathcal{O}_X$-module. If we view $\text{d}\log$ as a map
$$
\mathcal{O}_X^*[-1] \to \sigma_{\geq 1}\Omega^\bullet_{X/S}
$$
then using $\Pic(X) = H^1(X, \mathcal{O}_X^*)$ as above we find a
cohomology class
$$
\gamma_1(\mathcal{L}) \in H^2(X, \sigma_{\geq 1}\Omega^\bullet_{X/S})
$$
The image of $\gamma_1(\mathcal{L})$ under the map
$\sigma_{\geq 1}\Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}$
recovers $c_1^{dR}(\mathcal{L})$. In particular we see that
$c_1^{dR}(\mathcal{L}) \in F^1H^2_{dR}(X/S)$, see
Section \ref{section-hodge-filtration}. The image of $\gamma_1(\mathcal{L})$
under the map $\sigma_{\geq 1}\Omega^\bullet_{X/S} \to \Omega^1_{X/S}[-1]$
recovers $c_1^{Hodge}(\mathcal{L})$. Taking the cup product
(see Section \ref{section-hodge-filtration}) we obtain
$$
\xi = \gamma_1(\mathcal{L}_1) \cup \ldots \cup \gamma_1(\mathcal{L}_a) \in
H^{2a}(X, \sigma_{\geq a}\Omega^\bullet_{X/S})
$$
The commutative diagrams in Section \ref{section-hodge-filtration}
show that $\xi$ is mapped to
$c_1^{dR}(\mathcal{L}_1) \cup \ldots \cup c_1^{dR}(\mathcal{L}_a)$
in $H^{2a}_{dR}(X/S)$ by the map
$\sigma_{\geq a}\Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}$.
Also, it follows
$c_1^{dR}(\mathcal{L}_1) \cup \ldots \cup c_1^{dR}(\mathcal{L}_a)$
is contained in $F^a H^{2a}_{dR}(X/S)$. Similarly, the map
$\sigma_{\geq a}\Omega^\bullet_{X/S} \to \Omega^a_{X/S}[-a]$
sends $\xi$ to
$c_1^{Hodge}(\mathcal{L}_1) \cup \ldots \cup c_1^{Hodge}(\mathcal{L}_a)$
in $H^a(X, \Omega^a_{X/S})$.
\end{remark}

\begin{remark}
\label{remark-log-forms}
Let $p : X \to S$ be a morphism of schemes. For $i > 0$
denote $\Omega^i_{X/S, log} \subset \Omega^i_{X/S}$ the abelian subsheaf
generated by local sections of the form
$$
\text{d}\log(u_1) \wedge \ldots \wedge \text{d}\log(u_i)
$$
where $u_1, \ldots, u_n$ are invertible local sections of $\mathcal{O}_X$.
For $i = 0$ the subsheaf $\Omega^0_{X/S, log} \subset \mathcal{O}_X$
is the image of $\mathbf{Z} \to \mathcal{O}_X$. For every $i \geq 0$ we
have a map of complexes
$$
\Omega^i_{X/S, log}[-i] \longrightarrow \Omega^\bullet_{X/S}
$$
because the derivative of a logarithmic form is zero. Moreover, wedging
logarithmic forms gives another, hence we find bilinear maps
$$
\wedge :  \Omega^i_{X/S, log} \times
\Omega^j_{X/S, log} \longrightarrow \Omega^{i + j}_{X/S, log}
$$
compatible with (\ref{equation-wedge}) and the maps above.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Using the map of abelian sheaves
$\text{d}\log : \mathcal{O}_X^* \to \Omega^1_{X/S, log}$
and the identification $\Pic(X) = H^1(X, \mathcal{O}_X^*)$
we find a canonical cohomology class
$$
\tilde \gamma_1(\mathcal{L}) \in H^1(X, \Omega^1_{X/S, log})
$$
These classes have the following properties
\begin{enumerate}
\item the image of $\tilde \gamma_1(\mathcal{L})$ under the canonical
map $\Omega^1_{X/S, log}[-1] \to \sigma_{\geq 1}\Omega^\bullet_{X/S}$
sends $\tilde \gamma_1(\mathcal{L})$ to the class
$\gamma_1(\mathcal{L}) \in 
H^2(X, \sigma_{\geq 1}\Omega^\bullet_{X/S})$
of Remark \ref{remark-truncations},
\item the image of $\tilde \gamma_1(\mathcal{L})$ under the canonical
map $\Omega^1_{X/S, log}[-1] \to \Omega^\bullet_{X/S}$
sends $\tilde \gamma_1(\mathcal{L})$ to $c_1^{dR}(\mathcal{L})$ in
$H^2_{dR}(X/S)$,
\item the image of $\tilde \gamma_1(\mathcal{L})$ under the canonical
map $\Omega^1_{X/S, log} \to \Omega^1_{X/S}$
sends $\tilde \gamma_1(\mathcal{L})$ to $c_1^{Hodge}(\mathcal{L})$ in
$H^1(X, \Omega^1_{X/S})$,
\item the construction of these classes is compatible with pullbacks,
\item add more here.
\end{enumerate}
\end{remark}





\section{de Rham cohomology of a line bundle}
\label{section-line-bundle}

\noindent
A line bundle is a special case of a vector bundle, which in turn is a
cone endowed with some extra structure. To intelligently talk about
the de Rham complex of these, it makes sense to discuss the de Rham
complex of a graded ring.

\begin{remark}[de Rham complex of a graded ring]
\label{remark-de-rham-complex-graded}
Let $G$ be an abelian monoid written additively with neutral element $0$.
Let $R \to A$ be a ring map and assume $A$ comes with a grading
$A = \bigoplus_{g \in G} A_g$ by $R$-modules such that $R$ maps into $A_0$
and $A_g \cdot A_{g'} \subset A_{g + g'}$. Then the module of differentials
comes with a grading
$$
\Omega_{A/R} = \bigoplus\nolimits_{g \in G} \Omega_{A/R, g}
$$
where $\Omega_{A/R, g}$ is the $R$-submodule of $\Omega_{A/R}$
generated by $a_0 \text{d}a_1$ with $a_i \in A_{g_i}$ such that
$g = g_0 + g_1$. Similarly, we obtain
$$
\Omega^p_{A/R} = \bigoplus\nolimits_{g \in G} \Omega^p_{A/R, g}
$$
where $\Omega^p_{A/R, g}$ is the $R$-submodule of $\Omega^p_{A/R}$
generated by $a_0 \text{d}a_1 \wedge \ldots \wedge \text{d}a_p$
with $a_i \in A_{g_i}$ such that $g = g_0 + g_1 + \ldots + g_p$.
Of course the differentials preserve the grading and the wedge
product is compatible with the gradings in the obvious manner.
\end{remark}

\noindent
Let $f : X \to S$ be a morphism of schemes. Let $\pi : C \to X$ be a cone, see
Constructions, Definition \ref{constructions-definition-abstract-cone}.
Recall that this means $\pi$ is affine and we have a grading
$\pi_*\mathcal{O}_C = \bigoplus_{n \geq 0} \mathcal{A}_n$ with
$\mathcal{A}_0 = \mathcal{O}_X$.
Using the discussion in Remark \ref{remark-de-rham-complex-graded}
over affine opens we find that\footnote{With excuses for the notation!}
$$
\pi_*(\Omega^\bullet_{C/S}) =
\bigoplus\nolimits_{n \geq 0} \Omega^\bullet_{C/S, n}
$$
is canonically a direct sum of subcomplexes. Moreover, we have a factorization
$$
\Omega^\bullet_{X/S} \to \Omega^\bullet_{C/S, 0} \to
\pi_*(\Omega^\bullet_{C/S})
$$
and we know that $\omega \wedge \eta \in \Omega^{p + q}_{C/S, n + m}$
if $\omega \in \Omega^p_{C/S, n}$ and $\eta \in \Omega^q_{C/S, m}$.

\medskip\noindent
Let $f : X \to S$ be a morphism of schemes. Let $\pi : L \to X$ be the
line bundle associated to the invertible $\mathcal{O}_X$-module $\mathcal{L}$.
This means that $\pi$ is the unique affine morphism such that
$$
\pi_*\mathcal{O}_L = 
\bigoplus\nolimits_{n \geq 0} \mathcal{L}^{\otimes n}
$$
as $\mathcal{O}_X$-algebras. Thus $L$ is a cone over $X$.
By the discussion above we find a
canonical direct sum decomposition
$$
\pi_*(\Omega^\bullet_{L/S}) =
\bigoplus\nolimits_{n \geq 0} \Omega^\bullet_{L/S, n}
$$
compatible with wedge product, compatible with the decomposition
of $\pi_*\mathcal{O}_L$ above, and such that $\Omega_{X/S}$
maps into the part $\Omega_{L/S, 0}$ of degree $0$.

\medskip\noindent
There is another case which will be useful to us. Namely, consider the
complement\footnote{The scheme $L^\star$ is the $\mathbf{G}_m$-torsor
over $X$ associated to $L$. This is why the grading we get below is
a $\mathbf{Z}$-grading, compare with Groupoids,
Example \ref{groupoids-example-Gm-on-affine} and
Lemmas \ref{groupoids-lemma-complete-reducibility-Gm} and
\ref{groupoids-lemma-Gm-equivariant-module}.}
$L^\star \subset L$ of the zero section $o : X \to L$ in our line
bundle $L$. A local computation shows we have a canonical isomorphism
$$
(L^\star \to X)_*\mathcal{O}_{L^\star} =
\bigoplus\nolimits_{n \in \mathbf{Z}} \mathcal{L}^{\otimes n}
$$
of $\mathcal{O}_X$-algebras. The right hand side is a $\mathbf{Z}$-graded
quasi-coherent $\mathcal{O}_X$-algebra. Using the discussion in
Remark \ref{remark-de-rham-complex-graded} over affine opens we find that
$$
(L^\star \to X)_*(\Omega^\bullet_{L^\star/S}) =
\bigoplus\nolimits_{n \in \mathbf{Z}} \Omega^\bullet_{L^\star/S, n}
$$
compatible with wedge product, compatible with the decomposition
of $(L^\star \to X)_*\mathcal{O}_{L^\star}$ above, and such that
$\Omega_{X/S}$ maps into the part $\Omega_{L^\star/S, 0}$ of degree $0$.
The complex $\Omega^\bullet_{L^\star/S, 0}$ will be
of particular interest to us.

\begin{lemma}
\label{lemma-the-complex-for-L-star}
With notation as above, there is a short exact sequence of complexes
$$
0 \to \Omega^\bullet_{X/S} \to
\Omega^\bullet_{L^\star/S, 0} \to
\Omega^\bullet_{X/S}[-1] \to 0
$$
\end{lemma}

\begin{proof}
We have constructed the map
$\Omega^\bullet_{X/S} \to \Omega^\bullet_{L^\star/S, 0}$ above.

\medskip\noindent
Construction of
$\text{Res} : \Omega^\bullet_{L^\star/S, 0} \to \Omega^\bullet_{X/S}[-1]$.
Let $U \subset X$ be an open and let $s \in \mathcal{L}(U)$
and $s' \in \mathcal{L}^{\otimes -1}(U)$ be sections such that
$s' s = 1$. Then $s$ gives an invertible section of the sheaf of
algebras $(L^\star \to X)_*\mathcal{O}_{L^\star}$ over $U$
with inverse $s' = s^{-1}$. Then we can consider the $1$-form
$\text{d}\log(s) = s' \text{d}(s)$ which is an element of
$\Omega^1_{L^\star/S, 0}(U)$ by our construction of the grading on
$\Omega^1_{L^\star/S}$. Our computations on affines given below
will show that $1$ and $\text{d}\log(s)$ freely generate
$\Omega^\bullet_{L^\star/S, 0}|_U$ as a right module over
$\Omega^\bullet_{X/S}|_U$.
Thus we can define $\text{Res}$ over $U$ by the rule
$$
\text{Res}(\omega' + \text{d}\log(s) \wedge \omega) = \omega
$$
for all $\omega', \omega \in \Omega^\bullet_{X/S}(U)$. This
map is independent of the choice of local generator $s$ and hence
glues to give a global map. Namely, another choice of $s$
would be of the form $gs$ for some invertible $g \in \mathcal{O}_X(U)$
and we would get $\text{d}\log(gs) = g^{-1}\text{d}(g) + \text{d}\log(s)$
from which the independence easily follows.
Finally, observe that our rule for $\text{Res}$
is compatible with differentials
as $\text{d}(\omega' + \text{d}\log(s) \wedge \omega) =
\text{d}(\omega') - \text{d}\log(s) \wedge \text{d}(\omega)$
and because the differential on $\Omega^\bullet_{X/S}[-1]$
sends $\omega'$ to $-\text{d}(\omega')$ by our sign convention in
Homology, Definition \ref{homology-definition-shift-cochain}.

\medskip\noindent
Local computation. We can cover $X$ by affine opens $U \subset X$
such that $\mathcal{L}|_U \cong \mathcal{O}_U$ which moreover map
into an affine open $V \subset S$. Write $U = \Spec(A)$, $V = \Spec(R)$
and choose a generator $s$ of $\mathcal{L}$. We find that we have
$$
L^\star \times_X U = \Spec(A[s, s^{-1}])
$$
Computing differentials we see that
$$
\Omega^1_{A[s, s^{-1}]/R} =
A[s, s^{-1}] \otimes_A \Omega^1_{A/R} \oplus A[s, s^{-1}] \text{d}\log(s)
$$
and therefore taking exterior powers we obtain
$$
\Omega^p_{A[s, s^{-1}]/R} =
A[s, s^{-1}] \otimes_A \Omega^p_{A/R}
\oplus
A[s, s^{-1}] \text{d}\log(s) \otimes_A \Omega^{p - 1}_{A/R}
$$
Taking degree $0$ parts we find
$$
\Omega^p_{A[s, s^{-1}]/R, 0} =
\Omega^p_{A/R} \oplus \text{d}\log(s) \otimes_A \Omega^{p - 1}_{A/R}
$$
and the proof of the lemma is complete.
\end{proof}

\begin{lemma}
\label{lemma-the-complex-for-L-star-gives-chern-class}
The ``boundary'' map
$\delta : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[2]$
in $D(X, f^{-1}\mathcal{O}_S)$ coming from
the short exact sequence in Lemma \ref{lemma-the-complex-for-L-star}
is the map of Remark \ref{remark-cup-product-as-a-map}
for $\xi = c_1^{dR}(\mathcal{L})$.
\end{lemma}

\begin{proof}
To be precise we consider the shift
$$
0 \to \Omega^\bullet_{X/S}[1] \to
\Omega^\bullet_{L^\star/S, 0}[1] \to
\Omega^\bullet_{X/S} \to 0
$$
of the short exact sequence of Lemma \ref{lemma-the-complex-for-L-star}.
As the degree zero part of a grading on
$(L^\star \to X)_*\Omega^\bullet_{L^\star/S}$
we see that $\Omega^\bullet_{L^\star/S, 0}$ is a differential
graded $\mathcal{O}_X$-algebra and that the map
$\Omega^\bullet_{X/S} \to \Omega^\bullet_{L^\star/S, 0}$
is a homomorphism of differential graded $\mathcal{O}_X$-algebras.
Hence we may view $\Omega^\bullet_{X/S}[1] \to
\Omega^\bullet_{L^\star/S, 0}[1]$ as a map of right differential graded
$\Omega^\bullet_{X/S}$-modules on $X$. The map
$\text{Res} : \Omega^\bullet_{L^\star/S, 0}[1] \to \Omega^\bullet_{X/S}$
is a map of right differential graded $\Omega^\bullet_{X/S}$-modules
since it is locally defined by the rule
$\text{Res}(\omega' + \text{d}\log(s) \wedge \omega) = \omega$, see
proof of Lemma \ref{lemma-the-complex-for-L-star}.
Thus by the discussion in
Differential Graded Sheaves, Section \ref{sdga-section-misc}
we see that $\delta$ comes from a map
$\delta' : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[2]$
in the derived category $D(\Omega^\bullet_{X/S}, \text{d})$
of right differential graded modules over the de Rham complex.
The uniqueness averted in Remark \ref{remark-cup-product-as-a-map}
shows it suffices to prove that $\delta(1) = c_1^{dR}(\mathcal{L})$.

\medskip\noindent
We claim that there is a commutative diagram
$$
\xymatrix{
0 \ar[r] &
\mathcal{O}_X^* \ar[r] \ar[d]_{\text{d}\log} &
E \ar[r] \ar[d] &
\underline{\mathbf{Z}} \ar[d] \ar[r] &
0 \\
0 \ar[r] &
\Omega^\bullet_{X/S}[1] \ar[r] &
\Omega^\bullet_{L^\star/S, 0}[1] \ar[r] &
\Omega^\bullet_{X/S} \ar[r] &
0
}
$$
where the top row is a short exact sequence of abelian sheaves whose
boundary map sends $1$ to the class of $\mathcal{L}$ in
$H^1(X, \mathcal{O}_X^*)$. It suffices to prove the claim
by the compatibility of boundary maps with maps between short
exact sequences. We define $E$ as the sheafification of the rule
$$
U \longmapsto \{(s, n) \mid
n \in \mathbf{Z},\ s \in \mathcal{L}^{\otimes n}(U)\text{ generator}\}
$$
with group structure given by $(s, n) \cdot (t, m) = (s \otimes t, n + m)$.
The middle vertical map sends $(s, n)$ to $\text{d}\log(s)$. This produces
a map of short exact sequences
because the map $Res : \Omega^1_{L^\star/S, 0} \to \mathcal{O}_X$
constructed in the proof of Lemma \ref{lemma-the-complex-for-L-star} sends
$\text{d}\log(s)$ to $1$ if $s$ is a local generator of $\mathcal{L}$.
To calculate the boundary of $1$ in the top row, choose local trivializations
$s_i$ of $\mathcal{L}$ over opens $U_i$ as in
Section \ref{section-first-chern-class}. On the overlaps
$U_{i_0i_1} = U_{i_0} \cap U_{i_1}$
we have an invertible function $f_{i_0i_1}$ such that
$f_{i_0i_1} = s_{i_1}|_{U_{i_0i_1}} s_{i_0}|_{U_{i_0i_1}}^{-1}$
and the cohomology class of $\mathcal{L}$ is given by the {\v C}ech cocycle
$\{f_{i_0i_1}\}$. Then of course we have
$$
(f_{i_0i_1}, 0) = (s_{i_1}, 1)|_{U_{i_0i_1}} \cdot
(s_{i_0}, 1)|_{U_{i_0i_1}}^{-1}
$$
as sections of $E$ which finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-push-omega-a}
With notation as above we have
\begin{enumerate}
\item $\Omega^p_{L^\star/S, n} =
\Omega^p_{L^\star/S, 0} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
for all $n \in \mathbf{Z}$ as quasi-coherent $\mathcal{O}_X$-modules,
\item $\Omega^\bullet_{X/S} = \Omega^\bullet_{L/X, 0}$
as complexes, and
\item for $n > 0$ and $p \geq 0$ we have
$\Omega^p_{L/X, n} = \Omega^p_{L^\star/S, n}$.
\end{enumerate}
\end{lemma}

\begin{proof}
In each case there is a globally defined canonical map which
is an isomorphism by local calculations which we omit.
\end{proof}

\begin{lemma}
\label{lemma-line-bundle-characteristic-zero}
In the situation above, assume there is a morphism $S \to \Spec(\mathbf{Q})$.
Then $\Omega^\bullet_{X/S} \to \pi_*\Omega^\bullet_{L/S}$ is a
quasi-isomorphism and $H_{dR}^*(X/S) = H_{dR}^*(L/S)$.
\end{lemma}

\begin{proof}
Let $R$ be a $\mathbf{Q}$-algebra. Let $A$ be an $R$-algebra.
The affine local statement is that the map
$$
\Omega^\bullet_{A/R} \longrightarrow \Omega^\bullet_{A[t]/R}
$$
is a quasi-isomorphism of complexes of $R$-modules. In fact it is a
homotopy equivalence with homotopy inverse given by the map sending
$g \omega + g' \text{d}t \wedge \omega'$ to $g(0)\omega$ for
$g, g' \in A[t]$ and $\omega, \omega' \in \Omega^\bullet_{A/R}$.
The homotopy sends $g \omega + g' \text{d}t \wedge \omega'$
to $(\int g') \omega'$ were $\int g' \in A[t]$ is the polynomial
with vanishing constant term whose derivative with respect to $t$
is $g'$. Of course, here we use that $R$ contains $\mathbf{Q}$
as $\int t^n = (1/n)t^{n + 1}$.
\end{proof}

\begin{example}
\label{example-affine-line}
Lemma \ref{lemma-line-bundle-characteristic-zero} is
false in positive characteristic. The de Rham complex of
$\mathbf{A}^1_k = \Spec(k[x])$ over a field $k$ looks like a direct sum
$$
k \oplus
\bigoplus\nolimits_{n \geq 1}
(k \cdot t^n \xrightarrow{n}
k \cdot t^{n - 1} \text{d}t)
$$
Hence if the characteristic of $k$ is $p > 0$, then
we see that both $H^0_{dR}(\mathbf{A}^1_k/k)$ and
$H^1_{dR}(\mathbf{A}^1_k/k)$
are infinite dimensional over $k$.
\end{example}








\section{de Rham cohomology of projective space}
\label{section-projective-space}

\noindent
Let $A$ be a ring. Let $n \geq 1$. The structure morphism
$\mathbf{P}^n_A \to \Spec(A)$ is a proper smooth of relative
dimension $n$. It is smooth of relative dimension $n$ and of finite type
as $\mathbf{P}^n_A$ has a finite affine open covering by schemes each
isomorphic to $\mathbf{A}^n_A$, see Constructions, Lemma
\ref{constructions-lemma-standard-covering-projective-space}.
It is proper because it is also separated and universally closed
by Constructions, Lemma \ref{constructions-lemma-projective-space-separated}.
Let us denote $\mathcal{O}$ and $\mathcal{O}(d)$ the structure sheaf
$\mathcal{O}_{\mathbf{P}^n_A}$ and the Serre twists
$\mathcal{O}_{\mathbf{P}^n_A}(d)$.
Let us denote $\Omega = \Omega_{\mathbf{P}^n_A/A}$ the sheaf
of relative differentials and $\Omega^p$ its exterior powers.

\begin{lemma}
\label{lemma-euler-sequence}
There exists a short exact sequence
$$
0 \to \Omega \to \mathcal{O}(-1)^{\oplus n + 1} \to \mathcal{O} \to 0
$$
\end{lemma}

\begin{proof}
To explain this, we recall that
$\mathbf{P}^n_A = \text{Proj}(A[T_0, \ldots, T_n])$,
and we write symbolically
$$
\mathcal{O}(-1)^{\oplus n + 1} =
\bigoplus\nolimits_{j = 0, \ldots, n} \mathcal{O}(-1) \text{d}T_j
$$
The first arrow
$$
\Omega \to
\bigoplus\nolimits_{j = 0, \ldots, n} \mathcal{O}(-1) \text{d}T_j
$$
in the short exact sequence above
is given on each of the standard opens
$D_+(T_i) = \Spec(A[T_0/T_i, \ldots, T_n/T_i])$
mentioned above by the rule
$$
\sum\nolimits_{j \not = i} g_j \text{d}(T_j/T_i)
\longmapsto
\sum\nolimits_{j \not = i} g_j/T_i \text{d}T_j
- (\sum\nolimits_{j \not = i} g_jT_j/T_i^2) \text{d}T_i
$$
This makes sense because $1/T_i$ is a section of $\mathcal{O}(-1)$
over $D_+(T_i)$. The map
$$
\bigoplus\nolimits_{j = 0, \ldots, n} \mathcal{O}(-1) \text{d}T_j
\to
\mathcal{O}
$$
is given by sending $\text{d}T_j$ to $T_j$, more precisely, on
$D_+(T_i)$ we send the section $\sum g_j \text{d}T_j$ to
$\sum T_jg_j$. We omit the verification that this produces
a short exact sequence.
\end{proof}

\noindent
Given an integer $k \in \mathbf{Z}$ and a quasi-coherent
$\mathcal{O}_{\mathbf{P}^n_A}$-module $\mathcal{F}$
denote as usual $\mathcal{F}(k)$ the $k$th Serre twist of $\mathcal{F}$.
See Constructions, Definition \ref{constructions-definition-twist}.

\begin{lemma}
\label{lemma-twisted-hodge-cohomology-projective-space}
In the situation above we have the following cohomology groups
\begin{enumerate}
\item $H^q(\mathbf{P}^n_A, \Omega^p) = 0$
unless $0 \leq p = q \leq n$,
\item for $0 \leq p \leq n$ the $A$-module
$H^p(\mathbf{P}^n_A, \Omega^p)$ free of rank $1$.
\item for $q > 0$, $k > 0$, and $p$ arbitrary we have
$H^q(\mathbf{P}^n_A, \Omega^p(k)) = 0$, and
\item add more here.
\end{enumerate}
\end{lemma}

\begin{proof}
We are going to use the results of Cohomology of Schemes, Lemma
\ref{coherent-lemma-cohomology-projective-space-over-ring}
without further mention. In particular, the statements are true
for $H^q(\mathbf{P}^n_A, \mathcal{O}(k))$.

\medskip\noindent
Proof for $p = 1$. Consider the short exact sequence
$$
0 \to \Omega \to \mathcal{O}(-1)^{\oplus n + 1} \to \mathcal{O} \to 0
$$
of Lemma \ref{lemma-euler-sequence}. Since $\mathcal{O}(-1)$ has
vanishing cohomology in all degrees, this gives that
$H^q(\mathbf{P}^n_A, \Omega)$ is zero except in degree $1$
where it is freely generated by the boundary of $1$ in
$H^0(\mathbf{P}^n_A, \mathcal{O})$.

\medskip\noindent
Assume $p > 1$. Let us think of the short exact sequence
above as defining a $2$ step filtration on $\mathcal{O}(-1)^{\oplus n + 1}$.
The induced filtration on $\wedge^p\mathcal{O}(-1)^{\oplus n + 1}$ looks
like this
$$
0 \to \Omega^p \to \wedge^p\left(\mathcal{O}(-1)^{\oplus n + 1}\right)
\to \Omega^{p - 1} \to 0
$$
Observe that $\wedge^p\mathcal{O}(-1)^{\oplus n + 1}$ is isomorphic
to a direct sum of $n + 1$ choose $p$ copies of $\mathcal{O}(-p)$
and hence has vanishing cohomology in all degrees.
By induction hypothesis, this shows that $H^q(\mathbf{P}^n_A, \Omega^p)$
is zero unless $q = p$ and $H^p(\mathbf{P}^n_A, \Omega^p)$ is free
of rank $1$ with generator the boundary of the generator in
$H^{p - 1}(\mathbf{P}^n_A, \Omega^{p - 1})$.

\medskip\noindent
Let $k > 0$. Observe that $\Omega^n = \mathcal{O}(-n - 1)$ for example
by the short exact sequence above for $p = n + 1$.
Hence $\Omega^n(k)$ has vanishing cohomology in positive degrees.
Using the short exact sequences
$$
0 \to \Omega^p(k) \to \wedge^p\left(\mathcal{O}(-1)^{\oplus n + 1}\right)(k)
\to \Omega^{p - 1}(k) \to 0
$$
and {\it descending} induction on $p$ we get the vanishing of
cohomology of $\Omega^p(k)$ in positive degrees for all $p$.
\end{proof}

\begin{lemma}
\label{lemma-hodge-cohomology-projective-space}
We have $H^q(\mathbf{P}^n_A, \Omega^p) = 0$
unless $0 \leq p = q \leq n$. For $0 \leq p \leq n$ the $A$-module
$H^p(\mathbf{P}^n_A, \Omega^p)$ free of rank $1$ with basis element
$c_1^{Hodge}(\mathcal{O}(1))^p$.
\end{lemma}

\begin{proof}
We have the vanishing and and freeness by
Lemma \ref{lemma-twisted-hodge-cohomology-projective-space}.
For $p = 0$ it is certainly true that
$1 \in H^0(\mathbf{P}^n_A, \mathcal{O})$ is a generator.

\medskip\noindent
Proof for $p = 1$. Consider the short exact sequence
$$
0 \to \Omega \to \mathcal{O}(-1)^{\oplus n + 1} \to \mathcal{O} \to 0
$$
of Lemma \ref{lemma-euler-sequence}. In the proof of
Lemma \ref{lemma-twisted-hodge-cohomology-projective-space}
we have seen that the generator of $H^1(\mathbf{P}^n_A, \Omega)$
is the boundary $\xi$ of $1 \in H^0(\mathbf{P}^n_A, \mathcal{O})$.
As in the proof of Lemma \ref{lemma-euler-sequence} we will identify
$\mathcal{O}(-1)^{\oplus n + 1}$ with
$\bigoplus_{j = 0, \ldots, n} \mathcal{O}(-1)\text{d}T_j$.
Consider the open covering
$$
\mathcal{U} : 
\mathbf{P}^n_A =
\bigcup\nolimits_{i = 0, \ldots, n} D_{+}(T_i)
$$
We can lift the restriction of the global section $1$ of $\mathcal{O}$
to $U_i = D_+(T_i)$ by the section $T_i^{-1} \text{d}T_i$ of
$\bigoplus \mathcal{O}(-1)\text{d}T_j$ over $U_i$. Thus the cocyle
representing $\xi$ is given by
$$
T_{i_1}^{-1} \text{d}T_{i_1} - T_{i_0}^{-1} \text{d}T_{i_0} =
\text{d}\log(T_{i_1}/T_{i_0}) \in \Omega(U_{i_0i_1})
$$
On the other hand, for each $i$ the section $T_i$ is a trivializing
section of $\mathcal{O}(1)$ over $U_i$. Hence we see that
$f_{i_0i_1} = T_{i_1}/T_{i_0} \in \mathcal{O}^*(U_{i_0i_1})$
is the cocycle representing $\mathcal{O}(1)$ in $\Pic(\mathbf{P}^n_A)$,
see Section \ref{section-first-chern-class}.
Hence $c_1^{Hodge}(\mathcal{O}(1))$
is given by the cocycle $\text{d}\log(T_{i_1}/T_{i_0})$
which agrees with what we got for $\xi$ above.

\medskip\noindent
Proof for general $p$ by induction. The base cases $p = 0, 1$ were handled
above. Assume $p > 1$. In the proof of
Lemma \ref{lemma-twisted-hodge-cohomology-projective-space}
we have seen that the generator of $H^p(\mathbf{P}^n_A, \Omega^p)$
is the boundary of $c_1^{Hodge}(\mathcal{O}(1))^{p - 1}$
in the long exact cohomology sequence associated to
$$
0 \to \Omega^p \to \wedge^p\left(\mathcal{O}(-1)^{\oplus n + 1}\right)
\to \Omega^{p - 1} \to 0
$$
By the calculation in Section \ref{section-first-chern-class}
the cohomology class $c_1^{Hodge}(\mathcal{O}(1))^{p - 1}$
is, up to a sign, represented by the cocycle with terms
$$
\beta_{i_0 \ldots i_{p - 1}} =
\text{d}\log(T_{i_1}/T_{i_0}) \wedge
\text{d}\log(T_{i_2}/T_{i_1}) \wedge \ldots \wedge
\text{d}\log(T_{i_{p - 1}}/T_{i_{p - 2}})
$$
in $\Omega^{p - 1}(U_{i_0 \ldots i_{p - 1}})$. These
$\beta_{i_0 \ldots i_{p - 1}}$ can be lifted to the sections
$\tilde \beta_{i_0 \ldots i_{p -1}} =
T_{i_0}^{-1}\text{d}T_{i_0} \wedge \beta_{i_0 \ldots i_{p - 1}}$
of $\wedge^p(\bigoplus \mathcal{O}(-1) \text{d}T_j)$ over
$U_{i_0 \ldots i_{p - 1}}$. We conclude that the generator of
$H^p(\mathbf{P}^n_A, \Omega^p)$ is given by the cocycle whose
components are
\begin{align*}
\sum\nolimits_{a = 0}^p (-1)^a
\tilde \beta_{i_0 \ldots \hat{i_a} \ldots i_p}
& =
T_{i_1}^{-1}\text{d}T_{i_1} \wedge \beta_{i_1 \ldots i_p}
+ \sum\nolimits_{a = 1}^p (-1)^a
T_{i_0}^{-1}\text{d}T_{i_0} \wedge
\beta_{i_0 \ldots \hat{i_a} \ldots i_p} \\
& =
(T_{i_1}^{-1}\text{d}T_{i_1} - T_{i_0}^{-1}\text{d}T_{i_0}) \wedge
\beta_{i_1 \ldots i_p} +
T_{i_0}^{-1}\text{d}T_{i_0} \wedge \text{d}(\beta)_{i_0 \ldots i_p} \\
& =
\text{d}\log(T_{i_1}/T_{i_0}) \wedge \beta_{i_1 \ldots i_p}
\end{align*}
viewed as a section of $\Omega^p$ over $U_{i_0 \ldots i_p}$.
This is up to sign the same as the cocycle representing
$c_1^{Hodge}(\mathcal{O}(1))^p$ and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-de-rham-cohomology-projective-space}
For $0 \leq i \leq n$ the de Rham cohomology
$H^{2i}_{dR}(\mathbf{P}^n_A/A)$ is a free $A$-module of rank $1$
with basis element $c_1^{dR}(\mathcal{O}(1))^i$.
In all other degrees the de Rham cohomology of $\mathbf{P}^n_A$
over $A$ is zero.
\end{lemma}

\begin{proof}
Consider the Hodge-to-de Rham spectral sequence of
Section \ref{section-hodge-to-de-rham}.
By the computation of the Hodge cohomology of $\mathbf{P}^n_A$ over $A$
done in Lemma \ref{lemma-hodge-cohomology-projective-space}
we see that the spectral sequence degenerates on the $E_1$ page.
In this way we see that $H^{2i}_{dR}(\mathbf{P}^n_A/A)$ is a free
$A$-module of rank $1$ for $0 \leq i \leq n$ and zero else.
Observe that $c_1^{dR}(\mathcal{O}(1))^i \in H^{2i}_{dR}(\mathbf{P}^n_A/A)$
for $i = 0, \ldots, n$ and that for $i = n$ this element is the
image of $c_1^{Hodge}(\mathcal{L})^n$ by the map of complexes
$$
\Omega^n_{\mathbf{P}^n_A/A}[-n]
\longrightarrow
\Omega^\bullet_{\mathbf{P}^n_A/A}
$$
This follows for example from the discussion in Remark \ref{remark-truncations}
or from the explicit description of cocycles representing these classes in
Section \ref{section-first-chern-class}.
The spectral sequence shows that the induced map
$$
H^n(\mathbf{P}^n_A, \Omega^n_{\mathbf{P}^n_A/A}) \longrightarrow
H^{2n}_{dR}(\mathbf{P}^n_A/A)
$$
is an isomorphism and since $c_1^{Hodge}(\mathcal{L})^n$ is a generator of
of the source (Lemma \ref{lemma-hodge-cohomology-projective-space}),
we conclude that $c_1^{dR}(\mathcal{L})^n$ is a generator
of the target. By the $A$-bilinearity of the cup products,
it follows that also $c_1^{dR}(\mathcal{L})^i$
is a generator of $H^{2i}_{dR}(\mathbf{P}^n_A/A)$ for
$0 \leq i \leq n$.
\end{proof}









\section{The spectral sequence for a smooth morphism}
\label{section-relative-spectral-sequence}

\noindent
Consider a commutative diagram of schemes
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& S
}
$$
where $f$ is a smooth morphism. Then we obtain a locally split short
exact sequence
$$
0 \to f^*\Omega_{Y/S} \to \Omega_{X/S} \to \Omega_{X/Y} \to 0
$$
by Morphisms, Lemma \ref{morphisms-lemma-triangle-differentials-smooth}.
Let us think of this as a descending filtration $F$ on $\Omega_{X/S}$
with $F^0\Omega_{X/S} = \Omega_{X/S}$, $F^1\Omega_{X/S} = f^*\Omega_{Y/S}$, and
$F^2\Omega_{X/S} = 0$. Applying the functor $\wedge^p$ we obtain
for every $p$ an induced filtration
$$
\Omega^p_{X/S} = F^0\Omega^p_{X/S} \supset
F^1\Omega^p_{X/S} \supset
F^2\Omega^p_{X/S} \supset \ldots \supset F^{p + 1}\Omega^p_{X/S} = 0
$$
whose successive quotients are
$$
\text{gr}^k\Omega^p_{X/S} =
F^k\Omega^p_{X/S}/F^{k + 1}\Omega^p_{X/S} =
f^*\Omega^k_{Y/S} \otimes_{\mathcal{O}_X} \Omega^{p - k}_{X/Y} =
f^{-1}\Omega^k_{Y/S} \otimes_{f^{-1}\mathcal{O}_Y} \Omega^{p - k}_{X/Y}
$$
for $k = 0, \ldots, p$. In fact, the reader can check using the
Leibniz rule that $F^k\Omega^\bullet_{X/S}$ is a subcomplex of
$\Omega^\bullet_{X/S}$. In this way $\Omega^\bullet_{X/S}$ has
the structure of a filtered complex. We can also see this by observing
that
$$
F^k\Omega^\bullet_{X/S} =
\Im\left(\wedge :
\text{Tot}(
f^{-1}\sigma_{\geq k}\Omega^\bullet_{Y/S} \otimes_{p^{-1}\mathcal{O}_S}
\Omega^\bullet_{X/S})
\longrightarrow
\Omega^\bullet_{X/S}\right)
$$
is the image of a map of complexes on $X$. The filtered complex
$$
\Omega^\bullet_{X/S} = F^0\Omega^\bullet_{X/S} \supset
F^1\Omega^\bullet_{X/S} \supset F^2\Omega^\bullet_{X/S} \supset \ldots
$$
has the following associated graded parts
$$
\text{gr}^k\Omega^\bullet_{X/S} = 
f^{-1}\Omega^k_{Y/S}[-k] \otimes_{f^{-1}\mathcal{O}_Y} \Omega^\bullet_{X/Y}
$$
by what was said above.

\begin{lemma}
\label{lemma-spectral-sequence-smooth}
Let $f : X \to Y$ be a quasi-compact, quasi-separated, and smooth
morphism of schemes over a base scheme $S$. There is a bounded spectral
sequence with first page
$$
E_1^{p, q} =
H^q(\Omega^p_{Y/S} \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*\Omega^\bullet_{X/Y})
$$
converging to $R^{p + q}f_*\Omega^\bullet_{X/S}$.
\end{lemma}

\begin{proof}
Consider $\Omega^\bullet_{X/S}$ as a filtered complex with the
filtration introduced above. The spectral sequence is the
spectral sequence of Cohomology, Lemma
\ref{cohomology-lemma-relative-spectral-sequence-filtered-object}.
By Derived Categories of Schemes, Lemma
\ref{perfect-lemma-cohomology-de-rham-base-change} we have
$$
Rf_*\text{gr}^k\Omega^\bullet_{X/S} =
\Omega^k_{Y/S}[-k] \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*\Omega^\bullet_{X/Y}
$$
and thus we conclude.
\end{proof}

\begin{remark}
\label{remark-gauss-manin}
In Lemma \ref{lemma-spectral-sequence-smooth} consider the cohomology sheaves
$$
\mathcal{H}^q_{dR}(X/Y) = H^q(Rf_*\Omega^\bullet_{X/Y})
$$
If $f$ is proper in addition to being smooth and $S$ is a scheme over
$\mathbf{Q}$ then $\mathcal{H}^q_{dR}(X/Y)$ is finite locally free (insert
future reference here). If we only assume $\mathcal{H}^q_{dR}(X/Y)$
are flat $\mathcal{O}_Y$-modules, then we obtain (tiny argument omitted)
$$
E_1^{p, q} =
\Omega^p_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y)
$$
and the differentials in the spectral sequence are maps
$$
d_1^{p, q} :
\Omega^p_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y)
\longrightarrow
\Omega^{p + 1}_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y)
$$
In particular, for $p = 0$ we obtain a map
$d_1^{0, q} : \mathcal{H}^q_{dR}(X/Y) \to
\Omega^1_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y)$
which turns out to be an integrable connection
$\nabla$ (insert future reference here)
and the complex
$$
\mathcal{H}^q_{dR}(X/Y) \to
\Omega^1_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y) \to
\Omega^2_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y) \to \ldots
$$
with differentials given by $d_1^{\bullet, q}$
is the de Rham complex of $\nabla$.
The connection $\nabla$ is known as the {\it Gauss-Manin connection}.
\end{remark}






\section{Leray-Hirsch type theorems}
\label{section-leray-hirsch}

\noindent
In this section we prove that for a smooth proper morphism one
can sometimes express the de Rham cohomology upstairs in terms
of the de Rham cohomology downstairs.

\begin{lemma}
\label{lemma-relative-global-generation-on-fibres}
Let $f : X \to Y$ be a smooth proper morphism of schemes.
Let $N$ and $n_1, \ldots, n_N \geq 0$ be integers and let
$\xi_i \in H^{n_i}_{dR}(X/Y)$, $1 \leq i \leq N$.
Assume for all points $y \in Y$ the images of $\xi_1, \ldots, \xi_N$
in $H^*_{dR}(X_y/y)$ form a basis over $\kappa(y)$. Then the map
$$
\bigoplus\nolimits_{i = 1}^N \mathcal{O}_Y[-n_i]
\longrightarrow
Rf_*\Omega^\bullet_{X/Y}
$$
associated to $\xi_1, \ldots, \xi_N$ is an isomorphism.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-proper-smooth-de-Rham}
$Rf_*\Omega^\bullet_{X/Y}$ is a perfect object of $D(\mathcal{O}_Y)$
whose formation commutes with arbitrary base change.
Thus the map of the lemma is a map $a : K \to L$
between perfect objects of $D(\mathcal{O}_Y)$
whose derived restriction to any point is an isomorphism
by our assumption on fibres. Then the cone $C$ on $a$ is a perfect
object of $D(\mathcal{O}_Y)$ (Cohomology, Lemma
\ref{cohomology-lemma-two-out-of-three-perfect}) whose
derived restriction to any point is zero. It follows that $C$
is zero by More on Algebra, Lemma
\ref{more-algebra-lemma-lift-perfect-from-residue-field}
and $a$ is an isomorphism. (This also uses Derived Categories of Schemes,
Lemmas \ref{perfect-lemma-affine-compare-bounded} and
\ref{perfect-lemma-perfect-affine} to translate into algebra.)
\end{proof}

\noindent
We first prove the main result of this section in the
following special case.

\begin{lemma}
\label{lemma-global-generation-on-fibres}
Let $f : X \to Y$ be a smooth proper morphism of schemes over a base $S$.
Assume
\begin{enumerate}
\item $Y$ and $S$ are affine, and
\item there exist integers $N$ and $n_1, \ldots, n_N \geq 0$ and
$\xi_i \in H^{n_i}_{dR}(X/S)$, $1 \leq i \leq N$ such that
for all points $y \in Y$ the images of $\xi_1, \ldots, \xi_N$
in $H^*_{dR}(X_y/y)$ form a basis over $\kappa(y)$.
\end{enumerate}
Then the map
$$
\bigoplus\nolimits_{i = 1}^N H^*_{dR}(Y/S) \longrightarrow
H^*_{dR}(X/S), \quad
(a_1, \ldots, a_N) \longmapsto  \sum \xi_i \cup f^*a_i
$$
is an isomorphism.
\end{lemma}

\begin{proof}
Say $Y = \Spec(A)$ and $S = \Spec(R)$.
In this case $\Omega^\bullet_{A/R}$ computes
$R\Gamma(Y, \Omega^\bullet_{Y/S})$ by Lemma \ref{lemma-de-rham-affine}.
Choose a finite affine open covering $\mathcal{U} : X = \bigcup_{i \in I} U_i$.
Consider the complex
$$
K^\bullet =
\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \Omega_{X/S}^\bullet))
$$
as in
Cohomology, Section \ref{cohomology-section-cech-cohomology-of-complexes}.
Let us collect some facts about this complex most of which
can be found in the reference just given:
\begin{enumerate}
\item $K^\bullet$ is a complex of $R$-modules whose terms are
$A$-modules,
\item $K^\bullet$ represents $R\Gamma(X, \Omega^\bullet_{X/S})$ in $D(R)$
(Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherent-affine-cohomology-zero} and
Cohomology, Lemma \ref{cohomology-lemma-cech-complex-complex-computes}),
\item there is a natural map $\Omega^\bullet_{A/R} \to K^\bullet$
of complexes of $R$-modules which is $A$-linear on terms and
induces the pullback map $H^*_{dR}(Y/S) \to H^*_{dR}(X/S)$
on cohomology,
\item $K^\bullet$ has a multiplication denoted $\wedge$
which turns it into a differential graded $R$-algebra,
\item the multiplication on $K^\bullet$
induces the cup product on $H^*_{dR}(X/S)$
(Cohomology, Section \ref{cohomology-section-cup-product}),
\item the filtration $F$ on $\Omega^*_{X/S}$ induces a filtration
$$
K^\bullet =
F^0K^\bullet \supset F^1K^\bullet \supset F^2K^\bullet \supset \ldots
$$
by subcomplexes on $K^\bullet$ such that
\begin{enumerate}
\item $F^kK^n \subset K^n$ is an $A$-submmodule,
\item $F^kK^\bullet \wedge F^lK^\bullet \subset F^{k + l}K^\bullet$,
\item $\text{gr}^kK^\bullet$ is a complex of $A$-modules,
\item $\text{gr}^0K^\bullet =
\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \Omega_{X/Y}^\bullet))$
and represents $R\Gamma(X, \Omega^\bullet_{X/Y})$ in $D(A)$,
\item multiplication induces an isomorphism
$\Omega^k_{A/R}[-k] \otimes_A \text{gr}^0K^\bullet \to \text{gr}^kK^\bullet$
\end{enumerate}
\end{enumerate}
We omit the detailed proofs of these statements; please see discussion
leading up to the construction of the spectral sequence in
Lemma \ref{lemma-spectral-sequence-smooth}.

\medskip\noindent
For every $i = 1, \ldots, N$ we choose a cocycle $x_i \in K^{n_i}$
representing $\xi_i$. Next, we look at the map of complexes
$$
\tilde x :
M^\bullet = \bigoplus\nolimits_{i = 1, \ldots, N}
\Omega^\bullet_{A/R}[-n_i]
\longrightarrow
K^\bullet
$$
which sends $\omega$ in the $i$th summand to $x_i \wedge \omega$.
All that remains is to show that this map is a quasi-isomorphism.
We endow $M^\bullet$ with the structure of a filtered complex
by the rule
$$
F^kM^\bullet =
\bigoplus\nolimits_{i = 1, \ldots, N}
(\sigma_{\geq k}\Omega^\bullet_{A/R})[-n_i]
$$
With this choice the map $\tilde x$ is a morphism of filtered complexes.
Observe that $\text{gr}^0M^\bullet = \bigoplus A[-n_i]$
and multiplication induces an isomorphism
$\Omega^k_{A/R}[-k] \otimes_A \text{gr}^0M^\bullet \to \text{gr}^kM^\bullet$.
By construction and Lemma \ref{lemma-relative-global-generation-on-fibres}
we see that
$$
\text{gr}^0\tilde x :
\text{gr}^0M^\bullet \longrightarrow
\text{gr}^0K^\bullet
$$
is an isomorphism in $D(A)$. It follows that for all $k \geq 0$
we obtain isomorphisms
$$
\text{gr}^k \tilde x :
\text{gr}^kM^\bullet = \Omega^k_{A/R}[-k] \otimes_A \text{gr}^0M^\bullet
\longrightarrow
\Omega^k_{A/R}[-k] \otimes_A \text{gr}^0K^\bullet =
\text{gr}^kK^\bullet
$$
in $D(A)$. Namely, the complex
$\text{gr}^0K^\bullet =
\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \Omega_{X/Y}^\bullet))$
is K-flat as a complex of $A$-modules by Derived Categories of Schemes,
Lemma \ref{perfect-lemma-K-flat}.
Hence the tensor product on the right hand side is the
derived tensor product as is true by inspection on the left hand side.
Finally, taking the derived tensor product
$\Omega^k_{A/R}[-k] \otimes_A^\mathbf{L} -$ is a functor on $D(A)$
and therefore sends isomorphisms to isomorphisms.
Arguing by induction on $k$ we deduce that
$$
\tilde x : M^\bullet/F^kM^\bullet \to K^\bullet/F^kK^\bullet
$$
is an isomorphism in $D(R)$ since we have the short exact sequences
$$
0 \to F^kM^\bullet/F^{k + 1}M^\bullet \to
M^\bullet/F^{k + 1}M^\bullet \to
\text{gr}^kM^\bullet \to 0
$$
and similarly for $K^\bullet$. This proves that $\tilde x$ is a
quasi-isomorphism as the filtrations are finite in any given degree.
\end{proof}

\begin{proposition}
\label{proposition-global-generation-on-fibres}
Let $f : X \to Y$ be a smooth proper morphism of schemes over a base $S$.
Let $N$ and $n_1, \ldots, n_N \geq 0$ be integers and let
$\xi_i \in H^{n_i}_{dR}(X/S)$, $1 \leq i \leq N$.
Assume for all points $y \in Y$ the images of $\xi_1, \ldots, \xi_N$
in $H^*_{dR}(X_y/y)$ form a basis over $\kappa(y)$. The map
$$
\tilde \xi = \bigoplus \tilde \xi_i[-n_i] :
\bigoplus \Omega^\bullet_{Y/S}[-n_i]
\longrightarrow
Rf_*\Omega^\bullet_{X/S}
$$
(see proof) is an isomorphism in $D(Y, (Y \to S)^{-1}\mathcal{O}_S)$ and
correspondingly the map
$$
\bigoplus\nolimits_{i = 1}^N H^*_{dR}(Y/S) \longrightarrow
H^*_{dR}(X/S), \quad
(a_1, \ldots, a_N) \longmapsto  \sum \xi_i \cup f^*a_i
$$
is an isomorphism.
\end{proposition}

\begin{proof}
Denote $p : X \to S$ and $q : Y \to S$ be the structure morphisms.
Let $\xi'_i : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[n_i]$
be the map of Remark \ref{remark-cup-product-as-a-map} corresponding
to $\xi_i$. Denote
$$
\tilde \xi_i :
\Omega^\bullet_{Y/S} \to Rf_*\Omega^\bullet_{X/S}[n_i]
$$
the composition of $\xi'_i$ with the canonical map
$\Omega^\bullet_{Y/S} \to Rf_*\Omega^\bullet_{X/S}$.
Using
$$
R\Gamma(Y, Rf_*\Omega^\bullet_{X/S}) = R\Gamma(X, \Omega^\bullet_{X/S})
$$
on cohomology $\tilde \xi_i$ is the map $\eta \mapsto \xi_i \cup f^*\eta$
from $H^m_{dR}(Y/S)$ to $H^{m + n}_{dR}(X/S)$.
Further, since the formation of $\xi'_i$ commutes with
restrictions to opens, so does the formation of $\tilde \xi_i$
commute with restriction to opens.

\medskip\noindent
Thus we can consider the map
$$
\tilde \xi = \bigoplus \tilde \xi_i[-n_i] :
\bigoplus \Omega^\bullet_{Y/S}[-n_i]
\longrightarrow
Rf_*\Omega^\bullet_{X/S}
$$
To prove the lemma it suffices to show that this is an isomorphism in
$D(Y, q^{-1}\mathcal{O}_S)$. If we could show $\tilde \xi$
comes from a map of filtered complexes (with suitable filtrations),
then we could appeal to the spectral sequence of
Lemma \ref{lemma-spectral-sequence-smooth} to finish the proof.
This takes more work than is necessary and instead our approach
will be to reduce to the affine case (whose proof does in some sense
use the spectral sequence).

\medskip\noindent
Indeed, if $Y' \subset Y$ is is any open with inverse image
$X' \subset X$, then $\tilde \xi|_{X'}$ induces the map
$$
\bigoplus\nolimits_{i = 1}^N H^*_{dR}(Y'/S) \longrightarrow
H^*_{dR}(X'/S), \quad
(a_1, \ldots, a_N) \longmapsto  \sum \xi_i|_{X'} \cup f^*a_i
$$
on cohomology over $Y'$, see discussion above.
Thus it suffices to find a basis for the topology
on $Y$ such that the proposition holds for the members of the basis
(in particular we can forget about the map $\tilde \xi$ when
we do this). This reduces us to the case where $Y$ and $S$
are affine which is handled by Lemma \ref{lemma-global-generation-on-fibres}
and the proof is complete.
\end{proof}





\section{Projective space bundle formula}
\label{section-projective-space-bundle-formula}

\noindent
The title says it all.

\begin{proposition}
\label{proposition-projective-space-bundle-formula}
Let $X \to S$ be a morphism of schemes. Let $\mathcal{E}$ be a locally
free $\mathcal{O}_X$-module of constant rank $r$. Consider the morphism
$p : P = \mathbf{P}(\mathcal{E}) \to X$.
Then the map
$$
\bigoplus\nolimits_{i = 0, \ldots, r - 1} H^*_{dR}(X/S)
\longrightarrow
H^*_{dR}(P/S)
$$
given by the rule
$$
(a_0, \ldots, a_{r - 1}) \longmapsto
\sum\nolimits_{i = 0, \ldots, r - 1} c_1^{dR}(\mathcal{O}_P(1))^i \cup p^*(a_i)
$$
is an isomorphism.
\end{proposition}

\begin{proof}
Choose an affine open $\Spec(A) \subset X$ such that $\mathcal{E}$ restricts
to the trivial locally free module $\mathcal{O}_{\Spec(A)}^{\oplus r}$.
Then $P \times_X \Spec(A) = \mathbf{P}^{r - 1}_A$. Thus we see that
$p$ is proper and smooth, see Section \ref{section-projective-space}.
Moreover, the classes $c_1^{dR}(\mathcal{O}_P(1))^i$, $i = 0, 1, \ldots, r - 1$
restricted to a fibre $X_y = \mathbf{P}^{r - 1}_y$ freely generate the
de Rham cohomology $H^*_{dR}(X_y/y)$ over $\kappa(y)$, see
Lemma \ref{lemma-de-rham-cohomology-projective-space}. Thus we've verified the
conditions of Proposition \ref{proposition-global-generation-on-fibres}
and we win.
\end{proof}

\begin{remark}
\label{remark-projective-space-bundle-formula}
In the situation of
Proposition \ref{proposition-projective-space-bundle-formula}
we get moreover that the map
$$
\tilde \xi :
\bigoplus\nolimits_{t = 0, \ldots, r - 1}
\Omega^\bullet_{X/S}[-2t]
\longrightarrow
Rp_*\Omega^\bullet_{P/S}
$$
is an isomorphism in $D(X, (X \to S)^{-1}\mathcal{O}_X)$ as follows
immediately from the application of
Proposition \ref{proposition-global-generation-on-fibres}.
Note that the arrow for $t = 0$ is simply the canonical map
$c_{P/X} : \Omega^\bullet_{X/S} \to Rp_*\Omega^\bullet_{P/S}$
of Section \ref{section-de-rham-complex}.
In fact, we can pin down this map further in this particular case.
Namely, consider the canonical map
$$
\xi' : \Omega^\bullet_{P/S} \to \Omega^\bullet_{P/S}[2]
$$
of Remark \ref{remark-cup-product-as-a-map} corresponding to
$c_1^{dR}(\mathcal{O}_P(1))$. Then
$$
\xi'[2(t - 1)] \circ \ldots \circ \xi'[2] \circ \xi' : 
\Omega^\bullet_{P/S} \to \Omega^\bullet_{P/S}[2t]
$$
is the map of Remark \ref{remark-cup-product-as-a-map} corresponding to
$c_1^{dR}(\mathcal{O}_P(1))^t$. Tracing through the choices made in the
proof of Proposition \ref{proposition-global-generation-on-fibres}
we find the value
$$
\tilde \xi|_{\Omega^\bullet_{X/S}[-2t]} =
Rp_*\xi'[-2] \circ \ldots \circ Rp_*\xi'[-2(t - 1)] \circ
Rp_*\xi'[-2t] \circ c_{P/X}[-2t]
$$
for the restriction of our isomorphism to the summand
$\Omega^\bullet_{X/S}[-2t]$. This has the following simple
consequence we will use below: let
$$
M = \bigoplus\nolimits_{t = 1, \ldots, r - 1} \Omega^\bullet_{X/S}[-2t]
\quad\text{and}\quad
K = \bigoplus\nolimits_{t = 0, \ldots, r - 2} \Omega^\bullet_{X/S}[-2t]
$$
viewed as subcomplexes of the source of the arrow $\tilde \xi$.
It follows formally from the discussion above that
$$
c_{P/X} \oplus
\tilde \xi|_M :
\Omega^\bullet_{X/S} \oplus M \longrightarrow
Rp_*\Omega^\bullet_{P/S}
$$
is an isomorphism and that the diagram
$$
\xymatrix{
K \ar[d]_{\tilde \xi|_K} \ar[r]_{\text{id}} &
M[2] \ar[d]^{(\tilde \xi|_M)[2]} \\
Rp_*\Omega^\bullet_{P/S} \ar[r]^{Rp_*\xi'} &
Rp_*\Omega^\bullet_{P/S}[2]
}
$$
commutes where $\text{id} : K \to M[2]$ identifies the summand
corresponding to $t$ in the deomposition of $K$ to the summand
corresponding to $t + 1$ in the decomposition of $M$.
\end{remark}









\section{Log poles along a divisor}
\label{section-divisor}

\noindent
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor. If $X$ \'etale locally along $Y$ looks
like $Y \times \mathbf{A}^1$, then there is a canonical short exact sequence
of complexes
$$
0 \to \Omega^\bullet_{X/S} \to
\Omega^\bullet_{X/S}(\log Y) \to
\Omega^\bullet_{Y/S}[-1] \to 0
$$
having many good properties we will discuss in this section. There is a
variant of this construction where one starts with a normal crossings
divisor
(\'Etale Morphisms, Definition \ref{etale-definition-strict-normal-crossings})
which we will discuss elsewhere (insert future reference here).

\begin{definition}
\label{definition-local-product}
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor. We say the
{\it de Rham complex of log poles is defined for $Y \subset X$ over $S$}
if for all $y \in Y$ and local equation $f \in \mathcal{O}_{X, y}$
of $Y$ we have
\begin{enumerate}
\item $\mathcal{O}_{X, y} \to \Omega_{X/S, y}$, $g \mapsto g \text{d}f$
is a split injection, and
\item $\Omega^p_{X/S, y}$ is $f$-torsion free for all $p$.
\end{enumerate}
\end{definition}

\noindent
An easy local calculation shows that it suffices for every $y \in Y$
to find one local equation $f$ for which conditions (1) and (2) hold.

\begin{lemma}
\label{lemma-log-complex}
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor.
Assume the de Rham complex of log poles is defined for $Y \subset X$ over $S$.
There is a canonical short exact sequence
of complexes
$$
0 \to \Omega^\bullet_{X/S} \to
\Omega^\bullet_{X/S}(\log Y) \to
\Omega^\bullet_{Y/S}[-1] \to 0
$$
\end{lemma}

\begin{proof}
Our assumption is that for every $y \in Y$ and local equation
$f \in \mathcal{O}_{X, y}$ of $Y$ we have
$$
\Omega_{X/S, y} = \mathcal{O}_{X, y}\text{d}f \oplus M
\quad\text{and}\quad
\Omega^p_{X/S, y} = \wedge^{p - 1}(M)\text{d}f \oplus \wedge^p(M)
$$
for some module $M$ with $f$-torsion free exterior powers $\wedge^p(M)$.
It follows that
$$
\Omega^p_{Y/S, y} = \wedge^p(M/fM) = \wedge^p(M)/f\wedge^p(M)
$$
Below we will tacitly use these facts.
In particular the sheaves $\Omega^p_{X/S}$ have no nonzero local
sections supported on $Y$ and we have a canonical inclusion
$$
\Omega^p_{X/S} \subset \Omega^p_{X/S}(Y)
$$
see More on Flatness, Section \ref{flat-section-eta}. Let $U = \Spec(A)$
be an affine open subscheme such that $Y \cap U = V(f)$ for some
nonzerodivisor $f \in A$. Let us consider the $\mathcal{O}_U$-submodule
of $\Omega^p_{X/S}(Y)|_U$ generated by
$\Omega^p_{X/S}|_U$ and $\text{d}\log(f) \wedge \Omega^{p - 1}_{X/S}$
where $\text{d}\log(f) = f^{-1}\text{d}(f)$.
This is independent of the choice of $f$ as another generator of the
ideal of $Y$ on $U$ is equal to $uf$ for a unit $u \in A$ and we get
$$
\text{d}\log(uf) - \text{d}\log(f) = \text{d}\log(u) = u^{-1}\text{d}u
$$
which is a section of $\Omega_{X/S}$ over $U$. These local
sheaves glue to give a quasi-coherent submodule
$$
\Omega^p_{X/S} \subset \Omega^p_{X/S}(\log Y) \subset \Omega^p_{X/S}(Y)
$$
Let us agree to think of $\Omega^p_{Y/S}$ as a quasi-coherent
$\mathcal{O}_X$-module. There is a unique surjective
$\mathcal{O}_X$-linear map
$$
\text{Res} : \Omega^p_{X/S}(\log Y) \to \Omega^{p - 1}_{Y/S}
$$
defined by the rule
$$
\text{Res}(\eta' + \text{d}\log(f) \wedge \eta) = \eta|_{Y \cap U}
$$
for all opens $U$ as above and all
$\eta' \in \Omega^p_{X/S}(U)$ and $\eta \in \Omega^{p - 1}_{X/S}(U)$.
If a form $\eta$ over $U$ restricts to zero on $Y \cap U$, then
$\eta = \text{d}f \wedge \eta' + f\eta''$ for some forms $\eta'$ and $\eta''$
over $U$. We conclude that
we have a short exact sequence
$$
0 \to \Omega^p_{X/S} \to \Omega^p_{X/S}(\log Y) \to \Omega^{p - 1}_{Y/S} \to 0
$$
for all $p$. We still have to define the differentials
$\Omega^p_{X/S}(\log Y) \to \Omega^{p + 1}_{X/S}(\log Y)$.
On the subsheaf $\Omega^p_{X/S}$ we use the differential of
the de Rham complex of $X$ over $S$. Finally, we define
$\text{d}(\text{d}\log(f) \wedge \eta) = -\text{d}\log(f) \wedge \text{d}\eta$.
The sign is forced on us by the Leibniz rule (on $\Omega^\bullet_{X/S}$)
and it is compatible with the differential on $\Omega^\bullet_{Y/S}[-1]$
which is after all $-\text{d}_{Y/S}$ by our sign convention in
Homology, Definition \ref{homology-definition-shift-cochain}.
In this way we obtain a short exact
sequence of complexes as stated in the lemma.
\end{proof}

\begin{definition}
\label{definition-log-complex}
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor. Assume the de Rham complex of log poles
is defined for $Y \subset X$ over $S$. Then the complex
$$
\Omega^\bullet_{X/S}(\log Y)
$$
constructed in Lemma \ref{lemma-log-complex} is the
{\it de Rham complex of log poles for $Y \subset X$ over $S$}.
\end{definition}

\noindent
This complex has many good properties.

\begin{lemma}
\label{lemma-multiplication-log}
Let $p : X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor. Assume the de Rham complex of log poles
is defined for $Y \subset X$ over $S$.
\begin{enumerate}
\item The maps
$\wedge : \Omega^p_{X/S} \times \Omega^q_{X/S} \to \Omega^{p + q}_{X/S}$
extend uniquely to $\mathcal{O}_X$-bilinear maps
$$
\wedge : \Omega^p_{X/S}(\log Y) \times \Omega^q_{X/S}(\log Y)
\to \Omega^{p + q}_{X/S}(\log Y)
$$
satisfying the Leibniz rule
$
\text{d}(\omega \wedge \eta) = \text{d}(\omega) \wedge \eta +
(-1)^{\deg(\omega)} \omega \wedge \text{d}(\eta)$,
\item with multiplication as in (1) the map
$\Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}(\log(Y)$
is a homomorphism of differential graded $\mathcal{O}_S$-algebras,
\item via the maps in (1) we have $\Omega^p_{X/S}(\log Y) =
\wedge^p(\Omega^1_{X/S}(\log Y))$, and
\item the map
$\text{Res} : \Omega^\bullet_{X/S}(\log Y) \to \Omega^\bullet_{Y/S}[-1]$
satisfies
$$
\text{Res}(\omega \wedge \eta) = \text{Res}(\omega) \wedge \eta|_Y
$$
for $\omega$ a local section of $\Omega^p_{X/S}(\log Y)$ and $\eta$
a local section of $\Omega^q_{X/S}$.
\end{enumerate}
\end{lemma}

\begin{proof}
This follows by direct calculation from the local construction
of the complex in the proof of Lemma \ref{lemma-log-complex}.
Details omitted.
\end{proof}

\noindent
Consider a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes. Let $Y \subset X$ be an effective Cartier divisor
whose pullback $Y' = f^*Y$ is defined
(Divisors, Definition
\ref{divisors-definition-pullback-effective-Cartier-divisor}).
Assume
the de Rham complex of log poles is defined for $Y \subset X$ over $S$
and
the de Rham complex of log poles is defined for $Y' \subset X'$ over $S'$.
In this case we obtain a map of short exact sequences of complexes
$$
\xymatrix{
0 \ar[r] &
f^{-1}\Omega^\bullet_{X/S} \ar[r] \ar[d] &
f^{-1}\Omega^\bullet_{X/S}(\log Y) \ar[r] \ar[d] &
f^{-1}\Omega^\bullet_{Y/S}[-1] \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\Omega^\bullet_{X'/S'} \ar[r] &
\Omega^\bullet_{X'/S'}(\log Y') \ar[r] &
\Omega^\bullet_{Y'/S'}[-1] \ar[r] &
0
}
$$
Linearizing, for every $p$ we obtain a linear map
$f^*\Omega^p_{X/S}(\log Y) \to \Omega^p_{X'/S'}(\log Y')$.

\begin{lemma}
\label{lemma-gysin-via-log-complex}
Let $f : X \to S$ be a morphism of schemes. Let $Y \subset X$ be an effective
Cartier divisor. Assume the de Rham complex of log poles is defined for
$Y \subset X$ over $S$. Denote
$$
\delta : \Omega^\bullet_{Y/S} \to \Omega^\bullet_{X/S}[2]
$$
in $D(X, f^{-1}\mathcal{O}_S)$ the ``boundary'' map coming from the
short exact sequence in Lemma \ref{lemma-log-complex}. Denote
$$
\xi' : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[2]
$$
in $D(X, f^{-1}\mathcal{O}_S)$ the map of
Remark \ref{remark-cup-product-as-a-map}
corresponding to $\xi = c_1^{dR}(\mathcal{O}_X(-Y))$. Denote
$$
\zeta' : \Omega^\bullet_{Y/S} \to \Omega^\bullet_{Y/S}[2]
$$
in $D(Y, f|_Y^{-1}\mathcal{O}_S)$ the map of
Remark \ref{remark-cup-product-as-a-map} corresponding to
$\zeta = c_1^{dR}(\mathcal{O}_X(-Y)|_Y)$. Then the diagram
$$
\xymatrix{
\Omega^\bullet_{X/S} \ar[d]_{\xi'} \ar[r] &
\Omega^\bullet_{Y/S} \ar[d]^{\zeta'} \ar[ld]_\delta \\
\Omega^\bullet_{X/S}[2] \ar[r] &
\Omega^\bullet_{Y/S}[2]
}
$$
is commutative in $D(X, f^{-1}\mathcal{O}_S)$.
\end{lemma}

\begin{proof}
More precisely, we define $\delta$ as the boundary map corresponding to the
shifted short exact sequence
$$
0 \to \Omega^\bullet_{X/S}[1] \to
\Omega^\bullet_{X/S}(\log Y)[1] \to
\Omega^\bullet_{Y/S} \to 0
$$
It suffices to prove each triangle commutes. Set
$\mathcal{L} = \mathcal{O}_X(-Y)$. Denote $\pi : L \to X$ the line bundle
with $\pi_*\mathcal{O}_L = \bigoplus_{n \geq 0} \mathcal{L}^{\otimes n}$.

\medskip\noindent
Commutativity of the upper left triangle.
By Lemma \ref{lemma-the-complex-for-L-star-gives-chern-class}
the map $\xi'$ is the boundary map of the triangle given in
Lemma \ref{lemma-the-complex-for-L-star}.
By functoriality it suffices to prove there exists a morphism of
short exact sequences
$$
\xymatrix{
0 \ar[r] &
\Omega^\bullet_{X/S}[1] \ar[r] \ar[d] &
\Omega^\bullet_{L^\star/S, 0}[1] \ar[r] \ar[d] &
\Omega^\bullet_{X/S} \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\Omega^\bullet_{X/S}[1] \ar[r] &
\Omega^\bullet_{X/S}(\log Y)[1] \ar[r] &
\Omega^\bullet_{Y/S} \ar[r] &
0
}
$$
where the left and right vertical arrows are the obvious ones.
We can define the middle vertical arrow by the rule
$$
\omega' + \text{d}\log(s) \wedge \omega \longmapsto
\omega' + \text{d}\log(f) \wedge \omega
$$
where $\omega', \omega$ are local sections of $\Omega^\bullet_{X/S}$
and where $s$ is a local generator of $\mathcal{L}$ and
$f \in \mathcal{O}_X(-Y)$ is the corresponding section of the ideal
sheaf of $Y$ in $X$. Since the constructions of the maps in
Lemmas \ref{lemma-the-complex-for-L-star} and \ref{lemma-log-complex}
match exactly, this works.

\medskip\noindent
Commutativity of the lower right triangle. Denote
$\overline{L}$ the restriction of $L$ to $Y$.
By Lemma \ref{lemma-the-complex-for-L-star-gives-chern-class}
the map $\zeta'$ is the boundary map of the triangle given in
Lemma \ref{lemma-the-complex-for-L-star} using the line bundle
$\overline{L}$ on $Y$.
By functoriality it suffices to prove there exists a morphism of
short exact sequences
$$
\xymatrix{
0 \ar[r] &
\Omega^\bullet_{X/S}[1] \ar[r] \ar[d] &
\Omega^\bullet_{X/S}(\log Y)[1] \ar[r] \ar[d] &
\Omega^\bullet_{Y/S} \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\Omega^\bullet_{Y/S}[1] \ar[r] &
\Omega^\bullet_{\overline{L}^\star/S, 0}[1] \ar[r] &
\Omega^\bullet_{Y/S} \ar[r] &
0 \\
}
$$
where the left and right vertical arrows are the obvious ones.
We can define the middle vertical arrow by the rule
$$
\omega' + \text{d}\log(f) \wedge \omega \longmapsto
\omega'|_Y + \text{d}\log(\overline{s}) \wedge \omega|_Y
$$
where $\omega', \omega$ are local sections of $\Omega^\bullet_{X/S}$
and where $f$ is a local generator of $\mathcal{O}_X(-Y)$ viewed as
a function on $X$ and where $\overline{s}$ is $f|_Y$ viewed as a
section of $\mathcal{L}|_Y = \mathcal{O}_X(-Y)|_Y$.
Since the constructions of the maps in
Lemmas \ref{lemma-the-complex-for-L-star} and \ref{lemma-log-complex}
match exactly, this works.
\end{proof}

\begin{lemma}
\label{lemma-log-complex-consequence}
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an effective
Cartier divisor. Assume the de Rham complex of log poles is defined for
$Y \subset X$ over $S$. Let $b \in H^m_{dR}(X/S)$ be a de Rham cohomology
class whose restriction to $Y$ is zero. Then
$c_1^{dR}(\mathcal{O}_X(Y)) \cup b = 0$ in $H^{m + 2}_{dR}(X/S)$.
\end{lemma}

\begin{proof}
This follows immediately from Lemma \ref{lemma-gysin-via-log-complex}.
Namely, we have
$$
c_1^{dR}(\mathcal{O}_X(Y)) \cup b =
-c_1^{dR}(\mathcal{O}_X(-Y)) \cup b = -\xi'(b) = -\delta(b|_Y) = 0
$$
as desired. For the second equality, see
Remark \ref{remark-cup-product-as-a-map}.
\end{proof}

\begin{lemma}
\label{lemma-check-log-smooth}
Let $X \to T \to S$ be morphisms of schemes. Let $Y \subset X$ be an effective
Cartier divisor. If both $X \to T$ and $Y \to T$ are smooth, then
the de Rham complex of log poles is defined for $Y \subset X$ over $S$.
\end{lemma}

\begin{proof}
Let $y \in Y$ be a point.
By More on Morphisms, Lemma \ref{more-morphisms-lemma-etale-local-structure}
there exists an integer $0 \geq m$ and a commutative diagram
$$
\xymatrix{
Y \ar[d] &
V \ar[l] \ar[d] \ar[r] &
\mathbf{A}^m_T
\ar[d]^{(a_1, \ldots, a_m) \mapsto (a_1, \ldots, a_m, 0)} \\
X &
U \ar[l] \ar[r]^-\pi &
\mathbf{A}^{m + 1}_T
}
$$
where $U \subset X$ is open, $V = Y \cap U$,
$\pi$ is \'etale, $V = \pi^{-1}(\mathbf{A}^m_T)$, and $y \in V$.
Denote $z \in \mathbf{A}^m_T$ the image of $y$. Then we have
$$
\Omega^p_{X/S, y} = \Omega^p_{\mathbf{A}^{m + 1}_T/S, z}
\otimes_{\mathcal{O}_{\mathbf{A}^{m + 1}_T, z}} \mathcal{O}_{X, x}
$$
by Lemma \ref{lemma-etale}. Denote $x_1, \ldots, x_{m + 1}$
the coordinate functions on $\mathbf{A}^{m + 1}_T$.
Since the conditions (1) and (2) in Definition \ref{definition-local-product}
do not depend on the choice of the local coordinate,
it suffices to check the conditions (1) and (2) when $f$ is the
image of $x_{m + 1}$ by the flat local ring homomorphism
$\mathcal{O}_{\mathbf{A}^{m + 1}_T, z} \to \mathcal{O}_{X, x}$.
In this way we see that it suffices to check conditions (1) and (2)
for $\mathbf{A}^m_T \subset \mathbf{A}^{m + 1}_T$ and the point $z$.
To prove this case we may assume $S = \Spec(A)$ and $T = \Spec(B)$
are affine. Let $A \to B$ be the ring map corresponding to the morphism
$T \to S$ and set $P = B[x_1, \ldots, x_{m + 1}]$ so that
$\mathbf{A}^{m + 1}_T = \Spec(P)$. We have
$$
\Omega_{P/A} = \Omega_{B/A} \otimes_B P \oplus
\bigoplus\nolimits_{j = 1, \ldots, m} P \text{d}x_j \oplus
P \text{d}x_{m + 1}
$$
Hence the map $P \to \Omega_{P/A}$, $g \mapsto g \text{d}x_{m + 1}$
is a split injection and $x_{m + 1}$ is a nonzerodivisor on
$\Omega^p_{P/A}$ for all $p \geq 0$. Localizing at the prime ideal
corresponding to $z$ finishes the proof.
\end{proof}

\begin{remark}
\label{remark-check-log-completion-1}
Let $S$ be a locally Noetherian scheme. Let $X$ be locally of finite
type over $S$. Let $Y \subset X$ be an effective Cartier divisor.
If the map
$$
\mathcal{O}_{X, y}^\wedge \longrightarrow \mathcal{O}_{Y, y}^\wedge
$$
has a section for all $y \in Y$, then
the de Rham complex of log poles is defined for $Y \subset X$ over $S$.
If we ever need this result we will formulate a precise statement and
add a proof here.
\end{remark}

\begin{remark}
\label{remark-check-log-completion-2}
Let $S$ be a locally Noetherian scheme. Let $X$ be locally of finite
type over $S$. Let $Y \subset X$ be an effective Cartier divisor.
If for every $y \in Y$ we can find a diagram of schemes over $S$
$$
X \xleftarrow{\varphi} U \xrightarrow{\psi} V
$$
with $\varphi$ \'etale and $\psi|_{\varphi^{-1}(Y)} : \varphi^{-1}(Y) \to V$
\'etale, then the de Rham complex of log poles is defined for
$Y \subset X$ over $S$. A special case is when the pair $(X, Y)$
\'etale locally looks like $(V \times \mathbf{A}^1, V \times \{0\})$.
If we ever need this result we will formulate
a precise statement and add a proof here.
\end{remark}

















\section{Calculations}
\label{section-calculations}

\noindent
In this section we calculate some Hodge and de Rham cohomology
groups for a standard blowing up.

\medskip\noindent
We fix a ring $R$ and we set $S = \Spec(R)$. Fix integers $0 \leq m$ and
$1 \leq n$. Consider the closed immersion
$$
Z = \mathbf{A}^m_S \longrightarrow \mathbf{A}^{m + n}_S = X,\quad
(a_1, \ldots, a_m) \mapsto (a_1, \ldots, a_m, 0, \ldots 0).
$$
We are going to consider the blowing up $L$ of $X$
along the closed subscheme $Z$. Write
$$
X =
\mathbf{A}^{m + n}_S =
\Spec(A)
\quad\text{with}\quad
A = R[x_1, \ldots, x_m, y_1, \ldots, y_n]
$$
We will consider $A = R[x_1, \ldots, x_m, y_1, \ldots, y_n]$ as a
graded $R$-algebra by setting $\deg(x_i) = 0$ and $\deg(y_j) = 1$.
With this grading we have
$$
P =
\text{Proj}(A) =
\mathbf{A}^m_S \times_S \mathbf{P}^{n - 1}_S =
Z \times_S \mathbf{P}^{n - 1}_S =
\mathbf{P}^{n - 1}_Z
$$
Observe that the ideal cutting out $Z$ in $X$ is the ideal $A_+$.
Hence $L$ is the Proj of the Rees algebra
$$
A \oplus A_+ \oplus (A_+)^2 \oplus \ldots =
\bigoplus\nolimits_{d \geq 0} A_{\geq d}
$$
Hence $L$ is an example of the phenomenon studied in
more generality in More on Morphisms, Section
\ref{more-morphisms-section-proj-spec};
we will use the observations we made there without further mention.
In particular, we have a commutative diagram
$$
\xymatrix{
P \ar[r]_0 \ar[d]_p &
L \ar[r]_-\pi \ar[d]^b &
P \ar[d]^p \\
Z \ar[r]^i &
X \ar[r] &
Z
}
$$
such that $\pi : L \to P$ is a line bundle over
$P = Z \times_S \mathbf{P}^{n - 1}_S$
with zero section $0$ whose image $E = 0(P) \subset L$
is the exceptional divisor of the blowup $b$.

\begin{lemma}
\label{lemma-comparison}
For $a \geq 0$ we have
\begin{enumerate}
\item the map
$\Omega^a_{X/S} \to b_*\Omega^a_{L/S}$ is an isomorphism,
\item the map $\Omega^a_{Z/S} \to p_*\Omega^a_{P/S}$ is an isomorphism,
and
\item the map $Rb_*\Omega^a_{L/S} \to i_*Rp_*\Omega^a_{P/S}$ is an isomorphism
on cohomology sheaves in degree $\geq 1$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let us first prove part (2). Since
$P = Z \times_S \mathbf{P}^{n - 1}_S$
we see that
$$
\Omega^a_{P/S} = \bigoplus\nolimits_{a = r + s}
\text{pr}_1^*\Omega^r_{Z/S} \otimes
\text{pr}_2^*\Omega^s_{\mathbf{P}^{n - 1}_S/S}
$$
Recalling that $p = \text{pr}_1$ by the projection formula
(Cohomology, Lemma \ref{cohomology-lemma-projection-formula})
we obtain
$$
p_*\Omega^a_{P/S} = \bigoplus\nolimits_{a = r + s}
\Omega^r_{Z/S} \otimes
\text{pr}_{1, *}\text{pr}_2^*\Omega^s_{\mathbf{P}^{n - 1}_S/S}
$$
By the calculations in Section \ref{section-projective-space}
and in particular in
the proof of Lemma \ref{lemma-hodge-cohomology-projective-space}
we have $\text{pr}_{1, *}\text{pr}_2^*\Omega^s_{\mathbf{P}^{n - 1}_S/S} = 0$
except if $s = 0$ in which case we get
$\text{pr}_{1, *}\mathcal{O}_P = \mathcal{O}_Z$.
This proves (2).

\medskip\noindent
By the material in Section \ref{section-line-bundle} and in particular
Lemma \ref{lemma-push-omega-a} we have
$\pi_*\Omega^a_{L/S} = \Omega^a_{P/S} \oplus
\bigoplus_{k \geq 1} \Omega^a_{L/S, k}$.
Since the composition $\pi \circ 0$ in the diagram above
is the identity morphism on $P$ to prove part (3) it suffices to show that
$\Omega^a_{L/S, k}$ has vanishing higher cohomology for $k > 0$.
By Lemmas \ref{lemma-the-complex-for-L-star} and \ref{lemma-push-omega-a}
there are short exact sequences
$$
0 \to \Omega^a_{P/S} \otimes \mathcal{O}_P(k)
\to \Omega^a_{L/S, k} \to
\Omega^{a - 1}_{P/S} \otimes \mathcal{O}_P(k) \to 0
$$
where $\Omega^{a - 1}_{P/S} = 0$ if $a = 0$. Since
$P = Z \times_S \mathbf{P}^{n - 1}_S$ we have
$$
\Omega^a_{P/S} = \bigoplus\nolimits_{i + j = a}
\Omega^i_{Z/S} \boxtimes \Omega^j_{\mathbf{P}^{n - 1}_S/S}
$$
by Lemma \ref{lemma-de-rham-complex-product}.
Since $\Omega^i_{Z/S}$ is free of finite rank
we see that it suffices to show that the higher cohomology of
$\mathcal{O}_Z \boxtimes \Omega^j_{\mathbf{P}^{n - 1}_S/S}(k)$
is zero for $k > 0$. This follows from
Lemma \ref{lemma-twisted-hodge-cohomology-projective-space}
applied to $P = Z \times_S \mathbf{P}^{n - 1}_S = \mathbf{P}^{n - 1}_Z$
and the proof of (3) is complete.

\medskip\noindent
We still have to prove (1). If $n = 1$, then we are blowing
up an effective Cartier divisor and $b$ is an isomorphism
and we have (1). If $n > 1$, then the composition
$$
\Gamma(X, \Omega^a_{X/S})
\to
\Gamma(L, \Omega^a_{L/S})
\to
\Gamma(L \setminus E, \Omega^a_{L/S})
=
\Gamma(X \setminus Z, \Omega^a_{X/S})
$$
is an isomorphism as $\Omega^a_{X/S}$ is finite free
(small detail omitted). Thus the only way (1) can fail is if
there are nonzero elements of $\Gamma(L, \Omega^a_{L/S})$ which vanish
outside of $E = 0(P)$. Since $L$ is a line bundle over $P$
with zero section $0 : P \to L$, it suffices to show that
on a line bundle there are no nonzero sections of a sheaf
of differentials which vanish identically outside the zero section.
The reader sees this is true either (preferably) by a local calculation
or by using that $\Omega_{L/S, k} \subset \Omega_{L^\star/S, k}$
(see references above).
\end{proof}

\noindent
We suggest the reader skip to the next section at this point.

\begin{lemma}
\label{lemma-comparison-bis}
For $a \geq 0$ there are canonical maps
$$
b^*\Omega^a_{X/S} \longrightarrow
\Omega^a_{L/S} \longrightarrow
b^*\Omega^a_{X/S} \otimes_{\mathcal{O}_L} \mathcal{O}_L((n - 1)E)
$$
whose composition is induced by the inclusion
$\mathcal{O}_L \subset \mathcal{O}_L((n - 1)E)$.
\end{lemma}

\begin{proof}
The first arrow in the displayed formula is
discussed in Section \ref{section-de-rham-complex}.
To get the second arrow we have to show that if we view
a local section of $\Omega^a_{L/S}$ as a ``meromorphic section''
of $b^*\Omega^a_{X/S}$, then it has a pole of order at most
$n - 1$ along $E$. To see this we work on affine local charts
on $L$. Namely, recall that $L$ is covered by the spectra of the
affine blowup algebras $A[\frac{I}{y_i}]$ where $I = A_{+}$
is the ideal generated by $y_1, \ldots, y_n$. See
Algebra, Section \ref{algebra-section-blow-up} and
Divisors, Lemma \ref{divisors-lemma-blowing-up-affine}.
By symmetry it is enough to work on the
chart corresponding to $i = 1$. Then
$$
A[\frac{I}{y_1}] = R[x_1, \ldots, x_m, y_1, t_2, \ldots, t_n]
$$
where $t_i = y_i/y_1$, see
More on Algebra, Lemma \ref{more-algebra-lemma-blowup-regular-sequence}.
Thus the module $\Omega^1_{L/S}$ is over the corresponding
affine open freely generated by
$\text{d}x_1, \ldots, \text{d}x_m$, $\text{d}y_1$, and
$\text{d}t_1, \ldots, \text{d}t_n$.
Of course, the first $m + 1$ of these generators come from
$b^*\Omega^1_{X/S}$ and for the remaining $n - 1$ we have
$$
\text{d}t_j =
\text{d}\frac{y_j}{y_1} =
\frac{1}{y_1}\text{d}y_j - \frac{y_j}{y_1^2}\text{d}y_1 =
\frac{\text{d}y_j - t_j \text{d}y_1}{y_1}
$$
which has a pole of order $1$ along $E$ since $E$ is cut out by $y_1$
on this chart. Since the wedges of $a$ of these elements give a basis
of $\Omega^a_{L/S}$ over this chart, and since there are at most
$n - 1$ of the $\text{d}t_j$ involved this finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-blowup-twist-same-cohomology}
Let $E = 0(P)$ be the exceptional divisor of the blowing up $b$.
For any locally free $\mathcal{O}_X$-module $\mathcal{E}$ and
$0 \leq i \leq n - 1$ the map
$$
\mathcal{E}
\longrightarrow
Rb_*(b^*\mathcal{E} \otimes_{\mathcal{O}_L} \mathcal{O}_L(iE))
$$
is an isomorphism in $D(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
By the projection formula it is enough to show this for
$\mathcal{E} = \mathcal{O}_X$, see Cohomology, Lemma
\ref{cohomology-lemma-projection-formula}.
Since $X$ is affine it suffices to show that the maps
$$
H^0(X, \mathcal{O}_X) \to
H^0(L, \mathcal{O}_L) \to
H^0(L, \mathcal{O}_L(iE))
$$
are isomorphisms and that $H^j(X, \mathcal{O}_L(iE)) = 0$
for $j > 0$ and $0 \leq i \leq n - 1$, see Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherence-higher-direct-images-application}.
Since $\pi$ is affine, we can compute global sections and
cohomology after taking $\pi_*$, see Cohomology of Schemes, Lemma
\ref{coherent-lemma-relative-affine-cohomology}. If $n = 1$, then
$L \to X$ is an isomorphism and $i = 0$ hence the first statement holds.
If $n > 1$, then we consider the composition
$$
H^0(X, \mathcal{O}_X) \to H^0(L, \mathcal{O}_L) \to
H^0(L, \mathcal{O}_L(iE)) \to H^0(L \setminus E, \mathcal{O}_L) =
H^0(X \setminus Z, \mathcal{O}_X)
$$
Since
$H^0(X \setminus Z, \mathcal{O}_X) = H^0(X, \mathcal{O}_X)$ in this
case as $Z$ has codimension $n \geq 2$ in $X$ (details omitted) we conclude
the first statement holds. For the second, recall that
$\mathcal{O}_L(E) = \mathcal{O}_L(-1)$, see Divisors, Lemma
\ref{divisors-lemma-blowing-up-gives-effective-Cartier-divisor}.
Hence we have
$$
\pi_*\mathcal{O}_L(iE) =
\pi_*\mathcal{O}_L(-i) =
\bigoplus\nolimits_{k \geq -i} \mathcal{O}_P(k)
$$
as discussed in
More on Morphisms, Section \ref{more-morphisms-section-proj-spec}.
Thus we conclude by the vanishing of the cohomology of twists
of the structure sheaf on $P = \mathbf{P}^{n - 1}_Z$
shown in Cohomology of Schemes, Lemma
\ref{coherent-lemma-cohomology-projective-space-over-ring}.
\end{proof}























\section{Blowing up and de Rham cohomology}
\label{section-blowing-up}

\noindent
Fix a base scheme $S$, a smooth morphism $X \to S$, and a closed subscheme
$Z \subset X$ which is also smooth over $S$. Denote $b : X' \to X$
the blowing up of $X$ along $Z$. Denote $E \subset X'$ the exceptional
divisor. Picture
\begin{equation}
\label{equation-blowup}
\vcenter{
\xymatrix{
E \ar[r]_j \ar[d]_p & X' \ar[d]^b \\
Z \ar[r]^i & X
}
}
\end{equation}
Our goal in this section is to prove that the map
$b^* : H_{dR}^*(X/S) \longrightarrow H_{dR}^*(X'/S)$
is injective (although a lot more can be said).

\begin{lemma}
\label{lemma-comparison-general}
With notation as in More on Morphisms, Lemma \ref{more-morphisms-lemma-blowup}
for $a \geq 0$ we have
\begin{enumerate}
\item the map
$\Omega^a_{X/S} \to b_*\Omega^a_{X'/S}$ is an isomorphism,
\item the map $\Omega^a_{Z/S} \to p_*\Omega^a_{E/S}$ is an isomorphism,
\item the map $Rb_*\Omega^a_{X'/S} \to i_*Rp_*\Omega^a_{E/S}$ is an isomorphism
on cohomology sheaves in degree $\geq 1$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\epsilon : X_1 \to X$ be a surjective \'etale morphism. Denote
$i_1 : Z_1 \to X_1$, $b_1 : X'_1 \to X_1$, $E_1 \subset X'_1$, and
$p_1 : E_1 \to Z_1$ the base changes of the objects considered in
More on Morphisms, Lemma \ref{more-morphisms-lemma-blowup}.
Observe that $i_1$ is a closed immersion
of schemes smooth over $S$ and that $b_1$ is the blowing up with center
$Z_1$ by Divisors, Lemma \ref{divisors-lemma-flat-base-change-blowing-up}.
Suppose that we can prove (1), (2), and (3)
for the morphisms $b_1$, $p_1$, and $i_1$. Then by
Lemma \ref{lemma-etale} we obtain that the pullback by $\epsilon$
of the maps in (1), (2), and (3) are isomorphisms. As $\epsilon$
is a surjective flat morphism we conclude.
Thus working \'etale locally, by
More on Morphisms, Lemma \ref{more-morphisms-lemma-etale-local-structure},
we may assume we are in the situation discussed in
Section \ref{section-calculations}. In this case the lemma
is the same as Lemma \ref{lemma-comparison}.
\end{proof}

\begin{lemma}
\label{lemma-distinguished-triangle-blowup}
With notation as in More on Morphisms, Lemma \ref{more-morphisms-lemma-blowup}
and denoting $f : X \to S$ the structure morphism there is a canonical
distinguished triangle
$$
\Omega^\bullet_{X/S} \to
Rb_*(\Omega^\bullet_{X'/S}) \oplus i_*\Omega^\bullet_{Z/S} \to
i_*Rp_*(\Omega^\bullet_{E/S}) \to
\Omega^\bullet_{X/S}[1]
$$
in $D(X, f^{-1}\mathcal{O}_S)$ where the four maps
$$
\begin{matrix}
\Omega^\bullet_{X/S} & \to & Rb_*(\Omega^\bullet_{X'/S}), \\
\Omega^\bullet_{X/S} & \to & i_*\Omega^\bullet_{Z/S}, \\
Rb_*(\Omega^\bullet_{X'/S}) & \to & i_*Rp_*(\Omega^\bullet_{E/S}), \\
i_*\Omega^\bullet_{Z/S} & \to & i_*Rp_*(\Omega^\bullet_{E/S})
\end{matrix}
$$
are the canonical ones (Section \ref{section-de-rham-complex}),
except with sign reversed for one of them.
\end{lemma}

\begin{proof}
Choose a distinguished triangle
$$
C \to Rb_*\Omega^\bullet_{X'/S} \oplus i_*\Omega^\bullet_{Z/S}
\to i_*Rp_*\Omega^\bullet_{E/S} \to C[1]
$$
in $D(X, f^{-1}\mathcal{O}_S)$. It suffices to show that
$\Omega^\bullet_{X/S}$ is isomorphic to $C$ in a manner compatible
with the canonical maps. By the axioms of triangulated categories
there exists a map of distinguished triangles
$$
\xymatrix{
C' \ar[r] \ar[d] &
b_*\Omega^\bullet_{X'/S} \oplus i_*\Omega^\bullet_{Z/S} \ar[r] \ar[d] &
i_*p_*\Omega^\bullet_{E/S} \ar[r] \ar[d] &
C'[1] \ar[d] \\
C \ar[r] &
Rb_*\Omega^\bullet_{X'/S} \oplus i_*\Omega^\bullet_{Z/S} \ar[r] &
i_*Rp_*\Omega^\bullet_{E/S} \ar[r] &
C[1]
}
$$
By Lemma \ref{lemma-comparison-general} part (3) and
Derived Categories, Proposition \ref{derived-proposition-9} we conclude that
$C' \to C$ is an isomorphism. By Lemma \ref{lemma-comparison-general} part (2)
the map $i_*\Omega^\bullet_{Z/S} \to i_*p_*\Omega^\bullet_{E/S}$
is an isomorphism. Thus $C' = b_*\Omega^\bullet_{X'/S}$
in the derived category. Finally we use Lemma \ref{lemma-comparison-general}
part (1) tells us this is equal to $\Omega^\bullet_{X/S}$.
We omit the verification this is compatible with the canonical maps.
\end{proof}

\begin{proposition}
\label{proposition-blowup-split}
With notation as in More on Morphisms, Lemma \ref{more-morphisms-lemma-blowup}
the map $\Omega^\bullet_{X/S} \to Rb_*\Omega^\bullet_{X'/S}$
has a splitting in $D(X, (X \to S)^{-1}\mathcal{O}_S)$.
\end{proposition}

\begin{proof}
Consider the triangle constructed in
Lemma \ref{lemma-distinguished-triangle-blowup}.
We claim that the map
$$
Rb_*(\Omega^\bullet_{X'/S}) \oplus i_*\Omega^\bullet_{Z/S} \to
i_*Rp_*(\Omega^\bullet_{E/S})
$$
has a splitting whose image contains the summand $i_*\Omega^\bullet_{Z/S}$.
By Derived Categories, Lemma \ref{derived-lemma-split} this will show that
the first arrow of the triangle has a splitting which vanishes on
the summand $i_*\Omega^\bullet_{Z/S}$ which proves the lemma.
We will prove the claim by decomposing $Rp_*\Omega^\bullet_{E/S}$
into a direct sum where the first piece corresponds to
$\Omega^\bullet_{Z/S}$ and the second piece can be lifted
through $Rb_*\Omega^\bullet_{X'/S}$.

\medskip\noindent
Proof of the claim. We may decompose $X$ into open and closed subschemes
having fixed relative dimension to $S$, see
Morphisms, Lemma \ref{morphisms-lemma-smooth-omega-finite-locally-free}.
Since the derived category $D(X, f^{-1}\mathcal{O})_S)$ correspondingly
decomposes as a product of categories, we may assume $X$ has
fixed relative dimension $N$ over $S$. We may decompose
$Z = \coprod Z_m$ into open and closed subschemes of relative
dimension $m \geq 0$ over $S$. The restriction $i_m : Z_m \to X$ of
$i$ to $Z_m$ is a regular immersion of codimension $N - m$, see Divisors, Lemma
\ref{divisors-lemma-immersion-smooth-into-smooth-regular-immersion}.
Let $E = \coprod E_m$ be the corresponding decomposition, i.e.,
we set $E_m = p^{-1}(Z_m)$. If $p_m : E_m \to Z_m$ denotes the
restriction of $p$ to $E_m$, then we have a canonical isomorphism
$$
\tilde \xi_m :
\bigoplus\nolimits_{t = 0, \ldots, N - m - 1}
\Omega^\bullet_{Z_m/S}[-2t]
\longrightarrow
Rp_{m, *}\Omega^\bullet_{E_m/S}
$$
in $D(Z_m, (Z_m \to S)^{-1}\mathcal{O}_S)$
where in degree $0$ we have the canonical map
$\Omega^\bullet_{Z_m/S} \to Rp_{m, *}\Omega^\bullet_{E_m/S}$.
See Remark \ref{remark-projective-space-bundle-formula}.
Thus we have an isomorphism
$$
\tilde \xi :
\bigoplus\nolimits_m
\bigoplus\nolimits_{t = 0, \ldots, N - m - 1}
\Omega^\bullet_{Z_m/S}[-2t]
\longrightarrow
Rp_*(\Omega^\bullet_{E/S})
$$
in $D(Z, (Z \to S)^{-1}\mathcal{O}_S)$
whose restriction to the summand
$\Omega^\bullet_{Z/S} = \bigoplus \Omega^\bullet_{Z_m/S}$ of the source
is the canonical map $\Omega^\bullet_{Z/S} \to Rp_*(\Omega^\bullet_{E/S})$.
Consider the subcomplexes $M_m$ and $K_m$ of the complex
$\bigoplus\nolimits_{t = 0, \ldots, N - m - 1} \Omega^\bullet_{Z_m/S}[-2t]$
introduced in Remark \ref{remark-projective-space-bundle-formula}.
We set
$$
M = \bigoplus M_m
\quad\text{and}\quad
K = \bigoplus K_m
$$
We have $M = K[-2]$ and by construction the map
$$
c_{E/Z} \oplus \tilde \xi|_M :
\Omega^\bullet_{Z/S} \oplus M
\longrightarrow
Rp_*(\Omega^\bullet_{E/S})
$$
is an isomorphism (see remark referenced above).

\medskip\noindent
Consider the map
$$
\delta : \Omega^\bullet_{E/S}[-2] \longrightarrow \Omega^\bullet_{X'/S}
$$
in $D(X', (X' \to S)^{-1}\mathcal{O}_S)$ of
Lemma \ref{lemma-gysin-via-log-complex}
with the property that the composition
$$
\Omega^\bullet_{E/S}[-2] \longrightarrow \Omega^\bullet_{X'/S}
\longrightarrow
\Omega^\bullet_{E/S}
$$
is the map $\theta'$ of Remark \ref{remark-cup-product-as-a-map} for
$c_1^{dR}(\mathcal{O}_{X'}(-E))|_E) = c_1^{dR}(\mathcal{O}_E(1))$.
The final assertion of Remark \ref{remark-projective-space-bundle-formula}
tells us that the diagram
$$
\xymatrix{
K[-2] \ar[d]_{(\tilde \xi|_K)[-2]} \ar[r]_{\text{id}} &
M \ar[d]^{\tilde x|_M} \\
Rp_*\Omega^\bullet_{E/S}[-2] \ar[r]^-{Rp_*\theta'} &
Rp_*\Omega^\bullet_{E/S}
}
$$
commutes. Thus we see that we can obtain the desired splitting of
the claim as the map
\begin{align*}
Rp_*(\Omega^\bullet_{E/S})
& \xrightarrow{(c_{E/Z} \oplus \tilde \xi|_M)^{-1}}
\Omega^\bullet_{Z/S} \oplus M \\
& \xrightarrow{\text{id} \oplus \text{id}^{-1}}
\Omega^\bullet_{Z/S} \oplus K[-2] \\
& \xrightarrow{\text{id} \oplus (\tilde \xi|_K)[-2]}
\Omega^\bullet_{Z/S} \oplus Rp_*\Omega^\bullet_{E/S}[-2] \\
& \xrightarrow{\text{id} \oplus Rb_*\delta}
\Omega^\bullet_{Z/S} \oplus Rb_*\Omega^\bullet_{X'/S}
\end{align*}
The relationship between $\theta'$ and $\delta$ stated above
together with the commutative diagram involving $\theta'$, $\tilde \xi|_K$,
and $\tilde \xi|_M$ above are exactly what's needed to
show that this is a section to the canonical map
$\Omega^\bullet_{Z/S} \oplus Rb_*(\Omega^\bullet_{X'/S}) \to
Rp_*(\Omega^\bullet_{E/S})$ and the proof of the claim is complete.
\end{proof}

\noindent
Lemma \ref{lemma-splitting-on-omega-a}
shows that producing the splitting on Hodge
cohomology is a good deal easier than the result of
Proposition \ref{proposition-blowup-split}.
We urge the reader to skip ahead to the next section.

\begin{lemma}
\label{lemma-ext-zero}
Let $i : Z \to X$ be a closed immersion of schemes which is regular of
codimension $c$. Then $\Ext^q_{\mathcal{O}_X}(i_*\mathcal{F}, \mathcal{E}) = 0$
for $q < c$ for $\mathcal{E}$ locally free on $X$ and $\mathcal{F}$
any $\mathcal{O}_Z$-module.
\end{lemma}

\begin{proof}
By the local to global spectral sequence of $\Ext$ it suffices
to prove this affine locally on $X$. See
Cohomology, Section \ref{cohomology-section-ext}.
Thus we may assume $X = \Spec(A)$
and there exists a regular sequence $f_1, \ldots, f_c$ in $A$
such that $Z = \Spec(A/(f_1, \ldots, f_c))$. We may assume $c \geq 1$.
Then we see that $f_1 : \mathcal{E} \to \mathcal{E}$
is injective. Since $i_*\mathcal{F}$ is annihilated by $f_1$
this shows that the lemma holds for $i = 0$ and that we have
a surjection
$$
\Ext^{q - 1}_{\mathcal{O}_X}(i_*\mathcal{F}, \mathcal{E}/f_1\mathcal{E})
\longrightarrow
\Ext^q_{\mathcal{O}_X}(i_*\mathcal{F}, \mathcal{E})
$$
Thus it suffices to show that the source of this arrow is zero.
Next we repeat this argument: if $c \geq 2$ the map
$f_2 : \mathcal{E}/f_1\mathcal{E} \to \mathcal{E}/f_1\mathcal{E}$
is injective. Since $i_*\mathcal{F}$ is annihilated by $f_2$
this shows that the lemma holds for $q = 1$ and that we have a
surjection
$$
\Ext^{q - 2}_{\mathcal{O}_X}(i_*\mathcal{F},
\mathcal{E}/f_1\mathcal{E} + f_2\mathcal{E})
\longrightarrow
\Ext^{q - 1}_{\mathcal{O}_X}(i_*\mathcal{F}, \mathcal{E}/f_1\mathcal{E})
$$
Continuing in this fashion the lemma is proved.
\end{proof}

\begin{lemma}
\label{lemma-splitting-on-omega-a}
With notation as in More on Morphisms, Lemma \ref{more-morphisms-lemma-blowup}
for $a \geq 0$ there is a unique arrow
$Rb_*\Omega^a_{X'/S} \to \Omega^a_{X/S}$ in $D(\mathcal{O}_X)$
whose composition with $\Omega^a_{X/S} \to Rb_*\Omega^a_{X'/S}$
is the identity on $\Omega^a_{X/S}$.
\end{lemma}

\begin{proof}
We may decompose $X$ into open and closed subschemes
having fixed relative dimension to $S$, see
Morphisms, Lemma \ref{morphisms-lemma-smooth-omega-finite-locally-free}.
Since the derived category $D(X, f^{-1}\mathcal{O})_S)$ correspondingly
decomposes as a product of categories, we may assume $X$ has
fixed relative dimension $N$ over $S$. We may decompose
$Z = \coprod Z_m$ into open and closed subschemes of relative
dimension $m \geq 0$ over $S$. The restriction $i_m : Z_m \to X$ of
$i$ to $Z_m$ is a regular immersion of codimension $N - m$, see Divisors, Lemma
\ref{divisors-lemma-immersion-smooth-into-smooth-regular-immersion}.
Let $E = \coprod E_m$ be the corresponding decomposition, i.e.,
we set $E_m = p^{-1}(Z_m)$. We claim that there are natural maps
$$
b^*\Omega^a_{X/S} \to \Omega^a_{X'/S} \to
b^*\Omega^a_{X/S} \otimes_{\mathcal{O}_{X'}}
\mathcal{O}_{X'}(\sum (N - m - 1)E_m)
$$
whose composition is induced by the inclusion
$\mathcal{O}_{X'} \to \mathcal{O}_{X'}(\sum (N - m - 1)E_m)$.
Namely, in order to prove this, it suffices to show that the
cokernel of the first arrow is locally on $X'$ annihilated by
a local equation of the effective Cartier divisor $\sum (N - m - 1)E_m$.
To see this in turn we can work \'etale locally on $X$ as in the
proof of Lemma \ref{lemma-comparison-general} and apply
Lemma \ref{lemma-comparison-bis}.
Computing \'etale locally using Lemma \ref{lemma-blowup-twist-same-cohomology}
we see that the induced composition
$$
\Omega^a_{X/S} \to Rb_*\Omega^a_{X'/S} \to
Rb_*\left(b^*\Omega^a_{X/S} \otimes_{\mathcal{O}_{X'}}
\mathcal{O}_{X'}(\sum (N - m - 1)E_m)\right)
$$
is an isomorphism in $D(\mathcal{O}_X)$
which is how we obtain the existence of the map in the lemma.

\medskip\noindent
For uniqueness, it suffices to show that there are no nonzero maps from
$\tau_{\geq 1}Rb_*\Omega_{X'/S}$ to $\Omega^a_{X/S}$ in $D(\mathcal{O}_X)$.
For this it suffices in turn to show that there are no nonzero maps
from $R^qb_*\Omega_{X'/s}[-q]$ to $\Omega^a_{X/S}$ in $D(\mathcal{O}_X)$
for $q \geq 1$ (details omitted). By
Lemma \ref{lemma-comparison-general}
we see that $R^qb_*\Omega_{X'/s} \cong i_*R^qp_*\Omega^a_{E/S}$
is the pushforward of a module on $Z = \coprod Z_m$.
Moreover, observe that the restriction of $R^qp_*\Omega^a_{E/S}$
to $Z_m$ is nonzero only for $q < N - m$. Namely, the fibres of
$E_m \to Z_m$ have dimension $N - m - 1$ and we can apply Limits, Lemma
\ref{limits-lemma-higher-direct-images-zero-above-dimension-fibre}.
Thus the desired vanishing follows from Lemma \ref{lemma-ext-zero}.
\end{proof}














\section{Comparing sheaves of differential forms}
\label{section-quasi-finite-syntomic}

\noindent
The goal of this section is to compare the sheaves
$\Omega^p_{X/\mathbf{Z}}$ and $\Omega^p_{Y/\mathbf{Z}}$
when given a locally quasi-finite syntomic morphism of schemes $f : Y \to X$.
The result will be applied in Section \ref{section-trace}
to the construction of the trace map on de Rham complexes if $f$ is finite.

\begin{lemma}
\label{lemma-funny-map}
Let $R$ be a ring and consider a commutative diagram
$$
\xymatrix{
0 \ar[r] &
K^0 \ar[r] &
L^0 \ar[r] &
M^0 \ar[r] & 0 \\
& & L^{-1} \ar[u]_\partial \ar@{=}[r] &
M^{-1} \ar[u]
}
$$
of $R$-modules with exact top row and $M^0$ and $M^{-1}$
finite free of the same rank. Then there are canonical maps
$$
\wedge^i(H^0(L^\bullet)) \longrightarrow \wedge^i(K^0) \otimes_R \det(M^\bullet)
$$
whose composition with $\wedge^i(K^0) \to \wedge^i(H^0(L^\bullet))$
is equal to multiplication with $\delta(M^\bullet)$.
\end{lemma}

\begin{proof}
Say $M^0$ and $M^{-1}$ are free of rank $n$. For every $i \geq 0$
there is a canonical surjection
$$
\pi_i :
\wedge^{n + i}(L^0)
\longrightarrow
\wedge^i(K^0) \otimes \wedge^n(M^0)
$$
whose kernel is the submodule generated by wedges
$l_1 \wedge \ldots \wedge l_{n + i}$ such that $> i$ of the
$l_j$ are in $K^0$. On the other hand, the exact sequence
$$
L^{-1} \to L^0 \to H^0(L^\bullet) \to 0
$$
similarly produces canonical maps
$$
\wedge^i(H^0(L^\bullet)) \otimes \wedge^n(L^{-1})
\longrightarrow
\wedge^{n + i}(L^0)
$$
by sending $\eta \otimes \theta$ to $\tilde \eta \wedge \partial(\theta)$
where $\tilde \eta \in \wedge^i(L^0)$ is a lift of $\eta$.
The composition of these two maps, combined with the identification
$\wedge^n(L^{-1}) = \wedge^n(M^{-1})$ gives a map
$$
\wedge^i(H^0(L^\bullet)) \otimes \wedge^n(M^{-1})
\longrightarrow
\wedge^i(K^0) \otimes \wedge^n(M^0)
$$
Since $\det(M^\bullet) = \wedge^n(M^0) \otimes
(\wedge^n(M^{-1}))^{\otimes -1}$ this produces a map as
in the statement of the lemma.
If $\eta$ is the image of $\omega \in \wedge^i(K^0)$, then we see
that $\theta \otimes \eta$ is mapped to
$\pi_i(\omega \wedge \partial(\theta)) = \omega \otimes \overline{\theta}$ in
$\wedge^i(K^0) \otimes \wedge^n(M^0)$ where $\overline{\theta}$
is the image of $\theta$ in $\wedge^n(M^0)$. Since
$\delta(M^\bullet)$ is simply the determinant of the map
$M^{-1} \to M^0$ this proves the last statement.
\end{proof}

\begin{remark}
\label{remark-local-description}
Let $A$ be a ring. Let $P = A[x_1, \ldots, x_n]$. Let
$f_1, \ldots, f_n \in P$ and set $B = P/(f_1, \ldots, f_n)$.
Assume $A \to B$ is quasi-finite. Then
$B$ is a relative global complete intersection over $A$ (Algebra, Definition
\ref{algebra-definition-relative-global-complete-intersection}) and
$(f_1, \ldots, f_n)/(f_1, \ldots, f_n)^2$ is free with generators
the classes $\overline{f}_i$ by Algebra, Lemma
\ref{algebra-lemma-relative-global-complete-intersection-conormal}.
Consider the following diagram
$$
\xymatrix{
\Omega_{A/\mathbf{Z}} \otimes_A B \ar[r] &
\Omega_{P/\mathbf{Z}} \otimes_P B \ar[r] &
\Omega_{P/A} \otimes_P B \\
&
(f_1, \ldots, f_n)/(f_1, \ldots, f_n)^2 \ar[u] \ar@{=}[r] &
(f_1, \ldots, f_n)/(f_1, \ldots, f_n)^2 \ar[u]
}
$$
The right column represents $\NL_{B/A}$ in $D(B)$ hence has cohomology
$\Omega_{B/A}$ in degree $0$. The top row is the split short exact sequence
$0 \to \Omega_{A/\mathbf{Z}} \otimes_A B \to
\Omega_{P/\mathbf{Z}} \otimes_P B \to \Omega_{P/A} \otimes_P B \to 0$.
The middle column has cohomology $\Omega_{B/\mathbf{Z}}$ in degree $0$
by Algebra, Lemma \ref{algebra-lemma-differential-seq}.
Thus by Lemma \ref{lemma-funny-map} we obtain canonical $B$-module maps
$$
\Omega^p_{B/\mathbf{Z}} \longrightarrow
\Omega^p_{A/\mathbf{Z}} \otimes_A \det(\NL_{B/A})
$$
whose composition with
$\Omega^p_{A/\mathbf{Z}} \to \Omega^p_{B/\mathbf{Z}}$
is multiplication by $\delta(\NL_{B/A})$.
\end{remark}

\begin{lemma}
\label{lemma-Garel-upstairs}
There exists a unique rule that to every locally quasi-finite syntomic
morphism of schemes $f : Y \to X$ assigns $\mathcal{O}_Y$-module maps
$$
c^p_{Y/X} :
\Omega^p_{Y/\mathbf{Z}}
\longrightarrow
f^*\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_Y} \det(\NL_{Y/X})
$$
satisfying the following two properties
\begin{enumerate}
\item the composition with
$f^*\Omega^p_{X/\mathbf{Z}} \to \Omega^p_{Y/\mathbf{Z}}$
is multiplication by $\delta(\NL_{Y/X})$, and
\item the rule is compatible with restriction to opens and with
base change.
\end{enumerate}
\end{lemma}

\begin{proof}
This proof is very similar to the proof of
Discriminants, Proposition \ref{discriminant-proposition-tate-map}
and we suggest the reader look at that proof first.
We fix $p \geq 0$ throughout the proof.

\medskip\noindent
Let us reformulate the statement. Consider the category
$\mathcal{C}$ whose objects, denoted $Y/X$, are locally quasi-finite syntomic
morphism $f : Y \to X$ of schemes and whose morphisms
$b/a : Y'/X' \to Y/X$ are commutative diagrams
$$
\xymatrix{
Y' \ar[d]_{f'} \ar[r]_b & Y \ar[d]^f \\
X' \ar[r]^a & X
}
$$
which induce an isomorphism of $Y'$ with an open subscheme of
$X' \times_X Y$. The lemma means that for every object
$Y/X$ of $\mathcal{C}$ we have maps $c^p_{Y/X}$ with property (1)
and for every morphism $b/a : Y'/X' \to Y/X$ of $\mathcal{C}$ we have
$b^*c^p_{Y/X} = c^p_{Y'/X'}$ via the identifications
$b^*\det(\NL_{Y/X}) = \det(\NL_{Y'/X'})$
(Discriminants, Section \ref{discriminant-section-tate-map})
and $b^*\Omega^p_{Y/X} = \Omega^p_{Y'/X'}$
(Lemma \ref{lemma-base-change-de-rham}).

\medskip\noindent
Given $Y/X$ in $\mathcal{C}$ and $y \in Y$ we can find
an affine open $V \subset Y$ and $U \subset X$ with $f(V) \subset U$
such that there exists some maps
$$
\Omega^p_{Y/\mathbf{Z}}|_V
\longrightarrow
\left(
f^*\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_Y} \det(\NL_{Y/X})
\right)|_V
$$
with property (1). This follows
from picking affine opens as in
Discriminants, Lemma \ref{discriminant-lemma-syntomic-quasi-finite} part (5)
and Remark \ref{remark-local-description}.
If $\Omega^p_{X/\mathbf{Z}}$ is finite locally free and
annihilator of the section $\delta(\NL_{Y/X})$ is zero, then
these local maps are unique and automatically glue!

\medskip\noindent
Let $\mathcal{C}_{nice} \subset \mathcal{C}$ denote the full subcategory
of $Y/X$ such that
\begin{enumerate}
\item $X$ is of finite type over $\mathbf{Z}$,
\item $\Omega_{X/\mathbf{Z}}$ is locally free, and
\item  the annihilator of $\delta(\NL_{Y/X})$ is zero.
\end{enumerate}
By the remarks in the previous paragraph, we see that for any
object $Y/X$ of $\mathcal{C}_{nice}$ we have a unique map
$c^p_{Y/X}$ satisfying condition (1). If $b/a : Y'/X' \to Y/X$
is a morphism of $\mathcal{C}_{nice}$, then
$b^*c^p_{Y/X}$ is equal to $c^p_{Y'/X'}$ because
$b^*\delta(\NL_{Y/X}) = \delta(\NL_{Y'/X'})$ (see
Discriminants, Section \ref{discriminant-section-tate-map}).
In other words, we have solved the problem
on the full subcategory $\mathcal{C}_{nice}$. For $Y/X$ in $\mathcal{C}_{nice}$
we continue to denote $c^p_{Y/X}$ the solution we've just found.

\medskip\noindent
Consider morphisms
$$
Y_1/X_1 \xleftarrow{b_1/a_1} Y/X \xrightarrow{b_2/a_2} Y_2/X_2
$$
in $\mathcal{C}$ such that $Y_1/X_1$ and $Y_2/X_2$ are objects
of $\mathcal{C}_{nice}$.
{\bf Claim.} $b_1^*c^p_{Y_1/X_1} = b_2^*c^p_{Y_2/X_2}$.
We will first show that the claim implies the lemma
and then we will prove the claim.

\medskip\noindent
Let $d, n \geq 1$ and consider the locally
quasi-finite syntomic morphism $Y_{n, d} \to X_{n, d}$
constructed in Discriminants, Example
\ref{discriminant-example-universal-quasi-finite-syntomic}.
Then $Y_{n, d}$ and $Y_{n, d}$ are irreducible schemes of finite type and
smooth over $\mathbf{Z}$. Namely, $X_{n, d}$ is a spectrum of a
polynomial ring over $\mathbf{Z}$ and $Y_{n, d}$ is an open subscheme
of such. The morphism $Y_{n, d} \to X_{n, d}$ is locally quasi-finite syntomic
and \'etale over a dense open, see Discriminants, Lemma
\ref{discriminant-lemma-universal-quasi-finite-syntomic-etale}.
Thus $\delta(\NL_{Y_{n, d}/X_{n, d}})$ is nonzero: for example we have
the local description of $\delta(\NL_{Y/X})$ in
Discriminants, Remark \ref{discriminant-remark-local-description-delta}
and we have the local description of \'etale morphisms in
Morphisms, Lemma \ref{morphisms-lemma-etale-at-point} part (8).
Now a nonzero section of an invertible module over an irreducible
regular scheme has vanishing annihilator. Thus
$Y_{n, d}/X_{n, d}$ is an object of $\mathcal{C}_{nice}$.

\medskip\noindent
Let $Y/X$ be an arbitrary object of $\mathcal{C}$. Let $y \in Y$.
By Discriminants, Lemma \ref{discriminant-lemma-locally-comes-from-universal}
we can find $n, d \geq 1$ and morphisms
$$
Y/X \leftarrow V/U \xrightarrow{b/a} Y_{n, d}/X_{n, d}
$$
of $\mathcal{C}$ such that $V \subset Y$ and $U \subset X$ are open.
Thus we can pullback the canonical morphism $c^p_{Y_{n, d}/X_{n, d}}$
constructed above by $b$ to $V$. The claim guarantees these local
isomorphisms glue! Thus we get a well defined global maps
$c^p_{Y/X}$ with property (1).
If $b/a : Y'/X' \to Y/X$ is a morphism of $\mathcal{C}$, then
the claim also implies that the similarly constructed map
$c^p_{Y'/X'}$ is the pullback by $b$ of the locally constructed
map $c^p_{Y/X}$. Thus it remains to prove the claim.

\medskip\noindent
In the rest of the proof we prove the claim. We may pick a point
$y \in Y$ and prove the maps agree in an open neighbourhood of $y$.
Thus we may replace $Y_1$, $Y_2$ by open neighbourhoods of the
image of $y$ in $Y_1$ and $Y_2$. Thus we may assume
$Y, X, Y_1, X_1, Y_2, X_2$ are affine.
We may write $X = \lim X_\lambda$ as a cofiltered limit of affine
schemes of finite type over $X_1 \times X_2$. For each $\lambda$
we get
$$
Y_1 \times_{X_1} X_\lambda
\quad\text{and}\quad
X_\lambda \times_{X_2} Y_2
$$
If we take limits we obtain
$$
\lim Y_1 \times_{X_1} X_\lambda =
Y_1 \times_{X_1} X \supset Y \subset
X \times_{X_2} Y_2 = \lim X_\lambda \times_{X_2} Y_2
$$
By Limits, Lemma \ref{limits-lemma-descend-opens}
we can find a $\lambda$ and opens
$V_{1, \lambda} \subset Y_1 \times_{X_1} X_\lambda$ and
$V_{2, \lambda} \subset X_\lambda \times_{X_2} Y_2$
whose base change to $X$ recovers $Y$ (on both sides).
After increasing $\lambda$ we may assume
there is an isomorphism
$V_{1, \lambda} \to V_{2, \lambda}$ whose base change to $X$ is the
identity on $Y$, see
Limits, Lemma \ref{limits-lemma-descend-finite-presentation}.
Then we have the commutative diagram
$$
\xymatrix{
& Y/X \ar[d] \ar[ld]_{b_1/a_1} \ar[rd]^{b_2/a_2} \\
Y_1/X_1 & V_{1, \lambda}/X_\lambda \ar[l] \ar[r] & Y_2/X_2
}
$$
Thus it suffices to prove the claim for the lower row
of the diagram and we reduce to the case discussed in the
next paragraph.

\medskip\noindent
Assume $Y, X, Y_1, X_1, Y_2, X_2$ are affine of finite type over $\mathbf{Z}$.
Write $X = \Spec(A)$, $X_i = \Spec(A_i)$. The ring map $A_1 \to A$ corresponding
to $X \to X_1$ is of finite type and hence we may choose a surjection
$A_1[x_1, \ldots, x_n] \to A$. Similarly, we may choose a surjection
$A_2[y_1, \ldots, y_m] \to A$. Set $X'_1 = \Spec(A_1[x_1, \ldots, x_n])$
and $X'_2 = \Spec(A_2[y_1, \ldots, y_m])$. Observe that
$\Omega_{X'_1/\mathbf{Z}}$ is the direct sum of the pullback of
$\Omega_{X_1/\mathbf{Z}}$ and a finite free module.
Similarly for $X'_2$. Set $Y'_1 = Y_1 \times_{X_1} X'_1$ and
$Y'_2 = Y_2 \times_{X_2} X'_2$. We get the following diagram
$$
Y_1/X_1 \leftarrow
Y'_1/X'_1 \leftarrow
Y/X
\rightarrow Y'_2/X'_2
\rightarrow Y_2/X_2
$$
Since $X'_1 \to X_1$ and $X'_2 \to X_2$ are flat, the same is true
for $Y'_1 \to Y_1$ and $Y'_2 \to Y_2$. It follows easily that the
annihilators of $\delta(\NL_{Y'_1/X'_1})$ and $\delta(\NL_{Y'_2/X'_2})$
are zero.
Hence $Y'_1/X'_1$ and $Y'_2/X'_2$ are in $\mathcal{C}_{nice}$.
Thus the outer morphisms in the displayed diagram are morphisms
of $\mathcal{C}_{nice}$ for which we know the desired compatibilities.
Thus it suffices to prove the claim for
$Y'_1/X'_1 \leftarrow Y/X \rightarrow Y'_2/X'_2$. This reduces us
to the case discussed in the next paragraph.

\medskip\noindent
Assume $Y, X, Y_1, X_1, Y_2, X_2$ are affine of finite type over
$\mathbf{Z}$ and $X \to X_1$ and $X \to X_2$ are closed immersions.
Consider the open embeddings
$Y_1 \times_{X_1} X \supset Y \subset X \times_{X_2} Y_2$.
There is an open neighbourhood $V \subset Y$ of $y$ which is a
standard open of both $Y_1 \times_{X_1} X$ and $X \times_{X_2} Y_2$.
This follows from Schemes, Lemma \ref{schemes-lemma-standard-open-two-affines}
applied to the scheme obtained by glueing $Y_1 \times_{X_1} X$ and
$X \times_{X_2} Y_2$ along $Y$; details omitted.
Since $X \times_{X_2} Y_2$ is a closed subscheme of $Y_2$
we can find a standard open $V_2 \subset Y_2$ such that
$V_2 \times_{X_2} X = V$. Similarly, we can find a standard open
$V_1 \subset Y_1$ such that $V_1 \times_{X_1} X = V$.
After replacing $Y, Y_1, Y_2$ by $V, V_1, V_2$ we reduce to the
case discussed in the next paragraph.

\medskip\noindent
Assume $Y, X, Y_1, X_1, Y_2, X_2$ are affine of finite type over
$\mathbf{Z}$ and $X \to X_1$ and $X \to X_2$ are closed immersions
and $Y_1 \times_{X_1} X = Y = X \times_{X_2} Y_2$.
Write $X = \Spec(A)$, $X_i = \Spec(A_i)$, $Y = \Spec(B)$,
$Y_i = \Spec(B_i)$. Then we can consider the affine schemes
$$
X' = \Spec(A_1 \times_A A_2) = \Spec(A')
\quad\text{and}\quad
Y' = \Spec(B_1 \times_B B_2) = \Spec(B')
$$
Observe that $X' = X_1 \amalg_X X_2$ and $Y' = Y_1 \amalg_Y Y_2$, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-basic-example-pushout}.
By More on Algebra, Lemma \ref{more-algebra-lemma-fibre-product-finite-type}
the rings $A'$ and $B'$ are of finite type over $\mathbf{Z}$. By
More on Algebra, Lemma \ref{more-algebra-lemma-module-over-fibre-product}
we have $B' \otimes_A A_1 = B_1$ and $B' \times_A A_2 = B_2$.
In particular a fibre of $Y' \to X'$ over a point of
$X' = X_1 \amalg_X X_2$ is always equal to either a fibre of $Y_1 \to X_1$
or a fibre of $Y_2 \to X_2$. By More on Algebra, Lemma
\ref{more-algebra-lemma-flat-module-over-fibre-product}
the ring map $A' \to B'$ is flat. Thus by Discriminants, Lemma
\ref{discriminant-lemma-syntomic-quasi-finite} part (3)
we conclude that $Y'/X'$ is an object of $\mathcal{C}$.
Consider now the commutative diagram
$$
\xymatrix{
& Y/X \ar[ld]_{b_1/a_1} \ar[rd]^{b_2/a_2} \\
Y_1/X_1 \ar[rd] & & Y_2/X_2 \ar[ld] \\
& Y'/X'
}
$$
Now we would be done if $Y'/X'$ is an object of $\mathcal{C}_{nice}$,
but this is almost never the case. Namely, then pulling back $c^p_{Y'/X'}$
around the two sides of the square, we would obtain the desired conclusion.
To get around the problem that $Y'/X'$ is not in $\mathcal{C}_{nice}$
we note the arguments above show that, after possibly shrinking all
of the schemes $X, Y, X_1, Y_1, X_2, Y_2, X', Y'$ we can find some
$n, d \geq 1$, and extend the diagram like so:
$$
\xymatrix{
& Y/X \ar[ld]_{b_1/a_1} \ar[rd]^{b_2/a_2} \\
Y_1/X_1 \ar[rd] & & Y_2/X_2 \ar[ld] \\
& Y'/X' \ar[d] \\
& Y_{n, d}/X_{n, d}
}
$$
and then we can use the already given argument by pulling
back from $c^p_{Y_{n, d}/X_{n, d}}$. This finishes the proof.
\end{proof}








\section{Trace maps on de Rham complexes}
\label{section-trace}

\noindent
A reference for some of the material in this section is \cite{Garel}.
Let $S$ be a scheme. Let $f : Y \to X$ be a finite locally free morphism
of schemes over $S$. Then there is a trace map
$\text{Trace}_f : f_*\mathcal{O}_Y \to \mathcal{O}_X$, see
Discriminants, Section \ref{discriminant-section-discriminant}.
In this situation a trace map on de Rham complexes is a map
of complexes
$$
\Theta_{Y/X} : f_*\Omega^\bullet_{Y/S} \longrightarrow \Omega^\bullet_{X/S}
$$
such that $\Theta_{Y/X}$ is equal to $\text{Trace}_f$ in degree $0$
and satisfies
$$
\Theta_{Y/X}(\omega \wedge \eta) = \omega \wedge \Theta_{Y/X}(\eta)
$$
for local sections $\omega$ of $\Omega^\bullet_{X/S}$ and $\eta$
of $f_*\Omega^\bullet_{Y/S}$. It is not clear to us whether such a trace map
$\Theta_{Y/X}$ exists for every finite locally free morphism $Y \to X$;
please email
\href{mailto:stacks.project@gmail.com}{stacks.project@gmail.com}
if you have a counterexample or a proof.

\begin{example}
\label{example-no-trace}
Here is an example where we do not have a trace map on de Rham complexes.
For example, consider the $\mathbf{C}$-algebra $B = \mathbf{C}[x, y]$ with
action of $G = \{\pm 1\}$ given by $x \mapsto -x$ and $y \mapsto -y$.
The invariants $A = B^G$ form a normal domain of finite type over $\mathbf{C}$
generated by $x^2, xy, y^2$. We claim that for the inclusion $A \subset B$
there is no reasonable trace map
$\Omega_{B/\mathbf{C}} \to \Omega_{A/\mathbf{C}}$
on $1$-forms. Namely, consider the element
$\omega = x \text{d} y \in \Omega_{B/\mathbf{C}}$.
Since $\omega$ is invariant under the action of $G$ if a ``reasonable''
trace map exists, then $2\omega$ should be in the image of
$\Omega_{A/\mathbf{C}} \to \Omega_{B/\mathbf{C}}$. This is
not the case: there is no way to write $2\omega$ as a linear
combination of $\text{d}(x^2)$, $\text{d}(xy)$, and $\text{d}(y^2)$
even with coefficients in $B$.
This example contradicts the main theorem in
\cite{Zannier}.
\end{example}

\begin{lemma}
\label{lemma-Garel}
There exists a unique rule that to every finite syntomic
morphism of schemes $f : Y \to X$ assigns $\mathcal{O}_X$-module maps
$$
\Theta^p_{Y/X} :
f_*\Omega^p_{Y/\mathbf{Z}}
\longrightarrow
\Omega^p_{X/\mathbf{Z}}
$$
satisfying the following properties
\begin{enumerate}
\item the composition with
$\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_X} f_*\mathcal{O}_Y
\to f_*\Omega^p_{Y/\mathbf{Z}}$ is equal to
$\text{id} \otimes \text{Trace}_f$
where $\text{Trace}_f : f_*\mathcal{O}_Y \to \mathcal{O}_X$
is the map from
Discriminants, Section \ref{discriminant-section-discriminant},
\item the rule is compatible with base change.
\end{enumerate}
\end{lemma}

\begin{proof}
First, assume that $X$ is locally Noetherian. By
Lemma \ref{lemma-Garel-upstairs} we have a canonical map
$$
c^p_{Y/X} : \Omega_{Y/S}^p
\longrightarrow
f^*\Omega_{X/S}^p \otimes_{\mathcal{O}_Y} \det(\NL_{Y/X})
$$
By Discriminants, Proposition \ref{discriminant-proposition-tate-map}
we have a canonical isomorphism
$$
c_{Y/X} : \det(\NL_{Y/X}) \to \omega_{Y/X}
$$
mapping $\delta(\NL_{Y/X})$ to $\tau_{Y/X}$. Combined these maps give
$$
c^p_{Y/X} \otimes c_{Y/X} :
\Omega_{Y/S}^p
\longrightarrow
f^*\Omega_{X/S}^p \otimes_{\mathcal{O}_Y} \omega_{Y/X}
$$
By Discriminants, Section \ref{discriminant-section-finite-morphisms}
this is the same thing as a map
$$
\Theta_{Y/X}^p :
f_*\Omega_{Y/S}^p
\longrightarrow
\Omega_{X/S}^p
$$
Recall that the relationship between $c^p_{Y/X} \otimes c_{Y/X}$
and $\Theta_{Y/X}^p$ uses the evaluation map
$f_*\omega_{Y/X} \to \mathcal{O}_X$
which sends $\tau_{Y/X}$ to $\text{Trace}_f(1)$, see
Discriminants, Section \ref{discriminant-section-finite-morphisms}.
Hence property (1) holds. Property (2) holds for base changes by
$X' \to X$ with $X'$ locally Noetherian because both $c^p_{Y/X}$ and
$c_{Y/X}$ are compatible with such base changes. For $f : Y \to X$
finite syntomic and $X$ locally Noetherian,
we will continue to denote $\Theta^p_{Y/X}$ the solution we've just found.

\medskip\noindent
Uniqueness. Suppose that we have a finite syntomic morphism
$f: Y \to X$ such that $X$ is smooth over $\Spec(\mathbf{Z})$
and $f$ is \'etale over a dense open of $X$. We claim that
in this case $\Theta^p_{Y/X}$ is uniquely determined by property (1).
Namely, consider the maps
$$
\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_X} f_*\mathcal{O}_Y \to
f_*\Omega^p_{Y/\mathbf{Z}} \to
\Omega^p_{X/\mathbf{Z}}
$$
The sheaf $\Omega^p_{X/\mathbf{Z}}$ is torsion free (by the assumed
smoothness), hence it suffices to check that the restriction of
$\Theta^p_{Y/X}$ is uniquely determined over the dense open over
which $f$ is \'etale, i.e., we may assume $f$ is \'etale.
However, if $f$ is \'etale, then
$f^*\Omega_{X/\mathbf{Z}} = \Omega_{Y/\mathbf{Z}}$
hence the first arrow in the displayed equation is an isomorphism.
Since we've pinned down the composition, this guarantees uniqueness.

\medskip\noindent
Let $f : Y \to X$ be a finite syntomic morphism of locally Noetherian schemes.
Let $x \in X$. By Discriminants, Lemma
\ref{discriminant-lemma-locally-comes-from-universal-finite}
we can find $d \geq 1$ and a commutative diagram
$$
\xymatrix{
Y \ar[d] &
V \ar[d] \ar[l] \ar[r] &
V_d \ar[d] \\
X &
U \ar[l] \ar[r] &
U_d
}
$$
such that $x \in U \subset X$ is open, $V = f^{-1}(U)$
and $V = U \times_{U_d} V_d$. Thus $\Theta^p_{Y/X}|_V$
is the pullback of the map $\Theta^p_{V_d/U_d}$.
However, by the discussion on uniqueness above and
Discriminants, Lemmas
\ref{discriminant-lemma-universal-finite-syntomic-smooth} and
\ref{discriminant-lemma-universal-finite-syntomic-etale}
the map $\Theta^p_{V_d/U_d}$ is uniquely determined
by the requirement (1). Hence uniqueness holds.

\medskip\noindent
At this point we know that we have existence and uniqueness
for all finite syntomic morphisms $Y \to X$ with $X$ locally Noetherian.
We could now give an argument similar to the proof of
Lemma \ref{lemma-Garel-upstairs} to extend to general $X$.
However, instead it possible to directly use absolute Noetherian approximation
to finish the proof. Namely, to construct $\Theta^p_{Y/X}$
it suffices to do so Zariski locally on $X$ (provided we also
show the uniqueness). Hence we may assume $X$ is affine (small
detail omitted). Then we can write $X = \lim_{i \in I} X_i$
as the limit over a directed set $I$ of Noetherian affine schemes.
By Algebra, Lemma \ref{algebra-lemma-colimit-category-fp-algebras}
we can find $0 \in I$ and a finitely
presented morphism of affines $f_0 : Y_0 \to X_0$ whose base change to
$X$ is $Y \to X$. After increasing $0$ we may assume $Y_0 \to X_0$
is finite and syntomic, see
Algebra, Lemma \ref{algebra-lemma-colimit-lci} and
\ref{algebra-lemma-colimit-finite}. For $i \geq 0$ also the
base change $f_i : Y_i = Y_0 \times_{X_0} X_i \to X_i$ is finite syntomic.
Then
$$
\Gamma(X, f_*\Omega^p_{Y/\mathbf{Z}}) =
\Gamma(Y, \Omega^p_{Y/\mathbf{Z}}) =
\colim_{i \geq 0} \Gamma(Y_i, \Omega^p_{Y_i/\mathbf{Z}}) =
\colim_{i \geq 0} \Gamma(X_i, f_{i, *}\Omega^p_{Y_i/\mathbf{Z}})
$$
Hence we can (and are forced to) define $\Theta^p_{Y/X}$ as the colimit
of the maps $\Theta^p_{Y_i/X_i}$. This map is compatible with any
cartesian diagram
$$
\xymatrix{
Y' \ar[r] \ar[d] & Y \ar[d] \\
X' \ar[r] & X
}
$$
with $X'$ affine as we know this for the case of Noetherian affine schemes
by the arguments given above (small detail omitted; hint: if we also
write $X' = \lim_{j \in J} X'_j$ then for every $i \in I$ there is a $j \in J$
and a morphism $X'_j \to X_i$ compatible with the morphism $X' \to X$).
This finishes the proof.
\end{proof}

\begin{proposition}
\label{proposition-Garel}
\begin{reference}
\cite{Garel}
\end{reference}
Let $f : Y \to X$ be a finite syntomic morphism of schemes.
The maps $\Theta^p_{Y/X}$ of Lemma \ref{lemma-Garel} define a map of complexes
$$
\Theta_{Y/X} :
f_*\Omega^\bullet_{Y/\mathbf{Z}}
\longrightarrow
\Omega^\bullet_{X/\mathbf{Z}}
$$
with the following properties
\begin{enumerate}
\item in degree $0$ we get
$\text{Trace}_f : f_*\mathcal{O}_Y \to \mathcal{O}_X$, see
Discriminants, Section \ref{discriminant-section-discriminant},
\item we have
$\Theta_{Y/X}(\omega \wedge \eta) = \omega \wedge \Theta_{Y/X}(\eta)$
for $\omega$ in $\Omega^\bullet_{X/\mathbf{Z}}$ and $\eta$
in $f_*\Omega^\bullet_{Y/\mathbf{Z}}$,
\item if $f$ is a morphism over a base scheme $S$, then
$\Theta_{Y/X}$ induces a map of complexes
$f_*\Omega^\bullet_{Y/S} \to \Omega^\bullet_{X/S}$.
\end{enumerate}
\end{proposition}

\begin{proof}
By Discriminants, Lemma
\ref{discriminant-lemma-locally-comes-from-universal-finite}
for every $x \in X$ we can find $d \geq 1$ and a commutative diagram
$$
\xymatrix{
Y \ar[d] &
V \ar[d] \ar[l] \ar[r] &
V_d \ar[d] \ar[r] &
Y_d = \Spec(B_d) \ar[d] \\
X &
U \ar[l] \ar[r] &
U_d \ar[r] &
X_d = \Spec(A_d)
}
$$
such that $x \in U \subset X$ is affine open, $V = f^{-1}(U)$
and $V = U \times_{U_d} V_d$. Write $U = \Spec(A)$ and $V = \Spec(B)$
and observe that $B = A \otimes_{A_d} B_d$ and recall that
$B_d = A_d e_1 \oplus \ldots \oplus A_d e_d$. Suppose we have
$a_1, \ldots, a_r \in A$ and $b_1, \ldots, b_s \in B$.
We may write $b_j = \sum a_{j, l} e_d$ with $a_{j, l} \in A$.
Set $N = r + sd$ and consider the factorizations
$$
\xymatrix{
V \ar[r] \ar[d] &
V' = \mathbf{A}^N \times V_d \ar[r] \ar[d] &
V_d \ar[d] \\
U \ar[r]&
U' = \mathbf{A}^N \times U_d \ar[r] &
U_d
}
$$
Here the horizontal lower right arrow is given by the morphism
$U \to U_d$ (from the earlier diagram) and the morphism
$U \to \mathbf{A}^N$ given by $a_1, \ldots, a_r, a_{1, 1}, \ldots, a_{s, d}$.
Then we see that the functions $a_1, \ldots, a_r$ are in the image of
$\Gamma(U', \mathcal{O}_{U'}) \to \Gamma(U, \mathcal{O}_U)$
and the functions $b_1, \ldots, b_s$ are in the image of
$\Gamma(V', \mathcal{O}_{V'}) \to \Gamma(V, \mathcal{O}_V)$.
In this way we see that for any finite collection of elements\footnote{After
all these elements will be finite sums of elements of the form
$a_0 \text{d}a_1 \wedge \ldots \wedge \text{d}a_i$ with
$a_0, \ldots, a_i \in A$ or finite sums of elements of the form
$b_0 \text{d}b_1 \wedge \ldots \wedge \text{d}b_j$ with
$b_0, \ldots, b_j \in B$.} of the groups
$$
\Gamma(V, \Omega^i_{Y/\mathbf{Z}}),\quad i = 0, 1, 2, \ldots
\quad\text{and}\quad
\Gamma(U, \Omega^j_{X/\mathbf{Z}}),\quad j = 0, 1, 2, \ldots
$$
we can find a factorizations $V \to V' \to V_d$ and
$U \to U' \to U_d$ with $V' = \mathbf{A}^N \times V_d$ and
$U' = \mathbf{A}^N \times U_d$ as above
such that these sections are the pullbacks of sections from
$$
\Gamma(V', \Omega^i_{V'/\mathbf{Z}}),\quad i = 0, 1, 2, \ldots
\quad\text{and}\quad
\Gamma(U', \Omega^j_{U'/\mathbf{Z}}),\quad j = 0, 1, 2, \ldots
$$
The upshot of this is that to check
$\text{d} \circ \Theta_{Y/X} = \Theta_{Y/X} \circ \text{d}$
it suffices to check this is true for $\Theta_{V'/U'}$.
Similarly, for property (2) of the lemma.

\medskip\noindent
By Discriminants, Lemmas
\ref{discriminant-lemma-universal-finite-syntomic-smooth} and
\ref{discriminant-lemma-universal-finite-syntomic-etale}
the scheme $U_d$ is smooth and the morphism $V_d \to U_d$
is \'etale over a dense open of $U_d$.
Hence the same is true for the morphism
$V' \to U'$. Since $\Omega_{U'/\mathbf{Z}}$ is locally free and hence
$\Omega^p_{U'/\mathbf{Z}}$ is torsion
free, it suffices to check the desired relations
after restricting to the open over which $V'$ is finite \'etale.
Then we may check the relations after a surjective \'etale
base change. Hence we may split the finite \'etale cover
and assume we are looking at a morphism of the form
$$
\coprod\nolimits_{i = 1, \ldots, d} W \longrightarrow W
$$
with $W$ smooth over $\mathbf{Z}$.
In this case any local properties of our construction are trivial to check
(provided they are true). This finishes the proof of (1) and (2).

\medskip\noindent
Finally, we observe that (3) follows from (2) because $\Omega_{Y/S}$
is the quotient of $\Omega_{Y/\mathbf{Z}}$ by the submodule
generated by pullbacks of local sections of $\Omega_{S/\mathbf{Z}}$.
\end{proof}

\begin{example}
\label{example-Garel}
Let $A$ be a ring. Let $f = x^d + \sum_{0 \leq i < d} a_{d - i} x^i \in A[x]$.
Let $B = A[x]/(f)$. By Proposition \ref{proposition-Garel}
we have a morphism of complexes
$$
\Theta_{B/A} : \Omega^\bullet_B \longrightarrow \Omega^\bullet_A
$$
In particular, if $t \in B$ denotes the image of $x \in A[x]$
we can consider the elements
$$
\Theta_{B/A}(t^i\text{d}t) \in \Omega^1_A,\quad i = 0, \ldots, d - 1
$$
What are these elements? By the same principle as used in the proof of
Proposition \ref{proposition-Garel} it suffices to compute this
in the universal case, i.e., when $A = \mathbf{Z}[a_1, \ldots, a_d]$
or even when $A$ is replaced by the fraction field
$\mathbf{Q}(a_1, \ldots, a_d)$. Writing symbolically
$$
f = \prod\nolimits_{i = 1, \ldots, d} (x - \alpha_i)
$$
we see that over $\mathbf{Q}(\alpha_1, \ldots, \alpha_d)$
the algebra $B$ becomes split:
$$
\mathbf{Q}(a_0, \ldots, a_{d - 1})[x]/(f) 
\longrightarrow
\prod\nolimits_{i = 1, \ldots, d} \mathbf{Q}(\alpha_1, \ldots, \alpha_d),
\quad
t \longmapsto (\alpha_1, \ldots, \alpha_d)
$$
Thus for example
$$
\Theta(\text{d}t) = \sum \text{d} \alpha_i = - \text{d}a_1
$$
Next, we have
$$
\Theta(t\text{d}t) = \sum \alpha_i \text{d}\alpha_i =
a_1 \text{d} a_1 - \text{d}a_2
$$
Next, we have
$$
\Theta(t^2\text{d}t) = \sum \alpha_i^2 \text{d}\alpha_i =
- a_1^2 \text{d} a_1 + a_1 \text{d}a_2 + a_2 \text{d}a_1 - \text{d}a_3
$$
(modulo calculation error), and so on. This suggests that
if $f(x) = x^d - a$ then
$$
\Theta_{B/A}(t^i\text{d}t) =
\left\{
\begin{matrix}
0 & \text{if} & i = 0, \ldots, d - 2 \\
\text{d}a & \text{if} & i = d - 1
\end{matrix}
\right.
$$
in $\Omega_A$. This is true for in this particular case one can do
the calculation for the extension $\mathbf{Q}(a)[x]/(x^d - a)$
to verify this directly.
\end{example}

\begin{lemma}
\label{lemma-Garel-map-frobenius-smooth-char-p}
Let $p$ be a prime number. Let $X \to S$ be a smooth morphism
of relative dimension $d$ of schemes in characteristic $p$.
The relative Frobenius $F_{X/S} : X \to X^{(p)}$ of $X/S$
(Varieties, Definition \ref{varieties-definition-relative-frobenius})
is finite syntomic and the corresponding map
$$
\Theta_{X/X^{(p)}} :
F_{X/S, *}\Omega^\bullet_{X/S} \to \Omega^\bullet_{X^{(p)}/S}
$$
is zero in all degrees except in degree $d$ where it defines a
surjection.
\end{lemma}

\begin{proof}
Observe that $F_{X/S}$ is a finite morphism by
Varieties, Lemma \ref{varieties-lemma-relative-frobenius-finite}.
To prove that $F_{X/S}$ is flat, it suffices to show that
the morphism $F_{X/S, s} : X_s \to X^{(p)}_s$ between fibres
is flat for all $s \in S$, see More on Morphisms, Theorem
\ref{more-morphisms-theorem-criterion-flatness-fibre}.
Flatness of $X_s \to X^{(p)}_s$ follows from
Algebra, Lemma \ref{algebra-lemma-CM-over-regular-flat}
(and the finiteness already shown).
By More on Morphisms, Lemma
\ref{more-morphisms-lemma-lci-permanence}
the morphism $F_{X/S}$ is a local complete intersection morphism.
Hence $F_{X/S}$ is finite syntomic (see
More on Morphisms, Lemma \ref{more-morphisms-lemma-flat-lci}).

\medskip\noindent
For every point $x \in X$ we may choose a commutative diagram
$$
\xymatrix{
X \ar[d] & U \ar[l] \ar[d]_\pi \\
S & \mathbf{A}^d_S \ar[l]
}
$$
where $\pi$ is \'etale and $x \in U$ is open in $X$, see
Morphisms, Lemma \ref{morphisms-lemma-smooth-etale-over-affine-space}.
Observe that
$\mathbf{A}^d_S \to \mathbf{A}^d_S$, $(x_1, \ldots, x_d) \mapsto
(x_1^p, \ldots, x_d^p)$ is the relative Frobenius for $\mathcal{A}^d_S$
over $S$. The commutative diagram
$$
\xymatrix{
U \ar[d]_\pi \ar[r]_{F_{X/S}} & U^{(p)} \ar[d]^{\pi^{(p)}} \\
\mathbf{A}^d_S \ar[r]^{x_i \mapsto x_i^p} & \mathbf{A}^d_S
}
$$
of
Varieties, Lemma \ref{varieties-lemma-relative-frobenius-endomorphism-identity}
for $\pi : U \to \mathbf{A}^d_S$ is cartesian by
\'Etale Morphisms, Lemma
\ref{etale-lemma-relative-frobenius-etale}.
Since the construction of $\Theta$ is compatible with base change
and since $\Omega_{U/S} = \pi^*\Omega_{\mathbf{A}^d_S/S}$
(Lemma \ref{lemma-etale})
we conclude that it suffices to show the lemma for
$\mathbf{A}^d_S$.

\medskip\noindent
Let $A$ be a ring of characteristic $p$. Consider the unique $A$-algebra
homomorphism $A[y_1, \ldots, y_d] \to A[x_1, \ldots, x_d]$
sending $y_i$ to $x_i^p$. The arguments above
reduce us to computing the map
$$
\Theta^i : \Omega^i_{A[x_1, \ldots, x_d]/A} \to
\Omega^i_{A[y_1, \ldots, y_d]/A}
$$
We urge the reader to do the computation in this case for themselves.
As in Example \ref{example-Garel} we may reduce this to computing
a formula for $\Theta^i$ in the universal case
$$
\mathbf{Z}[y_1, \ldots, y_d] \to \mathbf{Z}[x_1, \ldots, x_d],\quad
y_i \mapsto x_i^p
$$
In turn, we can find the formula for $\Theta^i$ by computing in the complex
case, i.e., for the $\mathbf{C}$-algebra map
$$
\mathbf{C}[y_1, \ldots, y_d] \to \mathbf{C}[x_1, \ldots, x_d],\quad
y_i \mapsto x_i^p
$$
We may even invert $x_1, \ldots, x_d$ and $y_1, \ldots, y_d$.
In this case, we have $\text{d}x_i = p^{-1} x_i^{- p + 1}\text{d}y_i$.
Hence we see that
\begin{align*}
\Theta^i(
x_1^{e_1} \ldots x_d^{e_d} \text{d}x_1 \wedge \ldots \wedge \text{d}x_i)
& =
p^{-i} \Theta^i(
x_1^{e_1 - p + 1} \ldots x_i^{e_i - p + 1} x_{i + 1}^{e_{i + 1}} \ldots
x_d^{e_d} \text{d}y_1 \wedge \ldots \wedge \text{d}y_i ) \\
& =
p^{-i} \text{Trace}(x_1^{e_1 - p + 1} \ldots x_i^{e_i - p + 1}
x_{i + 1}^{e_{i + 1}} \ldots x_d^{e_d})
\text{d}y_1 \wedge \ldots \wedge \text{d}y_i
\end{align*}
by the properties of $\Theta^i$. An elementary computation shows
that the trace in the expression above is zero unless
$e_1, \ldots, e_i$ are congruent to $-1$ modulo $p$
and $e_{i + 1}, \ldots, e_d$ are divisible by $p$.
Moreover, in this case we obtain
$$
p^{d - i} y_1^{(e_1 - p + 1)/p} \ldots y_i^{(e_i - p + 1)/p}
y_{i + 1}^{e_{i + 1}/p} \ldots y_d^{e_d/p}
\text{d}y_1 \wedge \ldots \wedge \text{d}y_i
$$
We conclude that we get zero in characteristic $p$ unless $d = i$
and in this case we get every possible $d$-form.
\end{proof}








\section{Poincar\'e duality}
\label{section-poincare-duality}

\noindent
In this section we prove Poincar'e duality for the de Rham cohomology
of a proper smooth scheme over a field. Let us first explain how this
works for Hodge cohomology.

\begin{lemma}
\label{lemma-duality-hodge}
Let $k$ be a field. Let $X$ be a nonempty smooth proper scheme over $k$
equidimensional of dimension $d$. There exists a $k$-linear map
$$
t : H^d(X, \Omega^d_{X/k}) \longrightarrow k
$$
unique up to precomposing by multiplication by a unit of
$H^0(X, \mathcal{O}_X)$ with the following property: for all $p, q$ the pairing
$$
H^q(X, \Omega^p_{X/k}) \times H^{d - q}(X, \Omega^{d - p}_{X/k})
\longrightarrow
k, \quad
(\xi, \xi') \longmapsto t(\xi \cup \xi')
$$
is perfect.
\end{lemma}

\begin{proof}
By Duality for Schemes, Lemma \ref{duality-lemma-duality-proper-over-field}
we have $\omega_X^\bullet = \Omega^d_{X/k}[d]$.
Since $\Omega_{X/k}$ is locally free of rank $d$
(Morphisms, Lemma \ref{morphisms-lemma-smooth-omega-finite-locally-free})
we have
$$
\Omega^d_{X/k} \otimes_{\mathcal{O}_X} (\Omega^p_{X/k})^\vee
\cong
\Omega^{d - p}_{X/k}
$$
Thus we obtain a $k$-linear map $t : H^d(X, \Omega^d_{X/k}) \to k$
such that the statement is true by Duality for Schemes, Lemma
\ref{duality-lemma-duality-proper-over-field-perfect}.
In particular the pairing
$H^0(X, \mathcal{O}_X) \times H^d(X, \Omega^d_{X/k}) \to k$
is perfect, which implies that any $k$-linear map
$t' : H^d(X, \Omega^d_{X/k}) \to k$ is of the form
$\xi \mapsto t(g\xi)$ for some $g \in H^0(X, \mathcal{O}_X)$.
Of course, in order for $t'$ to still produce a duality
between $H^0(X, \mathcal{O}_X)$ and $H^d(X, \Omega^d_{X/k})$
we need $g$ to be a unit. Denote $\langle -, - \rangle_{p, q}$
the pairing constructed using $t$ and denote $\langle -, - \rangle'_{p, q}$
the pairing constructed using $t'$. Clearly we have
$$
\langle \xi, \xi' \rangle'_{p, q} =
\langle g\xi, \xi' \rangle_{p, q}
$$
for $\xi \in H^q(X, \Omega^p_{X/k})$ and
$\xi' \in H^{d - q}(X, \Omega^{d - p}_{X/k})$. Since $g$ is a unit, i.e.,
invertible, we see that using $t'$ instead of $t$ we still get perfect
pairings for all $p, q$.
\end{proof}

\begin{lemma}
\label{lemma-bottom-part-degenerates}
Let $k$ be a field. Let $X$ be a smooth proper scheme over $k$. The map
$$
\text{d} : H^0(X, \mathcal{O}_X) \to H^0(X, \Omega^1_{X/k})
$$
is zero.
\end{lemma}

\begin{proof}
Since $X$ is smooth over $k$ it is geometrically reduced over $k$, see
Varieties, Lemma \ref{varieties-lemma-smooth-geometrically-normal}.
Hence $H^0(X, \mathcal{O}_X) = \prod k_i$
is a finite product of finite separable
field extensions $k_i/k$, see Varieties, Lemma
\ref{varieties-lemma-proper-geometrically-reduced-global-sections}.
It follows that $\Omega_{H^0(X, \mathcal{O}_X)/k} = \prod \Omega_{k_i/k} = 0$
(see for example Algebra, Lemma
\ref{algebra-lemma-characterize-separable-algebraic-field-extensions}).
Since the map of the lemma factors as
$$
H^0(X, \mathcal{O}_X) \to
\Omega_{H^0(X, \mathcal{O}_X)/k} \to
H^0(X, \Omega_{X/k})
$$
by functoriality of the de Rham complex
(see Section \ref{section-de-rham-complex}), we conclude.
\end{proof}

\begin{lemma}
\label{lemma-top-part-degenerates}
Let $k$ be a field. Let $X$ be a smooth proper scheme over $k$
equidimensional of dimension $d$. The map
$$
\text{d} : H^d(X, \Omega^{d - 1}_{X/k}) \to H^d(X, \Omega^d_{X/k})
$$
is zero.
\end{lemma}

\begin{proof}
It is tempting to think this follows from a combination of
Lemmas \ref{lemma-bottom-part-degenerates} and \ref{lemma-duality-hodge}.
However this doesn't work because the maps $\mathcal{O}_X \to \Omega^1_{X/k}$
and $\Omega^{d - 1}_{X/k} \to \Omega^d_{X/k}$ are not $\mathcal{O}_X$-linear
and hence we cannot use the functoriality discussed in
Duality for Schemes, Remark
\ref{duality-remark-coherent-duality-proper-over-field}
to conclude the map in Lemma \ref{lemma-bottom-part-degenerates}
is dual to the one in this lemma.

\medskip\noindent
We may replace $X$ by a connected component of $X$. Hence we may assume
$X$ is irreducible. By
Varieties, Lemmas \ref{varieties-lemma-smooth-geometrically-normal} and
\ref{varieties-lemma-proper-geometrically-reduced-global-sections}
we see that $k' = H^0(X, \mathcal{O}_X)$ is a finite separable
extension $k'/k$. Since $\Omega_{k'/k} = 0$
(see for example Algebra, Lemma
\ref{algebra-lemma-characterize-separable-algebraic-field-extensions})
we see that $\Omega_{X/k} = \Omega_{X/k'}$
(see Morphisms, Lemma \ref{morphisms-lemma-triangle-differentials}).
Thus we may replace $k$ by $k'$ and assume that $H^0(X, \mathcal{O}_X) = k$.

\medskip\noindent
Assume $H^0(X, \mathcal{O}_X) = k$. We conclude that
$\dim H^d(X, \Omega^d_{X/k}) = 1$ by Lemma \ref{lemma-duality-hodge}.
Assume first that the characteristic of $k$ is a prime number $p$.
Denote $F_{X/k} : X \to X^{(p)}$ the relative Frobenius of $X$ over $k$;
please keep in mind the facts proved about this morphism in
Lemma \ref{lemma-Garel-map-frobenius-smooth-char-p}.
Consider the commutative diagram
$$
\xymatrix{
H^d(X, \Omega^{d - 1}_{X/k}) \ar[d] \ar[r] &
H^d(X^{(p)}, F_{X/k, *}\Omega^{d - 1}_{X/k}) \ar[d] \ar[r]_{\Theta^{d - 1}} &
H^d(X^{(p)}, \Omega^{d - 1}_{X^{(p)}/k}) \ar[d] \\
H^d(X, \Omega^d_{X/k}) \ar[r] &
H^d(X^{(p)}, F_{X/k, *}\Omega^d_{X/k}) \ar[r]^{\Theta^d} &
H^d(X^{(p)}, \Omega^d_{X^{(p)}/k})
}
$$
The left two horizontal arrows are isomorphisms as $F_{X/k}$ is finite, see
Cohomology of Schemes, Lemma \ref{coherent-lemma-relative-affine-cohomology}.
The right square commutes as $\Theta_{X^{(p)}/X}$ is a morphism of
complexes and $\Theta^{d - 1}$ is zero. Thus it suffices to show that
$\Theta^d$ is nonzero (because the dimension of the source of the map
$\Theta^d$ is $1$ by the discussion above). However, we know that
$$
\Theta^d : F_{X/k, *}\Omega^d_{X/k} \to \Omega^d_{X^{(p)}/k}
$$
is surjective and hence surjective after applying the right exact
functor $H^d(X^{(p)}, -)$ (right exactness by the vanishing of cohomology
beyond $d$ as follows from
Cohomology, Proposition \ref{cohomology-proposition-vanishing-Noetherian}).
Finally, $H^d(X^{(d)}, \Omega^d_{X^{(d)}/k})$ is nonzero for example because
it is dual to $H^0(X^{(d)}, \mathcal{O}_{X^{(p)}})$ by
Lemma \ref{lemma-duality-hodge} applied to $X^{(p)}$ over $k$.
This finishes the proof in this case.

\medskip\noindent
Finally, assume the characteristic of $k$ is $0$.
We can write $k$ as the filtered colimit of its finite type
$\mathbf{Z}$-subalgebras $R$. For one of these we can find a
cartesian diagram of schemes
$$
\xymatrix{
X \ar[d] \ar[r] & Y \ar[d] \\
\Spec(k) \ar[r] & \Spec(R)
}
$$
such that $Y \to \Spec(R)$ is smooth of relative dimension $d$ and proper.
See Limits, Lemmas \ref{limits-lemma-descend-finite-presentation},
\ref{limits-lemma-descend-smooth}, \ref{limits-lemma-descend-dimension-d}, and
\ref{limits-lemma-eventually-proper}.
The modules $M^{i, j} = H^j(Y, \Omega^i_{Y/R})$ are finite $R$-modules, see
Cohomology of Schemes, Lemma
\ref{coherent-lemma-proper-over-affine-cohomology-finite}.
Thus after replacing $R$ by a localization we may assume all of these
modules are finite free. We have
$M^{i, j} \otimes_R k = H^j(X, \Omega^i_{X/k})$
by flat base change (Cohomology of Schemes, Lemma
\ref{coherent-lemma-flat-base-change-cohomology}).
Thus it suffices to show that $M^{d - 1, d} \to M^{d, d}$
is zero. This is a map of finite free modules over a domain,
hence it suffices to find a dense set of primes $\mathfrak p \subset R$
such that after tensoring with $\kappa(\mathfrak p)$ we get zero.
Since $R$ is of finite type over $\mathbf{Z}$, we can take
the collection of primes $\mathfrak p$ whose residue field
has positive characteristic (details omitted). Observe that
$$
M^{d - 1, d} \otimes_R \kappa(\mathfrak p) =
H^d(Y_{\kappa(\mathfrak p)},
\Omega^{d - 1}_{Y_{\kappa(\mathfrak p)}/\kappa(\mathfrak p)})
$$
for example by Limits, Lemma
\ref{limits-lemma-higher-direct-images-zero-above-dimension-fibre}.
Similarly for $M^{d, d}$. Thus we see that
$M^{d - 1, d} \otimes_R \kappa(\mathfrak p) \to
M^{d, d} \otimes_R \kappa(\mathfrak p)$
is zero by the case of positive characteristic handled above.
\end{proof}

\begin{proposition}
\label{proposition-poincare-duality}
Let $k$ be a field. Let $X$ be a nonempty smooth proper scheme over $k$
equidimensional of dimension $d$. There exists a $k$-linear map
$$
t : H^{2d}_{dR}(X/k) \longrightarrow k
$$
unique up to precomposing by multiplication by a unit of
$H^0(X, \mathcal{O}_X)$ with the following property: for all $i$ the pairing
$$
H^i_{dR}(X/k) \times H_{dR}^{2d - i}(X/k)
\longrightarrow
k, \quad
(\xi, \xi') \longmapsto t(\xi \cup \xi')
$$
is perfect.
\end{proposition}

\begin{proof}
By the Hodge-to-de Rham spectral sequence
(Section \ref{section-hodge-to-de-rham}), the vanishing
of $\Omega^i_{X/k}$ for $i > d$, the vanishing in
Cohomology, Proposition \ref{cohomology-proposition-vanishing-Noetherian}
and the results of Lemmas \ref{lemma-bottom-part-degenerates} and
\ref{lemma-top-part-degenerates}
we see that $H^0_{dR}(X/k) = H^0(X, \mathcal{O}_X)$
and $H^d(X, \Omega^d_{X/k}) = H_{dR}^{2d}(X/k)$.
More precisely, these identifications come from the maps
of complexes
$$
\Omega^\bullet_{X/k} \to \mathcal{O}_X[0]
\quad\text{and}\quad
\Omega^d_{X/k}[-d] \to \Omega^\bullet_{X/k}
$$
Let us choose $t : H_{dR}^{2d}(X/k) \to k$ which via this identification
corresponds to a $t$ as in Lemma \ref{lemma-duality-hodge}.
Then in any case we see that the pairing displayed in the lemma
is perfect for $i = 0$.

\medskip\noindent
Denote $\underline{k}$ the constant sheaf with value $k$ on $X$.
Let us abbreviate $\Omega^\bullet = \Omega^\bullet_{X/k}$.
Consider the map (\ref{equation-wedge}) which in our situation reads
$$
\wedge :
\text{Tot}(\Omega^\bullet \otimes_{\underline{k}} \Omega^\bullet)
\longrightarrow
\Omega^\bullet
$$
For every integer $p = 0, 1, \ldots, d$ this map
annihilates the subcomplex
$\text{Tot}(\sigma_{> p} \Omega^\bullet \otimes_{\underline{k}}
\sigma_{\geq d - p} \Omega^\bullet)$ for degree reasons.
Hence we find that the restriction of $\wedge$ to the subcomplex
$\text{Tot}(\Omega^\bullet \otimes_{\underline{k}}
\sigma_{\geq d - p}\Omega^\bullet)$ factors through a map of complexes
$$
\gamma_p :
\text{Tot}(\sigma_{\leq p} \Omega^\bullet \otimes_{\underline{k}}
\sigma_{\geq d - p} \Omega^\bullet)
\longrightarrow
\Omega^\bullet
$$
Using the same procedure as in Section \ref{section-cup-product} we obtain
cup products
$$
H^i(X, \sigma_{\leq p} \Omega^\bullet) \times
H^{2d - i}(X, \sigma_{\geq d - p}\Omega^\bullet)
\longrightarrow
H_{dR}^{2d}(X, \Omega^\bullet)
$$
We will prove by induction on $p$ that these cup products via $t$
induce perfect pairings between $H^i(X, \sigma_{\leq p} \Omega^\bullet)$
and $H^{2d - i}(X, \sigma_{\geq d - p}\Omega^\bullet)$. For $p = d$
this is the assertion of the proposition.

\medskip\noindent
The base case is $p = 0$. In this case we simply obtain the pairing
between $H^i(X, \mathcal{O}_X)$ and $H^{d - i}(X, \Omega^d)$ of
Lemma \ref{lemma-duality-hodge} and the result is true.

\medskip\noindent
Induction step. Say we know the result is true for $p$. Then
we consider the distinguished triangle
$$
\Omega^{p + 1}[-p - 1] \to
\sigma_{\leq p + 1}\Omega^\bullet \to
\sigma_{\leq p}\Omega^\bullet \to
\Omega^{p + 1}[-p]
$$
and the distinguished triangle
$$
\sigma_{\geq d - p}\Omega^\bullet \to
\sigma_{\geq d - p - 1}\Omega^\bullet \to
\Omega^{d - p - 1}[-d + p + 1] \to
(\sigma_{\geq d - p}\Omega^\bullet)[1]
$$
Observe that both are distinguished triangles in the homotopy category
of complexes of sheaves of $\underline{k}$-modules; in particular the
maps $\sigma_{\leq p}\Omega^\bullet \to \Omega^{p + 1}[-p]$ and
$\Omega^{d - p - 1}[-d + p + 1] \to (\sigma_{\geq d - p}\Omega^\bullet)[1]$
are given by actual maps of complexes, namely using the differential
$\Omega^p \to \Omega^{p + 1}$ and the differential
$\Omega^{d - p - 1} \to \Omega^{d - p}$.
Consider the long exact cohomology sequences associated to these
distinguished triangles
$$
\xymatrix{
H^{i - 1}(X, \sigma_{\leq p}\Omega^\bullet) \ar[d]_a \\
H^i(X, \Omega^{p + 1}[-p - 1]) \ar[d]_b \\
H^i(X, \sigma_{\leq p + 1}\Omega^\bullet) \ar[d]_c \\
H^i(X, \sigma_{\leq p}\Omega^\bullet) \ar[d]_d \\
H^{i + 1}(X, \Omega^{p + 1}[-p - 1])
}
\quad\quad
\xymatrix{
H^{2d - i  + 1}(X, \sigma_{\geq d - p}\Omega^\bullet) \\
H^{2d - i}(X, \Omega^{d - p - 1}[-d + p + 1]) \ar[u]_{a'} \\
H^{2d - i}(X, \sigma_{\geq d - p - 1}\Omega^\bullet) \ar[u]_{b'} \\
H^{2d - i}(X, \sigma_{\geq d - p}\Omega^\bullet) \ar[u]_{c'} \\
H^{2d - i - 1}(X, \Omega^{d - p - 1}[-d + p + 1]) \ar[u]_{d'}
}
$$
By induction and Lemma \ref{lemma-duality-hodge}
we know that the pairings constructed above between the
$k$-vectorspaces on the first, second, fourth, and fifth
rows are perfect. By the $5$-lemma, in order to show that
the pairing between the cohomology groups in the middle row
is perfect, it suffices to show that the pairs
$(a, a')$, $(b, b')$, $(c, c')$, and $(d, d')$
are compatible with the given pairings (see below).

\medskip\noindent
Let us prove this for the pair $(c, c')$. Here we observe simply
that we have a commutative diagram
$$
\xymatrix{
\text{Tot}(\sigma_{\leq p} \Omega^\bullet \otimes_{\underline{k}}
\sigma_{\geq d - p} \Omega^\bullet) \ar[d]_{\gamma_p} &
\text{Tot}(\sigma_{\leq p + 1} \Omega^\bullet \otimes_{\underline{k}}
\sigma_{\geq d - p} \Omega^\bullet) \ar[l] \ar[d] \\
\Omega^\bullet &
\text{Tot}(\sigma_{\leq p + 1} \Omega^\bullet \otimes_{\underline{k}}
\sigma_{\geq d - p - 1} \Omega^\bullet) \ar[l]_-{\gamma_{p + 1}}
}
$$
Hence if we have $\alpha \in H^i(X, \sigma_{\leq p + 1}\Omega^\bullet)$
and $\beta \in H^{2d - i}(X, \sigma_{\geq d - p}\Omega^\bullet)$
then we get
$\gamma_p(\alpha \cup c'(\beta)) = \gamma_{p + 1}(c(\alpha) \cup \beta)$
by functoriality of the cup product.

\medskip\noindent
Similarly for the pair $(b, b')$ we use the commutative diagram
$$
\xymatrix{
\text{Tot}(\sigma_{\leq p + 1} \Omega^\bullet \otimes_{\underline{k}}
\sigma_{\geq d - p - 1} \Omega^\bullet) \ar[d]_{\gamma_{p + 1}} &
\text{Tot}(\Omega^{p + 1}[-p - 1] \otimes_{\underline{k}}
\sigma_{\geq d - p - 1} \Omega^\bullet) \ar[l] \ar[d] \\
\Omega^\bullet &
\Omega^{p + 1}[-p - 1]
\otimes_{\underline{k}}
\Omega^{d - p - 1}[-d + p + 1] \ar[l]_-\wedge
}
$$
and argue in the same manner.

\medskip\noindent
For the pair $(d, d')$ we use the commutative diagram
$$
\xymatrix{
\Omega^{p + 1}[-p] \otimes_{\underline{k}}
\Omega^{d - p - 1}[-d + p] \ar[d] &
\text{Tot}(\sigma_{\leq p}\Omega^\bullet \otimes_{\underline{k}}
\Omega^{d - p - 1}[-d + p]) \ar[l] \ar[d] \\
\Omega^\bullet &
\text{Tot}(\sigma_{\leq p}\Omega^\bullet \otimes_{\underline{k}}
\sigma_{\geq d - p}\Omega^\bullet) \ar[l]
}
$$
and we look at cohomology classes in
$H^i(X, \sigma_{\leq p}\Omega^\bullet)$ and
$H^{2d - i}(X, \Omega^{d - p - 1}[-d + p])$.
Changing $i$ to $i - 1$ we get the result for the pair $(a, a')$
thereby finishing the proof that our pairings are perfect.

\medskip\noindent
We omit the argument showing the uniqueness of $t$ up to
precomposing by multiplication by a unit in $H^0(X, \mathcal{O}_X)$.
\end{proof}







\section{Chern classes}
\label{section-chern-classes}

\noindent
The results proved so far suffice to use the discussion in
Weil Cohomology Theories, Section \ref{weil-section-chern}
to produce Chern classes in de Rham cohomology.

\begin{lemma}
\label{lemma-chern-classes}
There is a unique rule which assigns to every quasi-compact and
quasi-separated scheme $X$ a total Chern class
$$
c^{dR} :
K_0(\textit{Vect}(X))
\longrightarrow
\prod\nolimits_{i \geq 0} H^{2i}_{dR}(X/\mathbf{Z})
$$
with the following properties
\begin{enumerate}
\item we have $c^{dR}(\alpha + \beta) = c^{dR}(\alpha) c^{dR}(\beta)$
for $\alpha, \beta \in K_0(\textit{Vect}(X))$,
\item if $f : X \to X'$ is a morphism of quasi-compact and
quasi-separated schemes, then $c^{dR}(f^*\alpha) = f^*c^{dR}(\alpha)$,
\item given $\mathcal{L} \in \Pic(X)$ we have
$c^{dR}([\mathcal{L}]) = 1 + c_1^{dR}(\mathcal{L})$
\end{enumerate}
\end{lemma}

\noindent
The construction can easily be extended to all schemes, but to do so one needs
to slightly upgrade the discussion in Weil Cohomology Theories,
Section \ref{weil-section-chern}.

\begin{proof}
We will apply Weil Cohomology Theories, Proposition
\ref{weil-proposition-chern-class} to get this.

\medskip\noindent
Let $\mathcal{C}$ be the category of all quasi-compact and quasi-separated
schemes. This certainly satisfies conditions
(1), (2), and (3) (a), (b), and (c) of  Weil Cohomology Theories,
Section \ref{weil-section-chern}.

\medskip\noindent
As our contravariant functor $A$ from $\mathcal{C}$ to the
category of graded algebras will send $X$ to
$A(X) = \bigoplus_{i \geq 0} H_{dR}^{2i}(X/\mathbf{Z})$
endowed with its cup product.
Functoriality is discussed in Section \ref{section-de-rham-cohomology}
and the cup product in Section \ref{section-cup-product}.
For the additive maps $c_1^A$ we take $c_1^{dR}$ constructed
in Section \ref{section-first-chern-class}.

\medskip\noindent
In fact, we obtain commutative algebras by
Lemma \ref{lemma-cup-product-graded-commutative}
which shows we have axiom (1) for $A$.

\medskip\noindent
To check axiom (2) for $A$ it suffices to check that
$H^*_{dR}(X \coprod Y/\mathbf{Z}) =  H^*_{dR}(X/\mathbf{Z}) \times
H^*_{dR}(Y/\mathbf{Z})$.
This is a consequence of the fact that de Rham cohomology
is constructed by taking the cohomology of a sheaf of differential
graded algebras (in the Zariski topology).

\medskip\noindent
Axiom (3) for $A$ is just the statement that taking first Chern
classes of invertible modules is compatible with pullbacks.
This follows from the more general Lemma \ref{lemma-pullback-c1}.

\medskip\noindent
Axiom (4) for $A$ is the projective space bundle formula which
we proved in Proposition \ref{proposition-projective-space-bundle-formula}.

\medskip\noindent
Axiom (5).  Let $X$ be a quasi-compact and quasi-separated scheme and
let $\mathcal{E} \to \mathcal{F}$ be a surjection of finite locally free
$\mathcal{O}_X$-modules of ranks $r + 1$ and $r$. Denote
$i : P' = \mathbf{P}(\mathcal{F}) \to \mathbf{P}(\mathcal{E}) = P$ the
corresponding incusion morphism. This is a morphism of smooth projective
schemes over $X$ which exhibits $P'$ as an effective Cartier divisor on $P$.
Thus by Lemma \ref{lemma-check-log-smooth} the complex of log poles
for $P' \subset P$ over $\mathbf{Z}$ is defined.
Hence for $a \in A(P)$ with $i^*a = 0$ we have
$a \cup c_1^A(\mathcal{O}_P(P')) = 0$ by
Lemma \ref{lemma-log-complex-consequence}.
This finishes the proof.
\end{proof}

\begin{remark}
\label{remark-splitting-principle}
The analogues of Weil Cohomology Theories, Lemmas
\ref{weil-lemma-splitting-principle} (splitting principle) and
\ref{weil-lemma-chern-classes-E-tensor-L} (chern classes of tensor products)
hold for de Rham Chern classes on quasi-compact and quasi-separated schemes.
This is clear as we've shown in the proof of
Lemma \ref{lemma-chern-classes}
that all the axioms of Weil Cohomology Theories, Section
\ref{weil-section-chern} are satisfied.
\end{remark}

\noindent
Working with schemes over $\mathbf{Q}$ we can construct a Chern character.

\begin{lemma}
\label{lemma-chern-character}
There is a unique rule which assigns to every quasi-compact and quasi-separated
scheme $X$ over $\mathbf{Q}$ a ``chern character''
$$
ch^{dR} : K_0(\textit{Vect}(X)) \longrightarrow
\prod\nolimits_{i \geq 0} H_{dR}^{2i}(X/\mathbf{Q})
$$
with the following properties
\begin{enumerate}
\item $ch^{dR}$ is a ring map for all $X$,
\item if $f : X' \to X$ is a morphism of quasi-compact and quasi-separated
schemes over $\mathbf{Q}$, then $f^* \circ ch^{dR} =  ch^{dR} \circ f^*$, and
\item given $\mathcal{L} \in \Pic(X)$
we have $ch^{dR}([\mathcal{L}]) = \exp(c_1^{dR}(\mathcal{L}))$.
\end{enumerate}
\end{lemma}

\noindent
The construction can easily be extended to all schemes over $\mathbf{Q}$,
but to do so one needs to slightly upgrade the discussion in
Weil Cohomology Theories, Section \ref{weil-section-chern}.

\begin{proof}
Exactly as in the proof of Lemma \ref{lemma-chern-classes}
one shows that the category of quasi-compact and quasi-separated
schemes over $\mathbf{Q}$ together with the functor
$A^*(X) = \bigoplus_{i \geq 0} H_{dR}^{2i}(X/\mathbf{Q})$
satisfy the axioms of
Weil Cohomology Theories, Section \ref{weil-section-chern}.
Moreover, in this case $A(X)$ is a $\mathbf{Q}$-algebra for
all $X$. Hence the lemma follows from
Weil Cohomology Theories, Proposition
\ref{weil-proposition-chern-character}.
\end{proof}







\section{A Weil cohomology theory}
\label{section-weil}

\noindent
Let $k$ be a field of characteristic $0$. In this section we prove that
the functor
$$
X \longmapsto H^*_{dR}(X/k)
$$
defines a Weil cohomology theory over $k$ with coefficients in $k$ as defined
in Weil Cohomology Theories, Definition
\ref{weil-definition-weil-cohomology-theory}.
We will proceed by checking the constructions earlier in this
chapter provide us with data (D0), (D1), and (D2') satisfying
axioms (A1) -- (A9) of
Weil Cohomology Theories, Section \ref{weil-section-c1}.

\medskip\noindent
Throughout the rest of this section we fix the field $k$ of characteristic
$0$ and we set $F = k$. Next, we take the following data
\begin{enumerate}
\item[(D0)] For our $1$-dimensional $F$ vector space $F(1)$ we take
$F(1) = F = k$.
\item[(D1)] For our functor $H^*$ we take the functor sending
a smooth projective scheme $X$ over $k$ to $H^*_{dR}(X/k)$.
Functoriality is discussed in Section \ref{section-de-rham-cohomology}
and the cup product in Section \ref{section-cup-product}.
We obtain graded commutative $F$-algebras by
Lemma \ref{lemma-cup-product-graded-commutative}.
\item[(D2')] For the maps $c_1^H : \Pic(X) \to H^2(X)(1)$ we
use the de Rham first Chern class introduced in
Section \ref{section-first-chern-class}.
\end{enumerate}
We are going to show axioms (A1) -- (A9) hold.

\medskip\noindent
In this paragraph, we are going to reduce the checking of the
axioms to the case where $k$ is algebraically closed by
using Weil Cohomology Theories, Lemma \ref{weil-lemma-check-over-extension}.
Denote $k'$ the algebraic closure of $k$.
Set $F' = k'$. We obtain data (D0), (D1), (D2') over $k'$ with
coefficient field $F'$ in exactly the same way as above.
By Lemma \ref{lemma-proper-smooth-de-Rham} there are
functorial isomorphisms
$$
H_{dR}^{2d}(X/k) \otimes_k k'
\longrightarrow
H_{dR}^{2d}(X_{k'}/k')
$$
for $X$ smooth and projective over $k$. Moreover, the diagrams
$$
\xymatrix{
\Pic(X) \ar[r]_{c^{dR}_1} \ar[d] & H_{dR}^2(X/k) \ar[d] \\
\Pic(X_{k'}) \ar[r]^{c^{dR}_1} & H_{dR}^2(X_{k'}/k')
}
$$
commute by Lemma \ref{lemma-pullback-c1}.
This finishes the proof of the reduction.

\medskip\noindent
Assume $k$ is algebraically closed field of characteristic zero.
We will show axioms (A1) -- (A9) for the data (D0), (D1), and (D2')
given above.

\medskip\noindent
Axiom (A1). Here we have to check that
$H^*_{dR}(X \coprod Y/k) =  H^*_{dR}(X/k) \times H^*_{dR}(Y/k)$.
This is a consequence of the fact that de Rham cohomology
is constructed by taking the cohomology of a sheaf of differential
graded algebras (in the Zariski topology).

\medskip\noindent
Axiom (A2). This is just the statement that taking first Chern
classes of invertible modules is compatible with pullbacks.
This follows from the more general Lemma \ref{lemma-pullback-c1}.

\medskip\noindent
Axiom (A3). This follows from the more general
Proposition \ref{proposition-projective-space-bundle-formula}.

\medskip\noindent
Axiom (A4). This follows from the more general
Lemma \ref{lemma-log-complex-consequence}.

\medskip\noindent
Already at this point, using
Weil Cohomology Theories, Lemmas \ref{weil-lemma-chern-classes} and
\ref{weil-lemma-cycle-classes}, we obtain a Chern character and
cycle class maps
$$
\gamma :
\CH^*(X)
\longrightarrow
\bigoplus\nolimits_{i \geq 0} H^{2i}_{dR}(X/k)
$$
for $X$ smooth projective over $k$ which are graded ring homomorphisms
compatible with pullbacks between morphisms $f : X \to Y$
of smooth projective schemes over $k$.

\medskip\noindent
Axiom (A5). We have $H_{dR}^*(\Spec(k)/k) = k = F$ in degree $0$.
We have the K\"unneth formula for the product of two smooth projective
$k$-schemes by Lemma \ref{lemma-kunneth-de-rham} (observe that the
derived tensor products in the statement are harmless as we are
tensoring over the field $k$).

\medskip\noindent
Axiom (A7). This follows from Proposition \ref{proposition-blowup-split}.

\medskip\noindent
Axiom (A8). Let $X$ be a smooth projective scheme over $k$.
By the explanatory text to this axiom in
Weil Cohomology Theories, Section \ref{weil-section-c1}
we see that $k' = H^0(X, \mathcal{O}_X)$ is a finite
separable $k$-algebra. It follows that $H_{dR}^*(\Spec(k')/k) = k'$
sitting in degree $0$ because $\Omega_{k'/k} = 0$. By
Lemma \ref{lemma-bottom-part-degenerates}
we also have $H_{dR}^0(X, \mathcal{O}_X) = k'$ and we get
the axiom.

\medskip\noindent
Axiom (A6). Let $X$ be a nonempty smooth projective scheme over $k$
which is equidimensional of dimension $d$. Denote
$\Delta : X \to X \times_{\Spec(k)} X$
the diagonal morphism of $X$ over $k$. We have to show that there
exists a $k$-linear map
$$
\lambda : H_{dR}^{2d}(X/k) \longrightarrow k
$$
such that $(1 \otimes \lambda)\gamma([\Delta]) = 1$ in $H^0_{dR}(X/k)$.
Let us write
$$
\gamma = \gamma([\Delta]) = \gamma_0 + \ldots + \gamma_{2d}
$$
with $\gamma_i \in H_{dR}^i(X/k) \otimes_k H_{dR}^{2d - i}(X/k)$
the K\"unneth components. Our problem is to show that there is a
linear map $\lambda : H_{dR}^{2d}(X/k) \to k$ such that
$(1 \otimes \lambda)\gamma_0 = 1$ in $H^0_{dR}(X/k)$.

\medskip\noindent
Let $X = \coprod X_i$ be the decomposition of $X$ into connected
and hence irreducible components. Then we have correspondingly
$\Delta = \coprod \Delta_i$ with $\Delta_i \subset X_i \times X_i$.
It follows that
$$
\gamma([\Delta]) = \sum \gamma([\Delta_i])
$$
and moreover $\gamma([\Delta_i])$ corresponds to the class of
$\Delta_i \subset X_i \times X_i$ via the decomposition
$$
H^*_{dR}(X \times X) = \prod\nolimits_{i, j} H^*_{dR}(X_i \times X_j)
$$
We omit the details; one way to show this is to use that in
$\CH^0(X \times X)$ we have idempotents $e_{i, j}$ corresponding to
the open and closed subschemes $X_i \times X_j$ and to use that
$\gamma$ is a ring map which sends $e_{i, j}$ to the corresponding
idempotent in the displayed product decomposition of cohomology.
If we can find $\lambda_i : H_{dR}^{2d}(X_i/k) \to k$ with
$(1 \otimes \lambda_i)\gamma([\Delta_i]) = 1$ in $H^0_{dR}(X_i/k)$
then taking $\lambda = \sum \lambda_i$ will solve the problem for $X$.
Thus we may and do assume $X$ is irreducible.

\medskip\noindent
Proof of Axiom (A6) for $X$ irreducible. Since $k$ is algebraically
closed we have $H^0_{dR}(X/k) = k$ because $H^0(X, \mathcal{O}_X) = k$
as $X$ is a projective variety over an algebraically closed field
(see Varieties, Lemma
\ref{varieties-lemma-proper-geometrically-reduced-global-sections}
for example). Let $x \in X$ be any closed point.
Consider the cartesian diagram
$$
\xymatrix{
x \ar[d] \ar[r] & X \ar[d]^\Delta \\
X \ar[r]^-{x \times \text{id}} & X \times_{\Spec(k)} X
}
$$
Compatibility of $\gamma$ with pullbacks implies that
$\gamma([\Delta])$ maps to $\gamma([x])$ in $H_{dR}^{2d}(X/k)$,
in other words, we have $\gamma_0 = 1 \otimes \gamma([x])$.
We conclude two things from this: (a) the class
$\gamma([x])$ is independent of $x$, (b) it suffices
to show the class $\gamma([x])$ is nonzero, and hence (c)
it suffices to find any zero cycle $\alpha$ on $X$ such that
$\gamma(\alpha) \not = 0$. To do this we choose a finite
morphism
$$
f : X \longrightarrow \mathbf{P}^d_k
$$
To see such a morphism exist, see
Intersection Theory, Section \ref{intersection-section-projection}
and in particular Lemma \ref{intersection-lemma-projection-generically-finite}.
Observe that $f$ is finite syntomic (local complete intersection morphism
by More on Morphisms, Lemma \ref{more-morphisms-lemma-lci-permanence}
and flat by Algebra, Lemma \ref{algebra-lemma-CM-over-regular-flat}).
By Proposition \ref{proposition-Garel} we have a trace map
$$
\Theta_f :
f_*\Omega^\bullet_{X/k}
\longrightarrow
\Omega^\bullet_{\mathbf{P}^d_k/k}
$$
whose composition with the canonical map
$$
\Omega^\bullet_{\mathbf{P}^d_k/k}
\longrightarrow
f_*\Omega^\bullet_{X/k}
$$
is multiplication by the degree of $f$. Hence we see that we get a map
$$
\Theta : H_{dR}^{2d}(X/k) \to H_{dR}^{2d}(\mathbf{P}^d_k/k)
$$
such that $\Theta \circ f^*$ is multiplication by a positive integer.
Hence if we can find a zero cycle on $\mathbf{P}^d_k$ whose class
is nonzero, then we conclude by the compatibility of $\gamma$
with pullbacks. This is true by
Lemma \ref{lemma-de-rham-cohomology-projective-space} and this
finishes the proof of axiom (A6).

\medskip\noindent
Below we will use the following without further mention.
First, by Weil Cohomology Theories, Remark \ref{weil-remark-trace}
the map $\lambda_X : H^{2d}_{dR}(X/k) \to k$ is unique.
Second, in the proof of axiom (A6) we have
seen that $\lambda_X(\gamma([x])) = 1$ when $X$ is irreducible, i.e.,
the composition of the cycle class map
$\gamma : \CH^d(X) \to H_{dR}^{2d}(X/k)$ with $\lambda_X$
is the degree map.

\medskip\noindent
Axiom (A9). Let $Y \subset X$ be a nonempty smooth divisor on a
nonempty smooth equidimensional projective scheme $X$ over $k$
of dimension $d$. We have to show that the diagram
$$
\xymatrix{
H_{dR}^{2d - 2}(X/k)
\ar[rrr]_{c^{dR}_1(\mathcal{O}_X(Y)) \cap -} \ar[d]_{restriction} & & &
H_{dR}^{2d}(X) \ar[d]^{\lambda_X} \\
H_{dR}^{2d - 2}(Y/k) \ar[rrr]^-{\lambda_Y} & & & k
}
$$
commutes where $\lambda_X$ and $\lambda_Y$ are as in axiom (A6).
Above we have seen that if we decompose $X = \coprod X_i$ into connected
(equivalently irreducible) components, then
we have correspondingly $\lambda_X = \sum \lambda_{X_i}$.
Similarly, if we decompoese $Y = \coprod Y_j$ into connected (equivalently
irreducible) components, then we have $\lambda_Y = \sum \lambda_{Y_j}$.
Moreover, in this case we have
$\mathcal{O}_X(Y) = \otimes_j \mathcal{O}_X(Y_j)$ and hence
$$
c_1^{dR}(\mathcal{O}_X(Y)) = \sum\nolimits_j
c^{dR}_1(\mathcal{O}_X(Y_j))
$$
in $H_{dR}^2(X/k)$. A straightforward diagram chase shows that it suffices
to prove the commutativity of the diagram in case $X$ and $Y$ are both
irreducible. Then $H_{dR}^{2d - 2}(Y/k)$ is $1$-dimensional as
we have Poincar\'e duality for $Y$ by
Weil Cohomology Theories, Lemma \ref{weil-lemma-poincare-duality}.
By axiom (A4) the kernel of restriction (left vertical arrow)
is contained in the kernel of cupping with $c^{dR}_1(\mathcal{O}_X(Y))$.
This means it suffices to find one cohomology class
$a \in H_{dR}^{2d - 2}(X)$ whose restriction to $Y$ is nonzero
such that we have commutativity in the diagram for $a$.
Take any ample invertible module $\mathcal{L}$ and set
$$
a = c^{dR}_1(\mathcal{L})^{d - 1}
$$
Then we know that $a|_Y = c^{dR}_1(\mathcal{L}|_Y)^{d - 1}$
and hence
$$
\lambda_Y(a|_Y) = \deg(c_1(\mathcal{L}|_Y)^{d - 1} \cap [Y])
$$
by our description of $\lambda_Y$ above. This is a positive integer
by Chow Homology, Lemma
\ref{chow-lemma-degrees-and-numerical-intersections} combined with
Varieties, Lemma \ref{varieties-lemma-ample-positive}.
Similarly, we find
$$
\lambda_X(c^{dR}_1(\mathcal{O}_X(Y)) \cap a) =
\deg(c_1(\mathcal{O}_X(Y)) \cap c_1(\mathcal{L})^{d - 1} \cap [X])
$$
Since we know that $c_1(\mathcal{O}_X(Y)) \cap [X] = [Y]$ more or
less by definition we have an equality of zero cycles
$$
(Y \to X)_*\left(c_1(\mathcal{L}|_Y)^{d - 1} \cap [Y]\right) =
c_1(\mathcal{O}_X(Y)) \cap c_1(\mathcal{L})^{d - 1} \cap [X]
$$
on $X$. Thus these cycles have the same degree and the proof is complete.

\begin{proposition}
\label{proposition-de-rham-is-weil}
Let $k$ be a field of characteristic zero. The functor that
sends a smooth projective scheme $X$ over $k$ to $H_{dR}^*(X/k)$
is a Weil cohomology theory in the sense of
Weil Cohomology Theories, Definition
\ref{weil-definition-weil-cohomology-theory}.
\end{proposition}

\begin{proof}
In the discussion above we showed that our data (D0), (D1), (D2')
satisfies axioms (A1) -- (A9) of Weil Cohomology Theories, Section
\ref{weil-section-c1}. Hence we conclude by
Weil Cohomology Theories, Proposition \ref{weil-proposition-get-weil}.

\medskip\noindent
Please don't read what follows. In the proof of the assertions we also used
Lemmas \ref{lemma-proper-smooth-de-Rham},
\ref{lemma-pullback-c1},
\ref{lemma-log-complex-consequence},
\ref{lemma-kunneth-de-rham},
\ref{lemma-bottom-part-degenerates}, and
\ref{lemma-de-rham-cohomology-projective-space},
Propositions
\ref{proposition-projective-space-bundle-formula},
\ref{proposition-blowup-split}, and
\ref{proposition-Garel},
Weil Cohomology Theories, Lemmas
\ref{weil-lemma-check-over-extension},
\ref{weil-lemma-chern-classes},
\ref{weil-lemma-cycle-classes}, and
\ref{weil-lemma-poincare-duality},
Weil Cohomology Theories, Remark \ref{weil-remark-trace},
Varieties, Lemmas
\ref{varieties-lemma-proper-geometrically-reduced-global-sections} and
\ref{varieties-lemma-ample-positive},
Intersection Theory, Section \ref{intersection-section-projection} and
Lemma \ref{intersection-lemma-projection-generically-finite},
More on Morphisms, Lemma \ref{more-morphisms-lemma-lci-permanence},
Algebra, Lemma \ref{algebra-lemma-CM-over-regular-flat}, and
Chow Homology, Lemma
\ref{chow-lemma-degrees-and-numerical-intersections}.
\end{proof}

\begin{remark}
\label{remark-hodge-cohomology-is-weil}
In exactly the same manner as above one can show that
Hodge cohomology $X \mapsto H_{Hodge}^*(X/k)$ equipped
with $c_1^{Hodge}$ determines a Weil
cohomology theory. If we ever need this, we will precisely
formulate and prove this here. This leads to the following
amusing consequence: If the betti numbers of a Weil cohomology
theory are independent of the chosen Weil cohomology theory
(over our field $k$ of characteristic $0$), then
the Hodge-to-de Rham spectral sequence
degenerates at $E_1$! Of course, the degeneration of
the Hodge-to-de Rham spectral sequence is known
(see for example \cite{Deligne-Illusie} for a marvelous algebraic proof),
but it is by no means an easy result! This suggests that proving
the independence of betti numbers is a hard problem as well
and as far as we know is still an open problem. See
Weil Cohomology Theories, Remark
\ref{weil-remark-betti-numbers-in-some-sense} for a related question.
\end{remark}







\section{Gysin maps for closed immersions}
\label{section-gysin}

\noindent
In this section we define the gysin map for closed immersions.

\begin{remark}
\label{remark-gysin-equations}
Let $X \to S$ be a morphism of schemes. Let
$f_1, \ldots, f_c \in \Gamma(X, \mathcal{O}_X)$. Let $Z \subset X$
be the closed subscheme cut out by $f_1, \ldots, f_c$. Below we will
study the {\it gysin map}
\begin{equation}
\label{equation-gysin}
\gamma^p_{f_1, \ldots, f_c} :
\Omega^p_{Z/S}
\longrightarrow
\mathcal{H}_Z^c(\Omega^{p + c}_{X/S})
\end{equation}
defined as follows. Given a local section $\omega$ of $\Omega^p_{Z/S}$
which is the restriction of a section $\tilde \omega$ of $\Omega^p_{X/S}$
we set
$$
\gamma^p_{f_1, \ldots, f_c}(\omega) =
c_{f_1, \ldots, f_c}(\tilde \omega|_Z) \wedge
\text{d}f_1 \wedge \ldots \wedge \text{d}f_c
$$
where $c_{f_1, \ldots, f_c} : \Omega^p_{X/S} \otimes \mathcal{O}_Z \to
\mathcal{H}_Z^c(\Omega^p_{X/S})$ is the map constructed in
Derived Categories of Schemes, Remark
\ref{perfect-remark-supported-map-c-equations}.
This is well defined: given $\omega$ we can change our choice of
$\tilde \omega$ by elements of the form
$\sum f_i \omega'_i + \sum \text{d}(f_i) \wedge \omega''_i$
which are mapped to zero by the construction.
\end{remark}

\begin{lemma}
\label{lemma-gysin-differential}
The gysin map (\ref{equation-gysin}) is compatible with the de Rham
differentials on $\Omega^\bullet_{X/S}$ and $\Omega^\bullet_{Z/S}$.
\end{lemma}

\begin{proof}
This follows from an almost trivial calculation once
we correctly interpret this. First, we recall that the functor
$\mathcal{H}^c_Z$ computed on the category of $\mathcal{O}_X$-modules
agrees with the similarly defined functor on the category of abelian
sheaves on $X$, see
Cohomology, Lemma \ref{cohomology-lemma-sections-support-abelian-unbounded}.
Hence, the differential $\text{d} : \Omega^p_{X/S} \to \Omega^{p + 1}_{X/S}$
induces a map
$\mathcal{H}^c_Z(\Omega^p_{X/S}) \to \mathcal{H}^c_Z(\Omega^{p + 1}_{X/S})$.
Moreover, the formation of the extended alternating {\v C}ech complex in
Derived Categories of Schemes, Remark \ref{perfect-remark-support-c-equations}
works on the category of abelian sheaves. The map
$$
\Coker\left(\bigoplus \mathcal{F}_{1 \ldots \hat i \ldots c} \to
\mathcal{F}_{1 \ldots c}\right)
\longrightarrow
i_*\mathcal{H}^c_Z(\mathcal{F})
$$
used in the construction of $c_{f_1, \ldots, f_c}$ in
Derived Categories of Schemes, Remark
\ref{perfect-remark-supported-map-c-equations}
is well defined and
functorial on the category of all abelian sheaves on $X$.
Hence we see that the lemma follows from the equality
$$
\text{d}\left(
\frac{\tilde \omega \wedge \text{d}f_1 \wedge \ldots \wedge
\text{d}f_c}{f_1 \ldots f_c}\right) =
\frac{\text{d}(\tilde \omega) \wedge
\text{d}f_1 \wedge \ldots \wedge \text{d}f_c}{f_1 \ldots f_c}
$$
which is clear.
\end{proof}

\begin{lemma}
\label{lemma-gysin-global}
Let $X \to S$ be a morphism of schemes. Let $Z \to X$ be a closed immersion
of finite presentation whose conormal sheaf $\mathcal{C}_{Z/X}$ is
locally free of rank $c$. Then there is a canonical map
$$
\gamma^p : \Omega^p_{Z/S} \to \mathcal{H}^c_Z(\Omega^{p + c}_{X/S})
$$
which is locally given by the maps $\gamma^p_{f_1, \ldots, f_c}$
of Remark \ref{remark-gysin-equations}.
\end{lemma}

\begin{proof}
The assumptions imply that given $x \in Z \subset X$ there exists an
open neighbourhood $U$ of $x$ such that $Z$ is cut out by $c$
elements $f_1, \ldots, f_c \in \mathcal{O}_X(U)$. Thus
it suffices to show that given $f_1, \ldots, f_c$ and
$g_1, \ldots, g_c$ in $\mathcal{O}_X(U)$ cutting out $Z \cap U$,
the maps $\gamma^p_{f_1, \ldots, f_c}$
and $\gamma^p_{g_1, \ldots, g_c}$ are the same. To do this, after shrinking
$U$ we may assume $g_j = \sum a_{ji} f_i$ for some
$a_{ji} \in \mathcal{O}_X(U)$. Then we have
$c_{f_1, \ldots, f_c} = \det(a_{ji}) c_{g_1, \ldots, g_c}$ by
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-supported-map-determinant}.
On the other hand we have
$$
\text{d}(g_1) \wedge \ldots \wedge \text{d}(g_c) \equiv
\det(a_{ji}) \text{d}(f_1) \wedge \ldots \wedge \text{d}(f_c)
\bmod (f_1, \ldots, f_c)\Omega^c_{X/S}
$$
Combining these relations, a straightforward calculation gives the
desired equality.
\end{proof}

\begin{lemma}
\label{lemma-gysin-differential-global}
Let $X \to S$ and $i : Z \to X$ be as in Lemma \ref{lemma-gysin-global}.
The gysin map $\gamma^p$ is compatible with the de Rham
differentials on $\Omega^\bullet_{X/S}$ and $\Omega^\bullet_{Z/S}$.
\end{lemma}

\begin{proof}
We may check this locally and then it follows from
Lemma \ref{lemma-gysin-differential}.
\end{proof}

\begin{lemma}
\label{lemma-gysin-projection}
Let $X \to S$ and $i : Z \to X$ be as in Lemma \ref{lemma-gysin-global}.
Given $\alpha \in H^q(X, \Omega^p_{X/S})$ we have
$\gamma^p(\alpha|_Z) = i^{-1}\alpha \wedge \gamma^0(1)$ in
$H^q(Z, \mathcal{H}^c_Z(\Omega^{p + c}_{X/S}))$.
Please see proof for notation.
\end{lemma}

\begin{proof}
The restriction $\alpha|_Z$ is the element of $H^q(Z, \Omega^p_{Z/S})$
given by functoriality for Hodge cohomology. Applying functoriality
for cohomology using
$\gamma^p : \Omega^p_{Z/S} \to \mathcal{H}^c_Z(\Omega^{p + c}_{X/S})$
we get get $\gamma^p(\alpha|_Z)$ in
$H^q(Z, \mathcal{H}^c_Z(\Omega^{p + c}_{X/S}))$.
This explains the left hand side of the formula.

\medskip\noindent
To explain the right hand side, we first pullback by the map
of ringed spaces $i : (Z, i^{-1}\mathcal{O}_X) \to (X, \mathcal{O}_X)$
to get the element $i^{-1}\alpha \in H^q(Z, i^{-1}\Omega^p_{X/S})$.
Let $\gamma^0(1) \in H^0(Z, \mathcal{H}_Z^c(\Omega^c_{X/S}))$
be the image of $1 \in H^0(Z, \mathcal{O}_Z) = H^0(Z, \Omega^0_{Z/S})$
by $\gamma^0$. Using cup product we obtain an element
$$
i^{-1}\alpha \cup \gamma^0(1)
\in
H^{q + c}(Z, 
i^{-1}\Omega^p_{X/S} \otimes_{i^{-1}\mathcal{O}_X}
\mathcal{H}^c_Z(\Omega^c_{X/S}))
$$
Using Cohomology, Remark \ref{cohomology-remark-support-cup-product}
and wedge product there are canonical maps
$$
i^{-1}\Omega^p_{X/S} \otimes_{i^{-1}\mathcal{O}_X}^\mathbf{L}
R\mathcal{H}_Z(\Omega^c_{X/S}) \to
R\mathcal{H}_Z(\Omega^p_{X/S} \otimes_{\mathcal{O}_X}^\mathbf{L}
\Omega^c_{X/S}) \to
R\mathcal{H}_Z(\Omega^{p + c}_{X/S})
$$
By Derived Categories of Schemes, Lemma
\ref{perfect-lemma-supported-trivial-vanishing}
the objects $R\mathcal{H}_Z(\Omega^j_{X/S})$ have vanishing
cohomology sheaves in degrees $> c$. Hence on cohomology
sheaves in degree $c$ we obtain a map
$$
i^{-1}\Omega^p_{X/S} \otimes_{i^{-1}\mathcal{O}_X}
\mathcal{H}^c_Z(\Omega^c_{X/S}) \longrightarrow
\mathcal{H}^c_Z(\Omega^{p + c}_{X/S})
$$
The expression $i^{-1}\alpha \wedge \gamma^0(1)$ is the image
of the cup product $i^{-1}\alpha \cup \gamma^0(1)$ by the
functoriality of cohomology.

\medskip\noindent
Having explained the content of the formula in this manner, by
general properties of cup products
(Cohomology, Section \ref{cohomology-section-cup-product}),
it now suffices to prove that the diagram
$$
\xymatrix{
i^{-1}\Omega^p_X \otimes \Omega^0_Z \ar[rr]_{\text{id} \otimes \gamma^0}
\ar[d] & &
i^{-1}\Omega^p_X \otimes \mathcal{H}^c_Z(\Omega^c_X) \ar[d]^\wedge \\
\Omega^p_Z \otimes \Omega^0_Z \ar[r]^\wedge &
\Omega^p_Z \ar[r]^{\gamma^p} &
\mathcal{H}^c_Z(\Omega^{p + c}_X)
}
$$
is commutative in the category of sheaves on $Z$ (with obvious abuse of
notation). This boils down to a simple computation for the maps
$\gamma^j_{f_1, \ldots, f_c}$ which we omit; in fact these maps
are chosen exactly such that this works and such that $1$ maps to
$\frac{\text{d}f_1 \wedge \ldots \wedge \text{d}f_c}{f_1 \ldots f_c}$.
\end{proof}

\begin{lemma}
\label{lemma-gysin-transverse}
Let $c \geq 0$ be a integer. Let
$$
\xymatrix{
Z' \ar[d]_h \ar[r] & X' \ar[d]_g \ar[r] & S' \ar[d] \\
Z \ar[r] & X \ar[r] & S
}
$$
be a commutative diagram of schemes.
Assume
\begin{enumerate}
\item $Z \to X$ and $Z' \to X'$
satisfy the assumptions of Lemma \ref{lemma-gysin-global},
\item the left square in the diagram is cartesian, and
\item $h^*\mathcal{C}_{Z/X} \to \mathcal{C}_{Z'/X'}$
(Morphisms, Lemma \ref{morphisms-lemma-conormal-functorial})
is an isomorphism.
\end{enumerate}
Then the diagram
$$
\xymatrix{
h^*\Omega^p_{Z/S} \ar[rr]_-{h^{-1}\gamma^p} \ar[d] & &
\mathcal{O}_{X'}|_{Z'} \otimes_{h^{-1}\mathcal{O}_X|_Z}
h^{-1}\mathcal{H}^c_Z(\Omega^{p + c}_{X/S}) \ar[d] \\
\Omega^p_{Z'/S'} \ar[rr]^{\gamma^p} & &
\mathcal{H}^c_{Z'}(\Omega^{p + c}_{X'/S'})
}
$$
is commutative. The left vertical arrow is functoriality of modules of
differentials and the right vertical arrow uses
Cohomology, Remark \ref{cohomology-remark-support-functorial}.
\end{lemma}

\begin{proof}
More precisely, consider the composition
\begin{align*}
\mathcal{O}_{X'}|_{Z'} \otimes_{h^{-1}\mathcal{O}_X|_Z}^\mathbf{L}
h^{-1}R\mathcal{H}_Z(\Omega^{p + c}_{X/S})
& \to
R\mathcal{H}_{Z'}(Lg^*\Omega^{p + c}_{X/S}) \\
& \to
R\mathcal{H}_{Z'}(g^*\Omega^{p + c}_{X/S}) \\
& \to
R\mathcal{H}_{Z'}(\Omega^{p + c}_{X'/S'})
\end{align*}
where the first arrow is given by
Cohomology, Remark \ref{cohomology-remark-support-functorial}
and the last one by functoriality of differentials.
Since we have the vanishing of cohomology sheaves in degrees $> c$
by Derived Categories of Schemes, Lemma
\ref{perfect-lemma-supported-trivial-vanishing}
this induces the right vertical arrow.
We can check the commutativity locally.
Thus we may assume $Z$ is cut out by
$f_1, \ldots, f_c \in \Gamma(X, \mathcal{O}_X)$.
Then $Z'$ is cut out by $f'_i = g^\sharp(f_i)$.
The maps $c_{f_1, \ldots, f_c}$ and $c_{f'_1, \ldots, f'_c}$
fit into the commutative diagram
$$
\xymatrix{
h^*i^*\Omega^p_{X/S} \ar[rr]_-{h^{-1}c_{f_1, \ldots, f_c}} \ar[d] & &
\mathcal{O}_{X'}|_{Z'} \otimes_{h^{-1}\mathcal{O}_X|_Z}
h^{-1}\mathcal{H}^c_Z(\Omega^p_{X/S}) \ar[d] \\
(i')^*\Omega^p_{X'/S'} \ar[rr]^{c_{f'_1, \ldots, f'_c}} & &
\mathcal{H}^c_{Z'}(\Omega^p_{X'/S'})
}
$$
See Derived Categories of Schemes, Remark
\ref{perfect-remark-supported-functorial}.
Recall given a $p$-form $\omega$ on $Z$ we define
$\gamma^p(\omega)$ by choosing (locally on $X$ and $Z$)
a $p$-form $\tilde \omega$ on $X$ lifting $\omega$ and taking
$\gamma^p(\omega) =
c_{f_1, \ldots, f_c}(\tilde \omega) \wedge
\text{d}f_1 \wedge \ldots \wedge \text{d}f_c$.
Since the form $\text{d}f_1 \wedge \ldots \wedge \text{d}f_c$
pulls back to
$\text{d}f'_1 \wedge \ldots \wedge \text{d}f'_c$ we conclude.
\end{proof}

\begin{remark}
\label{remark-how-to-use}
Let $X \to S$, $i : Z \to X$, and $c \geq 0$ be as in
Lemma \ref{lemma-gysin-global}.
Let $p \geq 0$ and assume that $\mathcal{H}^i_Z(\Omega^{p + c}_{X/S}) = 0$
for $i = 0, \ldots, c - 1$. This vanishing holds if $X \to S$ is smooth
and $Z \to X$ is a Koszul regular immersion, see
Derived Categories of Schemes, Lemma \ref{perfect-lemma-supported-vanishing}.
Then we obtain a map
$$
\gamma^{p, q} :
H^q(Z, \Omega^p_{Z/S})
\longrightarrow
H^{q + c}(X, \Omega^{p + c}_{X/S})
$$
by first using
$\gamma^p : \Omega^p_{Z/S} \to \mathcal{H}^c_Z(\Omega^{p + c}_{X/S})$
to map into
$$
H^q(Z, \mathcal{H}^c_Z(\Omega^{p + c}_{X/S})) =
H^q(Z, R\mathcal{H}_Z(\Omega^{p + c}_{X/S})[c]) =
H^q(X, i_*R\mathcal{H}_Z(\Omega^{p + c}_{X/S})[c])
$$
and then using the adjunction map
$i_*R\mathcal{H}_Z(\Omega^{p + c}_{X/S}) \to \Omega^{p + c}_{X/S}$
to continue on to the desired Hodge cohomology module.
\end{remark}

\begin{lemma}
\label{lemma-gysin-differential-hodge}
Let $X \to S$ and $i : Z \to X$ be as in Lemma \ref{lemma-gysin-global}.
Assume $X \to S$ is smooth and $Z \to X$ Koszul regular.
The gysin maps $\gamma^{p, q}$ are compatible with the de Rham
differentials on $\Omega^\bullet_{X/S}$ and $\Omega^\bullet_{Z/S}$.
\end{lemma}

\begin{proof}
This follows immediately from
Lemma \ref{lemma-gysin-differential-global}.
\end{proof}

\begin{lemma}
\label{lemma-gysin-projection-global}
Let $X \to S$, $i : Z \to X$, and $c \geq 0$ be as in
Lemma \ref{lemma-gysin-global}. Assume $X \to S$ smooth and
$Z \to X$ Koszul regular. Given $\alpha \in H^q(X, \Omega^p_{X/S})$ we have
$\gamma^{p, q}(\alpha|_Z) = \alpha \cup \gamma^{0, 0}(1)$ in
$H^{q + c}(X, \Omega^{p + c}_{X/S})$ with $\gamma^{a, b}$ as in
Remark \ref{remark-how-to-use}.
\end{lemma}

\begin{proof}
This lemma follows from Lemma \ref{lemma-gysin-projection}
and Cohomology, Lemma \ref{cohomology-lemma-support-cup-product}.
We suggest the reader skip over the more detailed discussion below.

\medskip\noindent
We will use without further mention that
$R\mathcal{H}_Z(\Omega^j_{X/S}) = \mathcal{H}^c_Z(\Omega^j_{X/S})[-c]$
for all $j$ as pointed out in Remark \ref{remark-how-to-use}.
We will also silently use the identifications
$H^{q + c}_Z(X, \Omega^j_{X/S}) = H^{q + c}(Z, R\mathcal{H}_Z(\Omega^j_{X/S}) =
H^q(Z, \mathcal{H}^c_Z(\Omega^j_{X/S}))$, see
Cohomology, Lemma \ref{cohomology-lemma-local-to-global-sections-with-support}
for the first one. With these identifications
\begin{enumerate}
\item $\gamma^0(1) \in H^c_Z(X, \Omega^c_{X/S})$ maps to $\gamma^{0, 0}(1)$
in $H^c(X, \Omega^c_{X/S})$,
\item the right hand side $i^{-1}\alpha \wedge \gamma^0(1)$
of the equality in Lemma \ref{lemma-gysin-projection}
is the (image by wedge product of the) cup product of
Cohomology, Remark \ref{cohomology-remark-support-cup-product-global} 
of the elements $\alpha$ and $\gamma^0(1)$, in other words, the constructions
in the proof of Lemma \ref{lemma-gysin-projection} and in
Cohomology, Remark \ref{cohomology-remark-support-cup-product-global} match,
\item by Cohomology, Lemma \ref{cohomology-lemma-support-cup-product}
this maps to $\alpha \cup \gamma^{0, 0}(1)$ in
$H^{q + c}(X, \Omega^p_{X/S} \otimes \Omega^c_{X/S})$, and
\item the left hand side $\gamma^p(\alpha|_Z)$ of the equality in
Lemma \ref{lemma-gysin-projection} maps to
$\gamma^{p, q}(\alpha|_Z)$.
\end{enumerate}
This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-gysin-transverse-global}
Let $c \geq 0$ and
$$
\xymatrix{
Z' \ar[d]_h \ar[r] & X' \ar[d]_g \ar[r] & S' \ar[d] \\
Z \ar[r] & X \ar[r] & S
}
$$
satisfy the assumptions of Lemma \ref{lemma-gysin-transverse} and assume
in addition that $X \to S$ and $X' \to S'$ are smooth and that
$Z \to X$ and $Z' \to X'$ are Koszul regular immersions.
Then the diagram
$$
\xymatrix{
H^q(Z, \Omega^p_{Z/S}) \ar[rr]_-{\gamma^{p, q}} \ar[d] & &
H^{q + c}(X, \Omega^{p + c}_{X/S}) \ar[d] \\
H^q(Z', \Omega^p_{Z'/S'}) \ar[rr]^{\gamma^{p, q}} & &
H^{q + c}(X', \Omega^{p + c}_{X'/S'})
}
$$
is commutative where $\gamma^{p, q}$ is as in Remark \ref{remark-how-to-use}.
\end{lemma}

\begin{proof}
This follows on combining Lemma \ref{lemma-gysin-transverse}
and Cohomology, Lemma \ref{cohomology-lemma-support-functorial}.
\end{proof}

\begin{lemma}
\label{lemma-class-of-a-point}
Let $k$ be a field. Let $X$ be an irreducible smooth proper scheme over $k$
of dimension $d$. Let $Z \subset X$ be the reduced closed subscheme consisting
of a single $k$-rational point $x$. Then the image of
$1 \in k = H^0(Z, \mathcal{O}_Z) = H^0(Z, \Omega^0_{Z/k})$
by the map $H^0(Z, \Omega^0_{Z/k}) \to H^d(X, \Omega^d_{X/k})$
of Remark \ref{remark-how-to-use} is nonzero.
\end{lemma}

\begin{proof}
The map $\gamma^0 : \mathcal{O}_Z \to
\mathcal{H}^d_Z(\Omega^d_{X/k}) = R\mathcal{H}_Z(\Omega^d_{X/k})[d]$
is adjoint to a map
$$
g^0 : i_*\mathcal{O}_Z \longrightarrow \Omega^d_{X/k}[d]
$$
in $D(\mathcal{O}_X)$. Recall that $\Omega^d_{X/k} = \omega_X$ is a
dualizing sheaf for $X/k$, see
Duality for Schemes, Lemma \ref{duality-lemma-duality-proper-over-field}.
Hence the $k$-linear dual of the map in the statement
of the lemma is the map
$$
H^0(X, \mathcal{O}_X) \to \Ext^d_X(i_*\mathcal{O}_Z, \omega_X)
$$
which sends $1$ to $g^0$. Thus it suffices to show that $g^0$ is nonzero.
This we may do in any neighbourhood $U$ of the point $x$. Choose $U$
such that there exist $f_1, \ldots, f_d \in \mathcal{O}_X(U)$
vanishing only at $x$ and generating the maximal ideal
$\mathfrak m_x \subset \mathcal{O}_{X, x}$. We may assume
assume $U = \Spec(R)$ is affine. Looking over the
construction of $\gamma^0$ we find that our extension is given by
$$
k \to
(R \to \bigoplus\nolimits_{i_0} R_{f_{i_0}} \to
\bigoplus\nolimits_{i_0 < i_1} R_{f_{i_0}f_{i_1}} \to
\ldots \to R_{f_1\ldots f_r})[d] \to R[d]
$$
where $1$ maps to $1/f_1 \ldots f_c$ under the first map.
This is nonzero because $1/f_1 \ldots f_c$ is a nonzero element
of local cohomology group $H^d_{(f_1, \ldots, f_d)}(R)$ in this case,
\end{proof}






\section{Relative Poincar\'e duality}
\label{section-relative-poincare-duality}

\noindent
In this section we prove Poincar'e duality for the relative de Rham cohomology
of a proper smooth scheme over a base. We strongly urge the reader to
look at Section \ref{section-poincare-duality} first.

\begin{situation}
\label{situation-relative-duality}
Here $S$ is a quasi-compact and quasi-separated scheme and
$f : X \to S$ is a proper smooth morphism of schemes all of whose
fibres are nonempty and equidimensional of dimension $n$.
\end{situation}

\begin{lemma}
\label{lemma-relative-bottom-part-degenerates}
In Situation \ref{situation-relative-duality} the pushforward
$f_*\mathcal{O}_X$ is a finite \'etale $\mathcal{O}_S$-algebra
and locally on $S$ we have $Rf_*\mathcal{O}_X = f_*\mathcal{O}_X \oplus P$
in $D(\mathcal{O}_S)$ with $P$ perfect of tor amplitude in $[1, \infty)$.
The map $\text{d} : f_*\mathcal{O}_X \to f_*\Omega_{X/S}$ is zero.
\end{lemma}

\begin{proof}
The first part of the statement follows from
Derived Categories of Schemes, Lemma \ref{perfect-lemma-proper-flat-geom-red}.
Setting $S' = \underline{\Spec}_S(f_*\mathcal{O}_X)$ we get a factorization
$X \to S' \to S$ (this is the Stein factorization, see
More on Morphisms, Section \ref{more-morphisms-section-stein-factorization},
although we don't need this)
and we see that $\Omega_{X/S} = \Omega_{X/S'}$ for example by
Morphisms, Lemma \ref{morphisms-lemma-triangle-differentials} and
\ref{morphisms-lemma-etale-at-point}. This of course implies that
$\text{d} : f_*\mathcal{O}_X \to f_*\Omega_{X/S}$ is zero.
\end{proof}

\begin{lemma}
\label{lemma-relative-duality-hodge}
In Situation \ref{situation-relative-duality} there exists an
$\mathcal{O}_S$-module map
$$
t : Rf_*\Omega^n_{X/S}[n] \longrightarrow \mathcal{O}_S
$$
unique up to precomposing by multiplication by a unit of
$H^0(X, \mathcal{O}_X)$ with the following property: for all $p$ the pairing
$$
Rf_*\Omega^p_{X/S}
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rf_*\Omega^{n - p}_{X/S}[n]
\longrightarrow
\mathcal{O}_S
$$
given by the relative cup product composed with $t$
is a perfect pairing of perfect complexes on $S$.
\end{lemma}

\begin{proof}
Let $\omega^\bullet_{X/S}$ be the relative dualizing complex of $X$ over $S$ as
in Duality for Schemes, Remark \ref{duality-remark-relative-dualizing-complex}
and let $Rf_*\omega_{X/S}^\bullet \to \mathcal{O}_S$ be its trace map. By
Duality for Schemes, Lemma \ref{duality-lemma-smooth-proper}
there exists an isomorphism $\omega^\bullet_{X/S} \cong \Omega^n_{X/S}[n]$
and using this isomorphism we obtain $t$. The complexes $Rf_*\Omega^p_{X/S}$
are perfect by Lemma \ref{lemma-proper-smooth-de-Rham}.
Since $\Omega^p_{X/S}$ is locally free and since
$\Omega^p_{X/S} \otimes_{\mathcal{O}_X} \Omega^{n - p}_{X/S} \to
\Omega^n_{X/S}$ exhibits an isomorphism $\Omega^p_{X/S} \cong
\SheafHom_{\mathcal{O}_X}(\Omega^{n - p}_{X/S}, \Omega^n_{X/S})$
we see that the pairing induced by the relative cup product is perfect by
Duality for Schemes, Remark
\ref{duality-remark-relative-dualizing-complex-relative-cup-product}.

\medskip\noindent
Uniqueness of $t$. Choose a distinguished triangle
$f_*\mathcal{O}_X \to Rf_*\mathcal{O}_X \to P \to f_*\mathcal{O}_X[1]$.
By Lemma \ref{lemma-relative-bottom-part-degenerates}
the object $P$ is perfect of tor amplitude in $[1, \infty)$
and the triangle is locally on $S$ split.
Thus $R\SheafHom_{\mathcal{O}_X}(P, \mathcal{O}_X)$ is perfect
of tor amplitude in $(-\infty, -1]$. Hence duality (above) shows that
locally on $S$ we have
$$
Rf_*\Omega^n_{X/S}[n] \cong
R\SheafHom_{\mathcal{O}_S}(f_*\mathcal{O}_X, \mathcal{O}_S)
\oplus R\SheafHom_{\mathcal{O}_X}(P, \mathcal{O}_X)
$$
This shows that $R^nf_*\Omega^n_{X/S}$ is finite locally free and
that we obtain a perfect $\mathcal{O}_S$-bilinear pairing
$$
f_*\mathcal{O}_X \times R^nf_*\Omega^n_{X/S} \longrightarrow \mathcal{O}_S
$$
using $t$.
This implies that any $\mathcal{O}_S$-linear map
$t' : R^nf_*\Omega^n_{X/S} \to \mathcal{O}_S$ is of the form
$t' = t \circ g$ for some
$g \in \Gamma(S, f_*\mathcal{O}_X) = \Gamma(X, \mathcal{O}_X)$.
In order for $t'$ to still determine a perfect pairing $g$ will have
to be a unit. This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-relative-top-part-degenerates}
In Situation \ref{situation-relative-duality} the map
$\text{d} : R^nf_*\Omega^{n - 1}_{X/S} \to R^nf_*\Omega^n_{X/S}$
is zero.
\end{lemma}

\noindent
As we mentioned in the proof of Lemma \ref{lemma-top-part-degenerates}
this lemma is not an easy consequence of Lemmas
\ref{lemma-relative-duality-hodge} and
\ref{lemma-relative-bottom-part-degenerates}.

\begin{proof}[Proof in case $S$ is reduced]
Assume $S$ is reduced. Observe that
$\text{d} : R^nf_*\Omega^{n - 1}_{X/S} \to R^nf_*\Omega^n_{X/S}$
is an $\mathcal{O}_S$-linear map of (quasi-coherent) $\mathcal{O}_S$-modules.
The $\mathcal{O}_S$-module $R^nf_*\Omega^n_{X/S}$ is finite locally free
(as the dual of the finite locally free $\mathcal{O}_S$-module
$f_*\mathcal{O}_X$ by Lemmas
\ref{lemma-relative-duality-hodge} and
\ref{lemma-relative-bottom-part-degenerates}).
Since $S$ is reduced it suffices to show that
the stalk of $\text{d}$ in every generic point $\eta \in S$
is zero; this follows by looking at sections over affine opens,
using that the target of $\text{d}$ is locally free, and
Algebra, Lemma \ref{algebra-lemma-reduced-ring-sub-product-fields} part (2).
Since $S$ is reduced we have $\mathcal{O}_{S, \eta} = \kappa(\eta)$, see
Algebra, Lemma \ref{algebra-lemma-minimal-prime-reduced-ring}.
Thus $\text{d}_\eta$ is identified with the map
$$
\text{d} :
H^n(X_\eta, \Omega^{n - 1}_{X_\eta/\kappa(\eta)})
\longrightarrow
H^n(X_\eta, \Omega^n_{X_\eta/\kappa(\eta)})
$$
which is zero by Lemma \ref{lemma-top-part-degenerates}.
\end{proof}

\begin{proof}[Proof in the general case]
Observe that the question is flat local on $S$: if $S' \to S$ is a surjective
flat morphism of schemes and the map is zero after pullback to $S'$,
then the map is zero. Also, formation of the map commutes with base change
by flat morphisms by flat base change (Cohomology of Schemes, Lemma
\ref{coherent-lemma-flat-base-change-cohomology}).

\medskip\noindent
Consider the Stein factorization $X \to S' \to S$ as in
More on Morphisms, Theorem
\ref{more-morphisms-theorem-stein-factorization-general}.
By Lemma \ref{lemma-relative-bottom-part-degenerates} the morphism
$\pi : S' \to S$ is finite \'etale.
The morphism $f : X \to S'$ is proper (by the theorem),
smooth (by More on Morphisms, Lemma
\ref{more-morphisms-lemma-smooth-etale-permanence}) with geometrically
connected fibres by the theorem on Stein factorization.
In the proof of Lemma \ref{lemma-relative-bottom-part-degenerates}
we saw that $\Omega_{X/S} = \Omega_{X/S'}$ because $S' \to S$ is \'etale.
Hence $\Omega^\bullet_{X/S} = \Omega^\bullet_{X/S'}$.
We have
$$
R^qf_*\Omega^p_{X/S} = \pi_*R^qf'_*\Omega^p_{X/S'}
$$
for all $p, q$ by the Leray spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-relative-Leray}),
the fact that $\pi$ is finite hence affine, and
Cohomology of Schemes, Lemma \ref{coherent-lemma-relative-affine-vanishing}
(of course we also use that $R^qf'_*\Omega^p_{X'/S}$ is
quasi-coherent).
Thus the map of the lemma is $\pi_*$ applied to
$\text{d} : R^nf'_*\Omega^{n - 1}_{X/S'} \to R^nf'_*\Omega^n_{X/S'}$.
In other words, in order to prove the lemma we may replace
$f : X \to S$ by $f' : X \to S'$ to reduce to the case discussed
in the next pargraph.

\medskip\noindent
Assume $f$ has geometrically connected fibres and
$f_*\mathcal{O}_X = \mathcal{O}_S$.
For every $s \in S$ we can choose an \'etale neighbourhood
$(S', s') \to (S, s)$ such that the base change $X' \to S'$ of $S$
has a section. See More on Morphisms, Lemma
\ref{more-morphisms-lemma-etale-nbhd-dominates-smooth}.
By the initial remarks of the proof this reduces us to the case
discussed in the next paragraph.

\medskip\noindent
Assume $f$ has geometrically connected fibres,
$f_*\mathcal{O}_X = \mathcal{O}_S$, and we have
a section $s : S \to X$ of $f$. We may and do assume $S = \Spec(A)$
is affine. The map
$s^* : R\Gamma(X, \mathcal{O}_X) \to R\Gamma(S, \mathcal{O}_S) = A$
is a splitting of the map $A \to R\Gamma(X, \mathcal{O}_X)$. Thus we can write
$$
R\Gamma(X, \mathcal{O}_X) = A \oplus P
$$
where $P$ is the ``kernel'' of $s^*$. By
Lemma \ref{lemma-relative-bottom-part-degenerates} the object $P$
of $D(A)$ is perfect of tor amplitude in $[1, n]$. As in the proof
of Lemma \ref{lemma-relative-duality-hodge} we see that
$H^n(X, \Omega^n_{X/S})$ is a locally free $A$-module of rank $1$
(and in fact dual to $A$ so free of rank $1$ -- we will soon choose
a generator but we don't want to check it is the same generator
nor will it be necessary to do so).

\medskip\noindent
Denote $Z \subset X$ the image of $s$ which is a closed subscheme of $X$ by
Schemes, Lemma \ref{schemes-lemma-section-immersion}.
Observe that $Z \to X$ is a regular (and a fortiori Koszul regular by
Divisors, Lemma \ref{divisors-lemma-regular-quasi-regular-immersion})
closed immersion by
Divisors, Lemma \ref{divisors-lemma-section-smooth-regular-immersion}.
Of course $Z \to X$ has codimension $n$. Thus by
Remark \ref{remark-how-to-use}
we can consider the map
$$
\gamma^{0, 0} : H^0(Z, \Omega^0_{Z/S}) \longrightarrow H^n(X, \Omega^n_{X/S})
$$
and we set $\xi = \gamma^{0, 0}(1) \in H^n(X, \Omega^n_{X/S})$.

\medskip\noindent
We claim $\xi$ is a basis element. Namely, since we have base change in
top degree (see for example Limits, Lemma
\ref{limits-lemma-higher-direct-images-zero-above-dimension-fibre})
we see that
$H^n(X, \Omega^n_{X/S}) \otimes_A k = H^n(X_k, \Omega^n_{X_k/k})$
for any ring map $A \to k$. By the compatibility of
the construction of $\xi$ with base change,
see Lemma \ref{lemma-gysin-transverse-global},
we see that the image of $\xi$ in $H^n(X_k, \Omega^n_{X_k/k})$
is nonzero by Lemma \ref{lemma-class-of-a-point} if $k$ is a field.
Thus $\xi$ is a nowhere vanishing section of an invertible module
and hence a generator.

\medskip\noindent
Let $\theta \in H^n(X, \Omega^{n - 1}_{X/S})$. We have to show that
$\text{d}(\theta)$ is zero in $H^n(X, \Omega^n_{X/S})$.
We may write $\text{d}(\theta) = a \xi$ for some $a \in A$
as $\xi$ is a basis element. Then we have to show $a = 0$.

\medskip\noindent
Consider the closed immersion
$$
\Delta : X \to X \times_S X
$$
This is also a section of a smooth morphism (namely either projection)
and hence a regular and Koszul immersion of codimension $n$ as well.
Thus we can consider the maps
$$
\gamma^{p, q} :
H^q(X, \Omega^p_{X/S})
\longrightarrow
H^{q + n}(X \times_S X, \Omega^{p + n}_{X \times_S X/S})
$$
of Remark \ref{remark-how-to-use}. Consider the image
$$
\gamma^{n - 1, n}(\theta) \in
H^{2n}(X \times_S X, \Omega^{2n - 1}_{X \times_S X})
$$
By Lemma \ref{lemma-de-rham-complex-product} we have
$$
\Omega^{2n - 1}_{X \times_S X} =
\Omega^{n - 1}_{X/S} \boxtimes \Omega^n_{X/S} \oplus
\Omega^n_{X/S} \boxtimes \Omega^{n - 1}_{X/S}
$$
By the K\"unneth formula (either
Derived Categories of Schemes, Lemma \ref{perfect-lemma-kunneth} or
Derived Categories of Schemes, Lemma \ref{perfect-lemma-kunneth-single-sheaf})
we see that
$$
H^{2n}(X \times_S X, \Omega^{n - 1}_{X/S} \boxtimes \Omega^n_{X/S}) =
H^n(X, \Omega^{n - 1}_{X/S}) \otimes_A H^n(X, \Omega^n_{X/S})
$$
and
$$
H^{2n}(X \times_S X, \Omega^n_{X/S} \boxtimes \Omega^{n - 1}_{X/S}) =
H^n(X, \Omega^n_{X/S}) \otimes_A H^n(X, \Omega^{n - 1}_{X/S})
$$
Namely, since we are looking in top degree there no higher tor groups
that intervene. Combined with the fact that $\xi$ is a generator this means
we can write
$$
\gamma^{n - 1, n}(\theta) = \theta_1 \otimes \xi + \xi \otimes \theta_2
$$
with $\theta_1, \theta_2 \in H^n(X, \Omega^{n - 1}_{X/S})$.
Arguing in exactly the same manner we can write
$$
\gamma^{n, n}(\xi) = b \xi \otimes \xi
$$
in
$H^{2n}(X \times_S X, \Omega^{2n}_{X \times_S X/S}) =
H^n(X, \Omega^n_{X/S}) \otimes_A H^n(X, \Omega^n_{X/S})$
for some $b \in H^0(S, \mathcal{O}_S)$.

\medskip\noindent
{\bf Claim:} $\theta_1 = \theta$, $\theta_2 = \theta$, and $b = 1$.
Let us show that the claim implies the desired result $a = 0$.
Namely, by Lemma \ref{lemma-gysin-differential-hodge}
we have
$$
\gamma^{n, n}(\text{d}(\theta)) = \text{d}(\gamma^{n - 1, n}(\theta))
$$
By our choices above this gives
$$
a \xi \otimes \xi =
\gamma^{n, n}(a\xi) =
\text{d}(\theta \otimes \xi + \xi \otimes \theta) =
a \xi \otimes \xi + (-1)^n a \xi \otimes \xi
$$
The right most equality comes from the fact that the map
$\text{d} : \Omega^{2n - 1}_{X \otimes_S X/S} \to \Omega^{2n}_{X \times_S X/S}$
by Lemma \ref{lemma-de-rham-complex-product}
is the sum of the differential
$\text{d} \boxtimes 1 : \Omega^{n - 1}_{X/S} \boxtimes \Omega^n_{X/S}
\to \Omega^n_{X/S} \boxtimes \Omega^n_{X/S}$
and the differential
$(-1)^n 1 \boxtimes \text{d} : \Omega^n_{X/S} \boxtimes \Omega^{n - 1}_{X/S}
\to \Omega^n_{X/S} \boxtimes \Omega^n_{X/S}$. Please see discussion in
Section \ref{section-kunneth} and
Derived Categories of Schemes, Section
\ref{perfect-section-kunneth-complexes} for more information.
Since $\xi \otimes \xi$ is a basis for the rank $1$ free $A$-module
$H^n(X, \Omega^n_{X/S}) \otimes_A H^n(X, \Omega^n_{X/S})$
we conclude
$$
a = a + (-1)^n a \Rightarrow a = 0
$$
as desired.

\medskip\noindent
In the rest of the proof we prove the claim above. Let us denote
$\eta = \gamma^{0, 0}(1) \in H^n(X \times_S X, \Omega^n_{X \times_S X/S})$.
Since $\Omega^n_{X \times_S X/S} =
\bigoplus_{p + p' = n} \Omega^p_{X/S} \boxtimes \Omega^{p'}_{X/S}$
we may write
$$
\eta = \eta_0 + \eta_1 + \ldots + \eta_n
$$
where $\eta_p$ is in
$H^n(X \times_S X, \Omega^p_{X/S} \boxtimes \Omega^{n - p}_{X/S})$.
For $p = 0$ we can write
\begin{align*}
H^n(X \times_S X, \mathcal{O}_X \boxtimes \Omega^n_{X/S})
& =
H^n(R\Gamma(X, \mathcal{O}_X) \otimes_A^\mathbf{L}
R\Gamma(X, \Omega^n_{X/S})) \\
& =
A \otimes_A H^n(X, \Omega^n_{X/S}) \oplus
H^n(P \otimes_A^\mathbf{L} R\Gamma(X, \Omega^n_{X/S}))
\end{align*}
by our previously given decomposition $R\Gamma(X, \mathcal{O}_X) = A \oplus P$.
Consider the morphism $(s, \text{id}) : X \to X \times_S X$.
Then $(s, \text{id})^{-1}(\Delta) = Z$ scheme theoretically.
Hence we see that $(s, \text{id})^*\eta = \xi$ by
Lemma \ref{lemma-gysin-transverse-global}. This means that
$$
\xi = (s, \text{id})^*\eta = (s^* \otimes \text{id})(\eta_0)
$$
This means exactly that the first component of $\eta_0$
in the direct sum decomposition above is $\xi$. In other words, we can write
$$
\eta_0 = 1 \otimes \xi + \eta'_0
$$
with $\eta'_0 \in H^n(P \otimes_A^\mathbf{L} R\Gamma(X, \Omega^n_{X/S}))$.
In exactly the same manner for $p = n$ we can write
\begin{align*}
H^n(X \times_S X, \Omega^n_{X/S} \boxtimes \mathcal{O}_X)
& =
H^n(R\Gamma(X, \Omega^n_{X/S}) \otimes_A^\mathbf{L}
R\Gamma(X, \mathcal{O}_X)) \\
& =
H^n(X, \Omega^n_{X/S}) \otimes_A A \oplus
H^n(R\Gamma(X, \Omega^n_{X/S}) \otimes_A^\mathbf{L} P)
\end{align*}
and we can write
$$
\eta_n = \xi \otimes 1 + \eta'_n
$$
with $\eta'_n \in H^n(R\Gamma(X, \Omega^n_{X/S}) \otimes_A^\mathbf{L} P)$.

\medskip\noindent
Observe that $\text{pr}_1^*\theta = \theta \otimes 1$
and $\text{pr}_2^*\theta = 1 \otimes \theta$ are
Hodge cohomology classes on
$X \times_S X$ which pull back to $\theta$ by $\Delta$.
Hence by Lemma \ref{lemma-gysin-projection-global} we have
$$
\theta_1 \otimes \xi + \xi \otimes \theta_2 =
\gamma^{n - 1, n}(\theta) =
(\theta \otimes 1) \cup \eta =
(1 \otimes \theta) \cup \eta
$$
in the Hodge cohomology ring of $X \times_S X$ over $S$.
In terms of the direct sum decomposition on the modules
of differentials of $X \times_S X/S$ we obtain
$$
\theta_1 \otimes \xi =
(\theta \otimes 1) \cup \eta_0
\quad\text{and}\quad
\xi \otimes \theta_2 =
(1 \otimes \theta) \cup \eta_n
$$
Looking at the formula $\eta_0 = 1 \otimes \xi + \eta'_0$ we found above,
we see that to show that $\theta_1 = \theta$ it suffices to prove that
$$
(\theta \otimes 1) \cup \eta'_0 = 0
$$
To do this, observe that cupping with $\theta \otimes 1$ is given
by the action on cohomology of the map
$$
(P \otimes_A^\mathbf{L} R\Gamma(X, \Omega^n_{X/S}))[-n]
\xrightarrow{\theta \otimes 1}
R\Gamma(X, \Omega^{n - 1}_{X/S}) \otimes_A^\mathbf{L}
R\Gamma(X, \Omega^n_{X/S})
$$
in the derived category, see Cohomology, Remark
\ref{cohomology-remark-cup-with-element-map-total-cohomology}.
This map is the derived tensor product of the two maps
$$
\theta : P[-n] \to R\Gamma(X, \Omega^{n - 1}_{X/S})
\quad\text{and}\quad
1 : R\Gamma(X, \Omega^n_{X/S}) \to R\Gamma(X, \Omega^n_{X/S})
$$
by Derived Categories of Schemes, Remark
\ref{perfect-remark-annoying-compatibility}.
However, the first of these is zero in $D(A)$ because it is a map from
a perfect complex of tor amplitude in $[n + 1, 2n]$ to a complex
with cohomology only in degrees $0, 1, \ldots, n$, see
More on Algebra, Lemma \ref{more-algebra-lemma-splitting-unique}.
A similar argument works to show the vanishing of
$(1 \otimes \theta) \cup \eta'_n$. Finally, 
in exactly the same manner we obtain
$$
b \xi \otimes \xi = \gamma^{n, n}(\xi) = (\xi \otimes 1) \cup \eta_0
$$
and we conclude as before by showing that
$(\xi \otimes 1) \cup \eta'_0 = 0$ in the same manner as above.
This finishes the proof.
\end{proof}

\begin{proposition}
\label{proposition-relative-poincare-duality}
Let $S$ be a quasi-compact and quasi-separated scheme. Let $f : X \to S$
be a proper smooth morphism of schemes all of whose fibres are nonempty
and equidimensional of dimension $n$. There exists an
$\mathcal{O}_S$-module map
$$
t : R^{2n}f_*\Omega^\bullet_{X/S} \longrightarrow \mathcal{O}_S
$$
unique up to precomposing by multiplication by a unit of
$H^0(X, \mathcal{O}_X)$ with the following property: the pairing
$$
Rf_*\Omega^\bullet_{X/S}
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rf_*\Omega^\bullet_{X/S}[2n]
\longrightarrow
\mathcal{O}_S, \quad
(\xi, \xi') \longmapsto t(\xi \cup \xi')
$$
is a perfect pairing of perfect complexes on $S$.
\end{proposition}

\begin{proof}
The proof is exactly the same as the proof of
Proposition \ref{proposition-poincare-duality}.

\medskip\noindent
By the relative Hodge-to-de Rham spectral sequence
$$
E_1^{p, q} = R^qf_*\Omega^p_{X/S} \Rightarrow R^{p + q}f_*\Omega^\bullet_{X/S}
$$
(Section \ref{section-hodge-to-de-rham}), the vanishing
of $\Omega^i_{X/S}$ for $i > n$, the vanishing in for example Limits, Lemma
\ref{limits-lemma-higher-direct-images-zero-above-dimension-fibre}
and the results of Lemmas \ref{lemma-relative-bottom-part-degenerates} and
\ref{lemma-relative-top-part-degenerates}
we see that $R^0f_*\Omega_{X/S} = R^0f_*\mathcal{O}_X$
and $R^nf_*\Omega^n_{X/S} = R^{2n}f_*\Omega^\bullet_{X/S}$.
More precisely, these identifications come from the maps
of complexes
$$
\Omega^\bullet_{X/S} \to \mathcal{O}_X[0]
\quad\text{and}\quad
\Omega^n_{X/S}[-n] \to \Omega^\bullet_{X/S}
$$
Let us choose $t : R^{2n}f_*\Omega_{X/S} \to \mathcal{O}_S$
which via this identification corresponds to a $t$ as in
Lemma \ref{lemma-relative-duality-hodge}.

\medskip\noindent
Let us abbreviate $\Omega^\bullet = \Omega^\bullet_{X/S}$.
Consider the map (\ref{equation-wedge}) which in our situation reads
$$
\wedge :
\text{Tot}(\Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S} \Omega^\bullet)
\longrightarrow
\Omega^\bullet
$$
For every integer $p = 0, 1, \ldots, n$ this map annihilates the subcomplex
$\text{Tot}(\sigma_{> p} \Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S}
\sigma_{\geq n - p} \Omega^\bullet)$ for degree reasons.
Hence we find that the restriction of $\wedge$ to the subcomplex
$\text{Tot}(\Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S}
\geq_{n - p}\Omega^\bullet)$ factors through a map of complexes
$$
\gamma_p :
\text{Tot}(\sigma_{\leq p} \Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S}
\sigma_{\geq n - p} \Omega^\bullet)
\longrightarrow
\Omega^\bullet
$$
Using the same procedure as in Section \ref{section-cup-product} we obtain
relative cup products
$$
Rf_*\sigma_{\leq p} \Omega^\bullet
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rf_*\sigma_{\geq n - p}\Omega^\bullet
\longrightarrow
Rf_*\Omega^\bullet
$$
We will prove by induction on $p$ that these cup products via $t$
induce perfect pairings between $Rf_*\sigma_{\leq p} \Omega^\bullet$
and $Rf_*\sigma_{\geq n - p}\Omega^\bullet[2n]$. For $p = n$
this is the assertion of the proposition.

\medskip\noindent
The base case is $p = 0$. In this case we have
$$
Rf_*\sigma_{\leq p}\Omega^\bullet = Rf_*\mathcal{O}_X
\quad\text{and}\quad
Rf_*\sigma_{\geq n - p}\Omega^\bullet[2n] = Rf_*(\Omega^n[-n])[2n] =
Rf_*\Omega^n[n]
$$
In this case we simply obtain the pairing
between $Rf_*\mathcal{O}_X$ and $Rf_*\Omega^n[n]$ of
Lemma \ref{lemma-relative-duality-hodge} and the result is true.

\medskip\noindent
Induction step. Say we know the result is true for $p$. Then
we consider the distinguished triangle
$$
\Omega^{p + 1}[-p - 1] \to
\sigma_{\leq p + 1}\Omega^\bullet \to
\sigma_{\leq p}\Omega^\bullet \to
\Omega^{p + 1}[-p]
$$
and the distinguished triangle
$$
\sigma_{\geq n - p}\Omega^\bullet \to
\sigma_{\geq n - p - 1}\Omega^\bullet \to
\Omega^{n - p - 1}[-n + p + 1] \to
(\sigma_{\geq n - p}\Omega^\bullet)[1]
$$
Observe that both are distinguished triangles in the homotopy category
of complexes of sheaves of $f^{-1}\mathcal{O}_S$-modules; in particular the
maps $\sigma_{\leq p}\Omega^\bullet \to \Omega^{p + 1}[-p]$ and
$\Omega^{n - p - 1}[-d + p + 1] \to (\sigma_{\geq n - p}\Omega^\bullet)[1]$
are given by actual maps of complexes, namely using the differential
$\Omega^p \to \Omega^{p + 1}$ and the differential
$\Omega^{n - p - 1} \to \Omega^{n - p}$.
Consider the distinguished triangles associated gotten from these
distinguished triangles by applying $Rf_*$
$$
\xymatrix{
Rf_*\sigma_{\leq p}\Omega^\bullet \ar[d]_a \\
Rf_*\Omega^{p + 1}[-p - 1] \ar[d]_b \\
Rf_*\sigma_{\leq p + 1}\Omega^\bullet \ar[d]_c \\
Rf_*\sigma_{\leq p}\Omega^\bullet \ar[d]_d \\
Rf_*\Omega^{p + 1}[-p - 1]
}
\quad\quad
\xymatrix{
Rf_*\sigma_{\geq n - p}\Omega^\bullet \\
Rf_*\Omega^{n - p - 1}[-n + p + 1] \ar[u]_{a'} \\
Rf_*\sigma_{\geq n - p - 1}\Omega^\bullet \ar[u]_{b'} \\
Rf_*\sigma_{\geq n - p}\Omega^\bullet \ar[u]_{c'} \\
Rf_*\Omega^{n - p - 1}[-n + p + 1] \ar[u]_{d'}
}
$$
We will show below that the pairs $(a, a')$, $(b, b')$, $(c, c')$, and
$(d, d')$ are compatible with the given pairings. This means we obtain a
map from the distinguished triangle on the left to the distuiguished triangle
obtained by applying $R\SheafHom(-, \mathcal{O}_S)$ to the distinguished
triangle on the right. By induction and Lemma \ref{lemma-duality-hodge}
we know that the pairings constructed above between the
complexes on the first, second, fourth, and fifth
rows are perfect, i.e., determine isomorphisms after taking duals.
By Derived Categories, Lemma \ref{derived-lemma-third-isomorphism-triangle}
we conclude the pairing between the complexes in the middle row
is perfect as desired.

\medskip\noindent
Let $e : K \to K'$ and $e' : M' \to M$ be maps of objects
of $D(\mathcal{O}_S)$ and let
$K \otimes_{\mathcal{O}_S}^\mathbf{L} M \to \mathcal{O}_S$ and
$K' \otimes_{\mathcal{O}_S}^\mathbf{L} M' \to \mathcal{O}_S$
be pairings. Then we say these pairings are compatible if the
diagram
$$
\xymatrix{
K' \otimes_{\mathcal{O}_S}^\mathbf{L} M' \ar[d] &
K \otimes_{\mathcal{O}_S}^\mathbf{L} M'
\ar[l]^{e \otimes 1} \ar[d]^{1 \otimes e'} \\
\mathcal{O}_S &
K \otimes_{\mathcal{O}_S}^\mathbf{L} M \ar[l]
}
$$
commutes. This indeed means that the diagram
$$
\xymatrix{
K \ar[r] \ar[d]_e & R\SheafHom(M, \mathcal{O}_S) \ar[d]^{R\SheafHom(e', -)} \\
K' \ar[r] & R\SheafHom(M', \mathcal{O}_S)
}
$$
commutes and hence is sufficient for our purposes.

\medskip\noindent
Let us prove this for the pair $(c, c')$. Here we observe simply
that we have a commutative diagram
$$
\xymatrix{
\text{Tot}(\sigma_{\leq p} \Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S}
\sigma_{\geq n - p} \Omega^\bullet) \ar[d]_{\gamma_p} &
\text{Tot}(\sigma_{\leq p + 1} \Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S}
\sigma_{\geq n - p} \Omega^\bullet) \ar[l] \ar[d] \\
\Omega^\bullet &
\text{Tot}(\sigma_{\leq p + 1} \Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S}
\sigma_{\geq n - p - 1} \Omega^\bullet) \ar[l]_-{\gamma_{p + 1}}
}
$$
By functoriality of the cup product we obtain commutativity of the
desired diagram.

\medskip\noindent
Similarly for the pair $(b, b')$ we use the commutative diagram
$$
\xymatrix{
\text{Tot}(\sigma_{\leq p + 1} \Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S}
\sigma_{\geq n - p - 1} \Omega^\bullet) \ar[d]_{\gamma_{p + 1}} &
\text{Tot}(\Omega^{p + 1}[-p - 1] \otimes_{f^{-1}\mathcal{O}_S}
\sigma_{\geq n - p - 1} \Omega^\bullet) \ar[l] \ar[d] \\
\Omega^\bullet &
\Omega^{p + 1}[-p - 1]
\otimes_{f^{-1}\mathcal{O}_S}
\Omega^{n - p - 1}[-n + p + 1] \ar[l]_-\wedge
}
$$

\medskip\noindent
For the pairs $(d, d')$ and $(a, a')$ we use the commutative diagram
$$
\xymatrix{
\Omega^{p + 1}[-p] \otimes_{f^{-1}\mathcal{O}_S}
\Omega^{n - p - 1}[-n + p] \ar[d] &
\text{Tot}(\sigma_{\leq p}\Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S}
\Omega^{n - p - 1}[-n + p]) \ar[l] \ar[d] \\
\Omega^\bullet &
\text{Tot}(\sigma_{\leq p}\Omega^\bullet \otimes_{f^{-1}\mathcal{O}_S}
\sigma_{\geq n - p}\Omega^\bullet) \ar[l]
}
$$

\medskip\noindent
We omit the argument showing the uniqueness of $t$ up to
precomposing by multiplication by a unit in $H^0(X, \mathcal{O}_X)$.
\end{proof}











\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
