\input{preamble}

% OK, start here.
%
\begin{document}

\title{Cohomology of Schemes}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we first prove a number of results on the cohomology of
quasi-coherent sheaves. A fundamental reference is \cite{EGA}.
Having done this we will elaborate on cohomology of
coherent sheaves in the Noetherian setting. See \cite{FAC}.







\section{{\v C}ech cohomology of quasi-coherent sheaves}
\label{section-cech-quasi-coherent}

\noindent
Let $X$ be a scheme.
Let $U \subset X$ be an affine open.
Recall that a {\it standard open covering} of $U$ is a covering
of the form $\mathcal{U} : U = \bigcup_{i = 1}^n D(f_i)$
where $f_1, \ldots, f_n \in \Gamma(U, \mathcal{O}_X)$ generate
the unit ideal, see
Schemes, Definition \ref{schemes-definition-standard-covering}.

\begin{lemma}
\label{lemma-cech-cohomology-quasi-coherent-trivial}
Let $X$ be a scheme.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Let $\mathcal{U} : U = \bigcup_{i = 1}^n D(f_i)$ be a standard
open covering of an affine open of $X$.
Then $\check{H}^p(\mathcal{U}, \mathcal{F}) = 0$ for
all $p > 0$.
\end{lemma}

\begin{proof}
Write $U = \Spec(A)$ for some ring $A$.
In other words, $f_1, \ldots, f_n$ are elements of $A$
which generate the unit ideal of $A$.
Write $\mathcal{F}|_U = \widetilde{M}$ for some $A$-module $M$.
Clearly the {\v C}ech complex
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$
is identified with the complex
$$
\prod\nolimits_{i_0} M_{f_{i_0}} \to
\prod\nolimits_{i_0i_1} M_{f_{i_0}f_{i_1}} \to
\prod\nolimits_{i_0i_1i_2} M_{f_{i_0}f_{i_1}f_{i_2}} \to
\ldots
$$
We are asked to show that the extended complex
\begin{equation}
\label{equation-extended}
0 \to
M \to
\prod\nolimits_{i_0} M_{f_{i_0}} \to
\prod\nolimits_{i_0i_1} M_{f_{i_0}f_{i_1}} \to
\prod\nolimits_{i_0i_1i_2} M_{f_{i_0}f_{i_1}f_{i_2}} \to
\ldots
\end{equation}
(whose truncation we have studied in
Algebra, Lemma \ref{algebra-lemma-cover-module}) is exact.
It suffices to show that (\ref{equation-extended})
is exact after localizing at a prime $\mathfrak p$, see
Algebra, Lemma \ref{algebra-lemma-characterize-zero-local}.
In fact we will show that the extended complex localized
at $\mathfrak p$ is homotopic to zero.

\medskip\noindent
There exists an index $i$ such that $f_i \not \in \mathfrak p$.
Choose and fix such an element $i_{\text{fix}}$. Note that
$M_{f_{i_{\text{fix}}}, \mathfrak p} = M_{\mathfrak p}$. Similarly
for a localization at a product $f_{i_0} \ldots f_{i_p}$ and $\mathfrak p$
we can drop any $f_{i_j}$ for which $i_j = i_{\text{fix}}$.
Let us define a homotopy
$$
h :
\prod\nolimits_{i_0 \ldots i_{p + 1}}
M_{f_{i_0} \ldots f_{i_{p + 1}}, \mathfrak p}
\longrightarrow
\prod\nolimits_{i_0 \ldots i_p}
M_{f_{i_0} \ldots f_{i_p}, \mathfrak p}
$$
by the rule
$$
h(s)_{i_0 \ldots i_p} = s_{i_{\text{fix}} i_0 \ldots i_p}
$$
(This is ``dual'' to the homotopy in the proof of
Cohomology, Lemma \ref{cohomology-lemma-homology-complex}.)
In other words, $h : \prod_{i_0} M_{f_{i_0}, \mathfrak p} \to M_\mathfrak p$
is projection onto the factor
$M_{f_{i_{\text{fix}}}, \mathfrak p} = M_{\mathfrak p}$ and in general
the map $h$ equal projection onto the factors
$M_{f_{i_{\text{fix}}} f_{i_1} \ldots f_{i_{p + 1}}, \mathfrak p}
= M_{f_{i_1} \ldots f_{i_{p + 1}}, \mathfrak p}$. We compute
\begin{align*}
(dh + hd)(s)_{i_0 \ldots i_p}
& =
\sum\nolimits_{j = 0}^p
(-1)^j
h(s)_{i_0 \ldots \hat i_j \ldots i_p}
+
d(s)_{i_{\text{fix}} i_0 \ldots i_p}\\
& =
\sum\nolimits_{j = 0}^p
(-1)^j
s_{i_{\text{fix}} i_0 \ldots \hat i_j \ldots i_p}
+
s_{i_0 \ldots i_p}
+
\sum\nolimits_{j = 0}^p
(-1)^{j + 1}
s_{i_{\text{fix}} i_0 \ldots \hat i_j \ldots i_p} \\
& =
s_{i_0 \ldots i_p}
\end{align*}
This proves the identity map is homotopic to zero as desired.
\end{proof}

\noindent
The following lemma says in particular that for any affine scheme
$X$ and any quasi-coherent sheaf $\mathcal{F}$ on $X$ we have
$$
H^p(X, \mathcal{F}) = 0
$$
for all $p > 0$.

\begin{lemma}
\label{lemma-quasi-coherent-affine-cohomology-zero}
\begin{slogan}
Serre vanishing: Higher cohomology vanishes on affine schemes
for quasi-coherent modules.
\end{slogan}
Let $X$ be a scheme.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
For any affine open $U \subset X$ we have
$H^p(U, \mathcal{F}) = 0$ for all $p > 0$.
\end{lemma}

\begin{proof}
We are going to apply
Cohomology, Lemma \ref{cohomology-lemma-cech-vanish-basis}.
As our basis $\mathcal{B}$ for the topology of $X$ we are going to use
the affine opens of $X$.
As our set $\text{Cov}$ of open coverings we are going to use the standard
open coverings of affine opens of $X$.
Next we check that conditions (1), (2) and (3) of
Cohomology, Lemma \ref{cohomology-lemma-cech-vanish-basis}
hold. Note that the intersection of standard opens in an affine is
another standard open. Hence property (1) holds.
The coverings form a cofinal system of open coverings of any element
of $\mathcal{B}$, see
Schemes, Lemma \ref{schemes-lemma-standard-open}.
Hence (2) holds.
Finally, condition (3) of the lemma follows from
Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial}.
\end{proof}

\noindent
Here is a relative version of the vanishing of cohomology of quasi-coherent
sheaves on affines.

\begin{lemma}
\label{lemma-relative-affine-vanishing}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
If $f$ is affine then $R^if_*\mathcal{F} = 0$ for all $i > 0$.
\end{lemma}

\begin{proof}
According to
Cohomology, Lemma \ref{cohomology-lemma-describe-higher-direct-images}
the sheaf
$R^if_*\mathcal{F}$ is the sheaf associated to the presheaf
$V \mapsto H^i(f^{-1}(V), \mathcal{F}|_{f^{-1}(V)})$.
By assumption, whenever $V$ is affine we have that $f^{-1}(V)$ is
affine, see Morphisms, Definition \ref{morphisms-definition-affine}.
By Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero} we conclude that
$H^i(f^{-1}(V), \mathcal{F}|_{f^{-1}(V)}) = 0$
whenever $V$ is affine. Since $S$ has a basis consisting of affine
opens we win.
\end{proof}

\begin{lemma}
\label{lemma-relative-affine-cohomology}
Let $f : X \to S$ be an affine morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Then $H^i(X, \mathcal{F}) = H^i(S, f_*\mathcal{F})$ for all $i \geq 0$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-relative-affine-vanishing}
and the Leray spectral sequence. See
Cohomology, Lemma \ref{cohomology-lemma-apply-Leray}.
\end{proof}

\noindent
The following two lemmas explain when {\v C}ech cohomology
can be used to compute cohomology of quasi-coherent modules.

\begin{lemma}
\label{lemma-affine-diagonal}
Let $X$ be a scheme. The following are equivalent
\begin{enumerate}
\item $X$ has affine diagonal $\Delta : X \to X \times X$,
\item for $U, V \subset X$ affine open, the intersection
$U \cap V$ is affine, and
\item there exists an open covering $\mathcal{U} : X = \bigcup_{i \in I} U_i$
such that $U_{i_0 \ldots i_p}$ is affine open for all $p \ge 0$ and all
$i_0, \ldots, i_p \in I$.
\end{enumerate}
In particular this holds if $X$ is separated.
\end{lemma}

\begin{proof}
Assume $X$ has affine diagonal. Let $U, V \subset X$ be affine opens.
Then $U \cap V = \Delta^{-1}(U \times V)$ is affine. Thus (2) holds.
It is immediate that (2) implies (3). Conversely, if there is a
covering of $X$ as in (3), then $X \times X = \bigcup U_i \times U_{i'}$
is an affine open covering, and we see that
$\Delta^{-1}(U_i \times U_{i'}) = U_i \cap U_{i'}$
is affine. Then $\Delta$ is an affine morphism by
Morphisms, Lemma \ref{morphisms-lemma-characterize-affine}.
The final assertion follows from Schemes, Lemma
\ref{schemes-lemma-characterize-separated}.
\end{proof}

\begin{lemma}
\label{lemma-cech-cohomology-quasi-coherent}
Let $X$ be a scheme.
Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be an open covering such that
$U_{i_0 \ldots i_p}$ is affine open for all $p \ge 0$ and all
$i_0, \ldots, i_p \in I$.
In this case for any quasi-coherent sheaf $\mathcal{F}$ we have
$$
\check{H}^p(\mathcal{U}, \mathcal{F}) = H^p(X, \mathcal{F})
$$
as $\Gamma(X, \mathcal{O}_X)$-modules for all $p$.
\end{lemma}

\begin{proof}
In view of
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}
this is a special case of
Cohomology, Lemma
\ref{cohomology-lemma-cech-spectral-sequence-application}.
\end{proof}







\section{Vanishing of cohomology}
\label{section-vanishing}

\noindent
We have seen that on an affine scheme the higher cohomology groups
of any quasi-coherent sheaf vanish
(Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}).
It turns out that this also
characterizes affine schemes. We give two versions.

\begin{lemma}
\label{lemma-quasi-compact-h1-zero-covering}
\begin{reference}
\cite{Serre-criterion}, \cite[II, Theorem 5.2.1 (d') and IV (1.7.17)]{EGA}
\end{reference}
\begin{slogan}
Serre's criterion for affineness.
\end{slogan}
Let $X$ be a scheme.
Assume that
\begin{enumerate}
\item $X$ is quasi-compact,
\item for every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_X$ we have $H^1(X, \mathcal{I}) = 0$.
\end{enumerate}
Then $X$ is affine.
\end{lemma}

\begin{proof}
Let $x \in X$ be a closed point. Let $U \subset X$ be an affine open
neighbourhood of $x$. Write $U = \Spec(A)$ and let
$\mathfrak m \subset A$ be the maximal ideal corresponding to $x$.
Set $Z = X \setminus U$ and $Z' = Z \cup \{x\}$.
By Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme} there
are quasi-coherent sheaves of ideals
$\mathcal{I}$, resp.\ $\mathcal{I}'$ cutting out
the reduced closed subschemes $Z$, resp.\ $Z'$.
Consider the short exact sequence
$$
0 \to \mathcal{I}' \to \mathcal{I} \to \mathcal{I}/\mathcal{I}' \to 0.
$$
Since $x$ is a closed point of $X$ and $x \not \in Z$ we see that
$\mathcal{I}/\mathcal{I}'$ is supported at $x$. In fact, the restriction
of $\mathcal{I}/\mathcal{I'}$ to $U$ corresponds to the $A$-module
$A/\mathfrak m$. Hence we see that $\Gamma(X, \mathcal{I}/\mathcal{I'})
= A/\mathfrak m$. Since by assumption $H^1(X, \mathcal{I}') = 0$
we see there exists a global section $f \in \Gamma(X, \mathcal{I})$
which maps to the element $1 \in A/\mathfrak m$ as a section of
$\mathcal{I}/\mathcal{I'}$. Clearly we have
$x \in X_f \subset U$. This implies that $X_f = D(f_A)$ where
$f_A$ is the image of $f$ in $A = \Gamma(U, \mathcal{O}_X)$.
In particular $X_f$ is affine.

\medskip\noindent
Consider the union $W = \bigcup X_f$ over all $f \in \Gamma(X, \mathcal{O}_X)$
such that $X_f$ is affine. Obviously $W$ is open in $X$.
By the arguments above every closed point of
$X$ is contained in $W$. The closed subset $X \setminus W$ of $X$
is also quasi-compact
(see Topology, Lemma \ref{topology-lemma-closed-in-quasi-compact}).
Hence it has a closed point if it is nonempty (see
Topology, Lemma \ref{topology-lemma-quasi-compact-closed-point}).
This would contradict the fact that all closed points are in
$W$. Hence we conclude $X = W$.

\medskip\noindent
Choose finitely many $f_1, \ldots, f_n \in \Gamma(X, \mathcal{O}_X)$
such that $X = X_{f_1} \cup \ldots \cup X_{f_n}$ and such that each
$X_{f_i}$ is affine. This is possible as we've seen above.
By Properties, Lemma \ref{properties-lemma-characterize-affine}
to finish the proof it suffices
to show that $f_1, \ldots, f_n$ generate the unit ideal in
$\Gamma(X, \mathcal{O}_X)$. Consider the short exact sequence
$$
\xymatrix{
0 \ar[r] &
\mathcal{F} \ar[r] &
\mathcal{O}_X^{\oplus n} \ar[rr]^{f_1, \ldots, f_n} & &
\mathcal{O}_X \ar[r] &
0
}
$$
The arrow defined by $f_1, \ldots, f_n$ is surjective since the
opens $X_{f_i}$ cover $X$. We let $\mathcal{F}$ be the kernel
of this surjective map.
Observe that $\mathcal{F}$ has a filtration
$$
0 = \mathcal{F}_0 \subset \mathcal{F}_1 \subset
\ldots \subset \mathcal{F}_n = \mathcal{F}
$$
so that each subquotient $\mathcal{F}_i/\mathcal{F}_{i - 1}$ is
isomorphic to a quasi-coherent sheaf of ideals.
Namely we can take $\mathcal{F}_i$ to be the intersection of
$\mathcal{F}$ with the first $i$ direct summands of
$\mathcal{O}_X^{\oplus n}$.
The assumption
of the lemma implies that $H^1(X, \mathcal{F}_i/\mathcal{F}_{i - 1}) = 0$
for all $i$. This implies that
$H^1(X, \mathcal{F}_2) = 0$ because it is sandwiched between
$H^1(X, \mathcal{F}_1)$ and $H^1(X, \mathcal{F}_2/\mathcal{F}_1)$.
Continuing like this we deduce that $H^1(X, \mathcal{F}) = 0$.
Therefore we conclude that the map
$$
\xymatrix{
\bigoplus\nolimits_{i = 1, \ldots, n} \Gamma(X, \mathcal{O}_X)
\ar[rr]^{f_1, \ldots, f_n} & &
\Gamma(X, \mathcal{O}_X)
}
$$
is surjective as desired.
\end{proof}

\noindent
Note that if $X$ is a Noetherian scheme then every quasi-coherent
sheaf of ideals is automatically a coherent sheaf of ideals and a
finite type quasi-coherent sheaf of ideals. Hence
the preceding lemma and the next lemma both apply in this case.

\begin{lemma}
\label{lemma-quasi-separated-h1-zero-covering}
\begin{reference}
\cite{Serre-criterion}, \cite[II, Theorem 5.2.1]{EGA}
\end{reference}
\begin{slogan}
Serre's criterion for affineness.
\end{slogan}
Let $X$ be a scheme. Assume that
\begin{enumerate}
\item $X$ is quasi-compact,
\item $X$ is quasi-separated, and
\item $H^1(X, \mathcal{I}) = 0$ for every quasi-coherent sheaf
of ideals $\mathcal{I}$ of finite type.
\end{enumerate}
Then $X$ is affine.
\end{lemma}

\begin{proof}
By
Properties, Lemma \ref{properties-lemma-quasi-coherent-colimit-finite-type}
every quasi-coherent sheaf of ideals is a directed colimit of
quasi-coherent sheaves of ideals of finite type.
By Cohomology, Lemma \ref{cohomology-lemma-quasi-separated-cohomology-colimit}
taking cohomology on $X$ commutes with directed colimits.
Hence we see that $H^1(X, \mathcal{I}) = 0$
for every quasi-coherent sheaf of ideals on $X$. In other words
we see that Lemma \ref{lemma-quasi-compact-h1-zero-covering} applies.
\end{proof}

\noindent
We can use the arguments given above to find a sufficient condition to
see when an invertible sheaf is ample. However, we warn the reader that
this condition is not necessary.

\begin{lemma}
\label{lemma-quasi-compact-h1-zero-invertible}
Let $X$ be a scheme. Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Assume that
\begin{enumerate}
\item $X$ is quasi-compact,
\item for every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_X$
there exists an $n \geq 1$ such that
$H^1(X, \mathcal{I} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}) = 0$.
\end{enumerate}
Then $\mathcal{L}$ is ample.
\end{lemma}

\begin{proof}
This is proved in exactly the same way as
Lemma \ref{lemma-quasi-compact-h1-zero-covering}.
Let $x \in X$ be a closed point. Let $U \subset X$ be an affine open
neighbourhood of $x$ such that $\mathcal{L}|_U \cong \mathcal{O}_U$.
Write $U = \Spec(A)$ and let
$\mathfrak m \subset A$ be the maximal ideal corresponding to $x$.
Set $Z = X \setminus U$ and $Z' = Z \cup \{x\}$.
By Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme} there
are quasi-coherent sheaves of ideals
$\mathcal{I}$, resp.\ $\mathcal{I}'$ cutting out
the reduced closed subschemes $Z$, resp.\ $Z'$.
Consider the short exact sequence
$$
0 \to \mathcal{I}' \to \mathcal{I} \to \mathcal{I}/\mathcal{I}' \to 0.
$$
For every $n \geq 1$ we obtain a short exact sequence
$$
0 \to \mathcal{I}' \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}
\to \mathcal{I} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n} \to
\mathcal{I}/\mathcal{I}' \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n} \to 0.
$$
By our assumption we may pick $n$ such that
$H^1(X, \mathcal{I}' \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}) = 0$.
Since $x$ is a closed point of $X$ and $x \not \in Z$ we see that
$\mathcal{I}/\mathcal{I}'$ is supported at $x$. In fact, the restriction
of $\mathcal{I}/\mathcal{I'}$ to $U$ corresponds to the $A$-module
$A/\mathfrak m$. Since $\mathcal{L}$ is trivial on $U$
we see that the restriction of
$\mathcal{I}/\mathcal{I}' \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
to $U$ also corresponds to the $A$-module $A/\mathfrak m$.
Hence we see that
$\Gamma(X, \mathcal{I}/\mathcal{I'} \otimes_{\mathcal{O}_X}
\mathcal{L}^{\otimes n}) = A/\mathfrak m$.
By our choice of $n$ we see there exists a global section
$s \in \Gamma(X, \mathcal{I} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})$
which maps to the element $1 \in A/\mathfrak m$. Clearly we have
$x \in X_s \subset U$ because $s$ vanishes at points of $Z$.
This implies that $X_s = D(f)$ where
$f \in A$ is the image of $s$ in $A \cong \Gamma(U, \mathcal{L}^{\otimes n})$.
In particular $X_s$ is affine.

\medskip\noindent
Consider the union $W = \bigcup X_s$ over all
$s \in \Gamma(X, \mathcal{L}^{\otimes n})$ for $n \geq 1$
such that $X_s$ is affine. Obviously $W$ is open in $X$.
By the arguments above every closed point of
$X$ is contained in $W$. The closed subset $X \setminus W$ of $X$
is also quasi-compact
(see Topology, Lemma \ref{topology-lemma-closed-in-quasi-compact}).
Hence it has a closed point if it is nonempty (see
Topology, Lemma \ref{topology-lemma-quasi-compact-closed-point}).
This would contradict the fact that all closed points are in
$W$. Hence we conclude $X = W$. This means that $\mathcal{L}$
is ample by Properties, Definition \ref{properties-definition-ample}.
\end{proof}

\noindent
There is a variant of Lemma \ref{lemma-quasi-compact-h1-zero-invertible}
with finite type ideal sheaves which we will formulate and prove here if
we ever need it.

\begin{lemma}
\label{lemma-criterion-affine-morphism}
Let $f : X \to Y$ be a quasi-compact morphism with $X$ and $Y$ quasi-separated.
If $R^1f_*\mathcal{I} = 0$ for every quasi-coherent sheaf of ideals
$\mathcal{I}$ on $X$, then $f$ is affine.
\end{lemma}

\begin{proof}
Let $V \subset Y$ be an affine open subscheme. We have to show that
$U = f^{-1}(V)$ is affine. The inclusion morphism $V \to Y$ is quasi-compact
by Schemes, Lemma \ref{schemes-lemma-quasi-compact-permanence}.
Hence the base change $U \to X$ is quasi-compact, see
Schemes, Lemma \ref{schemes-lemma-quasi-compact-preserved-base-change}.
Thus any quasi-coherent sheaf of ideals $\mathcal{I}$ on $U$
extends to a quasi-coherent sheaf of ideals on $X$, see
Properties, Lemma \ref{properties-lemma-extend-trivial}.
Since the formation of $R^1f_*$ is local on $Y$
(Cohomology, Section \ref{cohomology-section-locality})
we conclude that $R^1(U \to V)_*\mathcal{I} = 0$ by the assumption
in the lemma. Hence by the Leray Spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-Leray})
we conclude that $H^1(U, \mathcal{I}) = H^1(V, (U \to V)_*\mathcal{I})$.
Since $(U \to V)_*\mathcal{I}$ is quasi-coherent by
Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}, we have
$H^1(V, (U \to V)_*\mathcal{I}) = 0$ by
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}.
Thus we find that $U$ is affine by
Lemma \ref{lemma-quasi-compact-h1-zero-covering}.
\end{proof}















\section{Quasi-coherence of higher direct images}
\label{section-quasi-coherence}

\noindent
We have seen that the higher cohomology groups of a quasi-coherent module on
an affine is zero. For (quasi-)separated quasi-compact schemes $X$ this implies
vanishing of cohomology groups of quasi-coherent sheaves beyond a certain
degree. However, it may not be the case that $X$ has finite cohomological
dimension, because that is defined in terms of vanishing of cohomology
of {\it all} $\mathcal{O}_X$-modules.

\begin{lemma}[Induction Principle]
\label{lemma-induction-principle}
Let $X$ be a quasi-compact and quasi-separated scheme. Let $P$ be a property
of the quasi-compact opens of $X$. Assume that
\begin{enumerate}
\item $P$ holds for every affine open of $X$,
\item if $U$ is quasi-compact open, $V$ affine open,
$P$ holds for $U$, $V$, and $U \cap V$, then
$P$ holds for $U \cup V$.
\end{enumerate}
Then $P$ holds for every quasi-compact open of $X$
and in particular for $X$.
\end{lemma}

\begin{proof}
First we argue by induction that $P$ holds for {\it separated} quasi-compact
opens $W \subset X$. Namely, such an open can be written as
$W = U_1 \cup \ldots \cup U_n$ and we can do induction on $n$ using
property (2) with $U = U_1 \cup \ldots \cup U_{n - 1}$ and $V = U_n$.
This is allowed because
$U \cap V = (U_1 \cap U_n) \cup \ldots \cup (U_{n - 1} \cap U_n)$
is also a union of $n - 1$ affine open subschemes by
Schemes, Lemma \ref{schemes-lemma-characterize-separated}
applied to the affine opens $U_i$ and $U_n$ of $W$.
Having said this, for any quasi-compact open $W \subset X$ we can
do induction on the number of affine opens needed to cover $W$
using the same trick as before and using that the quasi-compact open
$U_i \cap U_n$ is separated as an open subscheme of the affine scheme $U_n$.
\end{proof}

\begin{lemma}
\label{lemma-vanishing-nr-affines}
\begin{slogan}
For schemes with affine diagonal, the cohomology of quasi-coherent
modules vanishes in degrees bigger than the number of affine
opens needed in a covering.
\end{slogan}
Let $X$ be a quasi-compact scheme with affine diagonal (for example
if $X$ is separated).
Let $t = t(X)$ be the minimal number of affine opens needed to
cover $X$. Then $H^n(X, \mathcal{F}) = 0$ for all $n \geq t$ and all
quasi-coherent sheaves $\mathcal{F}$.
\end{lemma}

\begin{proof}
First proof.
By induction on $t$.
If $t = 1$ the result follows from
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}.
If $t > 1$ write $X = U \cup V$ with $V$ affine open and
$U = U_1 \cup \ldots \cup U_{t - 1}$ a union of $t - 1$ open affines.
Note that in this case
$U \cap V =  (U_1 \cap V) \cup \ldots (U_{t - 1} \cap V)$
is also a union of $t - 1$ affine open subschemes.
Namely, since the diagonal is affine, the intersection of two
affine opens is affine, see Lemma \ref{lemma-affine-diagonal}.
We apply the Mayer-Vietoris long exact sequence
$$
0 \to
H^0(X, \mathcal{F}) \to
H^0(U, \mathcal{F}) \oplus H^0(V, \mathcal{F}) \to
H^0(U \cap V, \mathcal{F}) \to
H^1(X, \mathcal{F}) \to \ldots
$$
see Cohomology, Lemma \ref{cohomology-lemma-mayer-vietoris}.
By induction we see that the groups $H^i(U, \mathcal{F})$,
$H^i(V, \mathcal{F})$, $H^i(U \cap V, \mathcal{F})$ are zero for
$i \geq t - 1$. It follows immediately that $H^i(X, \mathcal{F})$
is zero for $i \geq t$.

\medskip\noindent
Second proof.
Let $\mathcal{U} : X = \bigcup_{i = 1}^t U_i$ be a finite affine open
covering. Since $X$ is has affine diagonal the multiple intersections
$U_{i_0 \ldots i_p}$ are all affine, see
Lemma \ref{lemma-affine-diagonal}.
By Lemma \ref{lemma-cech-cohomology-quasi-coherent} the {\v C}ech
cohomology groups $\check{H}^p(\mathcal{U}, \mathcal{F})$
agree with the cohomology groups. By
Cohomology, Lemma \ref{cohomology-lemma-alternating-usual}
the {\v C}ech cohomology groups may be computed using the alternating
{\v C}ech complex $\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F})$.
As the covering consists of $t$ elements we see immediately
that $\check{\mathcal{C}}_{alt}^p(\mathcal{U}, \mathcal{F}) = 0$
for all $p \geq t$. Hence the result follows.
\end{proof}

\begin{lemma}
\label{lemma-affine-diagonal-universal-delta-functor}
Let $X$ be a quasi-compact scheme with affine diagonal
(for example if $X$ is separated). Then
\begin{enumerate}
\item given a quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$
there exists an embedding $\mathcal{F} \to \mathcal{F}'$ of
quasi-coherent $\mathcal{O}_X$-modules
such that $H^p(X, \mathcal{F}') = 0$ for all $p \geq 1$, and
\item $\{H^n(X, -)\}_{n \geq 0}$
is a universal $\delta$-functor from $\QCoh(\mathcal{O}_X)$ to
$\textit{Ab}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $X = \bigcup U_i$ be a finite affine open covering.
Set $U = \coprod U_i$ and denote $j : U \to X$
the morphism inducing the given open immersions $U_i \to X$.
Since $U$ is an affine scheme and $X$ has affine diagonal,
the morphism $j$ is affine, see
Morphisms, Lemma \ref{morphisms-lemma-affine-permanence}.
For every $\mathcal{O}_X$-module $\mathcal{F}$ there is
a canonical map $\mathcal{F} \to j_*j^*\mathcal{F}$.
This map is injective as can be seen by checking on stalks:
if $x \in U_i$, then we have a factorization
$$
\mathcal{F}_x \to (j_*j^*\mathcal{F})_x
\to (j^*\mathcal{F})_{x'} = \mathcal{F}_x
$$
where $x' \in U$ is the point $x$ viewed as a point of $U_i \subset U$.
Now if $\mathcal{F}$ is quasi-coherent, then $j^*\mathcal{F}$
is quasi-coherent on the affine scheme $U$ hence has vanishing
higher cohomology by
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}.
Then $H^p(X, j_*j^*\mathcal{F}) = 0$ for
$p > 0$ by Lemma \ref{lemma-relative-affine-cohomology}
as $j$ is affine. This proves (1).
Finally, we see that the map
$H^p(X, \mathcal{F}) \to H^p(X, j_*j^*\mathcal{F})$
is zero and part (2) follows from
Homology, Lemma \ref{homology-lemma-efface-implies-universal}.
\end{proof}

\begin{lemma}
\label{lemma-vanishing-nr-affines-quasi-separated}
Let $X$ be a quasi-compact quasi-separated scheme.
Let $X = U_1 \cup \ldots \cup U_t$ be an affine open covering.
Set
$$
d = \max\nolimits_{I \subset \{1, \ldots, t\}}
\left(|I| + t(\bigcap\nolimits_{i \in I} U_i)\right)
$$
where $t(U)$ is the minimal number of affines needed to cover
the scheme $U$. Then $H^n(X, \mathcal{F}) = 0$ for all $n \geq d$ and all
quasi-coherent sheaves $\mathcal{F}$.
\end{lemma}

\begin{proof}
Note that since $X$ is quasi-separated the numbers
$t(\bigcap_{i \in I} U_i)$ are finite.
Let $\mathcal{U} : X = \bigcup_{i = 1}^t U_i$.
By
Cohomology, Lemma \ref{cohomology-lemma-cech-spectral-sequence}
there is a spectral sequence
$$
E_2^{p, q} = \check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F}))
$$
converging to $H^{p + q}(U, \mathcal{F})$. By
Cohomology, Lemma \ref{cohomology-lemma-alternating-usual}
we have
$$
E_2^{p, q} =
H^p(\check{\mathcal{C}}_{alt}^\bullet(
\mathcal{U}, \underline{H}^q(\mathcal{F}))
$$
The alternating {\v C}ech complex with values in the presheaf
$\underline{H}^q(\mathcal{F})$ vanishes in high degrees by
Lemma \ref{lemma-vanishing-nr-affines},
more precisely $E_2^{p, q} = 0$ for $p + q \geq d$.
Hence the result follows.
\end{proof}

\begin{lemma}
\label{lemma-quasi-coherence-higher-direct-images}
Let $f : X \to S$ be a morphism of schemes.
Assume that $f$ is quasi-separated and quasi-compact.
\begin{enumerate}
\item For any quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$ the
higher direct images $R^pf_*\mathcal{F}$ are quasi-coherent on $S$.
\item If $S$ is quasi-compact, there exists an integer $n = n(X, S, f)$
such that $R^pf_*\mathcal{F} = 0$ for all $p \geq n$ and any
quasi-coherent sheaf $\mathcal{F}$ on $X$.
\item In fact, if $S$ is quasi-compact we can find $n = n(X, S, f)$
such that for every
morphism of schemes $S' \to S$ we have $R^p(f')_*\mathcal{F}' = 0$
for $p \geq n$ and any quasi-coherent sheaf $\mathcal{F}'$
on $X'$. Here $f' : X' = S' \times_S X \to S'$ is the base change of $f$.
\end{enumerate}
\end{lemma}

\begin{proof}
We first prove (1). Note that under the hypotheses of the lemma the sheaf
$R^0f_*\mathcal{F} = f_*\mathcal{F}$ is quasi-coherent by
Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}.
Using
Cohomology, Lemma \ref{cohomology-lemma-localize-higher-direct-images}
we see that forming higher direct images commutes with restriction
to open subschemes. Since being quasi-coherent is local on $S$ we
may assume $S$ is affine.

\medskip\noindent
Assume $S$ is affine and $f$ quasi-compact and separated.
Let $t \geq 1$ be the minimal number of affine opens needed to cover $X$.
We will prove this case of (1) by induction on $t$.
If $t = 1$ then the morphism $f$ is affine by
Morphisms, Lemma \ref{morphisms-lemma-morphism-affines-affine}
and (1) follows from
Lemma \ref{lemma-relative-affine-vanishing}.
If $t > 1$ write $X = U \cup V$ with $V$ affine open and
$U = U_1 \cup \ldots \cup U_{t - 1}$ a union of $t - 1$ open affines.
Note that in this case
$U \cap V =  (U_1 \cap V) \cup \ldots (U_{t - 1} \cap V)$
is also a union of $t - 1$ affine open subschemes, see
Schemes, Lemma \ref{schemes-lemma-characterize-separated}.
We will apply the relative Mayer-Vietoris sequence
$$
0 \to
f_*\mathcal{F} \to
a_*(\mathcal{F}|_U) \oplus b_*(\mathcal{F}|_V) \to
c_*(\mathcal{F}|_{U \cap V}) \to
R^1f_*\mathcal{F} \to \ldots
$$
see Cohomology, Lemma \ref{cohomology-lemma-relative-mayer-vietoris}.
By induction we see that
$R^pa_*\mathcal{F}$, $R^pb_*\mathcal{F}$ and $R^pc_*\mathcal{F}$
are all quasi-coherent. This implies that each of the sheaves
$R^pf_*\mathcal{F}$ is quasi-coherent since it sits in the middle of a short
exact sequence with a cokernel of a map between quasi-coherent sheaves
on the left and a kernel of a map between quasi-coherent sheaves on the right.
Using the results on quasi-coherent sheaves in
Schemes, Section \ref{schemes-section-quasi-coherent} we see
conclude $R^pf_*\mathcal{F}$ is quasi-coherent.

\medskip\noindent
Assume $S$ is affine and $f$ quasi-compact and quasi-separated.
Let $t \geq 1$ be the minimal number of affine opens needed to cover $X$.
We will prove (1) by induction on $t$.
In case $t = 1$ the morphism $f$ is separated and we are back
in the previous case (see previous paragraph).
If $t > 1$ write $X = U \cup V$ with $V$ affine open and
$U$ a union of $t - 1$ open affines.
Note that in this case $U \cap V$ is an open subscheme of an affine
scheme and hence separated (see
Schemes, Lemma \ref{schemes-lemma-affine-separated}).
We will apply the relative Mayer-Vietoris sequence
$$
0 \to
f_*\mathcal{F} \to
a_*(\mathcal{F}|_U) \oplus b_*(\mathcal{F}|_V) \to
c_*(\mathcal{F}|_{U \cap V}) \to
R^1f_*\mathcal{F} \to \ldots
$$
see Cohomology, Lemma \ref{cohomology-lemma-relative-mayer-vietoris}.
By induction and the result of the previous paragraph we see that
$R^pa_*\mathcal{F}$, $R^pb_*\mathcal{F}$ and $R^pc_*\mathcal{F}$
are quasi-coherent. As in the previous paragraph this implies each of
sheaves $R^pf_*\mathcal{F}$ is quasi-coherent.

\medskip\noindent
Next, we prove (3) and a fortiori (2). Choose a finite affine open
covering $S = \bigcup_{j = 1, \ldots m} S_j$. For each $i$ choose
a finite affine open covering
$f^{-1}(S_j) = \bigcup_{i = 1, \ldots t_j} U_{ji} $.
Let
$$
d_j = \max\nolimits_{I \subset \{1, \ldots, t_j\}}
\left(|I| + t(\bigcap\nolimits_{i \in I} U_{ji})\right)
$$
be the integer found in
Lemma \ref{lemma-vanishing-nr-affines-quasi-separated}.
We claim that $n(X, S, f) = \max d_j$ works.

\medskip\noindent
Namely, let $S' \to S$ be a morphism of schemes and let
$\mathcal{F}'$ be a quasi-coherent sheaf on $X' = S' \times_S X$.
We want to show that $R^pf'_*\mathcal{F}' = 0$ for $p \geq n(X, S, f)$.
Since this question is local on $S'$ we may assume that $S'$ is affine
and maps into $S_j$ for some $j$. Then $X' = S' \times_{S_j} f^{-1}(S_j)$
is covered by the open affines $S' \times_{S_j} U_{ji}$, $i = 1, \ldots t_j$
and the intersections
$$
\bigcap\nolimits_{i \in I} S' \times_{S_j} U_{ji} =
S' \times_{S_j} \bigcap\nolimits_{i \in I} U_{ji}
$$
are covered by the same number of affines as before the base change.
Applying
Lemma \ref{lemma-vanishing-nr-affines-quasi-separated}
we get $H^p(X', \mathcal{F}') = 0$. By the first part of the proof
we already know that each $R^qf'_*\mathcal{F}'$ is quasi-coherent
hence has vanishing higher cohomology groups on our affine scheme $S'$,
thus we see that $H^0(S', R^pf'_*\mathcal{F}') = H^p(X', \mathcal{F}') = 0$
by Cohomology, Lemma \ref{cohomology-lemma-apply-Leray}.
Since $R^pf'_*\mathcal{F}'$ is quasi-coherent
we conclude that $R^pf'_*\mathcal{F}' = 0$.
\end{proof}

\begin{lemma}
\label{lemma-quasi-coherence-higher-direct-images-application}
Let $f : X \to S$ be a morphism of schemes.
Assume that $f$ is quasi-separated and quasi-compact.
Assume $S$ is affine.
For any quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$
we have
$$
H^q(X, \mathcal{F}) = H^0(S, R^qf_*\mathcal{F})
$$
for all $q \in \mathbf{Z}$.
\end{lemma}

\begin{proof}
Consider the Leray spectral sequence $E_2^{p, q} = H^p(S, R^qf_*\mathcal{F})$
converging to $H^{p + q}(X, \mathcal{F})$, see
Cohomology, Lemma \ref{cohomology-lemma-Leray}.
By Lemma \ref{lemma-quasi-coherence-higher-direct-images}
we see that the sheaves $R^qf_*\mathcal{F}$ are quasi-coherent.
By Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}
we see that $E_2^{p, q} = 0$ when $p > 0$.
Hence the spectral sequence degenerates at $E_2$ and we win.
See also
Cohomology, Lemma \ref{cohomology-lemma-apply-Leray} (2)
for the general principle.
\end{proof}








\section{Cohomology and base change, I}
\label{section-cohomology-and-base-change}

\noindent
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Suppose further that $g : S' \to S$ is any morphism of schemes. Denote
$X' = X_{S'} = S' \times_S X$ the base change of $X$ and denote
$f' : X' \to S'$ the base change of $f$.
Also write $g' : X' \to X$ the projection,
and set $\mathcal{F}' = (g')^*\mathcal{F}$.
Here is a diagram representing the situation:
\begin{equation}
\label{equation-base-change-diagram}
\vcenter{
\xymatrix{
\mathcal{F}' = (g')^*\mathcal{F} &
X' \ar[r]_{g'} \ar[d]_{f'} &
X \ar[d]^f &
\mathcal{F} \\
Rf'_*\mathcal{F}' &
S' \ar[r]^g &
S &
Rf_*\mathcal{F}
}
}
\end{equation}
Here is the simplest case of the base change property we have in mind.

\begin{lemma}
\label{lemma-affine-base-change}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume $f$ is affine.
In this case $f_*\mathcal{F} \cong Rf_*\mathcal{F}$ is
a quasi-coherent sheaf, and for every base change diagram
(\ref{equation-base-change-diagram})
we have
$$
g^*f_*\mathcal{F} = f'_*(g')^*\mathcal{F}.
$$
\end{lemma}

\begin{proof}
The vanishing of higher direct images is
Lemma \ref{lemma-relative-affine-vanishing}.
The statement is local on $S$ and $S'$. Hence we may
assume $X = \Spec(A)$, $S = \Spec(R)$,
$S' = \Spec(R')$ and $\mathcal{F} = \widetilde{M}$
for some $A$-module $M$.
We use Schemes, Lemma \ref{schemes-lemma-widetilde-pullback}
to describe pullbacks and pushforwards of $\mathcal{F}$.
Namely, $X' = \Spec(R' \otimes_R A)$ and
$\mathcal{F}'$ is the quasi-coherent sheaf associated
to $(R' \otimes_R A) \otimes_A M$.
Thus we see that the lemma boils down to the
equality
$$
(R' \otimes_R A) \otimes_A M = R' \otimes_R M
$$
as $R'$-modules.
\end{proof}

\noindent
In many situations it is sufficient to know about the following
special case of cohomology and base change. It follows immediately
from the stronger results in
Section \ref{section-cohomology-and-base-change-derived},
but since it is so important it deserves its own proof.

\begin{lemma}[Flat base change]
\label{lemma-flat-base-change-cohomology}
Consider a cartesian diagram of schemes
$$
\xymatrix{
X' \ar[d]_{f'} \ar[r]_{g'} & X \ar[d]^f \\
S' \ar[r]^g & S
}
$$
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module
with pullback $\mathcal{F}' = (g')^*\mathcal{F}$.
Assume that $g$ is flat and that $f$ is quasi-compact and quasi-separated.
For any $i \geq 0$
\begin{enumerate}
\item the base change map of
Cohomology, Lemma \ref{cohomology-lemma-base-change-map-flat-case}
is an isomorphism
$$
g^*R^if_*\mathcal{F} \longrightarrow R^if'_*\mathcal{F}',
$$
\item if $S = \Spec(A)$ and $S' = \Spec(B)$, then
$H^i(X, \mathcal{F}) \otimes_A B = H^i(X', \mathcal{F}')$.
\end{enumerate}
\end{lemma}

\begin{proof}
We claim that part (1) follows from part (2). Namely,
part (1) is local on $S'$ and hence we may assume $S$
and $S'$ are affine. In other words, we have $S = \Spec(A)$
and $S' = \Spec(B)$ as in (2).
Then since $R^if_*\mathcal{F}$ is quasi-coherent
(Lemma \ref{lemma-quasi-coherence-higher-direct-images}),
it is the quasi-coherent $\mathcal{O}_S$-module associated to the
$A$-module $H^0(S, R^if_*\mathcal{F}) = H^i(X, \mathcal{F})$
(equality by
Lemma \ref{lemma-quasi-coherence-higher-direct-images-application}).
Similarly, $R^if'_*\mathcal{F}'$ is the quasi-coherent
$\mathcal{O}_{S'}$-module associated to the $B$-module
$H^i(X', \mathcal{F}')$. Since pullback by $g$ corresponds
to $- \otimes_A B$ on modules
(Schemes, Lemma \ref{schemes-lemma-widetilde-pullback})
we see that it suffices to prove (2).

\medskip\noindent
Let $A \to B$ be a flat ring homomorphism.
Let $X$ be a quasi-compact and quasi-separated scheme over $A$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Set $X_B = X \times_{\Spec(A)} \Spec(B)$ and denote
$\mathcal{F}_B$ the pullback of $\mathcal{F}$.
We are trying to show that the map
$$
H^i(X, \mathcal{F}) \otimes_A B \longrightarrow H^i(X_B, \mathcal{F}_B)
$$
(given by the reference in the statement of the lemma)
is an isomorphism.

\medskip\noindent
In case $X$ is separated, choose an affine open covering
$\mathcal{U} : X = U_1 \cup \ldots \cup U_t$ and recall that
$$
\check{H}^p(\mathcal{U}, \mathcal{F}) = H^p(X, \mathcal{F}),
$$
see
Lemma \ref{lemma-cech-cohomology-quasi-coherent}.
If $\mathcal{U}_B : X_B = (U_1)_B \cup \ldots \cup (U_t)_B$ we obtain
by base change, then it is still the case that each $(U_i)_B$ is affine
and that $X_B$ is separated. Thus we obtain
$$
\check{H}^p(\mathcal{U}_B, \mathcal{F}_B) = H^p(X_B, \mathcal{F}_B).
$$
We have the following relation between the {\v C}ech complexes
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}_B, \mathcal{F}_B) =
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) \otimes_A B
$$
as follows from
Lemma \ref{lemma-affine-base-change}.
Since $A \to B$ is flat, the same thing remains true on taking cohomology.

\medskip\noindent
In case $X$ is quasi-separated, choose an affine open covering
$\mathcal{U} : X = U_1 \cup \ldots \cup U_t$. We will use the
{\v C}ech-to-cohomology spectral sequence
Cohomology, Lemma \ref{cohomology-lemma-cech-spectral-sequence}.
The reader who wishes to avoid this spectral sequence
can use Mayer-Vietoris and induction on $t$ as in the proof of
Lemma \ref{lemma-quasi-coherence-higher-direct-images}.
The spectral sequence has $E_2$-page
$E_2^{p, q} = \check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F}))$
and converges to $H^{p + q}(X, \mathcal{F})$.
Similarly, we have a spectral sequence with $E_2$-page
$E_2^{p, q} = \check{H}^p(\mathcal{U}_B, \underline{H}^q(\mathcal{F}_B))$
which converges to $H^{p + q}(X_B, \mathcal{F}_B)$.
Since the intersections $U_{i_0 \ldots i_p}$ are quasi-compact
and separated, the result of the second paragraph of the proof gives
$\check{H}^p(\mathcal{U}_B, \underline{H}^q(\mathcal{F}_B)) =
\check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F})) \otimes_A B$.
Using that $A \to B$ is flat we conclude that
$H^i(X, \mathcal{F}) \otimes_A B \to H^i(X_B, \mathcal{F}_B)$
is an isomorphism for all $i$ and we win.
\end{proof}

\begin{lemma}[Finite locally free base change]
\label{lemma-finite-locally-free-base-change-cohomology}
Consider a cartesian diagram of schemes
$$
\xymatrix{
Y \ar[d]_{g} \ar[r]_h & X \ar[d]^f \\
\Spec(B) \ar[r] & \Spec(A)
}
$$
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module
with pullback $\mathcal{G} = h^*\mathcal{F}$.
If $B$ is a finite locally free $A$-module, then
$H^i(X, \mathcal{F}) \otimes_A B = H^i(Y, \mathcal{G})$.
\end{lemma}

\noindent
{\bf Warning}: Do not use this lemma unless you understand the difference
between this and Lemma \ref{lemma-flat-base-change-cohomology}.

\begin{proof}
In case $X$ is separated, choose an affine open covering
$\mathcal{U} : X = \bigcup_{i \in I} U_i$ and recall that
$$
\check{H}^p(\mathcal{U}, \mathcal{F}) = H^p(X, \mathcal{F}),
$$
see
Lemma \ref{lemma-cech-cohomology-quasi-coherent}.
Let $\mathcal{V} : Y = \bigcup_{i \in I} g^{-1}(U_i)$
be the corresponding affine open covering of $Y$.
The opens $V_i = g^{-1}(U_i) = U_i \times_{\Spec(A)} \Spec(B)$
are affine and $Y$ is separated. Thus we obtain
$$
\check{H}^p(\mathcal{V}, \mathcal{G}) = H^p(Y, \mathcal{G}).
$$
We claim the map of {\v C}ech complexes
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) \otimes_A B
\longrightarrow
\check{\mathcal{C}}^\bullet(\mathcal{V}, \mathcal{G})
$$
is an isomorphism. Namely, as $B$ is finitely presented as an $A$-module
we see that tensoring with $B$ over $A$ commutes with products, see
Algebra, Proposition \ref{algebra-proposition-fp-tensor}.
Thus it suffices to show that the maps
$\Gamma(U_{i_0 \ldots i_p}, \mathcal{F}) \otimes_A B \to
\Gamma(V_{i_0 \ldots i_p}, \mathcal{G})$ 
are isomorphisms which follows from
Lemma \ref{lemma-affine-base-change}.
Since $A \to B$ is flat, the same thing remains true on taking cohomology.

\medskip\noindent
In the general case we argue in exactly the same way using affine
open covering $\mathcal{U} : X = \bigcup_{i \in I} U_i$ and the
corresponding covering $\mathcal{V} : Y = \bigcup_{i \in I} V_i$
with $V_i = g^{-1}(U_i)$ as above. We will use the
{\v C}ech-to-cohomology spectral sequence
Cohomology, Lemma \ref{cohomology-lemma-cech-spectral-sequence}.
The spectral sequence has $E_2$-page
$E_2^{p, q} = \check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F}))$
and converges to $H^{p + q}(X, \mathcal{F})$.
Similarly, we have a spectral sequence with $E_2$-page
$E_2^{p, q} = \check{H}^p(\mathcal{V}, \underline{H}^q(\mathcal{G}))$
which converges to $H^{p + q}(Y, \mathcal{G})$.
Since the intersections $U_{i_0 \ldots i_p}$ are separated, the result
of the previous paragraph gives isomorphisms
$\Gamma(U_{i_0 \ldots i_p}, \underline{H}^q(\mathcal{F})) \otimes_A B
\to \Gamma(V_{i_0 \ldots i_p}, \underline{H}^q(\mathcal{G}))$.
Using that $- \otimes_A B$ commutes with products and is exact, we conclude
that
$\check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F})) \otimes_A B
\to \check{H}^p(\mathcal{V}, \underline{H}^q(\mathcal{G}))$
is an isomorphism. Using that $A \to B$ is flat we conclude that
$H^i(X, \mathcal{F}) \otimes_A B \to H^i(Y, \mathcal{G})$
is an isomorphism for all $i$ and we win.
\end{proof}









\section{Colimits and higher direct images}
\label{section-colimits}

\noindent
General results of this nature can be found in
Cohomology, Section \ref{cohomology-section-limits},
Sheaves, Lemma \ref{sheaves-lemma-directed-colimits-sections}, and
Modules, Lemma \ref{modules-lemma-finite-presentation-quasi-compact-colimit}.

\begin{lemma}
\label{lemma-colimit-cohomology}
Let $f : X \to S$ be a quasi-compact and quasi-separated morphism of schemes.
Let $\mathcal{F} = \colim \mathcal{F}_i$ be a filtered colimit
of quasi-coherent sheaves on $X$.
Then for any $p \geq 0$ we have
$$
R^pf_*\mathcal{F} = \colim R^pf_*\mathcal{F}_i.
$$
\end{lemma}

\begin{proof}
Recall that $R^pf_*\mathcal{F}$ is the sheaf associated to
$U \mapsto H^p(f^{-1}U, \mathcal{F})$, see
Cohomology, Lemma \ref{cohomology-lemma-describe-higher-direct-images}.
Recall that the colimit is the sheaf associated to the presheaf colimit
(taking colimits over opens). Hence we can apply
Cohomology, Lemma \ref{cohomology-lemma-quasi-separated-cohomology-colimit}
to $H^p(f^{-1}U, -)$ where $U$ is affine to conclude. (Because the
basis of affine opens in $f^{-1}U$ satisfies the assumptions of that
lemma.)
\end{proof}










\section{Cohomology and base change, II}
\label{section-cohomology-and-base-change-derived}

\noindent
Let $f : X \to S$ be a morphism of schemes and let $\mathcal{F}$
be a quasi-coherent $\mathcal{O}_X$-module. If $f$ is quasi-compact
and quasi-separated we would like to represent $Rf_*\mathcal{F}$
by a complex of quasi-coherent sheaves on $S$. This follows
from the fact that the sheaves $R^if_*\mathcal{F}$ are quasi-coherent
if $S$ is quasi-compact and has affine diagonal,
using that $D_\QCoh(S)$ is equivalent to
$D(\QCoh(\mathcal{O}_S))$, see
Derived Categories of Schemes, Proposition
\ref{perfect-proposition-quasi-compact-affine-diagonal}.

\medskip\noindent
In this section we will use a different approach which produces an
explicit complex having a good base change property. The construction
is particularly easy if $f$ and $S$ are separated, or more generally
have affine diagonal. Since this is the case which
by far the most often used we treat it separately.

\begin{lemma}
\label{lemma-separated-case-relative-cech}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume $X$ is quasi-compact and $X$ and $S$ have affine diagonal
(e.g., if $X$ and $S$ are separated).
In this case we can compute $Rf_*\mathcal{F}$ as follows:
\begin{enumerate}
\item Choose a finite affine open covering
$\mathcal{U} : X = \bigcup_{i = 1, \ldots, n} U_i$.
\item For $i_0, \ldots, i_p \in \{1, \ldots, n\}$ denote
$f_{i_0 \ldots i_p} : U_{i_0 \ldots i_p} \to S$ the restriction of $f$
to the intersection $U_{i_0 \ldots i_p} = U_{i_0} \cap \ldots \cap U_{i_p}$.
\item Set $\mathcal{F}_{i_0 \ldots i_p}$ equal to the restriction
of $\mathcal{F}$ to $U_{i_0 \ldots i_p}$.
\item Set
$$
\check{\mathcal{C}}^p(\mathcal{U}, f, \mathcal{F}) =
\bigoplus\nolimits_{i_0 \ldots i_p}
f_{i_0 \ldots i_p *} \mathcal{F}_{i_0 \ldots i_p}
$$
and define differentials
$d : \check{\mathcal{C}}^p(\mathcal{U}, f, \mathcal{F})
\to \check{\mathcal{C}}^{p + 1}(\mathcal{U}, f, \mathcal{F})$
as in Cohomology, Equation (\ref{cohomology-equation-d-cech}).
\end{enumerate}
Then the complex $\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})$
is a complex of quasi-coherent sheaves on $S$ which comes equipped with an
isomorphism
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
\longrightarrow
Rf_*\mathcal{F}
$$
in $D^{+}(S)$. This isomorphism is functorial in the quasi-coherent
sheaf $\mathcal{F}$.
\end{lemma}

\begin{proof}
Consider the resolution
$\mathcal{F} \to {\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$
of Cohomology, Lemma \ref{cohomology-lemma-covering-resolution}.
We have an equality of complexes
$\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F}) =
f_*{\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$
of quasi-coherent $\mathcal{O}_S$-modules.
The morphisms $j_{i_0 \ldots i_p} : U_{i_0 \ldots i_p} \to X$
and the morphisms $f_{i_0 \ldots i_p} : U_{i_0 \ldots i_p} \to S$
are affine by Morphisms, Lemma \ref{morphisms-lemma-affine-permanence}
and Lemma \ref{lemma-affine-diagonal}.
Hence $R^qj_{i_0 \ldots i_p *}\mathcal{F}_{i_0 \ldots i_p}$
as well as $R^qf_{i_0 \ldots i_p *}\mathcal{F}_{i_0 \ldots i_p}$
are zero for $q > 0$ (Lemma \ref{lemma-relative-affine-vanishing}).
Using $f \circ j_{i_0 \ldots i_p} = f_{i_0 \ldots i_p}$ and
the spectral sequence of
Cohomology, Lemma \ref{cohomology-lemma-relative-Leray}
we conclude that
$R^qf_*(j_{i_0 \ldots i_p *}\mathcal{F}_{i_0 \ldots i_p}) = 0$
for $q > 0$.
Since the terms of the complex
${\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$ are finite direct
sums of the sheaves $j_{i_0 \ldots i_p *}\mathcal{F}_{i_0 \ldots i_p}$
we conclude using Leray's acyclicity lemma
(Derived Categories, Lemma \ref{derived-lemma-leray-acyclicity})
that
$$
Rf_* \mathcal{F} = f_*{\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F}) =
\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
$$
as desired.
\end{proof}

\noindent
Next, we are going to consider what happens if we do a base change.

\begin{lemma}
\label{lemma-base-change-complex}
With notation as in diagram (\ref{equation-base-change-diagram}).
Assume $f : X \to S$ and $\mathcal{F}$ satisfy the hypotheses of
Lemma \ref{lemma-separated-case-relative-cech}. Choose a finite
affine open covering $\mathcal{U} : X = \bigcup U_i$ of $X$.
There is a canonical isomorphism
$$
g^*\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
\longrightarrow
Rf'_*\mathcal{F}'
$$
in $D^{+}(S')$. Moreover, if $S' \to S$ is affine, then in fact
$$
g^*\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
=
\check{\mathcal{C}}^\bullet(\mathcal{U}', f', \mathcal{F}')
$$
with $\mathcal{U}' : X' = \bigcup U_i'$ where
$U_i' = (g')^{-1}(U_i) = U_{i, S'}$ is also affine.
\end{lemma}

\begin{proof}
In fact we may define $U_i' = (g')^{-1}(U_i) = U_{i, S'}$ no matter
whether $S'$ is affine over $S$ or not.
Let $\mathcal{U}' : X' = \bigcup U_i'$ be the induced covering of $X'$.
In this case we claim that
$$
g^*\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
=
\check{\mathcal{C}}^\bullet(\mathcal{U}', f', \mathcal{F}')
$$
with $\check{\mathcal{C}}^\bullet(\mathcal{U}', f', \mathcal{F}')$
defined in exactly the same manner as in
Lemma \ref{lemma-separated-case-relative-cech}.
This is clear from the case of affine morphisms
(Lemma \ref{lemma-affine-base-change}) by working locally on $S'$.
Moreover, exactly as in the proof of
Lemma \ref{lemma-separated-case-relative-cech}
one sees that there is an isomorphism
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}', f', \mathcal{F}')
\longrightarrow
Rf'_*\mathcal{F}'
$$
in $D^{+}(S')$ since the morphisms $U_i' \to X'$ and $U_i' \to S'$
are still affine (being base changes of affine morphisms).
Details omitted.
\end{proof}

\noindent
The lemma above says that the complex
$$
\mathcal{K}^\bullet = \check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
$$
is a bounded below complex of quasi-coherent sheaves on $S$ which
{\it universally} computes the higher direct images of $f : X \to S$.
This is something about this particular complex and
it is not preserved by replacing
$\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})$ by
a quasi-isomorphic complex in general! In other words, this is
not a statement that makes sense in the derived category.
The reason is that the pullback $g^*\mathcal{K}^\bullet$ is
{\it not} equal to the derived pullback $Lg^*\mathcal{K}^\bullet$
of $\mathcal{K}^\bullet$ in general!

\medskip\noindent
Here is a more general case where we can prove this statement.
We remark that the condition of $S$ being separated is harmless
in most applications, since this is usually used to prove some
local property of the total derived image.
The proof is significantly more involved and uses hypercoverings;
it is a nice example of how you can use them sometimes.

\begin{lemma}
\label{lemma-hypercoverings}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Assume that $f$ is quasi-compact and quasi-separated and
that $S$ is quasi-compact and separated.
There exists a bounded below complex $\mathcal{K}^\bullet$
of quasi-coherent $\mathcal{O}_S$-modules with the
following property: For every morphism
$g : S' \to S$ the complex $g^*\mathcal{K}^\bullet$ is
a representative for $Rf'_*\mathcal{F}'$ with notation as in
diagram (\ref{equation-base-change-diagram}).
\end{lemma}

\begin{proof}
(If $f$ is separated as well, please see
Lemma \ref{lemma-base-change-complex}.)
The assumptions imply in particular that $X$
is quasi-compact and quasi-separated as a scheme.
Let $\mathcal{B}$ be the set of affine opens of $X$. By
Hypercoverings,
Lemma \ref{hypercovering-lemma-quasi-separated-quasi-compact-hypercovering}
we can find a hypercovering $K = (I, \{U_i\})$ such that each
$I_n$ is finite and each $U_i$ is an affine open of $X$. By
Hypercoverings, Lemma \ref{hypercovering-lemma-cech-spectral-sequence}
there is a spectral sequence with $E_2$-page
$$
E_2^{p, q} = \check{H}^p(K, \underline{H}^q(\mathcal{F}))
$$
converging to $H^{p + q}(X, \mathcal{F})$. Note that
$\check{H}^p(K, \underline{H}^q(\mathcal{F}))$ is the $p$th cohomology
group of the complex
$$
\prod\nolimits_{i \in I_0} H^q(U_i, \mathcal{F})
\to
\prod\nolimits_{i \in I_1} H^q(U_i, \mathcal{F})
\to
\prod\nolimits_{i \in I_2} H^q(U_i, \mathcal{F})
\to \ldots
$$
Since each $U_i$ is affine we see that this is zero unless $q = 0$
in which case we obtain
$$
\prod\nolimits_{i \in I_0} \mathcal{F}(U_i)
\to
\prod\nolimits_{i \in I_1} \mathcal{F}(U_i)
\to
\prod\nolimits_{i \in I_2} \mathcal{F}(U_i)
\to \ldots
$$
Thus we conclude that $R\Gamma(X, \mathcal{F})$ is computed by
this complex.

\medskip\noindent
For any $n$ and $i \in I_n$ denote $f_i : U_i \to S$ the restriction of
$f$ to $U_i$. As $S$ is separated and $U_i$ is affine this morphism
is affine. Consider the complex of quasi-coherent sheaves
$$
\mathcal{K}^\bullet = (
\prod\nolimits_{i \in I_0} f_{i, *}\mathcal{F}|_{U_i}
\to
\prod\nolimits_{i \in I_1} f_{i, *}\mathcal{F}|_{U_i}
\to
\prod\nolimits_{i \in I_2} f_{i, *}\mathcal{F}|_{U_i}
\to \ldots )
$$
on $S$. As in
Hypercoverings, Lemma \ref{hypercovering-lemma-cech-spectral-sequence}
we obtain a map $\mathcal{K}^\bullet \to Rf_*\mathcal{F}$ in
$D(\mathcal{O}_S)$ by choosing an injective resolution of $\mathcal{F}$
(details omitted). Consider any affine scheme $V$ and a morphism
$g : V \to S$. Then the base change $X_V$ has a hypercovering
$K_V = (I, \{U_{i, V}\})$ obtained by base change. Moreover,
$g^*f_{i, *}\mathcal{F} = f_{i, V, *}(g')^*\mathcal{F}|_{U_{i, V}}$.
Thus the arguments above prove that $\Gamma(V, g^*\mathcal{K}^\bullet)$
computes $R\Gamma(X_V, (g')^*\mathcal{F})$.
This finishes the proof of the lemma as it suffices to prove
the equality of complexes Zariski locally on $S'$.
\end{proof}






\section{Cohomology of projective space}
\label{section-cohomology-projective-space}

\noindent
In this section we compute the cohomology of the twists of the
structure sheaf on $\mathbf{P}^n_S$ over a scheme $S$.
Recall that $\mathbf{P}^n_S$ was defined as the fibre product
$
\mathbf{P}^n_S = S \times_{\Spec(\mathbf{Z})} \mathbf{P}^n_{\mathbf{Z}}
$
in Constructions, Definition \ref{constructions-definition-projective-space}.
It was shown to be equal to
$$
\mathbf{P}^n_S = \underline{\text{Proj}}_S(\mathcal{O}_S[T_0, \ldots, T_n])
$$
in Constructions, Lemma \ref{constructions-lemma-projective-space-bundle}.
In particular, projective space is a particular case of a projective bundle.
If $S = \Spec(R)$ is affine then we have
$$
\mathbf{P}^n_S = \mathbf{P}^n_R = \text{Proj}(R[T_0, \ldots, T_n]).
$$
All these identifications are compatible and compatible with the constructions
of the twisted structure sheaves $\mathcal{O}_{\mathbf{P}^n_S}(d)$.

\medskip\noindent
Before we state the result we need some notation.
Let $R$ be a ring.
Recall that $R[T_0, \ldots, T_n]$ is a graded
$R$-algebra where each $T_i$ is homogeneous of degree $1$.
Denote $(R[T_0, \ldots, T_n])_d$ the degree $d$ summand.
It is a finite free $R$-module of rank $\binom{n + d}{d}$
when $d \geq 0$ and zero else.
It has a basis consisting of monomials $T_0^{e_0} \ldots T_n^{e_n}$
with $\sum e_i = d$. We will also use the following notation:
$R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]$ denotes the $\mathbf{Z}$-graded
ring with $\frac{1}{T_i}$ in degree $-1$. In particular the
$\mathbf{Z}$-graded $R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]$ module
$$
\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]
$$
which shows up in the statement below is zero in degrees
$\geq -n$, is free on the generator $\frac{1}{T_0 \ldots T_n}$
in degree $-n - 1$ and is free of rank $(-1)^n\binom{n + d}{d}$ for
$d \leq -n - 1$.

\begin{lemma}
\label{lemma-cohomology-projective-space-over-ring}
\begin{reference}
\cite[III Proposition 2.1.12]{EGA}
\end{reference}
Let $R$ be a ring.
Let $n \geq 0$ be an integer.
We have
$$
H^q(\mathbf{P}^n, \mathcal{O}_{\mathbf{P}^n_R}(d)) =
\left\{
\begin{matrix}
(R[T_0, \ldots, T_n])_d & \text{if} & q = 0 \\
0 & \text{if} & q \not = 0, n \\
\left(\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]\right)_d
& \text{if} & q = n
\end{matrix}
\right.
$$
as $R$-modules.
\end{lemma}

\begin{proof}
We will use the standard affine open covering
$$
\mathcal{U} : \mathbf{P}^n_R = \bigcup\nolimits_{i = 0}^n D_{+}(T_i)
$$
to compute the cohomology using the {\v C}ech complex.
This is permissible by Lemma \ref{lemma-cech-cohomology-quasi-coherent}
since any intersection of finitely many affine $D_{+}(T_i)$ is also a
standard affine open (see
Constructions, Section \ref{constructions-section-proj}).
In fact, we can use the alternating or ordered {\v C}ech complex according to
Cohomology, Lemmas \ref{cohomology-lemma-ordered-alternating} and
\ref{cohomology-lemma-alternating-usual}.

\medskip\noindent
The ordering we will use on $\{0, \ldots, n\}$ is the usual one.
Hence the complex we are looking at has terms
$$
\check{\mathcal{C}}_{ord}^p(\mathcal{U}, \mathcal{O}_{\mathbf{P}_R}(d))
=
\bigoplus\nolimits_{i_0 < \ldots < i_p}
(R[T_0, \ldots, T_n, \frac{1}{T_{i_0} \ldots T_{i_p}}])_d
$$
Moreover, the maps are given by the usual formula
$$
d(s)_{i_0 \ldots i_{p + 1}} =
\sum\nolimits_{j = 0}^{p + 1} (-1)^j s_{i_0 \ldots \hat i_j \ldots i_{p + 1}}
$$
see Cohomology, Section \ref{cohomology-section-alternating-cech}.
Note that each term of this complex has a natural
$\mathbf{Z}^{n + 1}$-grading. Namely, we get this by declaring a monomial
$T_0^{e_0} \ldots T_n^{e_n}$ to be homogeneous with weight
$(e_0, \ldots, e_n) \in \mathbf{Z}^{n + 1}$. It is clear that the differential
given above respects the grading. In a formula we have
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{O}_{\mathbf{P}_R}(d))
=
\bigoplus\nolimits_{\vec{e} \in \mathbf{Z}^{n + 1}}
\check{\mathcal{C}}^\bullet(\vec{e})
$$
where not all summands on the right hand side occur (see below).
Hence in order to compute the cohomology
modules of the complex it suffices to compute the cohomology of the graded
pieces and take the direct sum at the end.

\medskip\noindent
Fix $\vec{e} = (e_0, \ldots, e_n) \in \mathbf{Z}^{n + 1}$. In order for this
weight to occur in the complex above we need to assume
$e_0 + \ldots + e_n = d$ (if not then it occurs for a different twist of
the structure sheaf of course). Assuming this, set
$$
NEG(\vec{e}) = \{i \in \{0, \ldots, n\} \mid e_i < 0\}.
$$
With this notation the weight $\vec{e}$ summand
$\check{\mathcal{C}}^\bullet(\vec{e})$ of the {\v C}ech complex above has
the following terms
$$
\check{\mathcal{C}}^p(\vec{e})
=
\bigoplus\nolimits_{i_0 < \ldots < i_p,
\ NEG(\vec{e}) \subset \{i_0, \ldots, i_p\}}
R \cdot T_0^{e_0} \ldots T_n^{e_n}
$$
In other words, the terms corresponding to $i_0 < \ldots < i_p$ such
that $NEG(\vec{e})$ is not contained in $\{i_0 \ldots i_p\}$ are zero.
The differential of the complex $\check{\mathcal{C}}^\bullet(\vec{e})$
is still given by the exact same formula as above.

\medskip\noindent
Suppose that $NEG(\vec{e}) = \{0, \ldots, n\}$, i.e., that all
exponents $e_i$ are negative.
In this case the complex $\check{\mathcal{C}}^\bullet(\vec{e})$ has
only one term, namely $\check{\mathcal{C}}^n(\vec{e}) =
R \cdot \frac{1}{T_0^{-e_0} \ldots T_n^{-e_n}}$. Hence in this
case
$$
H^q(\check{\mathcal{C}}^\bullet(\vec{e})) =
\left\{
\begin{matrix}
R \cdot \frac{1}{T_0^{-e_0} \ldots T_n^{-e_n}} & \text{if} & q = n \\
0 & \text{if} & \text{else}
\end{matrix}
\right.
$$
The direct sum of all of these terms clearly gives the value
$$
\left(\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]\right)_d
$$
in degree $n$ as stated in the lemma. Moreover these terms do not contribute
to cohomology in other degrees (also in accordance with the statement of the
lemma).

\medskip\noindent
Assume $NEG(\vec{e}) = \emptyset$. In this case the complex
$\check{\mathcal{C}}^\bullet(\vec{e})$ has a summand $R$ corresponding
to all $i_0 < \ldots < i_p$.
Let us compare the complex $\check{\mathcal{C}}^\bullet(\vec{e})$
to another complex. Namely, consider the affine open covering
$$
\mathcal{V} : \Spec(R) = \bigcup\nolimits_{i \in \{0, \ldots, n\}} V_i
$$
where $V_i = \Spec(R)$ for all $i$. Consider the alternating
{\v C}ech complex
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{V}, \mathcal{O}_{\Spec(R)})
$$
By the same reasoning as above this computes the cohomology of the
structure sheaf on $\Spec(R)$. Hence we see that
$H^p(
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{V}, \mathcal{O}_{\Spec(R)})
) = R$ if $p = 0$ and is $0$ whenever $p > 0$.
For these facts, see
Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial} and its proof.
Note that also
$\check{\mathcal{C}}_{ord}^\bullet(\mathcal{V}, \mathcal{O}_{\Spec(R)})$
has a summand $R$ for every $i_0 < \ldots < i_p$ and has exactly the same
differential as $\check{\mathcal{C}}^\bullet(\vec{e})$. In other words
these complexes are isomorphic complexes and hence have the same cohomology.
We conclude that
$$
H^q(\check{\mathcal{C}}^\bullet(\vec{e})) =
\left\{
\begin{matrix}
R \cdot T_0^{e_0} \ldots T_n^{e_n} & \text{if} & q = 0 \\
0 & \text{if} & \text{else}
\end{matrix}
\right.
$$
in the case that $NEG(\vec{e}) = \emptyset$.
The direct sum of all of these terms clearly gives the value
$$
(R[T_0, \ldots, T_n])_d
$$
in degree $0$ as stated in the lemma. Moreover these terms do not contribute
to cohomology in other degrees (also in accordance with the statement of the
lemma).

\medskip\noindent
To finish the proof of the lemma we have to show that the complexes
$\check{\mathcal{C}}^\bullet(\vec{e})$ are acyclic when
$NEG(\vec{e})$ is neither empty nor equal to $\{0, \ldots, n\}$.
Pick an index $i_{\text{fix}} \not \in NEG(\vec{e})$ (such an index exists).
Consider the map
$$
h :
\check{\mathcal{C}}^{p + 1}(\vec{e})
\to
\check{\mathcal{C}}^p(\vec{e})
$$
given by the rule
$$
h(s)_{i_0 \ldots i_p} = s_{i_{\text{fix}} i_0 \ldots i_p}
$$
(compare with the proof of
Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial}).
It is clear that this is well defined since
$$
NEG(\vec{e}) \subset \{i_0, \ldots, i_p\}
\Leftrightarrow
NEG(\vec{e}) \subset \{i_{\text{fix}}, i_0, \ldots, i_p\}
$$
Also $\check{\mathcal{C}}^0(\vec{e}) = 0$ so that this
formula does work for all $p$ including $p = - 1$.
The exact same (combinatorial) computation as in the
proof of Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial}
shows that
$$
(hd + dh)(s)_{i_0 \ldots i_p}
=
s_{i_0 \ldots i_p}
$$
Hence we see that the identity map of the complex
$\check{\mathcal{C}}^\bullet(\vec{e})$ is homotopic to zero
which implies that it is acyclic.
\end{proof}

\noindent
In the following lemma we are going to use the pairing of free
$R$-modules
$$
R[T_0, \ldots, T_n]
\times
\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]
\longrightarrow
R
$$
which is defined by the rule
$$
(f, g)
\longmapsto
\text{coefficient of }
\frac{1}{T_0 \ldots T_n}
\text{ in }fg.
$$
In other words, the basis element $T_0^{e_0} \ldots T_n^{e_n}$ pairs
with the basis element $T_0^{d_0} \ldots T_n^{d_n}$ to give $1$ if and only
if $e_i + d_i = -1$ for all $i$, and pairs to zero in all other cases.
Using this pairing we get an identification
$$
\left(\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]\right)_d
=
\Hom_R((R[T_0, \ldots, T_n])_{-n - 1 - d}, R)
$$
Thus we can reformulate the result of
Lemma \ref{lemma-cohomology-projective-space-over-ring} as saying that
\begin{equation}
\label{equation-identify}
H^q(\mathbf{P}^n, \mathcal{O}_{\mathbf{P}^n_R}(d)) =
\left\{
\begin{matrix}
(R[T_0, \ldots, T_n])_d & \text{if} & q = 0 \\
0 & \text{if} & q \not = 0, n \\
\Hom_R((R[T_0, \ldots, T_n])_{-n - 1 - d}, R)
& \text{if} & q = n
\end{matrix}
\right.
\end{equation}

\begin{lemma}
\label{lemma-identify-functorially}
The identifications of Equation (\ref{equation-identify}) are
compatible with base change w.r.t.\ ring maps $R \to R'$.
Moreover, for any $f \in R[T_0, \ldots, T_n]$ homogeneous
of degree $m$ the map multiplication by $f$
$$
\mathcal{O}_{\mathbf{P}^n_R}(d)
\longrightarrow
\mathcal{O}_{\mathbf{P}^n_R}(d + m)
$$
induces the map on the cohomology group via the identifications
of Equation (\ref{equation-identify}) which is multiplication by
$f$ for $H^0$ and the contragredient of multiplication by $f$
$$
(R[T_0, \ldots, T_n])_{-n - 1 - (d + m)}
\longrightarrow
(R[T_0, \ldots, T_n])_{-n - 1 - d}
$$
on $H^n$.
\end{lemma}

\begin{proof}
Suppose that $R \to R'$ is a ring map.
Let $\mathcal{U}$ be the standard affine open covering of $\mathbf{P}^n_R$,
and let $\mathcal{U}'$ be the standard affine open covering of
$\mathbf{P}^n_{R'}$. Note that $\mathcal{U}'$ is the pullback of the covering
$\mathcal{U}$ under the canonical morphism
$\mathbf{P}^n_{R'} \to \mathbf{P}^n_R$. Hence there
is a map of {\v C}ech complexes
$$
\gamma :
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U},
\mathcal{O}_{\mathbf{P}_R}(d))
\longrightarrow
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}',
\mathcal{O}_{\mathbf{P}_{R'}}(d))
$$
which is compatible with the map on cohomology by
Cohomology, Lemma \ref{cohomology-lemma-functoriality-cech}.
It is clear from the computations in the proof of
Lemma \ref{lemma-cohomology-projective-space-over-ring}
that this map of {\v C}ech complexes is compatible with the identifications
of the cohomology groups in question. (Namely the basis elements for
the {\v C}ech complex over $R$ simply map to the corresponding basis elements
for the {\v C}ech complex over $R'$.) Whence the first statement of the lemma.

\medskip\noindent
Now fix the ring $R$ and consider two homogeneous polynomials
$f, g \in R[T_0, \ldots, T_n]$ both of the same degree $m$.
Since cohomology is an additive functor, it is clear that the
map induced by multiplication by $f + g$ is the same as the sum
of the maps induced by multiplication by $f$ and the map induced
by multiplication by $g$. Moreover, since cohomology is a functor,
a similar result holds for multiplication by a product $fg$ where
$f, g$ are both homogeneous (but not necessarily of the same degree).
Hence to verify the second statement of the lemma it suffices to
prove this when $f = x \in R$ or when $f = T_i$.
In the case of multiplication by an element $x \in R$ the result
follows since every cohomology groups or complex in sight has the
structure of an $R$-module or complex of $R$-modules.
Finally, we consider the case of multiplication by $T_i$
as a $\mathcal{O}_{\mathbf{P}^n_R}$-linear map
$$
\mathcal{O}_{\mathbf{P}^n_R}(d)
\longrightarrow
\mathcal{O}_{\mathbf{P}^n_R}(d + 1)
$$
The statement on $H^0$ is clear. For the statement on $H^n$
consider multiplication by $T_i$ as a map on {\v C}ech complexes
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U},
\mathcal{O}_{\mathbf{P}_R}(d))
\longrightarrow
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U},
\mathcal{O}_{\mathbf{P}_R}(d + 1))
$$
We are going to use the notation introduced in the proof of
Lemma \ref{lemma-cohomology-projective-space-over-ring}.
We consider the effect of multiplication by $T_i$
in terms of the decompositions
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{O}_{\mathbf{P}_R}(d))
=
\bigoplus\nolimits_{\vec{e} \in \mathbf{Z}^{n + 1}, \ \sum e_i = d}
\check{\mathcal{C}}^\bullet(\vec{e})
$$
and
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U},
\mathcal{O}_{\mathbf{P}_R}(d + 1))
=
\bigoplus\nolimits_{\vec{e} \in \mathbf{Z}^{n + 1}, \ \sum e_i = d + 1}
\check{\mathcal{C}}^\bullet(\vec{e})
$$
It is clear that it maps the subcomplex
$\check{\mathcal{C}}^\bullet(\vec{e})$ to the subcomplex
$\check{\mathcal{C}}^\bullet(\vec{e} + \vec{b}_i)$ where
$\vec{b}_i = (0, \ldots, 0, 1, 0, \ldots, 0))$ the $i$th basis vector.
In other words, it maps the summand of $H^n$ corresponding to
$\vec{e}$ with $e_i < 0$ and $\sum e_i = d$
to the summand of $H^n$ corresponding to
$\vec{e} + \vec{b}_i$ (which is zero if $e_i + b_i \geq 0$).
It is easy to see that this corresponds exactly to the action
of the contragredient of multiplication by $T_i$ as a map
$$
(R[T_0, \ldots, T_n])_{-n - 1 - (d + 1)}
\longrightarrow
(R[T_0, \ldots, T_n])_{-n - 1 - d}
$$
This proves the lemma.
\end{proof}

\noindent
Before we state the relative version we need some notation.
Namely, recall that $\mathcal{O}_S[T_0, \ldots, T_n]$ is a graded
$\mathcal{O}_S$-module where each $T_i$ is homogeneous of degree $1$.
Denote $(\mathcal{O}_S[T_0, \ldots, T_n])_d$ the degree $d$ summand.
It is a finite locally free sheaf of rank $\binom{n + d}{d}$ on $S$.

\begin{lemma}
\label{lemma-cohomology-projective-space-over-base}
Let $S$ be a scheme.
Let $n \geq 0$ be an integer.
Consider the structure morphism
$$
f : \mathbf{P}^n_S \longrightarrow S.
$$
We have
$$
R^qf_*(\mathcal{O}_{\mathbf{P}^n_S}(d)) =
\left\{
\begin{matrix}
(\mathcal{O}_S[T_0, \ldots, T_n])_d & \text{if} & q = 0 \\
0 & \text{if} & q \not = 0, n \\
\SheafHom_{\mathcal{O}_S}(
(\mathcal{O}_S[T_0, \ldots, T_n])_{- n - 1 - d}, \mathcal{O}_S)
& \text{if} & q = n
\end{matrix}
\right.
$$
\end{lemma}

\begin{proof}
Omitted. Hint: This follows since the identifications in
(\ref{equation-identify}) are compatible with affine base change
by Lemma \ref{lemma-identify-functorially}.
\end{proof}

\noindent
Next we state the version for projective bundles associated to finite locally
free sheaves. Let $S$ be a scheme. Let $\mathcal{E}$ be a finite locally
free $\mathcal{O}_S$-module of constant rank $n + 1$, see
Modules, Section \ref{modules-section-locally-free}.
In this case we think of $\text{Sym}(\mathcal{E})$ as a graded
$\mathcal{O}_S$-module where $\mathcal{E}$ is the graded part of degree $1$.
And $\text{Sym}^d(\mathcal{E})$ is the degree $d$ summand.
It is a finite locally free sheaf of rank $\binom{n + d}{d}$ on $S$.
Recall that our normalization is that
$$
\pi :
\mathbf{P}(\mathcal{E})
=
\underline{\text{Proj}}_S(\text{Sym}(\mathcal{E}))
\longrightarrow
S
$$
and that there are natural maps
$\text{Sym}^d(\mathcal{E}) \to \pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)$.

\begin{lemma}
\label{lemma-cohomology-projective-bundle}
Let $S$ be a scheme. Let $n \geq 1$.
Let $\mathcal{E}$ be a finite locally
free $\mathcal{O}_S$-module of constant rank $n + 1$.
Consider the structure morphism
$$
\pi : \mathbf{P}(\mathcal{E}) \longrightarrow S.
$$
We have
$$
R^q\pi_*(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)) =
\left\{
\begin{matrix}
\text{Sym}^d(\mathcal{E}) & \text{if} & q = 0 \\
0 & \text{if} & q \not = 0, n \\
\SheafHom_{\mathcal{O}_S}(
\text{Sym}^{- n - 1 - d}(\mathcal{E})
\otimes_{\mathcal{O}_S}
\wedge^{n + 1}\mathcal{E},
\mathcal{O}_S)
& \text{if} & q = n
\end{matrix}
\right.
$$
These identifications are compatible with base change and
isomorphism between locally free sheaves.
\end{lemma}

\begin{proof}
Consider the canonical map
$$
\pi^*\mathcal{E} \longrightarrow \mathcal{O}_{\mathbf{P}(\mathcal{E})}(1)
$$
and twist down by $1$ to get
$$
\pi^*(\mathcal{E})(-1) \longrightarrow \mathcal{O}_{\mathbf{P}(\mathcal{E})}
$$
This is a surjective map from a locally free rank $n + 1$ sheaf onto
the structure sheaf. Hence the corresponding Koszul complex is
exact (More on Algebra, Lemma
\ref{more-algebra-lemma-homotopy-koszul-abstract}).
In other words there is an exact complex
$$
0 \to
\pi^*(\wedge^{n + 1}\mathcal{E})(-n - 1) \to
\ldots \to
\pi^*(\wedge^i\mathcal{E})(-i) \to
\ldots \to
\pi^*\mathcal{E}(-1) \to
\mathcal{O}_{\mathbf{P}(\mathcal{E})} \to 0
$$
We will think of the term $\pi^*(\wedge^i\mathcal{E})(-i)$ as being
in degree $-i$.
We are going to compute the higher direct images
of this acyclic complex using the first spectral sequence of
Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor}.
Namely, we see that there is a spectral sequence with terms
$$
E_1^{p, q} = R^q\pi_*\left(\pi^*(\wedge^{-p}\mathcal{E})(p)\right)
$$
converging to zero! By the projection formula
(Cohomology, Lemma \ref{cohomology-lemma-projection-formula})
we have
$$
E_1^{p, q} = \wedge^{-p} \mathcal{E} \otimes_{\mathcal{O}_S}
R^q\pi_*\left(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(p)\right).
$$
Note that locally on $S$ the sheaf $\mathcal{E}$ is trivial,
i.e., isomorphic to $\mathcal{O}_S^{\oplus n + 1}$, hence locally on
$S$ the morphism $\mathbf{P}(\mathcal{E}) \to S$ can be identified
with $\mathbf{P}^n_S \to S$. Hence
locally on $S$ we can use the result of Lemmas
\ref{lemma-cohomology-projective-space-over-ring},
\ref{lemma-identify-functorially}, or
\ref{lemma-cohomology-projective-space-over-base}.
It follows that $E_1^{p, q} = 0$ unless $(p, q)$ is $(0, 0)$
or $(-n - 1, n)$. The nonzero terms are
\begin{align*}
E_1^{0, 0} & = \pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})} = \mathcal{O}_S \\
E_1^{-n - 1, n} & =
R^n\pi_*\left(\pi^*(\wedge^{n + 1}\mathcal{E})(-n - 1)\right) =
\wedge^{n + 1}\mathcal{E} \otimes_{\mathcal{O}_S}
R^n\pi_*\left(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1)\right)
\end{align*}
Hence there can only be one nonzero
differential in the spectral sequence namely the map
$d_{n + 1}^{-n - 1, n} : E_{n + 1}^{-n - 1, n} \to E_{n + 1}^{0, 0}$
which has to be an isomorphism (because the spectral sequence converges
to the $0$ sheaf). Thus $E_1^{p, q} = E_{n + 1}^{p, q}$ and
we obtain a canonical isomorphism
$$
\wedge^{n + 1}\mathcal{E} \otimes_{\mathcal{O}_S}
R^n\pi_*\left(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1)\right) =
R^n\pi_*\left(\pi^*(\wedge^{n + 1}\mathcal{E})(-n - 1)\right)
\xrightarrow{d_{n + 1}^{-n - 1, n}}
\mathcal{O}_S
$$
Since $\wedge^{n + 1}\mathcal{E}$ is an invertible
sheaf, this implies that
$R^n\pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1)$ is invertible
as well and canonically isomorphic to the inverse of
$\wedge^{n + 1}\mathcal{E}$. In other words we have proved the case
$d = - n - 1$ of the lemma.

\medskip\noindent
Working locally on $S$ we see immediately from the computation of
cohomology in Lemmas \ref{lemma-cohomology-projective-space-over-ring},
\ref{lemma-identify-functorially}, or
\ref{lemma-cohomology-projective-space-over-base} the statements on
vanishing of the lemma. Moreover the result on $R^0\pi_*$ is clear
as well, since there are canonical maps
$\text{Sym}^d(\mathcal{E}) \to \pi_* \mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)$
for all $d$. It remains to show that the description of
$R^n\pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)$ is correct
for $d < -n - 1$. In order to do this we consider the map
$$
\pi^*(\text{Sym}^{-d - n - 1}(\mathcal{E}))
\otimes_{\mathcal{O}_{\mathbf{P}(\mathcal{E})}}
\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)
\longrightarrow
\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1)
$$
Applying $R^n\pi_*$ and the projection formula (see above) we get a map
$$
\text{Sym}^{-d - n - 1}(\mathcal{E})
\otimes_{\mathcal{O}_S}
R^n\pi_*(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d))
\longrightarrow
R^n\pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1) =
(\wedge^{n + 1}\mathcal{E})^{\otimes -1}
$$
(the last equality we have shown above).
Again by the local calculations of Lemmas
\ref{lemma-cohomology-projective-space-over-ring},
\ref{lemma-identify-functorially}, or
\ref{lemma-cohomology-projective-space-over-base}
it follows that this map induces a perfect pairing between
$R^n\pi_*(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d))$ and
$\text{Sym}^{-d - n - 1}(\mathcal{E}) \otimes \wedge^{n + 1}(\mathcal{E})$
as desired.
\end{proof}

















\section{Coherent sheaves on locally Noetherian schemes}
\label{section-coherent-sheaves}

\noindent
We have defined the notion of a coherent module on any ringed space in
Modules, Section \ref{modules-section-coherent}.
Although it is possible to consider coherent sheaves on non-Noetherian
schemes we will always assume the base scheme is locally Noetherian when
we consider coherent sheaves. Here is a characterization of coherent
sheaves on locally Noetherian schemes.

\begin{lemma}
\label{lemma-coherent-Noetherian}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is coherent,
\item $\mathcal{F}$ is a quasi-coherent, finite type $\mathcal{O}_X$-module,
\item $\mathcal{F}$ is a finitely presented $\mathcal{O}_X$-module,
\item for any affine open $\Spec(A) = U \subset X$ we have
$\mathcal{F}|_U = \widetilde M$ with $M$ a finite $A$-module, and
\item there exists an affine open covering $X = \bigcup U_i$,
$U_i = \Spec(A_i)$ such that each
$\mathcal{F}|_{U_i} = \widetilde M_i$ with $M_i$ a finite $A_i$-module.
\end{enumerate}
In particular $\mathcal{O}_X$ is coherent, any invertible
$\mathcal{O}_X$-module is coherent, and more generally any
finite locally free $\mathcal{O}_X$-module is coherent.
\end{lemma}

\begin{proof}
The implications (1) $\Rightarrow$ (2) and (1) $\Rightarrow$ (3) hold
in general, see
Modules, Lemma \ref{modules-lemma-coherent-finite-presentation}.
If $\mathcal{F}$ is finitely presented then $\mathcal{F}$ is
quasi-coherent, see
Modules, Lemma \ref{modules-lemma-finite-presentation-quasi-coherent}.
Hence also (3) $\Rightarrow$ (2).

\medskip\noindent
Assume $\mathcal{F}$ is a quasi-coherent, finite type $\mathcal{O}_X$-module.
By
Properties, Lemma \ref{properties-lemma-finite-type-module}
we see that on any affine open
$\Spec(A) = U \subset X$ we have $\mathcal{F}|_U = \widetilde M$
with $M$ a finite $A$-module. Since $A$ is Noetherian we see that
$M$ has a finite resolution
$$
A^{\oplus m} \to A^{\oplus n} \to M \to 0.
$$
Hence $\mathcal{F}$ is of finite presentation by
Properties, Lemma \ref{properties-lemma-finite-presentation-module}.
In other words (2) $\Rightarrow$ (3).

\medskip\noindent
By Modules, Lemma \ref{modules-lemma-coherent-structure-sheaf} it suffices
to show that $\mathcal{O}_X$ is coherent in order to show that (3)
implies (1). Thus we have to show: given any open $U \subset X$ and
any finite collection of sections $f_i \in \mathcal{O}_X(U)$,
$i = 1, \ldots, n$ the kernel of the map
$\bigoplus_{i = 1, \ldots, n} \mathcal{O}_U \to \mathcal{O}_U$
is of finite type. Since being of finite type is a local property
it suffices to check this in a neighbourhood of any $x \in U$.
Thus we may assume $U = \Spec(A)$ is affine. In this case
$f_1, \ldots, f_n \in A$ are elements of $A$. Since $A$ is
Noetherian, see
Properties, Lemma \ref{properties-lemma-locally-Noetherian}
the kernel $K$ of the map $\bigoplus_{i = 1, \ldots, n} A \to A$
is a finite $A$-module. See for example
Algebra, Lemma \ref{algebra-lemma-Noetherian-basic}.
As the functor\ $\widetilde{ }$\ is exact, see
Schemes, Lemma \ref{schemes-lemma-spec-sheaves}
we get an exact sequence
$$
\widetilde K \to
\bigoplus\nolimits_{i = 1, \ldots, n} \mathcal{O}_U \to
\mathcal{O}_U
$$
and by
Properties, Lemma \ref{properties-lemma-finite-type-module}
again we see that $\widetilde K$ is of finite type. We conclude
that (1), (2) and (3) are all equivalent.

\medskip\noindent
It follows from
Properties, Lemma \ref{properties-lemma-finite-type-module}
that (2) implies (4). It is trivial that (4) implies (5).
The discussion in
Schemes, Section \ref{schemes-section-quasi-coherent}
show that (5) implies
that $\mathcal{F}$ is quasi-coherent and it is clear that (5)
implies that $\mathcal{F}$ is of finite type. Hence (5) implies
(2) and we win.
\end{proof}

\begin{lemma}
\label{lemma-coherent-abelian-Noetherian}
Let $X$ be a locally Noetherian scheme.
The category of coherent $\mathcal{O}_X$-modules is abelian.
More precisely, the kernel and cokernel of a map of coherent
$\mathcal{O}_X$-modules are coherent. Any extension
of coherent sheaves is coherent.
\end{lemma}

\begin{proof}
This is a restatement of
Modules, Lemma \ref{modules-lemma-coherent-abelian}
in a particular case.
\end{proof}

\noindent
The following lemma does not always hold for the category of coherent
$\mathcal{O}_X$-modules on a general ringed space $X$.

\begin{lemma}
\label{lemma-coherent-Noetherian-quasi-coherent-sub-quotient}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Any quasi-coherent submodule of $\mathcal{F}$ is coherent.
Any quasi-coherent quotient module of $\mathcal{F}$ is coherent.
\end{lemma}

\begin{proof}
We may assume that $X$ is affine, say $X = \Spec(A)$.
Properties, Lemma \ref{properties-lemma-locally-Noetherian}
implies that $A$ is Noetherian. Lemma \ref{lemma-coherent-Noetherian}
turns this into algebra. The algebraic counter part of
the lemma is that a quotient, or a submodule of a finite $A$-module
is a finite $A$-module, see for example
Algebra, Lemma \ref{algebra-lemma-Noetherian-basic}.
\end{proof}

\begin{lemma}
\label{lemma-tensor-hom-coherent}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules.
The $\mathcal{O}_X$-modules $\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{G}$
and $\SheafHom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})$ are
coherent.
\end{lemma}

\begin{proof}
It is shown in
Modules, Lemma \ref{modules-lemma-internal-hom-locally-kernel-direct-sum} that
$\SheafHom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})$ is coherent.
The result for tensor products is
Modules, Lemma \ref{modules-lemma-tensor-product-permanence}
\end{proof}

\begin{lemma}
\label{lemma-local-isomorphism}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules.
Let $\varphi : \mathcal{G} \to \mathcal{F}$ be a homomorphism
of $\mathcal{O}_X$-modules. Let $x \in X$.
\begin{enumerate}
\item If $\mathcal{F}_x = 0$ then there exists an open neighbourhood
$U \subset X$ of $x$ such that $\mathcal{F}|_U = 0$.
\item If $\varphi_x : \mathcal{G}_x \to \mathcal{F}_x$ is injective,
then there exists an open neighbourhood $U \subset X$ of $x$ such that
$\varphi|_U$ is injective.
\item If $\varphi_x : \mathcal{G}_x \to \mathcal{F}_x$ is surjective,
then there exists an open neighbourhood $U \subset X$ of $x$ such that
$\varphi|_U$ is surjective.
\item If $\varphi_x : \mathcal{G}_x \to \mathcal{F}_x$ is bijective,
then there exists an open neighbourhood $U \subset X$ of $x$ such that
$\varphi|_U$ is an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
See Modules, Lemmas
\ref{modules-lemma-finite-type-surjective-on-stalk},
\ref{modules-lemma-finite-type-stalk-zero}, and
\ref{modules-lemma-finite-type-to-coherent-injective-on-stalk}.
\end{proof}

\begin{lemma}
\label{lemma-map-stalks-local-map}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules.
Let $x \in X$.
Suppose $\psi : \mathcal{G}_x \to \mathcal{F}_x$ is a map of
$\mathcal{O}_{X, x}$-modules.
Then there exists an open neighbourhood $U \subset X$ of $x$ and a map
$\varphi : \mathcal{G}|_U \to \mathcal{F}|_U$ such that
$\varphi_x = \psi$.
\end{lemma}

\begin{proof}
In view of Lemma \ref{lemma-coherent-Noetherian}
this is a reformulation of
Modules, Lemma \ref{modules-lemma-stalk-internal-hom}.
\end{proof}

\begin{lemma}
\label{lemma-coherent-support-closed}
Let $X$ be a locally Noetherian scheme. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_X$-module. Then $\text{Supp}(\mathcal{F})$ is closed, and
$\mathcal{F}$ comes from a coherent sheaf on the scheme theoretic support
of $\mathcal{F}$, see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-support}.
\end{lemma}

\begin{proof}
Let $i : Z \to X$ be the scheme theoretic support of $\mathcal{F}$ and
let $\mathcal{G}$ be the finite type quasi-coherent sheaf on $Z$
such that $i_*\mathcal{G} \cong \mathcal{F}$.
Since $Z = \text{Supp}(\mathcal{F})$ we see that the support is closed.
The scheme $Z$ is locally Noetherian by
Morphisms, Lemmas \ref{morphisms-lemma-immersion-locally-finite-type}
and \ref{morphisms-lemma-finite-type-noetherian}.
Finally, $\mathcal{G}$ is a coherent $\mathcal{O}_Z$-module by
Lemma \ref{lemma-coherent-Noetherian}
\end{proof}

\begin{lemma}
\label{lemma-i-star-equivalence}
Let $i : Z \to X$ be a closed immersion of locally Noetherian schemes.
Let $\mathcal{I} \subset \mathcal{O}_X$ be the quasi-coherent sheaf of ideals
cutting out $Z$. The functor $i_*$ induces an equivalence between the
category of coherent $\mathcal{O}_X$-modules annihilated by $\mathcal{I}$
and the category of coherent $\mathcal{O}_Z$-modules.
\end{lemma}

\begin{proof}
The functor is fully faithful by
Morphisms, Lemma \ref{morphisms-lemma-i-star-equivalence}.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module
annihilated by $\mathcal{I}$. By
Morphisms, Lemma \ref{morphisms-lemma-i-star-equivalence}
we can write $\mathcal{F} = i_*\mathcal{G}$ for some quasi-coherent
sheaf $\mathcal{G}$ on $Z$. By
Modules, Lemma \ref{modules-lemma-i-star-reflects-finite-type}
we see that $\mathcal{G}$ is of finite type.
Hence $\mathcal{G}$ is coherent by
Lemma \ref{lemma-coherent-Noetherian}.
Thus the functor is also essentially surjective as desired.
\end{proof}

\begin{lemma}
\label{lemma-finite-pushforward-coherent}
Let $f : X \to Y$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume $f$ is finite and $Y$ locally Noetherian.
Then $R^pf_*\mathcal{F} = 0$ for $p > 0$ and
$f_*\mathcal{F}$ is coherent if $\mathcal{F}$ is coherent.
\end{lemma}

\begin{proof}
The higher direct images vanish by
Lemma \ref{lemma-relative-affine-vanishing} and because
a finite morphism is affine (by definition).
Note that the assumptions imply that also $X$ is locally Noetherian
(see Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian})
and hence the statement makes sense.
Let $\Spec(A) = V \subset Y$ be an affine open subset.
By Morphisms, Definition \ref{morphisms-definition-integral}
we see that $f^{-1}(V) = \Spec(B)$ with $A \to B$ finite.
Lemma \ref{lemma-coherent-Noetherian}
turns the statement of the lemma into the following algebra
fact: If $M$ is a finite $B$-module, then $M$ is also finite
viewed as a $A$-module, see
Algebra, Lemma \ref{algebra-lemma-finite-module-over-finite-extension}.
\end{proof}

\noindent
In the situation of the lemma also the higher direct images are
coherent since they vanish.
We will show that this is always the case for a proper morphism
between locally Noetherian schemes (insert future reference here).

\begin{lemma}
\label{lemma-coherent-support-dimension-0}
Let $X$ be a locally Noetherian scheme. Let $\mathcal{F}$
be a coherent sheaf with $\dim(\text{Supp}(\mathcal{F})) \leq 0$.
Then $\mathcal{F}$ is generated by global sections and
$H^i(X, \mathcal{F}) = 0$ for $i > 0$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-coherent-support-closed} we see that
$\mathcal{F} = i_*\mathcal{G}$ where $i : Z \to X$ is the inclusion
of the scheme theoretic support of $\mathcal{F}$ and where $\mathcal{G}$
is a coherent $\mathcal{O}_Z$-module. Since the dimension of $Z$ is
$0$, we see $Z$ is a disjoint union of affines (Properties, Lemma
\ref{properties-lemma-locally-Noetherian-dimension-0}).
Hence $\mathcal{G}$ is globally generated and the higher
cohomology groups of $\mathcal{G}$ are zero
(Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}).
Hence $\mathcal{F} = i_*\mathcal{G}$ is globally generated.
Since the cohomologies of $\mathcal{F}$ and $\mathcal{G}$ agree
(Lemma \ref{lemma-relative-affine-cohomology} applies as a
closed immersion is affine)
we conclude that the higher cohomology groups of $\mathcal{F}$ are zero.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-coherent-on-open}
Let $X$ be a scheme. Let $j : U \to X$ be the inclusion of an open.
Let $T \subset X$ be a closed subset contained in $U$.
If $\mathcal{F}$ is a coherent $\mathcal{O}_U$-module
with $\text{Supp}(\mathcal{F}) \subset T$, then
$j_*\mathcal{F}$ is a coherent $\mathcal{O}_X$-module.
\end{lemma}

\begin{proof}
Consider the open covering $X = U \cup (X \setminus T)$.
Then $j_*\mathcal{F}|_U = \mathcal{F}$ is coherent and
$j_*\mathcal{F}|_{X \setminus T} = 0$ is also coherent.
Hence $j_*\mathcal{F}$ is coherent.
\end{proof}














\section{Coherent sheaves on Noetherian schemes}
\label{section-coherent-quasi-compact}

\noindent
In this section we mention some properties of coherent sheaves on
Noetherian schemes.

\begin{lemma}
\label{lemma-acc-coherent}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
The ascending chain condition holds for quasi-coherent submodules
of $\mathcal{F}$. In other words, given any sequence
$$
\mathcal{F}_1 \subset \mathcal{F}_2 \subset \ldots \subset \mathcal{F}
$$
of quasi-coherent submodules, then
$\mathcal{F}_n = \mathcal{F}_{n + 1} = \ldots $ for some $n \geq 0$.
\end{lemma}

\begin{proof}
Choose a finite affine open covering.
On each member of the covering we get stabilization by
Algebra, Lemma \ref{algebra-lemma-Noetherian-basic}.
Hence the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-power-ideal-kills-sheaf}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent
sheaf of ideals corresponding to a closed subscheme $Z \subset X$.
Then there is some $n \geq 0$ such that $\mathcal{I}^n\mathcal{F} = 0$
if and only if $\text{Supp}(\mathcal{F}) \subset Z$ (set theoretically).
\end{lemma}

\begin{proof}
This follows immediately from
Algebra, Lemma \ref{algebra-lemma-Noetherian-power-ideal-kills-module}
because $X$ has a finite covering by spectra of Noetherian rings.
\end{proof}

\begin{lemma}[Artin-Rees]
\label{lemma-Artin-Rees}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Let $\mathcal{G} \subset \mathcal{F}$ be a quasi-coherent subsheaf.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf of
ideals.
Then there exists a $c \geq 0$ such that for all $n \geq c$ we
have
$$
\mathcal{I}^{n - c}(\mathcal{I}^c\mathcal{F} \cap \mathcal{G})
=
\mathcal{I}^n\mathcal{F} \cap \mathcal{G}
$$
\end{lemma}

\begin{proof}
This follows immediately from
Algebra, Lemma \ref{algebra-lemma-Artin-Rees}
because $X$ has a finite covering by spectra of Noetherian rings.
\end{proof}

\begin{lemma}
\label{lemma-homs-over-open}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Let $\mathcal{G}$ be coherent $\mathcal{O}_X$-module.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf of
ideals. Denote $Z \subset X$ the corresponding closed subscheme and
set $U = X \setminus Z$.
There is a canonical isomorphism
$$
\colim_n \Hom_{\mathcal{O}_X}(\mathcal{I}^n\mathcal{G}, \mathcal{F})
\longrightarrow
\Hom_{\mathcal{O}_U}(\mathcal{G}|_U, \mathcal{F}|_U).
$$
In particular we have an isomorphism
$$
\colim_n \Hom_{\mathcal{O}_X}(
\mathcal{I}^n, \mathcal{F})
\longrightarrow
\Gamma(U, \mathcal{F}).
$$
\end{lemma}

\begin{proof}
We first prove the second map is an isomorphism. It is injective by 
Properties, Lemma \ref{properties-lemma-sections-over-quasi-compact-open}.
Since $\mathcal{F}$ is the union of its coherent submodules, see
Properties, Lemma \ref{properties-lemma-quasi-coherent-colimit-finite-type}
(and Lemma \ref{lemma-coherent-Noetherian})
we may and do assume that $\mathcal{F}$ is coherent to prove surjectivity.
Let $\mathcal{F}_n$ denote the quasi-coherent subsheaf of $\mathcal{F}$
consisting of sections annihilated by $\mathcal{I}^n$,
see Properties, Lemma \ref{properties-lemma-sections-over-quasi-compact-open}.
Since $\mathcal{F}_1 \subset \mathcal{F}_2 \subset \ldots$ we see that
$\mathcal{F}_n = \mathcal{F}_{n + 1} = \ldots $ for some $n \geq 0$
by Lemma \ref{lemma-acc-coherent}. Set $\mathcal{H} = \mathcal{F}_n$
for this $n$. By Artin-Rees (Lemma \ref{lemma-Artin-Rees})
there exists an $c \geq 0$ such that
$\mathcal{I}^m\mathcal{F} \cap \mathcal{H}
\subset \mathcal{I}^{m - c}\mathcal{H}$. Picking $m = n + c$ we get
$\mathcal{I}^m\mathcal{F} \cap \mathcal{H} \subset \mathcal{I}^n\mathcal{H}
= 0$. Thus if we set $\mathcal{F}' = \mathcal{I}^m\mathcal{F}$ then we
see that $\mathcal{F}' \cap \mathcal{F}_n = 0$ and
$\mathcal{F}'|_U = \mathcal{F}|_U$. Note in particular that the subsheaf
$(\mathcal{F}')_N$ of sections annihilated by $\mathcal{I}^N$ is zero
for all $N \geq 0$. Hence by
Properties, Lemma \ref{properties-lemma-sections-over-quasi-compact-open}
we deduce that
the top horizontal arrow in the following commutative
diagram is a bijection:
$$
\xymatrix{
\colim_n \Hom_{\mathcal{O}_X}(
\mathcal{I}^n, \mathcal{F}')
\ar[r] \ar[d] &
\Gamma(U, \mathcal{F}') \ar[d] \\
\colim_n \Hom_{\mathcal{O}_X}(
\mathcal{I}^n, \mathcal{F})
\ar[r] &
\Gamma(U, \mathcal{F})
}
$$
Since also the right vertical arrow is a bijection we conclude that
the bottom horizontal arrow is surjective as desired.

\medskip\noindent
Next, we prove the first arrow of the lemma is a bijection.
By Lemma \ref{lemma-coherent-Noetherian} the sheaf $\mathcal{G}$
is of finite presentation and hence the sheaf
$\mathcal{H} = \SheafHom_{\mathcal{O}_X}(\mathcal{G}, \mathcal{F})$
is quasi-coherent, see
Schemes, Section \ref{schemes-section-quasi-coherent}.
By definition we have
$$
\mathcal{H}(U)
=
\Hom_{\mathcal{O}_U}(\mathcal{G}|_U, \mathcal{F}|_U)
$$
Pick a $\psi$ in the right hand side of the first arrow of the
lemma, i.e.,  $\psi \in \mathcal{H}(U)$. The result just proved applies
to $\mathcal{H}$ and hence there exists an $n \geq 0$ and an
$\varphi : \mathcal{I}^n \to \mathcal{H}$ which recovers
$\psi$ on restriction to $U$. By
Modules, Lemma \ref{modules-lemma-internal-hom}
$\varphi$ corresponds to a map
$$
\varphi :
\mathcal{I}^{\otimes n} \otimes_{\mathcal{O}_X} \mathcal{G}
\longrightarrow
\mathcal{F}.
$$
This is almost what we want except that the source of the arrow
is the tensor product of $\mathcal{I}^n$ and $\mathcal{G}$
and not the product. We will show that, at the cost of increasing $n$,
the difference is irrelevant. Consider the short exact sequence
$$
0 \to \mathcal{K} \to
\mathcal{I}^n \otimes_{\mathcal{O}_X} \mathcal{G} \to
\mathcal{I}^n\mathcal{G} \to 0
$$
where $\mathcal{K}$ is defined as the kernel. Note that
$\mathcal{I}^n\mathcal{K} = 0$ (proof omitted). By Artin-Rees
again we see that
$$
\mathcal{K}
\cap
\mathcal{I}^m(\mathcal{I}^n \otimes_{\mathcal{O}_X} \mathcal{G})
=
0
$$
for some $m$ large enough. In other words we see that
$$
\mathcal{I}^m(\mathcal{I}^n \otimes_{\mathcal{O}_X} \mathcal{G})
\longrightarrow
\mathcal{I}^{n + m}\mathcal{G}
$$
is an isomorphism. Let $\varphi'$ be the restriction of
$\varphi$ to this submodule thought of as a map
$\mathcal{I}^{m + n}\mathcal{G} \to \mathcal{F}$.
Then $\varphi'$ gives an element
of the left hand side of the first arrow of the lemma which
maps to $\psi$ via the arrow. In other words we have proved surjectivity
of the arrow. We omit the proof of injectivity.
\end{proof}

\begin{lemma}
\label{lemma-extend-coherent}
Let $X$ be a locally Noetherian scheme. Let $\mathcal{F}$, $\mathcal{G}$
be coherent $\mathcal{O}_X$-modules. Let $U \subset X$ be open and
let $\varphi : \mathcal{F}|_U \to \mathcal{G}|_U$ be an
$\mathcal{O}_U$-module map. Then there exists a coherent
submodule $\mathcal{F}' \subset \mathcal{F}$ agreeing with
$\mathcal{F}$ over $U$ such that $\varphi$ extends to
$\varphi' : \mathcal{F}' \to \mathcal{G}$.
\end{lemma}

\begin{proof}
Let $\mathcal{I} \subset \mathcal{O}_X$ be the coherent sheaf of ideals
cutting out the reduced induced scheme structure on $X \setminus U$.
If $X$ is Noetherian, then Lemma \ref{lemma-homs-over-open} tells us that
we can take $\mathcal{F}' = \mathcal{I}^n\mathcal{F}$
for some $n$. The general case will follow from this using Zorn's lemma.

\medskip\noindent
Consider the set of triples $(U', \mathcal{F}', \varphi')$ where
$U \subset U' \subset X$ is open, $\mathcal{F}' \subset \mathcal{F}|_{U'}$
is a coherent subsheaf agreeing with $\mathcal{F}$ over $U$, and
$\varphi' : \mathcal{F}' \to \mathcal{G}|_{U'}$ restricts to
$\varphi$ over $U$. We say
$(U'', \mathcal{F}'', \varphi'') \geq (U', \mathcal{F}', \varphi')$
if and only if $U'' \supset U'$, $\mathcal{F}''|_{U'} = \mathcal{F}'$,
and $\varphi''|_{U'} = \varphi'$.
It is clear that if we have a totally ordered collection
of triples $(U_i, \mathcal{F}_i, \varphi_i)$, then we
can glue the $\mathcal{F}_i$ to a subsheaf $\mathcal{F}'$ of $\mathcal{F}$
over $U' = \bigcup U_i$ and extend $\varphi$ to a map
$\varphi' : \mathcal{F}' \to \mathcal{G}|_{U'}$.
Hence any totally ordered subset of triples has an upper bound.
Finally, suppose that $(U', \mathcal{F}', \varphi')$
is any triple but $U' \not = X$. Then we can choose an
affine open $W \subset X$ which is not contained in $U'$.
By the result of the first paragraph we can extend
the subsheaf $\mathcal{F}'|_{W \cap U'}$ and the restriction
$\varphi'|_{W \cap U'}$ to some subsheaf $\mathcal{F}'' \subset \mathcal{F}|_W$
and map $\varphi'' : \mathcal{F}'' \to \mathcal{G}|_W$.
Of course the agreement between $(\mathcal{F}', \varphi')$ and
$(\mathcal{F}'', \varphi'')$ over $W \cap U'$ exactly means that
we can extend this to a triple $(U' \cup W, \mathcal{F}''', \varphi''')$.
Hence any maximal triple $(U', \mathcal{F}', \varphi')$
(which exist by Zorn's lemma) must have $U' = X$ and the
proof is complete.
\end{proof}









\section{Depth}
\label{section-depth}

\noindent
In this section we talk a little bit about depth and property
$(S_k)$ for coherent modules on locally Noetherian schemes.
Note that we have already discussed this notion for locally
Noetherian schemes in Properties, Section \ref{properties-section-Rk}.

\begin{definition}
\label{definition-depth}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Let $k \geq 0$ be an integer.
\begin{enumerate}
\item We say $\mathcal{F}$ has {\it depth $k$ at a point}
$x$ of $X$ if $\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}_x) = k$.
\item We say $X$ has {\it depth $k$ at a point} $x$ of $X$ if
$\text{depth}(\mathcal{O}_{X, x}) = k$.
\item We say $\mathcal{F}$ has property {\it $(S_k)$} if
$$
\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}_x)
\geq \min(k, \dim(\text{Supp}(\mathcal{F}_x)))
$$
for all $x \in X$.
\item We say $X$ has property {\it $(S_k)$} if $\mathcal{O}_X$ has
property $(S_k)$.
\end{enumerate}
\end{definition}

\noindent
Any coherent sheaf satisfies condition $(S_0)$.
Condition $(S_1)$ is equivalent to having no embedded associated
points, see Divisors, Lemma \ref{divisors-lemma-S1-no-embedded}.

\begin{lemma}
\label{lemma-hom-into-depth}
Let $X$ be a locally Noetherian scheme. Let $\mathcal{F}$, $\mathcal{G}$
be coherent $\mathcal{O}_X$-modules and $x \in X$.
\begin{enumerate}
\item If $\mathcal{G}_x$ has depth $\geq 1$, then
$\SheafHom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})_x$
has depth $\geq 1$.
\item If $\mathcal{G}_x$ has depth $\geq 2$, then
$\Hom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})_x$ has depth $\geq 2$.
\end{enumerate}
\end{lemma}

\begin{proof}
Observe that $\SheafHom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})$ is
a coherent $\mathcal{O}_X$-module by Lemma \ref{lemma-tensor-hom-coherent}.
Coherent modules are of finite presentation
(Lemma \ref{lemma-coherent-Noetherian}) hence taking stalks commutes
with taking $\SheafHom$ and $\Hom$, see
Modules, Lemma \ref{modules-lemma-stalk-internal-hom}.
Thus we reduce to the case of finite modules over local
rings which is More on Algebra, Lemma \ref{more-algebra-lemma-hom-into-depth}.
\end{proof}

\begin{lemma}
\label{lemma-hom-into-S2}
Let $X$ be a locally Noetherian scheme. Let $\mathcal{F}$, $\mathcal{G}$
be coherent $\mathcal{O}_X$-modules.
\begin{enumerate}
\item If $\mathcal{G}$ has property $(S_1)$, then
$\SheafHom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})$ has property $(S_1)$.
\item If $\mathcal{G}$ has property $(S_2)$, then
$\SheafHom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})$ has property $(S_2)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows immediately from Lemma \ref{lemma-hom-into-depth}
and the definitions.
\end{proof}

\noindent
We have seen in Properties, Lemma \ref{properties-lemma-scheme-CM-iff-all-Sk}
that a locally Noetherian
scheme is Cohen-Macaulay if and only if $(S_k)$ holds for all $k$.
Thus it makes sense to introduce the following definition, which
is equivalent to the condition that all stalks are Cohen-Macaulay modules.

\begin{definition}
\label{definition-Cohen-Macaulay}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
We say $\mathcal{F}$ is {\it Cohen-Macaulay} if and only
if $(S_k)$ holds for all $k \geq 0$.
\end{definition}

\begin{lemma}
\label{lemma-Cohen-Macaulay-over-regular}
Let $X$ be a regular scheme. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_X$-module. The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is Cohen-Macaulay and $\text{Supp}(\mathcal{F}) = X$,
\item $\mathcal{F}$ is finite locally free of rank $> 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $x \in X$. If (2) holds, then $\mathcal{F}_x$ is a free
$\mathcal{O}_{X, x}$-module of rank $> 0$. Hence
$\text{depth}(\mathcal{F}_x) = \dim(\mathcal{O}_{X, x})$
because a regular local ring is Cohen-Macaulay
(Algebra, Lemma \ref{algebra-lemma-regular-ring-CM}).
Conversely, if (1) holds, then $\mathcal{F}_x$ is a
maximal Cohen-Macaulay module over $\mathcal{O}_{X, x}$
(Algebra, Definition \ref{algebra-definition-maximal-CM}).
Hence $\mathcal{F}_x$ is free by
Algebra, Lemma \ref{algebra-lemma-regular-mcm-free}.
\end{proof}









\section{Devissage of coherent sheaves}
\label{section-devissage}

\noindent
Let $X$ be a Noetherian scheme. Consider an integral closed subscheme
$i : Z \to X$. It is often convenient to consider coherent sheaves of
the form $i_*\mathcal{G}$ where $\mathcal{G}$ is a coherent sheaf on
$Z$. In particular we are interested in these sheaves when $\mathcal{G}$
is a torsion free rank $1$ sheaf. For example $\mathcal{G}$ could be
a nonzero sheaf of ideals on $Z$, or even more specifically
$\mathcal{G} = \mathcal{O}_Z$.

\medskip\noindent
Throughout this section we will use that a coherent sheaf is the
same thing as a finite type quasi-coherent sheaf and that a
quasi-coherent subquotient of a coherent sheaf is coherent, see
Section \ref{section-coherent-sheaves}.
The support of a coherent sheaf is closed, see
Modules, Lemma \ref{modules-lemma-support-finite-type-closed}.

\begin{lemma}
\label{lemma-prepare-filter-support}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Suppose that $\text{Supp}(\mathcal{F}) = Z \cup Z'$ with $Z$, $Z'$ closed.
Then there exists a short exact sequence of coherent sheaves
$$
0 \to \mathcal{G}' \to \mathcal{F} \to \mathcal{G} \to 0
$$
with $\text{Supp}(\mathcal{G}') \subset Z'$ and
$\text{Supp}(\mathcal{G}) \subset Z$.
\end{lemma}

\begin{proof}
Let $\mathcal{I} \subset \mathcal{O}_X$ be the sheaf of ideals
defining the reduced induced closed subscheme structure on $Z$, see
Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme}.
Consider the subsheaves
$\mathcal{G}'_n = \mathcal{I}^n\mathcal{F}$ and the
quotients $\mathcal{G}_n = \mathcal{F}/\mathcal{I}^n\mathcal{F}$.
For each $n$ we have a short exact sequence
$$
0 \to \mathcal{G}'_n \to \mathcal{F} \to \mathcal{G}_n \to 0
$$
For every point $x$ of $Z' \setminus Z$ we have
$\mathcal{I}_x = \mathcal{O}_{X, x}$
and hence $\mathcal{G}_{n, x} = 0$. Thus we see that
$\text{Supp}(\mathcal{G}_n) \subset Z$. Note that $X \setminus Z'$
is a Noetherian scheme. Hence by Lemma \ref{lemma-power-ideal-kills-sheaf}
there exists an $n$ such that
$\mathcal{G}'_n|_{X \setminus Z'} =
\mathcal{I}^n\mathcal{F}|_{X \setminus Z'} = 0$.
For such an $n$ we see that $\text{Supp}(\mathcal{G}'_n) \subset Z'$.
Thus setting
$\mathcal{G}' = \mathcal{G}'_n$ and $\mathcal{G} = \mathcal{G}_n$
works.
\end{proof}

\begin{lemma}
\label{lemma-prepare-filter-irreducible}
Let $X$ be a Noetherian scheme.
Let $i : Z \to X$ be an integral closed subscheme.
Let $\xi \in Z$ be the generic point.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Assume that $\mathcal{F}_\xi$ is annihilated by
$\mathfrak m_\xi$. Then there exists an integer
$r \geq 0$ and a sheaf of ideals $\mathcal{I} \subset \mathcal{O}_Z$
and an injective map of coherent sheaves
$$
i_*\left(\mathcal{I}^{\oplus r}\right) \to \mathcal{F}
$$
which is an isomorphism in a neighbourhood of $\xi$.
\end{lemma}

\begin{proof}
Let $\mathcal{J} \subset \mathcal{O}_X$ be the ideal sheaf of $Z$.
Let $\mathcal{F}' \subset \mathcal{F}$ be the subsheaf of
local sections of $\mathcal{F}$ which are annihilated by
$\mathcal{J}$. It is a quasi-coherent sheaf by
Properties, Lemma \ref{properties-lemma-sections-annihilated-by-ideal}.
Moreover, $\mathcal{F}'_\xi = \mathcal{F}_\xi$ because
$\mathcal{J}_\xi = \mathfrak m_\xi$ and part (3) of
Properties, Lemma \ref{properties-lemma-sections-annihilated-by-ideal}.
By Lemma \ref{lemma-local-isomorphism} we see that
$\mathcal{F}' \to \mathcal{F}$
induces an isomorphism in a neighbourhood of $\xi$.
Hence we may replace $\mathcal{F}$ by $\mathcal{F}'$ and assume
that $\mathcal{F}$ is annihilated by $\mathcal{J}$.

\medskip\noindent
Assume $\mathcal{J}\mathcal{F} = 0$. By
Lemma \ref{lemma-i-star-equivalence} we can write
$\mathcal{F} = i_*\mathcal{G}$ for some coherent
sheaf $\mathcal{G}$ on $Z$. Suppose we can find a morphism
$\mathcal{I}^{\oplus r} \to \mathcal{G}$ which is an isomorphism
in a neighbourhood of the generic point $\xi$ of $Z$.
Then applying $i_*$ (which is left exact) we get the result of the lemma.
Hence we have reduced to the case $X = Z$.

\medskip\noindent
Suppose $Z = X$ is an integral Noetherian scheme with generic point $\xi$.
Note that $\mathcal{O}_{X, \xi} = \kappa(\xi)$ is the function field of $X$
in this case.
Since $\mathcal{F}_\xi$ is a finite $\mathcal{O}_\xi$-module we see
that $r = \dim_{\kappa(\xi)} \mathcal{F}_\xi$ is finite.
Hence the sheaves $\mathcal{O}_X^{\oplus r}$ and $\mathcal{F}$
have isomorphic stalks at $\xi$.
By Lemma \ref{lemma-map-stalks-local-map} there exists a nonempty
open $U \subset X$ and a morphism
$\psi : \mathcal{O}_X^{\oplus r}|_U \to \mathcal{F}|_U$
which is an isomorphism
at $\xi$, and hence an isomorphism in a neighbourhood of $\xi$ by
Lemma \ref{lemma-local-isomorphism}.
By Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme}
there exists a quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_X$
whose associated closed subscheme $Z \subset X$ is the complement
of $U$.
By Lemma \ref{lemma-homs-over-open} there exists an $n \geq 0$ and a morphism
$\mathcal{I}^n(\mathcal{O}_X^{\oplus r}) \to \mathcal{F}$
which recovers our $\psi$ over $U$. Since
$\mathcal{I}^n(\mathcal{O}_X^{\oplus r}) = (\mathcal{I}^n)^{\oplus r}$
we get a map as in the lemma. It is injective because $X$ is
integral and it is injective at the generic point of $X$
(easy proof omitted).
\end{proof}

\begin{lemma}
\label{lemma-coherent-filter}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
There exists a filtration
$$
0 = \mathcal{F}_0 \subset \mathcal{F}_1 \subset
\ldots \subset \mathcal{F}_m = \mathcal{F}
$$
by coherent subsheaves such that for each $j = 1, \ldots, m$
there exists an integral closed subscheme $Z_j \subset X$
and a sheaf of ideals $\mathcal{I}_j \subset \mathcal{O}_{Z_j}$
such that
$$
\mathcal{F}_j/\mathcal{F}_{j - 1}
\cong (Z_j \to X)_* \mathcal{I}_j
$$
\end{lemma}

\begin{proof}
Consider the collection
$$
\mathcal{T} =
\left\{
\begin{matrix}
Z \subset X
\text{ closed such that there exists a coherent sheaf }
\mathcal{F} \\
\text{ with }
\text{Supp}(\mathcal{F}) = Z
\text{ for which the lemma is wrong}
\end{matrix}
\right\}
$$
We are trying to show that $\mathcal{T}$ is empty. If not, then
because $X$ is Noetherian we can choose a minimal element
$Z \in \mathcal{T}$. This means that there exists a coherent
sheaf $\mathcal{F}$ on $X$ whose support is $Z$ and for which the
lemma does not hold. Clearly $Z \not = \emptyset$ since the only
sheaf whose support is empty is the zero sheaf for which the
lemma does hold (with $m = 0$).

\medskip\noindent
If $Z$ is not irreducible, then we can write $Z = Z_1 \cup Z_2$
with $Z_1, Z_2$ closed and strictly smaller than $Z$.
Then we can apply Lemma \ref{lemma-prepare-filter-support}
to get a short exact sequence of coherent sheaves
$$
0 \to
\mathcal{G}_1 \to
\mathcal{F} \to
\mathcal{G}_2 \to 0
$$
with $\text{Supp}(\mathcal{G}_i) \subset Z_i$. By minimality of
$Z$ each of $\mathcal{G}_i$ has a filtration as in the statement
of the lemma. By considering the induced filtration on $\mathcal{F}$
we arrive at a contradiction. Hence we conclude
that $Z$ is irreducible.

\medskip\noindent
Suppose $Z$ is irreducible. Let $\mathcal{J}$ be the sheaf of ideals
cutting out the reduced induced closed subscheme structure of $Z$,
see Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme}.
By Lemma \ref{lemma-power-ideal-kills-sheaf} we see there exists
an $n \geq 0$ such that $\mathcal{J}^n\mathcal{F} = 0$. Hence we obtain
a filtration
$$
0 = \mathcal{J}^n\mathcal{F} \subset \mathcal{J}^{n - 1}\mathcal{F}
\subset \ldots \subset \mathcal{J}\mathcal{F} \subset \mathcal{F}
$$
each of whose successive subquotients is annihilated by $\mathcal{J}$.
Hence if each of these subquotients has a filtration as in the statement
of the lemma then also $\mathcal{F}$ does. In other words we may
assume that $\mathcal{J}$ does annihilate $\mathcal{F}$.

\medskip\noindent
In the case where $Z$ is irreducible and $\mathcal{J}\mathcal{F} = 0$
we can apply Lemma \ref{lemma-prepare-filter-irreducible}.
This gives a short exact sequence
$$
0 \to
i_*(\mathcal{I}^{\oplus r}) \to
\mathcal{F} \to
\mathcal{Q} \to 0
$$
where $\mathcal{Q}$ is defined as the quotient.
Since $\mathcal{Q}$ is zero in a neighbourhood of $\xi$ by
the lemma just cited we see that the support of $\mathcal{Q}$
is strictly smaller than $Z$. Hence we see that $\mathcal{Q}$
has a filtration of the desired type by minimality of $Z$.
But then clearly $\mathcal{F}$ does too, which is our final contradiction.
\end{proof}

\begin{lemma}
\label{lemma-property-initial}
Let $X$ be a Noetherian scheme.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$. Assume
\begin{enumerate}
\item For any short exact sequence of coherent sheaves
$$
0 \to \mathcal{F}_1 \to \mathcal{F} \to \mathcal{F}_2 \to 0
$$
if $\mathcal{F}_i$, $i = 1, 2$ have property $\mathcal{P}$
then so does $\mathcal{F}$.
\item For every integral closed subscheme $Z \subset X$
and every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Z$ we have
$\mathcal{P}$ for $i_*\mathcal{I}$.
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
on $X$.
\end{lemma}

\begin{proof}
First note that if $\mathcal{F}$ is a coherent sheaf with a filtration
$$
0 = \mathcal{F}_0 \subset \mathcal{F}_1 \subset
\ldots \subset \mathcal{F}_m = \mathcal{F}
$$
by coherent subsheaves such that each of $\mathcal{F}_i/\mathcal{F}_{i - 1}$
has property $\mathcal{P}$, then so does $\mathcal{F}$.
This follows from the property (1) for $\mathcal{P}$.
On the other hand, by Lemma \ref{lemma-coherent-filter}
we can filter any $\mathcal{F}$
with successive subquotients as in (2).
Hence the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-property-irreducible}
Let $X$ be a Noetherian scheme. Let $Z_0 \subset X$ be an irreducible closed
subset with generic point $\xi$. Let $\mathcal{P}$ be a property of coherent
sheaves on $X$ with support contained in $Z_0$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves if two
out of three of them have property $\mathcal{P}$ then so does the
third.
\item For every integral closed subscheme $Z \subset Z_0 \subset X$,
$Z \not = Z_0$ and every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Z$ we have
$\mathcal{P}$ for $(Z \to X)_*\mathcal{I}$.
\item There exists some coherent sheaf $\mathcal{G}$ on $X$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z_0$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$,
\item $\dim_{\kappa(\xi)} \mathcal{G}_\xi = 1$, and
\item property $\mathcal{P}$ holds for $\mathcal{G}$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
$\mathcal{F}$ on $X$ whose support is contained in $Z_0$.
\end{lemma}

\begin{proof}
First note that if $\mathcal{F}$ is a coherent sheaf with support
contained in $Z_0$ with a filtration
$$
0 = \mathcal{F}_0 \subset \mathcal{F}_1 \subset
\ldots \subset \mathcal{F}_m = \mathcal{F}
$$
by coherent subsheaves such that each of $\mathcal{F}_i/\mathcal{F}_{i - 1}$
has property $\mathcal{P}$, then so does $\mathcal{F}$. Or, if $\mathcal{F}$
has property $\mathcal{P}$ and all but one of the
$\mathcal{F}_i/\mathcal{F}_{i - 1}$ has property $\mathcal{P}$ then
so does the last one. This follows from assumption (1).

\medskip\noindent
As a first application we conclude that any coherent sheaf whose support
is strictly contained in $Z_0$ has property $\mathcal{P}$. Namely, such a
sheaf has a filtration (see Lemma \ref{lemma-coherent-filter})
whose subquotients have property $\mathcal{P}$ according to (2).

\medskip\noindent
Let $\mathcal{G}$ be as in (3). By Lemma \ref{lemma-prepare-filter-irreducible}
there exist a sheaf of ideals $\mathcal{I}$ on $Z_0$, an
integer $r \geq 1$, and a short exact sequence
$$
0 \to
\left((Z_0 \to X)_*\mathcal{I}\right)^{\oplus r} \to
\mathcal{G} \to
\mathcal{Q} \to 0
$$
where the support of $\mathcal{Q}$ is strictly contained in $Z_0$.
By (3)(c) we see that $r = 1$. Since $\mathcal{Q}$ has property $\mathcal{P}$
too we conclude that $(Z_0 \to X)_*\mathcal{I}$ has property
$\mathcal{P}$.

\medskip\noindent
Next, suppose that $\mathcal{I}' \not = 0$ is another quasi-coherent
sheaf of ideals on $Z_0$. Then we can consider the intersection
$\mathcal{I}'' = \mathcal{I}' \cap \mathcal{I}$ and we get
two short exact sequences
$$
0 \to
(Z_0 \to X)_*\mathcal{I}'' \to
(Z_0 \to X)_*\mathcal{I} \to
\mathcal{Q} \to 0
$$
and
$$
0 \to
(Z_0 \to X)_*\mathcal{I}'' \to
(Z_0 \to X)_*\mathcal{I}' \to
\mathcal{Q}' \to 0.
$$
Note that the support of the coherent sheaves $\mathcal{Q}$ and
$\mathcal{Q}'$ are strictly contained in $Z_0$.
Hence $\mathcal{Q}$ and $\mathcal{Q}'$ have property $\mathcal{P}$
(see above). Hence we conclude using (1)
that $(Z_0 \to X)_*\mathcal{I}''$ and $(Z_0 \to X)_*\mathcal{I}'$
both have $\mathcal{P}$ as well.

\medskip\noindent
The final step of the proof is to note that any coherent sheaf
$\mathcal{F}$ on $X$ whose support is contained in $Z_0$ has a filtration
(see Lemma \ref{lemma-coherent-filter} again) whose subquotients
all have property $\mathcal{P}$ by what we just said.
\end{proof}

\begin{lemma}
\label{lemma-property}
Let $X$ be a Noetherian scheme.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves if two
out of three of them have property $\mathcal{P}$ then so does the
third.
\item For every integral closed subscheme $Z \subset X$
with generic point $\xi$ there exists
some coherent sheaf $\mathcal{G}$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$,
\item $\dim_{\kappa(\xi)} \mathcal{G}_\xi = 1$, and
\item property $\mathcal{P}$ holds for $\mathcal{G}$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
on $X$.
\end{lemma}

\begin{proof}
According to Lemma \ref{lemma-property-initial} it suffices to show that
for all integral closed subschemes $Z \subset X$ and all quasi-coherent
ideal sheaves $\mathcal{I} \subset \mathcal{O}_Z$ we have $\mathcal{P}$
for $(Z \to X)_*\mathcal{I}$. If this fails, then since $X$ is Noetherian
there is a minimal integral closed subscheme $Z_0 \subset X$ such that
$\mathcal{P}$ fails for $(Z_0 \to X)_*\mathcal{I}_0$ for some
quasi-coherent sheaf of ideals $\mathcal{I}_0 \subset \mathcal{O}_{Z_0}$,
but $\mathcal{P}$ does hold for $(Z \to X)_*\mathcal{I}$ for all integral
closed subschemes $Z \subset Z_0$, $Z \not = Z_0$ and quasi-coherent
ideal sheaves $\mathcal{I} \subset \mathcal{O}_Z$. Since we have the
existence of $\mathcal{G}$ for $Z_0$ by part (2), according to
Lemma \ref{lemma-property-irreducible} this cannot happen.
\end{proof}

\begin{lemma}
\label{lemma-property-irreducible-higher-rank-cohomological}
Let $X$ be a Noetherian scheme. Let $Z_0 \subset X$ be an irreducible
closed subset with generic point $\xi$. Let $\mathcal{P}$ be a property
of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves
$$
0 \to \mathcal{F}_1 \to \mathcal{F} \to \mathcal{F}_2 \to 0
$$
if $\mathcal{F}_i$, $i = 1, 2$ have property $\mathcal{P}$
then so does $\mathcal{F}$.
\item If $\mathcal{P}$ holds for $\mathcal{F}^{\oplus r}$ for
some $r \geq 1$, then it holds for $\mathcal{F}$.
\item For every integral closed subscheme $Z \subset Z_0 \subset X$,
$Z \not = Z_0$ and every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Z$ we have
$\mathcal{P}$ for $(Z \to X)_*\mathcal{I}$.
\item There exists some coherent sheaf $\mathcal{G}$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z_0$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$, and
\item for every quasi-coherent sheaf of ideals
$\mathcal{J} \subset \mathcal{O}_X$ such that
$\mathcal{J}_\xi = \mathcal{O}_{X, \xi}$ there exists a quasi-coherent
subsheaf $\mathcal{G}' \subset \mathcal{J}\mathcal{G}$ with
$\mathcal{G}'_\xi = \mathcal{G}_\xi$ and such that
$\mathcal{P}$ holds for $\mathcal{G}'$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
$\mathcal{F}$ on $X$ whose support is contained in $Z_0$.
\end{lemma}

\begin{proof}
Note that if $\mathcal{F}$ is a coherent sheaf with a filtration
$$
0 = \mathcal{F}_0 \subset \mathcal{F}_1 \subset
\ldots \subset \mathcal{F}_m = \mathcal{F}
$$
by coherent subsheaves such that each of $\mathcal{F}_i/\mathcal{F}_{i - 1}$
has property $\mathcal{P}$, then so does $\mathcal{F}$.
This follows from assumption (1).

\medskip\noindent
As a first application we conclude that any coherent sheaf whose support
is strictly contained in $Z_0$ has property $\mathcal{P}$. Namely, such a
sheaf has a filtration (see Lemma \ref{lemma-coherent-filter})
whose subquotients have property $\mathcal{P}$ according to (3).

\medskip\noindent
Let us denote $i : Z_0 \to X$ the closed immersion.
Consider a coherent sheaf $\mathcal{G}$ as in (4).
By Lemma \ref{lemma-prepare-filter-irreducible}
there exists a sheaf of ideals $\mathcal{I}$ on $Z_0$ and
a short exact sequence
$$
0 \to
i_*\mathcal{I}^{\oplus r} \to
\mathcal{G} \to
\mathcal{Q} \to 0
$$
where the support of $\mathcal{Q}$ is strictly contained in $Z_0$.
In particular $r > 0$ and $\mathcal{I}$ is nonzero
because the support of $\mathcal{G}$ is equal to $Z_0$.
Let $\mathcal{I}' \subset \mathcal{I}$ be any nonzero quasi-coherent
sheaf of ideals on $Z_0$ contained in $\mathcal{I}$.
Then we also get a short exact sequence
$$
0 \to
i_*(\mathcal{I}')^{\oplus r} \to
\mathcal{G} \to
\mathcal{Q}' \to 0
$$
where $\mathcal{Q}'$ has support properly contained in $Z_0$.
Let $\mathcal{J} \subset \mathcal{O}_X$ be a quasi-coherent sheaf
of ideals cutting out the support of $\mathcal{Q}'$ (for example
the ideal corresponding to the reduced induced closed subscheme
structure on the support of $\mathcal{Q}'$). Then
$\mathcal{J}_\xi = \mathcal{O}_{X, \xi}$. By
Lemma \ref{lemma-power-ideal-kills-sheaf}
we see that $\mathcal{J}^n\mathcal{Q}' = 0$ for some $n$.
Hence $\mathcal{J}^n\mathcal{G} \subset i_*(\mathcal{I}')^{\oplus r}$.
By assumption (4)(c) of the lemma we see there exists
a quasi-coherent subsheaf $\mathcal{G}' \subset \mathcal{J}^n\mathcal{G}$
with $\mathcal{G}'_\xi = \mathcal{G}_\xi$
for which property $\mathcal{P}$ holds.
Hence we get a short exact sequence
$$
0 \to \mathcal{G}' \to
i_*(\mathcal{I}')^{\oplus r} \to
\mathcal{Q}'' \to 0
$$
where $\mathcal{Q}''$ has support properly contained in $Z_0$.
Thus by our initial remarks and property (1) of the lemma
we conclude that $i_*(\mathcal{I}')^{\oplus r}$ satisfies
$\mathcal{P}$. Hence we see that $i_*\mathcal{I}'$ satisfies
$\mathcal{P}$ by (2). Finally, for an arbitrary quasi-coherent
sheaf of ideals $\mathcal{I}'' \subset \mathcal{O}_{Z_0}$ we can set
$\mathcal{I}' = \mathcal{I}'' \cap \mathcal{I}$ and we get
a short exact sequence
$$
0 \to
i_*(\mathcal{I}') \to
i_*(\mathcal{I}'') \to
\mathcal{Q}''' \to 0
$$
where $\mathcal{Q}'''$ has support properly contained in $Z_0$.
Hence we conclude that property $\mathcal{P}$ holds for
$i_*\mathcal{I}''$ as well.

\medskip\noindent
The final step of the proof is to note that any coherent sheaf
$\mathcal{F}$ on $X$ whose support is contained in $Z_0$ has a filtration
(see Lemma \ref{lemma-coherent-filter} again) whose subquotients
all have property $\mathcal{P}$ by what we just said.
\end{proof}

\begin{lemma}
\label{lemma-property-higher-rank-cohomological}
Let $X$ be a Noetherian scheme.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves
$$
0 \to \mathcal{F}_1 \to \mathcal{F} \to \mathcal{F}_2 \to 0
$$
if $\mathcal{F}_i$, $i = 1, 2$ have property $\mathcal{P}$
then so does $\mathcal{F}$.
\item If $\mathcal{P}$ holds  for $\mathcal{F}^{\oplus r}$ for
some $r \geq 1$, then it holds for $\mathcal{F}$.
\item For every integral closed subscheme $Z \subset X$
with generic point $\xi$ there exists
some coherent sheaf $\mathcal{G}$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$, and
\item for every quasi-coherent sheaf of ideals
$\mathcal{J} \subset \mathcal{O}_X$ such that
$\mathcal{J}_\xi = \mathcal{O}_{X, \xi}$ there exists a quasi-coherent
subsheaf $\mathcal{G}' \subset \mathcal{J}\mathcal{G}$ with
$\mathcal{G}'_\xi = \mathcal{G}_\xi$ and such that
$\mathcal{P}$ holds for $\mathcal{G}'$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
on $X$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-property-irreducible-higher-rank-cohomological}
in exactly the same way that Lemma \ref{lemma-property} follows from
Lemma \ref{lemma-property-irreducible}.
\end{proof}








\section{Finite morphisms and affines}
\label{section-finite-affine}

\noindent
In this section we use the results of the preceding sections
to show that the image of a Noetherian affine scheme under a finite
morphism is affine. We will see later that this result holds more
generally (see Limits, Lemma \ref{limits-lemma-affine} and
Proposition \ref{limits-proposition-affine}).

\begin{lemma}
\label{lemma-finite-morphism-Noetherian}
Let $f : Y \to X$ be a morphism of schemes.
Assume $f$ is finite, surjective and $X$ locally Noetherian.
Let $Z \subset X$ be an integral closed subscheme with
generic point $\xi$. Then
there exists a coherent sheaf $\mathcal{F}$ on $Y$
such that the support of $f_*\mathcal{F}$ is equal to $Z$
and $(f_*\mathcal{F})_\xi$ is annihilated by $\mathfrak m_\xi$.
\end{lemma}

\begin{proof}
Note that $Y$ is locally Noetherian by
Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}.
Because $f$ is surjective the fibre $Y_\xi$ is not empty.
Pick $\xi' \in Y$ mapping to $\xi$. Let $Z' = \overline{\{\xi'\}}$.
We may think of $Z' \subset Y$ as a reduced closed subscheme,
see Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme}.
Hence the sheaf $\mathcal{F} = (Z' \to Y)_*\mathcal{O}_{Z'}$
is a coherent sheaf on $Y$ (see
Lemma \ref{lemma-finite-pushforward-coherent}).
Look at the commutative diagram
$$
\xymatrix{
Z' \ar[r]_{i'} \ar[d]_{f'} &
Y \ar[d]^f \\
Z \ar[r]^i &
X
}
$$
We see that $f_*\mathcal{F} = i_*f'_*\mathcal{O}_{Z'}$.
Hence the stalk of $f_*\mathcal{F}$ at $\xi$ is the stalk
of $f'_*\mathcal{O}_{Z'}$ at $\xi$. Note that since $Z'$ is
integral with generic point $\xi'$ we have that
$\xi'$ is the only point of $Z'$ lying over $\xi$, see
Algebra, Lemmas \ref{algebra-lemma-finite-is-integral} and
\ref{algebra-lemma-integral-no-inclusion}.
Hence the stalk of $f'_*\mathcal{O}_{Z'}$ at $\xi$
equal $\mathcal{O}_{Z', \xi'} = \kappa(\xi')$. In particular
the stalk of $f_*\mathcal{F}$ at $\xi$ is not zero.
This combined with the fact that $f_*\mathcal{F}$ is
of the form $i_*f'_*(\text{something})$ implies the lemma.
\end{proof}

\begin{lemma}
\label{lemma-affine-morphism-projection-ideal}
Let $f : Y \to X$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $Y$.
Let $\mathcal{I}$ be a quasi-coherent sheaf of ideals on $X$.
If the morphism $f$ is affine then
$\mathcal{I}f_*\mathcal{F} = f_*(f^{-1}\mathcal{I}\mathcal{F})$.
\end{lemma}

\begin{proof}
The notation means the following. Since $f^{-1}$ is an exact functor
we see that $f^{-1}\mathcal{I}$ is a sheaf
of ideals of $f^{-1}\mathcal{O}_X$. Via the map
$f^\sharp : f^{-1}\mathcal{O}_X \to \mathcal{O}_Y$ this acts on
$\mathcal{F}$. Then $f^{-1}\mathcal{I}\mathcal{F}$ is the subsheaf
generated by sums of local sections of the form $as$ where $a$
is a local section of $f^{-1}\mathcal{I}$ and $s$ is a local section
of $\mathcal{F}$. It is a quasi-coherent $\mathcal{O}_Y$-submodule
of $\mathcal{F}$ because it is also the image of a natural map
$f^*\mathcal{I} \otimes_{\mathcal{O}_Y} \mathcal{F} \to \mathcal{F}$.

\medskip\noindent
Having said this the proof is straightforward. Namely, the question is local
and hence we may assume $X$ is affine. Since $f$ is affine we see that
$Y$ is affine too. Thus we may write
$Y = \Spec(B)$, $X = \Spec(A)$, $\mathcal{F} = \widetilde{M}$,
and $\mathcal{I} = \widetilde{I}$. The assertion of the lemma in this
case boils down to the statement that
$$
I(M_A) = ((IB)M)_A
$$
where $M_A$ indicates the $A$-module associated to the $B$-module $M$.
\end{proof}

\begin{lemma}
\label{lemma-image-affine-finite-morphism-affine-Noetherian}
Let $f : Y \to X$ be a morphism of schemes.
Assume
\begin{enumerate}
\item $f$ finite,
\item $f$ surjective,
\item $Y$ affine, and
\item $X$ Noetherian.
\end{enumerate}
Then $X$ is affine.
\end{lemma}

\begin{proof}
We will prove that under the assumptions of the lemma for any coherent
$\mathcal{O}_X$-module $\mathcal{F}$ we have $H^1(X, \mathcal{F}) = 0$.
This will in particular imply that $H^1(X, \mathcal{I}) = 0$
for every quasi-coherent sheaf of ideals of $\mathcal{O}_X$. Then it
follows that $X$ is affine from either
Lemma \ref{lemma-quasi-compact-h1-zero-covering} or
Lemma \ref{lemma-quasi-separated-h1-zero-covering}.

\medskip\noindent
Let $\mathcal{P}$ be the property of coherent sheaves
$\mathcal{F}$ on $X$ defined by the rule
$$
\mathcal{P}(\mathcal{F}) \Leftrightarrow H^1(X, \mathcal{F}) = 0.
$$
We are going to apply Lemma \ref{lemma-property-higher-rank-cohomological}.
Thus we have to verify (1), (2) and (3) of that lemma for $\mathcal{P}$.
Property (1) follows from the long exact cohomology sequence associated
to a short exact sequence of sheaves. Property (2) follows since
$H^1(X, -)$ is an additive functor. To see (3) let $Z \subset X$ be
an integral closed subscheme with generic point $\xi$.
Let $\mathcal{F}$ be a coherent sheaf on $Y$ such that
the support of $f_*\mathcal{F}$ is equal to $Z$
and $(f_*\mathcal{F})_\xi$ is annihilated by $\mathfrak m_\xi$,
see Lemma \ref{lemma-finite-morphism-Noetherian}. We claim that
taking $\mathcal{G} = f_*\mathcal{F}$ works. We only have to verify
part (3)(c) of Lemma \ref{lemma-property-higher-rank-cohomological}.
Hence assume that $\mathcal{J} \subset \mathcal{O}_X$ is a
quasi-coherent sheaf of ideals such that
$\mathcal{J}_\xi = \mathcal{O}_{X, \xi}$.
A finite morphism is affine hence by
Lemma \ref{lemma-affine-morphism-projection-ideal} we see that
$\mathcal{J}\mathcal{G} = f_*(f^{-1}\mathcal{J}\mathcal{F})$.
Also, as pointed out in the proof of
Lemma \ref{lemma-affine-morphism-projection-ideal} the sheaf
$f^{-1}\mathcal{J}\mathcal{F}$ is a quasi-coherent $\mathcal{O}_Y$-module.
Since $Y$ is affine we see that $H^1(Y, f^{-1}\mathcal{J}\mathcal{F}) = 0$,
see Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}.
Since $f$ is finite, hence affine, we see that
$$
H^1(X, \mathcal{J}\mathcal{G}) =
H^1(X, f_*(f^{-1}\mathcal{J}\mathcal{F})) =
H^1(Y, f^{-1}\mathcal{J}\mathcal{F}) = 0
$$
by Lemma \ref{lemma-relative-affine-cohomology}.
Hence the quasi-coherent subsheaf $\mathcal{G}' = \mathcal{J}\mathcal{G}$
satisfies $\mathcal{P}$. This verifies property (3)(c) of
Lemma \ref{lemma-property-higher-rank-cohomological} as desired.
\end{proof}












\section{Coherent sheaves on Proj, I}
\label{section-coherent-proj}

\noindent
In this section we discuss coherent sheaves on $\text{Proj}(A)$
where $A$ is a Noetherian graded ring generated by $A_1$ over $A_0$.
In the next section we discuss what happens if $A$ is not generated
by degree $1$ elements. First, we formulate an all-in-one result for
projective space over a Noetherian ring.

\begin{lemma}
\label{lemma-coherent-projective}
Let $R$ be a Noetherian ring.
Let $n \geq 0$ be an integer.
For every coherent sheaf $\mathcal{F}$ on $\mathbf{P}^n_R$
we have the following:
\begin{enumerate}
\item There exists an $r \geq 0$ and
$d_1, \ldots, d_r \in \mathbf{Z}$ and a surjection
$$
\bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j)
\longrightarrow
\mathcal{F}.
$$
\item We have $H^i(\mathbf{P}^n_R, \mathcal{F}) = 0$ unless
$0 \leq i \leq n$.
\item For any $i$ the cohomology group $H^i(\mathbf{P}^n_R, \mathcal{F})$
is a finite $R$-module.
\item If $i > 0$, then
$H^i(\mathbf{P}^n_R, \mathcal{F}(d)) = 0$ for all $d$ large enough.
\item For any $k \in \mathbf{Z}$ the graded $R[T_0, \ldots, T_n]$-module
$$
\bigoplus\nolimits_{d \geq k} H^0(\mathbf{P}^n_R, \mathcal{F}(d))
$$
is a finite $R[T_0, \ldots, T_n]$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
We will use that $\mathcal{O}_{\mathbf{P}^n_R}(1)$ is an ample invertible
sheaf on
the scheme $\mathbf{P}^n_R$. This follows directly from the definition
since $\mathbf{P}^n_R$ covered by the standard affine opens $D_{+}(T_i)$.
Hence by
Properties, Proposition \ref{properties-proposition-characterize-ample}
every finite type quasi-coherent $\mathcal{O}_{\mathbf{P}^n_R}$-module
is a quotient of a finite direct sum of tensor powers of
$\mathcal{O}_{\mathbf{P}^n_R}(1)$. On the other hand coherent sheaves
and finite type quasi-coherent sheaves are the same thing on projective
space over $R$ by Lemma \ref{lemma-coherent-Noetherian}. Thus we see (1).

\medskip\noindent
Projective $n$-space $\mathbf{P}^n_R$ is covered by $n + 1$ affines,
namely the standard opens $D_{+}(T_i)$, $i = 0, \ldots, n$, see Constructions,
Lemma \ref{constructions-lemma-standard-covering-projective-space}.
Hence we see that for any quasi-coherent
sheaf $\mathcal{F}$ on $\mathbf{P}^n_R$
we have $H^i(\mathbf{P}^n_R, \mathcal{F}) = 0$ for $i \geq n + 1$,
see Lemma \ref{lemma-vanishing-nr-affines}. Hence (2) holds.

\medskip\noindent
Let us prove (3) and (4) simultaneously for all coherent sheaves
on $\mathbf{P}^n_R$ by descending induction on $i$. Clearly the result
holds for $i \geq n + 1$ by (2). Suppose we know the result for
$i + 1$ and we want to show the result for $i$. (If $i = 0$, then
part (4) is vacuous.) Let $\mathcal{F}$ be a coherent sheaf on
$\mathbf{P}^n_R$. Choose a surjection as in (1) and denote
$\mathcal{G}$ the kernel so that we have a short exact sequence
$$
0 \to \mathcal{G} \to
\bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j)
\to
\mathcal{F} \to 0
$$
By Lemma \ref{lemma-coherent-abelian-Noetherian}
we see that $\mathcal{G}$ is coherent. The long exact
cohomology sequence gives an exact sequence
$$
H^i(\mathbf{P}^n_R, \bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j))
\to
H^i(\mathbf{P}^n_R, \mathcal{F})
\to
H^{i + 1}(\mathbf{P}^n_R, \mathcal{G}).
$$
By induction assumption the right $R$-module is finite and by
Lemma \ref{lemma-cohomology-projective-space-over-ring} the left
$R$-module is finite. Since $R$ is Noetherian it follows immediately
that $H^i(\mathbf{P}^n_R, \mathcal{F})$ is a finite $R$-module.
This proves the induction step for assertion (3).
Since $\mathcal{O}_{\mathbf{P}^n_R}(d)$ is invertible
we see that twisting on $\mathbf{P}^n_R$ is an exact functor (since
you get it by tensoring with an invertible sheaf, see
Constructions, Definition \ref{constructions-definition-twist}).
This means that for all $d \in \mathbf{Z}$ the sequence
$$
0 \to \mathcal{G}(d) \to
\bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j + d)
\to
\mathcal{F}(d) \to 0
$$
is short exact. The resulting cohomology sequence is
$$
H^i(\mathbf{P}^n_R, \bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j + d))
\to
H^i(\mathbf{P}^n_R, \mathcal{F}(d))
\to
H^{i + 1}(\mathbf{P}^n_R, \mathcal{G}(d)).
$$
By induction assumption we see the module on the right is zero
for $d \gg 0$ and by the computation in
Lemma \ref{lemma-cohomology-projective-space-over-ring}
the module on the left is zero as soon as $d \geq -\min\{d_j\}$
and $i \geq 1$. Hence the induction step for assertion (4).
This concludes the proof of (3) and (4).

\medskip\noindent
In order to prove (5) note that for all sufficiently large $d$
the map
$$
H^0(\mathbf{P}^n_R, \bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j + d))
\to
H^0(\mathbf{P}^n_R, \mathcal{F}(d))
$$
is surjective by the vanishing of $H^1(\mathbf{P}^n_R, \mathcal{G}(d))$
we just proved. In other words, the module
$$
M_k
=
\bigoplus\nolimits_{d \geq k} H^0(\mathbf{P}^n_R, \mathcal{F}(d))
$$
is for $k$ large enough a quotient of the corresponding module
$$
N_k
=
\bigoplus\nolimits_{d \geq k} H^0(\mathbf{P}^n_R,
\bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j + d)
)
$$
When $k$ is sufficiently small (e.g.\ $k < -d_j$ for all $j$) then
$$
N_k = \bigoplus\nolimits_{j = 1, \ldots, r}
R[T_0, \ldots, T_n](d_j)
$$
by our computations in Section \ref{section-cohomology-projective-space}.
In particular it is finitely generated.
Suppose $k \in \mathbf{Z}$ is arbitrary.
Choose $k_{-} \ll k \ll k_{+}$.
Consider the diagram
$$
\xymatrix{
N_{k_{-}} & N_{k_{+}} \ar[d] \ar[l] \\
M_k & M_{k_{+}} \ar[l]
}
$$
where the vertical arrow is the surjective map above and
the horizontal arrows are the obvious inclusion maps.
By what was said above we see that $N_{k_{-}}$ is a finitely
generated $R[T_0, \ldots, T_n]$-module. Hence $N_{k_{+}}$ is
a finitely generated $R[T_0, \ldots, T_n]$-module because it
is a submodule of a finitely generated module and the ring
$R[T_0, \ldots, T_n]$ is Noetherian. Since the vertical arrow
is surjective we conclude that $M_{k_{+}}$ is a finitely
generated $R[T_0, \ldots, T_n]$-module. The quotient
$M_k/M_{k_{+}}$ is finite as an $R$-module since it is a
finite direct sum of the finite $R$-modules
$H^0(\mathbf{P}^n_R, \mathcal{F}(d))$ for $k \leq d < k_{+}$.
Note that we use part (3) for $i = 0$ here. Hence
$M_k/M_{k_{+}}$ is a fortiori a finite $R[T_0, \ldots, T_n]$-module.
In other words, we have sandwiched $M_k$ between two finite
$R[T_0, \ldots, T_n]$-modules and we win.
\end{proof}

\begin{lemma}
\label{lemma-coherent-on-proj}
Let $A$ be a graded ring such that $A_0$ is Noetherian and
$A$ is generated by finitely many elements of $A_1$ over $A_0$.
Set $X = \text{Proj}(A)$. Then $X$ is a Noetherian scheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
\begin{enumerate}
\item There exists an $r \geq 0$ and
$d_1, \ldots, d_r \in \mathbf{Z}$ and a surjection
$$
\bigoplus\nolimits_{j = 1, \ldots, r} \mathcal{O}_X(d_j)
\longrightarrow \mathcal{F}.
$$
\item For any $p$ the cohomology group $H^p(X, \mathcal{F})$ is a finite
$A_0$-module.
\item If $p > 0$, then $H^p(X, \mathcal{F}(d)) = 0$ for all $d$ large enough.
\item For any $k \in \mathbf{Z}$ the graded $A$-module
$$
\bigoplus\nolimits_{d \geq k} H^0(X, \mathcal{F}(d))
$$
is a finite $A$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
By assumption there exists a surjection of graded $A_0$-algebras
$$
A_0[T_0, \ldots, T_n] \longrightarrow A
$$
where $\deg(T_j) = 1$ for $j = 0, \ldots, n$. By Constructions, Lemma
\ref{constructions-lemma-surjective-graded-rings-generated-degree-1-map-proj}
this defines a closed immersion $i : X \to \mathbf{P}^n_{A_0}$
such that $i^*\mathcal{O}_{\mathbf{P}^n_{A_0}}(1) = \mathcal{O}_X(1)$.
In particular, $X$ is Noetherian as a closed subscheme of the Noetherian
scheme $\mathbf{P}^n_{A_0}$. We claim that the results of the lemma for
$\mathcal{F}$ follow from the corresponding
results of Lemma \ref{lemma-coherent-projective} for the coherent sheaf
$i_*\mathcal{F}$ (Lemma \ref{lemma-i-star-equivalence}) on
$\mathbf{P}^n_{A_0}$. For example, by this lemma there
exists a surjection
$$
\bigoplus\nolimits_{j = 1, \ldots, r} \mathcal{O}_{\mathbf{P}^n_{A_0}}(d_j)
\longrightarrow i_*\mathcal{F}.
$$
By adjunction this corresponds to a map
$\bigoplus_{j = 1, \ldots, r} \mathcal{O}_X(d_j) \longrightarrow \mathcal{F}$
which is surjective as well. The statements on cohomology follow from the
fact that
$H^p(X, \mathcal{F}(d)) = H^p(\mathbf{P}^n_{A_0}, i_*\mathcal{F}(d))$
by Lemma \ref{lemma-relative-affine-cohomology}.
\end{proof}

\begin{lemma}
\label{lemma-recover-tail-graded-module}
Let $A$ be a graded ring such that $A_0$ is Noetherian and $A$ is generated
by finitely many elements of $A_1$ over $A_0$. Let $M$ be a
finite graded $A$-module. Set $X = \text{Proj}(A)$ and let $\widetilde{M}$
be the quasi-coherent $\mathcal{O}_X$-module on $X$ associated to $M$.
The maps
$$
M_n \longrightarrow \Gamma(X, \widetilde{M}(n))
$$
from Constructions, Lemma \ref{constructions-lemma-apply-modules}
are isomorphisms for all sufficiently large $n$.
\end{lemma}

\begin{proof}
Because $M$ is a finite $A$-module we see that
$\widetilde{M}$ is a finite type $\mathcal{O}_X$-module,
i.e., a coherent $\mathcal{O}_X$-module.
Set $N = \bigoplus_{n \geq 0} \Gamma(X, \widetilde{M}(n))$.
We have to show that the map $M \to N$ of graded $A$-modules
is an isomorphism in all sufficiently large degrees.
By Properties, Lemma \ref{properties-lemma-proj-quasi-coherent}
we have a canonical isomorphism $\widetilde{N} \to \widetilde{M}$
such that $M_n \to N_n = \Gamma(X, \widetilde{M}(n))$
is the canonical map. Let $K = \Ker(M \to N)$ and $Q = \Coker(M \to N)$.
Recall that the functor
$M \mapsto \widetilde{M}$ is exact, see
Constructions, Lemma \ref{constructions-lemma-proj-sheaves}.
Hence we see that $\widetilde{K} = 0$ and $\widetilde{Q} = 0$.
On the other hand, $A$ is a Noetherian ring and $M$ and $N$
are finitely generated $A$-modules (for $N$ this follows from
the last part of Lemma \ref{lemma-coherent-on-proj}).
Hence $K$ and $Q$ are finite $A$-modules. Thus it suffices to show
that a finite $A$-module $K$ with $\widetilde{K} = 0$
has only finitely many nonzero homogeneous parts $K_d$.
To do this, let $x_1, \ldots, x_r \in K$ be homogeneous generators
say sitting in degrees $d_1, \ldots, d_r$.
Let $f_1, \ldots, f_n \in A_1$ be elements generating $A$ over $A_0$.
For each $i$ and $j$ there exists an $n_{ij} \geq 0$ such that
$f_i^{n_{ij}} x_j = 0$ in $K_{d_j + n_{ij}}$: if not then
$x_i/f_i^{d_i} \in K_{(f_i)}$ would not be zero, i.e., $\widetilde{K}$
would not be zero.
Then we see that $K_d$ is zero for $d > \max_j(d_j + \sum_i n_{ij})$
as every element of $K_d$ is a sum of terms where each term is a
monomials in the $f_i$ times one of the $x_j$ of total degree $d$.
\end{proof}

\noindent
Let $A$ be a graded ring such that $A_0$ is Noetherian and $A$ is generated
by finitely many elements of $A_1$ over $A_0$. Recall that
$A_+ = \bigoplus_{n > 0} A_n$ is the irrelevant ideal.
Let $M$ be a graded $A$-module. Recall that
$M$ is an $A_+$-power torsion module if for all $x \in M$
there is an $n \geq 1$ such that $(A_+)^n x = 0$, see
More on Algebra, Definition \ref{more-algebra-definition-f-power-torsion}.
If $M$ is finitely generated, then we see that
this is equivalent to $M_n = 0$ for $n \gg 0$.
Sometimes $A_+$-power torsion modules are called torsion modules.
Sometimes a graded $A$-module $M$ is called torsion free if
$x \in M$ with $(A_+)^n x = 0$, $n > 0$ implies $x = 0$.
Denote $\text{Mod}_A$ the category of graded $A$-modules,
$\text{Mod}^{fg}_A$ the full subcategory of finitely generated ones,
and $\text{Mod}^{fg}_{A, torsion}$ the full subcategory of
modules $M$ such that $M_n = 0$ for $n \gg 0$.

\begin{proposition}
\label{proposition-coherent-modules-on-proj}
Let $A$ be a graded ring such that $A_0$ is Noetherian and $A$ is generated
by finitely many elements of $A_1$ over $A_0$.
Set $X = \text{Proj}(A)$. The functor $M \mapsto \widetilde M$
induces an equivalence
$$
\text{Mod}^{fg}_A/\text{Mod}^{fg}_{A, torsion}
\longrightarrow
\textit{Coh}(\mathcal{O}_X)
$$
whose quasi-inverse is given by
$\mathcal{F} \longmapsto \bigoplus_{n \geq 0} \Gamma(X, \mathcal{F}(n))$.
\end{proposition}

\begin{proof}
The subcategory $\text{Mod}^{fg}_{A, torsion}$ is a Serre subcategory
of $\text{Mod}^{fg}_A$, see
Homology, Definition \ref{homology-definition-serre-subcategory}.
This is clear from the description of objects given above but it also follows
from More on Algebra, Lemma \ref{more-algebra-lemma-I-power-torsion}.
Hence the quotient category on the left of the arrow is defined
in Homology, Lemma \ref{homology-lemma-serre-subcategory-is-kernel}.
To define the functor of the proposition, it suffices to show that
the functor $M \mapsto \widetilde M$ sends torsion modules to $0$.
This is clear because for any $f \in A_+$ homogeneous the
module $M_f$ is zero and hence the value $M_{(f)}$ of $\widetilde M$
on $D_+(f)$ is zero too.

\medskip\noindent
By Lemma \ref{lemma-coherent-on-proj} the proposed quasi-inverse
makes sense. Namely, the lemma shows that
$\mathcal{F} \longmapsto \bigoplus_{n \geq 0} \Gamma(X, \mathcal{F}(n))$
is a functor $\textit{Coh}(\mathcal{O}_X) \to \text{Mod}^{fg}_A$
which we can compose with the quotient functor
$\text{Mod}^{fg}_A \to \text{Mod}^{fg}_A/\text{Mod}^{fg}_{A, torsion}$.

\medskip\noindent
By Lemma \ref{lemma-recover-tail-graded-module}
the composite left to right to left is isomorphic to the identity functor.

\medskip\noindent
Finally, let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Set $M = \bigoplus_{n \in \mathbf{Z}} \Gamma(X, \mathcal{F}(n))$
viewed as a graded $A$-module, so that our functor sends $\mathcal{F}$ to
$M_{\geq 0} = \bigoplus_{n \geq 0} M_n$.
By Properties, Lemma \ref{properties-lemma-proj-quasi-coherent}
the canonical map $\widetilde M \to \mathcal{F}$
is an isomorphism. Since the inclusion map
$M_{\geq 0} \to M$ defines an isomorphism
$\widetilde{M_{\geq 0}} \to \widetilde M$ we conclude that
the composite right to left to right is isomorphic to the identity
functor as well.
\end{proof}





\section{Coherent sheaves on Proj, II}
\label{section-coherent-proj-general}

\noindent
In this section we discuss coherent sheaves on $\text{Proj}(A)$
where $A$ is a Noetherian graded ring. Most of the results will
be deduced by sleight of hand from the corresponding result in the
previous section where we discussed what happens if $A$ is generated
by degree $1$ elements.

\begin{lemma}
\label{lemma-coherent-on-proj-general}
Let $A$ be a Noetherian graded ring. Set $X = \text{Proj}(A)$. Then $X$
is a Noetherian scheme. Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
\begin{enumerate}
\item There exists an $r \geq 0$ and
$d_1, \ldots, d_r \in \mathbf{Z}$ and a surjection
$$
\bigoplus\nolimits_{j = 1, \ldots, r} \mathcal{O}_X(d_j)
\longrightarrow \mathcal{F}.
$$
\item For any $p$ the cohomology group $H^p(X, \mathcal{F})$ is a finite
$A_0$-module.
\item If $p > 0$, then $H^p(X, \mathcal{F}(d)) = 0$ for all $d$ large enough.
\item For any $k \in \mathbf{Z}$ the graded $A$-module
$$
\bigoplus\nolimits_{d \geq k} H^0(X, \mathcal{F}(d))
$$
is a finite $A$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
We will prove this by reducing the statement to
Lemma \ref{lemma-coherent-on-proj}.
By Algebra, Lemmas \ref{algebra-lemma-graded-Noetherian} and
\ref{algebra-lemma-S-plus-generated} the ring $A_0$ is Noetherian
and $A$ is generated over $A_0$ by finitely many elements
$f_1, \ldots, f_r$ homogeneous of positive degree.
Let $d$ be a sufficiently divisible integer. Set $A' = A^{(d)}$ with notation
as in Algebra, Section \ref{algebra-section-graded}.
Then $A'$ is generated over $A'_0 = A_0$ by elements of
degree $1$, see Algebra, Lemma \ref{algebra-lemma-uple-generated-degree-1}.
Thus Lemma \ref{lemma-coherent-on-proj} applies to $X' = \text{Proj}(A')$.

\medskip\noindent
By Constructions, Lemma \ref{constructions-lemma-d-uple} there exist
an isomorphism of schemes $i : X \to X'$ and
isomorphisms $\mathcal{O}_X(nd) \to i^*\mathcal{O}_{X'}(n)$
compatible with the map $A' \to A$ and the maps
$A_n \to H^0(X, \mathcal{O}_X(n)$ and $A'_n \to H^0(X', \mathcal{O}_{X'}(n))$.
Thus Lemma \ref{lemma-coherent-on-proj} implies $X$ is Noetherian and that
(1) and (2) hold. To see (3) and (4)
we can use that for any fixed $k$, $p$, and $q$ we have
$$
\bigoplus\nolimits_{dn + q \geq k} H^p(X, \mathcal{F}(dn + q)) =
\bigoplus\nolimits_{dn + q \geq k} H^p(X', (i_*\mathcal{F}(q))(n)
$$
by the compatibilities above. If $p > 0$, we have the vanishing of the right
hand side for $k$ depending on $q$ large enough by
Lemma \ref{lemma-coherent-on-proj}. Since there are only a finite number
of congruence classes of integers modulo $d$, we see that (3) holds for
$\mathcal{F}$ on $X$. If $p = 0$, then we have that the right hand side
is a finite $A'$-module by Lemma \ref{lemma-coherent-on-proj}. Using
the finiteness of congruence classes once more, we find that
$\bigoplus_{n \geq k} H^0(X, \mathcal{F}(n))$ is a finite $A'$-module too.
Since the $A'$-module structure comes from the $A$-module structure
(by the compatibilities mentioned above), we conclude it is finite
as an $A$-module as well.
\end{proof}

\begin{lemma}
\label{lemma-recover-tail-graded-module-general}
Let $A$ be a Noetherian graded ring and let $d$ be the lcm of generators
of $A$ over $A_0$. Let $M$ be a finite graded $A$-module.
Set $X = \text{Proj}(A)$ and let $\widetilde{M}$ be
the quasi-coherent $\mathcal{O}_X$-module on $X$ associated to $M$.
Let $k \in \mathbf{Z}$.
\begin{enumerate}
\item $N' = \bigoplus_{n \geq k} H^0(X, \widetilde{M(n)})$
is a finite $A$-module,
\item $N = \bigoplus_{n \geq k} H^0(X, \widetilde{M}(n))$
is a finite $A$-module,
\item there is a canonical map $N \to N'$,
\item if $k$ is small enough there is a canonical map $M \to N'$,
\item the map $M_n \to N'_n$ is an isomorphism for $n \gg 0$,
\item $N_n \to N'_n$ is an isomorphism for $d | n$.
\end{enumerate}
\end{lemma}

\begin{proof}
The map $N \to N'$ in (3) comes from
Constructions, Equation (\ref{constructions-equation-multiply-more-generally})
by taking global sections.

\medskip\noindent
By
Constructions, Equation
(\ref{constructions-equation-global-sections-more-generally})
there is a map of graded $A$-modules
$M \to \bigoplus_{n \in \mathbf{Z}} H^0(X, \widetilde{M(n)})$.
If the generators of $M$ sit in degrees $\geq k$, then the image
is contained in the submodule
$N' \subset \bigoplus_{n \in \mathbf{Z}} H^0(X, \widetilde{M(n)})$
and we get the map in (4).

\medskip\noindent
By Algebra, Lemmas \ref{algebra-lemma-graded-Noetherian} and
\ref{algebra-lemma-S-plus-generated} the ring $A_0$ is Noetherian
and $A$ is generated over $A_0$ by finitely many elements
$f_1, \ldots, f_r$ homogeneous of positive degree.
Let $d = \text{lcm}(\deg(f_i))$. Then we see that (6) holds
for example by
Constructions, Lemma \ref{constructions-lemma-where-invertible}.

\medskip\noindent
Because $M$ is a finite $A$-module we see that
$\widetilde{M}$ is a finite type $\mathcal{O}_X$-module,
i.e., a coherent $\mathcal{O}_X$-module.
Thus part (2) follows from Lemma \ref{lemma-coherent-on-proj-general}.

\medskip\noindent
We will deduce (1) from (2) using a trick. For $q \in \{0, \ldots, d - 1\}$
write
$$
{}^qN = \bigoplus\nolimits_{n + q \geq k} H^0(X, \widetilde{M(q)}(n))
$$
By part (2) these are finite $A$-modules. The Noetherian ring $A$
is finite over $A^{(d)} = \bigoplus_{n \geq 0} A_{dn}$, because
it is generated by $f_i$ over $A^{(d)}$ and $f_i^d \in A^{(d)}$.
Hence ${}^qN$ is a finite $A^{(d)}$-module.
Moreover, $A^{(d)}$ is Noetherian (follows from
Algebra, Lemma \ref{algebra-lemma-dehomogenize-finite-type}).
It follows that the $A^{(d)}$-submodule
${}^qN^{(d)} = \bigoplus_{n \in \mathbf{Z}} {}^qN_{dn}$
is a finite module over $A^{(d)}$. Using the isomorphisms
$\widetilde{M(dn + q)} = \widetilde{M(q)}(dn)$ we can write
$$
N' =
\bigoplus\nolimits_{q \in \{0, \ldots, d - 1\}}
\bigoplus\nolimits_{dn + q \geq k}
H^0(X, \widetilde{M(q)}(dn)) =
\bigoplus\nolimits_{q \in \{0, \ldots, d - 1\}} {}^qN^{(d)}
$$
Thus $N'$ is finite over $A^{(d)}$ and a fortiori finite over $A$.
Thus (1) is true.

\medskip\noindent
Let $K$ be a finite $A$-module such that $\widetilde{K} = 0$. We claim
that $K_n = 0$ for $d|n$ and $n \gg 0$. Arguing as above we see that
$K^{(d)}$ is a finite $A^{(d)}$-module. Let
$x_1, \ldots, x_m \in K$ be homogeneous generators of $K^{(d)}$
over $A^{(d)}$, say sitting in degrees $d_1, \ldots, d_m$ with $d | d_j$.
For each $i$ and $j$ there exists an $n_{ij} \geq 0$ such that
$f_i^{n_{ij}} x_j = 0$ in $K_{d_j + n_{ij}}$: if not then
$x_j/f_i^{d_i/\deg(f_i)} \in K_{(f_i)}$ would not be zero, i.e.,
$\widetilde{K}$ would not be zero. Here we use that $\deg(f_i) | d | d_j$
for all $i, j$. We conclude that $K_n$ is zero for
$n$ with $d | n$ and $n > \max_j (d_j + \sum_i n_{ij} \deg(f_i))$
as every element of $K_n$ is a sum of terms where each term is a
monomials in the $f_i$ times one of the $x_j$ of total degree $n$.

\medskip\noindent
To finish the proof, we have to show that $M \to N'$ is an isomorphism
in all sufficiently large degrees. The map $N \to N'$ induces an
isomorphism $\widetilde{N} \to \widetilde{N'}$ because on the affine
opens $D_+(f_i) = D_+(f_i^d)$ the corresponding modules are isomorphic:
$N_{(f_i)} \cong N_{(f_i^d)} \cong N'_{(f_i^d)} \cong N'_{(f_i)}$
by property (6).
By Properties, Lemma \ref{properties-lemma-proj-quasi-coherent}
we have a canonical isomorphism $\widetilde{N} \to \widetilde{M}$.
The composition $\widetilde{N} \to \widetilde{M} \to \widetilde{N'}$
is the isomorphism above (proof omitted; hint: look on standard
affine opens to check this). Thus the map $M \to N'$ induces an isomorphism
$\widetilde{M} \to \widetilde{N'}$.
Let $K = \Ker(M \to N')$ and $Q = \Coker(M \to N')$.
Recall that the functor
$M \mapsto \widetilde{M}$ is exact, see
Constructions, Lemma \ref{constructions-lemma-proj-sheaves}.
Hence we see that $\widetilde{K} = 0$ and $\widetilde{Q} = 0$.
By the result of the previous paragraph we see that $K_n = 0$ and
$Q_n = 0$ for $d | n$ and $n \gg 0$. At this point we finally see
the advantage of using $N'$ over $N$: the functor $M \leadsto N'$
is compatible with shifts (immediate from the construction).
Thus, repeating the whole argument with $M$ replaced by $M(q)$
we find that $K_n = 0$ and $Q_n = 0$ for $n \equiv q \bmod d$
and $n \gg 0$. Since there are
only finitely many congruence classes modulo $n$ the proof is finished.
\end{proof}

\noindent
Let $A$ be a Noetherian graded ring. Recall that
$A_+ = \bigoplus_{n > 0} A_n$ is the irrelevant ideal.
By Algebra, Lemmas \ref{algebra-lemma-graded-Noetherian} and
\ref{algebra-lemma-S-plus-generated} the ring $A_0$ is Noetherian
and $A$ is generated over $A_0$ by finitely many elements
$f_1, \ldots, f_r$ homogeneous of positive degree.
Let $d = \text{lcm}(\deg(f_i))$. Let $M$ be a graded $A$-module.
In this situation we say a homogeneous element $x \in M$
is {\it irrelevant}\footnote{This is nonstandard notation.} if
$$
(A_+ x)_{nd} = 0\text{ for all }n \gg 0
$$
If $x \in M$ is homogeneous and irrelevant and $f \in A$
is homogeneous, then $fx$ is irrelevant too. Hence
the set of irrelevant elements generate a graded submodule
$M_{irrelevant} \subset M$. We will say $M$ is {\it irrelevant}
if every homogeneous element of $M$ is irrelevant, i.e.,
if $M_{irrelevant} = M$.
If $M$ is finitely generated, then we see that
this is equivalent to $M_{nd} = 0$ for $n \gg 0$.
Denote $\text{Mod}_A$ the category of graded $A$-modules,
$\text{Mod}^{fg}_A$ the full subcategory of finitely generated ones,
and $\text{Mod}^{fg}_{A, irrelevant}$ the full subcategory of
irrelevant modules.

\begin{proposition}
\label{proposition-coherent-modules-on-proj-general}
Let $A$ be a Noetherian graded ring. Set $X = \text{Proj}(A)$. The functor
$M \mapsto \widetilde M$ induces an equivalence
$$
\text{Mod}^{fg}_A/\text{Mod}^{fg}_{A, irrelevant}
\longrightarrow
\textit{Coh}(\mathcal{O}_X)
$$
whose quasi-inverse is given by
$\mathcal{F} \longmapsto \bigoplus_{n \geq 0} \Gamma(X, \mathcal{F}(n))$.
\end{proposition}

\begin{proof}
We urge the reader to read the proof in the case where $A$
is generated in degree $1$ first, see
Proposition \ref{proposition-coherent-modules-on-proj}.
Let $f_1, \ldots, f_r \in A$ be homogeneous elements of positive degree
which generate $A$ over $A_0$. Let $d$ be the lcm of the degrees
$d_i$ of $f_i$. Let $M$ be a finite $A$-module.
Let us show that $\widetilde{M}$ is zero if and
only if $M$ is an irrelevant graded $A$-module (as defined above
the statement of the proposition). Namely, let $x \in M$ be a
homogeneous element.
Choose $k \in \mathbf{Z}$ sufficiently small and let
$N \to N'$ and $M \to N'$ be as in
Lemma \ref{lemma-recover-tail-graded-module-general}.
We may also pick $l$ sufficiently large such that
$M_n \to N_n$ is an isomorphism for $n \geq l$.
If $\widetilde{M}$ is zero, then $N = 0$.
Thus for any $f \in A_+$ homogeneous with
$\deg(f) + \deg(x) = nd$ and $nd > l$ we see that $fx$ is zero
because $N_{nd} \to N'_{nd}$ and $M_{nd} \to N'_{nd}$ are isomorphisms.
Hence $x$ is irrelevant.
Conversely, assume $M$ is irrelevant. Then $M_{nd}$ is zero
for $n \gg 0$ (see discussion above proposition).
Clearly this implies that $M_{(f_i)} = M_{(f_i^{d/\deg(f_i)})} = 0$,
whence $\widetilde{M} = 0$ by construction.

\medskip\noindent
It follows that the subcategory $\text{Mod}^{fg}_{A, irrelevant}$
is a Serre subcategory of $\text{Mod}^{fg}_A$ as the kernel
of the exact functor $M \mapsto \widetilde M$, see
Homology, Lemma \ref{homology-lemma-kernel-exact-functor}
and Constructions, Lemma \ref{constructions-lemma-proj-sheaves}.
Hence the quotient category on the left of the arrow is defined
in Homology, Lemma \ref{homology-lemma-serre-subcategory-is-kernel}.
To define the functor of the proposition, it suffices to show that
the functor $M \mapsto \widetilde M$ sends irrelevant modules to $0$
which we have shown above.

\medskip\noindent
By Lemma \ref{lemma-coherent-on-proj-general} the proposed quasi-inverse
makes sense. Namely, the lemma shows that
$\mathcal{F} \longmapsto \bigoplus_{n \geq 0} \Gamma(X, \mathcal{F}(n))$
is a functor $\textit{Coh}(\mathcal{O}_X) \to \text{Mod}^{fg}_A$
which we can compose with the quotient functor
$\text{Mod}^{fg}_A \to \text{Mod}^{fg}_A/\text{Mod}^{fg}_{A, irrelevant}$.

\medskip\noindent
By Lemma \ref{lemma-recover-tail-graded-module-general}
the composite left to right to left is isomorphic to the identity functor.
Namely, let $M$ be a finite graded $A$-module and let
$k \in \mathbf{Z}$ sufficiently small and let
$N \to N'$ and $M \to N'$ be as in
Lemma \ref{lemma-recover-tail-graded-module-general}.
Then the kernel and cokernel of $M \to N'$ are nonzero in
only finitely many degrees, hence are irrelevant. Moreover, the
kernel and cokernel of the map $N \to N'$ are zero in all sufficiently
large degrees divisible by $d$, hence these are irrelevant modules too.
Thus $M \to N'$ and $N \to N'$ are both isomorphisms in the quotient
category, as desired.

\medskip\noindent
Finally, let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Set $M = \bigoplus_{n \in \mathbf{Z}} \Gamma(X, \mathcal{F}(n))$
viewed as a graded $A$-module, so that our functor sends $\mathcal{F}$ to
$M_{\geq 0} = \bigoplus_{n \geq 0} M_n$.
By Properties, Lemma \ref{properties-lemma-proj-quasi-coherent}
the canonical map $\widetilde M \to \mathcal{F}$
is an isomorphism. Since the inclusion map
$M_{\geq 0} \to M$ defines an isomorphism
$\widetilde{M_{\geq 0}} \to \widetilde M$ we conclude that
the composite right to left to right is isomorphic to the identity
functor as well.
\end{proof}










\section{Higher direct images along projective morphisms}
\label{section-projective-pushforward}

\noindent
We first state and prove a result for when the base is affine
and then we deduce some results for projective morphisms.

\begin{lemma}
\label{lemma-coherent-proper-ample}
Let $R$ be a Noetherian ring. Let $X \to \Spec(R)$ be a proper morphism.
Let $\mathcal{L}$ be an ample invertible sheaf on $X$. Let $\mathcal{F}$
be a coherent $\mathcal{O}_X$-module.
\begin{enumerate}
\item The graded ring
$A = \bigoplus_{d \geq 0} H^0(X, \mathcal{L}^{\otimes d})$
is a finitely generated $R$-algebra.
\item There exists an $r \geq 0$ and
$d_1, \ldots, d_r \in \mathbf{Z}$ and a surjection
$$
\bigoplus\nolimits_{j = 1, \ldots, r} \mathcal{L}^{\otimes d_j}
\longrightarrow \mathcal{F}.
$$
\item For any $p$ the cohomology group $H^p(X, \mathcal{F})$ is a finite
$R$-module.
\item If $p > 0$, then
$H^p(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d}) = 0$
for all $d$ large enough.
\item For any $k \in \mathbf{Z}$ the graded $A$-module
$$
\bigoplus\nolimits_{d \geq k}
H^0(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d})
$$
is a finite $A$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
By
Morphisms, Lemma \ref{morphisms-lemma-finite-type-over-affine-ample-very-ample}
there exists a $d > 0$ and an immersion $i : X \to \mathbf{P}^n_R$
such that $\mathcal{L}^{\otimes d} \cong i^*\mathcal{O}_{\mathbf{P}^n_R}(1)$.
Since $X$ is proper over $R$ the morphism $i$ is a closed immersion
(Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}).
Thus we have $H^i(X, \mathcal{G}) = H^i(\mathbf{P}^n_R, i_*\mathcal{G})$
for any quasi-coherent sheaf $\mathcal{G}$ on $X$
(by Lemma \ref{lemma-relative-affine-cohomology} and the fact that
closed immersions are affine, see
Morphisms, Lemma \ref{morphisms-lemma-closed-immersion-affine}).
Moreover, if $\mathcal{G}$ is coherent, then $i_*\mathcal{G}$
is coherent as well (Lemma \ref{lemma-i-star-equivalence}).
We will use these facts without further mention.

\medskip\noindent
Proof of (1). Set $S = R[T_0, \ldots, T_n]$ so that
$\mathbf{P}^n_R = \text{Proj}(S)$.
Observe that $A$ is an $S$-algebra (but the ring map $S \to A$ is not
a homomorphism of graded rings because $S_n$ maps into $A_{dn}$).
By the projection formula
(Cohomology, Lemma \ref{cohomology-lemma-projection-formula})
we have
$$
i_*(\mathcal{L}^{\otimes nd + q}) =
i_*(\mathcal{L}^{\otimes q})
\otimes_{\mathcal{O}_{\mathbf{P}^n_R}}
\mathcal{O}_{\mathbf{P}^n_R}(n)
$$
for all $n \in \mathbf{Z}$. We conclude that $\bigoplus_{n \geq 0} A_{nd + q}$
is a finite graded $S$-module by Lemma \ref{lemma-coherent-projective}.
Since
$A = \bigoplus_{q \in \{0, \ldots, d - 1} \bigoplus_{n \geq 0} A_{nd + q}$
we see that $A$ is finite as an $S$-algebra, hence (1) is true.

\medskip\noindent
Proof of (2). This follows from
Properties, Proposition \ref{properties-proposition-characterize-ample}.

\medskip\noindent
Proof of (3). Apply Lemma \ref{lemma-coherent-projective}
and use $H^p(X, \mathcal{F}) = H^p(\mathbf{P}^n_R, i_*\mathcal{F})$.

\medskip\noindent
Proof of (4). Fix $p > 0$. By the projection formula we have
$$
i_*(\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes nd + q}) =
i_*(\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes q})
\otimes_{\mathcal{O}_{\mathbf{P}^n_R}}
\mathcal{O}_{\mathbf{P}^n_R}(n)
$$
for all $n \in \mathbf{Z}$. By Lemma \ref{lemma-coherent-projective}
we conclude that $H^p(X, \mathcal{F} \otimes \mathcal{L}^{nd + q}) = 0$
for $n \gg 0$. Since there are only finitely many congruence classes
of integers modulo $d$ this proves (4).

\medskip\noindent
Proof of (5). Fix an integer $k$. Set
$M = \bigoplus_{n \geq k} H^0(X, \mathcal{F} \otimes \mathcal{L}^{\otimes n})$.
Arguing as above we conclude that $\bigoplus_{nd + q \geq k} A_{nd + q}$
is a finite graded $S$-module. Since
$M = \bigoplus_{q \in \{0, \ldots, d - 1\}}
\bigoplus_{nd + q \geq k} M_{nd + q}$
we see that $M$ is finite as an $S$-module. Since the $S$-module structure
factors through the ring map $S \to A$, we conclude that $M$ is finite
as an $A$-module.
\end{proof}

\begin{lemma}
\label{lemma-kill-by-twisting}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Let $\mathcal{L}$ be an invertible sheaf on $X$.
Assume that
\begin{enumerate}
\item $S$ is Noetherian,
\item $f$ is proper,
\item $\mathcal{F}$ is coherent, and
\item $\mathcal{L}$ is relatively ample on $X/S$.
\end{enumerate}
Then there exists an $n_0$ such that for all $n \geq n_0$
we have
$$
R^pf_*\left(\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}\right)
=
0
$$
for all $p > 0$.
\end{lemma}

\begin{proof}
Choose a finite affine open covering $S = \bigcup V_j$ and
set $X_j = f^{-1}(V_j)$.
Clearly, if we solve the question for each of the finitely many
systems $(X_j \to V_j, \mathcal{L}|_{X_j}, \mathcal{F}|_{V_j})$
then the result follows. Thus we may assume $S$ is affine.
In this case the vanishing of
$R^pf_*(\mathcal{F} \otimes \mathcal{L}^{\otimes n})$
is equivalent to the vanishing of
$H^p(X, \mathcal{F} \otimes \mathcal{L}^{\otimes n})$, see
Lemma \ref{lemma-quasi-coherence-higher-direct-images-application}.
Thus the required vanishing follows
from Lemma \ref{lemma-coherent-proper-ample} (which applies because
$\mathcal{L}$ is ample on $X$ by Morphisms, Lemma
\ref{morphisms-lemma-finite-type-over-affine-ample-very-ample}).
\end{proof}

\begin{lemma}
\label{lemma-locally-projective-pushforward}
Let $S$ be a locally Noetherian scheme.
Let $f : X \to S$ be a locally projective morphism.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Then $R^if_*\mathcal{F}$ is a coherent $\mathcal{O}_S$-module
for all $i \geq 0$.
\end{lemma}

\begin{proof}
We first remark that a locally projective morphism is proper
(Morphisms, Lemma \ref{morphisms-lemma-locally-projective-proper})
and hence of finite type.
In particular $X$ is locally Noetherian
(Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian})
and hence the statement makes sense.
Moreover, by Lemma \ref{lemma-quasi-coherence-higher-direct-images}
the sheaves $R^pf_*\mathcal{F}$ are quasi-coherent.

\medskip\noindent
Having said this the statement is local on $S$ (for example by
Cohomology, Lemma \ref{cohomology-lemma-localize-higher-direct-images}).
Hence we may assume $S = \Spec(R)$ is the spectrum of
a Noetherian ring, and $X$ is a closed subscheme of
$\mathbf{P}^n_R$ for some $n$, see
Morphisms, Lemma \ref{morphisms-lemma-characterize-locally-projective}.
In this case, the sheaves $R^pf_*\mathcal{F}$ are the quasi-coherent
sheaves associated to the $R$-modules $H^p(X, \mathcal{F})$, see
Lemma \ref{lemma-quasi-coherence-higher-direct-images-application}.
Hence it suffices to show that $R$-modules $H^p(X, \mathcal{F})$
are finite $R$-modules (Lemma \ref{lemma-coherent-Noetherian}).
This follows from Lemma \ref{lemma-coherent-proper-ample}
(because the restriction of $\mathcal{O}_{\mathbf{P}^n_R}(1)$
to $X$ is ample on $X$).
\end{proof}








\section{Ample invertible sheaves and cohomology}
\label{section-ample-cohomology}

\noindent
Here is a criterion for ampleness on proper schemes over affine bases
in terms of vanishing of cohomology after twisting.

\begin{lemma}
\label{lemma-vanshing-gives-ample}
\begin{reference}
\cite[III Proposition 2.6.1]{EGA}
\end{reference}
Let $R$ be a Noetherian ring. Let $f : X \to \Spec(R)$ be a proper morphism.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
The following are equivalent
\begin{enumerate}
\item $\mathcal{L}$ is ample on $X$ (this is equivalent to many other
things, see
Properties, Proposition \ref{properties-proposition-characterize-ample} and
Morphisms, Lemma
\ref{morphisms-lemma-finite-type-over-affine-ample-very-ample}),
\item for every coherent $\mathcal{O}_X$-module $\mathcal{F}$ there exists
an $n_0 \geq 0$ such that
$H^p(X, \mathcal{F} \otimes \mathcal{L}^{\otimes n}) = 0$ for all $n \geq n_0$
and $p > 0$, and
\item for every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_X$, there exists an $n \geq 1$
such that $H^1(X, \mathcal{I} \otimes \mathcal{L}^{\otimes n}) = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
The implication (1) $\Rightarrow$ (2) follows from
Lemma \ref{lemma-coherent-proper-ample}.
The implication (2) $\Rightarrow$ (3) is trivial.
The implication (3) $\Rightarrow$ (1) is
Lemma \ref{lemma-quasi-compact-h1-zero-invertible}.
\end{proof}

\begin{lemma}
\label{lemma-surjective-finite-morphism-ample}
Let $R$ be a Noetherian ring. Let $f : Y \to X$ be a morphism of
schemes proper over $R$. Let $\mathcal{L}$ be an
invertible $\mathcal{O}_X$-module. Assume $f$ is finite and surjective.
Then $\mathcal{L}$ is ample if and only if $f^*\mathcal{L}$ is ample.
\end{lemma}

\begin{proof}
The pullback of an ample invertible sheaf by a quasi-affine morphism
is ample, see Morphisms, Lemma
\ref{morphisms-lemma-pullback-ample-tensor-relatively-ample}.
This proves one of the implications as a finite morphism is affine
by definition. To prove the other we will use
the criterion of Lemma \ref{lemma-vanshing-gives-ample}.

\medskip\noindent
Assume that $f^*\mathcal{L}$ is ample. Let $P$ be the following property on
coherent $\mathcal{O}_X$-modules $\mathcal{F}$: there exists an $n_0$
such that $H^p(X, \mathcal{F} \otimes \mathcal{L}^{\otimes n}) = 0$
for all $n \geq n_0$ and $p > 0$. We will prove that $P$ holds
for any coherent $\mathcal{O}_X$-module $\mathcal{F}$, which suffices
to prove that $\mathcal{L}$ is ample.
We are going to apply Lemma \ref{lemma-property-higher-rank-cohomological}.
Thus we have to verify (1), (2) and (3) of that lemma for $P$.
Property (1) follows from the long exact cohomology sequence associated
to a short exact sequence of sheaves and the fact that tensoring with
an invertible sheaf is an exact functor. Property (2) follows since
$H^p(X, -)$ is an additive functor. To see (3) let $Z \subset X$ be
an integral closed subscheme with generic point $\xi$.
Let $\mathcal{F}$ be a coherent sheaf on $Y$ such that
the support of $f_*\mathcal{F}$ is equal to $Z$
and $(f_*\mathcal{F})_\xi$ is annihilated by $\mathfrak m_\xi$,
see Lemma \ref{lemma-finite-morphism-Noetherian}. We claim that
taking $\mathcal{G} = f_*\mathcal{F}$ works. We only have to verify
part (3)(c) of Lemma \ref{lemma-property-higher-rank-cohomological}.
Hence assume that $\mathcal{J} \subset \mathcal{O}_X$ is a
quasi-coherent sheaf of ideals such that
$\mathcal{J}_\xi = \mathcal{O}_{X, \xi}$.
A finite morphism is affine hence by
Lemma \ref{lemma-affine-morphism-projection-ideal} we see that
$\mathcal{J}\mathcal{G} = f_*(f^{-1}\mathcal{J}\mathcal{F})$.
Also, as pointed out in the proof of
Lemma \ref{lemma-affine-morphism-projection-ideal} the sheaf
$f^{-1}\mathcal{J}\mathcal{F}$ is a coherent $\mathcal{O}_Y$-module.
By assumption we see that there exists an $n_0$ such that
$$
H^p(Y, f^{-1}\mathcal{J}\mathcal{F}
\otimes_{\mathcal{O}_Y} f^*\mathcal{L}^{\otimes n}) = 0,
$$
for $n \geq n_0$ and $p > 0$. Since $f$ is finite, hence affine, we see that
\begin{align*}
H^p(X, \mathcal{J}\mathcal{G} \otimes_{\mathcal{O}_X}
\mathcal{L}^{\otimes n})
& =
H^p(X, f_*(f^{-1}\mathcal{J}\mathcal{F}) \otimes_{\mathcal{O}_X}
\mathcal{L}^{\otimes n}) \\
& =
H^p(X, f_*(f^{-1}\mathcal{J}\mathcal{F} \otimes_{\mathcal{O}_Y}
f^*\mathcal{L}^{\otimes n})) \\
& =
H^p(Y, f^{-1}\mathcal{J}\mathcal{F} \otimes_{\mathcal{O}_Y}
f^*\mathcal{L}^{\otimes n}) = 0
\end{align*}
by references cited earlier in this proof.
Hence the quasi-coherent subsheaf $\mathcal{G}' = \mathcal{J}\mathcal{G}$
satisfies $P$. This verifies property (3)(c) of
Lemma \ref{lemma-property-higher-rank-cohomological} as desired.
\end{proof}

\noindent
Cohomology is functorial. In particular, given a ringed space $X$,
an invertible $\mathcal{O}_X$-module $\mathcal{L}$, a section
$s \in \Gamma(X, \mathcal{L})$ we get maps
$$
H^p(X, \mathcal{F})
\longrightarrow
H^p(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}), \quad
\xi \longmapsto s\xi
$$
induced by the map
$\mathcal{F} \to \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}$
which is multiplication by $s$. We set
$\Gamma_*(X, \mathcal{L}) =
\bigoplus_{n \geq 0} \Gamma(X, \mathcal{L}^{\otimes n})$
as a graded ring, see
Modules, Definition \ref{modules-definition-gamma-star}.
Given a sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ and an integer
$p \geq 0$ we set
$$
H^p_*(X, \mathcal{L}, \mathcal{F}) =
\bigoplus\nolimits_{n \in \mathbf{Z}} H^p(X,
\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})
$$
This is a graded $\Gamma_*(X, \mathcal{L})$-module by the multiplication
defined above. Warning: the notation $H^p_*(X, \mathcal{L}, \mathcal{F})$
is nonstandard.

\begin{lemma}
\label{lemma-invert-s-cohomology}
Let $X$ be a scheme. Let $\mathcal{L}$ be an invertible sheaf on $X$.
Let $s \in \Gamma(X, \mathcal{L})$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
If $X$ is quasi-compact and quasi-separated, the canonical map
$$
H^p_*(X, \mathcal{L}, \mathcal{F})_{(s)}
\longrightarrow
H^p(X_s, \mathcal{F})
$$
which maps $\xi/s^n$ to $s^{-n}\xi$ is an isomorphism.
\end{lemma}

\begin{proof}
Note that for $p = 0$ this is
Properties, Lemma \ref{properties-lemma-invert-s-sections}.
We will prove the statement using the induction
principle (Lemma \ref{lemma-induction-principle}) where for
$U \subset X$ quasi-compact open we let $P(U)$ be the property:
for all $p \geq 0$ the map
$$
H^p_*(U, \mathcal{L}, \mathcal{F})_{(s)}
\longrightarrow
H^p(U_s, \mathcal{F})
$$
is an isomorphism.

\medskip\noindent
If $U$ is affine, then both sides of the arrow displayed above
are zero for $p > 0$ by
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}
and
Properties, Lemma \ref{properties-lemma-affine-cap-s-open}
and the statement is true. If $P$ is true for $U$, $V$, and $U \cap V$,
then we can use the Mayer-Vietoris sequences
(Cohomology, Lemma \ref{cohomology-lemma-mayer-vietoris}) to obtain
a map of long exact sequences
$$
\xymatrix{
H^{p - 1}_*(U \cap V, \mathcal{L}, \mathcal{F})_{(s)} \ar[r] \ar[d] &
H^p_*(U \cup V, \mathcal{L}, \mathcal{F})_{(s)} \ar[r] \ar[d] &
H^p_*(U, \mathcal{L}, \mathcal{F})_{(s)}
\oplus
H^p_*(V, \mathcal{L}, \mathcal{F})_{(s)} \ar[d] \\
H^{p - 1}(U_s \cap V_s, \mathcal{F}) \ar[r]&
H^p(U_s \cup V_s, \mathcal{F}) \ar[r] &
H^p(U_s, \mathcal{F})
\oplus
H^p(V_s, \mathcal{F})
}
$$
(only a snippet shown). Observe that $U_s \cap V_s = (U \cap V)_s$ and
that $U_s \cup V_s = (U \cup V)_s$. Thus the left and right vertical
maps are isomorphisms (as well as one more to the right and one more
to the left which are not shown in the diagram).
We conclude that $P(U \cup V)$ holds by
the 5-lemma (Homology, Lemma \ref{homology-lemma-five-lemma}).
This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-section-affine-open-kills-classes}
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Let $s \in \Gamma(X, \mathcal{L})$ be a section.
Assume that
\begin{enumerate}
\item $X$ is quasi-compact and quasi-separated, and
\item $X_s$ is affine.
\end{enumerate}
Then for every quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$ and
every $p > 0$ and all $\xi \in H^p(X, \mathcal{F})$ there exists
an $n \geq 0$ such that $s^n\xi = 0$ in
$H^p(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})$.
\end{lemma}

\begin{proof}
Recall that $H^p(X_s, \mathcal{G})$ is zero for every quasi-coherent
module $\mathcal{G}$ by
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}.
Hence the lemma follows from
Lemma \ref{lemma-invert-s-cohomology}.
\end{proof}

\noindent
For a more general version of the following lemma see
Limits, Lemma \ref{limits-lemma-ample-on-reduction}.

\begin{lemma}
\label{lemma-ample-on-reduction}
Let $i : Z \to X$ be a closed immersion of Noetherian schemes
inducing a homeomorphism of underlying topological spaces.
Let $\mathcal{L}$ be an invertible sheaf on $X$.
Then $i^*\mathcal{L}$ is ample on $Z$, if and only if
$\mathcal{L}$ is ample on $X$.
\end{lemma}

\begin{proof}
If $\mathcal{L}$ is ample, then $i^*\mathcal{L}$ is ample for
example by Morphisms, Lemma
\ref{morphisms-lemma-pullback-ample-tensor-relatively-ample}.
Assume $i^*\mathcal{L}$ is ample. We have to show that $\mathcal{L}$
is ample on $X$.
Let $\mathcal{I} \subset \mathcal{O}_X$ be the coherent sheaf of ideals
cutting out the closed subscheme $Z$. Since $i(Z) = X$ set theoretically
we see that $\mathcal{I}^n = 0$ for some $n$ by
Lemma \ref{lemma-power-ideal-kills-sheaf}.
Consider the sequence
$$
X = Z_n \supset Z_{n - 1} \supset Z_{n - 2} \supset \ldots \supset Z_1 = Z
$$
of closed subschemes cut out by
$0 = \mathcal{I}^n \subset \mathcal{I}^{n - 1} \subset \ldots \subset
\mathcal{I}$. Then each of the closed immersions $Z_i \to Z_{i - 1}$
is defined by a coherent sheaf of ideals of square zero. In this way
we reduce to the case that $\mathcal{I}^2 = 0$.

\medskip\noindent
Consider the short exact sequence
$$
0 \to \mathcal{I} \to \mathcal{O}_X \to i_*\mathcal{O}_Z \to 0
$$
of quasi-coherent $\mathcal{O}_X$-modules. Tensoring with
$\mathcal{L}^{\otimes n}$ we obtain short exact sequences
\begin{equation}
\label{equation-ses}
0 \to \mathcal{I} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}
\to \mathcal{L}^{\otimes n} \to i_*i^*\mathcal{L}^{\otimes n} \to 0
\end{equation}
As $\mathcal{I}^2 = 0$, we can use
Morphisms, Lemma \ref{morphisms-lemma-i-star-equivalence}
to think of $\mathcal{I}$ as a quasi-coherent $\mathcal{O}_Z$-module
and then $\mathcal{I} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n} =
\mathcal{I} \otimes_{\mathcal{O}_Z} i^*\mathcal{L}^{\otimes n}$ with
obvious abuse of notation.
Moreover, the cohomology of this sheaf over $Z$ is canonically
the same as the cohomology of this sheaf over $X$ (as $i$ is a
homeomorphism).

\medskip\noindent
Let $x \in X$ be a point and denote $z \in Z$ the corresponding point.
Because $i^*\mathcal{L}$ is ample there exists an $n$ and a section
$s \in \Gamma(Z, i^*\mathcal{L}^{\otimes n})$ with $z \in Z_s$
and with $Z_s$ affine. The obstruction to lifting $s$ to a section
of $\mathcal{L}^{\otimes n}$ over $X$ is the boundary
$$
\xi = \partial s \in
H^1(X, \mathcal{I} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}) =
H^1(Z, \mathcal{I} \otimes_{\mathcal{O}_Z} i^*\mathcal{L}^{\otimes n})
$$
coming from the short exact sequence of sheaves (\ref{equation-ses}).
If we replace $s$ by $s^{e + 1}$ then $\xi$ is replaced by
$\partial(s^{e + 1}) = (e + 1) s^e \xi$ in
$H^1(Z, \mathcal{I} \otimes_{\mathcal{O}_Z} i^*\mathcal{L}^{\otimes (e + 1)n})$
because the boundary map for
$$
0 \to
\bigoplus\nolimits_{m \geq 0}
\mathcal{I} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes m} \to
\bigoplus\nolimits_{m \geq 0}
\mathcal{L}^{\otimes m} \to
\bigoplus\nolimits_{m \geq 0}
i_*i^*\mathcal{L}^{\otimes m} \to 0
$$
is a derivation by Cohomology, Lemma
\ref{cohomology-lemma-boundary-derivation-over-cup-product}. By
Lemma \ref{lemma-section-affine-open-kills-classes}
we see that $s^e \xi$ is zero for $e$ large enough.
Hence, after replacing $s$ by a power, we can assume $s$ is the image
of a section $s' \in \Gamma(X, \mathcal{L}^{\otimes n})$.
Then $X_{s'}$ is an open subscheme and $Z_s \to X_{s'}$ is a surjective
closed immersion of Noetherian schemes with $Z_s$ affine. Hence
$X_s$ is affine by
Lemma \ref{lemma-image-affine-finite-morphism-affine-Noetherian} and
we conclude that $\mathcal{L}$ is ample.
\end{proof}

\noindent
For a more general version of the following lemma see
Limits, Lemma \ref{limits-lemma-thickening-quasi-affine}.

\begin{lemma}
\label{lemma-thickening-quasi-affine}
Let $i : Z \to X$ be a closed immersion of Noetherian schemes
inducing a homeomorphism of underlying topological spaces.
Then $X$ is quasi-affine if and only if $Z$ is quasi-affine.
\end{lemma}

\begin{proof}
Recall that a scheme is quasi-affine
if and only if the structure sheaf is ample, see
Properties, Lemma \ref{properties-lemma-quasi-affine-O-ample}.
Hence if $Z$ is quasi-affine, then $\mathcal{O}_Z$ is ample,
hence $\mathcal{O}_X$ is ample by
Lemma \ref{lemma-ample-on-reduction}, hence
$X$ is quasi-affine. A proof of the converse, which
can also be seen in an elementary way, is gotten by
reading the argument just given backwards.
\end{proof}

\begin{lemma}
\label{lemma-affine-in-presence-ample}
Let $X$ be a scheme. Let $\mathcal{L}$ be an ample invertible
$\mathcal{O}_X$-module. Let $n_0$ be an integer.
If $H^p(X, \mathcal{L}^{\otimes -n}) = 0$ for $n \geq n_0$ and $p > 0$,
then $X$ is affine.
\end{lemma}

\begin{proof}
We claim $H^p(X, \mathcal{F}) = 0$ for every quasi-coherent
$\mathcal{O}_X$-module and $p > 0$. Since $X$ is quasi-compact
by Properties, Definition \ref{properties-definition-ample}
the claim finishes the proof
by Lemma \ref{lemma-quasi-compact-h1-zero-covering}.
The scheme $X$ is separated by
Properties, Lemma \ref{properties-lemma-ample-separated}.
Say $X$ is covered by $e + 1$ affine opens. Then
$H^p(X, \mathcal{F}) = 0$ for $p > e$, see
Lemma \ref{lemma-vanishing-nr-affines}. Thus we may use descending
induction on $p$ to prove the claim. Writing $\mathcal{F}$
as a filtered colimit of finite type quasi-coherent
modules (Properties, Lemma
\ref{properties-lemma-quasi-coherent-colimit-finite-type})
and using Cohomology, Lemma
\ref{cohomology-lemma-quasi-separated-cohomology-colimit}
we may assume $\mathcal{F}$ is of finite type.
Then we can choose $n > n_0$ such that
$\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
is globally generated, see Properties, Proposition
\ref{properties-proposition-characterize-ample}.
This means there is a short exact sequence
$$
0 \to \mathcal{F}' \to
\bigoplus\nolimits_{i \in I} \mathcal{L}^{\otimes -n}
\to \mathcal{F} \to 0
$$
for some set $I$ (in fact we can choose $I$ finite). By
induction hypothesis we have $H^{p + 1}(X, \mathcal{F}') = 0$
and by assumption (combined with the already used
commutation of cohomology with colimits)
we have $H^p(X, \bigoplus_{i \in I} \mathcal{L}^{\otimes -n}) = 0$.
From the long exact cohomology sequence we conclude that
$H^p(X, \mathcal{F}) = 0$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-affine-if-quasi-affine}
Let $X$ be a quasi-affine scheme.
If $H^p(X, \mathcal{O}_X) = 0$ for $p > 0$,
then $X$ is affine.
\end{lemma}

\begin{proof}
Since $\mathcal{O}_X$ is ample by
Properties, Lemma \ref{properties-lemma-quasi-affine-O-ample}
this follows from Lemma \ref{lemma-affine-in-presence-ample}.
\end{proof}







\section{Chow's Lemma}
\label{section-chows-lemma}

\noindent
In this section we prove Chow's lemma in the Noetherian
case (Lemma \ref{lemma-chow-Noetherian}).
In
Limits, Section \ref{limits-section-chows-lemma}
we prove some variants for the non-Noetherian case.

\begin{lemma}
\label{lemma-chow-Noetherian}
\begin{reference}
\cite[II Theorem 5.6.1(a)]{EGA}
\end{reference}
Let $S$ be a Noetherian scheme.
Let $f : X \to S$ be a separated morphism of finite type.
Then there exists an $n \geq 0$ and a diagram
$$
\xymatrix{
X \ar[rd] & X' \ar[d] \ar[l]^\pi \ar[r] & \mathbf{P}^n_S \ar[dl] \\
& S &
}
$$
where $X' \to \mathbf{P}^n_S$ is an immersion, and
$\pi : X' \to X$ is proper and surjective. Moreover, we may
arrange it such that there exists a dense open subscheme
$U \subset X$ such that $\pi^{-1}(U) \to U$ is an isomorphism.
\end{lemma}

\begin{proof}
All of the schemes we will encounter during the rest of the proof
are going to be of finite type over the Noetherian scheme $S$ and
hence Noetherian
(see Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}).
All morphisms between them will automatically be quasi-compact, locally of
finite type and quasi-separated, see
Morphisms, Lemma \ref{morphisms-lemma-permanence-finite-type} and
Properties,
Lemmas \ref{properties-lemma-locally-Noetherian-quasi-separated} and
\ref{properties-lemma-morphism-Noetherian-schemes-quasi-compact}.

\medskip\noindent
The scheme $X$ has only finitely many irreducible components
(Properties, Lemma \ref{properties-lemma-Noetherian-irreducible-components}).
Say $X = X_1 \cup \ldots \cup X_r$ is the decomposition
of $X$ into irreducible components.
Let $\eta_i \in X_i$ be the generic point.
For every point $x \in X$ there exists an affine open
$U_x \subset X$ which contains $x$ and each of the generic
points $\eta_i$. See
Properties, Lemma \ref{properties-lemma-point-and-maximal-points-affine}.
Since $X$ is quasi-compact, we can find a finite affine open
covering $X = U_1 \cup \ldots \cup U_m$ such that
each $U_i$ contains $\eta_1, \ldots, \eta_r$.
In particular we conclude that the open
$U = U_1 \cap \ldots \cap U_m \subset X$ is
a dense open. This and the fact that the $U_i$ are affine opens
covering $X$ is all that we will use below.

\medskip\noindent
Let $X^* \subset X$ be the scheme theoretic closure of $U \to X$, see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-image}.
Let $U_i^* = X^* \cap U_i$. Note that $U_i^*$ is a closed subscheme
of $U_i$. Hence $U_i^*$ is affine. Since $U$ is dense in $X$ the
morphism $X^* \to X$ is a surjective closed immersion. It is an
isomorphism over $U$. Hence we may replace $X$ by $X^*$ and
$U_i$ by $U_i^*$ and assume that $U$ is scheme theoretically dense
in $X$, see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretically-dense}.

\medskip\noindent
By Morphisms, Lemma \ref{morphisms-lemma-quasi-projective-finite-type-over-S}
we can find an immersion $j_i : U_i \to \mathbf{P}_S^{n_i}$
for each $i$. By
Morphisms, Lemma \ref{morphisms-lemma-quasi-compact-immersion} we can find
closed subschemes $Z_i \subset \mathbf{P}_S^{n_i}$
such that $j_i : U_i \to Z_i$ is a scheme theoretically
dense open immersion. Note that $Z_i \to S$ is proper, see
Morphisms, Lemma \ref{morphisms-lemma-locally-projective-proper}.
Consider the morphism
$$
j = (j_1|_U, \ldots, j_m|_U) : U \longrightarrow
\mathbf{P}_S^{n_1} \times_S \ldots \times_S \mathbf{P}_S^{n_m}.
$$
By the lemma cited above we can find a closed subscheme
$Z$ of $\mathbf{P}_S^{n_1} \times_S \ldots \times_S \mathbf{P}_S^{n_m}$
such that $j : U \to Z$ is an open immersion and such that $U$
is scheme theoretically dense in $Z$. The morphism $Z \to S$
is proper. Consider the $i$th projection
$$
\text{pr}_i|_Z : Z \longrightarrow \mathbf{P}^{n_i}_S.
$$
This morphism factors through $Z_i$ (see Morphisms,
Lemma \ref{morphisms-lemma-factor-factor}). Denote $p_i : Z \to Z_i$
the induced morphism. This is a proper morphism, see
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}
for example. At this point we have that
$U \subset U_i \subset Z_i$ are scheme theoretically
dense open immersions. Moreover, we can think of $Z$ as the
scheme theoretic image of the ``diagonal'' morphism
$U \to Z_1 \times_S \ldots \times_S Z_m$.

\medskip\noindent
Set $V_i = p_i^{-1}(U_i)$. Note that $p_i|_{V_i} : V_i \to U_i$ is proper.
Set $X' = V_1 \cup \ldots \cup V_m$. By construction $X'$ has an immersion
into the scheme
$\mathbf{P}^{n_1}_S \times_S \ldots \times_S \mathbf{P}^{n_m}_S$.
Thus by the Segre embedding (see
Constructions, Lemma \ref{constructions-lemma-segre-embedding})
we see that $X'$ has
an immersion into a projective space over $S$.

\medskip\noindent
We claim that the morphisms $p_i|_{V_i}: V_i \to U_i$ glue to a morphism
$X' \to X$. Namely, it is clear that $p_i|_U$ is the identity map
from $U$ to $U$. Since $U \subset X'$ is scheme theoretically
dense by construction, it is also scheme theoretically dense
in the open subscheme $V_i \cap V_j$. Thus we see that
$p_i|_{V_i \cap V_j} = p_j|_{V_i \cap V_j}$ as morphisms into the
separated $S$-scheme $X$, see
Morphisms, Lemma \ref{morphisms-lemma-equality-of-morphisms}.
We denote the resulting morphism $\pi : X' \to X$.

\medskip\noindent
We claim that $\pi^{-1}(U_i) = V_i$.
Since $\pi|_{V_i} = p_i|_{V_i}$ it follows that
$V_i \subset \pi^{-1}(U_i)$. Consider the diagram
$$
\xymatrix{
V_i \ar[r] \ar[rd]_{p_i|_{V_i}} & \pi^{-1}(U_i) \ar[d] \\
& U_i
}
$$
Since $V_i \to U_i$ is proper we see that the image of
the horizontal arrow is closed, see
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}.
Since $V_i \subset \pi^{-1}(U_i)$ is scheme
theoretically dense (as it contains $U$)
we conclude that $V_i = \pi^{-1}(U_i)$ as claimed.

\medskip\noindent
This shows that $\pi^{-1}(U_i) \to U_i$ is identified with the proper
morphism $p_i|_{V_i} : V_i \to U_i$. Hence we see that $X$ has a
finite affine covering $X = \bigcup U_i$ such that the restriction
of $\pi$ is proper on each member of the covering.
Thus by Morphisms, Lemma \ref{morphisms-lemma-proper-local-on-the-base}
we see that $\pi$ is proper.

\medskip\noindent
Finally we have to show that $\pi^{-1}(U) = U$. To see this we argue in the
same way as above using the diagram
$$
\xymatrix{
U \ar[r] \ar[rd] & \pi^{-1}(U) \ar[d] \\
& U
}
$$
and using that $\text{id}_U : U \to U$ is proper and that
$U$ is scheme theoretically dense in $\pi^{-1}(U)$.
\end{proof}

\begin{remark}
\label{remark-chow-Noetherian}
In the situation of Chow's
Lemma \ref{lemma-chow-Noetherian}:
\begin{enumerate}
\item The morphism $\pi$ is actually H-projective (hence projective, see
Morphisms, Lemma \ref{morphisms-lemma-H-projective})
since the morphism $X' \to \mathbf{P}^n_S \times_S X = \mathbf{P}^n_X$
is a closed immersion (use the fact that $\pi$ is proper, see
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}).
\item We may assume that $\pi^{-1}(U)$ is scheme theoretically dense
in $X'$. Namely, we can simply replace $X'$ by the scheme theoretic
closure of $\pi^{-1}(U)$. In this case we can think of $U$ as a
scheme theoretically dense open subscheme of $X'$.
See Morphisms, Section \ref{morphisms-section-scheme-theoretic-image}.
\item If $X$ is reduced then we may choose $X'$ reduced. This is clear
from (2).
\end{enumerate}
\end{remark}






\section{Higher direct images of coherent sheaves}
\label{section-proper-pushforward}

\noindent
In this section we prove the fundamental fact that the higher
direct images of a coherent sheaf under a proper morphism
are coherent.

\begin{proposition}
\label{proposition-proper-pushforward-coherent}
\begin{reference}
\cite[III Theorem 3.2.1]{EGA}
\end{reference}
Let $S$ be a locally Noetherian scheme.
Let $f : X \to S$ be a proper morphism.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Then $R^if_*\mathcal{F}$ is a coherent $\mathcal{O}_S$-module
for all $i \geq 0$.
\end{proposition}

\begin{proof}
Since the problem is local on $S$ we may assume that $S$ is
a Noetherian scheme. Since a proper morphism is of finite type
we see that in this case $X$ is a Noetherian scheme also.
Consider the property $\mathcal{P}$ of coherent sheaves
on $X$ defined by the rule
$$
\mathcal{P}(\mathcal{F}) \Leftrightarrow
R^pf_*\mathcal{F}\text{ is coherent for all }p \geq 0
$$
We are going to use the result of
Lemma \ref{lemma-property} to prove that
$\mathcal{P}$ holds for every coherent sheaf on $X$.

\medskip\noindent
Let
$$
0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0
$$
be a short exact sequence of coherent sheaves on $X$.
Consider the long exact sequence of higher direct images
$$
R^{p - 1}f_*\mathcal{F}_3 \to
R^pf_*\mathcal{F}_1 \to
R^pf_*\mathcal{F}_2 \to
R^pf_*\mathcal{F}_3 \to
R^{p + 1}f_*\mathcal{F}_1
$$
Then it is clear that if 2-out-of-3 of the sheaves $\mathcal{F}_i$
have property $\mathcal{P}$, then the higher direct images of the
third are sandwiched in this exact complex between two coherent
sheaves. Hence these higher direct images are also coherent by
Lemma \ref{lemma-coherent-abelian-Noetherian} and
\ref{lemma-coherent-Noetherian-quasi-coherent-sub-quotient}.
Hence property $\mathcal{P}$ holds for the third as well.

\medskip\noindent
Let $Z \subset X$ be an integral closed subscheme.
We have to find a coherent sheaf $\mathcal{F}$ on $X$ whose support is
contained in $Z$, whose stalk at the generic point $\xi$ of $Z$ is a
$1$-dimensional vector space over $\kappa(\xi)$ such that $\mathcal{P}$
holds for $\mathcal{F}$. Denote $g = f|_Z : Z \to S$ the restriction of $f$.
Suppose we can find a coherent sheaf $\mathcal{G}$ on $Z$ such
that
(a) $\mathcal{G}_\xi$ is a $1$-dimensional vector space over $\kappa(\xi)$,
(b) $R^pg_*\mathcal{G} = 0$ for $p > 0$, and
(c) $g_*\mathcal{G}$ is coherent. Then we can consider
$\mathcal{F} = (Z \to X)_*\mathcal{G}$. As $Z \to X$ is a closed immersion
we see that $(Z \to X)_*\mathcal{G}$ is coherent on $X$
and $R^p(Z \to X)_*\mathcal{G} = 0$ for $p > 0$
(Lemma \ref{lemma-finite-pushforward-coherent}).
Hence by the relative Leray spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-relative-Leray})
we will have $R^pf_*\mathcal{F} = R^pg_*\mathcal{G} = 0$ for $p > 0$
and $f_*\mathcal{F} = g_*\mathcal{G}$ is coherent.
Finally $\mathcal{F}_\xi = ((Z \to X)_*\mathcal{G})_\xi = \mathcal{G}_\xi$
which verifies the condition on the stalk at $\xi$.
Hence everything depends on finding a coherent sheaf $\mathcal{G}$
on $Z$ which has properties (a), (b), and (c).

\medskip\noindent
We can apply Chow's Lemma \ref{lemma-chow-Noetherian}
to the morphism $Z \to S$. Thus we get a diagram
$$
\xymatrix{
Z \ar[rd]_g & Z' \ar[d]^-{g'} \ar[l]^\pi \ar[r]_i & \mathbf{P}^n_S \ar[dl] \\
& S &
}
$$
as in the statement of Chow's lemma. Also, let $U \subset Z$ be
the dense open subscheme such that $\pi^{-1}(U) \to U$ is an isomorphism.
By the discussion in Remark \ref{remark-chow-Noetherian} we see that
$i' = (i, \pi) : Z' \to \mathbf{P}^n_Z$ is
a closed immersion. Hence
$$
\mathcal{L} = i^*\mathcal{O}_{\mathbf{P}^n_S}(1) \cong
(i')^*\mathcal{O}_{\mathbf{P}^n_Z}(1)
$$
is $g'$-relatively ample and $\pi$-relatively ample (for example by
Morphisms, Lemma \ref{morphisms-lemma-characterize-ample-on-finite-type}).
Hence by Lemma \ref{lemma-kill-by-twisting}
there exists an $n \geq 0$ such that
both $R^p\pi_*\mathcal{L}^{\otimes n} = 0$ for all $p > 0$ and
$R^p(g')_*\mathcal{L}^{\otimes n} = 0$ for all $p > 0$.
Set $\mathcal{G} = \pi_*\mathcal{L}^{\otimes n}$.
Property (a) holds because $\pi_*\mathcal{L}^{\otimes}|_U$ is
an invertible sheaf (as $\pi^{-1}(U) \to U$ is an isomorphism).
Properties (b) and (c) hold because by the relative Leray
spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-relative-Leray})
we have
$$
E_2^{p, q} = R^pg_* R^q\pi_*\mathcal{L}^{\otimes n}
\Rightarrow
R^{p + q}(g')_*\mathcal{L}^{\otimes n}
$$
and by choice of $n$ the only nonzero terms in $E_2^{p, q}$ are
those with $q = 0$ and the only nonzero terms of
$R^{p + q}(g')_*\mathcal{L}^{\otimes n}$ are those with $p = q = 0$.
This implies that $R^pg_*\mathcal{G} = 0$ for $p > 0$ and
that $g_*\mathcal{G} = (g')_*\mathcal{L}^{\otimes n}$.
Finally, applying the previous
Lemma \ref{lemma-locally-projective-pushforward}
we see that $g_*\mathcal{G} = (g')_*\mathcal{L}^{\otimes n}$ is
coherent as desired.
\end{proof}

\begin{lemma}
\label{lemma-proper-over-affine-cohomology-finite}
Let $S = \Spec(A)$ with $A$ a Noetherian ring.
Let $f : X \to S$ be a proper morphism.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Then $H^i(X, \mathcal{F})$ is finite $A$-module for all $i \geq 0$.
\end{lemma}

\begin{proof}
This is just the affine case of
Proposition \ref{proposition-proper-pushforward-coherent}.
Namely, by Lemmas \ref{lemma-quasi-coherence-higher-direct-images} and
\ref{lemma-quasi-coherence-higher-direct-images-application} we know that
$R^if_*\mathcal{F}$ is the quasi-coherent sheaf associated
to the $A$-module $H^i(X, \mathcal{F})$
and by Lemma \ref{lemma-coherent-Noetherian} this is
a coherent sheaf if and only if $H^i(X, \mathcal{F})$
is an $A$-module of finite type.
\end{proof}

\begin{lemma}
\label{lemma-graded-finiteness}
Let $A$ be a Noetherian ring.
Let $B$ be a finitely generated graded $A$-algebra.
Let $f : X \to \Spec(A)$ be a proper morphism.
Set $\mathcal{B} = f^*\widetilde B$.
Let $\mathcal{F}$ be a quasi-coherent
graded $\mathcal{B}$-module of finite type.
\begin{enumerate}
\item For every $p \geq 0$ the graded $B$-module $H^p(X, \mathcal{F})$
is a finite $B$-module.
\item If $\mathcal{L}$ is an ample invertible $\mathcal{O}_X$-module,
then there exists an integer $d_0$ such that
$H^p(X, \mathcal{F} \otimes \mathcal{L}^{\otimes d}) = 0$
for all $p > 0$ and $d \geq d_0$.
\end{enumerate}
\end{lemma}

\begin{proof}
To prove this we consider the fibre product diagram
$$
\xymatrix{
X' = \Spec(B) \times_{\Spec(A)} X
\ar[r]_-\pi \ar[d]_{f'} &
X \ar[d]^f \\
\Spec(B) \ar[r] &
\Spec(A)
}
$$
Note that $f'$ is a proper morphism, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-proper}.
Also, $B$ is a finitely generated $A$-algebra, and hence
Noetherian (Algebra, Lemma \ref{algebra-lemma-Noetherian-permanence}).
This implies that $X'$ is a Noetherian scheme
(Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}).
Note that $X'$ is the relative spectrum of the quasi-coherent
$\mathcal{O}_X$-algebra $\mathcal{B}$ by
Constructions, Lemma \ref{constructions-lemma-spec-properties}.
Since $\mathcal{F}$ is a quasi-coherent $\mathcal{B}$-module
we see that there is a unique quasi-coherent
$\mathcal{O}_{X'}$-module $\mathcal{F}'$ such that
$\pi_*\mathcal{F}' = \mathcal{F}$, see
Morphisms, Lemma \ref{morphisms-lemma-affine-equivalence-modules}
Since $\mathcal{F}$ is finite type as a $\mathcal{B}$-module we
conclude that $\mathcal{F}'$ is a finite type
$\mathcal{O}_{X'}$-module (details omitted). In other words,
$\mathcal{F}'$ is a coherent $\mathcal{O}_{X'}$-module
(Lemma \ref{lemma-coherent-Noetherian}).
Since the morphism $\pi : X' \to X$ is affine we have
$$
H^p(X, \mathcal{F}) = H^p(X', \mathcal{F}')
$$
by Lemma \ref{lemma-relative-affine-cohomology}.
Thus (1) follows from
Lemma \ref{lemma-proper-over-affine-cohomology-finite}.
Given $\mathcal{L}$ as in (2) we set
$\mathcal{L}' = \pi^*\mathcal{L}$. Note that $\mathcal{L}'$ is
ample on $X'$ by
Morphisms, Lemma \ref{morphisms-lemma-pullback-ample-tensor-relatively-ample}.
By the projection formula
(Cohomology, Lemma \ref{cohomology-lemma-projection-formula}) we have
$\pi_*(\mathcal{F}' \otimes \mathcal{L}') = \mathcal{F} \otimes \mathcal{L}$.
Thus part (2) follows by the same reasoning as above from
Lemma \ref{lemma-kill-by-twisting}.
\end{proof}












\section{The theorem on formal functions}
\label{section-theorem-formal-functions}

\noindent
In this section we study the behaviour of cohomology of
sequences of sheaves either of the form $\{I^n\mathcal{F}\}_{n \geq 0}$
or of the form $\{\mathcal{F}/I^n\mathcal{F}\}_{n \geq 0}$ as
$n$ varies.

\medskip\noindent
Here and below we use the following notation.
Given a morphism of schemes $f : X \to Y$, a quasi-coherent sheaf
$\mathcal{F}$ on $X$, and a quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Y$ we denote
$\mathcal{I}^n\mathcal{F}$ the quasi-coherent subsheaf generated
by products of local sections of $f^{-1}(\mathcal{I}^n)$ and
$\mathcal{F}$. In a formula
$$
\mathcal{I}^n\mathcal{F}
=
\Im\left(
f^*(\mathcal{I}^n) \otimes_{\mathcal{O}_X} \mathcal{F}
\longrightarrow
\mathcal{F}
\right).
$$
Note that there are natural maps
$$
f^{-1}(\mathcal{I}^n) \otimes_{f^{-1}\mathcal{O}_Y} \mathcal{I}^m\mathcal{F}
\longrightarrow
f^*(\mathcal{I}^n) \otimes_{\mathcal{O}_X} \mathcal{I}^m\mathcal{F}
\longrightarrow
\mathcal{I}^{n + m}\mathcal{F}
$$
Hence a section of $\mathcal{I}^n$ will give rise to a
map $R^pf_*(\mathcal{I}^m\mathcal{F}) \to
R^pf_*(\mathcal{I}^{n + m}\mathcal{F})$ by functoriality
of higher direct images. Localizing and then sheafifying we
see that there are $\mathcal{O}_Y$-module maps
$$
\mathcal{I}^n \otimes_{\mathcal{O}_Y} R^pf_*(\mathcal{I}^m\mathcal{F})
\longrightarrow
R^pf_*(\mathcal{I}^{n + m}\mathcal{F}).
$$
In other words we see that
$\bigoplus_{n \geq 0} R^pf_*(\mathcal{I}^n\mathcal{F})$
is a graded $\bigoplus_{n \geq 0} \mathcal{I}^n$-module.

\medskip\noindent
If $Y = \Spec(A)$ and $\mathcal{I} = \widetilde{I}$ we denote
$\mathcal{I}^n\mathcal{F}$ simply $I^n\mathcal{F}$. The maps
introduced above give $M = \bigoplus H^p(X, I^n\mathcal{F})$ the
structure of a graded $S = \bigoplus I^n$-module. If $f$ is proper,
$A$ is Noetherian and $\mathcal{F}$ is coherent, then this turns out
to be a module of finite type.

\begin{lemma}
\label{lemma-cohomology-powers-ideal-times-F}
Let $A$ be a Noetherian ring.
Let $I \subset A$ be an ideal.
Set $B = \bigoplus_{n \geq 0} I^n$.
Let $f : X \to \Spec(A)$ be a proper morphism.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Then for every $p \geq 0$ the graded $B$-module
$\bigoplus_{n \geq 0} H^p(X, I^n\mathcal{F})$ is
a finite $B$-module.
\end{lemma}

\begin{proof}
Let $\mathcal{B} = \bigoplus I^n\mathcal{O}_X = f^*\widetilde{B}$.
Then $\bigoplus I^n\mathcal{F}$ is a finite type
graded $\mathcal{B}$-module. Hence the result follows
from Lemma \ref{lemma-graded-finiteness} part (1).
\end{proof}

\begin{lemma}
\label{lemma-cohomology-powers-ideal-times-sheaf}
Given a morphism of schemes $f : X \to Y$, a quasi-coherent sheaf
$\mathcal{F}$ on $X$, and a quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Y$. Assume $Y$ locally
Noetherian, $f$ proper, and $\mathcal{F}$ coherent.
Then
$$
\mathcal{M} =
\bigoplus\nolimits_{n \geq 0} R^pf_*(\mathcal{I}^n\mathcal{F})
$$
is a graded $\mathcal{A} = \bigoplus_{n \geq 0} \mathcal{I}^n$-module
which is quasi-coherent and of finite type.
\end{lemma}

\begin{proof}
The statement is local on $Y$, hence this reduces to the
case where $Y$ is affine. In the affine case the result follows
from Lemma \ref{lemma-cohomology-powers-ideal-times-F}.
Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-powers-ideal-application}
Let $A$ be a Noetherian ring.
Let $I \subset A$ be an ideal.
Let $f : X \to \Spec(A)$ be a proper morphism.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Then for every $p \geq 0$ there exists an integer $c \geq 0$
such that
\begin{enumerate}
\item the multiplication map
$I^{n - c} \otimes H^p(X, I^c\mathcal{F}) \to H^p(X, I^n\mathcal{F})$
is surjective for all $n \geq c$, and
\item the image of $H^p(X, I^{n + m}\mathcal{F}) \to H^p(X, I^n\mathcal{F})$
is contained in the submodule $I^{m - c} H^p(X, I^n\mathcal{F})$
for all $n \geq 0$, $m \geq c$.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-cohomology-powers-ideal-times-F}
we can find $d_1, \ldots, d_t \geq 0$, and
$x_i \in H^p(X, I^{d_i}\mathcal{F})$ such that
$\bigoplus_{n \geq 0} H^p(X, I^n\mathcal{F})$ is generated
by $x_1, \ldots, x_t$ over $S = \bigoplus_{n \geq 0} I^n$.
Take $c = \max\{d_i\}$. It is clear that (1) holds.
For (2) let $b = \max(0, n - c)$.
Consider the commutative diagram of $A$-modules
$$
\xymatrix{
I^{n + m - c - b} \otimes I^b \otimes
H^p(X, I^c\mathcal{F}) \ar[r] \ar[d] &
I^{n + m - c} \otimes H^p(X, I^c\mathcal{F}) \ar[r] &
H^p(X, I^{n + m}\mathcal{F}) \ar[d] \\
I^{n + m - c - b} \otimes H^p(X, I^n\mathcal{F}) \ar[rr] & &
H^p(X, I^n\mathcal{F})
}
$$
By part (1) of the lemma the composition of the horizontal arrows
is surjective if $n + m \geq c$. On the other hand, it is clear
that $n + m - c - b \geq m - c$. Hence part (2).
\end{proof}

\noindent
In the situation of Lemmas \ref{lemma-cohomology-powers-ideal-times-F} and
\ref{lemma-cohomology-powers-ideal-application} consider the inverse
system
$$
\mathcal{F}/I\mathcal{F} \leftarrow
\mathcal{F}/I^2\mathcal{F} \leftarrow
\mathcal{F}/I^3\mathcal{F} \leftarrow \ldots
$$
We would like to know what happens to the cohomology groups.
Here is a first result.

\begin{lemma}
\label{lemma-ML-cohomology-powers-ideal}
Let $A$ be a Noetherian ring.
Let $I \subset A$ be an ideal.
Let $f : X \to \Spec(A)$ be a proper morphism.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Fix $p \geq 0$.
\begin{enumerate}
\item There exists a $c_1 \geq 0$ such that for all $n \geq c_1$
we have
$$
\Ker(
H^p(X, \mathcal{F}) \to H^p(X, \mathcal{F}/I^n\mathcal{F})
)
\subset
I^{n - c_1}H^p(X, \mathcal{F}).
$$
\item The inverse system
$$
\left(H^p(X, \mathcal{F}/I^n\mathcal{F})\right)_{n \in \mathbf{N}}
$$
satisfies the Mittag-Leffler condition (see
Homology, Definition \ref{homology-definition-Mittag-Leffler}).
\item In fact for any $p$ and $n$ there exists a $c_2(n) \geq n$
such that
$$
\Im(H^p(X, \mathcal{F}/I^k\mathcal{F})
\to H^p(X, \mathcal{F}/I^n\mathcal{F}))
=
\Im(H^p(X, \mathcal{F})
\to H^p(X, \mathcal{F}/I^n\mathcal{F}))
$$
for all $k \geq c_2(n)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $c_1 = \max\{c_p, c_{p + 1}\}$, where $c_p, c_{p +1}$ are the integers
found in Lemma \ref{lemma-cohomology-powers-ideal-application} for
$H^p$ and $H^{p + 1}$. We will use this constant in the proofs of
(1), (2) and (3).

\medskip\noindent
Let us prove part (1). Consider the short exact sequence
$$
0 \to I^n\mathcal{F} \to \mathcal{F} \to \mathcal{F}/I^n\mathcal{F} \to 0
$$
From the long exact cohomology sequence we see that
$$
\Ker(
H^p(X, \mathcal{F}) \to H^p(X, \mathcal{F}/I^n\mathcal{F})
)
=
\Im(
H^p(X, I^n\mathcal{F}) \to H^p(X, \mathcal{F})
)
$$
Hence by our choice of $c_1$ we see that this is contained in
$I^{n - c_1}H^p(X, \mathcal{F})$ for $n \geq c_1$.

\medskip\noindent
Note that part (3) implies part (2) by definition of the Mittag-Leffler
condition.

\medskip\noindent
Let us prove part (3).
Fix an $n$ throughout the rest of the proof.
Consider the commutative diagram
$$
\xymatrix{
0 \ar[r] &
I^n\mathcal{F} \ar[r] &
\mathcal{F} \ar[r] &
\mathcal{F}/I^n\mathcal{F} \ar[r] &
0 \\
0 \ar[r] &
I^{n + m}\mathcal{F} \ar[r] \ar[u] &
\mathcal{F} \ar[r] \ar[u] &
\mathcal{F}/I^{n + m}\mathcal{F} \ar[r] \ar[u] &
0
}
$$
This gives rise to the following commutative diagram
$$
\xymatrix{
H^p(X, I^n\mathcal{F}) \ar[r] &
H^p(X, \mathcal{F}) \ar[r] &
H^p(X, \mathcal{F}/I^n\mathcal{F}) \ar[r]_\delta &
H^{p + 1}(X, I^n\mathcal{F}) \\
H^p(X, I^{n + m}\mathcal{F}) \ar[r] \ar[u] &
H^p(X, \mathcal{F}) \ar[r] \ar[u]^1 &
H^p(X, \mathcal{F}/I^{n + m}\mathcal{F}) \ar[r] \ar[u] &
H^{p + 1}(X, I^{n + m}\mathcal{F}) \ar[u]^a
}
$$
If $m \geq c_1$ we see that the image of $a$ is
contained in $I^{m - c_1} H^{p + 1}(X, I^n\mathcal{F})$.
By the Artin-Rees lemma (see Algebra, Lemma \ref{algebra-lemma-map-AR})
there exists an integer $c_3(n)$ such that
$$
I^N H^{p + 1}(X, I^n\mathcal{F}) \cap \Im(\delta)
\subset
\delta\left(I^{N - c_3(n)}H^p(X, \mathcal{F}/I^n\mathcal{F})\right)
$$
for all $N \geq c_3(n)$. As $H^p(X, \mathcal{F}/I^n\mathcal{F})$
is annihilated by $I^n$, we see that if $m \geq c_3(n) + c_1 + n$,
then
$$
\Im(H^p(X, \mathcal{F}/I^{n + m}\mathcal{F})
\to H^p(X, \mathcal{F}/I^n\mathcal{F}))
=
\Im(H^p(X, \mathcal{F})
\to H^p(X, \mathcal{F}/I^n\mathcal{F}))
$$
In other words, part (3) holds with $c_2(n) = c_3(n) + c_1 + n$.
\end{proof}

\begin{theorem}[Theorem on formal functions]
\label{theorem-formal-functions}
Let $A$ be a Noetherian ring.
Let $I \subset A$ be an ideal.
Let $f : X \to \Spec(A)$ be a proper morphism.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Fix $p \geq 0$.
The system of maps
$$
H^p(X, \mathcal{F})/I^nH^p(X, \mathcal{F})
\longrightarrow
H^p(X, \mathcal{F}/I^n\mathcal{F})
$$
define an isomorphism of limits
$$
H^p(X, \mathcal{F})^\wedge
\longrightarrow
\lim_n H^p(X, \mathcal{F}/I^n\mathcal{F})
$$
where the left hand side is the completion of the $A$-module
$H^p(X, \mathcal{F})$ with respect to the ideal $I$, see
Algebra, Section \ref{algebra-section-completion}.
Moreover, this is in fact a homeomorphism for the limit topologies.
\end{theorem}

\begin{proof}
In fact, this follows immediately from
Lemma \ref{lemma-ML-cohomology-powers-ideal}. We spell out the details.
Set $M = H^p(X, \mathcal{F})$ and $M_n = H^p(X, \mathcal{F}/I^n\mathcal{F})$.
Denote $N_n = \Im(M \to M_n)$.
By the description of the limit in Homology, Section
\ref{homology-section-inverse-systems} we have
$$
\lim_n M_n
=
\{(x_n) \in \prod M_n \mid \varphi_i(x_n) = x_{n - 1}, \ n = 2, 3, \ldots\}
$$
Pick an element $x = (x_n) \in \lim_n M_n$.
By Lemma \ref{lemma-ML-cohomology-powers-ideal} part (3)
we have $x_n \in N_n$ for all $n$ since by
definition $x_n$ is the image of some $x_{n + m} \in M_{n + m}$ for
all $m$. By Lemma \ref{lemma-ML-cohomology-powers-ideal} part (1)
we see that there exists a factorization
$$
M \to N_n \to M/I^{n - c_1}M
$$
of the reduction map. Denote $y_n \in M/I^{n - c_1}M$ the image of $x_n$
for $n \geq c_1$. Since for $n' \geq n$ the composition
$M \to M_{n'} \to M_n$ is the given map $M \to M_n$ we see that
$y_{n'}$ maps to $y_n$ under the canonical map
$M/I^{n' - c_1}M \to M/I^{n - c_1}M$. Hence $y = (y_{n + c_1})$
defines an element of $\lim_n M/I^nM$.
We omit the verification that $y$ maps to $x$ under the
map
$$
M^\wedge = \lim_n M/I^nM \longrightarrow \lim_n M_n
$$
of the lemma. We also omit the verification on topologies.
\end{proof}

\begin{lemma}
\label{lemma-spell-out-theorem-formal-functions}
Let $A$ be a ring. Let $I \subset A$ be an ideal. Assume $A$ is
Noetherian and complete with respect to $I$.
Let $f : X \to \Spec(A)$ be a proper morphism.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Then
$$
H^p(X, \mathcal{F}) = \lim_n H^p(X, \mathcal{F}/I^n\mathcal{F})
$$
for all $p \geq 0$.
\end{lemma}

\begin{proof}
This is a reformulation of the theorem on formal functions
(Theorem \ref{theorem-formal-functions}) in the
case of a complete Noetherian base ring. Namely, in this case the
$A$-module $H^p(X, \mathcal{F})$ is finite
(Lemma \ref{lemma-proper-over-affine-cohomology-finite}) hence
$I$-adically complete (Algebra, Lemma \ref{algebra-lemma-completion-tensor})
and we see that completion on the left hand side is not necessary.
\end{proof}

\begin{lemma}
\label{lemma-formal-functions-stalk}
Given a morphism of schemes $f : X \to Y$ and a quasi-coherent sheaf
$\mathcal{F}$ on $X$. Assume
\begin{enumerate}
\item $Y$ locally Noetherian,
\item $f$ proper, and
\item $\mathcal{F}$ coherent.
\end{enumerate}
Let $y \in Y$ be a point. Consider the infinitesimal neighbourhoods
$$
\xymatrix{
X_n =
\Spec(\mathcal{O}_{Y, y}/\mathfrak m_y^n) \times_Y X
\ar[r]_-{i_n} \ar[d]_{f_n} &
X \ar[d]^f \\
\Spec(\mathcal{O}_{Y, y}/\mathfrak m_y^n) \ar[r]^-{c_n} & Y
}
$$
of the fibre $X_1 = X_y$ and set $\mathcal{F}_n = i_n^*\mathcal{F}$.
Then we have
$$
\left(R^pf_*\mathcal{F}\right)_y^\wedge
\cong
\lim_n H^p(X_n, \mathcal{F}_n)
$$
as $\mathcal{O}_{Y, y}^\wedge$-modules.
\end{lemma}

\begin{proof}
This is just a reformulation of a special case of the theorem
on formal functions, Theorem \ref{theorem-formal-functions}.
Let us spell it out. Note that $\mathcal{O}_{Y, y}$ is a Noetherian
local ring. Consider the canonical morphism
$c : \Spec(\mathcal{O}_{Y, y}) \to Y$, see
Schemes, Equation (\ref{schemes-equation-canonical-morphism}).
This is a flat morphism as it identifies local rings.
Denote momentarily $f' : X' \to \Spec(\mathcal{O}_{Y, y})$
the base change of $f$ to this local ring. We see that
$c^*R^pf_*\mathcal{F} = R^pf'_*\mathcal{F}'$ by
Lemma \ref{lemma-flat-base-change-cohomology}.
Moreover, the infinitesimal neighbourhoods of
the fibre $X_y$ and $X'_y$ are identified (verification omitted; hint:
the morphisms $c_n$ factor through $c$).

\medskip\noindent
Hence we may assume that $Y = \Spec(A)$ is the spectrum of
a Noetherian local ring $A$ with maximal ideal $\mathfrak m$
and that $y \in Y$ corresponds to the closed point (i.e., to $\mathfrak m$).
In particular it follows that
$$
\left(R^pf_*\mathcal{F}\right)_y =
\Gamma(Y, R^pf_*\mathcal{F}) =
H^p(X, \mathcal{F}).
$$

\medskip\noindent
In this case also, the morphisms $c_n$ are each closed immersions.
Hence their base changes $i_n$ are closed immersions as well.
Note that $i_{n, *}\mathcal{F}_n = i_{n, *}i_n^*\mathcal{F}
= \mathcal{F}/\mathfrak m^n\mathcal{F}$. By the Leray spectral sequence
for $i_n$, and Lemma \ref{lemma-finite-pushforward-coherent} we see that
$$
H^p(X_n, \mathcal{F}_n) =
H^p(X, i_{n, *}\mathcal{F}) =
H^p(X, \mathcal{F}/\mathfrak m^n\mathcal{F})
$$
Hence we may indeed apply the theorem on formal functions to compute
the limit in the statement of the lemma and we win.
\end{proof}

\noindent
Here is a lemma which we will generalize later to fibres of
dimension $ > 0$, namely the next lemma.

\begin{lemma}
\label{lemma-higher-direct-images-zero-finite-fibre}
Let $f : X \to Y$ be a morphism of schemes.
Let $y \in Y$.
Assume
\begin{enumerate}
\item $Y$ locally Noetherian,
\item $f$ is proper, and
\item $f^{-1}(\{y\})$ is finite.
\end{enumerate}
Then for any coherent sheaf $\mathcal{F}$ on $X$ we have
$(R^pf_*\mathcal{F})_y = 0$ for all $p > 0$.
\end{lemma}

\begin{proof}
The fibre $X_y$ is finite, and by
Morphisms, Lemma \ref{morphisms-lemma-finite-fibre} it
is a finite discrete space. Moreover, the underlying topological
space of each infinitesimal neighbourhood $X_n$ is the same.
Hence each of the schemes $X_n$ is affine according to
Schemes, Lemma \ref{schemes-lemma-scheme-finite-discrete-affine}.
Hence it follows that $H^p(X_n, \mathcal{F}_n) = 0$ for all
$p > 0$. Hence we see that $(R^pf_*\mathcal{F})_y^\wedge = 0$
by Lemma \ref{lemma-formal-functions-stalk}.
Note that $R^pf_*\mathcal{F}$ is coherent by
Proposition \ref{proposition-proper-pushforward-coherent} and
hence $R^pf_*\mathcal{F}_y$ is a finite
$\mathcal{O}_{Y, y}$-module. By Nakayama's lemma
(Algebra, Lemma \ref{algebra-lemma-NAK})
if the completion of a finite module over a local ring
is zero, then the module is zero. Whence
$(R^pf_*\mathcal{F})_y = 0$.
\end{proof}

\begin{lemma}
\label{lemma-higher-direct-images-zero-above-dimension-fibre}
Let $f : X \to Y$ be a morphism of schemes.
Let $y \in Y$.
Assume
\begin{enumerate}
\item $Y$ locally Noetherian,
\item $f$ is proper, and
\item $\dim(X_y) = d$.
\end{enumerate}
Then for any coherent sheaf $\mathcal{F}$ on $X$ we have
$(R^pf_*\mathcal{F})_y = 0$ for all $p > d$.
\end{lemma}

\begin{proof}
The fibre $X_y$ is of finite type over $\Spec(\kappa(y))$.
Hence $X_y$ is a Noetherian scheme by
Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}.
Hence the underlying topological space of $X_y$ is Noetherian, see
Properties, Lemma \ref{properties-lemma-Noetherian-topology}.
Moreover, the underlying topological space of each infinitesimal
neighbourhood $X_n$ is the same as that of $X_y$.
Hence $H^p(X_n, \mathcal{F}_n) = 0$ for all $p > d$ by
Cohomology, Proposition \ref{cohomology-proposition-vanishing-Noetherian}.
Hence we see that $(R^pf_*\mathcal{F})_y^\wedge = 0$
by Lemma \ref{lemma-formal-functions-stalk} for $p > d$.
Note that $R^pf_*\mathcal{F}$ is coherent by
Proposition \ref{proposition-proper-pushforward-coherent} and
hence $R^pf_*\mathcal{F}_y$ is a finite
$\mathcal{O}_{Y, y}$-module. By Nakayama's lemma
(Algebra, Lemma \ref{algebra-lemma-NAK})
if the completion of a finite module over a local ring
is zero, then the module is zero. Whence
$(R^pf_*\mathcal{F})_y = 0$.
\end{proof}








\section{Applications of the theorem on formal functions}
\label{section-applications-formal-functions}


\noindent
We will add more here as needed. For the moment we need the
following characterization of finite morphisms in the Noetherian case.

\begin{lemma}
\label{lemma-characterize-finite}
(For a more general version see
More on Morphisms, Lemma \ref{more-morphisms-lemma-characterize-finite}.)
Let $f : X \to S$ be a morphism of schemes.
Assume $S$ is locally Noetherian.
The following are equivalent
\begin{enumerate}
\item $f$ is finite, and
\item $f$ is proper with finite fibres.
\end{enumerate}
\end{lemma}

\begin{proof}
A finite morphism is proper according to
Morphisms, Lemma \ref{morphisms-lemma-finite-proper}.
A finite morphism is quasi-finite according to
Morphisms, Lemma \ref{morphisms-lemma-finite-quasi-finite}.
A quasi-finite morphism has finite fibres, see
Morphisms, Lemma \ref{morphisms-lemma-quasi-finite}.
Hence a finite morphism is proper and has finite fibres.

\medskip\noindent
Assume $f$ is proper with finite fibres.
We want to show $f$ is finite.
In fact it suffices to prove $f$ is affine.
Namely, if $f$ is affine, then it follows that
$f$ is integral by
Morphisms, Lemma \ref{morphisms-lemma-integral-universally-closed}
whereupon it follows from
Morphisms, Lemma \ref{morphisms-lemma-finite-integral}
that $f$ is finite.

\medskip\noindent
To show that $f$ is affine we may assume that $S$ is affine, and our
goal is to show that $X$ is affine too.
Since $f$ is proper we see that $X$ is separated and quasi-compact.
Hence we may use the criterion of
Lemma \ref{lemma-quasi-separated-h1-zero-covering} to prove that $X$
is affine. To see this let $\mathcal{I} \subset \mathcal{O}_X$
be a finite type ideal sheaf. In particular $\mathcal{I}$ is
a coherent sheaf on $X$. By
Lemma \ref{lemma-higher-direct-images-zero-finite-fibre} we conclude that
$R^1f_*\mathcal{I}_s = 0$ for all $s \in S$.
In other words, $R^1f_*\mathcal{I} = 0$. Hence we see from
the Leray Spectral Sequence for $f$ that
$H^1(X , \mathcal{I}) = H^1(S, f_*\mathcal{I})$.
Since $S$ is affine, and $f_*\mathcal{I}$ is quasi-coherent
(Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent})
we conclude $H^1(S, f_*\mathcal{I}) = 0$
from Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}
as desired. Hence $H^1(X, \mathcal{I}) = 0$ as desired.
\end{proof}

\noindent
As a consequence we have the following useful result.

\begin{lemma}
\label{lemma-proper-finite-fibre-finite-in-neighbourhood}
\begin{slogan}
A proper morphism is finite in a neighbourhood of a finite fiber.
\end{slogan}
(For a more general version see
More on Morphisms,
Lemma \ref{more-morphisms-lemma-proper-finite-fibre-finite-in-neighbourhood}.)
Let $f : X \to S$ be a morphism of schemes.
Let $s \in S$.
Assume
\begin{enumerate}
\item $S$ is locally Noetherian,
\item $f$ is proper, and
\item $f^{-1}(\{s\})$ is a finite set.
\end{enumerate}
Then there exists an open neighbourhood $V \subset S$ of $s$
such that $f|_{f^{-1}(V)} : f^{-1}(V) \to V$ is finite.
\end{lemma}

\begin{proof}
The morphism $f$ is quasi-finite at all the points of $f^{-1}(\{s\})$
by Morphisms, Lemma \ref{morphisms-lemma-finite-fibre}.
By Morphisms, Lemma \ref{morphisms-lemma-quasi-finite-points-open} the
set of points at which $f$ is quasi-finite is an open $U \subset X$.
Let $Z = X \setminus U$. Then $s \not \in f(Z)$. Since $f$ is proper
the set $f(Z) \subset S$ is closed. Choose any open neighbourhood
$V \subset S$ of $s$ with $Z \cap V = \emptyset$. Then
$f^{-1}(V) \to V$ is locally quasi-finite and proper.
Hence it is quasi-finite
(Morphisms, Lemma \ref{morphisms-lemma-quasi-finite-locally-quasi-compact}),
hence has finite fibres
(Morphisms, Lemma \ref{morphisms-lemma-quasi-finite}), hence
is finite by Lemma \ref{lemma-characterize-finite}.
\end{proof}

\begin{lemma}
\label{lemma-ample-on-fibre}
Let $f : X \to Y$ be a proper morphism of schemes with $Y$ Noetherian.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Let $y \in Y$ be a point such that $\mathcal{L}_y$ is ample on $X_y$.
Then there exists a $d_0$ such that for all $d \geq d_0$ we have
$$
R^pf_*(\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d})_y = 0
\text{ for }p > 0
$$
and the map
$$
f_*(\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d})_y
\longrightarrow
H^0(X_y, \mathcal{F}_y \otimes_{\mathcal{O}_{X_y}} \mathcal{L}_y^{\otimes d})
$$
is surjective.
\end{lemma}

\begin{proof}
Note that $\mathcal{O}_{Y, y}$ is a Noetherian local ring.
Consider the canonical morphism
$c : \Spec(\mathcal{O}_{Y, y}) \to Y$, see
Schemes, Equation (\ref{schemes-equation-canonical-morphism}).
This is a flat morphism as it identifies local rings.
Denote momentarily $f' : X' \to \Spec(\mathcal{O}_{Y, y})$
the base change of $f$ to this local ring. We see that
$c^*R^pf_*\mathcal{F} = R^pf'_*\mathcal{F}'$ by
Lemma \ref{lemma-flat-base-change-cohomology}.
Moreover, the fibres $X_y$ and $X'_y$ are identified.
Hence we may assume that $Y = \Spec(A)$ is the spectrum of
a Noetherian local ring $(A, \mathfrak m, \kappa)$ and $y \in Y$
corresponds to $\mathfrak m$. In this case
$R^pf_*(\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d})_y =
H^p(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d})$
for all $p \geq 0$. Denote $f_y : X_y \to \Spec(\kappa)$ the projection.

\medskip\noindent
Let $B = \text{Gr}_\mathfrak m(A) =
\bigoplus_{n \geq 0} \mathfrak m^n/\mathfrak m^{n + 1}$.
Consider the sheaf $\mathcal{B} = f_y^*\widetilde{B}$
of quasi-coherent graded $\mathcal{O}_{X_y}$-algebras.
We will use notation as in Section \ref{section-theorem-formal-functions}
with $I$ replaced by $\mathfrak m$.
Since $X_y$ is the closed subscheme of $X$ cut out by
$\mathfrak m\mathcal{O}_X$ we may think of
$\mathfrak m^n\mathcal{F}/\mathfrak m^{n + 1}\mathcal{F}$
as a coherent $\mathcal{O}_{X_y}$-module, see
Lemma \ref{lemma-i-star-equivalence}. Then
$\bigoplus_{n \geq 0} \mathfrak m^n\mathcal{F}/\mathfrak m^{n + 1}\mathcal{F}$
is a quasi-coherent graded $\mathcal{B}$-module of finite type
because it is generated in degree zero over $\mathcal{B}$
abd because the degree zero part is
$\mathcal{F}_y = \mathcal{F}/\mathfrak m \mathcal{F}$
which is a coherent $\mathcal{O}_{X_y}$-module.
Hence by Lemma \ref{lemma-graded-finiteness} part (2)
we see that
$$
H^p(X_y, \mathfrak m^n \mathcal{F}/ \mathfrak m^{n + 1}\mathcal{F}
\otimes_{\mathcal{O}_{X_y}} \mathcal{L}_y^{\otimes d}) = 0
$$
for all $p > 0$, $d \geq d_0$, and $n \geq 0$. By
Lemma \ref{lemma-relative-affine-cohomology}
this is the same as the statement that
$
H^p(X, \mathfrak m^n \mathcal{F}/ \mathfrak m^{n + 1}\mathcal{F}
\otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d}) = 0
$
for all $p > 0$, $d \geq d_0$, and $n \geq 0$.

\medskip\noindent
Consider the short exact sequences
$$
0 \to \mathfrak m^n\mathcal{F}/\mathfrak m^{n + 1} \mathcal{F}
\to \mathcal{F}/\mathfrak m^{n + 1} \mathcal{F}
\to \mathcal{F}/\mathfrak m^n \mathcal{F} \to 0
$$
of coherent $\mathcal{O}_X$-modules. Tensoring with $\mathcal{L}^{\otimes d}$
is an exact functor and we obtain short exact sequences
$$
0 \to
\mathfrak m^n\mathcal{F}/\mathfrak m^{n + 1} \mathcal{F}
\otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d}
\to \mathcal{F}/\mathfrak m^{n + 1} \mathcal{F}
\otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d}
\to \mathcal{F}/\mathfrak m^n \mathcal{F}
\otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d} \to 0
$$
Using the long exact cohomology sequence and the vanishing above
we conclude (using induction) that
\begin{enumerate}
\item $H^p(X, \mathcal{F}/\mathfrak m^n \mathcal{F}
\otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d}) = 0$
for all $p > 0$, $d \geq d_0$, and $n \geq 0$, and
\item $H^0(X, \mathcal{F}/\mathfrak m^n \mathcal{F}
\otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d}) \to
H^0(X_y, \mathcal{F}_y \otimes_{\mathcal{O}_{X_y}} \mathcal{L}_y^{\otimes d})$
is surjective for all $d \geq d_0$ and $n \geq 1$.
\end{enumerate}
By the theorem on formal functions (Theorem \ref{theorem-formal-functions})
we find that the $\mathfrak m$-adic completion of
$H^p(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d})$
is zero for all $d \geq d_0$ and $p > 0$.
Since $H^p(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d})$
is a finite $A$-module by
Lemma \ref{lemma-proper-over-affine-cohomology-finite}
it follows from Nakayama's lemma (Algebra, Lemma \ref{algebra-lemma-NAK})
that $H^p(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d})$
is zero for all $d \geq d_0$ and $p > 0$.
For $p = 0$ we deduce from
Lemma \ref{lemma-ML-cohomology-powers-ideal} part (3)
that $H^0(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes d}) \to
H^0(X_y, \mathcal{F}_y \otimes_{\mathcal{O}_{X_y}} \mathcal{L}_y^{\otimes d})$
is surjective, which gives the final statement of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-ample-in-neighbourhood}
(For a more general version see
More on Morphisms,
Lemma \ref{more-morphisms-lemma-ample-in-neighbourhood}.)
Let $f : X \to Y$ be a proper morphism of schemes with $Y$ Noetherian.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Let $y \in Y$ be a point such that $\mathcal{L}_y$ is ample
on $X_y$. Then there is an open neighbourhood $V \subset Y$
of $y$ such that $\mathcal{L}|_{f^{-1}(V)}$ is ample on $f^{-1}(V)/V$.
\end{lemma}

\begin{proof}
Pick $d_0$ as in Lemma \ref{lemma-ample-on-fibre} for
$\mathcal{F} = \mathcal{O}_X$. Pick $d \geq d_0$
so that we can find $r \geq 0$ and sections
$s_{y, 0}, \ldots, s_{y, r} \in H^0(X_y, \mathcal{L}_y^{\otimes d})$
which define a closed immersion
$$
\varphi_y =
\varphi_{\mathcal{L}_y^{\otimes d}, (s_{y, 0}, \ldots, s_{y, r})} :
X_y \to \mathbf{P}^r_{\kappa(y)}.
$$
This is possible by Morphisms, Lemma
\ref{morphisms-lemma-finite-type-over-affine-ample-very-ample}
but we also use
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}
to see that $\varphi_y$ is a closed immersion and
Constructions, Section \ref{constructions-section-projective-space}
for the description of morphisms into projective
space in terms of invertible sheaves and sections.
By our choice of $d_0$, after replacing $Y$ by an open neighbourhood
of $y$, we can choose
$s_0, \ldots, s_r \in H^0(X, \mathcal{L}^{\otimes d})$
mapping to $s_{y, 0}, \ldots, s_{y, r}$.
Let $X_{s_i} \subset X$ be the open subset where $s_i$
is a generator of $\mathcal{L}^{\otimes d}$. Since
the $s_{y, i}$ generate $\mathcal{L}_y^{\otimes d}$ we see that
$X_y \subset U = \bigcup X_{s_i}$.
Since $X \to Y$ is closed, we see that
there is an open neighbourhood $y \in V \subset Y$
such that $f^{-1}(V) \subset U$.
After replacing $Y$ by $V$ we may assume that
the $s_i$ generate $\mathcal{L}^{\otimes d}$. Thus we
obtain a morphism
$$
\varphi = \varphi_{\mathcal{L}^{\otimes d}, (s_0, \ldots, s_r)} :
X \longrightarrow \mathbf{P}^r_Y
$$
with $\mathcal{L}^{\otimes d} \cong \varphi^*\mathcal{O}_{\mathbf{P}^r_Y}(1)$
whose base change to $y$ gives $\varphi_y$.

\medskip\noindent
We will finish the proof by a sleight of hand; the ``correct'' proof
proceeds by directly showing that $\varphi$ is a closed
immersion after base changing to an open neighbourhood of $y$.
Namely, by Lemma \ref{lemma-proper-finite-fibre-finite-in-neighbourhood}
we see that $\varphi$ is a finite over an open neighbourhood
of the fibre $\mathbf{P}^r_{\kappa(y)}$ of $\mathbf{P}^r_Y \to Y$
above $y$. Using that $\mathbf{P}^r_Y \to Y$ is closed, after
shrinking $Y$ we may assume that $\varphi$ is finite.
Then $\mathcal{L}^{\otimes d} \cong \varphi^*\mathcal{O}_{\mathbf{P}^r_Y}(1)$
is ample by the very general
Morphisms, Lemma \ref{morphisms-lemma-pullback-ample-tensor-relatively-ample}.
\end{proof}





\section{Cohomology and base change, III}
\label{section-cohomology-and-base-change-perfect}

\noindent
In this section we prove the simplest case of a very general phenomenon
that will be discussed in
Derived Categories of Schemes, Section
\ref{perfect-section-cohomology-and-base-change-perfect}.
Please see Remark \ref{remark-explain-perfect-direct-image} for a translation
of the following lemma into algebra.

\begin{lemma}
\label{lemma-perfect-direct-image}
Let $A$ be a Noetherian ring and set $S = \Spec(A)$. Let $f : X \to S$ be a
proper morphism of schemes. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_X$-module flat over $S$. Then
\begin{enumerate}
\item $R\Gamma(X, \mathcal{F})$ is a perfect object of $D(A)$, and
\item for any ring map $A \to A'$ the base change map
$$
R\Gamma(X, \mathcal{F}) \otimes_A^{\mathbf{L}} A'
\longrightarrow
R\Gamma(X_{A'}, \mathcal{F}_{A'})
$$
is an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a finite affine open covering $X = \bigcup_{i = 1, \ldots, n} U_i$.
By Lemmas \ref{lemma-separated-case-relative-cech} and
\ref{lemma-base-change-complex} the {\v C}ech complex
$K^\bullet = {\check C}^\bullet(\mathcal{U}, \mathcal{F})$ satisfies
$$
K^\bullet \otimes_A A' = R\Gamma(X_{A'}, \mathcal{F}_{A'})
$$
for all ring maps $A \to A'$. Let
$K_{alt}^\bullet = {\check C}_{alt}^\bullet(\mathcal{U}, \mathcal{F})$
be the alternating {\v C}ech complex. By
Cohomology, Lemma \ref{cohomology-lemma-alternating-usual}
there is a homotopy equivalence $K_{alt}^\bullet \to K^\bullet$
of $A$-modules. In particular, we have
$$
K_{alt}^\bullet \otimes_A A' = R\Gamma(X_{A'}, \mathcal{F}_{A'})
$$
as well. Since $\mathcal{F}$ is flat over $A$ we see that each $K_{alt}^n$
is flat over $A$ (see
Morphisms, Lemma \ref{morphisms-lemma-flat-module-characterize}).
Since moreover $K_{alt}^\bullet$ is bounded above (this is why we switched
to the alternating {\v C}ech complex)
$K_{alt}^\bullet \otimes_A A' = K_{alt}^\bullet \otimes_A^{\mathbf{L}} A'$
by the definition of derived tensor products (see
More on Algebra, Section \ref{more-algebra-section-derived-tensor-product}).
By
Lemma \ref{lemma-proper-over-affine-cohomology-finite}
the cohomology groups $H^i(K_{alt}^\bullet)$ are finite $A$-modules.
As $K_{alt}^\bullet$ is bounded, we conclude that $K_{alt}^\bullet$
is pseudo-coherent, see
More on Algebra, Lemma \ref{more-algebra-lemma-Noetherian-pseudo-coherent}.
Given any $A$-module $M$ set $A' = A \oplus M$ where $M$ is a square zero
ideal, i.e., $(a, m) \cdot (a', m') = (aa', am' + a'm)$. By the
above we see that $K_{alt}^\bullet \otimes_A^\mathbf{L} A'$ has cohomology
in degrees $0, \ldots, n$. Hence $K_{alt}^\bullet \otimes_A^\mathbf{L} M$
has cohomology in degrees $0, \ldots, n$. Hence $K_{alt}^\bullet$ has
finite Tor dimension, see
More on Algebra, Definition \ref{more-algebra-definition-tor-amplitude}.
We win by More on Algebra, Lemma \ref{more-algebra-lemma-perfect}.
\end{proof}

\begin{remark}
\label{remark-explain-perfect-direct-image}
A consequence of Lemma \ref{lemma-perfect-direct-image} is that there
exists a finite complex of finite projective $A$-modules $M^\bullet$ such
that we have
$$
H^i(X_{A'}, \mathcal{F}_{A'}) = H^i(M^\bullet \otimes_A A')
$$
functorially in $A'$. The condition that $\mathcal{F}$ is
flat over $A$ is essential, see \cite{Hartshorne}.
\end{remark}







\section{Coherent formal modules}
\label{section-coherent-formal}

\noindent
As we do not yet have the theory of formal schemes to our disposal, we
develop a bit of language that replaces the notion of a ``coherent module on a
Noetherian adic formal scheme''.

\medskip\noindent
Let $X$ be a Noetherian scheme and let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals. We will consider inverse
systems $(\mathcal{F}_n)$ of coherent $\mathcal{O}_X$-modules such that
\begin{enumerate}
\item $\mathcal{F}_n$ is annihilated by $\mathcal{I}^n$, and
\item the transition maps induce isomorphisms
$\mathcal{F}_{n + 1}/\mathcal{I}^n\mathcal{F}_{n + 1} \to \mathcal{F}_n$.
\end{enumerate}
A morphism of such inverse systems is defined as usual.
Let us denote the category of these inverse systems with
$\textit{Coh}(X, \mathcal{I})$. We are going to proceed by proving
a bunch of lemmas about objects in this category. In fact, most
of the lemmas that follow are straightforward consequences of the following
description of the category in the affine case.

\begin{lemma}
\label{lemma-inverse-systems-affine}
If $X = \Spec(A)$ is the spectrum of a Noetherian ring and
$\mathcal{I}$ is the quasi-coherent sheaf of ideals associated to the ideal
$I \subset A$, then $\textit{Coh}(X, \mathcal{I})$ is equivalent to the
category of finite $A^\wedge$-modules where $A^\wedge$ is the completion
of $A$ with respect to $I$.
\end{lemma}

\begin{proof}
Let $\text{Mod}^{fg}_{A, I}$ be the category of inverse systems $(M_n)$
of finite $A$-modules satisfying: (1) $M_n$ is annihilated by $I^n$ and (2)
$M_{n + 1}/I^nM_{n + 1} = M_n$. By the correspondence between coherent
sheaves on $X$ and finite $A$-modules (Lemma \ref{lemma-coherent-Noetherian})
it suffices to show $\text{Mod}^{fg}_{A, I}$ is equivalent to the category of
finite $A^\wedge$-modules. To see this it suffices to prove that given
an object $(M_n)$ of $\text{Mod}^{fg}_{A, I}$ the module
$$
M = \lim M_n
$$
is a finite $A^\wedge$-module and that $M/I^nM = M_n$. As the transition
maps are surjective, we see that $M \to M_1$ is surjective.
Pick $x_1, \ldots, x_t \in M$ which map to generators of $M_1$.
This induces a map of systems $(A/I^n)^{\oplus t} \to M_n$.
By Nakayama's lemma (Algebra, Lemma \ref{algebra-lemma-NAK}) these maps are
surjective. Let $K_n \subset (A/I^n)^{\oplus t}$ be the kernel.
Property (2) implies that $K_{n + 1} \to K_n$ is surjective, in particular
the system $(K_n)$ satisfies the Mittag-Leffler condition.
By Homology, Lemma \ref{homology-lemma-Mittag-Leffler}
we obtain an exact sequence
$0 \to K \to (A^\wedge)^{\oplus t} \to M \to 0$
with $K = \lim K_n$.
Hence $M$ is a finite $A^\wedge$-module.
As $K \to K_n$ is surjective it follows that
$$
M/I^nM = \Coker(K \to (A/I^n)^{\oplus t}) =
(A/I^n)^{\oplus t}/K_n = M_n
$$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-inverse-systems-abelian}
Let $X$ be a Noetherian scheme and let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals.
\begin{enumerate}
\item The category $\textit{Coh}(X, \mathcal{I})$ is abelian.
\item For $U \subset X$ open the restriction functor
$\textit{Coh}(X, \mathcal{I}) \to \textit{Coh}(U, \mathcal{I}|_U)$
is exact.
\item Exactness in $\textit{Coh}(X, \mathcal{I})$ may be checked by
restricting to the members of an open covering of $X$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\alpha =(\alpha_n) : (\mathcal{F}_n) \to (\mathcal{G}_n)$ be a morphism of
$\textit{Coh}(X, \mathcal{I})$. The cokernel of $\alpha$ is the inverse system
$(\Coker(\alpha_n))$ (details omitted). To describe the kernel let
$$
\mathcal{K}'_{l, m} = \Im(\Ker(\alpha_l) \to \mathcal{F}_m)
$$
for $l \geq m$.
We claim:
\begin{enumerate}
\item[(a)] the inverse system $(\mathcal{K}'_{l, m})_{l \geq m}$ is
eventually constant, say with value $\mathcal{K}'_m$,
\item[(b)] the system $(\mathcal{K}'_m/\mathcal{I}^n\mathcal{K}'_m)_{m \geq n}$
is eventually constant, say with value $\mathcal{K}_n$,
\item[(c)] the system $(\mathcal{K}_n)$ forms an object of
$\textit{Coh}(X, \mathcal{I})$, and
\item[(d)] this object is the kernel of $\alpha$.
\end{enumerate}
To see (a), (b), and (c) we may work affine locally, say $X = \Spec(A)$
and $\mathcal{I}$ corresponds to the ideal $I \subset A$. By
Lemma \ref{lemma-inverse-systems-affine}
$\alpha$ corresponds to a map $f : M \to N$ of finite $A^\wedge$-modules.
Denote $K = \Ker(f)$. Note that $A^\wedge$ is a Noetherian
ring (Algebra, Lemma \ref{algebra-lemma-completion-Noetherian-Noetherian}).
Choose an integer $c \geq 0$ such that
$K \cap I^n M \subset I^{n - c}K$ for $n \geq c$
(Algebra, Lemma \ref{algebra-lemma-Artin-Rees})
and which satisfies Algebra, Lemma \ref{algebra-lemma-map-AR}
for the map $f$ and the ideal $I^\wedge = IA^\wedge$. Then
$\mathcal{K}'_{l, m}$ corresponds to the $A$-module
$$
K'_{l, m} = \frac{a^{-1}(I^lN) + I^mM}{I^mM} =
\frac{K + I^{l - c}f^{-1}(I^cN) + I^mM}{I^mM} =
\frac{K + I^mM}{I^mM}
$$
where the last equality holds if $l \geq m + c$. So $\mathcal{K}'_m$
corresponds to the $A$-module $K/K \cap I^mM$ and
$\mathcal{K}'_m/\mathcal{I}^n\mathcal{K}'_m$ corresponds to
$$
\frac{K}{K \cap I^mM + I^nK} = \frac{K}{I^nK}
$$
for $m \geq n + c$ by our choice of $c$ above. Hence $\mathcal{K}_n$
corresponds to $K/I^nK$.

\medskip\noindent
We prove (d). It is clear from the description on affines above that
the composition $(\mathcal{K}_n) \to (\mathcal{F}_n) \to (\mathcal{G}_n)$
is zero. Let $\beta : (\mathcal{H}_n) \to (\mathcal{F}_n)$
be a morphism such that $\alpha \circ \beta = 0$. Then
$\mathcal{H}_l \to \mathcal{F}_l$ maps into $\Ker(\alpha_l)$.
Since $\mathcal{H}_m = \mathcal{H}_l/\mathcal{I}^m\mathcal{H}_l$
for $l \geq m$ we obtain a system of maps
$\mathcal{H}_m \to \mathcal{K}'_{l, m}$. Thus a map
$\mathcal{H}_m \to \mathcal{K}_m'$. Since
$\mathcal{H}_n = \mathcal{H}_m/\mathcal{I}^n\mathcal{H}_m$ we obtain
a system of maps $\mathcal{H}_n \to \mathcal{K}'_m/\mathcal{I}^n\mathcal{K}'_m$
and hence a map $\mathcal{H}_n \to \mathcal{K}_n$ as desired.

\medskip\noindent
To finish the proof of (1) we still have to show that $\Coim = \Im$
in $\textit{Coh}(X, \mathcal{I})$. We have seen above that taking
kernels and cokernels commutes, over affines, with the description
of $\textit{Coh}(X, \mathcal{I})$ as a category of modules. Since
$\Im = \Coim$ holds in the category of modules
this gives $\Coim = \Im$ in $\textit{Coh}(X, \mathcal{I})$.
Parts (2) and (3) of the lemma are immediate from our construction
of kernels and cokernels.
\end{proof}

\begin{lemma}
\label{lemma-inverse-systems-surjective}
Let $X$ be a Noetherian scheme and let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals. A map
$(\mathcal{F}_n) \to (\mathcal{G}_n)$ is surjective in
$\textit{Coh}(X, \mathcal{I})$
if and only if $\mathcal{F}_1 \to \mathcal{G}_1$ is surjective.
\end{lemma}

\begin{proof}
Omitted. Hint: Look on affine opens, use
Lemma \ref{lemma-inverse-systems-affine}, and use
Algebra, Lemma \ref{algebra-lemma-NAK}.
\end{proof}

\noindent
Let $X$ be a Noetherian scheme and let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals. There is a functor
\begin{equation}
\label{equation-completion-functor}
\textit{Coh}(\mathcal{O}_X) \longrightarrow \textit{Coh}(X, \mathcal{I}), \quad
\mathcal{F} \longmapsto \mathcal{F}^\wedge
\end{equation}
which associates to the coherent $\mathcal{O}_X$-module $\mathcal{F}$
the object $\mathcal{F}^\wedge = (\mathcal{F}/\mathcal{I}^n\mathcal{F})$
of $\textit{Coh}(X, \mathcal{I})$.

\begin{lemma}
\label{lemma-exact}
The functor (\ref{equation-completion-functor}) is exact.
\end{lemma}

\begin{proof}
It suffices to check this locally on $X$. Hence we may assume $X$ is
affine, i.e., we have a situation as in
Lemma \ref{lemma-inverse-systems-affine}.
The functor is the functor $\text{Mod}^{fg}_A \to \text{Mod}^{fg}_{A^\wedge}$
which associates to a finite $A$-module $M$ the completion $M^\wedge$.
Thus the result follows from
Algebra, Lemma \ref{algebra-lemma-completion-flat}.
\end{proof}

\begin{lemma}
\label{lemma-completion-internal-hom}
Let $X$ be a Noetherian scheme and let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals. Let $\mathcal{F}$, $\mathcal{G}$ be
coherent $\mathcal{O}_X$-modules. Set
$\mathcal{H} = \SheafHom_{\mathcal{O}_X}(\mathcal{G}, \mathcal{F})$.
Then
$$
\lim H^0(X, \mathcal{H}/\mathcal{I}^n\mathcal{H}) =
\Mor_{\textit{Coh}(X, \mathcal{I})}
(\mathcal{G}^\wedge, \mathcal{F}^\wedge).
$$
\end{lemma}

\begin{proof}
To prove this we may work affine locally on $X$.
Hence we may assume $X = \Spec(A)$ and $\mathcal{F}$, $\mathcal{G}$
given by finite $A$-module $M$ and $N$. Then $\mathcal{H}$
corresponds to the finite $A$-module $H = \Hom_A(M, N)$.
The statement of the lemma becomes the statement
$$
H^\wedge = \Hom_{A^\wedge}(M^\wedge, N^\wedge)
$$
via the equivalence of Lemma \ref{lemma-inverse-systems-affine}.
By Algebra, Lemma \ref{algebra-lemma-completion-flat}
(used 3 times) we have
$$
H^\wedge = \Hom_A(M, N) \otimes_A A^\wedge =
\Hom_{A^\wedge}(M \otimes_A A^\wedge, N \otimes_A A^\wedge) =
\Hom_{A^\wedge}(M^\wedge, N^\wedge)
$$
where the second equality uses that $A^\wedge$ is flat over $A$
(see More on Algebra, Remark
\ref{more-algebra-remark-pseudo-coherence-and-base-change-ext}).
The lemma follows.
\end{proof}

\noindent
Let $X$ be a Noetherian scheme. Let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals. We say an object $(\mathcal{F}_n)$ of
$\textit{Coh}(X, \mathcal{I})$ is {\it $\mathcal{I}$-power torsion}
or is {\it annihilated by a power of $\mathcal{I}$} if there exists
a $c \geq 1$ such that $\mathcal{F}_n = \mathcal{F}_c$ for all $n \geq c$.
If this is the case we will say that $(\mathcal{F}_n)$ is {\it annihilated by
$\mathcal{I}^c$}. If $X = \Spec(A)$ is affine, then, via the equivalence of
Lemma \ref{lemma-inverse-systems-affine},
these objects corresponds exactly to the finite $A$-modules
annihilated by a power of $I$ or by $I^c$.

\begin{lemma}
\label{lemma-existence-easy}
Let $X$ be a Noetherian scheme and let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals. Let $\mathcal{G}$ be a coherent
$\mathcal{O}_X$-module. Let $(\mathcal{F}_n)$ an object of
$\textit{Coh}(X, \mathcal{I})$.
\begin{enumerate}
\item If $\alpha : (\mathcal{F}_n) \to \mathcal{G}^\wedge$ is
a map whose kernel and cokernel are annihilated by a power of $\mathcal{I}$,
then there exists a unique (up to unique isomorphism) triple
$(\mathcal{F}, a, \beta)$ where
\begin{enumerate}
\item $\mathcal{F}$ is a coherent $\mathcal{O}_X$-module,
\item $a : \mathcal{F} \to \mathcal{G}$ is an $\mathcal{O}_X$-module map
whose kernel and cokernel are annihilated by a power of $\mathcal{I}$,
\item $\beta : (\mathcal{F}_n) \to \mathcal{F}^\wedge$ is an isomorphism, and
\item $\alpha = a^\wedge \circ \beta$.
\end{enumerate}
\item If $\alpha : \mathcal{G}^\wedge \to (\mathcal{F}_n)$ is
a map whose kernel and cokernel are annihilated by a power of $\mathcal{I}$,
then there exists a unique (up to unique isomorphism) triple
$(\mathcal{F}, a, \beta)$ where
\begin{enumerate}
\item $\mathcal{F}$ is a coherent $\mathcal{O}_X$-module,
\item $a : \mathcal{G} \to \mathcal{F}$ is an $\mathcal{O}_X$-module map
whose kernel and cokernel are annihilated by a power of $\mathcal{I}$,
\item $\beta : \mathcal{F}^\wedge \to (\mathcal{F}_n)$ is an isomorphism, and
\item $\alpha = \beta \circ a^\wedge$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). The uniqueness implies it suffices to construct
$(\mathcal{F}, a, \beta)$
Zariski locally on $X$. Thus we may assume $X = \Spec(A)$ and $\mathcal{I}$
corresponds to the ideal $I \subset A$. In this situation
Lemma \ref{lemma-inverse-systems-affine} applies.
Let $M'$ be the finite $A^\wedge$-module corresponding
to $(\mathcal{F}_n)$. Let $N$ be the finite $A$-module corresponding to
$\mathcal{G}$. Then $\alpha$ corresponds to a map
$$
\varphi : M' \longrightarrow N^\wedge
$$
whose kernel and cokernel are annihilated by $I^t$ for some $t$. Recall that
$N^\wedge = N \otimes_A A^\wedge$
(Algebra, Lemma \ref{algebra-lemma-completion-tensor}).
By More on Algebra, Lemma \ref{more-algebra-lemma-application-formal-glueing}
there is an $A$-module map $\psi : M \to N$ whose kernel and cokernel are
$I$-power torsion and an isomorphism
$M \otimes_A A^\wedge = M'$ compatible with $\varphi$.
As $N$ and $M'$ are finite modules, we conclude that $M$
is a finite $A$-module, see
More on Algebra, Remark \ref{more-algebra-remark-formal-glueing-algebras}.
Hence $M \otimes_A A^\wedge = M^\wedge$. We omit the verification
that the triple $(M, N \to M, M^\wedge \to M')$ so obtained
is unique up to unique isomorphism.

\medskip\noindent
The proof of (2) is exactly the same and we omit it.
\end{proof}

\begin{lemma}
\label{lemma-torsion-hom-ext}
Let $X$ be a Noetherian scheme and let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals. Any object of
$\textit{Coh}(X, \mathcal{I})$ which is annihilated
by a power of $\mathcal{I}$ is in the essential image of
(\ref{equation-completion-functor}).
Moreover, if $\mathcal{F}$, $\mathcal{G}$ are in $\textit{Coh}(\mathcal{O}_X)$
and either $\mathcal{F}$ or $\mathcal{G}$ is annihilated by a power of
$\mathcal{I}$, then the maps
$$
\xymatrix{
\Hom_X(\mathcal{F}, \mathcal{G}) \ar[d] &
\Ext_X(\mathcal{F}, \mathcal{G}) \ar[d] \\
\Hom_{\textit{Coh}(X, \mathcal{I})}(\mathcal{F}^\wedge, \mathcal{G}^\wedge) &
\Ext_{\textit{Coh}(X, \mathcal{I})}(\mathcal{F}^\wedge, \mathcal{G}^\wedge)
}
$$
are isomorphisms.
\end{lemma}

\begin{proof}
Suppose $(\mathcal{F}_n)$ is an object of $\textit{Coh}(X, \mathcal{I})$
which is annihilated by $\mathcal{I}^c$ for some $c \geq 1$. Then
$\mathcal{F}_n \to \mathcal{F}_c$ is an isomorphism for $n \geq c$.
Hence if we set $\mathcal{F} = \mathcal{F}_c$, then we see that
$\mathcal{F}^\wedge \cong (\mathcal{F}_n)$. This proves the first assertion.

\medskip\noindent
Let $\mathcal{F}$, $\mathcal{G}$ be objects of $\textit{Coh}(\mathcal{O}_X)$
such that either $\mathcal{F}$ or $\mathcal{G}$ is annihilated by
$\mathcal{I}^c$ for some $c \geq 1$. Then
$\mathcal{H} = \SheafHom_{\mathcal{O}_X}(\mathcal{G}, \mathcal{F})$
is a coherent $\mathcal{O}_X$-module annihilated by $\mathcal{I}^c$.
Hence we see that
$$
\Hom_X(\mathcal{G}, \mathcal{F}) =
H^0(X, \mathcal{H}) =
\lim H^0(X, \mathcal{H}/\mathcal{I}^n\mathcal{H}) =
\Mor_{\textit{Coh}(X, \mathcal{I})}
(\mathcal{G}^\wedge, \mathcal{F}^\wedge).
$$
see Lemma \ref{lemma-completion-internal-hom}.
This proves the statement on homomorphisms.

\medskip\noindent
The notation $\Ext$ refers to extensions as defined in
Homology, Section \ref{homology-section-extensions}.
The injectivity of the map on $\Ext$'s follows immediately
from the bijectivity of the map on $\Hom$'s.
For surjectivity, assume $\mathcal{F}$ is annihilated
by a power of $I$. Then part (1) of Lemma \ref{lemma-existence-easy}
shows that given an extension
$$
0 \to \mathcal{G}^\wedge \to (\mathcal{E}_n) \to \mathcal{F}^\wedge \to 0
$$
in $\textit{Coh}(U, I\mathcal{O}_U)$
the morphism $\mathcal{G}^\wedge \to (\mathcal{E}_n)$ is
isomorphic to $\mathcal{G} \to \mathcal{E}^\wedge$
for some $\mathcal{G} \to \mathcal{E}$ in $\textit{Coh}(\mathcal{O}_U)$.
Similarly in the other case.
\end{proof}

\begin{lemma}
\label{lemma-finite-over-rees-algebra}
Let $X$ be a Noetherian scheme and let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals. If $(\mathcal{F}_n)$ is an object of
$\textit{Coh}(X, \mathcal{I})$ then
$\bigoplus \Ker(\mathcal{F}_{n + 1} \to \mathcal{F}_n)$ is
a finite type, graded, quasi-coherent
$\bigoplus \mathcal{I}^n/\mathcal{I}^{n + 1}$-module.
\end{lemma}

\begin{proof}
The question is local on $X$ hence we may assume $X$ is affine, i.e.,
we have a situation as in Lemma \ref{lemma-inverse-systems-affine}.
In this case, if $(\mathcal{F}_n)$ corresponds to the finite $A^\wedge$
module $M$, then $\bigoplus \Ker(\mathcal{F}_{n + 1} \to \mathcal{F}_n)$
corresponds to $\bigoplus I^nM/I^{n + 1}M$ which is clearly a finite
module over $\bigoplus I^n/I^{n + 1}$.
\end{proof}

\begin{lemma}
\label{lemma-inverse-systems-pullback}
Let $f : X \to Y$ be a morphism of Noetherian schemes.
Let $\mathcal{J} \subset \mathcal{O}_Y$ be a quasi-coherent sheaf
of ideals and set $\mathcal{I} = f^{-1}\mathcal{J} \mathcal{O}_X$.
Then there is a right exact functor
$$
f^* : \textit{Coh}(Y, \mathcal{J}) \longrightarrow \textit{Coh}(X, \mathcal{I})
$$
which sends $(\mathcal{G}_n)$ to $(f^*\mathcal{G}_n)$. If $f$ is flat,
then $f^*$ is an exact functor.
\end{lemma}

\begin{proof}
Since $f^* : \textit{Coh}(\mathcal{O}_Y) \to \textit{Coh}(\mathcal{O}_X)$
is right exact we have
$$
f^*\mathcal{G}_n =
f^*(\mathcal{G}_{n + 1}/\mathcal{I}^n\mathcal{G}_{n + 1}) =
f^*\mathcal{G}_{n + 1}/f^{-1}\mathcal{I}^nf^*\mathcal{G}_{n + 1} =
f^*\mathcal{G}_{n + 1}/\mathcal{J}^nf^*\mathcal{G}_{n + 1}
$$
hence the pullback of a system is a system. The construction of
cokernels in the proof of Lemma \ref{lemma-inverse-systems-abelian}
shows that
$f^* : \textit{Coh}(Y, \mathcal{J}) \to \textit{Coh}(X, \mathcal{I})$
is always right exact. If $f$ is flat, then
$f^* : \textit{Coh}(\mathcal{O}_Y) \to \textit{Coh}(\mathcal{O}_X)$
is an exact functor. It follows from the construction of kernels
in the proof of Lemma \ref{lemma-inverse-systems-abelian}
that in this case
$f^* : \textit{Coh}(Y, \mathcal{J}) \to \textit{Coh}(X, \mathcal{I})$
also transforms kernels into kernels.
\end{proof}

\begin{lemma}
\label{lemma-inverse-systems-pullback-equivalence}
Let $f : X' \to X$ be a morphism of Noetherian schemes. Let $Z \subset X$
be a closed subscheme and denote $Z' = f^{-1}Z$ the scheme theoretic
inverse image. Let $\mathcal{I} \subset \mathcal{O}_X$,
$\mathcal{I}' \subset \mathcal{O}_{X'}$ be the corresponding
quasi-coherent sheaves of ideals.
If $f$ is flat and the induced morphism $Z' \to Z$
is an isomorphism, then the pullback functor
$f^* : \textit{Coh}(X, \mathcal{I}) \to \textit{Coh}(X', \mathcal{I}')$
(Lemma \ref{lemma-inverse-systems-pullback})
is an equivalence.
\end{lemma}

\begin{proof}
If $X$ and $X'$ are affine, then this follows immediately from
More on Algebra, Lemma \ref{more-algebra-lemma-neighbourhood-equivalence}.
To prove it in general we let $Z_n \subset X$, $Z'_n \subset X'$
be the $n$th infinitesimal neighbourhoods of $Z$, $Z'$.
The induced morphism $Z_n \to Z'_n$ is a homeomorphism on
underlying topological spaces. On the other hand, if $z' \in Z'$
maps to $z \in Z$, then the ring map
$\mathcal{O}_{X, z} \to \mathcal{O}_{X', z'}$ is flat
and induces an isomorphism
$\mathcal{O}_{X, z}/\mathcal{I}_z \to \mathcal{O}_{X', z'}/\mathcal{I}'_{z'}$.
Hence it induces an isomorphism
$\mathcal{O}_{X, z}/\mathcal{I}_z^n \to
\mathcal{O}_{X', z'}/(\mathcal{I}'_{z'})^n$
for all $n \geq 1$ for example by
More on Algebra, Lemma \ref{more-algebra-lemma-neighbourhood-isomorphism}.
Thus $Z'_n \to Z_n$ is an isomorphism of schemes.
Thus $f^*$ induces an equivalence between the
category of coherent $\mathcal{O}_X$-modules annihilated by $\mathcal{I}^n$
and the
category of coherent $\mathcal{O}_{X'}$-modules annihilated by
$(\mathcal{I}')^n$, see
Lemma \ref{lemma-i-star-equivalence}.
This clearly implies the lemma.
\end{proof}

\begin{lemma}
\label{lemma-inverse-systems-ideals-equivalence}
Let $X$ be a Noetherian scheme. Let
$\mathcal{I}, \mathcal{J} \subset \mathcal{O}_X$
be quasi-coherent sheaves of ideals.
If $V(\mathcal{I}) = V(\mathcal{J})$ is the same closed subset
of $X$, then $\textit{Coh}(X, \mathcal{I})$ and $\textit{Coh}(X, \mathcal{J})$
are equivalent.
\end{lemma}

\begin{proof}
First, assume $X = \Spec(A)$ is affine. Let $I, J \subset A$ be the ideals
corresponding to $\mathcal{I}, \mathcal{J}$. Then $V(I) = V(J)$
implies we have $I^c \subset J$ and $J^d \subset I$ for some $c, d \geq 1$
by elementary properties of the Zariski topology
(see Algebra, Section \ref{algebra-section-spectrum-ring} and
Lemma \ref{algebra-lemma-Noetherian-power}).
Hence the $I$-adic and $J$-adic completions of $A$ agree, see
Algebra, Lemma \ref{algebra-lemma-change-ideal-completion}.
Thus the equivalence follows from Lemma \ref{lemma-inverse-systems-affine}
in this case.

\medskip\noindent
In general, using what we said above and the fact that
$X$ is quasi-compact, to choose $c, d \geq 1$ such that
$\mathcal{I}^c \subset \mathcal{J}$ and $\mathcal{J}^d \subset \mathcal{I}$.
Then given an object $(\mathcal{F}_n)$ in
$\textit{Coh}(X, \mathcal{I})$ we claim that the
inverse system
$$
(\mathcal{F}_{cn}/\mathcal{J}^n\mathcal{F}_{cn})
$$
is in $\textit{Coh}(X, \mathcal{J})$. This may be checked on
the members of an affine covering; we omit the details.
In the same manner we can construct an object of
$\textit{Coh}(X, \mathcal{I})$ starting with an object of
$\textit{Coh}(X, \mathcal{J})$. We omit the verification
that these constructions define mutually quasi-inverse functors.
\end{proof}





\section{Grothendieck's existence theorem, I}
\label{section-existence}

\noindent
In this section we discuss Grothendieck's existence theorem for the
projective case. We will use the notion of coherent formal modules
developed in Section \ref{section-coherent-formal}. The reader who is familiar
with formal schemes is encouraged to read the statement and proof
of the theorem in \cite{EGA}.

\begin{lemma}
\label{lemma-fully-faithful}
Let $A$ be Noetherian ring complete with respect to an ideal $I$.
Let $f : X \to \Spec(A)$ be a proper morphism. Let
$\mathcal{I} = I\mathcal{O}_X$.
Then the functor (\ref{equation-completion-functor}) is fully faithful.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules.
Then $\mathcal{H} = \SheafHom_{\mathcal{O}_X}(\mathcal{G}, \mathcal{F})$
is a coherent $\mathcal{O}_X$-module, see
Modules, Lemma \ref{modules-lemma-internal-hom-locally-kernel-direct-sum}.
By Lemma \ref{lemma-completion-internal-hom} the map
$$
\lim_n H^0(X, \mathcal{H}/\mathcal{I}^n\mathcal{H})
\to
\Mor_{\textit{Coh}(X, \mathcal{I})}
(\mathcal{G}^\wedge, \mathcal{F}^\wedge)
$$
is bijective. Hence fully faithfulness of
(\ref{equation-completion-functor}) follows from the theorem on formal
functions (Lemma \ref{lemma-spell-out-theorem-formal-functions})
for the coherent sheaf $\mathcal{H}$.
\end{proof}

\begin{lemma}
\label{lemma-vanishing-projective}
Let $A$ be Noetherian ring and $I \subset A$ and ideal.
Let $f : X \to \Spec(A)$ be a proper morphism and let
$\mathcal{L}$ be an $f$-ample invertible sheaf. Let
$\mathcal{I} = I\mathcal{O}_X$. Let $(\mathcal{F}_n)$ be an
object of $\textit{Coh}(X, \mathcal{I})$. Then there exists an
integer $d_0$ such that
$$
H^1(X, \Ker(\mathcal{F}_{n + 1} \to \mathcal{F}_n)
\otimes \mathcal{L}^{\otimes d} )
= 0
$$
for all $n \geq 0$ and all $d \geq d_0$.
\end{lemma}

\begin{proof}
Set $B = \bigoplus I^n/I^{n + 1}$ and
$\mathcal{B} = \bigoplus \mathcal{I}^n/\mathcal{I}^{n + 1} = f^*\widetilde{B}$.
By Lemma \ref{lemma-finite-over-rees-algebra} the graded quasi-coherent
$\mathcal{B}$-module
$\mathcal{G} = \bigoplus \Ker(\mathcal{F}_{n + 1} \to \mathcal{F}_n)$
is of finite type. Hence the lemma follows from
Lemma \ref{lemma-graded-finiteness} part (2).
\end{proof}

\begin{lemma}
\label{lemma-existence-projective}
Let $A$ be Noetherian ring complete with respect to an ideal $I$.
Let $f : X \to \Spec(A)$ be a projective morphism. Let
$\mathcal{I} = I\mathcal{O}_X$.
Then the functor (\ref{equation-completion-functor}) is an equivalence.
\end{lemma}

\begin{proof}
We have already seen that (\ref{equation-completion-functor}) is
fully faithful in Lemma \ref{lemma-fully-faithful}. Thus it suffices
to show that the functor is essentially surjective.

\medskip\noindent
We first show that every object $(\mathcal{F}_n)$ of
$\textit{Coh}(X, \mathcal{I})$ is the quotient of an object
in the image of (\ref{equation-completion-functor}). 
Let $\mathcal{L}$ be an $f$-ample invertible sheaf on $X$.
Choose $d_0$ as in Lemma \ref{lemma-vanishing-projective}.
Choose a $d \geq d_0$ such that
$\mathcal{F}_1 \otimes \mathcal{L}^{\otimes d}$
is globally generated by some sections $s_{1, 1}, \ldots, s_{t, 1}$.
Since the transition maps of the system
$$
H^0(X, \mathcal{F}_{n + 1} \otimes \mathcal{L}^{\otimes d})
\longrightarrow
H^0(X, \mathcal{F}_n \otimes \mathcal{L}^{\otimes d})
$$
are surjective by the vanishing of $H^1$ we can lift
$s_{1, 1}, \ldots, s_{t, 1}$ to a compatible system of global sections
$s_{1, n}, \ldots, s_{t, n}$ of
$\mathcal{F}_n \otimes \mathcal{L}^{\otimes d}$.
These determine a compatible system of maps
$$
(s_{1, n}, \ldots, s_{t, n}) :
(\mathcal{L}^{\otimes -d})^{\oplus t} \longrightarrow \mathcal{F}_n
$$
Using Lemma \ref{lemma-inverse-systems-surjective}
we deduce that we have a surjective map
$$
\left((\mathcal{L}^{\otimes -d})^{\oplus t}\right)^\wedge
\longrightarrow
(\mathcal{F}_n)
$$
as desired.

\medskip\noindent
The result of the previous paragraph and the fact that
$\textit{Coh}(X, \mathcal{I})$ is abelian
(Lemma \ref{lemma-inverse-systems-abelian})
implies that
every object of $\textit{Coh}(X, \mathcal{I})$ is a cokernel
of a map between objects coming from $\textit{Coh}(\mathcal{O}_X)$.
As (\ref{equation-completion-functor}) is fully faithful and exact by
Lemmas \ref{lemma-fully-faithful} and \ref{lemma-exact}
we conclude.
\end{proof}








\section{Grothendieck's existence theorem, II}
\label{section-existence-proper}

\noindent
In this section we discuss Grothendieck's existence theorem in the proper case.
Before we give the statement and proof, we need to develop a bit
more theory regarding the categories $\textit{Coh}(X, \mathcal{I})$
of coherent formal modules
introduced in Section \ref{section-coherent-formal}.

\begin{remark}
\label{remark-inverse-systems-kernel-cokernel-annihilated-by}
Let $X$ be a Noetherian scheme and let
$\mathcal{I}, \mathcal{K} \subset \mathcal{O}_X$
be quasi-coherent sheaves of ideals. Let
$\alpha : (\mathcal{F}_n) \to (\mathcal{G}_n)$ be a morphism of
$\textit{Coh}(X, \mathcal{I})$.
Given an affine open $\Spec(A) = U \subset X$ with
$\mathcal{I}|_U, \mathcal{K}|_U$ corresponding to ideals $I, K \subset A$
denote $\alpha_U : M \to N$ of finite $A^\wedge$-modules which
corresponds to $\alpha|_U$ via Lemma \ref{lemma-inverse-systems-affine}.
We claim the following are equivalent
\begin{enumerate}
\item there exists an integer $t \geq 1$ such that
$\Ker(\alpha_n)$ and $\Coker(\alpha_n)$
are annihilated by $\mathcal{K}^t$ for all $n \geq 1$,
\item for any affine open $\Spec(A) = U \subset X$ as above
the modules $\Ker(\alpha_U)$ and $\Coker(\alpha_U)$
are annihilated by $K^t$ for some integer $t \geq 1$, and
\item there exists a finite affine open covering $X = \bigcup U_i$
such that the conclusion of (2) holds for $\alpha_{U_i}$.
\end{enumerate}
If these equivalent conditions hold we will say that
$\alpha$ is a
{\it map whose kernel and cokernel are annihilated by a power of
$\mathcal{K}$}.
To see the equivalence we use the following commutative algebra fact:
suppose given an exact sequence
$$
0 \to T \to M \to N \to Q \to 0
$$
of $A$-modules with $T$ and $Q$ annihilated by $K^t$ for some
ideal $K \subset A$. Then for every $f, g \in K^t$ there exists a
canonical map $"fg": N \to M$ such that $M \to N \to M$ is equal to
multiplication by $fg$. Namely, for $y \in N$ we can pick $x \in M$
mapping to $fy$ in $N$ and then we can set $"fg"(y) = gx$. Thus it is
clear that $\Ker(M/JM \to N/JN)$ and $\Coker(M/JM \to N/JN)$
are annihilated by $K^{2t}$ for any ideal $J \subset A$.

\medskip\noindent
Applying the commutative algebra fact to $\alpha_{U_i}$ and $J = I^n$
we see that (3) implies (1). Conversely,
suppose (1) holds and $M \to N$ is equal to $\alpha_U$. Then there is
a $t \geq 1$ such that
$\Ker(M/I^nM \to N/I^nN)$ and $\Coker(M/I^nM \to N/I^nN)$
are annihilated by $K^t$ for all $n$. We obtain maps
$"fg" : N/I^nN \to M/I^nM$ which in the limit induce a map $N \to M$
as $N$ and $M$ are $I$-adically complete. Since the composition with
$N \to M \to N$ is multiplication by $fg$ we conclude that $fg$
annihilates $T$ and $Q$. In other words $T$ and $Q$ are annihilated by
$K^{2t}$ as desired.
\end{remark}

\begin{lemma}
\label{lemma-existence-tricky}
Let $X$ be a Noetherian scheme. Let
$\mathcal{I}, \mathcal{K} \subset \mathcal{O}_X$
be quasi-coherent sheaves of ideals.
Let $X_e \subset X$ be the closed subscheme cut out by $\mathcal{K}^e$.
Let $\mathcal{I}_e = \mathcal{I}\mathcal{O}_{X_e}$.
Let $(\mathcal{F}_n)$ be an object of $\textit{Coh}(X, \mathcal{I})$.
Assume
\begin{enumerate}
\item the functor
$\textit{Coh}(\mathcal{O}_{X_e}) \to \textit{Coh}(X_e, \mathcal{I}_e)$
is an equivalence for all $e \geq 1$, and
\item there exists a coherent sheaf $\mathcal{H}$ on $X$ and a map
$\alpha : (\mathcal{F}_n) \to \mathcal{H}^\wedge$ whose
kernel and cokernel are annihilated by a power of $\mathcal{K}$.
\end{enumerate}
Then $(\mathcal{F}_n)$ is in the essential image of
(\ref{equation-completion-functor}).
\end{lemma}

\begin{proof}
During this proof we will use without further mention that for a closed
immersion $i : Z \to X$ the functor $i_*$ gives an equivalence between the
category of coherent modules on $Z$ and coherent modules on $X$ annihilated
by the ideal sheaf of $Z$, see Lemma \ref{lemma-i-star-equivalence}.
In particular we may identify $\textit{Coh}(\mathcal{O}_{X_e})$
with the category of coherent $\mathcal{O}_X$-modules annihilated by
$\mathcal{K}^e$ and $\textit{Coh}(X_e, \mathcal{I}_e)$ as the full subcategory
of $\textit{Coh}(X, \mathcal{I})$ of objects annihilated by $\mathcal{K}^e$.
Moreover (1) tells us these two categories are equivalent under the
completion functor (\ref{equation-completion-functor}).

\medskip\noindent
Applying this equivalence we get a coherent $\mathcal{O}_X$-module
$\mathcal{G}_e$ annihilated by $\mathcal{K}^e$ corresponding to the system
$(\mathcal{F}_n/\mathcal{K}^e\mathcal{F}_n)$ of
$\textit{Coh}(X, \mathcal{I})$. The maps
$\mathcal{F}_n/\mathcal{K}^{e + 1}\mathcal{F}_n \to
\mathcal{F}_n/\mathcal{K}^e\mathcal{F}_n$ correspond to canonical maps
$\mathcal{G}_{e + 1} \to \mathcal{G}_e$ which induce isomorphisms
$\mathcal{G}_{e + 1}/\mathcal{K}^e\mathcal{G}_{e + 1} \to \mathcal{G}_e$.
Hence $(\mathcal{G}_e)$ is an object of $\textit{Coh}(X, \mathcal{K})$.
The map $\alpha$ induces a system of maps
$$
\mathcal{F}_n/\mathcal{K}^e\mathcal{F}_n
\longrightarrow
\mathcal{H}/(\mathcal{I}^n + \mathcal{K}^e)\mathcal{H}
$$
whence maps $\mathcal{G}_e \to \mathcal{H}/\mathcal{K}^e\mathcal{H}$
(by the equivalence of categories again).
Let $t \geq 1$ be an integer, which exists by assumption (2),
such that $\mathcal{K}^t$ annihilates the kernel and cokernel of all the maps
$\mathcal{F}_n \to \mathcal{H}/\mathcal{I}^n\mathcal{H}$.
Then $\mathcal{K}^{2t}$ annihilates the kernel and cokernel of the maps
$\mathcal{F}_n/\mathcal{K}^e\mathcal{F}_n \to
\mathcal{H}/(\mathcal{I}^n + \mathcal{K}^e)\mathcal{H}$, see
Remark \ref{remark-inverse-systems-kernel-cokernel-annihilated-by}.
Whereupon we conclude that $\mathcal{K}^{4t}$ annihilates the kernel and
the cokernel of the maps
$$
\mathcal{G}_e
\longrightarrow
\mathcal{H}/\mathcal{K}^e\mathcal{H},
$$
see Remark \ref{remark-inverse-systems-kernel-cokernel-annihilated-by}.
We apply Lemma \ref{lemma-existence-easy} to obtain a coherent
$\mathcal{O}_X$-module $\mathcal{F}$, a map
$a : \mathcal{F} \to \mathcal{H}$ and an isomorphism
$\beta : (\mathcal{G}_e) \to (\mathcal{F}/\mathcal{K}^e\mathcal{F})$
in $\textit{Coh}(X, \mathcal{K})$. Working backwards, for a given $n$
the triple
$(\mathcal{F}/\mathcal{I}^n\mathcal{F}, a \bmod \mathcal{I}^n, \beta
\bmod \mathcal{I}^n)$ is a triple as in the lemma for the morphism
$\alpha_n \bmod \mathcal{K}^e :
(\mathcal{F}_n/\mathcal{K}^e\mathcal{F}_n) \to
(\mathcal{H}/(\mathcal{I}^n + \mathcal{K}^e)\mathcal{H})$
of $\textit{Coh}(X, \mathcal{K})$. Thus the uniqueness in
Lemma \ref{lemma-existence-easy}
gives a canonical isomorphism
$\mathcal{F}/\mathcal{I}^n\mathcal{F} \to \mathcal{F}_n$
compatible with all the morphisms in sight. This finishes the proof
of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-inverse-systems-push-pull}
Let $Y$ be a Noetherian scheme. Let
$\mathcal{J}, \mathcal{K} \subset \mathcal{O}_Y$
be quasi-coherent sheaves of ideals.
Let $f : X \to Y$ be a proper morphism which is an isomorphism
over $V = Y \setminus V(\mathcal{K})$.
Set $\mathcal{I} = f^{-1}\mathcal{J} \mathcal{O}_X$.
Let $(\mathcal{G}_n)$ be an object of $\textit{Coh}(Y, \mathcal{J})$,
let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module, and let
$\beta : (f^*\mathcal{G}_n)  \to \mathcal{F}^\wedge$ be an isomorphism in
$\textit{Coh}(X, \mathcal{I})$. Then there exists a map
$$
\alpha :
(\mathcal{G}_n)
\longrightarrow
(f_*\mathcal{F})^\wedge
$$
in $\textit{Coh}(Y, \mathcal{J})$ whose kernel and cokernel
are annihilated by a power of $\mathcal{K}$.
\end{lemma}

\begin{proof}
Since $f$ is a proper morphism we see that $f_*\mathcal{F}$
is a coherent $\mathcal{O}_Y$-module
(Proposition \ref{proposition-proper-pushforward-coherent}).
Thus the statement of the lemma makes sense.
Consider the compositions
$$
\gamma_n : \mathcal{G}_n \to
f_*f^*\mathcal{G}_n \to
f_*(\mathcal{F}/\mathcal{I}^n\mathcal{F}).
$$
Here the first map is the adjunction map and the second is $f_*\beta_n$.
We claim that there exists a unique $\alpha$ as in the lemma
such that the compositions
$$
\mathcal{G}_n \xrightarrow{\alpha_n}
f_*\mathcal{F}/\mathcal{J}^nf_*\mathcal{F} \to
f_*(\mathcal{F}/\mathcal{I}^n\mathcal{F})
$$
equal $\gamma_n$ for all $n$. Because of the uniqueness we may assume
that $Y = \Spec(B)$ is affine. Let $J \subset B$ corresponds to the
ideal $\mathcal{J}$. Set
$$
M_n = H^0(X, \mathcal{F}/\mathcal{I}^n\mathcal{F})
\quad\text{and}\quad
M = H^0(X, \mathcal{F})
$$
By Lemma \ref{lemma-ML-cohomology-powers-ideal} and
Theorem \ref{theorem-formal-functions}
the inverse limit of the modules
$M_n$ equals the completion $M^\wedge = \lim M/J^nM$.
Set $N_n = H^0(Y, \mathcal{G}_n)$ and $N = \lim N_n$.
Via the equivalence of categories of
Lemma \ref{lemma-inverse-systems-affine}
the finite $B^\wedge$ modules $N$ and $M^\wedge$ correspond
to $(\mathcal{G}_n)$ and $f_*\mathcal{F}^\wedge$.
It follows from this that $\alpha$ has to be the morphism of
$\textit{Coh}(Y, \mathcal{J})$ corresponding to the homomorphism
$$
\lim \gamma_n : N = \lim_n N_n \longrightarrow \lim M_n = M^\wedge
$$
of finite $B^\wedge$-modules.

\medskip\noindent
We still have to show that the kernel and cokernel of $\alpha$ are
annihilated by a power of $\mathcal{K}$. Set $Y' = \Spec(B^\wedge)$
and $X' = Y' \times_Y X$. Let $\mathcal{K}'$, $\mathcal{J}'$, $\mathcal{G}'_n$
and $\mathcal{I}'$, $\mathcal{F}'$ be the pullback of
$\mathcal{K}$, $\mathcal{J}$, $\mathcal{G}_n$ and
$\mathcal{I}$, $\mathcal{F}$, to $Y'$ and $X'$.
The projection morphism $f' : X' \to Y'$ is the base change of
$f$ by $Y' \to Y$. Note that $Y' \to Y$ is a flat morphism of schemes
as $B \to B^\wedge$ is flat by
Algebra, Lemma \ref{algebra-lemma-completion-flat}.
Hence $f'_*\mathcal{F}'$, resp.\ $f'_*(f')^*\mathcal{G}_n'$
is the pullback of $f_*\mathcal{F}$, resp.\ $f_*f^*\mathcal{G}_n$
to $Y'$ by Lemma \ref{lemma-flat-base-change-cohomology}.
The uniqueness of our construction shows the pullback of $\alpha$ to $Y'$
is the corresponding map $\alpha'$ constructed for the situation on $Y'$.
Moreover, to check that the kernel and cokernel of $\alpha$ are
annihilated by $\mathcal{K}^t$ it suffices to check that the
kernel and cokernel of $\alpha'$ are annihilated by
$(\mathcal{K}')^t$. Namely, to see this we need to check this for
kernels and cokernels of the maps $\alpha_n$ and $\alpha'_n$
(see Remark \ref{remark-inverse-systems-kernel-cokernel-annihilated-by})
and the ring map $B \to B^\wedge$ induces
an equivalence of categories between modules annihilated by
$J^n$ and $(J')^n$, see
More on Algebra, Lemma \ref{more-algebra-lemma-neighbourhood-equivalence}.
Thus we may assume $B$ is complete with respect to $J$.

\medskip\noindent
Assume $Y = \Spec(B)$ is affine, $\mathcal{J}$ corresponds to the ideal
$J \subset B$, and $B$ is complete with respect to $J$.
In this case $(\mathcal{G}_n)$ is in the essential image of the functor
$\textit{Coh}(\mathcal{O}_Y) \to \textit{Coh}(Y, \mathcal{J})$.
Say $\mathcal{G}$ is a coherent $\mathcal{O}_Y$-module such that
$(\mathcal{G}_n) = \mathcal{G}^\wedge$. Note that
$f^*(\mathcal{G}^\wedge) = (f^*\mathcal{G})^\wedge$. Hence
Lemma \ref{lemma-fully-faithful}
tells us that $\beta$ comes from an isomorphism
$b : f^*\mathcal{G} \to \mathcal{F}$
and $\alpha$ is the completion functor applied to
$$
\mathcal{G} \to f_*f^*\mathcal{G} \cong f_*\mathcal{F}
$$
Hence we are trying to verify that the kernel and cokernel of the
adjunction map $c : \mathcal{G} \to f_*f^*\mathcal{G}$ are annihilated by
a power of $\mathcal{K}$. However, since the restriction
$f|_{f^{-1}(V)} : f^{-1}(V) \to V$ is an isomorphism
we see that $c|_V$ is an isomorphism. Thus the coherent sheaves
$\Ker(c)$ and $\Coker(c)$ are supported on $V(\mathcal{K})$
hence are annihilated by a power of $\mathcal{K}$
(Lemma \ref{lemma-power-ideal-kills-sheaf}) as desired.
\end{proof}

\noindent
The following proposition is the form of Grothendieck's existence
theorem which is most often used in practice.

\begin{proposition}
\label{proposition-existence-proper}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Let $f : X \to \Spec(A)$ be a proper morphism of schemes.
Set $\mathcal{I} = I\mathcal{O}_X$.
Then the functor (\ref{equation-completion-functor}) is an equivalence.
\end{proposition}

\begin{proof}
We have already seen that (\ref{equation-completion-functor}) is
fully faithful in Lemma \ref{lemma-fully-faithful}. Thus it suffices
to show that the functor is essentially surjective.

\medskip\noindent
Consider the collection $\Xi$ of quasi-coherent sheaves of ideals
$\mathcal{K} \subset \mathcal{O}_X$ such that every object
$(\mathcal{F}_n)$ annihilated by $\mathcal{K}$ is in the essential image.
We want to show $(0)$ is in $\Xi$. If not, then since $X$ is Noetherian
there exists a maximal quasi-coherent sheaf of ideals $\mathcal{K}$
not in $\Xi$, see
Lemma \ref{lemma-acc-coherent}.
After replacing $X$ by the closed subscheme of $X$
corresponding to $\mathcal{K}$ we may assume that every nonzero
$\mathcal{K}$ is in $\Xi$. (This uses the correspondence by
coherent modules annihilated by $\mathcal{K}$ and coherent modules
on the closed subscheme corresponding to $\mathcal{K}$, see
Lemma \ref{lemma-i-star-equivalence}.)
Let $(\mathcal{F}_n)$ be an object of
$\textit{Coh}(X, \mathcal{I})$.
We will show that this object is in the essential image of the
functor (\ref{equation-completion-functor}), thereby completion the
proof of the proposition.

\medskip\noindent
Apply Chow's lemma (Lemma \ref{lemma-chow-Noetherian}) to find a
proper surjective morphism $f : X' \to X$ which is an isomorphism
over a dense open $U \subset X$ such that $X'$ is projective over $A$.
Let $\mathcal{K}$ be the quasi-coherent sheaf of ideals cutting
out the reduced complement $X \setminus U$. By the projective
case of Grothendieck's existence theorem
(Lemma \ref{lemma-existence-projective})
there exists a coherent module $\mathcal{F}'$ on $X'$ such
that $(\mathcal{F}')^\wedge \cong (f^*\mathcal{F}_n)$. By
Proposition \ref{proposition-proper-pushforward-coherent}
the $\mathcal{O}_X$-module $\mathcal{H} = f_*\mathcal{F}'$ is coherent
and by Lemma \ref{lemma-inverse-systems-push-pull}
there exists a morphism $(\mathcal{F}_n) \to \mathcal{H}^\wedge$
of $\textit{Coh}(X, \mathcal{I})$ whose kernel and cokernel are
annihilated by a power of $\mathcal{K}$. The powers $\mathcal{K}^e$
are all in $\Xi$ so that (\ref{equation-completion-functor})
is an equivalence for the closed subschemes $X_e = V(\mathcal{K}^e)$.
We conclude by Lemma \ref{lemma-existence-tricky}.
\end{proof}





\section{Being proper over a base}
\label{section-proper-over-base}

\noindent
This is just a short section to point out some useful features
of closed subsets proper over a base and finite type, quasi-coherent
modules with support proper over a base.

\begin{lemma}
\label{lemma-closed-proper-over-base}
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $Z \subset X$ be a closed subset. The following are equivalent
\begin{enumerate}
\item the morphism $Z \to S$ is proper if $Z$ is endowed with the reduced
induced closed subscheme structure
(Schemes, Definition \ref{schemes-definition-reduced-induced-scheme}),
\item for some closed subscheme structure on $Z$ the morphism $Z \to S$
is proper,
\item for any closed subscheme structure on $Z$ the morphism
$Z \to S$ is proper.
\end{enumerate}
\end{lemma}

\begin{proof}
The implications (3) $\Rightarrow$ (2) and (1) $\Rightarrow$ (2)
are immediate. Thus it suffices to prove that (2) implies (3).
We urge the reader to find their own proof of this fact.
Let $Z'$ and $Z''$ be closed subscheme structures on $Z$
such that $Z' \to S$ is proper. We have to show that $Z'' \to S$ is proper.
Let $Z''' = Z' \cup Z''$ be the scheme theoretic union, see
Morphisms, Definition
\ref{morphisms-definition-scheme-theoretic-intersection-union}.
Then $Z'''$ is another closed subscheme structure on $Z$.
This follows for example from the description of scheme theoretic unions in
Morphisms, Lemma \ref{morphisms-lemma-scheme-theoretic-union}.
Since $Z'' \to Z'''$ is a closed immersion it suffices to prove
that $Z''' \to S$ is proper (see
Morphisms, Lemmas \ref{morphisms-lemma-closed-immersion-proper} and
\ref{morphisms-lemma-composition-proper}).
The morphism $Z' \to Z'''$ is a bijective closed immersion
and in particular surjective and universally closed.
Then the fact that $Z' \to S$ is separated implies that
$Z''' \to S$ is separated, see
Morphisms, Lemma \ref{morphisms-lemma-image-universally-closed-separated}.
Moreover $Z''' \to S$ is locally of finite type
as $X \to S$ is locally of finite type
(Morphisms, Lemmas \ref{morphisms-lemma-immersion-locally-finite-type} and
\ref{morphisms-lemma-composition-finite-type}).
Since $Z' \to S$ is quasi-compact and $Z' \to Z'''$ is a homeomorphism
we see that $Z''' \to S$ is quasi-compact.
Finally, since $Z' \to S$ is universally closed, we see that
the same thing is true for $Z''' \to S$ by
Morphisms, Lemma \ref{morphisms-lemma-image-proper-is-proper}.
This finishes the proof.
\end{proof}

\begin{definition}
\label{definition-proper-over-base}
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $Z \subset X$ be a closed subset.
We say {\it $Z$ is proper over $S$}
if the equivalent conditions of Lemma \ref{lemma-closed-proper-over-base}
are satisfied.
\end{definition}

\noindent
The lemma used in the definition above is false if the morphism
$f : X \to S$ is not locally of finite type. Therefore we urge
the reader not to use this terminology if $f$ is not locally of
finite type.

\begin{lemma}
\label{lemma-closed-closed-proper-over-base}
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $Y \subset Z \subset X$ be closed subsets.
If $Z$ is proper over $S$, then the same is true for $Y$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-closed-proper-over-base}
Consider a cartesian diagram of schemes
$$
\xymatrix{
X' \ar[d]_{f'} \ar[r]_{g'} & X \ar[d]^f \\
S' \ar[r]^g & S
}
$$
with $f$ locally of finite type.
If $Z$ is a closed subset of $X$ proper over $S$, then
$(g')^{-1}(Z)$ is a closed subset of $X'$ proper over $S'$.
\end{lemma}

\begin{proof}
Observe that the statement makes sense as $f'$ is locally of
finite type by Morphisms, Lemma \ref{morphisms-lemma-base-change-finite-type}.
Endow $Z$ with the reduced induced closed subscheme structure.
Denote $Z' = (g')^{-1}(Z)$ the scheme theoretic inverse image
(Schemes, Definition \ref{schemes-definition-inverse-image-closed-subscheme}).
Then $Z' = X' \times_X Z = (S' \times_S X) \times_X Z = S' \times_S Z$
is proper over $S'$ as a base change of $Z$ over $S$
(Morphisms, Lemma \ref{morphisms-lemma-base-change-proper}).
\end{proof}

\begin{lemma}
\label{lemma-functoriality-closed-proper-over-base}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of schemes which
are locally of finite type over $S$.
\begin{enumerate}
\item If $Y$ is separated over $S$ and $Z \subset X$ is a closed subset
proper over $S$, then $f(Z)$ is a closed subset of $Y$ proper over $S$.
\item If $f$ is universally closed and $Z \subset X$ is a
closed subset proper over $S$, then $f(Z)$ is a closed subset
of $Y$ proper over $S$.
\item If $f$ is proper and $Z \subset Y$ is a closed subset
proper over $S$, then $f^{-1}(Z)$ is a closed subset of $X$ proper over $S$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Assume $Y$ is separated over $S$ and $Z \subset X$
is a closed subset proper over $S$. Endow $Z$ with the reduced induced
closed subscheme structure and apply
Morphisms, Lemma \ref{morphisms-lemma-scheme-theoretic-image-is-proper}
to $Z \to Y$ over $S$ to conclude.

\medskip\noindent
Proof of (2). Assume $f$ is universally closed and $Z \subset X$ is a
closed subset proper over $S$. Endow $Z$ and $Z' = f(Z)$ with their reduced
induced closed subscheme structures. We obtain an induced
morphism $Z \to Z'$.
Denote $Z'' = f^{-1}(Z')$ the scheme theoretic inverse image
(Schemes, Definition \ref{schemes-definition-inverse-image-closed-subscheme}).
Then $Z'' \to Z'$ is universally closed as a base change of $f$
(Morphisms, Lemma \ref{morphisms-lemma-base-change-proper}).
Hence $Z \to Z'$ is universally closed as a composition of
the closed immersion $Z \to Z''$ and $Z'' \to Z'$
(Morphisms, Lemmas
\ref{morphisms-lemma-closed-immersion-proper} and
\ref{morphisms-lemma-composition-proper}).
We conclude that $Z' \to S$ is separated by
Morphisms, Lemma \ref{morphisms-lemma-image-universally-closed-separated}.
Since $Z \to S$ is quasi-compact and $Z \to Z'$ is surjective
we see that $Z' \to S$ is quasi-compact.
Since $Z' \to S$ is the composition of $Z' \to Y$ and $Y \to S$
we see that $Z' \to S$ is locally of finite type
(Morphisms, Lemmas \ref{morphisms-lemma-immersion-locally-finite-type} and
\ref{morphisms-lemma-composition-finite-type}).
Finally, since $Z \to S$ is universally closed, we see that
the same thing is true for $Z' \to S$ by
Morphisms, Lemma \ref{morphisms-lemma-image-proper-is-proper}.
This finishes the proof.

\medskip\noindent
Proof of (3). Assume $f$ is proper and $Z \subset Y$ is a closed subset
proper over $S$. Endow $Z$ with the reduced induced closed subscheme
structure. Denote $Z' = f^{-1}(Z)$ the scheme theoretic inverse image
(Schemes, Definition \ref{schemes-definition-inverse-image-closed-subscheme}).
Then $Z' \to Z$ is proper as a base change of $f$
(Morphisms, Lemma \ref{morphisms-lemma-base-change-proper}).
Whence $Z' \to S$ is proper as the composition of $Z' \to Z$
and $Z \to S$
(Morphisms, Lemma \ref{morphisms-lemma-composition-proper}).
This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-union-closed-proper-over-base}
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $Z_i \subset X$, $i = 1, \ldots, n$ be closed subsets.
If $Z_i$, $i = 1, \ldots, n$ are proper over $S$, then the same is
true for $Z_1 \cup \ldots \cup Z_n$.
\end{lemma}

\begin{proof}
Endow $Z_i$ with their reduced induced closed subscheme structures.
The morphism
$$
Z_1 \amalg \ldots \amalg Z_n \longrightarrow X
$$
is finite by Morphisms, Lemmas
\ref{morphisms-lemma-closed-immersion-finite} and
\ref{morphisms-lemma-finite-union-finite}.
As finite morphisms are universally closed
(Morphisms, Lemma \ref{morphisms-lemma-finite-proper})
and since $Z_1 \amalg \ldots \amalg Z_n$ is proper over $S$
we conclude by
Lemma \ref{lemma-functoriality-closed-proper-over-base} part (2)
that the image $Z_1 \cup \ldots \cup Z_n$ is proper over $S$.
\end{proof}

\noindent
Let $f : X \to S$ be a morphism of schemes which is locally
of finite type. Let $\mathcal{F}$ be a finite type, quasi-coherent
$\mathcal{O}_X$-module. Then the support $\text{Supp}(\mathcal{F})$
of $\mathcal{F}$ is a closed subset of $X$, see
Morphisms, Lemma \ref{morphisms-lemma-support-finite-type}.
Hence it makes sense to say
``the support of $\mathcal{F}$ is proper over $S$''.

\begin{lemma}
\label{lemma-module-support-proper-over-base}
Let $f : X \to S$ be a morphism of schemes which is locally
of finite type. Let $\mathcal{F}$ be a finite type, quasi-coherent
$\mathcal{O}_X$-module. The following are equivalent
\begin{enumerate}
\item the support of $\mathcal{F}$ is proper over $S$,
\item the scheme theoretic support of $\mathcal{F}$
(Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-support})
is proper over $S$, and
\item there exists a closed subscheme $Z \subset X$ and
a finite type, quasi-coherent $\mathcal{O}_Z$-module
$\mathcal{G}$ such that (a) $Z \to S$ is proper, and (b)
$(Z \to X)_*\mathcal{G} = \mathcal{F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
The support $\text{Supp}(\mathcal{F})$ of $\mathcal{F}$ is a closed subset
of $X$, see Morphisms, Lemma \ref{morphisms-lemma-support-finite-type}.
Hence we can apply Definition \ref{definition-proper-over-base}.
Since the scheme theoretic support of $\mathcal{F}$ is a closed
subscheme whose underlying closed subset is $\text{Supp}(\mathcal{F})$
we see that (1) and (2) are equivalent by
Definition \ref{definition-proper-over-base}.
It is clear that (2) implies (3).
Conversely, if (3) is true, then
$\text{Supp}(\mathcal{F}) \subset Z$
(an inclusion of closed subsets of $X$)
and hence $\text{Supp}(\mathcal{F})$
is proper over $S$ for example by
Lemma \ref{lemma-closed-closed-proper-over-base}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-module-support-proper-over-base}
Consider a cartesian diagram of schemes
$$
\xymatrix{
X' \ar[d]_{f'} \ar[r]_{g'} & X \ar[d]^f \\
S' \ar[r]^g & S
}
$$
with $f$ locally of finite type. Let $\mathcal{F}$ be a
finite type, quasi-coherent $\mathcal{O}_X$-module.
If the support of $\mathcal{F}$ is proper over $S$, then
the support of $(g')^*\mathcal{F}$ is proper over $S'$.
\end{lemma}

\begin{proof}
Observe that the statement makes sense because
$(g')*\mathcal{F}$ is of finite type by
Modules, Lemma \ref{modules-lemma-pullback-finite-type}.
We have $\text{Supp}((g')^*\mathcal{F}) = (g')^{-1}(\text{Supp}(\mathcal{F}))$
by Morphisms, Lemma \ref{morphisms-lemma-support-finite-type}.
Thus the lemma follows from
Lemma \ref{lemma-base-change-closed-proper-over-base}.
\end{proof}

\begin{lemma}
\label{lemma-cat-module-support-proper-over-base}
Let $f : X \to S$ be a morphism of schemes which is locally
of finite type. Let $\mathcal{F}$, $\mathcal{G}$
be finite type, quasi-coherent $\mathcal{O}_X$-module.
\begin{enumerate}
\item If the supports of $\mathcal{F}$, $\mathcal{G}$
are proper over $S$, then the same is true
for $\mathcal{F} \oplus \mathcal{G}$, for any extension
of $\mathcal{G}$ by $\mathcal{F}$, for $\Im(u)$ and $\Coker(u)$
given any $\mathcal{O}_X$-module map $u : \mathcal{F} \to \mathcal{G}$,
and for any quasi-coherent quotient of $\mathcal{F}$ or $\mathcal{G}$.
\item If $S$ is locally Noetherian, then the category of
coherent $\mathcal{O}_X$-modules with support proper over
$S$ is a Serre subcategory (Homology, Definition
\ref{homology-definition-serre-subcategory})
of the abelian category of
coherent $\mathcal{O}_X$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $Z$, $Z'$ be the support of $\mathcal{F}$
and $\mathcal{G}$. Then all the sheaves mentioned in (1)
have support contained in $Z \cup Z'$. Thus the assertion itself
is clear from Lemmas \ref{lemma-closed-closed-proper-over-base} and
\ref{lemma-union-closed-proper-over-base}
provided we check that these sheaves are finite type
and quasi-coherent. For quasi-coherence we refer the reader to
Schemes, Section \ref{schemes-section-quasi-coherent}.
For ``finite type'' we suggest the reader take a look at
Modules, Section \ref{modules-section-finite-type}.

\medskip\noindent
Proof of (2). The proof is the same as the proof of (1). Note that
the assertions make sense as $X$ is locally Noetherian by
Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}
and by the description of the category of coherent
modules in Section \ref{section-coherent-sheaves}.
\end{proof}

\begin{lemma}
\label{lemma-support-proper-over-base-pushforward}
Let $S$ be a locally Noetherian scheme.
Let $f : X \to S$ be a morphism of schemes which is locally of finite type.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module
with support proper over $S$. Then $R^pf_*\mathcal{F}$
is a coherent $\mathcal{O}_S$-module for all $p \geq 0$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-module-support-proper-over-base}
there exists a closed immersion $i : Z \to X$ and
a finite type, quasi-coherent $\mathcal{O}_Z$-module
$\mathcal{G}$ such that (a) $g = f \circ i : Z \to S$ is proper, and (b)
$i_*\mathcal{G} = \mathcal{F}$.
We see that $R^pg_*\mathcal{G}$ is coherent on $S$ by
Proposition \ref{proposition-proper-pushforward-coherent}.
On the other hand, $R^qi_*\mathcal{G} = 0$ for $q > 0$
(Lemma \ref{lemma-finite-pushforward-coherent}).
By Cohomology, Lemma \ref{cohomology-lemma-relative-Leray}
we get $R^pf_*\mathcal{F} = R^pg_*\mathcal{G}$ which concludes the proof.
\end{proof}

\begin{lemma}
\label{lemma-systems-with-proper-support}
Let $S$ be a Noetherian scheme. Let $f : X \to S$ be a finite type morphism.
Let $\mathcal{I} \subset \mathcal{O}_X$ be
a quasi-coherent sheaf of ideals. The following are Serre subcategories
of $\textit{Coh}(X, \mathcal{I})$
\begin{enumerate}
\item the full subcategory of $\textit{Coh}(X, \mathcal{I})$
consisting of those objects $(\mathcal{F}_n)$ such that
the support of $\mathcal{F}_1$ is proper over $S$,
\item the full subcategory of $\textit{Coh}(X, \mathcal{I})$
consisting of those objects $(\mathcal{F}_n)$ such that
there exists a closed subscheme $Z \subset X$ proper over $S$
with $\mathcal{I}_Z \mathcal{F}_n = 0$ for all $n \geq 1$.
\end{enumerate}
\end{lemma}

\begin{proof}
We will use the criterion of
Homology, Lemma \ref{homology-lemma-characterize-serre-subcategory}.
Moreover, we will use that if
$0 \to (\mathcal{G}_n) \to (\mathcal{F}_n) \to (\mathcal{H}_n) \to 0$
is a short exact sequence of $\textit{Coh}(X, \mathcal{I})$, then
(a) $\mathcal{G}_n \to \mathcal{F}_n \to \mathcal{H}_n \to 0$
is exact for all $n \geq 1$ and
(b) $\mathcal{G}_n$ is a quotient of $\Ker(\mathcal{F}_m \to \mathcal{H}_m)$
for some $m \geq n$. See proof of Lemma \ref{lemma-inverse-systems-abelian}.

\medskip\noindent
Proof of (1). Let $(\mathcal{F}_n)$ be an object of
$\textit{Coh}(X, \mathcal{I})$. Then
$\text{Supp}(\mathcal{F}_n) = \text{Supp}(\mathcal{F}_1)$ for all $n \geq 1$.
Hence by remarks (a) and (b) above we see that
for any short exact sequence
$0 \to (\mathcal{G}_n) \to (\mathcal{F}_n) \to (\mathcal{H}_n) \to 0$
of $\textit{Coh}(X, \mathcal{I})$ we have
$\text{Supp}(\mathcal{G}_1) \cup \text{Supp}(\mathcal{H}_1) =
\text{Supp}(\mathcal{F}_1)$.
This proves that the category defined in (1)
is a Serre subcategory of $\textit{Coh}(X, \mathcal{I})$.

\medskip\noindent
Proof of (2). Here we argue the same way. Let
$0 \to (\mathcal{G}_n) \to (\mathcal{F}_n) \to (\mathcal{H}_n) \to 0$
be a short exact sequence of $\textit{Coh}(X, \mathcal{I})$.
If $Z \subset X$ is a closed subscheme and $\mathcal{I}_Z$
annihilates $\mathcal{F}_n$ for all $n$, then
$\mathcal{I}_Z$ annihilates $\mathcal{G}_n$ and $\mathcal{H}_n$
for all $n$ by (a) and (b) above.
Hence if $Z \to S$ is proper, then we conclude that the category
defined in (2) is closed under taking sub and quotient objects
inside of $\textit{Coh}(X, \mathcal{I})$.
Finally, suppose that $Z \subset X$ and $Y \subset X$ are
closed subschemes proper over $S$ such that
$\mathcal{I}_Z \mathcal{G}_n = 0$ and
$\mathcal{I}_Y \mathcal{H}_n = 0$ for all $n \geq 1$.
Then it follows from (a) above that
$\mathcal{I}_{Z \cup Y} = \mathcal{I}_Z \cdot \mathcal{I}_Y$
annihilates $\mathcal{F}_n$ for all $n$.
By Lemma \ref{lemma-union-closed-proper-over-base}
(and via Definition \ref{definition-proper-over-base} which
tells us we may choose an arbitrary scheme structure used on the union)
we see that $Z \cup Y \to S$ is proper and the proof is complete.
\end{proof}








\section{Grothendieck's existence theorem, III}
\label{section-existence-proper-support}

\noindent
To state the general version of Grothendieck's existence theorem
we introduce a bit more notation. Let $A$ be a Noetherian ring
complete with respect to an ideal $I$. Let $f : X \to \Spec(A)$
be a separated finite type morphism of schemes. Set
$\mathcal{I} = I\mathcal{O}_X$. In this situation we let
$$
\textit{Coh}_{\text{support proper over } A}(\mathcal{O}_X)
$$
be the full subcategory of $\textit{Coh}(\mathcal{O}_X)$
consisting of those coherent $\mathcal{O}_X$-modules whose
support is proper over $\Spec(A)$. This is a Serre subcategory of
$\textit{Coh}(\mathcal{O}_X)$, see
Lemma \ref{lemma-cat-module-support-proper-over-base}.
Similarly, we let
$$
\textit{Coh}_{\text{support proper over } A}(X, \mathcal{I})
$$
be the full subcategory of $\textit{Coh}(X, \mathcal{I})$
consisting of those objects $(\mathcal{F}_n)$ such that
the support of $\mathcal{F}_1$ is proper over $\Spec(A)$.
This is a Serre subcategory of $\textit{Coh}(X, \mathcal{I})$
by Lemma \ref{lemma-systems-with-proper-support} part (1).
Since the support of a quotient module is contained in the support
of the module, it follows that (\ref{equation-completion-functor})
induces a functor
\begin{equation}
\label{equation-completion-functor-proper-over-A}
\textit{Coh}_{\text{support proper over }A}(\mathcal{O}_X)
\longrightarrow
\textit{Coh}_{\text{support proper over }A}(X, \mathcal{I})
\end{equation}
We are now ready to state the main theorem of this section.

\begin{theorem}[Grothendieck's existence theorem]
\label{theorem-grothendieck-existence}
\begin{reference}
\cite[III Theorem 5.1.5]{EGA}
\end{reference}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Let $X$ be a separated, finite type scheme over $A$. Then
the functor
(\ref{equation-completion-functor-proper-over-A})
$$
\textit{Coh}_{\text{support proper over }A}(\mathcal{O}_X)
\longrightarrow
\textit{Coh}_{\text{support proper over }A}(X, \mathcal{I})
$$
is an equivalence.
\end{theorem}

\begin{proof}
We will use the equivalence of categories of
Lemma \ref{lemma-i-star-equivalence}
without further mention.
For a closed subscheme $Z \subset X$ proper over $A$
in this proof we will say a coherent module on $X$ is
``supported on $Z$'' if it is annihilated by the ideal
sheaf of $Z$ or equivalently if it is the pushforward
of a coherent module on $Z$.
By Proposition \ref{proposition-existence-proper} we know
that the result is true for
the functor between coherent modules and systems of coherent
modules supported on $Z$. Hence it suffices to show that
every object of
$\textit{Coh}_{\text{support proper over }A}(\mathcal{O}_X)$
and every object of
$\textit{Coh}_{\text{support proper over }A}(X, \mathcal{I})$ is
supported on a closed subscheme $Z \subset X$ proper over $A$.
This holds by definition for objects of
$\textit{Coh}_{\text{support proper over }A}(\mathcal{O}_X)$.
We will prove this statement for objects of
$\textit{Coh}_{\text{support proper over }A}(X, \mathcal{I})$
using the method of proof of Proposition \ref{proposition-existence-proper}.
We urge the reader to read that proof first.

\medskip\noindent
Consider the collection $\Xi$ of quasi-coherent sheaves of ideals
$\mathcal{K} \subset \mathcal{O}_X$ such that the statement holds
for every object $(\mathcal{F}_n)$ of
$\textit{Coh}_{\text{support proper over }A}(X, \mathcal{I})$
annihilated by $\mathcal{K}$. We want to show $(0)$ is in $\Xi$.
If not, then since $X$ is Noetherian there exists a maximal
quasi-coherent sheaf of ideals $\mathcal{K}$ not in $\Xi$, see
Lemma \ref{lemma-acc-coherent}.
After replacing $X$ by the closed subscheme of $X$
corresponding to $\mathcal{K}$ we may assume that every nonzero
$\mathcal{K}$ is in $\Xi$. Let $(\mathcal{F}_n)$ be an object of
$\textit{Coh}_{\text{support proper over }A}(X, \mathcal{I})$.
We will show that this object is supported on a closed subscheme
$Z \subset X$ proper over $A$, thereby completing the
proof of the theorem.

\medskip\noindent
Apply Chow's lemma (Lemma \ref{lemma-chow-Noetherian}) to find a
proper surjective morphism $f : Y \to X$ which is an isomorphism
over a dense open $U \subset X$ such that $Y$ is H-quasi-projective
over $A$. Choose an open immersion $j : Y \to Y'$ with
$Y'$ projective over $A$, see
Morphisms, Lemma \ref{morphisms-lemma-H-quasi-projective-open-H-projective}.
Observe that
$$
\text{Supp}(f^*\mathcal{F}_n) = f^{-1}\text{Supp}(\mathcal{F}_n) =
f^{-1}\text{Supp}(\mathcal{F}_1)
$$
The first equality by
Morphisms, Lemma \ref{morphisms-lemma-support-finite-type}.
By assumption and
Lemma \ref{lemma-functoriality-closed-proper-over-base} part (3)
we see that $f^{-1}\text{Supp}(\mathcal{F}_1)$ is proper over $A$.
Hence the image of $f^{-1}\text{Supp}(\mathcal{F}_1)$
under $j$ is closed in $Y'$ by
Lemma \ref{lemma-functoriality-closed-proper-over-base} part (1).
Thus $\mathcal{F}'_n = j_*f^*\mathcal{F}_n$ is coherent on
$Y'$ by Lemma \ref{lemma-pushforward-coherent-on-open}.
It follows that $(\mathcal{F}_n')$
is an object of $\textit{Coh}(Y', I\mathcal{O}_{Y'})$.
By the projective case of Grothendieck's existence theorem
(Lemma \ref{lemma-existence-projective})
there exists a coherent $\mathcal{O}_{Y'}$-module
$\mathcal{F}'$ and an isomorphism
$(\mathcal{F}')^\wedge \cong (\mathcal{F}'_n)$ in
$\textit{Coh}(Y', I\mathcal{O}_{Y'})$.
Since $\mathcal{F}'/I\mathcal{F}' = \mathcal{F}'_1$ we see that
$$
\text{Supp}(\mathcal{F}') \cap V(I\mathcal{O}_{Y'}) =
\text{Supp}(\mathcal{F}'_1) = j(f^{-1}\text{Supp}(\mathcal{F}_1))
$$
The structure morphism $p' : Y' \to \Spec(A)$ is proper, hence
$p'(\text{Supp}(\mathcal{F}') \setminus j(Y))$
is closed in $\Spec(A)$. A nonempty closed subset of $\Spec(A)$
contains a point of $V(I)$ as $I$ is contained in the Jacobson radical
of $A$ by Algebra, Lemma \ref{algebra-lemma-radical-completion}.
The displayed equation shows that
$\text{Supp}(\mathcal{F}') \cap (p')^{-1}V(I) \subset j(Y)$
hence we conclude that $\text{Supp}(\mathcal{F}') \subset j(Y)$.
Thus $\mathcal{F}'|_Y = j^*\mathcal{F}'$
is supported on a closed subscheme $Z'$ of $Y$ proper over $A$
and $(\mathcal{F}'|_Y)^\wedge = (f^*\mathcal{F}_n)$.

\medskip\noindent
Let $\mathcal{K}$ be the quasi-coherent sheaf of ideals cutting
out the reduced complement $X \setminus U$. By
Proposition \ref{proposition-proper-pushforward-coherent}
the $\mathcal{O}_X$-module $\mathcal{H} = f_*(\mathcal{F}'|_Y)$ is coherent
and by Lemma \ref{lemma-inverse-systems-push-pull}
there exists a morphism $\alpha : (\mathcal{F}_n) \to \mathcal{H}^\wedge$
of $\textit{Coh}(X, \mathcal{I})$ whose kernel and cokernel are
annihilated by a power $\mathcal{K}^t$ of $\mathcal{K}$.
We obtain an exact sequence
$$
0 \to \Ker(\alpha) \to (\mathcal{F}_n) \to
\mathcal{H}^\wedge \to \Coker(\alpha) \to 0
$$
in $\textit{Coh}(X, \mathcal{I})$. If $Z_0 \subset X$ is the scheme theoretic
support of $\mathcal{H}$, then it is clear that $Z_0 \subset f(Z')$
set-theoretically. Hence $Z_0$ is proper over $A$ by
Lemma \ref{lemma-closed-closed-proper-over-base} and
Lemma \ref{lemma-functoriality-closed-proper-over-base} part (2).
Hence $\mathcal{H}^\wedge$ is in the subcategory defined in
Lemma \ref{lemma-systems-with-proper-support} part (2)
and a fortiori in
$\textit{Coh}_{\text{support proper over }A}(X, \mathcal{I})$.
We conclude that $\Ker(\alpha)$ and $\Coker(\alpha)$
are in $\textit{Coh}_{\text{support proper over }A}(X, \mathcal{I})$
by Lemma \ref{lemma-systems-with-proper-support} part (1).
By induction hypothesis, more precisely because $\mathcal{K}^t$ is in $\Xi$,
we see that $\Ker(\alpha)$ and $\Coker(\alpha)$ are in
the subcategory defined in
Lemma \ref{lemma-systems-with-proper-support} part (2).
Since this is a Serre subcategory by the lemma, we conclude that the
same is true for $(\mathcal{F}_n)$ which is what we wanted to show.
\end{proof}

\begin{remark}[Unwinding Grothendieck's existence theorem]
\label{remark-reformulate-existence-theorem}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Write $S = \Spec(A)$ and $S_n = \Spec(A/I^n)$.
Let $X \to S$ be a separated morphism of finite type.
For $n \geq 1$ we set $X_n = X \times_S S_n$.
Picture:
$$
\xymatrix{
X_1 \ar[r]_{i_1} \ar[d] & X_2 \ar[r]_{i_2} \ar[d] & X_3 \ar[r] \ar[d] &
\ldots & X \ar[d] \\
S_1 \ar[r] & S_2 \ar[r] & S_3 \ar[r] & \ldots & S
}
$$
In this situation we consider systems $(\mathcal{F}_n, \varphi_n)$
where
\begin{enumerate}
\item $\mathcal{F}_n$ is a coherent $\mathcal{O}_{X_n}$-module,
\item $\varphi_n : i_n^*\mathcal{F}_{n + 1} \to \mathcal{F}_n$
is an isomorphism, and
\item $\text{Supp}(\mathcal{F}_1)$ is proper over $S_1$.
\end{enumerate}
Theorem \ref{theorem-grothendieck-existence} says that the
completion functor
$$
\begin{matrix}
\text{coherent }\mathcal{O}_X\text{-modules }\mathcal{F} \\
\text{with support proper over }A
\end{matrix}
\quad
\longrightarrow
\quad
\begin{matrix}
\text{systems }(\mathcal{F}_n) \\
\text{as above}
\end{matrix}
$$
is an equivalence of categories. In the special case that $X$ is
proper over $A$ we can omit the conditions on the supports.
\end{remark}



\section{Grothendieck's algebraization theorem}
\label{section-algebraization}

\noindent
Our first result is a translation of Grothendieck's existence
theorem in terms of closed subschemes and finite morphisms.

\begin{lemma}
\label{lemma-algebraize-formal-closed-subscheme}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Write $S = \Spec(A)$ and $S_n = \Spec(A/I^n)$.
Let $X \to S$ be a separated morphism of finite type.
For $n \geq 1$ we set $X_n = X \times_S S_n$.
Suppose given a commutative diagram
$$
\xymatrix{
Z_1 \ar[r] \ar[d] & Z_2 \ar[r] \ar[d] & Z_3 \ar[r] \ar[d] & \ldots \\
X_1 \ar[r]^{i_1} & X_2 \ar[r]^{i_2} & X_3 \ar[r] & \ldots
}
$$
of schemes with cartesian squares. Assume that
\begin{enumerate}
\item $Z_1 \to X_1$ is a closed immersion, and
\item $Z_1 \to S_1$ is proper.
\end{enumerate}
Then there exists a closed immersion of schemes $Z \to X$ such that
$Z_n = Z \times_S S_n$. Moreover, $Z$ is proper over $S$.
\end{lemma}

\begin{proof}
Let's write $j_n : Z_n \to X_n$ for the vertical morphisms.
As the squares in the statement are cartesian
we see that the base change of $j_n$ to $X_1$ is $j_1$.
Thus Morphisms, Lemma \ref{morphisms-lemma-check-closed-infinitesimally}
shows that $j_n$ is a closed immersion.
Set $\mathcal{F}_n = j_{n, *}\mathcal{O}_{Z_n}$, so that
$j_n^\sharp$ is a surjection $\mathcal{O}_{X_n} \to \mathcal{F}_n$.
Again using that the squares are cartesian we see that
the pullback of $\mathcal{F}_{n + 1}$ to $X_n$ is $\mathcal{F}_n$.
Hence Grothendieck's existence theorem, as reformulated in
Remark \ref{remark-reformulate-existence-theorem},
tells us there exists a map
$\mathcal{O}_X \to \mathcal{F}$
of coherent $\mathcal{O}_X$-modules whose restriction to
$X_n$ recovers $\mathcal{O}_{X_n} \to \mathcal{F}_n$.
Moreover, the support of $\mathcal{F}$ is proper over $S$.
As the completion functor is exact (Lemma \ref{lemma-exact})
we see that the cokernel $\mathcal{Q}$ of $\mathcal{O}_X \to \mathcal{F}$
has vanishing completion. Since $\mathcal{F}$ has support
proper over $S$ and so does $\mathcal{Q}$ this implies that
$\mathcal{Q} = 0$ for example because the functor
(\ref{equation-completion-functor-proper-over-A}) is an equivalence
by Grothendieck's existence theorem.
Thus $\mathcal{F} = \mathcal{O}_X/\mathcal{J}$
for some quasi-coherent sheaf of ideals $\mathcal{J}$.
Setting $Z = V(\mathcal{J})$ finishes the proof.
\end{proof}

\noindent
In the following lemma it is actually enough to assume that $Y_1 \to X_1$
is finite as it will imply that $Y_n \to X_n$ is finite too
(see More on Morphisms, Lemma
\ref{more-morphisms-lemma-thicken-property-morphisms-cartesian}).

\begin{lemma}
\label{lemma-algebraize-formal-scheme-finite-over-proper}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Write $S = \Spec(A)$ and $S_n = \Spec(A/I^n)$.
Let $X \to S$ be a separated morphism of finite type.
For $n \geq 1$ we set $X_n = X \times_S S_n$.
Suppose given a commutative diagram
$$
\xymatrix{
Y_1 \ar[r] \ar[d] & Y_2 \ar[r] \ar[d] & Y_3 \ar[r] \ar[d] & \ldots \\
X_1 \ar[r]^{i_1} & X_2 \ar[r]^{i_2} & X_3 \ar[r] & \ldots
}
$$
of schemes with cartesian squares. Assume that
\begin{enumerate}
\item $Y_n \to X_n$ is a finite morphism, and
\item $Y_1 \to S_1$ is proper.
\end{enumerate}
Then there exists a finite morphism of schemes $Y \to X$ such that
$Y_n = Y \times_S S_n$. Moreover, $Y$ is proper over $S$.
\end{lemma}

\begin{proof}
Let's write $f_n : Y_n \to X_n$ for the vertical morphisms.
Set $\mathcal{F}_n = f_{n, *}\mathcal{O}_{Y_n}$. This is
a coherent $\mathcal{O}_{X_n}$-module as $f_n$ is finite
(Lemma \ref{lemma-finite-pushforward-coherent}).
Using that the squares are cartesian we see that
the pullback of $\mathcal{F}_{n + 1}$ to $X_n$ is $\mathcal{F}_n$.
Hence Grothendieck's existence theorem, as reformulated in
Remark \ref{remark-reformulate-existence-theorem},
tells us there exists a coherent $\mathcal{O}_X$-module
$\mathcal{F}$ whose restriction to $X_n$ recovers $\mathcal{F}_n$.
Moreover, the support of $\mathcal{F}$ is proper over $S$.
As the completion functor is fully faithful
(Theorem \ref{theorem-grothendieck-existence})
we see that the multiplication maps
$\mathcal{F}_n \otimes_{\mathcal{O}_{X_n}} \mathcal{F}_n \to
\mathcal{F}_n$ fit together to give an algebra structure on $\mathcal{F}$.
Setting $Y = \underline{\Spec}_X(\mathcal{F})$ finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-algebraize-morphism}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Write $S = \Spec(A)$ and $S_n = \Spec(A/I^n)$. Let $X$, $Y$ be schemes
over $S$. For $n \geq 1$ we set $X_n = X \times_S S_n$ and
$Y_n = Y \times_S S_n$. Suppose given a compatible system of
commutative diagrams
$$
\xymatrix{
& & X_{n + 1} \ar[rd] \ar[rr]_{g_{n + 1}} & & Y_{n + 1} \ar[ld] \\
X_n \ar[rru] \ar[rd] \ar[rr]_{g_n} & & Y_n \ar[rru] \ar[ld] & S_{n + 1} \\
& S_n \ar[rru]
}
$$
Assume that
\begin{enumerate}
\item $X \to S$ is proper, and
\item $Y \to S$ is separated of finite type.
\end{enumerate}
Then there exists a unique morphism of schemes $g : X \to Y$
over $S$ such that $g_n$ is the base change of $g$ to $S_n$.
\end{lemma}

\begin{proof}
The morphisms $(1, g_n) : X_n \to X_n \times_S Y_n$ are closed immersions
because $Y_n \to S_n$ is separated
(Schemes, Lemma \ref{schemes-lemma-section-immersion}). Thus by
Lemma \ref{lemma-algebraize-formal-closed-subscheme}
there exists a closed subscheme $Z \subset X \times_S Y$
proper over $S$ whose base change to $S_n$ recovers
$X_n \subset X_n \times_S Y_n$. The first projection $p : Z \to X$
is a proper morphism (as $Z$ is proper over $S$, see
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed})
whose base change to $S_n$ is an isomorphism
for all $n$. In particular, $p : Z \to X$ is finite over an open
neighbourhood of $X_0$ by
Lemma \ref{lemma-proper-finite-fibre-finite-in-neighbourhood}.
As $X$ is proper over $S$ this open neighbourhood is all of $X$
and we conclude $p : Z \to X$ is finite.
Applying the equivalence of Proposition \ref{proposition-existence-proper}
we see that $p_*\mathcal{O}_Z = \mathcal{O}_X$ as this is true
modulo $I^n$ for all $n$. Hence $p$ is an isomorphism and we obtain
the morphism $g$ as the composition $X \cong Z \to Y$.
We omit the proof of uniqueness.
\end{proof}

\noindent
In order to prove an ``abstract'' algebraization theorem we need
to assume we have an ample invertible sheaf, as the result is false
without such an assumption.

\begin{theorem}[Grothendieck's algebraization theorem]
\label{theorem-algebraization}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Set $S = \Spec(A)$ and $S_n = \Spec(A/I^n)$. Consider a commutative
diagram
$$
\xymatrix{
X_1 \ar[r]_{i_1} \ar[d] & X_2 \ar[r]_{i_2} \ar[d] & X_3 \ar[r] \ar[d] &
\ldots \\
S_1 \ar[r] & S_2 \ar[r] & S_3 \ar[r] & \ldots
}
$$
of schemes with cartesian squares. Suppose given $(\mathcal{L}_n, \varphi_n)$
where each $\mathcal{L}_n$ is an invertible sheaf on $X_n$ and
$\varphi_n : i_n^*\mathcal{L}_{n + 1} \to \mathcal{L}_n$
is an isomorphism. If
\begin{enumerate}
\item $X_1 \to S_1$ is proper, and
\item $\mathcal{L}_1$ is ample on $X_1$
\end{enumerate}
then there exists a proper morphism of schemes $X \to S$
and an ample invertible $\mathcal{O}_X$-module $\mathcal{L}$
and isomorphisms $X_n \cong X \times_S S_n$ and
$\mathcal{L}_n \cong \mathcal{L}|_{X_n}$ compatible with
the morphisms $i_n$ and $\varphi_n$.
\end{theorem}

\begin{proof}
Since the squares in the diagram are cartesian and since the morphisms
$S_n \to S_{n + 1}$ are closed immersions, we see that the morphisms
$i_n$ are closed immersions too. In particular we may think of
$X_m$ as a closed subscheme of $X_n$ for $m < n$. In fact $X_m$ is
the closed subscheme cut out by the quasi-coherent sheaf of ideals
$I^m\mathcal{O}_{X_n}$. Moreover, the underlying topological spaces
of the schemes $X_1, X_2, X_3, \ldots$ are all identified, hence we
may (and do) think of sheaves $\mathcal{O}_{X_n}$ as living on the
same underlying topological space; similarly for coherent
$\mathcal{O}_{X_n}$-modules. Set
$$
\mathcal{F}_n =
\Ker(\mathcal{O}_{X_{n + 1}} \to \mathcal{O}_{X_n})
$$
so that we obtain short exact sequences
$$
0 \to \mathcal{F}_n \to \mathcal{O}_{X_{n + 1}} \to \mathcal{O}_{X_n} \to 0
$$
By the above we have $\mathcal{F}_n = I^n\mathcal{O}_{X_{n + 1}}$.
It follows $\mathcal{F}_n$ is a coherent sheaf on $X_{n + 1}$
annihilated by $I$, hence we may (and do) think of it as a coherent
module $\mathcal{O}_{X_1}$-module. Observe that for $m > n$ the sheaf
$$
I^n\mathcal{O}_{X_m}/I^{n + 1}\mathcal{O}_{X_m}
$$
maps isomorphically to $\mathcal{F}_n$ under the map
$\mathcal{O}_{X_m} \to \mathcal{O}_{X_{n + 1}}$. Hence given
$n_1, n_2 \geq 0$ we can pick an $m > n_1 + n_2$ and consider the
multiplication map
$$
I^{n_1}\mathcal{O}_{X_m} \times I^{n_2}\mathcal{O}_{X_m}
\longrightarrow
I^{n_1 + n_2}\mathcal{O}_{X_m} \to \mathcal{F}_{n_1 + n_2}
$$
This induces an $\mathcal{O}_{X_1}$-bilinear map
$$
\mathcal{F}_{n_1} \times \mathcal{F}_{n_2} \longrightarrow
\mathcal{F}_{n_1 + n_2}
$$
which in turn defines the structure of a graded $\mathcal{O}_{X_1}$-algebra
on $\mathcal{F} = \bigoplus_{n \geq 0} \mathcal{F}_n$.

\medskip\noindent
Set $B = \bigoplus I^n/I^{n + 1}$; this is a finitely generated
graded $A/I$-algebra. Set $\mathcal{B} = (X_1 \to S_1)^*\widetilde{B}$.
The discussion above provides us with a canonical surjection
$$
\mathcal{B} \longrightarrow \mathcal{F}
$$
of graded $\mathcal{O}_{X_1}$-algebras. In particular we see that
$\mathcal{F}$ is a finite type quasi-coherent graded $\mathcal{B}$-module.
By Lemma \ref{lemma-graded-finiteness} we can find an integer $d_0$
such that $H^1(X_1, \mathcal{F} \otimes \mathcal{L}^{\otimes d}) = 0$
for all $d \geq d_0$. Pick a $d \geq d_0$ such that there exist sections
$s_{0, 1}, \ldots, s_{N, 1} \in \Gamma(X_1, \mathcal{L}_1^{\otimes d})$
which induce an immersion
$$
\psi_1 : X_1 \to \mathbf{P}^N_{S_1}
$$
over $S_1$, see
Morphisms, Lemma \ref{morphisms-lemma-finite-type-over-affine-ample-very-ample}.
As $X_1$ is proper over $S_1$ we see that $\psi_1$
is a closed immersion, see
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}
and
Schemes, Lemma \ref{schemes-lemma-immersion-when-closed}.
We are going to ``lift'' $\psi_1$ to a compatible system of
closed immersions of $X_n$ into $\mathbf{P}^N$.

\medskip\noindent
Upon tensoring the short exact sequences of the first paragraph
of the proof
by $\mathcal{L}_{n + 1}^{\otimes d}$ we obtain short exact sequences
$$
0 \to \mathcal{F}_n \otimes \mathcal{L}_{n + 1}^{\otimes d} \to
\mathcal{L}_{n + 1}^{\otimes d} \to \mathcal{L}_{n + 1}^{\otimes d} \to 0
$$
Using the isomorphisms $\varphi_n$ we obtain isomorphisms
$\mathcal{L}_{n + 1} \otimes \mathcal{O}_{X_l} = \mathcal{L}_l$
for $l \leq n$. Whence the sequence above becomes
$$
0 \to \mathcal{F}_n \otimes \mathcal{L}_1^{\otimes d} \to
\mathcal{L}_{n + 1}^{\otimes d} \to \mathcal{L}_n^{\otimes d} \to 0
$$
The vanishing of $H^1(X, \mathcal{F}_n \otimes \mathcal{L}_1^{\otimes d})$
implies we can inductively lift
$s_{0, 1}, \ldots, s_{N, 1} \in \Gamma(X_1, \mathcal{L}_1^{\otimes d})$
to sections
$s_{0, n}, \ldots, s_{N, n} \in \Gamma(X_n, \mathcal{L}_n^{\otimes d})$.
Thus we obtain a commutative diagram
$$
\xymatrix{
X_1 \ar[r]_{i_1} \ar[d]_{\psi_1} &
X_2 \ar[r]_{i_2} \ar[d]_{\psi_2} &
X_3 \ar[r] \ar[d]_{\psi_3} &
\ldots \\
\mathbf{P}^N_{S_1} \ar[r] &
\mathbf{P}^N_{S_2} \ar[r] &
\mathbf{P}^N_{S_3} \ar[r] & \ldots
}
$$
where
$\psi_n = \varphi_{(\mathcal{L}_n, (s_{0, n}, \ldots, s_{N, n}))}$
in the notation of Constructions, Section
\ref{constructions-section-projective-space}.
As the squares in the statement of the theorem are cartesian
we see that the squares in the above diagram are cartesian.
We win by applying Lemma \ref{lemma-algebraize-formal-closed-subscheme}.
\end{proof}

















\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
