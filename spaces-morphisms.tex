\input{preamble}

% OK, start here.
%
\begin{document}

\title{Morphisms of Algebraic Spaces}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we introduce some types of morphisms of algebraic spaces.
A reference is \cite{Kn}.

\medskip\noindent
The goal is to extend the definition of each of the types of morphisms of
schemes defined in the chapters on schemes, and on morphisms of schemes
to the category of algebraic spaces. Each case is slightly different and
it seems best to treat them all separately.





\section{Conventions}
\label{section-conventions}

\noindent
The standing assumption is that all schemes are contained in
a big fppf site $\Sch_{fppf}$. And all rings $A$ considered
have the property that $\Spec(A)$ is (isomorphic) to an
object of this big site.

\medskip\noindent
Let $S$ be a scheme and let $X$ be an algebraic space over $S$.
In this chapter and the following we will write $X \times_S X$
for the product of $X$ with itself (in the category of algebraic
spaces over $S$), instead of $X \times X$.





\section{Properties of representable morphisms}
\label{section-representable}

\noindent
Let $S$ be a scheme.
Let $f : X \to Y$ be a representable morphism of algebraic spaces. In
Spaces, Section \ref{spaces-section-representable-properties}
we defined what it means for $f$ to
have property $\mathcal{P}$ in case $\mathcal{P}$ is a property
of morphisms of schemes which
\begin{enumerate}
\item is preserved under any base change,
see Schemes, Definition \ref{schemes-definition-preserved-by-base-change},
and
\item is fppf local on the base, see
Descent, Definition \ref{descent-definition-property-morphisms-local}.
\end{enumerate}
Namely, in this case we say $f$ has property $\mathcal{P}$ if and only
if for every scheme $U$ and any morphism $U \to Y$ the morphism of schemes
$X \times_Y U \to U$ has property $\mathcal{P}$.

\medskip\noindent
According to the lists in
Spaces, Section \ref{spaces-section-lists}
this applies to the following properties:
(1)(a) closed immersions,
(1)(b) open immersions,
(1)(c) quasi-compact immersions,
(2) quasi-compact,
(3) universally-closed,
(4) (quasi-)separated,
(5) monomorphism,
(6) surjective,
(7) universally injective,
(8) affine,
(9) quasi-affine,
(10) (locally) of finite type,
(11) (locally) quasi-finite,
(12) (locally) of finite presentation,
(13) locally of finite type of relative dimension $d$,
(14) universally open,
(15) flat,
(16) syntomic,
(17) smooth,
(18) unramified (resp.\ G-unramified),
(19) \'etale,
(20) proper,
(21) finite or integral,
(22) finite locally free,
(23) universally submersive,
(24) universal homeomorphism, and
(25) immersion.

\medskip\noindent
In this chapter we will redefine these notions for not necessarily
representable morphisms of algebraic spaces. Whenever we do this we will make
sure that the new definition agrees with the old one, in order to avoid
ambiguity.

\medskip\noindent
Note that the definition above applies whenever $X$ is a scheme,
since a morphism from a scheme to an algebraic space is representable.
And in particular it applies when both $X$ and $Y$ are schemes.
In
Spaces, Lemma
\ref{spaces-lemma-morphism-schemes-gives-representable-transformation-property}
we have seen that in this case the definitions
match, and no ambiguity arise.

\medskip\noindent
Furthermore, in
Spaces, Lemma
\ref{spaces-lemma-base-change-representable-transformations-property}
we have seen that the property of
representable morphisms of algebraic spaces so defined is stable under
arbitrary base change by a morphism of algebraic spaces.
And finally, in
Spaces, Lemmas
\ref{spaces-lemma-composition-representable-transformations-property} and
\ref{spaces-lemma-product-representable-transformations-property}
we have seen that if $\mathcal{P}$ is stable under compositions,
which holds for the properties
(1)(a), (1)(b), (1)(c), (2) -- (25), except (13) above, then
taking products of representable morphisms preserves property $\mathcal{P}$
and compositions of representable morphisms preserves property $\mathcal{P}$.

\medskip\noindent
We will use these facts below, and whenever we do we will simply refer
to this section as a reference.















\section{Separation axioms}
\label{section-separation-axioms}

\noindent
It makes sense to list some a priori properties of the diagonal of
a morphism of algebraic spaces.

\begin{lemma}
\label{lemma-properties-diagonal}
Let $S$ be a scheme contained in $\Sch_{fppf}$.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $\Delta_{X/Y} : X \to X \times_Y X$ be the diagonal morphism.
Then
\begin{enumerate}
\item $\Delta_{X/Y}$ is representable,
\item $\Delta_{X/Y}$ is locally of finite type,
\item $\Delta_{X/Y}$ is a monomorphism,
\item $\Delta_{X/Y}$ is separated, and
\item $\Delta_{X/Y}$ is locally quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
We are going to use the fact that $\Delta_{X/S}$ is
representable (by definition of an algebraic space) and that
it satisfies properties (2) -- (5), see
Spaces, Lemma \ref{spaces-lemma-properties-diagonal}.
Note that we have a factorization
$$
X
\longrightarrow
X \times_Y X
\longrightarrow
X \times_S X
$$
of the diagonal $\Delta_{X/S} : X \to X \times_S X$. Since
$X \times_Y X \to X \times_S X$ is a monomorphism, and since
$\Delta_{X/S}$ is representable, it follows formally that
$\Delta_{X/Y}$ is representable. In particular, the rest of
the statements now make sense, see
Section \ref{section-representable}.

\medskip\noindent
Choose a surjective \'etale morphism $U \to X$, with $U$ a scheme.
Consider the diagram
$$
\xymatrix{
R = U \times_X U \ar[r] \ar[d] &
U \times_Y U \ar[d] \ar[r] &
U \times_S U \ar[d] \\
X \ar[r] & X \times_Y X \ar[r] & X \times_S X
}
$$
Both squares are cartesian, hence so is the outer rectangle.
The top row consists of schemes, and the vertical arrows
are surjective \'etale morphisms. By
Spaces, Lemma \ref{spaces-lemma-representable-morphisms-spaces-property}
the properties (2) -- (5) for $\Delta_{X/Y}$ are equivalent to those of
$R \to U \times_Y U$. In the proof of
Spaces, Lemma \ref{spaces-lemma-properties-diagonal}
we have seen that $R \to U \times_S U$ has properties (2) -- (5).
The morphism $U \times_Y U \to U \times_S U$ is a monomorphism
of schemes. These facts imply that $R \to U \times_Y U$ have
properties (2) -- (5).

\medskip\noindent
Namely: For (3), note that $R \to U \times_Y U$
is a monomorphism as the composition
$R \to U \times_S U$ is a monomorphism. For (2), note that
$R \to U \times_Y U$ is locally of finite type, as the
composition $R \to U \times_S U$ is locally of finite type
(Morphisms, Lemma \ref{morphisms-lemma-permanence-finite-type}).
A monomorphism which is locally of finite type is locally quasi-finite
because it has finite fibres
(Morphisms, Lemma \ref{morphisms-lemma-finite-fibre}), hence (5).
A monomorphism is separated
(Schemes, Lemma \ref{schemes-lemma-monomorphism-separated}), hence (4).
\end{proof}

\begin{definition}
\label{definition-separated}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $\Delta_{X/Y} : X \to X \times_Y X$ be the diagonal morphism.
\begin{enumerate}
\item We say $f$ is {\it separated} if $\Delta_{X/Y}$ is a closed immersion.
\item We say $f$ is {\it locally separated}\footnote{In the literature
this term often refers to quasi-separated and locally separated morphisms.}
if $\Delta_{X/Y}$ is an immersion.
\item We say $f$ is {\it quasi-separated} if $\Delta_{X/Y}$ is quasi-compact.
\end{enumerate}
\end{definition}

\noindent
This definition makes sense since $\Delta_{X/Y}$ is representable,
and hence we know what it means for it to have one of the properties
described in the definition. We will see below
(Lemma \ref{lemma-match-separated}) that this definition matches the ones
we already have for morphisms of schemes and representable morphisms.

\begin{lemma}
\label{lemma-trivial-implications}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. If $f$ is separated, then $f$ is locally separated and
$f$ is quasi-separated.
\end{lemma}

\begin{proof}
This is true, via the general principle
Spaces,
Lemma \ref{spaces-lemma-representable-transformations-property-implication},
because a closed immersion of schemes is an immersion and is quasi-compact.
\end{proof}

\begin{lemma}
\label{lemma-base-change-separated}
All of the separation axioms listed in Definition \ref{definition-separated}
are stable under base change.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ and $Y' \to Y$ be morphisms of algebraic spaces.
Let $f' : X' \to Y'$ be the base change of $f$ by $Y' \to Y$. Then
$\Delta_{X'/Y'}$ is the base change of $\Delta_{X/Y}$ by
the morphism $X' \times_{Y'} X' \to X \times_Y X$. By the results of
Section \ref{section-representable}
each of the properties of the diagonal used in
Definition \ref{definition-separated}
is stable under base change. Hence the lemma is true.
\end{proof}

\begin{lemma}
\label{lemma-fibre-product-after-map}
\begin{slogan}
The top arrow of a ``magic diagram'' of algebraic spaces has nice
immersion-like properties, and under separatedness hypotheses
these get stronger.
\end{slogan}
Let $S$ be a scheme. Let $f : X \to Z$, $g : Y \to Z$ and $Z \to T$
be morphisms of algebraic spaces over $S$. Consider the induced morphism
$i : X \times_Z Y \to X \times_T Y$. Then
\begin{enumerate}
\item $i$ is representable, locally of finite type, locally quasi-finite,
separated and a monomorphism,
\item if $Z \to T$ is locally separated, then $i$ is an immersion,
\item if $Z \to T$ is separated, then $i$ is a closed immersion, and
\item if $Z \to T$ is quasi-separated, then $i$ is quasi-compact.
\end{enumerate}
\end{lemma}

\begin{proof}
By general category theory the following diagram
$$
\xymatrix{
X \times_Z Y \ar[r]_i \ar[d] & X \times_T Y \ar[d] \\
Z \ar[r]^-{\Delta_{Z/T}} \ar[r] & Z \times_T Z
}
$$
is a fibre product diagram. Hence $i$ is the base change of the
diagonal morphism $\Delta_{Z/T}$. Thus the lemma follows
from Lemma \ref{lemma-properties-diagonal}, and the material in
Section \ref{section-representable}.
\end{proof}

\begin{lemma}
\label{lemma-semi-diagonal}
\begin{slogan}
Properties of the graph of a morphism of algebraic spaces
as a consequence of separation properties of the target.
\end{slogan}
Let $S$ be a scheme. Let $T$ be an algebraic space over $S$.
Let $g : X \to Y$ be a morphism of algebraic spaces over $T$.
Consider the graph $i : X \to X \times_T Y$ of $g$. Then
\begin{enumerate}
\item $i$ is representable, locally of finite type, locally quasi-finite,
separated and a monomorphism,
\item if $Y \to T$ is locally separated, then $i$ is an immersion,
\item if $Y \to T$ is separated, then $i$ is a closed immersion, and
\item if $Y \to T$ is quasi-separated, then $i$ is quasi-compact.
\end{enumerate}
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-fibre-product-after-map}
applied to the morphism $X = X \times_Y Y \to X \times_T Y$.
\end{proof}

\begin{lemma}
\label{lemma-section-immersion}
Let $S$ be a scheme.
Let $f : X \to T$ be a morphism of algebraic spaces over $S$.
Let $s : T \to X$ be a section of $f$ (in a formula
$f \circ s = \text{id}_T$). Then
\begin{enumerate}
\item $s$ is representable, locally of finite type, locally quasi-finite,
separated and a monomorphism,
\item if $f$ is locally separated, then $s$ is an immersion,
\item if $f$ is separated, then $s$ is a closed immersion, and
\item if $f$ is quasi-separated, then $s$ is quasi-compact.
\end{enumerate}
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-semi-diagonal} applied to
$g = s$ so the morphism $i = s : T \to T \times_T X$.
\end{proof}

\begin{lemma}
\label{lemma-composition-separated}
All of the separation axioms listed in Definition \ref{definition-separated}
are stable under composition of morphisms.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of algebraic spaces
to which the axiom in question applies.
The diagonal $\Delta_{X/Z}$ is the composition
$$
X \longrightarrow X \times_Y X \longrightarrow X \times_Z X.
$$
Our separation axiom is defined by requiring the diagonal
to have some property $\mathcal{P}$. By
Lemma \ref{lemma-fibre-product-after-map} above we see that
the second arrow also has this property. Hence the lemma follows
since the composition of (representable) morphisms with property
$\mathcal{P}$ also is a morphism with property $\mathcal{P}$, see
Section \ref{section-representable}.
\end{proof}

\begin{lemma}
\label{lemma-separated-over-separated}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item If $Y$ is separated and $f$ is separated, then $X$ is separated.
\item If $Y$ is quasi-separated and $f$ is quasi-separated, then
$X$ is quasi-separated.
\item If $Y$ is locally separated and $f$ is locally separated, then
$X$ is locally separated.
\item If $Y$ is separated over $S$ and $f$ is separated, then
$X$ is separated over $S$.
\item If $Y$ is quasi-separated over $S$ and $f$ is quasi-separated, then
$X$ is quasi-separated over $S$.
\item If $Y$ is locally separated over $S$ and $f$ is locally separated, then
$X$ is locally separated over $S$.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (4), (5), and (6) follow immediately from
Lemma \ref{lemma-composition-separated}
and
Spaces, Definition \ref{spaces-definition-separated}.
Parts (1), (2), and (3) reduce to parts (4), (5), and (6) by thinking
of $X$ and $Y$ as algebraic spaces over $\Spec(\mathbf{Z})$, see
Properties of Spaces, Definition \ref{spaces-properties-definition-separated}.
\end{proof}

\begin{lemma}
\label{lemma-compose-after-separated}
Let $S$ be a scheme.
Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of algebraic spaces over $S$.
\begin{enumerate}
\item If $g \circ f$ is separated then so is $f$.
\item If $g \circ f$ is locally separated then so is $f$.
\item If $g \circ f$ is quasi-separated then so is $f$.
\end{enumerate}
\end{lemma}

\begin{proof}
Consider the factorization
$$
X \to X \times_Y X \to X \times_Z X
$$
of the diagonal morphism of $g \circ f$. In any case the last morphism
is a monomorphism. Hence for any scheme $T$ and morphism
$T \to X \times_Y X$ we have the equality
$$
X \times_{(X \times_Y X)} T = X \times_{(X \times_Z X)} T.
$$
Hence the result is clear.
\end{proof}

\begin{lemma}
\label{lemma-separated-implies-morphism-separated}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
\begin{enumerate}
\item If $X$ is separated then $X$ is separated over $S$.
\item If $X$ is locally separated then $X$ is locally separated over $S$.
\item If $X$ is quasi-separated then $X$ is quasi-separated over $S$.
\end{enumerate}
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item[(4)] If $X$ is separated over $S$ then $f$ is separated.
\item[(5)] If $X$ is locally separated over $S$ then $f$ is locally separated.
\item[(6)] If $X$ is quasi-separated over $S$ then $f$ is quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (4), (5), and (6) follow immediately from
Lemma \ref{lemma-compose-after-separated}
and
Spaces, Definition \ref{spaces-definition-separated}.
Parts (1), (2), and (3) follow from parts (4), (5), and (6) by
thinking of $X$ and $Y$ as algebraic spaces over
$\Spec(\mathbf{Z})$, see
Properties of Spaces, Definition \ref{spaces-properties-definition-separated}.
\end{proof}

\begin{lemma}
\label{lemma-separated-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $\mathcal{P}$ be any of the separation
axioms of Definition \ref{definition-separated}.
The following are equivalent
\begin{enumerate}
\item $f$ is $\mathcal{P}$,
\item for every scheme $Z$ and morphism $Z \to Y$ the
base change $Z \times_Y X \to Z$ of $f$ is $\mathcal{P}$,
\item for every affine scheme $Z$ and every morphism $Z \to Y$ the
base change $Z \times_Y X \to Z$ of $f$ is $\mathcal{P}$,
\item for every affine scheme $Z$ and every morphism $Z \to Y$ the
algebraic space $Z \times_Y X$ is $\mathcal{P}$ (see
Properties of Spaces, Definition \ref{spaces-properties-definition-separated}),
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that the base change $V \times_Y X \to V$ has
$\mathcal{P}$, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that each
of the morphisms $f^{-1}(Y_i) \to Y_i$ has $\mathcal{P}$.
\end{enumerate}
\end{lemma}

\begin{proof}
We will repeatedly use
Lemma \ref{lemma-base-change-separated}
without further mention. In particular, it is clear that
(1) implies (2) and (2) implies (3).

\medskip\noindent
Let us prove that (3) and (4) are equivalent. Note that if $Z$ is an affine
scheme, then the morphism $Z \to \Spec(\mathbf{Z})$ is a separated
morphism as a morphism of algebraic spaces over $\Spec(\mathbf{Z})$.
If $Z \times_Y X \to Z$ is $\mathcal{P}$, then
$Z \times_Y X \to \Spec(\mathbf{Z})$ is $\mathcal{P}$
as a composition (see
Lemma \ref{lemma-composition-separated}). Hence the algebraic
space $Z \times_Y X$ is $\mathcal{P}$. Conversely, if the algebraic
space $Z \times_Y X$ is $\mathcal{P}$, then
$Z \times_Y X \to \Spec(\mathbf{Z})$ is $\mathcal{P}$, and
hence by
Lemma \ref{lemma-compose-after-separated}
we see that $Z \times_Y X \to Z$ is $\mathcal{P}$.

\medskip\noindent
Let us prove that (3) implies (5). Assume (3). Let $V$ be a scheme
and let $V \to Y$ be \'etale surjective. We have to show that
$V \times_Y X \to V$ has property $\mathcal{P}$. In other words,
we have to show that the morphism
$$
V \times_Y X \longrightarrow
(V \times_Y X) \times_V (V \times_Y X) = V \times_Y X \times_Y X
$$
has the corresponding property (i.e., is a closed immersion, immersion,
or quasi-compact). Let $V = \bigcup V_j$ be an
affine open covering of $V$. By assumption we know that each of the morphisms
$$
V_j \times_Y X \longrightarrow V_j \times_Y X \times_Y X
$$
does have the corresponding property. Since being a closed immersion,
immersion, quasi-compact immersion, or quasi-compact is Zariski local
on the target, and since the $V_j$ cover $V$ we get the desired conclusion.

\medskip\noindent
Let us prove that (5) implies (1). Let $V \to Y$ be as in (5).
Then we have the fibre product diagram
$$
\xymatrix{
V \times_Y X \ar[r] \ar[d] &
X \ar[d] \\
V \times_Y X \times_Y X \ar[r] &
X \times_Y X
}
$$
By assumption the left vertical arrow is a closed immersion,
immersion, quasi-compact immersion, or quasi-compact. It follows from
Spaces, Lemma \ref{spaces-lemma-descent-representable-transformations-property}
that also the right vertical arrow is a closed immersion,
immersion, quasi-compact immersion, or quasi-compact.

\medskip\noindent
It is clear that (1) implies (6) by taking the covering $Y = Y$.
Assume $Y = \bigcup Y_i$ is as in (6). Choose schemes $V_i$ and
surjective \'etale morphisms $V_i \to Y_i$. Note that the morphisms
$V_i \times_Y X \to V_i$ have $\mathcal{P}$ as they are base changes
of the morphisms $f^{-1}(Y_i) \to Y_i$. Set $V = \coprod V_i$.
Then $V \to Y$ is a morphism as in (5) (details omitted). Hence
(6) implies (5) and we are done.
\end{proof}

\begin{lemma}
\label{lemma-match-separated}
Let $S$ be a scheme.
Let $f : X \to Y$ be a representable morphism of algebraic spaces over $S$.
\begin{enumerate}
\item The morphism $f$ is locally separated.
\item The morphism $f$ is (quasi-)separated in the sense of
Definition \ref{definition-separated}
above if and only if $f$ is (quasi-)separated in the sense of
Section \ref{section-representable}.
\end{enumerate}
In particular, if $f : X \to Y$ is a morphism of schemes over $S$, then
$f$ is (quasi-)separated in the sense of
Definition \ref{definition-separated}
if and only if $f$ is (quasi-)separated as a morphism of schemes.
\end{lemma}

\begin{proof}
This is the equivalence of (1) and (2) of
Lemma \ref{lemma-separated-local}
combined with the fact that any morphism of schemes is locally separated, see
Schemes, Lemma \ref{schemes-lemma-diagonal-immersion}.
\end{proof}











\section{Surjective morphisms}
\label{section-surjective}

\noindent
We have already defined in Section \ref{section-representable}
what it means for a representable morphism of algebraic spaces
to be surjective.

\begin{lemma}
\label{lemma-surjective-representable}
Let $S$ be a scheme. Let $f : X \to Y$ be a representable
morphism of algebraic spaces over $S$. Then
$f$ is surjective (in the sense of Section \ref{section-representable})
if and only if $|f| : |X| \to |Y|$ is surjective.
\end{lemma}

\begin{proof}
Namely, if $f : X \to Y$ is representable, then it is surjective if and only if
for every scheme $T$ and every morphism $T \to Y$ the base change
$f_T : T \times_Y X \to T$ of $f$ is a surjective morphism of schemes,
in other words, if and only if $|f_T|$ is surjective. By
Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-cartesian}
the map $|T \times_Y X| \to |T| \times_{|Y|} |X|$ is always surjective.
Hence $|f_T| : |T \times_Y X| \to |T|$ is surjective if $|f| : |X| \to |Y|$
is surjective. Conversely, if $|f_T|$ is surjective
for every $T \to Y$ as above, then by taking $T$ to be the spectrum of a
field we conclude that $|X| \to |Y|$ is surjective.
\end{proof}

\noindent
This clears the way for the following definition.

\begin{definition}
\label{definition-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic
spaces over $S$. We say $f$ is {\it surjective}
if the map $|f| : |X| \to |Y|$ of associated topological spaces
is surjective.
\end{definition}

\begin{lemma}
\label{lemma-surjective-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is surjective,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is surjective,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is surjective,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is a surjective morphism,
\item there exists a scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$ such that the composition $f \circ \varphi$
is surjective,
\item there exists a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes and the vertical arrows are surjective \'etale
such that the top horizontal arrow is surjective, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that
each of the morphisms $f^{-1}(Y_i) \to Y_i$ is surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-surjective}
The composition of surjective morphisms is surjective.
\end{lemma}

\begin{proof}
This is immediate from the definition.
\end{proof}

\begin{lemma}
\label{lemma-base-change-surjective}
The base change of a surjective morphism is surjective.
\end{lemma}

\begin{proof}
Follows immediately from
Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-cartesian}.
\end{proof}










\section{Open morphisms}
\label{section-open}

\noindent
For a representable morphism of algebraic spaces we have already defined (in
Section \ref{section-representable})
what it means to be universally open. Hence before we give the natural
definition we check that it agrees with this in the representable case.

\begin{lemma}
\label{lemma-characterize-representable-universally-open}
Let $S$ be a scheme. Let $f : X \to Y$ be a representable morphism of
algebraic spaces over $S$. The following are equivalent
\begin{enumerate}
\item $f$ is universally open
(in the sense of Section \ref{section-representable}), and
\item for every morphism of algebraic spaces $Z \to Y$ the morphism of
topological spaces $|Z \times_Y X| \to |Z|$ is open.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1), and let $Z \to Y$ be as in (2). Choose a scheme $V$ and
a surjective \'etale morphism $V \to Y$. By assumption the morphism
of schemes $V \times_Y X \to V$ is universally open. By
Properties of Spaces, Section \ref{spaces-properties-section-points}
in the commutative diagram
$$
\xymatrix{
|V \times_Y X| \ar[r] \ar[d] & |Z \times_Y X| \ar[d] \\
|V| \ar[r] & |Z|
}
$$
the horizontal arrows are open and surjective, and moreover
$$
|V \times_Y X| \longrightarrow |V| \times_{|Z|} |Z \times_Y X|
$$
is surjective. Hence as the left
vertical arrow is open it follows that the right vertical arrow is
open. This proves (2). The implication (2) $\Rightarrow$ (1) is
immediate from the definitions.
\end{proof}

\noindent
Thus we may use the following natural definition.

\begin{definition}
\label{definition-open}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$.
\begin{enumerate}
\item We say $f$ is {\it open} if the map of topological spaces
$|f| : |X| \to |Y|$ is open.
\item We say $f$ is {\it universally open} if for every morphism
of algebraic spaces $Z \to Y$ the morphism of topological spaces
$$
|Z \times_Y X| \to |Z|
$$
is open, i.e., the base change $Z \times_Y X \to Z$ is open.
\end{enumerate}
\end{definition}

\noindent
Note that an \'etale morphism of algebraic spaces is universally open,
see
Properties of Spaces, Definition \ref{spaces-properties-definition-etale} and
Lemmas \ref{spaces-properties-lemma-etale-open} and
\ref{spaces-properties-lemma-base-change-etale}.

\begin{lemma}
\label{lemma-base-change-universally-open}
The base change of a universally open morphism of algebraic spaces
by any morphism of algebraic spaces is universally open.
\end{lemma}

\begin{proof}
This is immediate from the definition.
\end{proof}

\begin{lemma}
\label{lemma-composition-open}
The composition of a pair of (universally) open morphisms of algebraic spaces
is (universally) open.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-universally-open-local}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. The following are equivalent
\begin{enumerate}
\item $f$ is universally open,
\item for every scheme $Z$ and every morphism $Z \to Y$
the projection $|Z \times_Y X| \to |Z|$ is open,
\item for every affine scheme $Z$ and every morphism $Z \to Y$
the projection $|Z \times_Y X| \to |Z|$ is open, and
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is a universally open morphism
of algebraic spaces, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that
each of the morphisms $f^{-1}(Y_i) \to Y_i$ is universally open.
\end{enumerate}
\end{lemma}

\begin{proof}
We omit the proof that (1) implies (2), and that (2) implies (3).

\medskip\noindent
Assume (3). Choose a surjective \'etale morphism $V \to Y$.
We are going to show that $V \times_Y X \to V$ is a universally
open morphism of algebraic spaces. Let $Z \to V$ be a morphism
from an algebraic space to $V$. Let $W \to Z$ be a surjective \'etale
morphism where $W = \coprod W_i$ is a disjoint union of affine schemes, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}.
Then we have the following commutative diagram
$$
\xymatrix{
\coprod_i |W_i \times_Y X| \ar@{=}[r] \ar[d] &
|W \times_Y X| \ar[r] \ar[d] &
|Z \times_Y X| \ar[d] \ar@{=}[r] &
|Z \times_V (V \times_Y X)| \ar[ld] \\
\coprod |W_i| \ar@{=}[r] &
|W| \ar[r] &
|Z|
}
$$
We have to show the south-east arrow is open. The middle horizontal
arrows are surjective and open
(Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-open}).
By assumption (3), and the fact that
$W_i$ is affine we see that the left vertical arrows are open. Hence
it follows that the right vertical arrow is open.

\medskip\noindent
Assume $V \to Y$ is as in (4). We will show that $f$ is universally open.
Let $Z \to Y$ be a morphism of algebraic spaces. Consider the
diagram
$$
\xymatrix{
|(V \times_Y Z) \times_V (V \times_Y X)| \ar@{=}[r] \ar[rd] &
|V \times_Y X| \ar[r] \ar[d] &
|Z \times_Y X| \ar[d] \\
 &
|V \times_Y Z| \ar[r] &
|Z|
}
$$
The south-west arrow is open by assumption. The horizontal arrows are
surjective and open because the corresponding morphisms of
algebraic spaces are \'etale (see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-open}).
It follows that the right vertical arrow is open.

\medskip\noindent
Of course (1) implies (5) by taking the covering $Y = Y$.
Assume $Y = \bigcup Y_i$ is as in (5). Then for any $Z \to Y$
we get a corresponding Zariski covering $Z = \bigcup Z_i$ such that
the base change of $f$ to $Z_i$ is open. By a simple topological
argument this implies that $Z \times_Y X \to Z$ is open. Hence (1) holds.
\end{proof}

\begin{lemma}
\label{lemma-space-over-field-universally-open}
Let $S$ be a scheme. Let $p : X \to \Spec(k)$ be a morphism of
algebraic spaces over $S$ where $k$ is a field. Then
$p : X \to \Spec(k)$ is universally open.
\end{lemma}

\begin{proof}
Choose a scheme $U$ and a surjective \'etale morphism $U \to X$.
The composition $U \to \Spec(k)$ is universally open (as a morphism
of schemes) by
Morphisms, Lemma \ref{morphisms-lemma-scheme-over-field-universally-open}.
Let $Z \to \Spec(k)$ be a morphism of schemes. Then
$U \times_{\Spec(k)} Z \to X \times_{\Spec(k)} Z$ is surjective,
see
Lemma \ref{lemma-base-change-surjective}.
Hence the first of the maps
$$
|U \times_{\Spec(k)} Z| \to |X \times_{\Spec(k)} Z| \to |Z|
$$
is surjective. Since the composition is open by the above we conclude that
the second map is open as well. Whence $p$ is universally open by
Lemma \ref{lemma-universally-open-local}.
\end{proof}








\section{Submersive morphisms}
\label{section-submersive}

\noindent
For a representable morphism of algebraic spaces we have already defined (in
Section \ref{section-representable})
what it means to be universally submersive. Hence before we give the natural
definition we check that it agrees with this in the representable case.

\begin{lemma}
\label{lemma-characterize-representable-universally-submersive}
Let $S$ be a scheme. Let $f : X \to Y$ be a representable morphism of
algebraic spaces over $S$. The following are equivalent
\begin{enumerate}
\item $f$ is universally submersive
(in the sense of Section \ref{section-representable}), and
\item for every morphism of algebraic spaces $Z \to Y$ the morphism of
topological spaces $|Z \times_Y X| \to |Z|$ is submersive.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1), and let $Z \to Y$ be as in (2). Choose a scheme $V$ and
a surjective \'etale morphism $V \to Y$. By assumption the morphism
of schemes $V \times_Y X \to V$ is universally submersive. By
Properties of Spaces, Section \ref{spaces-properties-section-points}
in the commutative diagram
$$
\xymatrix{
|V \times_Y X| \ar[r] \ar[d] & |Z \times_Y X| \ar[d] \\
|V| \ar[r] & |Z|
}
$$
the horizontal arrows are open and surjective, and moreover
$$
|V \times_Y X| \longrightarrow |V| \times_{|Z|} |Z \times_Y X|
$$
is surjective. Hence as the left vertical arrow is submersive
it follows that the right vertical arrow is submersive.
This proves (2). The implication (2) $\Rightarrow$ (1) is
immediate from the definitions.
\end{proof}

\noindent
Thus we may use the following natural definition.

\begin{definition}
\label{definition-submersive}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item We say $f$ is {\it submersive}\footnote{This is very different
from the notion of a submersion of differential manifolds.}
if the continuous map $|X| \to |Y|$ is submersive, see
Topology, Definition \ref{topology-definition-submersive}.
\item We say $f$ is {\it universally submersive} if for every
morphism of algebraic spaces $Y' \to Y$ the base change
$Y' \times_Y X \to Y'$ is submersive.
\end{enumerate}
\end{definition}

\noindent
We note that a submersive morphism is in particular surjective.

\begin{lemma}
\label{lemma-base-change-universally-submersive}
The base change of a universally submersive morphism of algebraic spaces
by any morphism of algebraic spaces is universally submersive.
\end{lemma}

\begin{proof}
This is immediate from the definition.
\end{proof}

\begin{lemma}
\label{lemma-composition-universally-submersive}
The composition of a pair of (universally) submersive morphisms of
algebraic spaces is (universally) submersive.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}












\section{Quasi-compact morphisms}
\label{section-quasi-compact}

\noindent
By Section \ref{section-representable} we know what it means for
a representable morphism of algebraic spaces to be quasi-compact.
In order to formulate the definition for a general morphism
of algebraic spaces we make the following observation.

\begin{lemma}
\label{lemma-characterize-representable-quasi-compact}
Let $S$ be a scheme.
Let $f : X \to Y$ be a representable morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is quasi-compact
(in the sense of Section \ref{section-representable}), and
\item for every quasi-compact algebraic space $Z$ and any morphism
$Z \to Y$ the algebraic space $Z \times_Y X$ is quasi-compact.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1), and let $Z \to Y$ be a morphism of algebraic spaces with
$Z$ quasi-compact. By
Properties of Spaces,
Definition \ref{spaces-properties-definition-quasi-compact}
there exists a quasi-compact scheme $U$ and a surjective \'etale
morphism $U \to Z$. Since $f$ is representable and quasi-compact
we see by definition that $U \times_Y X$ is a scheme, and that
$U \times_Y X \to U$ is quasi-compact. Hence $U \times_Y X$ is
a quasi-compact scheme. The morphism $U \times_Y X \to Z \times_Y X$
is \'etale and surjective (as the base change of the representable
\'etale and surjective morphism $U \to Z$, see
Section \ref{section-representable}).
Hence by definition $Z \times_Y X$ is quasi-compact.

\medskip\noindent
Assume (2). Let $Z \to Y$ be a morphism, where $Z$ is a scheme.
We have to show that $p : Z \times_Y X \to Z$ is quasi-compact.
Let $U \subset Z$ be affine open. Then $p^{-1}(U) = U \times_Y Z$
and the scheme $U \times_Y Z$ is quasi-compact by assumption (2).
Hence $p$ is quasi-compact, see
Schemes, Section \ref{schemes-section-quasi-compact}.
\end{proof}

\noindent
This motivates the following definition.

\begin{definition}
\label{definition-quasi-compact}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
We say $f$ is {\it quasi-compact} if for every quasi-compact
algebraic space $Z$ and morphism $Z \to Y$ the fibre product
$Z \times_Y X$ is quasi-compact.
\end{definition}

\noindent
By Lemma \ref{lemma-characterize-representable-quasi-compact}
above this agrees with the already existing notion
for representable morphisms of algebraic spaces.

\begin{lemma}
\label{lemma-quasi-compact-is-quasi-compact}
Let $S$ be a scheme. If $f : X \to Y$ is a quasi-compact morphism of
algebraic spaces over $S$, then the underlying map
$|f| : |X| \to |Y|$ of topological space is quasi-compact.
\end{lemma}

\begin{proof}
Let $V \subset |Y|$ be quasi-compact open. By Properties of Spaces,
Lemma \ref{spaces-properties-lemma-open-subspaces}
there is an open subspace $Y' \subset Y$ with $V = |Y'|$.
Then $Y'$ is a quasi-compact algebraic space by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-quasi-compact-space}
and hence $X' = Y' \times_Y X$ is a quasi-compact algebraic
space by Definition \ref{definition-quasi-compact}.
On the other hand, $X' \subset X$ is an open subspace
(Spaces, Lemma \ref{spaces-lemma-base-change-immersions})
and $|X'| = |f|^{-1}(|X'|) = |f|^{-1}(V)$ by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-cartesian}.
We conclude using
Properties of Spaces, Lemma \ref{spaces-properties-lemma-quasi-compact-space}
again that $|X'|$ is a quasi-compact open of $|X|$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-base-change-quasi-compact}
The base change of a quasi-compact morphism of algebraic spaces
by any morphism of algebraic spaces is quasi-compact.
\end{lemma}

\begin{proof}
Omitted. Hint: Transitivity of fibre products.
\end{proof}

\begin{lemma}
\label{lemma-composition-quasi-compact}
The composition of a pair of quasi-compact morphisms of algebraic spaces
is quasi-compact.
\end{lemma}

\begin{proof}
Omitted. Hint: Transitivity of fibre products.
\end{proof}

\begin{lemma}
\label{lemma-surjection-from-quasi-compact}
\begin{slogan}
The image of a quasi-compact algebraic space under a surjective morphism
is quasi-compact.
\end{slogan}
Let $S$ be a scheme.
\begin{enumerate}
\item If $X \to Y$ is a surjective morphism of algebraic spaces over $S$,
and $X$ is quasi-compact then $Y$ is quasi-compact.
\item If
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & &
Y \ar[dl]^q \\
& Z
}
$$
is a commutative diagram of morphisms of algebraic spaces over $S$
and $f$ is surjective and $p$ is quasi-compact, then $q$ is quasi-compact.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $X$ is quasi-compact and $X \to Y$ is surjective. By
Definition \ref{definition-surjective}
the map $|X| \to |Y|$ is surjective, hence we see $Y$ is quasi-compact by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-quasi-compact-space}
and the topological fact that the image of a quasi-compact space under a
continuous map is quasi-compact, see
Topology, Lemma \ref{topology-lemma-image-quasi-compact}.
Let $f, p, q$ be as in (2).
Let $T \to Z$ be a morphism whose source is a quasi-compact algebraic space.
By assumption $T \times_Z X$ is quasi-compact. By
Lemma \ref{lemma-base-change-surjective}
the morphism $T \times_Z X \to T \times_Z Y$ is surjective.
Hence by part (1) we see $T \times_Z Y$ is quasi-compact too.
Thus $q$ is quasi-compact.
\end{proof}

\begin{lemma}
\label{lemma-descent-quasi-compact}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $g : Y' \to Y$ be a universally open and surjective morphism of
algebraic spaces such that the base change $f' : X' \to Y'$ is quasi-compact.
Then $f$ is quasi-compact.
\end{lemma}

\begin{proof}
Let $Z \to Y$ be a morphism of algebraic spaces with $Z$ quasi-compact.
As $g$ is universally open and surjective, we see that
$Y' \times_Y Z \to Z$ is open and surjective. As every point of
$|Y' \times_Y Z|$ has a fundamental system of quasi-compact open
neighbourhoods (see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-space-locally-quasi-compact})
we can find a quasi-compact open $W \subset |Y' \times_Y Z|$
which surjects onto $Z$. Denote
$f'' : W \times_Y X \to W$ the base change of $f'$ by $W \to Y'$.
By assumption $W \times_Y X$ is quasi-compact. As $W \to Z$ is surjective
we see that $W \times_Y X \to Z \times_Y X$ is surjective.
Hence $Z \times_Y X$ is quasi-compact by
Lemma \ref{lemma-surjection-from-quasi-compact}.
Thus $f$ is quasi-compact.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact-local}
\begin{slogan}
Quasi-compact morphisms of algebraic spaces are preserved under pullback
and local on the target.
\end{slogan}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is quasi-compact,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism of
algebraic spaces $Z \times_Y X \to Z$ is quasi-compact,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the algebraic space $Z \times_Y X$ is quasi-compact,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is a quasi-compact morphism
of algebraic spaces, and
\item there exists a surjective \'etale morphism
$Y' \to Y$ of algebraic spaces such that $Y' \times_Y X \to Y'$
is a quasi-compact morphism of algebraic spaces, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that
each of the morphisms $f^{-1}(Y_i) \to Y_i$ is quasi-compact.
\end{enumerate}
\end{lemma}

\begin{proof}
We will use Lemma \ref{lemma-base-change-quasi-compact}
without further mention.
It is clear that (1) implies (2) and that (2) implies (3).
Assume (3). Let $Z$ be a quasi-compact algebraic space over $S$,
and let $Z \to Y$ be a morphism. By
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}
there exists an affine scheme $U$ and a surjective \'etale morphism
$U \to Z$. Then $U \times_Y X \to Z \times_Y X$ is a surjective
morphism of algebraic spaces, see
Lemma \ref{lemma-base-change-surjective}.
By assumption $|U \times_Y X|$ is quasi-compact. It surjects
onto $|Z \times_Y X|$, hence we conclude that $|Z \times_Y X|$
is quasi-compact, see
Topology, Lemma \ref{topology-lemma-image-quasi-compact}.
This proves that (3) implies (1).

\medskip\noindent
The implications (1) $\Rightarrow$ (4), (4) $\Rightarrow$ (5) are clear.
The implication (5) $\Rightarrow$ (1) follows from
Lemma \ref{lemma-descent-quasi-compact}
and the fact that an \'etale morphism of algebraic spaces is universally open
(see discussion following
Definition \ref{definition-open}).

\medskip\noindent
Of course (1) implies (6) by taking the covering $Y = Y$.
Assume $Y = \bigcup Y_i$ is as in (6). Let $Z$ be affine and let
$Z \to Y$ be a morphism. Then there exists a finite standard affine
covering $Z = Z_1 \cup \ldots \cup Z_n$ such that each $Z_j \to Y$
factors through $Y_{i_j}$ for some $i_j$. Hence the algebraic space
$$
Z_j \times_Y X = Z_j \times_{Y_{i_j}} f^{-1}(Y_{i_j})
$$
is quasi-compact. Since
$Z \times_Y X = \bigcup_{j = 1, \ldots, n} Z_j \times_Y X$
is a Zariski covering we see that
$|Z \times_Y X| = \bigcup_{j = 1, \ldots, n} |Z_j \times_Y X|$
(see Properties of Spaces, Lemma \ref{spaces-properties-lemma-open-subspaces})
is a finite union of quasi-compact spaces, hence quasi-compact.
Thus we see that (6) implies (3).
\end{proof}

\noindent
The following (and the next) lemma guarantees in particular that a morphism
$X \to \Spec(A)$ is quasi-compact as soon as
$X$ is a quasi-compact algebraic space

\begin{lemma}
\label{lemma-quasi-compact-permanence}
Let $S$ be a scheme.
Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of algebraic spaces over $S$.
If $g \circ f$ is quasi-compact and $g$ is quasi-separated
then $f$ is quasi-compact.
\end{lemma}

\begin{proof}
This is true because $f$ equals the composition
$(1, f) : X \to X \times_Z Y \to Y$. The first map
is quasi-compact by Lemma \ref{lemma-section-immersion}
because it is a section of the quasi-separated morphism $X \times_Z Y \to X$
(a base change of $g$, see Lemma \ref{lemma-base-change-separated}).
The second map is quasi-compact as it
is the base change of $f$, see
Lemma \ref{lemma-base-change-quasi-compact}.
And compositions of quasi-compact
morphisms are quasi-compact, see Lemma \ref{lemma-composition-quasi-compact}.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact-quasi-separated-permanence}
Let $f : X \to Y$ be a morphism of algebraic spaces
over a scheme $S$.
\begin{enumerate}
\item If $X$ is quasi-compact and $Y$ is quasi-separated, then $f$ is
quasi-compact.
\item If $X$ is quasi-compact and quasi-separated and $Y$ is quasi-separated,
then $f$ is quasi-compact and quasi-separated.
\item A fibre product of quasi-compact and quasi-separated algebraic spaces
is quasi-compact and quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) follows from
Lemma \ref{lemma-quasi-compact-permanence}
with $Z = S = \Spec(\mathbf{Z})$.
Part (2) follows from (1) and
Lemma \ref{lemma-compose-after-separated}.
For (3) let $X \to Y$ and $Z \to Y$ be morphisms
of quasi-compact and quasi-separated algebraic spaces. Then
$X \times_Y Z \to Z$ is quasi-compact and quasi-separated as a
base change of $X \to Y$ using (2) and
Lemmas \ref{lemma-base-change-quasi-compact} and
\ref{lemma-base-change-separated}.
Hence $X \times_Y Z$ is quasi-compact and quasi-separated as
an algebraic space quasi-compact and quasi-separated over
$Z$, see
Lemmas \ref{lemma-separated-over-separated} and
\ref{lemma-composition-quasi-compact}.
\end{proof}


\section{Universally closed morphisms}
\label{section-universally-closed}

\noindent
For a representable morphism of algebraic spaces we have already defined (in
Section \ref{section-representable})
what it means to be universally closed. Hence before we give the natural
definition we check that it agrees with this in the representable case.

\begin{lemma}
\label{lemma-characterize-representable-universally-closed}
Let $S$ be a scheme. Let $f : X \to Y$ be a representable morphism of
algebraic spaces over $S$. The following are equivalent
\begin{enumerate}
\item $f$ is universally closed
(in the sense of Section \ref{section-representable}), and
\item for every morphism of algebraic spaces $Z \to Y$ the morphism of
topological spaces $|Z \times_Y X| \to |Z|$ is closed.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1), and let $Z \to Y$ be as in (2). Choose a scheme $V$ and
a surjective \'etale morphism $V \to Y$. By assumption the morphism
of schemes $V \times_Y X \to V$ is universally closed. By
Properties of Spaces, Section \ref{spaces-properties-section-points}
in the commutative diagram
$$
\xymatrix{
|V \times_Y X| \ar[r] \ar[d] & |Z \times_Y X| \ar[d] \\
|V| \ar[r] & |Z|
}
$$
the horizontal arrows are open and surjective, and moreover
$$
|V \times_Y X| \longrightarrow |V| \times_{|Z|} |Z \times_Y X|
$$
is surjective. Hence as the left
vertical arrow is closed it follows that the right vertical arrow is
closed. This proves (2). The implication (2) $\Rightarrow$ (1) is
immediate from the definitions.
\end{proof}

\noindent
Thus we may use the following natural definition.

\begin{definition}
\label{definition-closed}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$.
\begin{enumerate}
\item We say $f$ is {\it closed} if the map of topological
spaces $|X| \to |Y|$ is closed.
\item We say $f$ is {\it universally closed} if for every morphism
of algebraic spaces $Z \to Y$ the morphism of topological spaces
$$
|Z \times_Y X| \to |Z|
$$
is closed, i.e., the base change $Z \times_Y X \to Z$ is closed.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-base-change-universally-closed}
The base change of a universally closed morphism of algebraic spaces
by any morphism of algebraic spaces is universally closed.
\end{lemma}

\begin{proof}
This is immediate from the definition.
\end{proof}

\begin{lemma}
\label{lemma-composition-universally-closed}
The composition of a pair of (universally) closed morphisms of algebraic spaces
is (universally) closed.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-universally-closed-local}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. The following are equivalent
\begin{enumerate}
\item $f$ is universally closed,
\item for every scheme $Z$ and every morphism $Z \to Y$
the projection $|Z \times_Y X| \to |Z|$ is closed,
\item for every affine scheme $Z$ and every morphism $Z \to Y$
the projection $|Z \times_Y X| \to |Z|$ is closed,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is a universally closed morphism
of algebraic spaces, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that
each of the morphisms $f^{-1}(Y_i) \to Y_i$ is universally closed.
\end{enumerate}
\end{lemma}

\begin{proof}
We omit the proof that (1) implies (2), and that (2) implies (3).

\medskip\noindent
Assume (3). Choose a surjective \'etale morphism $V \to Y$.
We are going to show that $V \times_Y X \to V$ is a universally
closed morphism of algebraic spaces. Let $Z \to V$ be a morphism
from an algebraic space to $V$. Let $W \to Z$ be a surjective \'etale
morphism where $W = \coprod W_i$ is a disjoint union of affine schemes, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}.
Then we have the following commutative diagram
$$
\xymatrix{
\coprod_i |W_i \times_Y X| \ar@{=}[r] \ar[d] &
|W \times_Y X| \ar[r] \ar[d] &
|Z \times_Y X| \ar[d] \ar@{=}[r] &
|Z \times_V (V \times_Y X)| \ar[ld] \\
\coprod |W_i| \ar@{=}[r] &
|W| \ar[r] &
|Z|
}
$$
We have to show the south-east arrow is closed. The middle horizontal
arrows are surjective and open
(Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-open}).
By assumption (3), and the fact that
$W_i$ is affine we see that the left vertical arrows are closed. Hence
it follows that the right vertical arrow is closed.

\medskip\noindent
Assume (4). We will show that $f$ is universally closed.
Let $Z \to Y$ be a morphism of algebraic spaces. Consider the
diagram
$$
\xymatrix{
|(V \times_Y Z) \times_V (V \times_Y X)| \ar@{=}[r] \ar[rd] &
|V \times_Y X| \ar[r] \ar[d] &
|Z \times_Y X| \ar[d] \\
 &
|V \times_Y Z| \ar[r] &
|Z|
}
$$
The south-west arrow is closed by assumption. The horizontal arrows are
surjective and open because the corresponding morphisms of
algebraic spaces are \'etale (see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-open}).
It follows that the right vertical arrow is closed.

\medskip\noindent
Of course (1) implies (5) by taking the covering $Y = Y$.
Assume $Y = \bigcup Y_i$ is as in (5). Then for any $Z \to Y$
we get a corresponding Zariski covering $Z = \bigcup Z_i$ such that
the base change of $f$ to $Z_i$ is closed. By a simple topological
argument this implies that $Z \times_Y X \to Z$ is closed. Hence (1) holds.
\end{proof}

\begin{example}
\label{example-strange-universally-closed}
Strange example of a universally closed morphism.
Let $\mathbf{Q} \subset k$ be a field of characteristic zero.
Let $X = \mathbf{A}^1_k/\mathbf{Z}$ as in
Spaces, Example \ref{spaces-example-affine-line-translation}.
We claim the structure morphism $p : X \to \Spec(k)$
is universally closed.
Namely, if $Z/k$ is a scheme, and $T \subset |X \times_k Z|$ is closed,
then $T$ corresponds to a $\mathbf{Z}$-invariant closed subset of
$T' \subset |\mathbf{A}^1 \times Z|$. It is easy to see that
this implies that $T'$ is the inverse image of a subset $T''$ of
$Z$. By
Morphisms, Lemma \ref{morphisms-lemma-fpqc-quotient-topology}
we have that $T'' \subset Z$ is closed.
Of course $T''$ is the image of $T$. Hence $p$ is universally
closed by Lemma \ref{lemma-universally-closed-local}.
\end{example}

\begin{lemma}
\label{lemma-universally-closed-quasi-compact}
Let $S$ be a scheme.
A universally closed morphism of algebraic spaces over $S$ is quasi-compact.
\end{lemma}

\begin{proof}
This proof is a repeat of the proof in the case of schemes, see
Morphisms, Lemma \ref{morphisms-lemma-universally-closed-quasi-compact}.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Assume that $f$ is not quasi-compact.
Our goal is to show that $f$ is not universally closed. By
Lemma \ref{lemma-quasi-compact-local}
there exists an affine scheme $Z$ and a morphism $Z \to Y$
such that $Z \times_Y X \to Z$ is not quasi-compact. To achieve our goal
it suffices to show that $Z \times_Y X \to Z$ is not universally closed,
hence we may assume that $Y = \Spec(B)$ for some ring $B$.

\medskip\noindent
Write $X = \bigcup_{i \in I} X_i$ where the $X_i$ are quasi-compact
open subspaces of $X$. For example, choose a surjective \'etale morphism
$U \to X$ where $U$ is a scheme, choose an affine open covering
$U = \bigcup U_i$ and let $X_i \subset X$ be the image of $U_i$.
We will use later that the morphisms $X_i \to Y$ are quasi-compact, see
Lemma \ref{lemma-quasi-compact-permanence}.
Let $T = \Spec(B[a_i ; i \in I])$. Let $T_i = D(a_i) \subset T$.
Let $Z \subset T \times_Y X$ be the reduced closed subspace whose underlying
closed set of points is
$|T \times_Y Z| \setminus \bigcup_{i \in I} |T_i \times_Y X_i|$, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-reduced-closed-subspace}.
(Note that $T_i \times_Y X_i$ is an open subspace of $T \times_Y X$ as
$T_i \to T$ and $X_i \to X$ are open immersions, see
Spaces, Lemmas \ref{spaces-lemma-base-change-immersions} and
\ref{spaces-lemma-composition-immersions}.) Here is a diagram
$$
\xymatrix{
Z \ar[r] \ar[rd] &
T \times_Y X \ar[d]^{f_T} \ar[r]_q &
X \ar[d]^f \\
& T \ar[r]^p & Y
}
$$
It suffices to prove that the image $f_T(|Z|)$ is not closed in $|T|$.

\medskip\noindent
We claim there exists a point $y \in Y$ such that there is no
affine open neighborhood $V$ of $y$ in $Y$ such that $X_V$ is quasi-compact.
If not then we can cover $Y$ with finitely many such $V$ and for
each $V$ the morphism $Y_V \to V$ is quasi-compact by
Lemma \ref{lemma-quasi-compact-permanence}
and then
Lemma \ref{lemma-quasi-compact-local}
implies $f$ quasi-compact, a contradiction. Fix a $y \in Y$ as in the claim.

\medskip\noindent
Let $t \in T$ be the point lying over $y$ with $\kappa(t) = \kappa(y)$
such that $a_i = 1$ in $\kappa(t)$ for all $i$. Suppose $z \in |Z|$ with
$f_T(z) = t$. Then $q(t) \in X_i$ for some $i$. Hence $f_T(z) \not \in T_i$
by construction of $Z$, which contradicts the fact that $t \in T_i$ by
construction. Hence we see that $t \in |T| \setminus f_T(|Z|)$.

\medskip\noindent
Assume $f_T(|Z|)$ is closed in $|T|$. Then there exists an element
$g \in B[a_i; i \in I]$ with $f_T(|Z|) \subset V(g)$ but $t \not \in V(g)$.
Hence the image of $g$ in $\kappa(t)$ is nonzero. In particular some
coefficient of $g$ has nonzero image in $\kappa(y)$. Hence this coefficient is
invertible on some affine open neighborhood $V$ of $y$. Let $J$ be the finite
set of $j \in I$ such that the variable $a_j$ appears in $g$.
Since $X_V$ is not quasi-compact and each $X_{i, V}$ is quasi-compact,
we may choose a point $x \in |X_V| \setminus \bigcup_{j \in J} |X_{j, V}|$.
In other words, $x \in |X| \setminus \bigcup_{j \in J} |X_j|$ and $x$ lies
above some $v \in V$. Since $g$ has a coefficient that is invertible on $V$,
we can find a point $t' \in T$ lying above $v$ such that $t' \not \in V(g)$ and
$t' \in V(a_i)$ for all $i \notin J$. This is true because
$V(a_i; i \in I \setminus J) = \Spec(B[a_j; j\in J])$
and the set of points of this scheme lying over $v$ is bijective
with $\Spec(\kappa(v)[a_j; j \in J])$ and $g$ restricts to
a nonzero element of this polynomial ring by construction.
In other words $t' \not \in T_i$ for each $i \not \in J$. By
Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-cartesian}
we can find a point $z$ of $X \times_Y T$ mapping to $x \in X$ and to
$t' \in T$. Since $x \not \in |X_j|$ for $j \in J$ and $t' \not \in T_i$
for $i \in I \setminus J$ we see that $z \in |Z|$. On the other hand
$f_T(z) = t' \not \in V(g)$ which contradicts $f_T(Z) \subset V(g)$.
Thus the assumption ``$f_T(|Z|)$ closed'' is wrong and we conclude indeed
that $f_T$ is not closed as desired.
\end{proof}

\noindent
The target of a separated algebraic space under a surjective
universally closed morphism is separated.

\begin{lemma}
\label{lemma-image-universally-closed-separated}
Let $S$ be a scheme. Let $B$ be an algebraic space over $S$.
Let $f : X \to Y$ be a surjective universally closed
morphism of algebraic spaces over $B$.
\begin{enumerate}
\item If $X$ is quasi-separated, then $Y$ is quasi-separated.
\item If $X$ is separated, then $Y$ is separated.
\item If $X$ is quasi-separated over $B$, then $Y$ is quasi-separated over $B$.
\item If $X$ is separated over $B$, then $Y$ is separated over $B$.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (1) and (2) are a consequence of (3) and (4) for
$S = B = \Spec(\mathbf{Z})$ (see
Properties of Spaces,
Definition \ref{spaces-properties-definition-separated}).
Consider the commutative diagram
$$
\xymatrix{
X \ar[d] \ar[rr]_{\Delta_{X/B}} & & X \times_B X \ar[d] \\
Y \ar[rr]^{\Delta_{Y/B}} & & Y \times_B Y
}
$$
The left vertical arrow is surjective (i.e., universally surjective).
The right vertical arrow is universally closed as a composition
of the universally closed morphisms
$X \times_B X \to X \times_B Y \to Y \times_B Y$. Hence it is also
quasi-compact, see
Lemma \ref{lemma-universally-closed-quasi-compact}.

\medskip\noindent
Assume $X$ is quasi-separated over $B$, i.e.,  $\Delta_{X/B}$ is
quasi-compact. Then if $Z$ is quasi-compact and $Z \to Y \times_B Y$ is
a morphism, then $Z \times_{Y \times_B Y} X \to Z \times_{Y \times_B Y} Y$
is surjective and $Z \times_{Y \times_B Y} X$ is quasi-compact by our remarks
above. We conclude that $\Delta_{Y/B}$ is quasi-compact, i.e., $Y$
is quasi-separated over $B$.

\medskip\noindent
Assume $X$ is separated over $B$, i.e., $\Delta_{X/B}$ is a closed
immersion. Then if $Z$ is affine, and $Z \to Y \times_B Y$ is
a morphism, then $Z \times_{Y \times_B Y} X \to Z \times_{Y \times_B Y} Y$
is surjective and $Z \times_{Y \times_B Y} X \to Z$ is universally closed
by our remarks above. We conclude that $\Delta_{Y/B}$ is universally closed.
It follows that $\Delta_{Y/B}$ is representable, locally of finite type, a
monomorphism (see
Lemma \ref{lemma-properties-diagonal})
and universally closed, hence a closed immersion, see
\'Etale Morphisms,
Lemma \ref{etale-lemma-characterize-closed-immersion}
(and also the abstract principle
Spaces, Lemma
\ref{spaces-lemma-representable-transformations-property-implication}).
Thus $Y$ is separated over $B$.
\end{proof}













\section{Monomorphisms}
\label{section-monomorphisms}

\noindent
A representable morphism $X \to Y$ of algebraic spaces is a monomorphism
according to Section \ref{section-representable} if for every scheme
$Z$ and morphism $Z \to Y$ the morphism $Z \times_Y X \to Z$
is representable by a monomorphism of schemes.
This means exactly that $Z \times_Y X \to Z$
is an injective map of sheaves on $(\Sch/S)_{fppf}$. Since this
is supposed to hold for all $Z$ and all maps $Z \to Y$ this is in turn
equivalent to the map $X \to Y$ being an injective map of sheaves on
$(\Sch/S)_{fppf}$. Thus we may define a monomorphism of a (possibly
nonrepresentable\footnote{We do not know whether any monomorphism
of algebraic spaces is representable. For a discussion see
More on Morphisms of Spaces, Section
\ref{spaces-more-morphisms-section-monomorphisms}.})
morphism of algebraic spaces as follows.

\begin{definition}
\label{definition-monomorphism}
Let $S$ be a scheme.
A morphism of algebraic spaces over $S$ is called a {\it monomorphism}
if it is an injective map of sheaves, i.e., a monomorphism in the category
of sheaves on $(\Sch/S)_{fppf}$.
\end{definition}

\noindent
The following lemma shows that this also means that it is a monomorphism
in the category of algebraic spaces over $S$.

\begin{lemma}
\label{lemma-monomorphism}
Let $S$ be a scheme.
Let $j : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $j$ is a monomorphism (as in Definition \ref{definition-monomorphism}),
\item $j$ is a monomorphism in the category of algebraic spaces over $S$, and
\item the diagonal morphism $\Delta_{X/Y} : X \to X \times_Y X$ is
an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
Note that $X \times_Y X$ is both the fibre product in the category of
sheaves on $(\Sch/S)_{fppf}$ and the fibre product in the category
of algebraic spaces over $S$, see
Spaces, Lemma \ref{spaces-lemma-fibre-product-spaces}.
The equivalence of (1) and (3) is a general characterization
of injective maps of sheaves on any site.
The equivalence of (2) and (3) is a characterization of monomorphisms
in any category with fibre products.
\end{proof}

\begin{lemma}
\label{lemma-monomorphism-separated}
A monomorphism of algebraic spaces is separated.
\end{lemma}

\begin{proof}
This is true because an isomorphism is a closed immersion,
and Lemma \ref{lemma-monomorphism} above.
\end{proof}

\begin{lemma}
\label{lemma-composition-monomorphism}
A composition of monomorphisms is a monomorphism.
\end{lemma}

\begin{proof}
True because a composition of injective sheaf maps is injective.
\end{proof}

\begin{lemma}
\label{lemma-base-change-monomorphism}
The base change of a monomorphism is a monomorphism.
\end{lemma}

\begin{proof}
This is a general fact about fibre products in a category of sheaves.
\end{proof}

\begin{lemma}
\label{lemma-monomorphism-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent
\begin{enumerate}
\item $f$ is a monomorphism,
\item for every scheme $Z$ and morphism $Z \to Y$ the
base change $Z \times_Y X \to Z$ of $f$ is a monomorphism,
\item for every affine scheme $Z$ and every morphism $Z \to Y$ the
base change $Z \times_Y X \to Z$ of $f$ is a monomorphism,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that the base change $V \times_Y X \to V$ is a
monomorphism, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that each
of the morphisms $f^{-1}(Y_i) \to Y_i$ is a monomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
We will use without further mention that a base change of a monomorphism
is a monomorphism, see
Lemma \ref{lemma-base-change-monomorphism}.
In particular it is clear that
(1) $\Rightarrow$ (2) $\Rightarrow$ (3) $\Rightarrow$ (4)
(by taking $V$ to be a disjoint union of affine schemes \'etale over $Y$, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}).
Let $V$ be a scheme, and let $V \to Y$ be a surjective \'etale morphism.
If $V \times_Y X \to V$ is a monomorphism, then it
follows that $X \to Y$ is a monomorphism. Namely, given any
cartesian diagram of sheaves
$$
\vcenter{
\xymatrix{
\mathcal{F} \ar[r]_a \ar[d]_b & \mathcal{G} \ar[d]^c \\
\mathcal{H} \ar[r]^d & \mathcal{I}
}
}
\quad
\quad
\mathcal{F} = \mathcal{H} \times_\mathcal{I} \mathcal{G}
$$
if $c$ is a surjection of sheaves, and $a$ is injective, then also
$d$ is injective. Thus (4) implies (1). Proof of the equivalence of
(5) and (1) is omitted.
\end{proof}

\begin{lemma}
\label{lemma-immersions-monomorphisms}
An immersion of algebraic spaces is a monomorphism.
In particular, any immersion is separated.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ be an immersion of algebraic spaces.
For any morphism $Z \to Y$ with $Z$ representable the base
change $Z \times_Y X \to Z$ is an immersion of schemes, hence
a monomorphism, see
Schemes, Lemma \ref{schemes-lemma-immersions-monomorphisms}.
Hence $f$ is representable, and a monomorphism.
\end{proof}

\noindent
We will improve on the following lemma in
Decent Spaces, Lemma
\ref{decent-spaces-lemma-monomorphism-toward-disjoint-union-dim-0-rings}.

\begin{lemma}
\label{lemma-monomorphism-toward-field}
Let $S$ be a scheme. Let $k$ be a field and let $Z \to \Spec(k)$
be a monomorphism of algebraic spaces over $S$. Then either
$Z = \emptyset$ or $Z = \Spec(k)$.
\end{lemma}

\begin{proof}
By
Lemmas \ref{lemma-monomorphism-separated} and
\ref{lemma-separated-over-separated}
we see that $Z$ is a separated algebraic space. Hence there exists an
open dense subspace $Z' \subset Z$ which is a scheme, see
Properties of Spaces, Proposition
\ref{spaces-properties-proposition-locally-quasi-separated-open-dense-scheme}.
By
Schemes, Lemma \ref{schemes-lemma-mono-towards-spec-field}
we see that either $Z' = \emptyset$ or $Z' \cong \Spec(k)$.
In the first case we conclude that $Z = \emptyset$ and in the
second case we conclude that $Z' = Z = \Spec(k)$
as $Z \to \Spec(k)$ is a monomorphism which is an
isomorphism over $Z'$.
\end{proof}

\begin{lemma}
\label{lemma-monomorphism-injective-points}
Let $S$ be a scheme. If $X \to Y$ is a monomorphism of algebraic spaces
over $S$, then $|X| \to |Y|$ is injective.
\end{lemma}

\begin{proof}
Immediate from the definitions.
\end{proof}















\section{Pushforward of quasi-coherent sheaves}
\label{section-pushforward}

\noindent
We first prove a simple lemma that relates pushforward of sheaves of modules
for a morphism of algebraic spaces to pushforward of sheaves of modules for
a morphism of schemes.

\begin{lemma}
\label{lemma-compute-pushforward}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $U \to X$ be a surjective \'etale morphism from a scheme to $X$.
Set $R = U \times_X U$ and denote $t, s : R \to U$ the projection
morphisms as usual. Denote $a : U \to Y$ and $b : R \to Y$ the induced
morphisms. For any object $\mathcal{F}$ of $\textit{Mod}(\mathcal{O}_X)$
there exists an exact sequence
$$
0 \to f_*\mathcal{F} \to a_*(\mathcal{F}|_U) \to b_*(\mathcal{F}|_R)
$$
where the second arrow is the difference $t^* - s^*$.
\end{lemma}

\begin{proof}
We denote $\mathcal{F}$ also its extension to a sheaf of modules on
$X_{spaces, \etale}$, see
Properties of Spaces,
Remark \ref{spaces-properties-remark-explain-equivalence}.
Let $V \to Y$ be an object of $Y_\etale$. Then $V \times_Y X$ is an
object of $X_{spaces, \etale}$, and by definition
$f_*\mathcal{F}(V) = \mathcal{F}(V \times_Y X)$. Since $U \to X$ is
surjective \'etale, we see that $\{V \times_Y U \to V \times_Y X\}$
is a covering. Also, we have
$(V \times_Y U) \times_X (V \times_Y U) = V \times_Y R$.
Hence, by the sheaf condition of $\mathcal{F}$ on
$X_{spaces, \etale}$ we have a short exact sequence
$$
0 \to \mathcal{F}(V \times_Y X)
\to \mathcal{F}(V \times_Y U) \to \mathcal{F}(V \times_Y R)
$$
where the second arrow is the difference of restricting via $t$ or $s$.
This exact sequence is functorial in $V$ and hence we obtain the lemma.
\end{proof}

\noindent
Let $S$ be a scheme. Let $f : X \to Y$ be a quasi-compact and
quasi-separated morphism of representable algebraic spaces $X$
and $Y$ over $S$. By
Descent,
Proposition \ref{descent-proposition-equivalence-quasi-coherent-functorial}
the functor
$f_* : \QCoh(\mathcal{O}_X) \to \QCoh(\mathcal{O}_Y)$
agrees with the usual functor if we think of $X$ and $Y$ as schemes.

\medskip\noindent
More generally, suppose $f : X \to Y$ is a representable, quasi-compact, and
quasi-separated morphism of algebraic spaces over $S$. Let $V$ be a scheme
and let $V \to Y$ be an \'etale surjective morphism. Let $U = V \times_Y X$
and let $f' : U \to V$ be the base change of $f$. Then for any
quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$ we have
\begin{equation}
\label{equation-representable-pushforward}
f'_*(\mathcal{F}|_U) = (f_*\mathcal{F})|_V,
\end{equation}
see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-pushforward-etale-base-change-modules}.
And because $f' : U \to V$ is a quasi-compact and quasi-separated
morphism of schemes, by the remark of the preceding paragraph we may
compute $f'_*(\mathcal{F}|_U)$ by thinking of $\mathcal{F}|_U$ as a
quasi-coherent sheaf on the scheme $U$, and $f'$ as a morphism of schemes.
We will frequently use this without further mention.

\medskip\noindent
The next level of generality is to consider an arbitrary
quasi-compact and quasi-separated morphism of algebraic spaces.

\begin{lemma}
\label{lemma-pushforward}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
If $f$ is quasi-compact and quasi-separated, then $f_*$ transforms
quasi-coherent $\mathcal{O}_X$-modules into
quasi-coherent $\mathcal{O}_Y$-modules.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$. We have to show that
$f_*\mathcal{F}$ is a quasi-coherent sheaf on $Y$. For this it suffices
to show that for any affine scheme $V$ and \'etale morphism $V \to Y$
the restriction of $f_*\mathcal{F}$ to $V$ is quasi-coherent, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-characterize-quasi-coherent}.
Let $f' : V \times_Y X \to V$
be the base change of $f$ by $V \to Y$. Note that $f'$ is also
quasi-compact and quasi-separated, see
Lemmas \ref{lemma-base-change-quasi-compact} and
\ref{lemma-base-change-separated}.
By (\ref{equation-representable-pushforward})
we know that the restriction of $f_*\mathcal{F}$ to $V$ is $f'_*$ of the
restriction of $\mathcal{F}$ to $V \times_Y X$. Hence
we may replace $f$ by $f'$, and assume that $Y$ is an affine scheme.

\medskip\noindent
Assume $Y$ is an affine scheme. Since $f$ is quasi-compact we see that $X$
is quasi-compact. Thus we may choose an affine scheme $U$ and a surjective
\'etale morphism $U \to X$, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-quasi-compact-affine-cover}.
By Lemma \ref{lemma-compute-pushforward} we get an exact sequence
$$
0 \to f_*\mathcal{F} \to a_*(\mathcal{F}|_U) \to b_*(\mathcal{F}|_R).
$$
where $R = U \times_X U$.
As $X \to Y$ is quasi-separated we see that $R \to U \times_Y U$
is a quasi-compact monomorphism. This implies that $R$ is a quasi-compact
separated scheme (as $U$ and $Y$ are affine at this point).
Hence $a : U \to Y$ and $b : R \to Y$ are quasi-compact and
quasi-separated morphisms of schemes. Thus by
Descent,
Proposition \ref{descent-proposition-equivalence-quasi-coherent-functorial}
the sheaves $a_*(\mathcal{F}|_U)$ and $b_*(\mathcal{F}|_R)$
are quasi-coherent (see also the discussion preceding this lemma).
This implies that $f_*\mathcal{F}$ is a kernel of
quasi-coherent modules, and hence itself quasi-coherent, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-properties-quasi-coherent}.
\end{proof}

\noindent
Higher direct images are discussed in
Cohomology of Spaces, Section
\ref{spaces-cohomology-section-higher-direct-image}.









\section{Immersions}
\label{section-immersions}

\noindent
Open, closed and locally closed immersions of algebraic spaces were defined in
Spaces, Section \ref{spaces-section-Zariski}.
Namely, a morphism of algebraic spaces is a
{\it closed immersion} (resp. {\it open immersion}, resp.\ {\it immersion})
if it is representable and a closed immersion (resp.\ open immersion,
resp.\ immersion) in the sense of Section \ref{section-representable}.

\medskip\noindent
In particular these types of morphisms are stable under base change
and compositions of morphisms in the category of algebraic
spaces over $S$, see
Spaces, Lemmas \ref{spaces-lemma-composition-immersions} and
\ref{spaces-lemma-base-change-immersions}.

\begin{lemma}
\label{lemma-closed-immersion-local}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. The following are equivalent:
\begin{enumerate}
\item $f$ is a closed immersion (resp.\ open immersion, resp.\ immersion),
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is a closed immersion (resp.\ open immersion,
resp.\ immersion),
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is a closed immersion
(resp.\ open immersion, resp.\ immersion),
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is a closed immersion
(resp.\ open immersion, resp.\ immersion), and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that
each of the morphisms $f^{-1}(Y_i) \to Y_i$ is a closed immersion
(resp.\ open immersion, resp.\ immersion).
\end{enumerate}
\end{lemma}

\begin{proof}
Using that a base change of a
closed immersion (resp.\ open immersion, resp.\ immersion)
is another one it is clear that (1) implies (2) and (2) implies (3).
Also (3) implies (4) since we can take $V$ to be a disjoint union of
affines, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}.

\medskip\noindent
Assume $V \to Y$ is as in (4).
Let $\mathcal{P}$ be the property
closed immersion (resp.\ open immersion, resp.\ immersion)
of morphisms of schemes. Note that property $\mathcal{P}$
is preserved under any base change and fppf local on the
base (see Section \ref{section-representable}).
Moreover, morphisms of type $\mathcal{P}$ are separated and
locally quasi-finite (in each of the three cases, see
Schemes, Lemma \ref{schemes-lemma-immersions-monomorphisms}, and
Morphisms, Lemma \ref{morphisms-lemma-immersion-locally-quasi-finite}).
Hence by
More on Morphisms, Lemma
\ref{more-morphisms-lemma-separated-locally-quasi-finite-morphisms-fppf-descend}
the morphisms of type $\mathcal{P}$ satisfy descent for fppf covering. Thus
Spaces, Lemma \ref{spaces-lemma-morphism-sheaves-with-P-effective-descent-etale}
applies and we see that $X \to Y$ is representable and has property
$\mathcal{P}$, in other words (1) holds.

\medskip\noindent
The equivalence of (1) and (5) follows from the fact that
$\mathcal{P}$ is Zariski local on the target (since we saw
above that $\mathcal{P}$ is in fact fppf local on the target).
\end{proof}

\begin{lemma}
\label{lemma-immersion-permanence}
Let $S$ be a scheme.
Let $Z \to Y \to X$ be morphisms of algebraic spaces over $S$.
\begin{enumerate}
\item If $Z \to X$ is representable, locally of finite type, locally
quasi-finite, separated, and a monomorphism, then $Z \to Y$ is
representable, locally of finite type, locally quasi-finite,
separated, and a monomorphism.
\item If $Z \to X$ is an immersion and $Y \to X$ is locally separated,
then $Z \to Y$ is an immersion.
\item If $Z \to X$ is a closed immersion and $Y \to X$ is separated,
then $Z \to Y$ is a closed immersion.
\end{enumerate}
\end{lemma}

\begin{proof}
In each case the proof is to contemplate the commutative diagram
$$
\xymatrix{
Z \ar[r] \ar[rd] & Y \times_X Z \ar[r] \ar[d] & Z \ar[d] \\
& Y \ar[r] & X
}
$$
where the composition of the top horizontal arrows is the identity.
Let us prove (1). The first horizontal arrow is a section of
$Y \times_X Z \to Z$, whence representable, locally of finite type,
locally quasi-finite, separated, and a monomorphism by
Lemma \ref{lemma-section-immersion}.
The arrow $Y \times_X Z \to Y$ is a base change of $Z \to X$
hence is representable, locally of finite type,
locally quasi-finite, separated, and a monomorphism
(as each of these properties of morphisms of schemes is stable
under base change, see
Spaces, Remark \ref{spaces-remark-list-properties-stable-base-change}).
Hence the same is true for the composition (as each of these properties of
morphisms of schemes is stable under composition, see Spaces, Remark
\ref{spaces-remark-list-properties-stable-composition}).
This proves (1). The other results are proved in exactly the same manner.
\end{proof}

\begin{lemma}
\label{lemma-immersion-when-closed}
Let $S$ be a scheme. Let $i : Z \to X$ be an immersion of algebraic
spaces over $S$. Then $|i| : |Z| \to |X|$ is a homeomorphism onto a
locally closed subset, and $i$ is a closed immersion if and only if
the image $|i|(|Z|) \subset |X|$ is a closed subset.
\end{lemma}

\begin{proof}
The first statement is Properties of Spaces, Lemma
\ref{spaces-properties-lemma-subspace-induced-topology}.
Let $U$ be a scheme and let $U \to X$ be a surjective \'etale morphism.
By assumption $T = U \times_X Z$ is a scheme and the morphism $j : T \to U$
is an immersion of schemes. By Lemma \ref{lemma-closed-immersion-local}
the morphism $i$ is a closed immersion if and only if $j$ is a closed
immersion. By Schemes, Lemma \ref{schemes-lemma-immersion-when-closed}
this is true if and only if $j(T)$ is closed in $U$.
However, the subset $j(T) \subset U$ is the inverse image of
$|i|(|Z|) \subset |X|$, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-cartesian}.
This finishes the proof.
\end{proof}

\begin{remark}
\label{remark-immersion}
Let $S$ be a scheme. Let $i : Z \to X$ be an immersion of algebraic
spaces over $S$. Since $i$ is a monomorphism we may think of $|Z|$ as
a subset of $|X|$; in the rest of this remark we do so.
Let $\partial |Z|$ be the boundary of $|Z|$ in
the topological space $|X|$. In a formula
$$
\partial |Z| = \overline{|Z|} \setminus |Z|.
$$
Let $\partial Z$ be the reduced closed subspace of $X$ with
$|\partial Z| = \partial |Z|$
obtained by taking the reduced induced closed subspace structure, see
Properties of Spaces,
Definition \ref{spaces-properties-definition-reduced-induced-space}.
By construction we see that $|Z|$ is closed in
$|X| \setminus |\partial Z| = |X \setminus \partial Z|$.
Hence it is true that any immersion of algebraic spaces can be
factored as a closed immersion followed by an open immersion
(but not the other way in general, see
Morphisms, Example \ref{morphisms-example-thibaut}).
\end{remark}

\begin{remark}
\label{remark-space-structure-locally-closed-subset}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $T \subset |X|$ be a locally closed subset.
Let $\partial T$ be the boundary of $T$ in
the topological space $|X|$. In a formula
$$
\partial T = \overline{T} \setminus T.
$$
Let $U \subset X$ be the open subspace of $X$ with
$|U| = |X| \setminus \partial T$, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-open-subspaces}.
Let $Z$ be the reduced closed subspace of $U$ with
$|Z| = T$ obtained by taking the reduced induced
closed subspace structure, see
Properties of Spaces,
Definition \ref{spaces-properties-definition-reduced-induced-space}.
By construction $Z \to U$ is a closed immersion of algebraic spaces
and $U \to X$ is an open immersion, hence
$Z \to X$ is an immersion of algebraic spaces over $S$ (see
Spaces, Lemma \ref{spaces-lemma-composition-immersions}).
Note that $Z$ is a reduced algebraic space and that
$|Z| = T$ as subsets of $|X|$. We sometimes say
$Z$ is the {\it reduced induced subspace structure} on $T$.
\end{remark}

\begin{lemma}
\label{lemma-factor-the-other-way}
Let $S$ be a scheme. Let $Z \to X$ be an immersion of algebraic spaces over
$S$. Assume $Z \to X$ is quasi-compact.
There exists a factorization $Z \to \overline{Z} \to X$ where
$Z \to \overline{Z}$ is an open immersion and $\overline{Z} \to X$
is a closed immersion.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $U \to X$ be surjective \'etale.
As usual denote $R = U \times_X U$ with projections
$s, t : R \to U$. Set $T = Z \times_U X$. Let $\overline{T} \subset U$
be the scheme theoretic image of $T \to U$. Note that
$s^{-1}\overline{T} = t^{-1}\overline{T}$ as taking
scheme theoretic images of quasi-compact morphisms commute
with flat base change, see
Morphisms, Lemma \ref{morphisms-lemma-flat-base-change-scheme-theoretic-image}.
Hence we obtain a closed subspace $\overline{Z} \subset X$ whose
pullback to $U$ is $\overline{T}$, see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-subspaces-presentation}.
By Morphisms, Lemma \ref{morphisms-lemma-quasi-compact-immersion}
the morphism $T \to \overline{T}$
is an open immersion. It follows that $Z \to \overline{Z}$ is
an open immersion and we win.
\end{proof}


















\section{Closed immersions}
\label{section-closed-immersions}

\noindent
In this section we elucidate some of the results obtained previously on
immersions of algebraic spaces. See
Spaces, Section \ref{spaces-section-Zariski}
and
Section \ref{section-immersions} in this chapter.
This section is the analogue of
Morphisms, Section \ref{morphisms-section-closed-immersions}
for algebraic spaces.

\begin{lemma}
\label{lemma-closed-immersion-ideals}
Let $S$ be a scheme.
Let $X$ be an algebraic space over $S$.
For every closed immersion $i : Z \to X$ the sheaf
$i_*\mathcal{O}_Z$ is a quasi-coherent $\mathcal{O}_X$-module, the map
$i^\sharp : \mathcal{O}_X \to i_*\mathcal{O}_Z$ is surjective and its
kernel is a quasi-coherent sheaf of ideals. The rule
$Z \mapsto \Ker(\mathcal{O}_X \to i_*\mathcal{O}_Z)$
defines an inclusion reversing bijection
$$
\begin{matrix}
\text{closed subspaces}\\
Z \subset X
\end{matrix}
\longrightarrow
\begin{matrix}
\text{quasi-coherent sheaves}\\
\text{of ideals }\mathcal{I} \subset \mathcal{O}_X
\end{matrix}
$$
Moreover, given a closed subscheme $Z$ corresponding to the quasi-coherent
sheaf of ideals $\mathcal{I} \subset \mathcal{O}_X$ a morphism of algebraic
spaces $h : Y \to X$ factors through $Z$ if and only if the map
$h^*\mathcal{I} \to h^*\mathcal{O}_X = \mathcal{O}_Y$ is zero.
\end{lemma}

\begin{proof}
Let $U \to X$ be a surjective \'etale morphism whose source is a scheme.
Consider the diagram
$$
\xymatrix{
U \times_X Z \ar[r] \ar[d]_{i'} & Z \ar[d]^i \\
U \ar[r] & X
}
$$
By
Lemma \ref{lemma-closed-immersion-local}
we see that $i$ is a closed immersion
if and only if $i'$ is a closed immersion. By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-pushforward-etale-base-change-modules}
we see that $i'_*\mathcal{O}_{U \times_X Z}$ is the restriction of
$i_*\mathcal{O}_Z$ to $U$. Hence the assertions on
$\mathcal{O}_X \to i_*\mathcal{O}_Z$ are equivalent to the
corresponding assertions on
$\mathcal{O}_U \to i'_*\mathcal{O}_{U \times_X Z}$.
And since $i'$ is a closed immersion of schemes, these results follow from
Morphisms, Lemma \ref{morphisms-lemma-closed-immersion}.

\medskip\noindent
Let us prove that given a quasi-coherent
sheaf of ideals $\mathcal{I} \subset \mathcal{O}_X$ the formula
$$
Z(T) = \{h : T \to X \mid h^*\mathcal{I} \to \mathcal{O}_T
\text{ is zero}\}
$$
defines a closed subspace of $X$. It is clearly a subfunctor of $X$.
To show that $Z \to X$ is representable by closed immersions, let
$\varphi : U \to X$ be a morphism from a scheme towards $X$. Then
$Z \times_X U$ is represented by the analogous subfunctor of $U$ corresponding
to the sheaf of ideals $\Im(\varphi^*\mathcal{I} \to \mathcal{O}_U)$. By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-pullback-quasi-coherent}
the $\mathcal{O}_U$-module $\varphi^*\mathcal{I}$ is quasi-coherent
on $U$, and hence $\Im(\varphi^*\mathcal{I} \to \mathcal{O}_U)$
is a quasi-coherent sheaf of ideals on $U$. By
Schemes, Lemma \ref{schemes-lemma-characterize-closed-subspace}
we conclude that $Z \times_X U$ is represented by the closed subscheme
of $U$ associated to $\Im(\varphi^*\mathcal{I} \to \mathcal{O}_U)$.
Thus $Z$ is a closed subspace of $X$.

\medskip\noindent
In the formula for $Z$ above the inputs $T$ are schemes since algebraic
spaces are sheaves on $(\Sch/S)_{fppf}$. We omit the verification
that the same formula remains true if $T$ is an algebraic space.
\end{proof}

\begin{definition}
\label{definition-inverse-image-closed-subspace}
Let $S$ be a scheme. Let $f : Y \to X$ be a morphism of algebraic spaces
over $S$. Let $Z \subset X$ be a closed subspace. The
{\it inverse image $f^{-1}(Z)$ of the closed subspace $Z$}
is the closed subspace $Z \times_X Y$ of $Y$.
\end{definition}

\noindent
This definition makes sense by Lemma \ref{lemma-closed-immersion-local}.
If $\mathcal{I} \subset \mathcal{O}_X$ is the quasi-coherent sheaf of
ideals corresponding to $Z$ via Lemma \ref{lemma-closed-immersion-ideals} then
$f^{-1}\mathcal{I}\mathcal{O}_Y = \Im(f^*\mathcal{I} \to \mathcal{O}_Y)$
is the sheaf of ideals corresponding to $f^{-1}(Z)$.

\begin{lemma}
\label{lemma-closed-immersion-quasi-compact}
A closed immersion of algebraic spaces is quasi-compact.
\end{lemma}

\begin{proof}
This follows from
Schemes, Lemma \ref{schemes-lemma-closed-immersion-quasi-compact}
by general principles, see
Spaces, Lemma
\ref{spaces-lemma-representable-transformations-property-implication}.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-separated}
A closed immersion of algebraic spaces is separated.
\end{lemma}

\begin{proof}
This follows from
Schemes, Lemma \ref{schemes-lemma-immersions-monomorphisms}
by general principles, see
Spaces, Lemma
\ref{spaces-lemma-representable-transformations-property-implication}.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-push-pull}
Let $S$ be a scheme. Let $i : Z \to X$ be a closed immersion of algebraic
spaces over $S$.
\begin{enumerate}
\item The functor
$$
i_{small, *} :
\Sh(Z_\etale)
\longrightarrow
\Sh(X_\etale)
$$
is fully faithful and its essential image is those sheaves of sets
$\mathcal{F}$ on $X_\etale$ whose restriction to $X \setminus Z$ is
isomorphic to $*$, and
\item the functor
$$
i_{small, *} :
\textit{Ab}(Z_\etale)
\longrightarrow
\textit{Ab}(X_\etale)
$$
is fully faithful and its essential image is those abelian sheaves on
$X_\etale$ whose support is contained in $|Z|$.
\end{enumerate}
In both cases $i_{small}^{-1}$ is a left inverse to the functor
$i_{small, *}$.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $U \to X$ be surjective \'etale.
Set $V = Z \times_X U$. Then $V$ is a scheme and $i' : V \to U$ is
a closed immersion of schemes. By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-pushforward-etale-base-change}
for any sheaf $\mathcal{G}$ on $Z$ we have
$$
(i_{small}^{-1}i_{small, *}\mathcal{G})|_V =
(i')_{small}^{-1}i'_{small, *}(\mathcal{G}|_V)
$$
By
\'Etale Cohomology, Proposition
\ref{etale-cohomology-proposition-closed-immersion-pushforward}
the map
$(i')_{small}^{-1}i'_{small, *}(\mathcal{G}|_V) \to \mathcal{G}|_V$
is an isomorphism. Since $V \to Z$ is surjective and \'etale this implies
that $i_{small}^{-1}i_{small, *}\mathcal{G} \to \mathcal{G}$ is an
isomorphism. This clearly implies that $i_{small, *}$ is fully faithful, see
Sites, Lemma \ref{sites-lemma-exactness-properties}.
To prove the statement on the essential image, consider a sheaf of sets
$\mathcal{F}$ on $X_\etale$ whose restriction to $X \setminus Z$ is
isomorphic to $*$. As in the proof of
\'Etale Cohomology, Proposition
\ref{etale-cohomology-proposition-closed-immersion-pushforward}
we consider the adjunction mapping
$$
\mathcal{F} \longrightarrow i_{small, *}i_{small}^{-1}\mathcal{F}.
$$
As in the first part we see that the restriction of this map to
$U$ is an isomorphism by the corresponding result for the case of
schemes. Since $U$ is an \'etale covering of $X$ we
conclude it is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-stalk-push-closed}
Let $S$ be a scheme. Let $i : Z \to X$ be a closed immersion of algebraic
spaces over $S$. Let $\overline{z}$ be a geometric point of $Z$ with
image $\overline{x}$ in $X$. Then
$(i_{small, *}\mathcal{F})_{\overline{z}} = \mathcal{F}_{\overline{x}}$
for any sheaf $\mathcal{F}$ on $Z_\etale$.
\end{lemma}

\begin{proof}
Choose an \'etale neighbourhood $(U, \overline{u})$ of $\overline{x}$.
Then the stalk $(i_{small, *}\mathcal{F})_{\overline{z}}$
is the stalk of $i_{small, *}\mathcal{F}|_U$ at $\overline{u}$.
By Properties of Spaces,
Lemma \ref{spaces-properties-lemma-pushforward-etale-base-change}
we may replace $X$ by $U$ and $Z$ by $Z \times_X U$.
Then $Z \to X$ is a closed immersion of schemes and the result is
\'Etale Cohomology, Lemma
\ref{etale-cohomology-lemma-stalk-pushforward-closed-immersion}.
\end{proof}

\noindent
The following lemma holds more generally in the setting of a closed
immersion of topoi (insert future reference here).

\begin{lemma}
\label{lemma-closed-immersion-rings}
Let $S$ be a scheme. Let $i : Z \to X$ be a closed immersion of algebraic
spaces over $S$. Let $\mathcal{A}$ be a sheaf of rings on $X_\etale$.
Let $\mathcal{B}$ be a sheaf of rings on $Z_\etale$.
Let $\varphi : \mathcal{A} \to i_{small, *}\mathcal{B}$
be a homomorphism of sheaves of rings so that we obtain a
morphism of ringed topoi
$$
f : (\Sh(Z_\etale), \mathcal{B}) \longrightarrow (\Sh(X_\etale), \mathcal{A}).
$$
For a sheaf of $\mathcal{A}$-modules $\mathcal{F}$ and a
sheaf of $\mathcal{B}$-modules $\mathcal{G}$ the canonical map
$$
\mathcal{F} \otimes_\mathcal{A} f_*\mathcal{G}
\longrightarrow
f_*(f^*\mathcal{F} \otimes_\mathcal{B} \mathcal{G}).
$$
is an isomorphism.
\end{lemma}

\begin{proof}
The map is the map adjoint to the map
$$
f^*\mathcal{F} \otimes_\mathcal{B}
f^* f_*\mathcal{G} =
f^*(\mathcal{F} \otimes_\mathcal{A} f_*\mathcal{G})
\longrightarrow
f^*\mathcal{F} \otimes_\mathcal{B} \mathcal{G}
$$
coming from $\text{id} : f^*\mathcal{F} \to f^*\mathcal{F}$
and the adjunction map $f^* f_*\mathcal{G} \to \mathcal{G}$.
To see this map is an isomorphism, we may check on stalks
(Properties of Spaces, Theorem
\ref{spaces-properties-theorem-exactness-stalks}).
Let $\overline{z} : \Spec(k) \to Z$ be a geometric point with
image $\overline{x} = i \circ \overline{z} : \Spec(k) \to X$.
Working out what our maps does on stalks, we see that we
have to show
$$
\mathcal{F}_{\overline{x}}
\otimes_{\mathcal{A}_{\overline{x}}}
\mathcal{G}_{\overline{z}} =
(\mathcal{F}_{\overline{x}}
\otimes_{\mathcal{A}_{\overline{x}}}
\mathcal{B}_{\overline{z}}) \otimes_{\mathcal{B}_{\overline{z}}}
\mathcal{G}_{\overline{z}}
$$
which holds true. Here we have used that
taking tensor products commutes with taking stalks, the
behaviour of stalks under pullback
Properties of Spaces, Lemma \ref{spaces-properties-lemma-stalk-pullback}, and
the behaviour of stalks under pushforward along a closed immersion
Lemma \ref{lemma-stalk-push-closed}.
\end{proof}






\section{Closed immersions and quasi-coherent sheaves}
\label{section-closed-immersions-quasi-coherent}

\noindent
This section is the analogue of
Morphisms, Section \ref{morphisms-section-closed-immersions-quasi-coherent}.

\begin{lemma}
\label{lemma-i-star-equivalence}
Let $S$ be a scheme. Let $i : Z \to X$ be a closed immersion of algebraic
spaces over $S$. Let $\mathcal{I} \subset \mathcal{O}_X$ be the quasi-coherent
sheaf of ideals cutting out $Z$.
\begin{enumerate}
\item For any $\mathcal{O}_X$-module $\mathcal{F}$ the adjunction map
$\mathcal{F} \to i_*i^*\mathcal{F}$ induces an isomorphism
$\mathcal{F}/\mathcal{I}\mathcal{F} \cong i_*i^*\mathcal{F}$.
\item The functor $i^*$ is a left inverse to $i_*$, i.e., for any
$\mathcal{O}_Z$-module $\mathcal{G}$ the adjunction map
$i^*i_*\mathcal{G} \to \mathcal{G}$ is an isomorphism.
\item The functor
$$
i_* :
\QCoh(\mathcal{O}_Z)
\longrightarrow
\QCoh(\mathcal{O}_X)
$$
is exact, fully faithful, with essential image those quasi-coherent
$\mathcal{O}_X$-modules $\mathcal{F}$ such that $\mathcal{I}\mathcal{F} = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
During this proof we work exclusively with sheaves on
the small \'etale sites, and we use $i_*, i^{-1}, \ldots$
to denote pushforward and pullback of sheaves of abelian groups
instead of $i_{small, *}, i_{small}^{-1}$.

\medskip\noindent
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. By
Lemma \ref{lemma-closed-immersion-rings} applied with
$\mathcal{A} = \mathcal{O}_X$ and
$\mathcal{G} = \mathcal{B} = \mathcal{O}_Z$ we see that
$i_*i^*\mathcal{F} = \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{O}_Z$.
By
Lemma \ref{lemma-closed-immersion-ideals}
we see that we have a short exact sequence
$$
0 \to \mathcal{I} \to \mathcal{O}_X \to i_*\mathcal{O}_Z \to 0
$$
It follows from properties of the tensor product that
$\mathcal{F} \otimes_{\mathcal{O}_X} i_*\mathcal{O}_Z
= \mathcal{F}/\mathcal{I}\mathcal{F}$. This proves (1) (except
that we omit the verification that the map is induced by the
adjunction mapping).

\medskip\noindent
Let $\mathcal{G}$ be any $\mathcal{O}_Z$-module. By
Lemma \ref{lemma-closed-immersion-push-pull}
we see that $i^{-1}i_*\mathcal{G} = \mathcal{G}$.
Hence to prove (2) we have to show that the canonical map
$\mathcal{G} \otimes_{i^{-1}\mathcal{O}_X} \mathcal{O}_Z \to \mathcal{G}$
is an isomorphism. This follows from general properties of tensor products
if we can show that $i^{-1}\mathcal{O}_X \to \mathcal{O}_Z$ is surjective. By
Lemma \ref{lemma-closed-immersion-push-pull}
it suffices to prove that
$i_*i^{-1}\mathcal{O}_X \to i_*\mathcal{O}_Z$
is surjective. Since the surjective map $\mathcal{O}_X \to i_*\mathcal{O}_Z$
factors through this map we see that (2) holds.

\medskip\noindent
Finally we prove the most interesting part of the lemma, namely part (3).
A closed immersion is quasi-compact and separated, see
Lemmas \ref{lemma-closed-immersion-quasi-compact} and
\ref{lemma-closed-immersion-separated}. Hence
Lemma \ref{lemma-pushforward}
applies and the pushforward of a quasi-coherent
sheaf on $Z$ is indeed a quasi-coherent sheaf on $X$.
Thus we obtain our functor
$i^{QCoh}_* : \QCoh(\mathcal{O}_Z)
\to \QCoh(\mathcal{O}_X)$.
It is clear from part (2) that $i^{QCoh}_*$ is fully faithful since
it has a left inverse, namely $i^*$.

\medskip\noindent
Now we turn to the description of the essential image of the
functor $i_*$. It is clear that $\mathcal{I}(i_*\mathcal{G}) = 0$
for any $\mathcal{O}_Z$-module, since $\mathcal{I}$ is the kernel
of the map $\mathcal{O}_X \to i_*\mathcal{O}_Z$ which is the map
we use to put an $\mathcal{O}_X$-module structure on $i_*\mathcal{G}$.
Next, suppose that $\mathcal{F}$ is any quasi-coherent
$\mathcal{O}_X$-module such that $\mathcal{I}\mathcal{F} = 0$.
Then we see that $\mathcal{F}$ is an $i_*\mathcal{O}_Z$-module
because $i_*\mathcal{O}_Z = \mathcal{O}_X/\mathcal{I}$. Hence in
particular its support is contained in $|Z|$. We apply
Lemma \ref{lemma-closed-immersion-push-pull}
to see that $\mathcal{F} \cong i_*\mathcal{G}$ for some
$\mathcal{O}_Z$-module $\mathcal{G}$. The only small detail left over
is to see why $\mathcal{G}$ is quasi-coherent. This is true
because $\mathcal{G} \cong i^*\mathcal{F}$ by part (2) and
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-pullback-quasi-coherent}.
\end{proof}

\noindent
Let $i : Z \to X$ be a closed immersion of algebraic spaces.
Because of the lemma above we often,
by abuse of notation, denote $\mathcal{F}$ the sheaf $i_*\mathcal{F}$ on $X$.

\begin{lemma}
\label{lemma-largest-quasi-coherent-subsheaf}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Let $\mathcal{G} \subset \mathcal{F}$ be a $\mathcal{O}_X$-submodule.
There exists a unique quasi-coherent $\mathcal{O}_X$-submodule
$\mathcal{G}' \subset \mathcal{G}$ with the following property:
For every quasi-coherent $\mathcal{O}_X$-module $\mathcal{H}$ the map
$$
\Hom_{\mathcal{O}_X}(\mathcal{H}, \mathcal{G}')
\longrightarrow
\Hom_{\mathcal{O}_X}(\mathcal{H}, \mathcal{G})
$$
is bijective. In particular $\mathcal{G}'$ is the largest quasi-coherent
$\mathcal{O}_X$-submodule of $\mathcal{F}$ contained in $\mathcal{G}$.
\end{lemma}

\begin{proof}
Let $\mathcal{G}_a$, $a \in A$ be the set of quasi-coherent
$\mathcal{O}_X$-submodules contained in $\mathcal{G}$.
Then the image $\mathcal{G}'$ of
$$
\bigoplus\nolimits_{a \in A} \mathcal{G}_a \longrightarrow \mathcal{F}
$$
is quasi-coherent as the image of a map of quasi-coherent sheaves
on $X$ is quasi-coherent and since a direct sum of quasi-coherent sheaves
is quasi-coherent, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-properties-quasi-coherent}.
The module $\mathcal{G}'$ is contained in $\mathcal{G}$. Hence this is the
largest quasi-coherent $\mathcal{O}_X$-module contained in $\mathcal{G}$.

\medskip\noindent
To prove the formula, let $\mathcal{H}$ be a quasi-coherent
$\mathcal{O}_X$-module and let $\alpha : \mathcal{H} \to \mathcal{G}$
be an $\mathcal{O}_X$-module map. The image of the composition
$\mathcal{H} \to \mathcal{G} \to \mathcal{F}$ is quasi-coherent
as the image of a map of quasi-coherent sheaves. Hence it is contained
in $\mathcal{G}'$. Hence $\alpha$ factors through $\mathcal{G}'$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-i-upper-shriek}
Let $S$ be a scheme.
Let $i : Z \to X$ be a closed immersion of algebraic spaces over $S$.
There is a functor\footnote{This is likely nonstandard notation.}
$i^! : \QCoh(\mathcal{O}_X) \to \QCoh(\mathcal{O}_Z)$
which is a right adjoint to $i_*$. (Compare
Modules, Lemma \ref{modules-lemma-i-star-right-adjoint}.)
\end{lemma}

\begin{proof}
Given quasi-coherent $\mathcal{O}_X$-module $\mathcal{G}$ we consider
the subsheaf $\mathcal{H}_Z(\mathcal{G})$ of $\mathcal{G}$ of local sections
annihilated by $\mathcal{I}$. By
Lemma \ref{lemma-largest-quasi-coherent-subsheaf}
there is a canonical largest quasi-coherent $\mathcal{O}_X$-submodule
$\mathcal{H}_Z(\mathcal{G})'$. By construction we have
$$
\Hom_{\mathcal{O}_X}(i_*\mathcal{F}, \mathcal{H}_Z(\mathcal{G})')
=
\Hom_{\mathcal{O}_X}(i_*\mathcal{F}, \mathcal{G})
$$
for any quasi-coherent $\mathcal{O}_Z$-module $\mathcal{F}$.
Hence we can set $i^!\mathcal{G} = i^*(\mathcal{H}_Z(\mathcal{G})')$.
Details omitted.
\end{proof}

\noindent
Using the $1$-to-$1$ corresponding between quasi-coherent sheaves
of ideals and closed subspaces (see
Lemma \ref{lemma-closed-immersion-ideals})
we can define scheme theoretic intersections and unions
of closed subschemes.

\begin{definition}
\label{definition-scheme-theoretic-intersection-union}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $Z, Y \subset X$ be closed subspaces
corresponding to quasi-coherent ideal sheaves
$\mathcal{I}, \mathcal{J} \subset \mathcal{O}_X$.
The {\it scheme theoretic intersection} of $Z$ and $Y$
is the closed subspace of $X$ cut out by $\mathcal{I} + \mathcal{J}$.
Then {\it scheme theoretic union} of $Z$ and $Y$
is the closed subspace of $X$ cut out by
$\mathcal{I} \cap \mathcal{J}$.
\end{definition}

\noindent
It is clear that formation of scheme theoretic intersection
commutes with \'etale localization and the same is true for
scheme theoretic union.

\begin{lemma}
\label{lemma-scheme-theoretic-intersection}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $Z, Y \subset X$ be closed subspaces.
Let $Z \cap Y$ be the scheme theoretic intersection of $Z$ and $Y$.
Then $Z \cap Y \to Z$ and $Z \cap Y \to Y$ are closed immersions
and
$$
\xymatrix{
Z \cap Y \ar[r] \ar[d] & Z \ar[d] \\
Y \ar[r] & X
}
$$
is a cartesian diagram of algebraic spaces over $S$, i.e.,
$Z \cap Y = Z \times_X Y$.
\end{lemma}

\begin{proof}
The morphisms $Z \cap Y \to Z$ and $Z \cap Y \to Y$ are closed immersions
by Lemma \ref{lemma-closed-immersion-ideals}.
Since formation of the scheme theoretic intersection commutes
with \'etale localization we conclude the diagram is cartesian
by the case of schemes. See
Morphisms, Lemma \ref{morphisms-lemma-scheme-theoretic-intersection}.
\end{proof}

\begin{lemma}
\label{lemma-scheme-theoretic-union}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $Y, Z \subset X$ be closed subspaces.
Let $Y \cup Z$ be the scheme theoretic union of $Y$ and $Z$.
Let $Y \cap Z$ be the scheme theoretic intersection of $Y$ and $Z$.
Then $Y \to Y \cup Z$ and $Z \to Y \cup Z$ are closed immersions,
there is a short exact sequence
$$
0 \to \mathcal{O}_{Y \cup Z} \to \mathcal{O}_Y \times \mathcal{O}_Z
\to \mathcal{O}_{Y \cap Z} \to 0
$$
of $\mathcal{O}_Z$-modules, and the diagram
$$
\xymatrix{
Y \cap Z \ar[r] \ar[d] & Y \ar[d] \\
Z \ar[r] & Y \cup Z
}
$$
is cocartesian in the category of algebraic spaces over $S$, i.e.,
$Y \cup Z = Y \amalg_{Y \cap Z} Z$.
\end{lemma}

\begin{proof}
The morphisms $Y \to Y \cup Z$ and $Z \to Y \cup Z$ are closed immersions
by Lemma \ref{lemma-closed-immersion-ideals}. In the short exact sequence
we use the equivalence of Lemma \ref{lemma-i-star-equivalence} to think of
quasi-coherent modules on closed subspaces of $X$ as quasi-coherent modules
on $X$. For the first map in the sequence we use the canonical maps
$\mathcal{O}_{Y \cup Z} \to \mathcal{O}_Y$ and
$\mathcal{O}_{Y \cup Z} \to \mathcal{O}_Z$
and for the second map we use the canonical map
$\mathcal{O}_Y \to \mathcal{O}_{Y \cap Z}$ and
the negative of the canonical map
$\mathcal{O}_Z \to \mathcal{O}_{Y \cap Z}$. Then to check
exactness we may work \'etale locally and deduce exactness
from the case of schemes
(Morphisms, Lemma \ref{morphisms-lemma-scheme-theoretic-union}).

\medskip\noindent
To show the diagram is cocartesian, suppose we are given an algebraic space
$T$ over $S$ and morphisms $f : Y \to T$, $g : Z \to T$ agreeing as morphisms
$Y \cap Z \to T$. Goal: Show there exists a unique morphism
$h : Y \cup Z \to T$ agreeing with $f$ and $g$.
To construct $h$ we may work \'etale locally on $Y \cup Z$
(as $Y \cup Z$ is an \'etale sheaf being an algebraic space).
Hence we may assume that $X$ is a scheme.
In this case we know that $Y \cup Z$ is the pushout
of $Y$ and $Z$ along $Y \cap Z$ in the category of schemes
by Morphisms, Lemma \ref{morphisms-lemma-scheme-theoretic-union}.
Choose a scheme $T'$ and a surjective \'etale morphism $T' \to T$.
Set $Y' = T' \times_{T, f} Y$ and $Z' = T' \times_{T, g} Z$.
Then $Y'$ and $Z'$ are schemes and we have a canonical isomorphism
$\varphi : Y' \times_Y (Y \cap Z) \to Z' \times_Z (Y \cap Z)$
of schemes. By More on Morphisms, Lemma
\ref{more-morphisms-lemma-pushout-along-closed-immersions}
the pushout $W' = Y' \amalg_{Y' \times_Y (Y \cap Z), \varphi} Z'$
exists in the category of schemes.
The morphism $W' \to Y \cup Z$ is \'etale by
More on Morphisms, Lemma
\ref{more-morphisms-lemma-pushout-along-closed-immersions-properties-above}.
It is surjective as $Y' \to Y$ and $Z' \to Z$ are surjective.
The morphisms $f' : Y' \to T'$ and $g' : Z' \to T'$
glue to a unique morphism of schemes $h' : W' \to T'$.
By uniqueness the composition $W' \to T' \to T$
descends to the desired morphism $h : Y \cup Z \to T$.
Some details omitted.
\end{proof}






\section{Supports of modules}
\label{section-support}

\noindent
In this section we collect some elementary results on supports of
quasi-coherent modules on algebraic spaces. Let $X$ be an algebraic
space. The support of an abelian sheaf on $X_\etale$
has been defined in Properties of Spaces, Section
\ref{spaces-properties-section-support}.
We use the same definition for supports of modules.
The following lemma tells us this agrees with the notion
as defined for quasi-coherent modules on schemes.

\begin{lemma}
\label{lemma-support-covering}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Let $U$ be a scheme and let $\varphi : U \to X$ be an \'etale morphism.
Then
$$
\text{Supp}(\varphi^*\mathcal{F}) = |\varphi|^{-1}(\text{Supp}(\mathcal{F}))
$$
where the left hand side is the support of $\varphi^*\mathcal{F}$ as a
quasi-coherent module on the scheme $U$.
\end{lemma}

\begin{proof}
Let $u\in U$ be a (usual) point and let $\overline{x}$ be a
geometric point lying over $u$. By
Properties of Spaces, Lemma \ref{spaces-properties-lemma-stalk-quasi-coherent}
we have
$(\varphi^*\mathcal{F})_u \otimes_{\mathcal{O}_{U, u}}
\mathcal{O}_{X, \overline{x}} = \mathcal{F}_{\overline{x}}$.
Since $\mathcal{O}_{U, u} \to \mathcal{O}_{X, \overline{x}}$
is the strict henselization by
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-describe-etale-local-ring}
we see that it is faithfully flat (see
More on Algebra, Lemma
\ref{more-algebra-lemma-dumb-properties-henselization}).
Thus we see that $(\varphi^*\mathcal{F})_u = 0$ if and only if
$\mathcal{F}_{\overline{x}} = 0$. This proves the lemma.
\end{proof}

\noindent
For finite type quasi-coherent modules the support is closed,
can be checked on fibres, and commutes with base change.

\begin{lemma}
\label{lemma-support-finite-type}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{F}$ be a finite type quasi-coherent $\mathcal{O}_X$-module.
Then
\begin{enumerate}
\item The support of $\mathcal{F}$ is closed.
\item For a geometric point $\overline{x}$ lying over $x \in |X|$ we have
$$
x \in \text{Supp}(\mathcal{F})
\Leftrightarrow
\mathcal{F}_{\overline{x}} \not = 0
\Leftrightarrow
\mathcal{F}_{\overline{x}} \otimes_{\mathcal{O}_{X, \overline{x}}}
\kappa(\overline{x}) \not = 0.
$$
\item For any morphism of algebraic spaces $f : Y \to X$ the pullback
$f^*\mathcal{F}$ is of finite type as well and we have
$\text{Supp}(f^*\mathcal{F}) = f^{-1}(\text{Supp}(\mathcal{F}))$.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a scheme $U$ and a surjective \'etale morphism $\varphi : U \to X$.
By Lemma \ref{lemma-support-covering} the inverse image of the support of
$\mathcal{F}$ is the support of $\varphi^*\mathcal{F}$ which is closed by
Morphisms, Lemma \ref{morphisms-lemma-support-finite-type}.
Thus (1) follows from the definition of the topology on $|X|$.

\medskip\noindent
The first equivalence in (2) is the definition of support.
The second equivalence follows from Nakayama's lemma, see
Algebra, Lemma \ref{algebra-lemma-NAK}.

\medskip\noindent
Let $f : Y \to X$ be as in (3). Note that $f^*\mathcal{F}$ is of finite type
by Properties of Spaces, Section
\ref{spaces-properties-section-properties-modules}.
For the final assertion, let $\overline{y}$ be a geometric point of $Y$
mapping to the geometric point $\overline{x}$ on $X$. Recall that
$$
(f^*\mathcal{F})_{\overline{y}} =
\mathcal{F}_{\overline{x}} \otimes_{\mathcal{O}_{X, \overline{x}}}
\mathcal{O}_{Y, \overline{y}},
$$
see Properties of Spaces, Lemma
\ref{spaces-properties-lemma-stalk-pullback-quasi-coherent}.
Hence $(f^*\mathcal{F})_{\overline{y}} \otimes \kappa(\overline{y})$
is nonzero if and only if
$\mathcal{F}_{\overline{x}} \otimes \kappa(\overline{x})$ is nonzero.
By (2) this implies $x \in \text{Supp}(\mathcal{F})$ if and only
if $y \in \text{Supp}(f^*\mathcal{F})$, which is the content of
assertion (3).
\end{proof}

\noindent
Our next task is to show that the scheme theoretic support
of a finite type quasi-coherent module (see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-support})
also makes sense for finite type quasi-coherent modules on
algebraic spaces.

\begin{lemma}
\label{lemma-scheme-theoretic-support}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{F}$ be a finite type quasi-coherent $\mathcal{O}_X$-module.
There exists a smallest closed subspace $i : Z \to X$ such that there
exists a quasi-coherent $\mathcal{O}_Z$-module $\mathcal{G}$ with
$i_*\mathcal{G} \cong \mathcal{F}$. Moreover:
\begin{enumerate}
\item If $U$ is a scheme and $\varphi : U \to X$ is an \'etale morphism
then $Z \times_X U$ is the scheme theoretic support of $\varphi^*\mathcal{F}$.
\item The quasi-coherent sheaf $\mathcal{G}$ is unique up to unique
isomorphism.
\item The quasi-coherent sheaf $\mathcal{G}$ is of finite type.
\item The support of $\mathcal{G}$ and of $\mathcal{F}$ is $|Z|$.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a scheme $U$ and a surjective \'etale morphism $\varphi : U \to X$.
Let $R = U \times_X U$ with projections $s, t : R \to U$.
Let $i' : Z' \to U$ be the scheme theoretic support of $\varphi^*\mathcal{F}$
and let $\mathcal{G}'$ be the (unique up to unique isomorphism)
finite type quasi-coherent $\mathcal{O}_{Z'}$-module
with $i'_*\mathcal{G}' = \varphi^*\mathcal{F}$, see
Morphisms, Lemma \ref{morphisms-lemma-scheme-theoretic-support}.
As $s^*\varphi^*\mathcal{F} = t^*\varphi^*\mathcal{F}$ we see that
$R' = s^{-1}Z' = t^{-1}Z'$ as closed subschemes of $R$ by
Morphisms, Lemma \ref{morphisms-lemma-flat-pullback-support}.
Thus we may apply Properties of Spaces, Lemma
\ref{spaces-properties-lemma-subspaces-presentation}
to find a closed subspace $i : Z \to X$ whose pullback to $U$ is $Z'$.
Writing $s', t' : R' \to Z'$ the projections and
$j' : R' \to R$ the given closed immersion, we see that
$$
j'_* (s')^*\mathcal{G}' = s^* i'_*\mathcal{G}' =
s^*\varphi^*\mathcal{F} = t^*\varphi^*\mathcal{F} =
t^*i'_*\mathcal{G}' = j'_*(t')^*\mathcal{G}'
$$
(the first and the last equality by Cohomology of Schemes,
Lemma \ref{coherent-lemma-flat-base-change-cohomology}).
Hence the uniqueness of
Morphisms, Lemma \ref{morphisms-lemma-flat-pullback-support}
applied to $R' \to R$ gives an isomorphism
$\alpha : (t')^*\mathcal{G}' \to (s')^*\mathcal{G}'$
compatible with the canonical isomorphism
$t^*\varphi^*\mathcal{F} = s^*\varphi^*\mathcal{F}$
via $j'_*$. Clearly $\alpha$ satisfies the cocycle condition, hence
we may apply
Properties of Spaces, Proposition
\ref{spaces-properties-proposition-quasi-coherent}
to obtain a quasi-coherent module $\mathcal{G}$ on $Z$ whose restriction
to $Z'$ is $\mathcal{G}'$ compatible with $\alpha$.
Again using the equivalence of the proposition mentioned above
(this time for $X$) we conclude that $i_*\mathcal{G} \cong \mathcal{F}$.

\medskip\noindent
This proves existence. The other properties of the lemma follow
by comparing with the result for schemes using
Lemma \ref{lemma-support-covering}.
Detailed proofs omitted.
\end{proof}

\begin{definition}
\label{definition-scheme-theoretic-support}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{F}$ be a finite type quasi-coherent $\mathcal{O}_X$-module.
The {\it scheme theoretic support of $\mathcal{F}$} is the closed subspace
$Z \subset X$ constructed in Lemma \ref{lemma-scheme-theoretic-support}.
\end{definition}

\noindent
In this situation we often think of $\mathcal{F}$ as a quasi-coherent
sheaf of finite type on $Z$ (via the equivalence of categories of
Lemma \ref{lemma-i-star-equivalence}).






\section{Scheme theoretic image}
\label{section-scheme-theoretic-image}

\noindent
Caution: Some of the material in this section is ultra-general and
behaves differently from what you might expect.

\begin{lemma}
\label{lemma-scheme-theoretic-image}
\begin{slogan}
The scheme-theoretic image of a morphism of algebraic spaces exists.
\end{slogan}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. There exists a closed subspace $Z \subset Y$ such that $f$ factors
through $Z$ and such that for any other closed subspace $Z' \subset Y$
such that $f$ factors through $Z'$ we have $Z \subset Z'$.
\end{lemma}

\begin{proof}
Let $\mathcal{I} = \Ker(\mathcal{O}_Y \to f_*\mathcal{O}_X)$.
If $\mathcal{I}$ is quasi-coherent then we just take $Z$ to be the
closed subscheme determined by $\mathcal{I}$, see
Lemma \ref{lemma-closed-immersion-ideals}.
In general the lemma requires us to show that there exists
a largest quasi-coherent sheaf of ideals $\mathcal{I}'$ contained in
$\mathcal{I}$.
This follows from Lemma \ref{lemma-largest-quasi-coherent-subsheaf}.
\end{proof}

\noindent
Suppose that in the situation of Lemma \ref{lemma-scheme-theoretic-image}
above $X$ and $Y$ are representable. Then the closed subspace $Z \subset Y$
found in the lemma agrees with the closed subscheme $Z \subset Y$ found in
Morphisms, Lemma \ref{morphisms-lemma-scheme-theoretic-image}.
The reason is that closed subspaces (or subschemes) are in a inclusion
reversing correspondence with quasi-coherent ideal sheaves on
$X_\etale$ and $X$. As the category of quasi-coherent modules
on $X_\etale$ and $X$ are the same
(Properties of Spaces, Section \ref{spaces-properties-section-quasi-coherent})
we conclude. Thus the following definition agrees with the earlier
definition for morphisms of schemes.

\begin{definition}
\label{definition-scheme-theoretic-image}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. The {\it scheme theoretic image} of $f$ is the smallest closed
subspace $Z \subset Y$ through which $f$
factors, see Lemma \ref{lemma-scheme-theoretic-image} above.
\end{definition}

\noindent
We often just denote $f : X \to Z$ the factorization of $f$.
If the morphism $f$ is not quasi-compact, then (in general) the
construction of the scheme theoretic image does not commute with
restriction to open subspaces of $Y$.

\begin{lemma}
\label{lemma-quasi-compact-scheme-theoretic-image}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $Z \subset Y$ be the scheme theoretic image of $f$.
If $f$ is quasi-compact then
\begin{enumerate}
\item the sheaf of ideals
$\mathcal{I} = \Ker(\mathcal{O}_Y \to f_*\mathcal{O}_X)$
is quasi-coherent,
\item the scheme theoretic image $Z$ is the closed subspace
corresponding to $\mathcal{I}$,
\item for any \'etale morphism $V \to Y$ the scheme theoretic image of
$X \times_Y V \to V$ is equal to $Z \times_Y V$, and
\item the image $|f|(|X|) \subset |Z|$ is a dense subset of $|Z|$.
\end{enumerate}
\end{lemma}

\begin{proof}
To prove (3) it suffices to prove (1) and (2) since the
formation of $\mathcal{I}$ commutes with \'etale localization.
If (1) holds then in the proof of Lemma \ref{lemma-scheme-theoretic-image}
we showed (2). Let us prove that $\mathcal{I}$ is quasi-coherent.
Since the property of being quasi-coherent is \'etale local we may
assume $Y$ is an affine scheme. As $f$ is quasi-compact,
we can find an affine scheme $U$ and a surjective \'etale morphism
$U \to X$. Denote $f'$ the composition $U \to X \to Y$.
Then $f_*\mathcal{O}_X$ is a subsheaf of $f'_*\mathcal{O}_U$,
and hence $\mathcal{I} = \Ker(\mathcal{O}_Y \to \mathcal{O}_{X'})$.
By Lemma \ref{lemma-pushforward}
the sheaf $f'_*\mathcal{O}_U$ is quasi-coherent on $Y$. Hence $\mathcal{I}$
is quasi-coherent as a kernel of a map between coherent modules.
Finally, part (4) follows from parts (1), (2), and (3) as the ideal
$\mathcal{I}$ will be the unit ideal in any point of $|Y|$ which is
not contained in the closure of $|f|(|X|)$.
\end{proof}

\begin{lemma}
\label{lemma-scheme-theoretic-image-reduced}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. Assume $X$ is reduced. Then
\begin{enumerate}
\item the scheme theoretic image $Z$ of $f$ is the reduced induced algebraic
space structure on $\overline{|f|(|X|)}$, and
\item for any \'etale morphism $V \to Y$ the scheme theoretic image of
$X \times_Y V \to V$ is equal to $Z \times_Y V$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) is true because the reduced induced algebraic space structure on
$\overline{|f|(|X|)}$ is the smallest closed subspace
of $Y$ through which $f$ factors, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-map-into-reduction}.
Part (2) follows from (1), the fact that $|V| \to |Y|$ is open, and the
fact that being reduced is preserved under \'etale localization.
\end{proof}

\begin{lemma}
\label{lemma-reach-points-scheme-theoretic-image}
Let $S$ be a scheme.
Let $f : X \to Y$ be a quasi-compact morphism of algebraic spaces over $S$.
Let $Z$ be the scheme theoretic image of $f$.
Let $z \in |Z|$. There exists a valuation ring $A$ with
fraction field $K$ and a commutative diagram
$$
\xymatrix{
\Spec(K) \ar[rr] \ar[d] & & X \ar[d] \ar[ld] \\
\Spec(A) \ar[r] & Z \ar[r] & Y
}
$$
such that the closed point of $\Spec(A)$ maps to $z$.
\end{lemma}

\begin{proof}
Choose an affine scheme $V$ with a point $z' \in V$
and an \'etale morphism $V \to Y$ mapping $z'$ to $z$.
Let $Z' \subset V$ be the scheme theoretic image of $X \times_Y V \to V$.
By Lemma \ref{lemma-quasi-compact-scheme-theoretic-image} we have
$Z' = Z \times_Y V$. Thus $z' \in Z'$.
Since $f$ is quasi-compact and $V$ is affine we see that
$X \times_Y V$ is quasi-compact. Hence
there exists an affine scheme $W$ and a surjective \'etale
morphism $W \to X \times_Y V$. Then $Z' \subset V$ is also the
scheme theoretic image of $W \to V$.
By Morphisms, Lemma \ref{morphisms-lemma-reach-points-scheme-theoretic-image}
we can choose a diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] &
W \ar[r] \ar[d] &
X \times_Y V \ar[d] \ar[r] &
X \ar[d] \\
\Spec(A) \ar[r] &
Z' \ar[r] &
V \ar[r] &
Y
}
$$
such that the closed point of $\Spec(A)$ maps to $z'$.
Composing with $Z' \to Z$ and $W \to X \times_Y V \to X$
we obtain a solution.
\end{proof}

\begin{lemma}
\label{lemma-factor-factor}
Let $S$ be a scheme. Let
$$
\xymatrix{
X_1 \ar[d] \ar[r]_{f_1} & Y_1 \ar[d] \\
X_2 \ar[r]^{f_2} & Y_2
}
$$
be a commutative diagram of algebraic spaces over $S$.
Let $Z_i \subset Y_i$, $i = 1, 2$ be
the scheme theoretic image of $f_i$. Then the morphism
$Y_1 \to Y_2$ induces a morphism $Z_1 \to Z_2$ and a
commutative diagram
$$
\xymatrix{
X_1 \ar[r] \ar[d] & Z_1 \ar[d] \ar[r] & Y_1 \ar[d] \\
X_2 \ar[r] & Z_2 \ar[r] & Y_2
}
$$
\end{lemma}

\begin{proof}
The scheme theoretic inverse image of $Z_2$ in $Y_1$
is a closed subspace of $Y_1$ through
which $f_1$ factors. Hence $Z_1$ is contained in this.
This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-scheme-theoretic-image-of-partial-section}
Let $S$ be a scheme.
Let $f : X \to Y$ be a separated morphism of algebraic spaces over $S$.
Let $V \subset Y$ be an open subspace such that $V \to Y$ is quasi-compact.
Let $s : V \to X$ be a morphism such that $f \circ s = \text{id}_V$.
Let $Y'$ be the scheme theoretic image of $s$.
Then $Y' \to Y$ is an isomorphism over $V$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-quasi-compact-permanence}
the morphism $s : V \to X$ is quasi-compact.
Hence the construction of the scheme theoretic image $Y'$
of $s$ commutes with restriction to opens by
Lemma \ref{lemma-quasi-compact-scheme-theoretic-image}.
In particular, we see that $Y' \cap f^{-1}(V)$ is the
scheme theoretic image of a section of the separated
morphism $f^{-1}(V) \to V$. Since a section of a separated
morphism is a closed immersion
(Lemma \ref{lemma-section-immersion}),
we conclude that
$Y' \cap f^{-1}(V) \to V$ is an isomorphism as desired.
\end{proof}








\section{Scheme theoretic closure and density}
\label{section-scheme-theoretic-closure}

\noindent
This section is the analogue of
Morphisms, Section \ref{morphisms-section-scheme-theoretic-closure}.

\begin{lemma}
\label{lemma-scheme-theoretically-dense-representable}
Let $S$ be a scheme. Let $W \subset S$ be a scheme theoretically
dense open subscheme
(Morphisms, Definition \ref{morphisms-definition-scheme-theoretically-dense}).
Let $f : X \to S$ be a morphism of schemes which is flat, locally of
finite presentation, and locally quasi-finite.
Then $f^{-1}(W)$ is scheme theoretically dense in $X$.
\end{lemma}

\begin{proof}
We will use the characterization of Morphisms, Lemma
\ref{morphisms-lemma-characterize-scheme-theoretically-dense}.
Assume $V \subset X$ is an open and $g \in \Gamma(V, \mathcal{O}_V)$
is a function which restricts to zero on $f^{-1}(W) \cap V$.
We have to show that $g = 0$. Assume $g \not = 0$ to get a
contradiction. By
More on Morphisms, Lemma \ref{more-morphisms-lemma-go-down-with-annihilators}
we may shrink $V$, find an open $U \subset S$ fitting into a
commutative diagram
$$
\xymatrix{
V \ar[r] \ar[d]_\pi & X \ar[d]^f \\
U \ar[r] & S,
}
$$
a quasi-coherent subsheaf $\mathcal{F} \subset \mathcal{O}_U$, an integer
$r > 0$, and an injective $\mathcal{O}_U$-module map
$\mathcal{F}^{\oplus r} \to \pi_*\mathcal{O}_V$
whose image contains $g|_V$. Say
$(g_1, \ldots, g_r) \in \Gamma(U, \mathcal{F}^{\oplus r})$ maps to $g$.
Then we see that $g_i|_{W \cap U} = 0$ because $g|_{f^{-1}W \cap V} = 0$.
Hence $g_i = 0$ because $\mathcal{F} \subset \mathcal{O}_U$ and
$W$ is scheme theoretically dense in $S$.
This implies $g = 0$ which is the desired contradiction.
\end{proof}

\begin{lemma}
\label{lemma-scheme-theoretically-dense}
Let $S$ be a scheme.
Let $X$ be an algebraic space over $S$.
Let $U \subset X$ be an open subspace.
The following are equivalent
\begin{enumerate}
\item for every \'etale morphism $\varphi : V \to X$ (of algebraic spaces)
the scheme theoretic closure of $\varphi^{-1}(U)$ in $V$ is equal to $V$,
\item there exists a scheme $V$ and a surjective \'etale morphism
$\varphi : V \to X$ such that the scheme theoretic closure of
$\varphi^{-1}(U)$ in $V$ is equal to $V$,
\end{enumerate}
\end{lemma}

\begin{proof}
Observe that if $V \to V'$ is a morphism of algebraic spaces \'etale
over $X$, and $Z \subset V$, resp.\ $Z' \subset V'$ is the scheme theoretic
closure of $U \times_X V$, resp.\ $U \times_X V'$ in $V$, resp.\ $V'$,
then $Z$ maps into $Z'$. Thus if $V \to V'$ is surjective and \'etale
then $Z = V$ implies $Z' = V'$. Next, note that an \'etale morphism is
flat, locally of finite presentation, and locally quasi-finite
(see Morphisms, Section \ref{morphisms-section-etale}).
Thus Lemma \ref{lemma-scheme-theoretically-dense-representable}
implies that if $V$ and $V'$ are schemes, then $Z' = V'$ implies
$Z = V$. A formal argument using that every algebraic space has an
\'etale covering by a scheme shows that (1) and (2) are equivalent.
\end{proof}

\noindent
It follows from
Lemma \ref{lemma-scheme-theoretically-dense}
that the following definition is compatible with the definition
in the case of schemes.

\begin{definition}
\label{definition-scheme-theoretically-dense}
Let $S$ be a scheme.
Let $X$ be an algebraic space over $S$.
Let $U \subset X$ be an open subspace.
\begin{enumerate}
\item The scheme theoretic image of the morphism $U \to X$
is called the {\it scheme theoretic closure of $U$ in $X$}.
\item We say $U$ is {\it scheme theoretically dense in $X$}
if the equivalent conditions of
Lemma \ref{lemma-scheme-theoretically-dense} are satisfied.
\end{enumerate}
\end{definition}

\noindent
With this definition it is {\bf not} the case that $U$ is scheme
theoretically dense in $X$ if and only if the scheme theoretic closure
of $U$ is $X$. This is somewhat inelegant. But with suitable
finiteness conditions we will see that it does hold.

\begin{lemma}
\label{lemma-scheme-theoretically-dense-quasi-compact}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $U \subset X$ be an open subspace.
If $U \to X$ is quasi-compact, then $U$
is scheme theoretically dense in $X$ if and only if the scheme theoretic
closure of $U$ in $X$ is $X$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-quasi-compact-scheme-theoretic-image} part (3).
\end{proof}

\begin{lemma}
\label{lemma-characterize-scheme-theoretically-dense}
Let $S$ be a scheme.
Let $j : U \to X$ be an open immersion of algebraic spaces over $S$.
Then $U$ is scheme theoretically dense in $X$ if and only if
$\mathcal{O}_X \to j_*\mathcal{O}_U$ is injective.
\end{lemma}

\begin{proof}
If $\mathcal{O}_X \to j_*\mathcal{O}_U$ is injective,
then the same is true when restricted to any
algebraic space $V$ \'etale over $X$.
Hence the scheme theoretic closure of $U \times_X V$ in $V$
is equal to $V$, see proof of
Lemma \ref{lemma-scheme-theoretic-image}.
Conversely, assume the scheme theoretic
closure of $U \times_X V$ is equal to $V$ for all $V$ \'etale over $X$.
Suppose that $\mathcal{O}_X \to j_*\mathcal{O}_U$ is not injective.
Then we can find an affine, say $V = \Spec(A)$, \'etale over $X$
and a nonzero element $f \in A$ such that $f$ maps to zero in
$\Gamma(V \times_X U, \mathcal{O})$. In this case the scheme theoretic
closure of $V \times_X U$ in $V$ is clearly contained in $\Spec(A/(f))$
a contradiction.
\end{proof}

\begin{lemma}
\label{lemma-intersection-scheme-theoretically-dense}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
If $U$, $V$ are scheme theoretically dense
open subspaces of $X$, then so is $U \cap V$.
\end{lemma}

\begin{proof}
Let $W \to X$ be any \'etale morphism. Consider the map
$\mathcal{O}(W) \to \mathcal{O}(W \times_X V)
\to \mathcal{O}(W \times_X (V \cap U))$.
By Lemma \ref{lemma-characterize-scheme-theoretically-dense}
both maps are injective. Hence the composite is injective.
Hence by Lemma \ref{lemma-characterize-scheme-theoretically-dense}
$U \cap V$ is scheme theoretically dense in $X$.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact-immersion}
Let $S$ be a scheme. Let $h : Z \to X$ be an immersion of algebraic spaces
over $S$. Assume either $Z \to X$ is quasi-compact or $Z$ is reduced.
Let $\overline{Z} \subset X$ be the scheme theoretic image of $h$.
Then the morphism $Z \to \overline{Z}$ is an open immersion
which identifies $Z$ with a scheme theoretically dense open
subspace of $\overline{Z}$. Moreover, $Z$ is topologically
dense in $\overline{Z}$.
\end{lemma}

\begin{proof}
In both cases the formation of $\overline{Z}$ commutes with
\'etale localization, see
Lemmas \ref{lemma-quasi-compact-scheme-theoretic-image} and
\ref{lemma-scheme-theoretic-image-reduced}.
Hence this lemma follows from the case of schemes, see
Morphisms, Lemma \ref{morphisms-lemma-quasi-compact-immersion}.
\end{proof}

\begin{lemma}
\label{lemma-equality-of-morphisms}
Let $S$ be a scheme. Let $B$ be an algebraic space over $S$.
Let $f, g : X \to Y$ be morphisms of algebraic spaces over $B$.
Let $U \subset X$ be an open subspace such that
$f|_U = g|_U$. If the scheme theoretic closure of $U$
in $X$ is $X$ and $Y \to B$ is separated, then $f = g$.
\end{lemma}

\begin{proof}
As $Y \to B$ is separated the fibre product
$Y \times_{\Delta, Y \times_B Y, (f, g)} X$ is a closed subspace $Z \subset X$. 
As $f|_U = g|_U$ we see that $U \subset Z$. Hence $Z = X$ as $U$ is assumed
scheme theoretically dense in $X$.
\end{proof}






\section{Dominant morphisms}
\label{section-dominant}

\noindent
We copy the definition of a dominant morphism of schemes to get the
notion of a dominant morphism of algebraic spaces. We caution the
reader that this definition is not well behaved unless the morphism
is quasi-compact and the algebraic spaces satisfy some separation
axioms.

\begin{definition}
\label{definition-dominant}
Let $S$ be a scheme. A morphism $f : X \to Y$ of algebraic spaces over $S$ is
called {\it dominant} if the image of $|f| : |X| \to |Y|$ is dense in $|Y|$.
\end{definition}






\section{Universally injective morphisms}
\label{section-universally-injective}

\noindent
We have already defined in Section \ref{section-representable}
what it means for a representable morphism of algebraic spaces
to be universally injective. For a field $K$ over $S$ (recall this means that
we are given a structure morphism $\Spec(K) \to S$) and an
algebraic space $X$ over $S$ we write
$X(K) = \Mor_S(\Spec(K), X)$. We first translate the
condition for representable morphisms into a condition on the functor
of points.

\begin{lemma}
\label{lemma-universally-injective-representable}
Let $S$ be a scheme. Let $f : X \to Y$ be a representable
morphism of algebraic spaces over $S$. Then $f$ is universally injective
(in the sense of Section \ref{section-representable})
if and only if for all fields $K$ the map $X(K) \to Y(K)$ is injective.
\end{lemma}

\begin{proof}
We are going to use
Morphisms, Lemma \ref{morphisms-lemma-universally-injective}
without further mention.
Suppose that $f$ is universally injective. Then for any field $K$ and any
morphism $\Spec(K) \to Y$ the morphism of schemes
$\Spec(K) \times_Y X \to \Spec(K)$ is universally injective.
Hence there exists at most one section of the morphism
$\Spec(K) \times_Y X \to \Spec(K)$. Hence the map
$X(K) \to Y(K)$ is injective. Conversely, suppose that for every field $K$
the map $X(K) \to Y(K)$ is injective. Let $T \to Y$ be a morphism from a
scheme into $Y$, and consider the base change $f_T : T \times_Y X \to T$.
For any field $K$ we have
$$
(T \times_Y X)(K) = T(K) \times_{Y(K)} X(K)
$$
by definition of the fibre product, and hence the injectivity of
$X(K) \to Y(K)$ guarantees the injectivity of
$(T \times_Y X)(K) \to T(K)$ which means that $f_T$ is universally injective
as desired.
\end{proof}

\noindent
Next, we translate the property that the transformation between field valued
points is injective into something more geometric.

\begin{lemma}
\label{lemma-universally-injective}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item the map $X(K) \to Y(K)$ is injective for every field $K$ over $S$
\item for every morphism $Y' \to Y$ of algebraic spaces over $S$
the induced map $|Y' \times_Y X| \to |Y'|$ is injective, and
\item the diagonal morphism $X \to X \times_Y X$ is surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1). Let $g : Y' \to Y$ be a morphism of algebraic
spaces, and denote $f' : Y' \times_Y X \to Y'$ the base change of $f$.
Let $K_i$, $i = 1, 2$ be fields and let
$\varphi_i : \Spec(K_i) \to Y' \times_Y X$ be morphisms
such that $f' \circ \varphi_1$ and $f' \circ \varphi_2$ define the
same element of $|Y'|$. By definition this means there exists a
field $\Omega$ and embeddings $\alpha_i : K_i \subset \Omega$ such that
the two morphisms
$f' \circ \varphi_i \circ \alpha_i : \Spec(\Omega) \to Y'$ are equal.
Here is the corresponding commutative diagram
$$
\xymatrix{
\Spec(\Omega) \ar@/_5ex/[ddrr] \ar[rd]^{\alpha_1} \ar[r]_{\alpha_2} &
\Spec(K_2) \ar[rd]^{\varphi_2} \\
& \Spec(K_1) \ar[r]^{\varphi_1} &
Y' \times_Y X  \ar[d]^{f'} \ar[r]^{g'} &
 X \ar[d]^f \\
& & Y' \ar[r]^g & Y.
}
$$
In particular the compositions $g \circ f' \circ \varphi_i \circ \alpha_i$
are equal. By assumption (1) this implies that the morphism
$g' \circ \varphi_i \circ \alpha_i$ are equal, where $g' : Y' \times_Y X \to X$
is the projection. By the universal property of the fibre product we conclude
that the morphisms
$\varphi_i \circ \alpha_i : \Spec(\Omega) \to Y' \times_Y X$ are
equal. In other words $\varphi_1$ and $\varphi_2$ define the same point
of $Y' \times_Y X$. We conclude that (2) holds.

\medskip\noindent
Assume (2). Let $K$ be a field over $S$, and let $a, b : \Spec(K) \to X$
be two morphisms such that $f \circ a = f \circ b$. Denote
$c : \Spec(K) \to Y$ the common value. By assumption
$|\Spec(K) \times_{c, Y} X| \to |\Spec(K)|$ is injective.
This means there exists a field $\Omega$ and embeddings
$\alpha_i : K \to \Omega$ such that
$$
\xymatrix{
\Spec(\Omega) \ar[r]_{\alpha_1} \ar[d]_{\alpha_2} &
\Spec(K) \ar[d]^a \\
\Spec(K) \ar[r]^-b &
\Spec(K) \times_{c, Y} X
}
$$
is commutative. Composing with the projection to $\Spec(K)$
we see that $\alpha_1 = \alpha_2$. Denote the common value $\alpha$.
Then we see that $\{\alpha : \Spec(\Omega) \to \Spec(K)\}$
is a fpqc covering of $\Spec(K)$ such that the two morphisms
$a, b$ become equal on the members of the covering. By
Properties of Spaces, Proposition
\ref{spaces-properties-proposition-sheaf-fpqc}
we conclude that $a = b$. We conclude that (1) holds.

\medskip\noindent
Assume (3). Let $x, x' \in |X|$ be a pair of points such that
$f(x) = f(x')$ in $|Y|$. By
Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-cartesian}
we see there exists a $x'' \in |X \times_Y X|$ whose projections
are $x$ and $x'$. By assumption and
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-characterize-surjective}
there exists a $x''' \in |X|$ with $\Delta_{X/Y}(x''') = x''$.
Thus $x = x'$. In other words $f$ is injective.
Since condition (3) is stable under base change we see that $f$
satisfies (2).

\medskip\noindent
Assume (2). Then in particular $|X \times_Y X| \to |X|$ is injective
which implies immediately that
$|\Delta_{X/Y}| : |X| \to |X \times_Y X|$ is surjective, which
implies that $\Delta_{X/Y}$ is surjective by
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-characterize-surjective}.
\end{proof}

\noindent
By the two lemmas above the following definition does not conflict with
the already defined notion of a universally injective representable morphism
of algebraic spaces.

\begin{definition}
\label{definition-universally-injective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic
spaces over $S$. We say $f$ is {\it universally injective} if
for every morphism $Y' \to Y$ the induced map
$|Y' \times_Y X| \to |Y'|$ is injective.
\end{definition}

\noindent
To be sure this means that any or all of the equivalent conditions of
Lemma \ref{lemma-universally-injective}
hold.

\begin{remark}
\label{remark-universally-injective-not-separated}
A universally injective morphism of schemes is separated, see
Morphisms, Lemma
\ref{morphisms-lemma-universally-injective-separated}.
This is not the case for morphisms of algebraic spaces.
Namely, the algebraic space
$X = \mathbf{A}^1_k/\{x \sim -x \mid x \not = 0\}$
constructed in
Spaces, Example \ref{spaces-example-affine-line-involution}
comes equipped with a morphism $X \to \mathbf{A}^1_k$ which maps
the point with coordinate $x$ to the point with coordinate $x^2$.
This is an isomorphism away from $0$, and there is a unique point
of $X$ lying above $0$. As $X$ isn't separated this is a universally
injective morphism of algebraic spaces which is not separated.
\end{remark}

\begin{lemma}
\label{lemma-base-change-universally-injective}
The base change of a universally injective morphism is universally injective.
\end{lemma}

\begin{proof}
Omitted. Hint: This is formal.
\end{proof}

\begin{lemma}
\label{lemma-universally-injective-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is universally injective,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is universally injective,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is universally injective,
\item there exists a scheme $Z$ and a surjective morphism
$Z \to Y$ such that $Z \times_Y X \to Z$ is universally injective, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that
each of the morphisms $f^{-1}(Y_i) \to Y_i$ is universally injective.
\end{enumerate}
\end{lemma}

\begin{proof}
We will use that being universally injective is preserved under base change
(Lemma \ref{lemma-base-change-universally-injective})
without further mention in this proof.
It is clear that (1) $\Rightarrow$ (2) $\Rightarrow$ (3)
$\Rightarrow$ (4).

\medskip\noindent
Assume $g : Z \to Y$ as in (4). Let $y : \Spec(K) \to Y$ be a
morphism from the spectrum of a field into $Y$. By assumption we
can find an extension field $\alpha : K \subset K'$ and a morphism
$z : \Spec(K') \to Z$ such that $y \circ \alpha = g \circ z$
(with obvious abuse of notation). By assumption the
morphism $Z \times_Y X \to Z$ is universally injective, hence there
is at most one
lift of $g \circ z : \Spec(K') \to Y$ to a morphism into $X$.
Since $\{\alpha : \Spec(K') \to \Spec(K)\}$ is a
fpqc covering this implies there is at most one lift of
$y : \Spec(K) \to Y$ to a morphism into $X$, see
Properties of Spaces, Proposition
\ref{spaces-properties-proposition-sheaf-fpqc}.
Thus we see that (1) holds.

\medskip\noindent
We omit the verification that (5) is equivalent to (1).
\end{proof}

\begin{lemma}
\label{lemma-composition-universally-injective}
A composition of universally injective morphisms is universally injective.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}











\section{Affine morphisms}
\label{section-affine}

\noindent
We have already defined in Section \ref{section-representable}
what it means for a representable morphism of algebraic spaces
to be affine.

\begin{lemma}
\label{lemma-affine-representable}
Let $S$ be a scheme. Let $f : X \to Y$ be a representable morphism
of algebraic spaces over $S$. Then
$f$ is affine (in the sense of Section \ref{section-representable})
if and only if for all affine schemes $Z$
and morphisms $Z \to Y$ the scheme $X \times_Y Z$ is affine.
\end{lemma}

\begin{proof}
This follows directly from the definition of an affine morphism of schemes
(Morphisms, Definition \ref{morphisms-definition-affine}).
\end{proof}

\noindent
This clears the way for the following definition.

\begin{definition}
\label{definition-affine}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
We say $f$ is {\it affine} if for every affine scheme $Z$ and
morphism $Z \to Y$ the algebraic space $X \times_Y Z$ is representable
by an affine scheme.
\end{definition}

\begin{lemma}
\label{lemma-affine-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is representable and affine,
\item $f$ is affine,
\item for every affine scheme $V$ and \'etale morphism $V \to Y$
the scheme $X \times_Y V$ is affine,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is affine, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such
that each of the morphisms $f^{-1}(Y_i) \to Y_i$ is affine.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (1) implies (2), that (2) implies (3), and that
(3) implies (4) by taking $V$ to be a disjoint union of affines
\'etale over $Y$, see Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}.
Assume $V \to Y$ is as in (4). Then for every affine open $W$ of $V$ we see
that $W \times_Y X$ is an affine open of $V \times_Y X$. Hence by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-subscheme}
we conclude that $V \times_Y X$ is a scheme. Moreover the morphism
$V \times_Y X \to V$ is affine. This means we can apply
Spaces,
Lemma \ref{spaces-lemma-morphism-sheaves-with-P-effective-descent-etale}
because the class of affine morphisms satisfies all the required
properties (see
Morphisms, Lemmas \ref{morphisms-lemma-base-change-affine} and
Descent, Lemmas \ref{descent-lemma-descending-property-affine}
and \ref{descent-lemma-affine}). The conclusion of applying this lemma
is that $f$ is representable and affine, i.e., (1) holds.

\medskip\noindent
The equivalence of (1) and (5) follows from the fact that being
affine is Zariski local on the target (the reference above shows
that being affine is in fact fpqc local on the target).
\end{proof}

\begin{lemma}
\label{lemma-composition-affine}
The composition of affine morphisms is affine.
\end{lemma}

\begin{proof}
Omitted. Hint: Transitivity of fibre products.
\end{proof}

\begin{lemma}
\label{lemma-base-change-affine}
The base change of an affine morphism is affine.
\end{lemma}

\begin{proof}
Omitted. Hint: Transitivity of fibre products.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-affine}
A closed immersion is affine.
\end{lemma}

\begin{proof}
Follows immediately from the corresponding statement for morphisms of
schemes, see Morphisms, Lemma \ref{morphisms-lemma-closed-immersion-affine}.
\end{proof}

\begin{lemma}
\label{lemma-affine-equivalence-algebras}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
There is an anti-equivalence of categories
$$
\begin{matrix}
\text{algebraic spaces} \\
\text{affine over }X
\end{matrix}
\longleftrightarrow
\begin{matrix}
\text{quasi-coherent sheaves} \\
\text{of }\mathcal{O}_X\text{-algebras}
\end{matrix}
$$
which associates to $f : Y \to X$ the sheaf $f_*\mathcal{O}_Y$.
Moreover, this equivalence is compatible with arbitrary base change.
\end{lemma}

\begin{proof}
This lemma is the analogue of Morphisms, Lemma
\ref{morphisms-lemma-affine-equivalence-algebras}.
Let $\mathcal{A}$ be a quasi-coherent sheaf of $\mathcal{O}_X$-algebras.
We will construct an affine morphism of algebraic spaces
$\pi : Y = \underline{\Spec}_X(\mathcal{A}) \to X$ with
$\pi_*\mathcal{O}_Y \cong \mathcal{A}$. To do this, choose a scheme
$U$ and a surjective \'etale morphism $\varphi : U \to X$. As usual
denote $R = U \times_X U$ with projections $s, t : R \to U$. Denote
$\psi : R \to X$ the composition $\psi = \varphi \circ s = \varphi \circ t$.
By the aforementioned lemma there exists an affine morphisms of schemes
$\pi_0 : V \to U$ and $\pi_1 : W \to R$ with
$\pi_{0, *}\mathcal{O}_V \cong \varphi^*\mathcal{A}$ and
$\pi_{1, *}\mathcal{O}_W \cong \psi^*\mathcal{A}$.
Since the construction is compatible with base change there exist
morphisms $s', t' : W \to V$ such that the diagrams
$$
\vcenter{
\xymatrix{
W \ar[r]_{s'} \ar[d] & V \ar[d] \\
R \ar[r]^s & U
}
}
\quad\text{and}\quad
\vcenter{
\xymatrix{
W \ar[r]_{t'} \ar[d] & V \ar[d] \\
R \ar[r]^t & U
}
}
$$
are cartesian. It follows that $s', t'$ are \'etale. It is a formal
consequence of the above that $(t', s') : W \to V \times_S V$ is a
monomorphism. We omit the verification that $W \to V \times_S V$ is an
equivalence relation (hint: think about the pullback of $\mathcal{A}$
to $U \times_X U \times_X U = R \times_{s, U, t} R$).
The quotient sheaf $Y = V/W$
is an algebraic space, see
Spaces, Theorem \ref{spaces-theorem-presentation}.
By Groupoids, Lemma \ref{groupoids-lemma-criterion-fibre-product}
we see that $Y \times_X U \cong V$. Hence $Y \to X$ is affine by
Lemma \ref{lemma-affine-local}. Finally, the isomorphism of
$$
(Y \times_X U \to U)_*\mathcal{O}_{Y \times_X U} =
\pi_{0, *}\mathcal{O}_V \cong \varphi^*\mathcal{A}
$$
is compatible with glueing isomorphisms, whence
$(Y \to X)_*\mathcal{O}_Y \cong \mathcal{A}$ by
Properties of Spaces, Proposition
\ref{spaces-properties-proposition-quasi-coherent}.
We omit the verification that this construction is compatible with
base change.
\end{proof}

\begin{definition}
\label{definition-relative-spec}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{A}$ be a quasi-coherent sheaf of
$\mathcal{O}_X$-algebras. The {\it relative spectrum of $\mathcal{A}$ over
$X$}, or simply the {\it spectrum of $\mathcal{A}$ over $X$} is the
affine morphism $\underline{\Spec}(\mathcal{A}) \to X$
corresponding to $\mathcal{A}$ under the equivalence of categories of
Lemma \ref{lemma-affine-equivalence-algebras}.
\end{definition}

\noindent
Forming the relative spectrum commutes with arbitrary base change.

\begin{remark}
\label{remark-factorization-quasi-compact-quasi-separated}
Let $S$ be a scheme. Let $f : Y \to X$ be a quasi-compact and
quasi-separated morphism of algebraic spaces over $S$. Then
$f$ has a canonical factorization
$$
Y \longrightarrow \underline{\Spec}_X(f_*\mathcal{O}_Y) \longrightarrow X
$$
This makes sense because $f_*\mathcal{O}_Y$ is quasi-coherent
by Lemma \ref{lemma-pushforward}. The morphism
$Y \to \underline{\Spec}_X(f_*\mathcal{O}_Y)$ comes from
the canonical $\mathcal{O}_Y$-algebra map
$f^*f_*\mathcal{O}_Y \to \mathcal{O}_Y$ which corresponds to
a canonical morphism
$Y \to Y \times_X \underline{\Spec}_X(f_*\mathcal{O}_Y)$ over $Y$ (see
Lemma \ref{lemma-affine-equivalence-algebras}) whence a factorization
of $f$ as above.
\end{remark}

\begin{lemma}
\label{lemma-affine-equivalence-modules}
Let $S$ be a scheme.
Let $f : Y \to X$ be an affine morphism of algebraic spaces over $S$.
Let $\mathcal{A} = f_*\mathcal{O}_Y$.
The functor $\mathcal{F} \mapsto f_*\mathcal{F}$ induces
an equivalence of categories
$$
\left\{
\begin{matrix}
\text{category of quasi-coherent}\\
\mathcal{O}_Y\text{-modules}
\end{matrix}
\right\}
\longrightarrow
\left\{
\begin{matrix}
\text{category of quasi-coherent}\\
\mathcal{A}\text{-modules}
\end{matrix}
\right\}
$$
Moreover, an $\mathcal{A}$-module is
quasi-coherent as an $\mathcal{O}_X$-module if and only if
it is quasi-coherent as an $\mathcal{A}$-module.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-affine-permanence}
Let $S$ be a scheme. Let $B$ be an algebraic space over $S$.
Suppose $g : X \to Y$ is a morphism of algebraic spaces over $B$.
\begin{enumerate}
\item If $X$ is affine over $B$ and $\Delta : Y \to Y \times_B Y$ is affine,
then $g$ is affine.
\item If $X$ is affine over $B$ and $Y$ is separated over $B$,
then $g$ is affine.
\item A morphism from an affine scheme to an algebraic space with affine
diagonal is affine.
\item A morphism from an affine scheme to a separated algebraic space
is affine.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). The base change $X \times_B Y \to Y$ is affine by
Lemma \ref{lemma-base-change-affine}.
The morphism $(1, g) : X \to X \times_B Y$ is the base change of
$Y \to Y \times_B Y$ by the morphism $X \times_B Y \to Y \times_B Y$.
Hence it is affine by
Lemma \ref{lemma-base-change-affine}.
The composition of affine morphisms is affine
(see Lemma \ref{lemma-composition-affine}) and (1) follows.
Part (2) follows from (1) as a closed immersion is affine
(see Lemma \ref{lemma-closed-immersion-affine}) and $Y/B$ separated
means $\Delta$ is a closed immersion. Parts (3) and (4) are special
cases of (1) and (2).
\end{proof}

\begin{lemma}
\label{lemma-Artinian-affine}
Let $S$ be a scheme. Let $X$ be a quasi-separated algebraic space over $S$.
Let $A$ be an Artinian ring. Any morphism $\Spec(A) \to X$ is affine.
\end{lemma}

\begin{proof}
Let $U \to X$ be an \'etale morphism with $U$ affine. To prove the
lemma we have to show that $\Spec(A) \times_X U$ is affine, see
Lemma \ref{lemma-affine-local}. Since $X$ is quasi-separated the
scheme $\Spec(A) \times_X U$ is quasi-compact. Moreover, the
projection morphism $\Spec(A) \times_X U \to \Spec(A)$ is \'etale.
Hence this morphism has finite discrete fibers and moreover
the topology on $\Spec(A)$ is discrete. Thus $\Spec(A) \times_X U$
is a scheme whose underlying topological
space is a finite discrete set. We are done by
Schemes, Lemma \ref{schemes-lemma-scheme-finite-discrete-affine}.
\end{proof}












\section{Quasi-affine morphisms}
\label{section-quasi-affine}

\noindent
We have already defined in Section \ref{section-representable}
what it means for a representable morphism of algebraic spaces
to be quasi-affine.

\begin{lemma}
\label{lemma-quasi-affine-representable}
Let $S$ be a scheme. Let $f : X \to Y$ be a representable
morphism of algebraic spaces over $S$. Then
$f$ is quasi-affine (in the sense of Section \ref{section-representable})
if and only if for all affine schemes $Z$
and morphisms $Z \to Y$ the scheme $X \times_Y Z$ is quasi-affine.
\end{lemma}

\begin{proof}
This follows directly from the definition of a quasi-affine morphism
of schemes
(Morphisms, Definition \ref{morphisms-definition-quasi-affine}).
\end{proof}

\noindent
This clears the way for the following definition.

\begin{definition}
\label{definition-quasi-affine}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
We say $f$ is {\it quasi-affine} if for every affine scheme $Z$ and
morphism $Z \to Y$ the algebraic space $X \times_Y Z$ is representable
by a quasi-affine scheme.
\end{definition}

\begin{lemma}
\label{lemma-quasi-affine-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is representable and quasi-affine,
\item $f$ is quasi-affine,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is quasi-affine, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such
that each of the morphisms $f^{-1}(Y_i) \to Y_i$ is quasi-affine.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (1) implies (2) and that (2) implies (3) by taking
$V$ to be a disjoint union of affines \'etale over $Y$, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}.
Assume $V \to Y$ is as in (3). Then for every affine open $W$ of $V$ we see
that $W \times_Y X$ is a quasi-affine open of $V \times_Y X$. Hence by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-subscheme}
we conclude that $V \times_Y X$ is a scheme. Moreover the morphism
$V \times_Y X \to V$ is quasi-affine. This means we can apply
Spaces,
Lemma \ref{spaces-lemma-morphism-sheaves-with-P-effective-descent-etale}
because the class of quasi-affine morphisms satisfies all the required
properties (see
Morphisms, Lemmas \ref{morphisms-lemma-base-change-quasi-affine} and
Descent, Lemmas \ref{descent-lemma-descending-property-quasi-affine}
and \ref{descent-lemma-quasi-affine}). The conclusion of applying this lemma
is that $f$ is representable and quasi-affine, i.e., (1) holds.

\medskip\noindent
The equivalence of (1) and (4) follows from the fact that being
quasi-affine is Zariski local on the target (the reference above shows
that being quasi-affine is in fact fpqc local on the target).
\end{proof}

\begin{lemma}
\label{lemma-composition-quasi-affine}
The composition of quasi-affine morphisms is quasi-affine.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-quasi-affine}
The base change of a quasi-affine morphism is quasi-affine.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-characterize-quasi-affine}
Let $S$ be a scheme.
A quasi-compact and quasi-separated morphism of algebraic spaces
$f : Y \to X$ is quasi-affine if and only if the canonical factorization
$Y \to \underline{\Spec}_X(f_*\mathcal{O}_Y)$
(Remark \ref{remark-factorization-quasi-compact-quasi-separated})
is an open immersion.
\end{lemma}

\begin{proof}
Let $U \to X$ be a surjective morphism where $U$ is a scheme.
Since we may check whether $f$ is quasi-affine after base change to
$U$ (Lemma \ref{lemma-quasi-affine-local}), since $f_*\mathcal{O}_Y|_V$
is equal to $(Y \times_X U \to U)_*\mathcal{O}_{Y \times_X U}$
(Properties of Spaces, Lemma
\ref{spaces-properties-lemma-pushforward-etale-base-change-modules}), and
since formation of relative spectrum commutes with base change
(Lemma \ref{lemma-affine-equivalence-algebras}),
we see that the assertion reduces to the case that $X$ is a scheme.
If $X$ is a scheme and either $f$ is quasi-affine or
$Y \to \underline{\Spec}_X(f_*\mathcal{O}_Y)$ is an open immersion,
then $Y$ is a scheme as well. Thus we reduce to
Morphisms, Lemma \ref{morphisms-lemma-characterize-quasi-affine}.
\end{proof}







\section{Types of morphisms \'etale local on source-and-target}
\label{section-local-source-target}

\noindent
Given a property of morphisms of schemes which is {\it \'etale local on the
source-and-target}, see
Descent, Definition \ref{descent-definition-local-source-target}
we may use it to define a corresponding
property of morphisms of algebraic spaces, namely by imposing either of
the equivalent conditions of the lemma below.

\begin{lemma}
\label{lemma-local-source-target}
Let $\mathcal{P}$ be a property of morphisms of schemes
which is \'etale local on the source-and-target.
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Consider commutative diagrams
$$
\xymatrix{
U \ar[d]_a \ar[r]_h & V \ar[d]^b \\
X \ar[r]^f & Y
}
$$
where $U$ and $V$ are schemes and the vertical arrows are \'etale.
The following are equivalent
\begin{enumerate}
\item for any diagram as above the morphism $h$ has property
$\mathcal{P}$, and
\item for some diagram as above with $a : U \to X$ surjective
the morphism $h$ has property $\mathcal{P}$.
\end{enumerate}
If $X$ and $Y$ are representable, then this is also equivalent to
$f$ (as a morphism of schemes) having property $\mathcal{P}$.
If $\mathcal{P}$ is also preserved under any base change, and
fppf local on the base, then for representable morphisms $f$ this
is also equivalent to $f$ having property $\mathcal{P}$ in the sense
of Section \ref{section-representable}.
\end{lemma}

\begin{proof}
Let us prove the equivalence of (1) and (2).
The implication (1) $\Rightarrow$ (2) is immediate (taking into account
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}).
Assume
$$
\xymatrix{
U \ar[d] \ar[r]_h & V \ar[d] \\
X \ar[r]^f & Y
}
\quad\quad
\xymatrix{
U' \ar[d] \ar[r]_{h'} & V' \ar[d] \\
X \ar[r]^f & Y
}
$$
are two diagrams as in the lemma. Assume $U \to X$ is
surjective and $h$ has property $\mathcal{P}$. To show that (2)
implies (1) we have to prove that $h'$ has $\mathcal{P}$. To do
this consider the diagram
$$
\xymatrix{
U \ar[d]_h &
U \times_X U' \ar[l] \ar[d]^{(h, h')} \ar[r] &
U' \ar[d]^{h'} \\
V &
V \times_Y V' \ar[l] \ar[r] &
V'
}
$$
By
Descent, Lemma \ref{descent-lemma-local-source-target-characterize}
we see that $h$ has $\mathcal{P}$ implies $(h, h')$ has $\mathcal{P}$
and since $U \times_X U' \to U'$ is surjective this implies (by the
same lemma) that $h'$ has $\mathcal{P}$.

\medskip\noindent
If $X$ and $Y$ are representable, then
Descent, Lemma \ref{descent-lemma-local-source-target-characterize}
applies which shows that (1) and (2) are equivalent to $f$ having
$\mathcal{P}$.

\medskip\noindent
Finally, suppose $f$ is representable, and $U, V, a, b, h$ are
as in part (2) of the lemma, and that $\mathcal{P}$ is preserved under
arbitrary base change. We have to show that for any scheme
$Z$ and morphism $Z \to X$ the base change $Z \times_Y X \to Z$
has property $\mathcal{P}$. Consider the diagram
$$
\xymatrix{
Z \times_Y U \ar[d] \ar[r] &
Z \times_Y V \ar[d] \\
Z \times_Y X \ar[r] &
Z
}
$$
Note that the top horizontal arrow is a base change of $h$ and
hence has property $\mathcal{P}$. The left vertical arrow is \'etale
and surjective and the right vertical arrow is \'etale. Thus
Descent, Lemma \ref{descent-lemma-local-source-target-characterize}
once again kicks in and shows that $Z \times_Y X \to Z$
has property $\mathcal{P}$.
\end{proof}

\begin{definition}
\label{definition-P}
Let $S$ be a scheme.
Let $\mathcal{P}$ be a property of morphisms of schemes
which is \'etale local on the source-and-target.
We say a morphism $f : X \to Y$ of algebraic spaces over $S$
{\it has property $\mathcal{P}$} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold.
\end{definition}

\noindent
Here are a couple of obvious remarks.

\begin{remark}
\label{remark-composition-P}
Let $S$ be a scheme. Let $\mathcal{P}$ be a property of morphisms of schemes
which is \'etale local on the source-and-target. Suppose that moreover
$\mathcal{P}$ is stable under compositions. Then the class of morphisms
of algebraic spaces having property $\mathcal{P}$ is stable under composition.
\end{remark}

\begin{remark}
\label{remark-base-change-P}
Let $S$ be a scheme. Let $\mathcal{P}$ be a property of morphisms of schemes
which is \'etale local on the source-and-target. Suppose that moreover
$\mathcal{P}$ is stable under base change. Then the class of morphisms
of algebraic spaces having property $\mathcal{P}$ is stable under base change.
\end{remark}

\noindent
Given a property of morphisms of germs of schemes which is {\it \'etale local
on the source-and-target}, see
Descent, Definition \ref{descent-definition-local-source-target-at-point}
we may use it to define a corresponding property of morphisms of
algebraic spaces at a point, namely by imposing either of
the equivalent conditions of the lemma below.

\begin{lemma}
\label{lemma-local-source-target-at-point}
Let $\mathcal{Q}$ be a property of morphisms of germs which is
\'etale local on the source-and-target.
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $x \in |X|$ be a point of $X$.
Consider the diagrams
$$
\xymatrix{
U \ar[d]_a \ar[r]_h & V \ar[d]^b \\
X \ar[r]^f & Y
}
\quad\quad
\xymatrix{
u \ar[d] \ar[r] & v \ar[d] \\
x \ar[r] & y
}
$$
where $U$ and $V$ are schemes, $a, b$ are \'etale, and $u, v, x, y$
are points of the corresponding spaces.
The following are equivalent
\begin{enumerate}
\item for any diagram as above we have $\mathcal{Q}((U, u) \to (V, v))$, and
\item for some diagram as above we have $\mathcal{Q}((U, u) \to (V, v))$.
\end{enumerate}
If $X$ and $Y$ are representable, then this is also
equivalent to $\mathcal{Q}((X, x) \to (Y, y))$.
\end{lemma}

\begin{proof}
Omitted. Hint: Very similar to the proof of
Lemma \ref{lemma-local-source-target}.
\end{proof}

\begin{definition}
\label{definition-P-at-point}
Let $\mathcal{Q}$ be a property of morphisms of germs
of schemes which is \'etale local on the source-and-target.
Let $S$ be a scheme.
Given a morphism $f : X \to Y$ of algebraic spaces over $S$ and
a point $x \in |X|$ we say that $f$
{\it has property $\mathcal{Q}$ at $x$} if the equivalent conditions of
Lemma \ref{lemma-local-source-target-at-point}
hold.
\end{definition}

\noindent
The following lemma should not be used blindly to go from a property of
morphisms to a property of morphisms at a point. For example if
$\mathcal{P}$ is the property of being flat, then the property
$Q$ in the following lemma means ``$f$ is flat in an open neighbourhood
of $x$'' which is not the same as ``$f$ is flat at $x$''.

\begin{lemma}
\label{lemma-local-source-target-global-implies-local}
Let $\mathcal{P}$ be a property of morphisms of schemes
which is \'etale local on the source-and-target.
Consider the property $\mathcal{Q}$ of morphisms
of germs associated to $\mathcal{P}$ in
Descent, Lemma \ref{descent-lemma-local-source-target-global-implies-local}.
Then
\begin{enumerate}
\item $\mathcal{Q}$ is \'etale local on the source-and-target.
\item given a morphism of algebraic spaces $f : X \to Y$ and $x \in |X|$
the following are equivalent
\begin{enumerate}
\item $f$ has $\mathcal{Q}$ at $x$, and
\item there is an open neighbourhood $X' \subset X$ of $x$
such that $X' \to Y$ has $\mathcal{P}$.
\end{enumerate}
\item given a morphism of algebraic spaces $f : X \to Y$
the following are equivalent:
\begin{enumerate}
\item $f$ has $\mathcal{P}$,
\item for every $x \in |X|$ the morphism $f$ has $\mathcal{Q}$ at $x$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
See
Descent, Lemma \ref{descent-lemma-local-source-target-global-implies-local}
for (1). The implication (1)(a) $\Rightarrow$ (2)(b) follows on letting
$X' = a(U) \subset X$ given a diagram as in
Lemma \ref{lemma-local-source-target-at-point}.
The implication (2)(b) $\Rightarrow$ (1)(a) is clear.
The equivalence of (3)(a) and (3)(b) follows from the corresponding
result for morphisms of schemes, see
Descent, Lemma \ref{descent-lemma-local-source-target-local-implies-global}.
\end{proof}

\begin{remark}
\label{remark-when-apply}
We will apply
Lemma \ref{lemma-local-source-target-global-implies-local}
above to all cases listed in
Descent, Remark \ref{descent-remark-list-local-source-target}
except ``flat''. In each case we will do this by defining
$f$ to have property $\mathcal{P}$ at $x$ if $f$ has
$\mathcal{P}$ in a neighbourhood of $x$.
\end{remark}




\section{Morphisms of finite type}
\label{section-finite-type}

\noindent
The property ``locally of finite type'' of morphisms of schemes
is \'etale local on the source-and-target, see
Descent, Remark \ref{descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-finite-type}, and
Descent, Lemmas \ref{descent-lemma-descending-property-locally-finite-type}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define what it means for a morphism of algebraic spaces
to be locally of finite type as
follows and it agrees with the already existing notion defined in
Section \ref{section-representable}
when the morphism is representable.

\begin{definition}
\label{definition-locally-finite-type}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item We say $f$
{\it locally of finite type} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold with
$\mathcal{P} = \text{locally of finite type}$.
\item Let $x \in |X|$. We say $f$ is of {\it finite type at $x$}
if there exists an open neighbourhood $X' \subset X$ of $x$ such
that $f|_{X'} : X' \to Y$ is locally of finite type.
\item We say $f$ is
{\it of finite type} if it is locally of finite type and quasi-compact.
\end{enumerate}
\end{definition}

\noindent
Consider the algebraic space $\mathbf{A}^1_k/\mathbf{Z}$ of
Spaces, Example \ref{spaces-example-affine-line-translation}.
The morphism $\mathbf{A}^1_k/\mathbf{Z} \to \Spec(k)$
is of finite type.

\begin{lemma}
\label{lemma-composition-finite-type}
The composition of finite type morphisms is of finite type.
The same holds for locally of finite type.
\end{lemma}

\begin{proof}
See Remark \ref{remark-composition-P} and
Morphisms, Lemma \ref{morphisms-lemma-composition-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-finite-type}
A base change of a finite type morphism is finite type.
The same holds for locally of finite type.
\end{lemma}

\begin{proof}
See Remark \ref{remark-base-change-P} and
Morphisms, Lemma \ref{morphisms-lemma-base-change-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is locally of finite type,
\item for every $x \in |X|$ the morphism $f$ is of finite type at $x$,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is locally of finite type,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is locally of finite type,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is locally of finite type,
\item there exists a scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$ such that the composition $f \circ \varphi$
is locally of finite type,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes and the vertical arrows are \'etale
the top horizontal arrow is locally of finite type,
\item there exists a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes, the vertical arrows are \'etale, $U \to X$
is surjective, and the top horizontal arrow is locally of finite type, and
\item there exist Zariski coverings $Y = \bigcup_{i \in I} Y_i$,
and $f^{-1}(Y_i) = \bigcup X_{ij}$ such that
each morphism $X_{ij} \to Y_i$ is locally of finite type.
\end{enumerate}
\end{lemma}

\begin{proof}
Each of the conditions (2), (3), (4), (5), (6), (7), and (9)
imply condition (8) in a straightforward manner. For example, if
(5) holds, then we can choose a scheme $V$ which is a disjoint
union of affines and a surjective morphism $V \to Y$
(see Properties of Spaces, Lemma
\ref{spaces-properties-lemma-cover-by-union-affines}).
Then $V \times_Y X \to V$ is locally of finite type by (5).
Choose a scheme $U$ and a surjective \'etale morphism
$U \to V \times_Y X$. Then $U \to V$ is locally of finite
type by Lemma \ref{lemma-composition-finite-type}.
Hence (8) is true.

\medskip\noindent
The conditions (1), (7), and (8) are equivalent by definition.

\medskip\noindent
To finish the proof, we show that (1) implies all of the conditions
(2), (3), (4), (5), (6), and (9). For (2) this is immediate.
For (3), (4), (5), and (9) this follows from the fact that being
locally of finite type is preserved under base change, see
Lemma \ref{lemma-base-change-finite-type}.
For (6) we can take $U = X$ and we're done.
\end{proof}

\begin{lemma}
\label{lemma-locally-finite-type-locally-noetherian}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
If $f$ is locally of finite type and $Y$ is locally Noetherian,
then $X$ is locally Noetherian.
\end{lemma}

\begin{proof}
Let
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
be a commutative diagram where $U$, $V$ are schemes and the vertical arrows
are surjective \'etale. If $f$ is locally of finite type, then
$U \to V$ is locally of finite type. If $Y$ is locally Noetherian, then
$V$ is locally Noetherian. By
Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}
we see that $U$ is locally Noetherian, which means that $X$ is locally
Noetherian.
\end{proof}

\begin{lemma}
\label{lemma-permanence-finite-type}
Let $S$ be a scheme.
Let $f : X \to Y$, $g : Y \to Z$ be morphisms of algebraic spaces over $S$.
If $g \circ f : X \to Z$ is locally of finite type, then $f : X \to Y$
is locally of finite type.
\end{lemma}

\begin{proof}
We can find a diagram
$$
\xymatrix{
U \ar[r] \ar[d] & V \ar[r] \ar[d] & W \ar[d] \\
X \ar[r] & Y \ar[r] & Z
}
$$
where $U$, $V$, $W$ are schemes, the vertical arrows are \'etale and surjective,
see
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.
At this point we can use
Lemma \ref{lemma-finite-type-local}
and
Morphisms, Lemma \ref{morphisms-lemma-permanence-finite-type}
to conclude.
\end{proof}

\begin{lemma}
\label{lemma-immersion-locally-finite-type}
An immersion is locally of finite type.
\end{lemma}

\begin{proof}
Follows from the general principle
Spaces, Lemma
\ref{spaces-lemma-representable-transformations-property-implication}
and
Morphisms, Lemmas \ref{morphisms-lemma-immersion-locally-finite-type}.
\end{proof}







\section{Points and geometric points}
\label{section-points-fields}

\noindent
In this section we make some remarks on points and geometric points (see
Properties of Spaces,
Definition \ref{spaces-properties-definition-geometric-point}).
One way to think about a geometric point of $X$ is to
consider a geometric point $\overline{s} : \Spec(k) \to S$ of $S$
and a lift of $\overline{s}$ to a morphism $\overline{x}$ into $X$.
Here is a diagram
$$
\xymatrix{
\Spec(k) \ar[r]_-{\overline{x}} \ar[rd]_{\overline{s}} & X \ar[d] \\
& S.
}
$$
We often say ``let $k$ be an algebraically closed field over $S$''
to indicate that $\Spec(k)$ comes equipped with a morphism
$\Spec(k) \to S$. In this situation we write
$$
X(k) = \Mor_S(\Spec(k), X) =
\{\overline{x} \in X\text{ lying over }\overline{s}\}
$$
for the set of $k$-valued points of $X$. In this case the map
$X(k) \to |X|$ maps into the subset $|X_s| \subset |X|$.
Here $X_s = \Spec(\kappa(s)) \times_S X$, where $s \in S$
is the point corresponding to $\overline{s}$. As
$\Spec(\kappa(s)) \to S$ is a monomorphism, also the base change
$X_s \to X$ is a monomorphism, and $|X_s|$ is indeed a subset of $|X|$.

\begin{lemma}
\label{lemma-locally-finite-type-surjective-geometric-points}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. Assume $f$ is locally of finite type. The following are equivalent:
\begin{enumerate}
\item $f$ is surjective, and
\item for every algebraically closed field $k$ over $S$ the induced
map $X(k) \to Y(k)$ is surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$, $V$ schemes over $S$ and vertical arrows surjective
and \'etale, see
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.
Since $f$ is locally of finite type we see that $U \to V$ is locally of
finite type.

\medskip\noindent
Assume (1) and let $\overline{y} \in Y(k)$. Then $U \to Y$ is
surjective and locally of finite type by
Lemmas \ref{lemma-composition-surjective} and
\ref{lemma-composition-finite-type}.
Let $Z = U \times_{Y, \overline{y}} \Spec(k)$. This is a scheme.
The projection $Z \to \Spec(k)$
is surjective and locally of finite type by
Lemmas \ref{lemma-base-change-surjective} and
\ref{lemma-base-change-finite-type}.
It follows from
Varieties, Lemma \ref{varieties-lemma-locally-finite-type-Jacobson}
that $Z$ has a $k$ valued point $\overline{z}$. The image
$\overline{x} \in X(k)$ of $\overline{z}$ maps to $\overline{y}$
as desired.

\medskip\noindent
Assume (2). By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-characterize-surjective}
it suffices to show that $|X| \to |Y|$ is surjective.
Let $y \in |Y|$. Choose a $u \in U$ mapping to $y$.
Let $k \supset \kappa(u)$ be an algebraic closure. Denote
$\overline{u} \in U(k)$ the corresponding point and
$\overline{y} \in Y(k)$ its image. By assumption there exists
a $\overline{x} \in X(k)$ mapping to $\overline{y}$.
Then it is clear that the image $x \in |X|$ of $\overline{x}$
maps to $y$.
\end{proof}

\noindent
In order to state the next lemma we introduce the following
notation. Given a scheme $T$ we denote
$$
\lambda(T) = \sup\{\aleph_0, |\kappa(t)| ; t \in T\}.
$$
In words $\lambda(T)$ is the smallest infinite cardinal bounding
all the cardinalities of residue fields ot $T$. Note that if $R$
is a ring then the cardinality of any residue field $\kappa(\mathfrak p)$
of $R$ is bounded by the cardinality of $R$ (details omitted).
This implies that $\lambda(T) \leq \text{size}(T)$ where
$\text{size}(T)$ is the size of the scheme $T$ as introduced in
Sets, Section \ref{sets-section-categories-schemes}.
If $K \subset L$ is a finitely generated field extension then
$|K| \leq |L| \leq \max\{\aleph_0, |K|\}$. It follows that if $T' \to T$
is a morphism of schemes which is locally of finite
type then $\lambda(T') \leq \lambda(T)$, and if $T' \to T$ is also
surjective then equality holds. Next, suppose that $S$ is a scheme
and that $X$ is an algebraic space over $S$. In this case we define
$$
\lambda(X) := \lambda(U)
$$
where $U$ is any scheme over $S$ which has a surjective \'etale morphism
towards $X$. The reason that this is independent of the choice of $U$
is that given a pair of such schemes $U$ and $U'$ the fibre product
$U \times_X U'$ is a scheme which admits a surjective \'etale morphism
to both $U$ and $U'$, whence $\lambda(U) = \lambda(U \times_X U') =
\lambda(U')$ by the discussion above.

\begin{lemma}
\label{lemma-large-enough}
Let $S$ be a scheme. Let $X$, $Y$ be algebraic spaces over $S$.
\begin{enumerate}
\item As $k$ ranges over all algebraically closed fields over $S$
the collection of geometric points $\overline{y} \in Y(k)$ cover all of $|Y|$.
\item As $k$ ranges over all algebraically closed fields over $S$ with
$|k| \geq \lambda(Y)$ and $|k| > \lambda(X)$ the geometric points
$\overline{y} \in Y(k)$ cover all of $|Y|$.
\item For any geometric point
$\overline{s} : \Spec(k) \to S$ where
$k$ has cardinality $> \lambda(X)$ the map
$$
X(k) \longrightarrow |X_s|
$$
is surjective.
\item Let $X \to Y$ be a morphism of algebraic spaces over $S$.
For any geometric point $\overline{s} : \Spec(k) \to S$ where
$k$ has cardinality $> \lambda(X)$ the map
$$
X(k) \longrightarrow |X| \times_{|Y|} Y(k)
$$
is surjective.
\item Let $X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item the map $X \to Y$ is surjective,
\item for all algebraically closed fields $k$ over $S$ with
$|k| > \lambda(X)$, and $|k| \geq \lambda(Y)$ the map $X(k) \to Y(k)$
is surjective.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
To prove part (1) choose a surjective \'etale morphism $V \to Y$ where
$V$ is a scheme. For each $v \in V$ choose an algebraic closure
$\kappa(v) \subset k_v$. Consider the morphisms
$\overline{x} : \Spec(k_v) \to V \to Y$.
By construction of $|Y|$ these cover $|Y|$.

\medskip\noindent
To prove part (2) we will use the following two facts whose proofs we omit:
(\romannumeral1) If $K$ is a field and $\overline{K}$ is algebraic closure then
$|\overline{K}| \leq \max\{\aleph_0, |K|\}$.
(\romannumeral2) For any algebraically closed field $k$ and any cardinal
$\aleph$, $\aleph \geq |k|$ there exists an extension of algebraically
closed fields $k \subset k'$ with $|k'| = \aleph$.
Now we set $\aleph = \max\{\lambda(X), \lambda(Y)\}^+$.
Here $\lambda^+ > \lambda$ indicates the next bigger cardinal, see
Sets, Section \ref{sets-section-cardinals}.
Now (\romannumeral1)
implies that the fields $k_u$ constructed in the first paragraph
of the proof all have cardinality bounded by $\lambda(X)$. Hence
by (\romannumeral2) we can find extensions $k_u \subset k'_u$ such that
$|k'_u| = \aleph$. The morphisms
$\overline{x}' : \Spec(k'_u) \to X$ cover $|X|$ as desired.
To really finish the proof of (2) we need to show that the schemes
$\Spec(k'_u)$ are (isomorphic to) objects of $\Sch_{fppf}$
because our conventions are that all schemes are objects of
$\Sch_{fppf}$; the rest of this paragraph should be skipped by
anyone who is not interested in set theoretical considerations. By
construction there exists an object $T$ of $\Sch_{fppf}$ such that
$\lambda(X)$ and $\lambda(Y)$ are bounded by $\text{size}(T)$.
By our construction of the category $\Sch_{fppf}$ in
Topologies, Definitions \ref{topologies-definition-big-fppf-site}
as the category $\Sch_\alpha$ constructed in
Sets, Lemma \ref{sets-lemma-construct-category}
we see that any scheme whose size is $\leq \text{size}(T)^+$
is isomorphic to an object of $\Sch_{fppf}$. See
the expression for the function $Bound$ in
Sets, Equation (\ref{sets-equation-bound}).
Since $\aleph \leq \text{size}(T)^+$ we conclude.

\medskip\noindent
The notation $X_s$ in part (3) means
the fibre product $\Spec(\kappa(s)) \times_S X$, where $s \in S$
is the point corresponding to $\overline{s}$. Hence part (2) follows
from (4) with $Y = \Spec(\kappa(s))$.

\medskip\noindent
Let us prove (4). Let $X \to Y$ be a morphism of algebraic spaces over $S$.
Let $k$ be an algebraically closed field over $S$ of cardinality
$> \lambda(X)$. Let $\overline{y} \in Y(k)$ and $x \in |X|$ which map to the
same element $y$ of $|Y|$.
We have to find $\overline{x} \in X(k)$ mapping to $x$ and $\overline{y}$.
Choose a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$, $V$ schemes over $S$ and vertical arrows surjective
and \'etale, see
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.
Choose a $u \in |U|$ which maps to $x$, and denote $v \in |V|$ the image.
We will think of $u = \Spec(\kappa(u))$ and
$v = \Spec(\kappa(v))$ as schemes.
Note that $V \times_Y \Spec(k)$ is a scheme \'etale over $k$.
Hence it is a disjoint union of spectra of finite separable
extensions of $k$, see
Morphisms, Lemma \ref{morphisms-lemma-etale-over-field}.
As $v$ maps to $y$ we see that $v \times_Y \Spec(k)$ is a
nonempty scheme. As $v \to V$ is a monomorphism, we see that
$v \times_Y \Spec(k) \to V \times_Y \Spec(k)$
is a monomorphism. Hence $v \times_Y \Spec(k)$ is a disjoint
union of spectra of finite separable extensions of $k$, by
Schemes, Lemma \ref{schemes-lemma-mono-towards-spec-field}.
We conclude that the morphism
$v \times_Y \Spec(k) \to \Spec(k)$
has a section, i.e., we can find a morphism
$\overline{v} : \Spec(k) \to V$ lying over $v$ and over
$\overline{y}$. Finally we consider the scheme
$$
u \times_{V, \overline{v}} \Spec(k)
=
\Spec(\kappa(u) \otimes_{\kappa(v)} k)
$$
where $\kappa(v) \to k$ is the field map defining the morphism
$\overline{v}$. Since the cardinality of $k$ is larger than the cardinality
of $\kappa(u)$ by assumption we may apply
Algebra, Lemma \ref{algebra-lemma-base-change-Jacobson}
to see that any maximal ideal
$\mathfrak m \subset \kappa(u) \otimes_{\kappa(v)} k$
has a residue field which is algebraic over $k$ and hence equal to $k$.
Such a maximal ideal will hence produce a morphism
$\overline{u} : \Spec(k) \to U$ lying over $u$ and mapping to
$\overline{v}$. The composition $\Spec(k) \to U \to X$
will be the desired geometric point $\overline{x} \in X(k)$.
This concludes the proof of part (4).

\medskip\noindent
Part (5) is a formal consequence of parts (2) and (4) and
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-characterize-surjective}.
\end{proof}








\section{Points of finite type}
\label{section-points-finite-type}

\noindent
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
A finite type point $x \in |X|$ is a point which can be represented by
a morphism $\Spec(k) \to X$ which is locally of finite type.
Finite type points are a suitable replacement of closed points for algebraic
spaces and algebraic stacks. There are always ``enough of them'' for example.

\begin{lemma}
\label{lemma-point-finite-type}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $x \in |X|$. The following are equivalent:
\begin{enumerate}
\item There exists a morphism $\Spec(k) \to X$
which is locally of finite type and represents $x$.
\item There exists a scheme $U$, a closed point $u \in U$, and an \'etale
morphism $\varphi : U \to X$ such that $\varphi(u) = x$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $u \in U$ and $U \to X$ be as in (2). Then
$\Spec(\kappa(u)) \to U$ is of finite type, and $U \to X$ is
representable and locally of finite type (by the general principle
Spaces, Lemma
\ref{spaces-lemma-representable-transformations-property-implication}
and
Morphisms, Lemmas \ref{morphisms-lemma-etale-locally-finite-presentation} and
\ref{morphisms-lemma-finite-presentation-finite-type}). Hence we see
(1) holds by
Lemma \ref{lemma-composition-finite-type}.

\medskip\noindent
Conversely, assume $\Spec(k) \to X$ is locally of finite type and
represents $x$. Let $U \to X$ be a surjective \'etale morphism where $U$
is a scheme. By assumption $U \times_X \Spec(k) \to U$ is locally
of finite type. Pick a finite type point $v$ of
$U \times_X \Spec(k)$ (there exists at least one, see
Morphisms, Lemma \ref{morphisms-lemma-identify-finite-type-points}).
By
Morphisms, Lemma \ref{morphisms-lemma-finite-type-points-morphism}
the image $u \in U$ of $v$ is a finite type point of $U$.
Hence by
Morphisms, Lemma \ref{morphisms-lemma-identify-finite-type-points}
after shrinking $U$ we may assume that $u$ is a closed point of $U$, i.e.,
(2) holds.
\end{proof}

\begin{definition}
\label{definition-finite-type-point}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
We say a point $x \in |X|$ is a {\it finite type point}\footnote{This is a
slight abuse of language as it would perhaps be more correct to say
``locally finite type point''.} if the equivalent conditions of
Lemma \ref{lemma-point-finite-type}
are satisfied. We denote $X_{\text{ft-pts}}$ the set of finite type points
of $X$.
\end{definition}

\noindent
We can describe the set of finite type points as follows.

\begin{lemma}
\label{lemma-identify-finite-type-points}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$. We have
$$
X_{\text{ft-pts}} =
\bigcup\nolimits_{\varphi : U \to X\text{ \'etale }} |\varphi|(U_0)
$$
where $U_0$ is the set of closed points of $U$.
Here we may let $U$ range over all schemes \'etale over $X$ or over all
affine schemes \'etale over $X$.
\end{lemma}

\begin{proof}
Immediate from
Lemma \ref{lemma-point-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-points-morphism}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
If $f$ is locally of finite type, then
$f(X_{\text{ft-pts}}) \subset Y_{\text{ft-pts}}$.
\end{lemma}

\begin{proof}
Take $x \in X_{\text{ft-pts}}$. Represent $x$ by a locally finite type morphism
$x : \Spec(k) \to X$. Then $f \circ x$ is locally of finite type by
Lemma \ref{lemma-composition-finite-type}.
Hence $f(x) \in Y_{\text{ft-pts}}$.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-points-surjective-morphism}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
If $f$ is locally of finite type and surjective, then
$f(X_{\text{ft-pts}}) = Y_{\text{ft-pts}}$.
\end{lemma}

\begin{proof}
We have $f(X_{\text{ft-pts}}) \subset Y_{\text{ft-pts}}$ by
Lemma \ref{lemma-finite-type-points-morphism}.
Let $y \in |Y|$ be a finite type point. Represent $y$ by a morphism
$\Spec(k) \to Y$ which is locally of finite type.
As $f$ is surjective the algebraic space
$X_k = \Spec(k) \times_Y X$ is nonempty, therefore
has a finite type point $x \in |X_k|$ by
Lemma \ref{lemma-identify-finite-type-points}.
Now $X_k \to X$ is a morphism which is locally of finite type as a base change
of $\Spec(k) \to Y$
(Lemma \ref{lemma-base-change-finite-type}).
Hence the image of $x$ in $X$ is a finite type point by
Lemma \ref{lemma-finite-type-points-morphism}
which maps to $y$ by construction.
\end{proof}

\begin{lemma}
\label{lemma-enough-finite-type-points}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
For any locally closed subset $T \subset |X|$ we have
$$
T \not = \emptyset
\Rightarrow
T \cap X_{\text{ft-pts}} \not = \emptyset.
$$
In particular, for any closed subset $T \subset |X|$ we
see that $T \cap X_{\text{ft-pts}}$ is dense in $T$.
\end{lemma}

\begin{proof}
Let $i : Z \to X$ be the reduced induce subspace structure on $T$, see
Remark \ref{remark-space-structure-locally-closed-subset}.
Any immersion is locally of finite type, see
Lemma \ref{lemma-immersion-locally-finite-type}.
Hence by
Lemma \ref{lemma-finite-type-points-morphism}
we see $Z_{\text{ft-pts}} \subset X_{\text{ft-pts}} \cap T$.
Finally, any nonempty affine scheme $U$ with an \'etale morphism towards
$Z$ has at least one closed point. Hence $Z$ has at least one
finite type point by
Lemma \ref{lemma-identify-finite-type-points}.
The lemma follows.
\end{proof}

\noindent
Here is another, more technical, characterization of a finite type
point on an algebraic space.

\begin{lemma}
\label{lemma-point-finite-type-monomorphism}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $x \in |X|$. The following are equivalent:
\begin{enumerate}
\item $x$ is a finite type point,
\item there exists an algebraic space $Z$ whose underlying topological space
$|Z|$ is a singleton, and a morphism $f : Z \to X$ which is locally of finite
type such that $\{x\} = |f|(|Z|)$, and
\item there exists an algebraic space $Z$ and a morphism $f : Z \to X$
with the following properties:
\begin{enumerate}
\item there is a surjective \'etale morphism
$z : \Spec(k) \to Z$ where $k$ is a field,
\item $f$ is locally of finite type,
\item $f$ is a monomorphism, and
\item $x = f(z)$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $x$ is a finite type point. Choose an affine scheme $U$,
a closed point $u \in U$, and an \'etale morphism $\varphi : U \to X$
with $\varphi(u) = x$, see
Lemma \ref{lemma-identify-finite-type-points}.
Set $u = \Spec(\kappa(u))$ as usual. The projection morphisms
$u \times_X u \to u$ are the compositions
$$
u \times_X u \to u \times_X U \to u \times_X X = u
$$
where the first arrow is a closed immersion (a base change of
$u \to U$) and the second arrow is \'etale (a base change of the \'etale
morphism $U \to X$). Hence $u \times_X U$ is a disjoint union of spectra
of finite separable extensions of $k$ (see
Morphisms, Lemma \ref{morphisms-lemma-etale-over-field})
and therefore the closed subscheme $u \times_X u$ is a disjoint union of
finite separable extension of $k$, i.e., $u \times_X u \to u$ is \'etale. By
Spaces, Theorem \ref{spaces-theorem-presentation}
we see that $Z = u/u \times_X u$ is an algebraic space. By construction
the diagram
$$
\xymatrix{
u \ar[d] \ar[r] & U \ar[d] \\
Z \ar[r] & X
}
$$
is commutative with \'etale vertical arrows. Hence $Z \to X$ is locally
of finite type (see
Lemma \ref{lemma-finite-type-local}).
By construction the morphism $Z \to X$ is a monomorphism and
the image of $z$ is $x$. Thus (3) holds.

\medskip\noindent
It is clear that (3) implies (2).
If (2) holds then $x$ is a finite type point of $X$ by
Lemma \ref{lemma-finite-type-points-morphism}
(and
Lemma \ref{lemma-enough-finite-type-points}
to see that $Z_{\text{ft-pts}}$ is nonempty, i.e., the unique point of
$Z$ is a finite type point of $Z$).
\end{proof}





\section{Nagata spaces}
\label{section-nagata}

\noindent
See Properties of Spaces, Section
\ref{spaces-properties-section-types-properties} for the definition
of a Nagata algebraic space.

\begin{lemma}
\label{lemma-finite-type-nagata}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
If $Y$ is Nagata and $f$ locally of finite type then $X$ is Nagata.
\end{lemma}

\begin{proof}
Let $V$ be a scheme and let $V \to Y$ be a surjective \'etale morphism.
Let $U$ be a scheme and let $U \to X \times_Y V$ be a surjective \'etale
morphism. If $Y$ is Nagata, then $V$ is a Nagata scheme.
If $X \to Y$ is locally of finite type, then $U \to V$ is locally
of finite type. Hence $V$ is a Nagata scheme by
Morphisms, Lemma \ref{morphisms-lemma-finite-type-nagata}.
Then $X$ is Nagata by definition.
\end{proof}

\begin{lemma}
\label{lemma-ubiquity-nagata}
The following types of algebraic spaces are Nagata.
\begin{enumerate}
\item Any algebraic space locally of finite type over a Nagata scheme.
\item Any algebraic space locally of finite type over a field.
\item Any algebraic space locally of finite type over a
Noetherian complete local ring.
\item Any algebraic space locally of finite type over $\mathbf{Z}$.
\item Any algebraic space locally of finite type over a Dedekind ring of
characteristic zero.
\item And so on.
\end{enumerate}
\end{lemma}

\begin{proof}
The first property holds by Lemma \ref{lemma-finite-type-nagata}.
Thus the others hold as well, see
Morphisms, Lemma \ref{morphisms-lemma-ubiquity-nagata}.
\end{proof}








\section{Quasi-finite morphisms}
\label{section-quasi-finite}

\noindent
The property ``locally quasi-finite'' of morphisms of schemes is
\'etale local on the source-and-target, see
Descent, Remark \ref{descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-quasi-finite}, and
Descent, Lemma \ref{descent-lemma-descending-property-quasi-finite}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define what it means for a morphism of algebraic spaces
to be locally quasi-finite as
follows and it agrees with the already existing notion defined in
Section \ref{section-representable}
when the morphism is representable.

\begin{definition}
\label{definition-locally-quasi-finite}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item We say $f$ is
{\it locally quasi-finite} if the equivalent conditions of
Lemma \ref{lemma-local-source-target} hold with
$\mathcal{P} = \text{locally quasi-finite}$.
\item Let $x \in |X|$. We say $f$ is {\it quasi-finite at $x$}
if there exists an open neighbourhood $X' \subset X$ of $x$ such
that $f|_{X'} : X' \to Y$ is locally quasi-finite.
\item A morphism of algebraic spaces $f : X \to Y$ is
{\it quasi-finite} if it is locally quasi-finite and quasi-compact.
\end{enumerate}
\end{definition}

\noindent
The last part is compatible with the notion of quasi-finiteness for morphisms
of schemes by
Morphisms, Lemma \ref{morphisms-lemma-quasi-finite-locally-quasi-compact}.

\begin{lemma}
\label{lemma-base-change-quasi-finite-locus}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y' \to Y$ be morphisms
of algebraic spaces over $S$. Denote $f' : X' \to Y'$ the base change
of $f$ by $g$. Denote $g' : X' \to X$ the projection.
Assume $f$ is locally of finite type.
Let $W \subset |X|$, resp.\ $W' \subset |X'|$
be the set of points where $f$, resp.\ $f'$ is quasi-finite.
\begin{enumerate}
\item $W \subset |X|$ and $W' \subset |X'|$ are open,
\item $W' = (g')^{-1}(W)$, i.e., formation of the locus where
$f$ is quasi-finite commutes with base change,
\item the base change of a locally quasi-finite morphism is
locally quasi-finite, and
\item the base change of a quasi-finite morphism is quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a scheme $V$ and a surjective \'etale morphism $V \to Y$.
Choose a scheme $U$ and a surjective \'etale morphism $U \to V \times_Y X$.
Choose a scheme $V'$ and a surjective \'etale morphism $V' \to Y' \times_Y V$.
Set $U' = V' \times_V U$ so that $U' \to X'$ is a surjective \'etale
morphism as well. Picture
$$
\vcenter{
\xymatrix{
U' \ar[d] \ar[r] & U \ar[d] \\
V' \ar[r] & V
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
X' \ar[d] \ar[r] & X \ar[d] \\
Y' \ar[r] & Y
}
}
$$
Choose $u \in |U|$ with image $x \in |X|$.
The property of being "locally quasi-finite" is \'etale local on
the source-and-target, see
Descent, Remark \ref{descent-remark-list-local-source-target}.
Hence Lemmas \ref{lemma-local-source-target-at-point} and
\ref{lemma-local-source-target-global-implies-local} apply and
we see that $f : X \to Y$ is quasi-finite at $x$
if and only if $U \to V$ is quasi-finite at $u$.
Similarly for $f' : X' \to Y'$ and the morphism $U' \to V'$.
Hence parts (1), (2), and (3) reduce to
Morphisms, Lemmas \ref{morphisms-lemma-base-change-quasi-finite} and
\ref{morphisms-lemma-quasi-finite-points-open}.
Part (4) follows from (3) and Lemma \ref{lemma-base-change-quasi-compact}.
\end{proof}

\begin{lemma}
\label{lemma-composition-quasi-finite}
The composition of quasi-finite morphisms is quasi-finite.
The same holds for locally quasi-finite.
\end{lemma}

\begin{proof}
See Remark \ref{remark-composition-P} and
Morphisms, Lemma \ref{morphisms-lemma-composition-quasi-finite}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-quasi-finite}
A base change of a quasi-finite morphism is quasi-finite.
The same holds for locally quasi-finite.
\end{lemma}

\begin{proof}
Immediate consequence of Lemma \ref{lemma-base-change-quasi-finite-locus}.
\end{proof}

\noindent
The following lemma characterizes locally quasi-finite morphisms as those
morphisms which are locally of finite type and have ``discrete fibres''.
However, this is not the same thing as asking $|X| \to |Y|$ to have
discrete fibres as the discussion in
Examples, Section \ref{examples-section-specializations-fibre-etale}
shows.

\begin{lemma}
\label{lemma-locally-quasi-finite}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces.
Assume $f$ is locally of finite type. The following are equivalent
\begin{enumerate}
\item $f$ is locally quasi-finite,
\item for every morphism $\Spec(k) \to Y$ where $k$ is a field
the space $|X_k|$ is discrete. Here $X_k = \Spec(k) \times_Y X$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $f$ is locally quasi-finite. Let $\Spec(k) \to Y$ be as
in (2). Choose a surjective \'etale morphism $U \to X$ where $U$ is a scheme.
Then $U_k = \Spec(k) \times_Y U \to X_k$ is an
\'etale morphism of algebraic spaces by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-base-change-etale}.
By
Lemma \ref{lemma-base-change-quasi-finite}
we see that $X_k \to \Spec(k)$ is locally quasi-finite. By
definition this means that $U_k \to \Spec(k)$ is locally
quasi-finite. Hence $|U_k|$ is discrete by
Morphisms, Lemma \ref{morphisms-lemma-locally-quasi-finite-fibres}.
Since $|U_k| \to |X_k|$ is surjective and open we conclude that $|X_k|$
is discrete.

\medskip\noindent
Conversely, assume (2). Choose a surjective \'etale morphism $V \to Y$
where $V$ is a scheme. Choose a surjective \'etale morphism
$U \to V \times_Y X$ where $U$ is a scheme.
Note that $U \to V$ is locally of finite type as $f$ is locally of finite type.
Picture
$$
\xymatrix{
U \ar[r] \ar[rd] & X \times_Y V \ar[d] \ar[r] & V \ar[d] \\
& X \ar[r] & Y
}
$$
If $f$ is not locally quasi-finite then $U \to V$ is not locally quasi-finite.
Hence there exists a specialization $u \leadsto u'$ for some $u, u' \in U$
lying over the same point $v \in V$, see
Morphisms, Lemma \ref{morphisms-lemma-quasi-finite-at-point-characterize}.
We claim that $u, u'$ do not have the same image in
$X_v = \Spec(\kappa(v)) \times_Y X$
which will contradict the assumption that $|X_v|$ is discrete as desired.
Let $d = \text{trdeg}_{\kappa(v)}(\kappa(u))$ and
$d' = \text{trdeg}_{\kappa(v)}(\kappa(u'))$.
Then we see that $d > d'$ by
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-specialization}.
Note that $U_v$ (the fibre of $U \to V$ over $v$) is the fibre product of
$U$ and $X_v$ over $X \times_Y V$, hence $U_v \to X_v$ is \'etale (as a
base change of the \'etale morphism $U \to X \times_Y V$). If
$u, u' \in U_v$ map to the same element of $|X_v|$ then there exists a point
$r \in R_v = U_v \times_{X_v} U_v$ with $t(r) = u$ and $s(r) = u'$, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-cartesian}.
Note that $s, t : R_v \to U_v$ are \'etale morphisms of schemes
over $\kappa(v)$, hence $\kappa(u) \subset \kappa(r) \supset \kappa(u')$
are finite separable extensions of fields over $\kappa(v)$ (see
Morphisms, Lemma \ref{morphisms-lemma-etale-over-field}).
We conclude that the transcendence degrees are equal.
This contradiction finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-quasi-finite-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is locally quasi-finite,
\item for every $x \in |X|$ the morphism $f$ is quasi-finite at $x$,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is locally quasi-finite,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is locally quasi-finite,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is locally quasi-finite,
\item there exists a scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$ such that the composition $f \circ \varphi$
is locally quasi-finite,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes and the vertical arrows are \'etale
the top horizontal arrow is locally quasi-finite,
\item there exists a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes, the vertical arrows are \'etale, and
$U \to X$ is surjective such that the top horizontal arrow is
locally quasi-finite, and
\item there exist Zariski coverings $Y = \bigcup_{i \in I} Y_i$,
and $f^{-1}(Y_i) = \bigcup X_{ij}$ such that
each morphism $X_{ij} \to Y_i$ is locally quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-immersion-quasi-finite}
An immersion is locally quasi-finite.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-permanence-quasi-finite}
Let $S$ be a scheme.
Let $X \to Y \to Z$ be morphisms of algebraic spaces over $S$.
If $X \to Z$ is locally quasi-finite, then $X \to Y$
is locally quasi-finite.
\end{lemma}

\begin{proof}
Choose a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \ar[r] & W \ar[d] \\
X \ar[r] & Y \ar[r] & Z
}
$$
with vertical arrows \'etale and surjective. (See
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.)
Apply
Morphisms, Lemma \ref{morphisms-lemma-permanence-quasi-finite}
to the top row.
\end{proof}

\begin{lemma}
\label{lemma-quasi-finite-at-a-finite-number-of-points}
Let $S$ be a scheme. Let $f : X \to Y$ be a finite type
morphism of algebraic spaces over $S$. Let $y \in |Y|$.
There are at most finitely many
points of $|X|$ lying over $y$ at which $f$ is quasi-finite.
\end{lemma}

\begin{proof}
Choose a field $k$ and a morphism $\Spec(k) \to Y$ in the equivalence
class determined by $y$. The fibre $X_k = \Spec(k) \times_Y X$ is an
algebraic space of finite type over a field, in particular quasi-compact.
The map $|X_k| \to |X|$ surjects onto the fibre of $|X| \to |Y|$
over $y$ (Properties of Spaces, Lemma
\ref{spaces-properties-lemma-points-cartesian}).
Moreover, the set of points where $X_k \to \Spec(k)$ is
quasi-finite maps onto the set of points lying over $y$ where
$f$ is quasi-finite by Lemma \ref{lemma-base-change-quasi-finite-locus}.
Choose an affine scheme $U$ and a surjective \'etale morphism $U \to X_k$
(Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}).
Then $U \to \Spec(k)$ is a morphism of finite type and there are at
most a finite number of points where this morphism is quasi-finite,
see Morphisms, Lemma
\ref{morphisms-lemma-quasi-finite-at-a-finite-number-of-points}.
Since $X_k \to \Spec(k)$ is quasi-finite at a point $x'$ if and only
if it is the image of a point of $U$ where $U \to \Spec(k)$ is
quasi-finite, we conclude.
\end{proof}

\begin{lemma}
\label{lemma-monomorphism-loc-finite-type-loc-quasi-finite}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
If $f$ is locally of finite type and a monomorphism, then $f$
is separated and locally quasi-finite.
\end{lemma}

\begin{proof}
A monomorphism is separated, see
Lemma \ref{lemma-monomorphism-separated}.
By
Lemma \ref{lemma-quasi-finite-local}
it suffices to prove the lemma after performing a base change
by $Z \to Y$ with $Z$ affine. Hence we may assume that $Y$ is an
affine scheme. Choose an affine scheme $U$ and an \'etale morphism
$U \to X$. Since $X \to Y$ is locally of finite type the morphism
of affine schemes $U \to Y$ is of finite type.
Since $X \to Y$ is a monomorphism we have $U \times_X U = U \times_Y U$.
In particular the maps $U \times_Y U \to U$ are \'etale.
Let $y \in Y$. Then either $U_y$ is empty, or
$\Spec(\kappa(u)) \times_{\Spec(\kappa(y))} U_y$
is isomorphic to the fibre of $U \times_Y U \to U$ over $u$ for
some $u \in U$ lying over $y$. This implies that the fibres of
$U \to Y$ are finite discrete sets (as $U \times_Y U \to U$
is an \'etale morphism of affine schemes, see
Morphisms, Lemma \ref{morphisms-lemma-etale-over-field}).
Hence $U \to Y$ is quasi-finite, see
Morphisms, Lemma \ref{morphisms-lemma-quasi-finite-at-point-characterize}.
As $U \to X$ was an arbitrary \'etale morphism with $U$ affine
this implies that $X \to Y$ is locally quasi-finite.
\end{proof}













\section{Morphisms of finite presentation}
\label{section-finite-presentation}

\noindent
The property ``locally of finite presentation'' of morphisms of schemes is
\'etale local on the source-and-target, see
Descent, Remark \ref{descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-finite-presentation}, and
Descent,
Lemma \ref{descent-lemma-descending-property-locally-finite-presentation}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define what it means for a morphism of algebraic spaces
to be locally of finite presentation as
follows and it agrees with the already existing notion defined in
Section \ref{section-representable}
when the morphism is representable.

\begin{definition}
\label{definition-locally-finite-presentation}
Let $S$ be a scheme.
Let $X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item We say $f$ is {\it locally of finite presentation} if
the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold with $\mathcal{P} =$``locally of finite presentation''.
\item Let $x \in |X|$. We say $f$ is of {\it finite presentation at $x$}
if there exists an open neighbourhood $X' \subset X$ of $x$ such
that $f|_{X'} : X' \to Y$ is locally of finite
presentation\footnote{It seems awkward to use ``locally of finite presentation
at $x$'', but the current terminology may be misleading in the sense that
``of finite presentation at $x$'' does {\bf not} mean that there is
an open neighbourhood $X' \subset X$ such that $f|_{X'}$ is of finite
presentation.}.
\item A morphism of algebraic spaces $f : X \to Y$ is
{\it of finite presentation}
if it is locally of finite presentation, quasi-compact and
quasi-separated.
\end{enumerate}
\end{definition}

\noindent
Note that a morphism of finite presentation is {\bf not} just a quasi-compact
morphism which is locally of finite presentation.

\begin{lemma}
\label{lemma-composition-finite-presentation}
The composition of morphisms of finite presentation is of finite presentation.
The same holds for locally of finite presentation.
\end{lemma}

\begin{proof}
See Remark \ref{remark-composition-P} and
Morphisms, Lemma \ref{morphisms-lemma-composition-finite-presentation}.
Also use the result for quasi-compact and for quasi-separated morphisms
(Lemmas \ref{lemma-composition-quasi-compact} and
\ref{lemma-composition-separated}).
\end{proof}

\begin{lemma}
\label{lemma-base-change-finite-presentation}
A base change of a morphism of finite presentation is of finite presentation
The same holds for locally of finite presentation.
\end{lemma}

\begin{proof}
See Remark \ref{remark-base-change-P} and
Morphisms, Lemma \ref{morphisms-lemma-base-change-finite-presentation}.
Also use the result for quasi-compact and for quasi-separated morphisms
(Lemmas \ref{lemma-base-change-quasi-compact} and
\ref{lemma-base-change-separated}).
\end{proof}

\begin{lemma}
\label{lemma-finite-presentation-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is locally of finite presentation,
\item for every $x \in |X|$ the morphism $f$ is of finite presentation at $x$,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is locally of finite presentation,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is locally of finite presentation,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is
locally of finite presentation,
\item there exists a scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$ such that the composition $f \circ \varphi$
is locally of finite presentation,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes and the vertical arrows are \'etale
the top horizontal arrow is locally of finite presentation,
\item there exists a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes, the vertical arrows are \'etale, and
$U \to X$ is surjective such that the top horizontal arrow is
locally of finite presentation, and
\item there exist Zariski coverings $Y = \bigcup_{i \in I} Y_i$,
and $f^{-1}(Y_i) = \bigcup X_{ij}$ such that
each morphism $X_{ij} \to Y_i$ is locally of finite presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-finite-presentation-finite-type}
A morphism which is locally of finite presentation is locally of finite type.
A morphism of finite presentation is of finite type.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ be a morphism of algebraic spaces which is locally of
finite presentation. This means there exists a diagram as in
Lemma \ref{lemma-local-source-target}
with $h$ locally of finite presentation and surjective vertical arrow $a$. By
Morphisms, Lemma \ref{morphisms-lemma-finite-presentation-finite-type}
$h$ is locally of finite type.
Hence $X \to Y$ is locally of finite type by definition.
If $f$ is of finite presentation then it is quasi-compact and
it follows that $f$ is of finite type.
\end{proof}

\begin{lemma}
\label{lemma-finite-presentation-noetherian}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
If $f$ is of finite presentation and $Y$ is Noetherian,
then $X$ is Noetherian.
\end{lemma}

\begin{proof}
Assume $f$ is of finite presentation and $Y$ Noetherian. By
Lemmas \ref{lemma-finite-presentation-finite-type} and
\ref{lemma-locally-finite-type-locally-noetherian}
we see that $X$ is locally Noetherian. As $f$ is quasi-compact
and $Y$ is quasi-compact we see that $X$ is quasi-compact.
As $f$ is of finite presentation it is quasi-separated (see
Definition \ref{definition-locally-finite-presentation})
and as $Y$ is Noetherian it is quasi-separated (see
Properties of Spaces,
Definition \ref{spaces-properties-definition-noetherian}).
Hence $X$ is quasi-separated by
Lemma \ref{lemma-separated-over-separated}.
Hence we have checked all three conditions of
Properties of Spaces,
Definition \ref{spaces-properties-definition-noetherian}
and we win.
\end{proof}

\begin{lemma}
\label{lemma-noetherian-finite-type-finite-presentation}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item If $Y$ is locally Noetherian and $f$ locally of finite type
then $f$ is locally of finite presentation.
\item If $Y$ is locally Noetherian and $f$ of finite type and quasi-separated
then $f$ is of finite presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $f : X \to Y$ locally of finite type and $Y$ locally Noetherian.
This means there exists a diagram as in
Lemma \ref{lemma-local-source-target}
with $h$ locally of finite type and surjective vertical arrow $a$. By
Morphisms, Lemma
\ref{morphisms-lemma-noetherian-finite-type-finite-presentation}
$h$ is locally of finite presentation.
Hence $X \to Y$ is locally of finite presentation by definition.
This proves (1).
If $f$ is of finite type and quasi-separated then it is also
quasi-compact and quasi-separated and (2) follows immediately.
\end{proof}

\begin{lemma}
\label{lemma-finite-presentation-quasi-compact-quasi-separated}
Let $S$ be a scheme. Let $Y$ be an algebraic space over $S$ which is
quasi-compact and quasi-separated. If $X$ is of finite presentation over
$Y$, then $X$ is quasi-compact and quasi-separated.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-finite-presentation-permanence}
Let $S$ be a scheme.
Let $f : X \to Y$ and $Y \to Z$ be morphisms of algebraic spaces over $S$.
If $X$ is locally of finite presentation over $Z$, and
$Y$ is locally of finite type over $Z$, then $f$ is locally
of finite presentation.
\end{lemma}

\begin{proof}
Choose a scheme $W$ and a surjective \'etale morphism $W \to Z$.
Then choose a scheme $V$ and a surjective \'etale morphism $V \to W \times_Z Y$.
Finally choose a scheme $U$ and a surjective \'etale morphism
$U \to V \times_Y X$. By definition $U$ is locally of finite presentation
over $W$ and $V$ is locally of finite type over $W$. By
Morphisms, Lemma \ref{morphisms-lemma-finite-presentation-permanence}
the morphism $U \to V$ is locally of finite presentation.
Hence $f$ is locally of finite presentation.
\end{proof}

\begin{lemma}
\label{lemma-diagonal-morphism-finite-type}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$ with diagonal $\Delta : X \to X \times_Y X$. If $f$ is locally of
finite type then $\Delta$ is locally of finite presentation. If $f$ is
quasi-separated and locally of finite type, then $\Delta$ is of finite
presentation.
\end{lemma}

\begin{proof}
Note that $\Delta$ is a morphism over $X$ (via the second
projection $X \times_Y X \to X$). Assume $f$ is locally of finite type.
Note that $X$ is of finite presentation over $X$ and $X \times_Y X$ is
of finite type over $X$ (by Lemma \ref{lemma-base-change-finite-type}).
Thus the first statement holds by
Lemma \ref{lemma-finite-presentation-permanence}.
The second statement follows from the first, the definitions, and
the fact that a diagonal morphism is separated
(Lemma \ref{lemma-properties-diagonal}).
\end{proof}

\begin{lemma}
\label{lemma-open-immersion-locally-finite-presentation}
An open immersion of algebraic spaces is locally of finite presentation.
\end{lemma}

\begin{proof}
An open immersion is by definition representable, hence we can
use the general principle
Spaces,
Lemma \ref{spaces-lemma-representable-transformations-property-implication}
and
Morphisms,
Lemma \ref{morphisms-lemma-open-immersion-locally-finite-presentation}.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-finite-presentation}
A closed immersion $i : Z \to X$ is of finite presentation if and only if
the associated quasi-coherent sheaf of ideals
$\mathcal{I} = \Ker(\mathcal{O}_X \to i_*\mathcal{O}_Z)$
is of finite type (as an $\mathcal{O}_X$-module).
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $U \to X$ be a surjective \'etale morphism.
By Lemma \ref{lemma-finite-presentation-local}
we see that $i' : Z \times_X U \to U$ is of finite presentation if and
only if $i$ is. By Properties of Spaces, Section
\ref{spaces-properties-section-properties-modules}
we see that $\mathcal{I}$ is of finite type if and only if
$\mathcal{I}|_U = \Ker(\mathcal{O}_U \to i'_*\mathcal{O}_{Z \times_X U})$
is. Hence the result follows from the case of schemes, see Morphisms,
Lemma \ref{morphisms-lemma-closed-immersion-finite-presentation}.
\end{proof}







\section{Constructible sets}
\label{section-constructible}

\noindent
This section is the continuation of
Properties of Spaces, Section \ref{spaces-properties-section-constructible}.

\begin{lemma}
\label{lemma-inverse-image-constructible}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $E \subset |Y|$ be a subset.
If $E$ is \'etale locally constructible in $Y$, then
$f^{-1}(E)$ is \'etale locally constructible in $X$.
\end{lemma}

\begin{proof}
Choose a scheme $V$ and a surjective \'etale morphism $\varphi : V \to Y$.
Choose a scheme $U$ and a surjective \'etale morphism
$U \to V \times_Y X$. Then $U \to X$ is surjective \'etale
and the inverse image of $f^{-1}(E)$ in $U$ is the inverse
image of $\varphi^{-1}(E)$ by $U \to V$. Thus the lemma follows
from the case of schemes for $U \to V$
(Morphisms, Lemma \ref{morphisms-lemma-inverse-image-constructible})
and the definition (Properties of Spaces, Definition
\ref{spaces-properties-definition-locally-constructible}).
\end{proof}

\begin{theorem}[Chevalley's Theorem]
\label{theorem-chevalley}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Assume $f$ is quasi-compact and locally of finite presentation.
Then the image of every \'etale locally constructible subset of $|X|$ is
an \'etale locally constructible subset of $|Y|$.
\end{theorem}

\begin{proof}
Let $E \subset |X|$ be \'etale locally constructible.
Let $V \to Y$ be an \'etale morphism with $V$ affine.
It suffices to show that the inverse image of $f(E)$ in
$V$ is constructible, see Properties of Spaces, Definition
\ref{spaces-properties-definition-locally-constructible}.
Since $f$ is quasi-compact $V \times_Y X$ is a quasi-compact algebraic space.
Choose an affine scheme $U$ and a surjective \'etale morphism
$U \to V \times_Y X$ (Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}).
By Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-cartesian}
the inverse image of $f(E)$ in $V$ is the image under $U \to V$
of the inverse image of $E$ in $U$.
Thus the result follows from the case of schemes, see
Morphisms, Lemma \ref{morphisms-lemma-chevalley}.
\end{proof}







\section{Flat morphisms}
\label{section-flat}

\noindent
The property ``flat'' of morphisms of schemes is
\'etale local on the source-and-target, see
Descent, Remark \ref{descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-flat} and
Descent, Lemma \ref{descent-lemma-descending-property-flat}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define the notion of a flat morphism of algebraic spaces as
follows and it agrees with the already existing notion defined in
Section \ref{section-representable}
when the morphism is representable.

\begin{definition}
\label{definition-flat}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item We say $f$ is {\it flat} if the equivalent conditions of
Lemma \ref{lemma-local-source-target} with
$\mathcal{P} =$``flat''.
\item Let $x \in |X|$. We say $f$ is {\it flat at $x$} if the
equivalent conditions of
Lemma \ref{lemma-local-source-target-at-point}
holds with $\mathcal{Q} =$``induced map local rings is flat''.
\end{enumerate}
Note that the second part makes sense by
Descent, Lemma \ref{descent-lemma-flat-at-point}.
\end{definition}

\noindent
We do a quick sanity check.

\begin{lemma}
\label{lemma-flat-is-flat-at-all-points}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. Then $f$ is flat if and only if $f$ is flat at all points of $|X|$.
\end{lemma}

\begin{proof}
Choose a commutative diagram
$$
\xymatrix{
U \ar[d]_a \ar[r]_h & V \ar[d]^b \\
X \ar[r]^f & Y
}
$$
where $U$ and $V$ are schemes, the vertical arrows are \'etale, and
$a$ is surjective. By definition $f$ is flat if and only if $h$ is flat
(Definition \ref{definition-P}).
By definition $f$ is flat at $x \in |X|$ if and only if $h$ is flat
at some (equivalently any) $u \in U$ which maps to $x$
(Definition \ref{definition-P-at-point}).
Thus the lemma follows from the fact that a morphism of schemes
is flat if and only if it is flat at all points of the source
(Morphisms, Definition \ref{morphisms-definition-flat}).
\end{proof}

\begin{lemma}
\label{lemma-composition-flat}
The composition of flat morphisms is flat.
\end{lemma}

\begin{proof}
See Remark \ref{remark-composition-P} and
Morphisms, Lemma \ref{morphisms-lemma-composition-flat}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-flat}
The base change of a flat morphism is flat.
\end{lemma}

\begin{proof}
See Remark \ref{remark-base-change-P} and
Morphisms, Lemma \ref{morphisms-lemma-base-change-flat}.
\end{proof}

\begin{lemma}
\label{lemma-flat-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is flat,
\item for every $x \in |X|$ the morphism $f$ is flat at $x$,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is flat,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is flat,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is flat,
\item there exists a scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$ such that the composition $f \circ \varphi$
is flat,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes and the vertical arrows are \'etale
the top horizontal arrow is flat,
\item there exists a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes, the vertical arrows are \'etale, and
$U \to X$ is surjective such that the top horizontal arrow is flat, and
\item there exists a Zariski coverings $Y = \bigcup Y_i$ and
$f^{-1}(Y_i) = \bigcup X_{ij}$ such that
each morphism $X_{ij} \to Y_i$ is flat.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-fppf-open}
A flat morphism locally of finite presentation is universally open.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ be a flat morphism locally of finite presentation
of algebraic spaces over $S$. Choose a diagram
$$
\xymatrix{
U \ar[r]_\alpha \ar[d] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$ and $V$ are schemes and the vertical arrows are surjective and
\'etale, see
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.
By
Lemmas \ref{lemma-flat-local} and \ref{lemma-finite-presentation-local}
the morphism $\alpha$ is flat and locally of finite presentation.
Hence by
Morphisms, Lemma \ref{morphisms-lemma-fppf-open}
we see that $\alpha$ is universally open.
Hence $X \to Y$ is universally open according to
Lemma \ref{lemma-universally-open-local}.
\end{proof}

\begin{lemma}
\label{lemma-fpqc-quotient-topology}
Let $S$ be a scheme.
Let $f : X \to Y$ be a flat, quasi-compact, surjective morphism of
algebraic spaces over $S$.
A subset $T \subset |Y|$ is open (resp.\ closed) if and only
$f^{-1}(|T|)$ is open (resp.\ closed) in $|X|$.
In other words $f$ is submersive, and in fact universally submersive.
\end{lemma}

\begin{proof}
Choose affine schemes $V_i$ and \'etale morphisms $V_i \to Y$ such that
$V = \coprod V_i \to Y$ is surjective, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}.
For each $i$ the algebraic space $V_i \times_Y X$ is quasi-compact.
Hence we can find an affine scheme $U_i$ and a surjective \'etale morphism
$U_i \to V_i \times_Y X$, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-quasi-compact-affine-cover}.
Then the composition $U_i \to V_i \times_Y X \to V_i$ is a surjective,
flat morphism of affines.
Of course then $U = \coprod U_i \to X$ is surjective and \'etale
and $U = V \times_Y X$. Moreover, the morphism $U \to V$ is the
disjoint union of the morphisms $U_i \to V_i$. Hence $U \to V$ is surjective,
quasi-compact and flat. Consider the diagram
$$
\xymatrix{
U \ar[r] \ar[d] & X \ar[d] \\
V \ar[r] & Y
}
$$
By definition of the topology on $|Y|$ the set $T$ is closed
(resp.\ open) if and only if $g^{-1}(T) \subset |V|$ is closed
(resp.\ open). The same holds for
$f^{-1}(T)$ and its inverse image in $|U|$.
Since $U \to V$ is quasi-compact, surjective,  and flat we win by
Morphisms, Lemma \ref{morphisms-lemma-fpqc-quotient-topology}.
\end{proof}

\begin{lemma}
\label{lemma-flat-at-point-etale-local-rings}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $\overline{x}$ be a geometric point of $X$ lying over the point
$x \in |X|$. Let $\overline{y} = f \circ \overline{x}$. The following
are equivalent
\begin{enumerate}
\item $f$ is flat at $x$, and
\item the map on \'etale local rings
$\mathcal{O}_{Y, \overline{y}} \to \mathcal{O}_{X, \overline{x}}$
is flat.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a commutative diagram
$$
\xymatrix{
U \ar[d]_a \ar[r]_h & V \ar[d]^b \\
X \ar[r]^f & Y
}
$$
where $U$ and $V$ are schemes, $a, b$ are \'etale, and
$u \in U$ mapping to $x$. We can find a geometric point
$\overline{u} : \Spec(k) \to U$ lying over $u$ with
$\overline{x} = a \circ \overline{u}$, see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-geometric-lift-to-usual}.
Set $\overline{v} = h \circ \overline{u}$ with image $v \in V$.
We know that
$$
\mathcal{O}_{X, \overline{x}} = \mathcal{O}_{U, u}^{sh}
\quad\text{and}\quad
\mathcal{O}_{Y, \overline{y}} = \mathcal{O}_{V, v}^{sh}
$$
see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-describe-etale-local-ring}.
We obtain a commutative diagram
$$
\xymatrix{
\mathcal{O}_{U, u} \ar[r] &
\mathcal{O}_{X, \overline{x}} \\
\mathcal{O}_{V, v} \ar[u] \ar[r] &
\mathcal{O}_{Y, \overline{y}} \ar[u]
}
$$
of local rings with flat horizontal arrows. We have to show that the
left vertical arrow is flat if and only if the right vertical arrow is.
Algebra, Lemma \ref{algebra-lemma-flatness-descends-more-general}
tells us $\mathcal{O}_{U, u}$ is flat over $\mathcal{O}_{V, v}$
if and only if $\mathcal{O}_{X, \overline{x}}$ is flat over
$\mathcal{O}_{V, v}$. Hence the result follows from
More on Flatness, Lemma \ref{flat-lemma-flat-up-down-henselization}.
\end{proof}

\begin{lemma}
\label{lemma-flat-morphism-sites}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Then $f$ is flat if and only if the morphism of sites
$
(f_{small}, f^\sharp) :
(X_\etale, \mathcal{O}_X)
\to
(Y_\etale, \mathcal{O}_Y)
$
associated to $f$ is flat.
\end{lemma}

\begin{proof}
Flatness of $(f_{small}, f^\sharp)$ is defined in terms of
flatness of $\mathcal{O}_X$ as a $f_{small}^{-1}\mathcal{O}_Y$-module.
This can be checked at stalks, see
Modules on Sites, Lemma \ref{sites-modules-lemma-check-flat-stalks}
and
Properties of Spaces, Theorem \ref{spaces-properties-theorem-exactness-stalks}.
But we've already seen that flatness of $f$ can be checked on stalks, see
Lemma \ref{lemma-flat-at-point-etale-local-rings}.
\end{proof}

\begin{lemma}
\label{lemma-flat-pullback-support}
Let $S$ be a scheme. Let $f : Y \to X$ be a morphism of algebraic spaces
over $S$. Let $\mathcal{F}$ be a finite type quasi-coherent
$\mathcal{O}_X$-module with scheme theoretic support $Z \subset X$.
If $f$ is flat, then $f^{-1}(Z)$ is the scheme theoretic support of
$f^*\mathcal{F}$.
\end{lemma}

\begin{proof}
Using the characterization of the scheme theoretic support
as given in Lemma \ref{lemma-scheme-theoretic-support}
and using the characterization of flat morphisms in terms of
\'etale coverings in Lemma \ref{lemma-flat-local}
we reduce to the case of schemes which is
Morphisms, Lemma \ref{morphisms-lemma-flat-pullback-support}.
\end{proof}

\begin{lemma}
\label{lemma-flat-morphism-scheme-theoretically-dense-open}
Let $S$ be a scheme.
Let $f : X \to Y$ be a flat morphism of algebraic spaces over $S$.
Let $V \to Y$ be a quasi-compact open immersion. If $V$
is scheme theoretically dense in $Y$, then $f^{-1}V$
is scheme theoretically dense in $X$.
\end{lemma}

\begin{proof}
Using the characterization of scheme theoretically dense opens
in Lemma \ref{lemma-scheme-theoretically-dense}
and using the characterization of flat morphisms in terms of
\'etale coverings in Lemma \ref{lemma-flat-local}
we reduce to the case of schemes which is
Morphisms, Lemma
\ref{morphisms-lemma-flat-morphism-scheme-theoretically-dense-open}.
\end{proof}

\begin{lemma}
\label{lemma-flat-base-change-scheme-theoretic-image}
Let $S$ be a scheme. Let $f : X \to Y$ be a flat morphism of algebraic spaces
over $S$. Let $g : V \to Y$ be a quasi-compact morphism of algebraic spaces.
Let $Z \subset Y$ be the scheme theoretic image of $g$ and let $Z' \subset X$
be the scheme theoretic image of the base change $V \times_Y X \to X$.
Then $Z' = f^{-1}Z$.
\end{lemma}

\begin{proof}
Let $Y' \to Y$ be a surjective \'etale morphism such that $Y'$ is a
disjoint union of affine schemes (Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}).
Let $X' \to X \times_Y Y'$ be a surjective \'etale morphism such
that $X'$ is a disjoint union of affine schemes.
By Lemma \ref{lemma-flat-local} the morphism $X' \to Y'$ is flat.
Set $V' = V \times_Y Y'$.
By Lemma \ref{lemma-quasi-compact-scheme-theoretic-image}
the inverse image of $Z$ in $Y'$ is the scheme theoretic
image of $V' \to Y'$ and the inverse image of $Z'$ in $X'$
is the scheme theoretic image of $V' \times_{Y'} X' \to X'$.
Since $X' \to X$ is surjective \'etale, it suffices to prove
the result in the case of the morphisms $X' \to Y'$ and $V' \to Y'$.
Thus we may assume $X$ and $Y$ are affine schemes.
In this case $V$ is a quasi-compact algebraic space.
Choose an affine scheme $W$ and a surjective \'etale morphism
$W \to V$ (Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}).
It is clear that the scheme theoretic image of $V \to Y$
agrees with the scheme theoretic image of $W \to Y$ and
similarly for $V \times_Y X \to Y$ and $W \times_Y X \to X$.
Thus we reduce to the case of schemes which is
Morphisms, Lemma
\ref{morphisms-lemma-flat-base-change-scheme-theoretic-image}.
\end{proof}





\section{Flat modules}
\label{section-flat-modules}

\noindent
In this section we define what it means for a module to be flat at
a point. To do this we will use the notion of the stalk of a sheaf on
the small \'etale site $X_\etale$ of an algebraic space, see
Properties of Spaces, Definition \ref{spaces-properties-definition-stalk}.

\begin{lemma}
\label{lemma-flat-at-point}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic
spaces over $S$. Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Let $x \in |X|$. The following are equivalent
\begin{enumerate}
\item for some commutative diagram
$$
\xymatrix{
U \ar[d]_a \ar[r]_h & V \ar[d]^b \\
X \ar[r]^f & Y
}
$$
where $U$ and $V$ are schemes, $a, b$ are \'etale, and
$u \in U$ mapping to $x$ the module $a^*\mathcal{F}$ is flat at $u$ over $V$,
\item the stalk $\mathcal{F}_{\overline{x}}$ is flat over
the \'etale local ring $\mathcal{O}_{Y, \overline{y}}$
where $\overline{x}$ is any geometric point lying over
$x$ and $\overline{y} = f \circ \overline{x}$.
\end{enumerate}
\end{lemma}

\begin{proof}
During this proof we fix a geometric proof
$\overline{x} : \Spec(k) \to X$ over $x$ and
we denote $\overline{y} = f \circ \overline{x}$ its image in $Y$.
Given a diagram as in (1) we can find a geometric point
$\overline{u} : \Spec(k) \to U$ lying over $u$ with
$\overline{x} = a \circ \overline{u}$, see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-geometric-lift-to-usual}.
Set $\overline{v} = h \circ \overline{u}$ with image $v \in V$.
We know that
$$
\mathcal{O}_{X, \overline{x}} = \mathcal{O}_{U, u}^{sh}
\quad\text{and}\quad
\mathcal{O}_{Y, \overline{y}} = \mathcal{O}_{V, v}^{sh}
$$
see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-describe-etale-local-ring}.
We obtain a commutative diagram
$$
\xymatrix{
\mathcal{O}_{U, u} \ar[r] &
\mathcal{O}_{X, \overline{x}} \\
\mathcal{O}_{V, v} \ar[u] \ar[r] &
\mathcal{O}_{Y, \overline{y}} \ar[u]
}
$$
of local rings. Finally, we have
$$
\mathcal{F}_{\overline{x}} =
(\varphi^*\mathcal{F})_u \otimes_{\mathcal{O}_{U, u}}
\mathcal{O}_{X, \overline{x}}
$$
by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-stalk-quasi-coherent}.
Thus
Algebra, Lemma \ref{algebra-lemma-flatness-descends-more-general}
tells us $(\varphi^*\mathcal{F})_u$ is flat over $\mathcal{O}_{V, v}$
if and only if $\mathcal{F}_{\overline{x}}$ is flat over $\mathcal{O}_{V, v}$.
Hence the result follows from
More on Flatness, Lemma \ref{flat-lemma-flat-up-down-henselization}.
\end{proof}

\begin{definition}
\label{definition-flat-module}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
\begin{enumerate}
\item Let $x \in |X|$. We say $\mathcal{F}$ is {\it flat at $x$ over $Y$}
if the equivalent conditions of
Lemma \ref{lemma-flat-at-point}
hold.
\item We say $\mathcal{F}$ is {\it flat over $Y$} if $\mathcal{F}$ is
flat over $Y$ at all $x \in |X|$.
\end{enumerate}
\end{definition}

\noindent
Having defined this we have the obligatory base change lemma.
This lemma implies that formation of the flat locus of a quasi-coherent
sheaf commutes with flat base change.

\begin{lemma}
\label{lemma-base-change-module-flat}
Let $S$ be a scheme. Let
$$
\xymatrix{
X' \ar[d]_{f'} \ar[r]_{g'} & X \ar[d]^f \\
Y' \ar[r]^g & Y
}
$$
be a cartesian diagram of algebraic spaces over $S$. Let $x' \in |X'|$
with image $x \in |X|$. Let $\mathcal{F}$ be a quasi-coherent
sheaf on $X$ and denote $\mathcal{F}' = (g')^*\mathcal{F}$.
\begin{enumerate}
\item If $\mathcal{F}$ is flat at $x$ over $Y$
then $\mathcal{F}'$ is flat at $x'$ over $Y'$.
\item If $g$ is flat at $f'(x')$ and
$\mathcal{F}'$ is flat at $x'$ over $Y'$, then
$\mathcal{F}$ is flat at $x$ over $Y$.
\end{enumerate}
In particular, if $\mathcal{F}$ is flat over $Y$, then
$\mathcal{F}'$ is flat over $Y'$.
\end{lemma}

\begin{proof}
Choose a scheme $V$ and a surjective \'etale morphism $V \to Y$.
Choose a scheme $U$ and a surjective \'etale morphism $U \to V \times_Y X$.
Choose a scheme $V'$ and a surjective \'etale morphism $V' \to V \times_Y Y'$.
Then $U' = V' \times_V U$ is a scheme endowed with a surjective \'etale
morphism $U' = V' \times_V U \to Y' \times_Y X = X'$. Pick $u' \in U'$
mapping to $x' \in |X'|$. Then we can check flatness of
$\mathcal{F}'$ at $x'$ over $Y'$ in terms of flatness of
$\mathcal{F}'|_{U'}$ at $u'$ over $V'$. Hence the lemma follows from
More on Morphisms, Lemma \ref{more-morphisms-lemma-flat-locus-base-change}.
\end{proof}

\noindent
The following lemma discusses ``composition'' of flat morphisms in
terms of modules. It also shows that flatness satisfies a kind of
top down descent.

\begin{lemma}
\label{lemma-composition-module-flat}
Let $S$ be a scheme. Let $X \to Y \to Z$ be morphisms of algebraic spaces
over $S$. Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Let $x \in |X|$ with image $y \in |Y|$.
\begin{enumerate}
\item If $\mathcal{F}$ is flat at $x$ over $Y$ and
$Y$ is flat at $y$ over $Z$, then $\mathcal{F}$ is flat at
$x$ over $Z$.
\item Let $x : \Spec(K) \to X$ be a representative of $x$. If
\begin{enumerate}
\item $\mathcal{F}$ is flat at $x$ over $Y$,
\item $x^*\mathcal{F} \not = 0$, and
\item $\mathcal{F}$ is flat at $x$ over $Z$,
\end{enumerate}
then $Y$ is flat at $y$ over $Z$.
\item Let $\overline{x}$ be a geometric point of $X$ lying over $x$
with image $\overline{y}$ in $Y$. If $\mathcal{F}_{\overline{x}}$ is a
faithfully flat $\mathcal{O}_{Y, \overline{y}}$-module and
$\mathcal{F}$ is flat at $x$ over $Z$, then
$Y$ is flat at $y$ over $Z$.
\end{enumerate}
\end{lemma}

\begin{proof}
Pick $\overline{x}$ and $\overline{y}$ as in part (3) and denote
$\overline{z}$ the induced geometric point of $Z$. Via the
characterization of flatness in
Lemmas \ref{lemma-flat-at-point} and
\ref{lemma-flat-at-point-etale-local-rings}
the lemma reduces to a purely algebraic question on the local
ring map $\mathcal{O}_{Z, \overline{z}} \to \mathcal{O}_{Y, \overline{y}}$
and the module $\mathcal{F}_{\overline{x}}$.
Part (1) follows from
Algebra, Lemma \ref{algebra-lemma-composition-flat}.
We remark that condition (2)(b) guarantees that
$\mathcal{F}_{\overline{x}}/
\mathfrak m_{\overline{y}} \mathcal{F}_{\overline{x}}$
is nonzero. Hence (2)(a) $+$ (2)(b) imply that $\mathcal{F}_{\overline{x}}$
is a faithfully flat $\mathcal{O}_{Y, \overline{y}}$-module, see
Algebra, Lemma \ref{algebra-lemma-ff}.
Thus (2) is a special case of (3).
Finally, (3) follows from
Algebra, Lemma \ref{algebra-lemma-flat-permanence}.
\end{proof}

\noindent
Sometimes the base change happens ``up on top''. Here is a precise statement.

\begin{lemma}
\label{lemma-flat-permanence}
Let $S$ be a scheme. Let $f : X \to Y$, $g : Y \to Z$ be morphisms of
algebraic spaces over $S$. Let $\mathcal{G}$ be a quasi-coherent sheaf on $Y$.
Let $x \in |X|$ with image $y \in |Y|$.
If $f$ is flat at $x$, then
$$
\mathcal{G}\text{ flat over }Z\text{ at }y
\Leftrightarrow
f^*\mathcal{G}\text{ flat over }Z\text{ at }x.
$$
In particular: If $f$ is surjective and flat, then
$\mathcal{G}$ is flat over $Z$, if and only if
$f^*\mathcal{G}$ is flat over $Z$.
\end{lemma}

\begin{proof}
Pick a geometric point $\overline{x}$ of $X$ and denote
$\overline{y}$ the image in $Y$ and $\overline{z}$ the image in $Z$.
Via the characterization of flatness in
Lemmas \ref{lemma-flat-at-point} and
\ref{lemma-flat-at-point-etale-local-rings}
and the description of the stalk of $f^*\mathcal{G}$ at $\overline{x}$ of
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-stalk-pullback-quasi-coherent}
the lemma reduces to a purely algebraic question on the local
ring maps
$\mathcal{O}_{Z, \overline{z}} \to \mathcal{O}_{Y, \overline{y}}
\to \mathcal{O}_{X, \overline{x}}$
and the module $\mathcal{G}_{\overline{y}}$.
This algebraic statement is
Algebra, Lemma \ref{algebra-lemma-flatness-descends-more-general}.
\end{proof}

\begin{lemma}
\label{lemma-pf-flat-module-open}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume $f$ locally finite presentation, $\mathcal{F}$ of
finite type, $X = \text{Supp}(\mathcal{F})$, and
$\mathcal{F}$ flat over $Y$. Then $f$ is universally open.
\end{lemma}

\begin{proof}
Choose a surjective \'etale morphism $\varphi : V \to Y$ where $V$ is a scheme.
Choose a surjective \'etale morphism $U \to V \times_Y X$ where $U$ is a scheme.
Then it suffices to prove the lemma for $U \to V$ and the quasi-coherent
$\mathcal{O}_V$-module $\varphi^*\mathcal{F}$.
Hence this lemma follows from the case of schemes, see
Morphisms, Lemma \ref{morphisms-lemma-pf-flat-module-open}.
\end{proof}






\section{Generic flatness}
\label{section-generic-flatness}

\noindent
This section is the analogue of
Morphisms, Section \ref{morphisms-section-generic-flatness}.

\begin{proposition}
\label{proposition-generic-flatness-reduced}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $\mathcal{F}$ be a quasi-coherent sheaf of $\mathcal{O}_X$-modules.
Assume
\begin{enumerate}
\item $Y$ is reduced,
\item $f$ is of finite type, and
\item $\mathcal{F}$ is a finite type $\mathcal{O}_X$-module.
\end{enumerate}
Then there exists an open dense subspace $W \subset Y$ such that
the base change $X_W \to W$ of $f$ is flat, locally of finite presentation, and
quasi-compact and such that $\mathcal{F}|_{X_W}$ is flat over $W$ and of
finite presentation over $\mathcal{O}_{X_W}$.
\end{proposition}

\begin{proof}
Let $V$ be a scheme and let $V \to Y$ be a surjective \'etale morphism.
Let $X_V = V \times_Y X$ and let $\mathcal{F}_V$ be the restriction of
$\mathcal{F}$ to $X_V$. Suppose that the result holds for the morphism
$X_V \to V$ and the sheaf $\mathcal{F}_V$. Then there exists an open subscheme
$V' \subset V$ such that $X_{V'} \to V'$ is flat and of finite presentation
and $\mathcal{F}_{V'}$ is an $\mathcal{O}_{X_{V'}}$-module of finite
presentation flat over $V'$. Let $W \subset Y$ be the image of
the \'etale morphism $V' \to Y$, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-image-open}.
Then $V' \to W$ is a surjective \'etale morphism, hence we see that
$X_W \to W$ is flat, locally of finite presentation, and quasi-compact by
Lemmas \ref{lemma-finite-presentation-local},
\ref{lemma-flat-local}, and
\ref{lemma-quasi-compact-local}.
By the discussion in
Properties of Spaces, Section
\ref{spaces-properties-section-properties-modules}
we see that $\mathcal{F}_W$ is of finite presentation as a
$\mathcal{O}_{X_W}$-module and by
Lemma \ref{lemma-base-change-module-flat}
we see that $\mathcal{F}_W$ is flat over $W$. This argument
reduces the proposition to the case where $Y$ is a scheme.

\medskip\noindent
Suppose we can prove the proposition when $Y$ is an affine scheme.
Let $f : X \to Y$ be a finite type morphism of algebraic spaces
over $S$ with $Y$ a scheme, and let $\mathcal{F}$ be a finite type,
quasi-coherent $\mathcal{O}_X$-module. Choose an affine open covering
$Y = \bigcup V_j$. By assumption we can find dense open $W_j \subset V_j$
such that $X_{W_j} \to W_j$ is flat, locally of finite presentation, and
quasi-compact and such that $\mathcal{F}|_{X_{W_j}}$ is flat over $W_j$
and of finite presentation as an $\mathcal{O}_{X_{W_j}}$-module. In this
situation we simply take $W = \bigcup W_j$ and we win. Hence we reduce
the proposition to the case where $Y$ is an affine scheme.

\medskip\noindent
Let $Y$ be an affine scheme over $S$, let
$f : X \to Y$ be a finite type morphism of algebraic spaces
over $S$, and let $\mathcal{F}$ be a finite type,
quasi-coherent $\mathcal{O}_X$-module. Since $f$ is of finite type
it is quasi-compact, hence $X$ is quasi-compact. Thus we can find
an affine scheme $U$ and a surjective \'etale morphism $U \to X$, see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}.
Note that $U \to Y$ is of finite type (this is what it means for
$f$ to be of finite type in this case). Hence we can apply
Morphisms, Proposition \ref{morphisms-proposition-generic-flatness-reduced}
to see that there exists a dense open $W \subset Y$ such that
$U_W \to W$ is flat and of finite presentation and such that
$\mathcal{F}|_{U_W}$ is flat over $W$ and of finite presentation
as an $\mathcal{O}_{U_W}$-module. According to our definitions this means that
the base change $X_W \to W$ of $f$ is flat, locally of finite presentation,
and quasi-compact and $\mathcal{F}|_{X_W}$ is flat over $W$ and of
finite presentation over $\mathcal{O}_{X_W}$.
\end{proof}

\noindent
We cannot improve the result of the lemma above to requiring
$X_W \to W$ to be of finite presentation as
$\mathbf{A}^1_{\mathbf{Q}}/\mathbf{Z} \to \Spec(\mathbf{Q})$
gives a counter example. The problem is that the diagonal morphism
$\Delta_{X/Y}$ may not be quasi-compact, i.e., $f$ may not be
quasi-separated. Clearly, this is also the only problem.

\begin{proposition}
\label{proposition-generic-flatness-reduced-quasi-separated}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $\mathcal{F}$ be a quasi-coherent sheaf of $\mathcal{O}_X$-modules.
Assume
\begin{enumerate}
\item $Y$ is reduced,
\item $f$ is quasi-separated,
\item $f$ is of finite type, and
\item $\mathcal{F}$ is a finite type $\mathcal{O}_X$-module.
\end{enumerate}
Then there exists an open dense subspace $W \subset Y$ such that
the base change $X_W \to W$ of $f$ is flat and of finite presentation
and such that $\mathcal{F}|_{X_W}$ is flat over $W$ and of
finite presentation over $\mathcal{O}_{X_W}$.
\end{proposition}

\begin{proof}
This follows immediately from
Proposition \ref{proposition-generic-flatness-reduced}
and the fact that ``of finite presentation'' $=$
``locally of finite presentation'' $+$ ``quasi-compact'' $+$
``quasi-separated''.
\end{proof}















\section{Relative dimension}
\label{section-relative-dimension}

\noindent
In this section we define the relative dimension
of a morphism of algebraic spaces at a point, and some closely
related properties.

\begin{definition}
\label{definition-dimension-fibre}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $x \in |X|$.
Let $d, r \in \{0, 1, 2, \ldots, \infty\}$.
\begin{enumerate}
\item We say the
{\it dimension of the local ring of the fibre of $f$ at $x$} is $d$
if the equivalent conditions of
Lemma \ref{lemma-local-source-target-at-point}
hold for the property
$\mathcal{P}_d$ described in
Descent, Lemma \ref{descent-lemma-dimension-local-ring-fibre}.
\item We say the
{\it transcendence degree of $x/f(x)$} is $r$
if the equivalent conditions of
Lemma \ref{lemma-local-source-target-at-point}
hold for the property
$\mathcal{P}_r$ described in
Descent, Lemma \ref{descent-lemma-transcendence-degree-at-point}.
\item We say
{\it $f$ has relative dimension $d$ at $x$}
if the equivalent conditions of
Lemma \ref{lemma-local-source-target-at-point}
hold for the property
$\mathcal{P}_d$ described in
Descent, Lemma \ref{descent-lemma-dimension-at-point}.
\end{enumerate}
\end{definition}

\noindent
Let us spell out what this means. Namely, choose some
diagrams
$$
\xymatrix{
U \ar[d]_a \ar[r]_h & V \ar[d]^b \\
X \ar[r]^f & Y
}
\quad\quad
\xymatrix{
u \ar[d] \ar[r] & v \ar[d] \\
x \ar[r] & y
}
$$
as in
Lemma \ref{lemma-local-source-target-at-point}.
Then we have
$$
\begin{matrix}
\text{relative dimension of }f\text{ at }x & = &
\dim_u (U_v) \\
\text{dimension of local ring of the fibre of }f\text{ at }x & = &
\dim(\mathcal{O}_{U_v, u})\\
\text{transcendence degree of }x/f(x) & = &
\text{trdeg}_{\kappa(v)}(\kappa(u))
\end{matrix}
$$
Note that if $Y = \Spec(k)$ is the spectrum of a field, then
the relative dimension of $X/Y$ at $x$ is the same as $\dim_x(X)$,
the transcendence degree of $x/f(x)$ is the transcendence degree
over $k$, and the dimension of the local ring of the fibre of $f$
at $x$ is just the dimension of the local ring at $x$, i.e., the
relative notions become absolute notions in that case.

\begin{definition}
\label{definition-relative-dimension}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $d \in \{0, 1, 2, \ldots\}$.
\begin{enumerate}
\item We say $f$ has {\it relative dimension $\leq d$} if
$f$ has relative dimension $\leq d$ at all $x \in |X|$.
\item We say $f$ has {\it relative dimension $d$} if
$f$ has relative dimension $d$ at all $x \in |X|$.
\end{enumerate}
\end{definition}

\noindent
Having relative dimension {\it equal} to $d$ means roughly speaking that all
nonempty fibres are equidimensional of dimension $d$.

\begin{lemma}
\label{lemma-compare-tr-deg}
Let $S$ be a scheme. Let $X \to Y \to Z$ be morphisms of algebraic
spaces over $S$. Let $x \in |X|$ and let $y \in |Y|$, $z \in |Z|$
be the images. Assume $X \to Y$ is locally quasi-finite and $Y \to Z$
locally of finite type. Then the transcendence degree of $x/z$
is equal to the transcendence degree of $y/z$.
\end{lemma}

\begin{proof}
We can choose commutative diagrams
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \ar[r] & W \ar[d] \\
X \ar[r] & Y \ar[r] & Z
}
\quad\quad
\xymatrix{
u \ar[d] \ar[r] & v \ar[d] \ar[r] & w \ar[d] \\
x \ar[r] & y \ar[r] & z
}
$$
where $U, V, W$ are schemes and the vertical arrows are \'etale.
By definition the morphism $U \to V$ is locally quasi-finite
which implies that $\kappa(v) \subset \kappa(u)$ is finite, see
Morphisms, Lemma \ref{morphisms-lemma-residue-field-quasi-finite}.
Hence the result is clear.
\end{proof}

\begin{lemma}
\label{lemma-jacobson-finite-type-points}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. If $f$ is locally of finite type, $Y$ is Jacobson
(Properties of Spaces, Remark
\ref{spaces-properties-remark-list-properties-local-etale-topology}),
and $x \in |X|$ is a finite type point of $X$,
then the transcendence degree of $x/f(x)$ is $0$.
\end{lemma}

\begin{proof}
Choose a scheme $V$ and a surjective \'etale morphism $V \to Y$.
Choose a scheme $U$ and a surjective \'etale morphism $U \to X \times_Y V$.
By Lemma \ref{lemma-finite-type-points-surjective-morphism}
we can find a finite type point $u \in U$ mapping to $x$.
After shrinking $U$ we may assume $u \in U$ is closed
(Morphisms, Lemma \ref{morphisms-lemma-identify-finite-type-points}).
Let $v \in V$ be the image of $u$. By
Morphisms, Lemma \ref{morphisms-lemma-jacobson-finite-type-points}
the extension $\kappa(u)/\kappa(v)$ is finite.
This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-rel-dimension-dimension}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of locally Noetherian
algebraic spaces over $S$ which is flat, locally of finite type and of
relative dimension $d$. For every point $x$ in $|X|$ with image
$y$ in $|Y|$ we have $\dim_x(X) = \dim_y(Y) + d$.
\end{lemma}

\begin{proof}
By definition of the dimension of an algebraic space
at a point (Properties of Spaces, Definition
\ref{spaces-properties-definition-dimension-at-point})
and by definition of having relative dimension $d$,
this reduces to the corresponding statement for schemes
(Morphisms, Lemma \ref{morphisms-lemma-rel-dimension-dimension}).
\end{proof}







\section{Morphisms and dimensions of fibres}
\label{section-dimension-fibres}

\noindent
This section is the analogue of
Morphisms, Section \ref{morphisms-section-dimension-fibres}.
The formulations in this section are a bit awkward since
we do not have local rings of algebraic spaces at points.

\begin{lemma}
\label{lemma-dimension-fibre-at-a-point}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $x \in |X|$.
Assume $f$ is locally of finite type.
Then we have
$$
\begin{matrix}
\text{relative dimension of }f\text{ at }x \\
= \\
\text{dimension of local ring of the fibre of }f\text{ at }x \\
+ \\
\text{transcendence degree of }x/f(x)
\end{matrix}
$$
where the notation is as in
Definition \ref{definition-dimension-fibre}.
\end{lemma}

\begin{proof}
This follows immediately from
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-at-a-point}
applied to $h : U \to V$ and $u \in U$
as in
Lemma \ref{lemma-local-source-target-at-point}.
\end{proof}

\begin{lemma}
\label{lemma-dimension-fibre-at-a-point-additive}
Let $S$ be a scheme.
Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of algebraic spaces over $S$.
Let $x \in |X|$ and set $y = f(x)$.
Assume $f$ and $g$ locally of finite type.
Then
\begin{enumerate}
\item
$$
\begin{matrix}
\text{relative dimension of }g \circ f\text{ at }x \\
\leq \\
\text{relative dimension of }f\text{ at }x \\
+ \\
\text{relative dimension of }g\text{ at }y
\end{matrix}
$$
\item equality holds in (1) if for some morphism $\Spec(k) \to Z$
from the spectrum of a field in the class of $g(f(x)) = g(y)$
the morphism $X_k \to Y_k$ is flat at $x$, for example if $f$ is flat at $x$,
\item
$$
\begin{matrix}
\text{transcendence degree of }x/g(f(x)) \\
= \\
\text{transcendence degree of }x/f(x) \\
+ \\
\text{transcendence degree of }f(x)/g(f(x))
\end{matrix}
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \ar[r] & W \ar[d] \\
X \ar[r] & Y \ar[r] & Z
}
$$
with $U, V, W$ schemes and vertical arrows \'etale and surjective. (See
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.)
Choose $u \in U$ mapping to $x$. Set $v, w$ equal to the images
of $u$ in $V, W$.
Apply
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-at-a-point-additive}
to the top row and the points $u, v, w$. Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-dimension-fibre-after-base-change}
Let $S$ be a scheme. Let
$$
\xymatrix{
X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\
Y' \ar[r]^g & Y
}
$$
be a fibre product diagram of algebraic spaces over $S$.
Let $x' \in |X'|$. Set $x = g'(x')$. Assume $f$ locally of finite type.
Then
\begin{enumerate}
\item
$$
\begin{matrix}
\text{relative dimension of }f\text{ at }x \\
= \\
\text{relative dimension of }f'\text{ at }x'
\end{matrix}
$$
\item we have
$$
\begin{matrix}
\text{dimension of local ring of the fibre of }f'\text{ at }x' \\
- \\
\text{dimension of local ring of the fibre of }f\text{ at }x \\
= \\
\text{transcendence degree of }x/f(x) \\
- \\
\text{transcendence degree of }x'/f'(x')
\end{matrix}
$$
and the common value is $\geq 0$,
\item given $x$ and $y' \in |Y'|$ mapping to the same $y \in |Y|$
there exists a choice of $x'$ such that the integer in (2) is $0$.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a surjective \'etale morphism $V \to Y$ with $V$ a scheme.
Choose a surjective \'etale morphism $U \to V \times_Y X$ with $U$ a scheme.
Choose a surjective \'etale morphism $V' \to V \times_Y Y'$ with $V'$ a scheme.
Set $U' = V' \times_V U$.
Then the induced morphism $U' \to X'$ is also surjective and
\'etale (argument omitted). Choose $u' \in U'$
mapping to $x'$. At this point parts (1) and (2) follow by applying
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-after-base-change}
to the diagram of schemes involving $U', U, V', V$ and the point $u'$.
To prove (3) first choose $v \in V$ mapping to $y$.
Then using Properties of Spaces, Lemma
\ref{spaces-properties-lemma-points-cartesian}
we can choose $v' \in V'$ mapping to $y'$ and $v$ and
$u \in U$ mapping to $x$ and $v$. Finally, according to
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-after-base-change}
we can choose $u' \in U'$ mapping to $v'$ and $u$ such that
the integer is zero. Then taking $x' \in |X'|$ the image of $u'$ works.
\end{proof}

\begin{lemma}
\label{lemma-openness-bounded-dimension-fibres}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $n \geq 0$. Assume $f$ is locally of finite type.
The set
$$
W_n = \{x \in |X|
\text{ such that the relative dimension of }f\text{ at } x \leq n\}
$$
is open in $|X|$.
\end{lemma}

\begin{proof}
Choose a diagram
$$
\xymatrix{
U \ar[r]_h \ar[d]_a & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$ and $V$ are schemes and the vertical arrows are surjective and
\'etale, see
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.
By
Morphisms, Lemma \ref{morphisms-lemma-openness-bounded-dimension-fibres}
the set $U_n$ of points where $h$ has relative dimension
$\leq n$ is open in $U$. By our definition of relative dimension
for morphisms of algebraic spaces at points we see that
$U_n = a^{-1}(W_n)$.
The lemma follows by definition of the topology on $|X|$.
\end{proof}

\begin{lemma}
\label{lemma-openness-bounded-dimension-fibres-finite-presentation}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$
Let $n \geq 0$. Assume $f$ is locally of finite presentation.
The open
$$
W_n = \{x \in |X|
\text{ such that the relative dimension of }f\text{ at } x \leq n\}
$$
of Lemma \ref{lemma-openness-bounded-dimension-fibres}
is retrocompact in $|X|$. (See
Topology, Definition \ref{topology-definition-quasi-compact}.)
\end{lemma}

\begin{proof}
Choose a diagram
$$
\xymatrix{
U \ar[r]_h \ar[d]_a & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$ and $V$ are schemes and the vertical arrows are surjective and
\'etale, see
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.
In the proof of
Lemma \ref{lemma-openness-bounded-dimension-fibres}
we have seen that $a^{-1}(W_n) = U_n$ is the corresponding set
for the morphism $h$. By
Morphisms, Lemma
\ref{morphisms-lemma-openness-bounded-dimension-fibres-finite-presentation}
we see that $U_n$ is retrocompact in $U$.
The lemma follows by definition of the topology on $|X|$, compare with
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-space-locally-quasi-compact}
and its proof.
\end{proof}

\begin{lemma}
\label{lemma-locally-quasi-finite-rel-dimension-0}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Assume $f$ is locally of finite type.
Then $f$ is locally quasi-finite if and only if $f$ has relative
dimension $0$ at each $x \in |X|$.
\end{lemma}

\begin{proof}
Choose a diagram
$$
\xymatrix{
U \ar[r]_h \ar[d]_a & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$ and $V$ are schemes and the vertical arrows are surjective and
\'etale, see
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.
The definitions imply that
$h$ is locally quasi-finite if and only if $f$ is locally quasi-finite,
and that $f$ has relative dimension $0$ at all $x \in |X|$ if and
only if $h$ has relative dimension $0$ at all $u \in U$.
Hence the result follows from the result for $h$ which is
Morphisms, Lemma \ref{morphisms-lemma-locally-quasi-finite-rel-dimension-0}.
\end{proof}

\begin{lemma}
\label{lemma-locally-finite-type-quasi-finite-part}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Assume $f$ is locally of finite type.
Then there exists a canonical open subspace $X' \subset X$ such that
$f|_{X'} : X' \to Y$ is locally quasi-finite, and such that the
relative dimension of $f$ at any $x \in |X|$, $x \not \in |X'|$ is
$\geq 1$. Formation of $X'$ commutes with arbitrary base change.
\end{lemma}

\begin{proof}
Combine
Lemmas \ref{lemma-openness-bounded-dimension-fibres},
\ref{lemma-locally-quasi-finite-rel-dimension-0}, and
\ref{lemma-dimension-fibre-after-base-change}.
\end{proof}

\begin{lemma}
\label{lemma-quasi-finite-at-point}
Let $S$ be a scheme. Consider a cartesian diagram
$$
\xymatrix{
X \ar[d] & F \ar[l]^p \ar[d] \\
Y & \Spec(k) \ar[l]
}
$$
where $X \to Y$ is a morphism of algebraic spaces over $S$ which is
locally of finite type and where $k$ is a field over $S$.
Let $z \in |F|$ be such that $\dim_z(F) = 0$. Then, after replacing $X$
by an open subspace containing $p(z)$, the morphism
$$
X \longrightarrow Y
$$
is locally quasi-finite.
\end{lemma}

\begin{proof}
Let $X' \subset X$ be the open subspace over which $f$ is locally quasi-finite
found in
Lemma \ref{lemma-locally-finite-type-quasi-finite-part}.
Since the formation of $X'$ commutes with arbitrary base change we see
that $z \in X' \times_Y \Spec(k)$. Hence the lemma is clear.
\end{proof}





\section{The dimension formula}
\label{section-dimension-formula}

\noindent
The analog of the dimension formula
(Morphisms, Lemma \ref{morphisms-lemma-dimension-formula})
is a bit tricky to formulate, because we would have to define
integral algebraic spaces (we do this later) as well as
universally catenary algebraic spaces. However, the
following version is straightforward.

\begin{lemma}
\label{lemma-dimension-formula-general}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic
spaces over $S$. Assume $Y$ is locally Noetherian and $f$ locally
of finite type. Let $x \in |X|$ with image $y \in |Y|$.
Then we have
\begin{align*}
& \text{the dimension of the local ring of }X\text{ at }x \leq \\
& \text{the dimension of the local ring of }Y\text{ at }y + E - \\
& \text{ the transcendence degree of }x/y
\end{align*}
Here $E$ is the maximum of the transcendence degrees of $\xi/f(\xi)$
where $\xi \in |X|$ runs over the points specializing to $x$ at
which the local ring of $X$ has dimension $0$.
\end{lemma}

\begin{proof}
Choose an affine scheme $V$, an \'etale morphism $V \to Y$, and a point
$v \in V$ mapping to $y$. Choose an affine scheme $U$ , an \'etale morphism
$U \to X \times_Y V$ and a point $u \in U$ mapping to $v$ in $V$ and $x$
in $X$. Unwinding Definition \ref{definition-dimension-fibre} and
Properties of Spaces, Definition
\ref{spaces-properties-definition-dimension-local-ring}
we have to show that
$$
\dim(\mathcal{O}_{U, u}) \leq
\dim(\mathcal{O}_{V, v}) + E - \text{trdeg}_{\kappa(v)}(\kappa(u))
$$
Let $\xi_U \in U$ be a generic point of an irreducible component of
$U$ which contains $u$. Then $\xi_U$ maps to a point $\xi \in |X|$
which is in the list used to define the quantity $E$ and in fact
every $\xi$ used in the definition of $E$ occurs in this manner
(small detail omitted). In particular, there are only a finite
number of these $\xi$ and we can take the maximum (i.e., it really
is a maximum and not a supremum).
The transcendence degree of $\xi$ over $f(\xi)$ is
$\text{trdeg}_{\kappa(\xi_V)}(\kappa(\xi_U))$ where $\xi_V \in V$
is the image of $\xi_U$. Thus the lemma follows from
Morphisms, Lemma \ref{morphisms-lemma-dimension-formula-general}.
\end{proof}

\begin{lemma}
\label{lemma-alteration-dimension-general}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$. Assume
$Y$ is locally Noetherian and $f$ is locally of finite type.
Then
$$
\dim(X) \leq \dim(Y) + E
$$
where $E$ is the supremum of the transcendence degrees of
$\xi/f(\xi)$ where $\xi$ runs through the points at
which the local ring of $X$ has dimension $0$.
\end{lemma}

\begin{proof}
Immediate consequence of Lemma \ref{lemma-dimension-formula-general}
and Properties of Spaces, Lemma \ref{spaces-properties-lemma-dimension}.
\end{proof}







\section{Syntomic morphisms}
\label{section-syntomic}

\noindent
The property ``syntomic'' of morphisms of schemes is
\'etale local on the source-and-target, see
Descent, Remark \ref{descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-syntomic} and
Descent, Lemma \ref{descent-lemma-descending-property-syntomic}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define the notion of a syntomic morphism of algebraic spaces as
follows and it agrees with the already existing notion defined in
Section \ref{section-representable}
when the morphism is representable.

\begin{definition}
\label{definition-syntomic}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item We say $f$ is {\it syntomic} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold with $\mathcal{P} =$``syntomic''.
\item Let $x \in |X|$. We say $f$ is {\it syntomic at $x$} if
there exists an open neighbourhood $X' \subset X$ of $x$ such
that $f|_{X'} : X' \to Y$ is syntomic.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-composition-syntomic}
The composition of syntomic morphisms is syntomic.
\end{lemma}

\begin{proof}
See Remark \ref{remark-composition-P} and
Morphisms, Lemma \ref{morphisms-lemma-composition-syntomic}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-syntomic}
The base change of a syntomic morphism is syntomic.
\end{lemma}

\begin{proof}
See Remark \ref{remark-base-change-P} and
Morphisms, Lemma \ref{morphisms-lemma-base-change-syntomic}.
\end{proof}

\begin{lemma}
\label{lemma-syntomic-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is syntomic,
\item for every $x \in |X|$ the morphism $f$ is syntomic at $x$,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is syntomic,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is syntomic,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is a syntomic morphism,
\item there exists a scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$ such that the composition $f \circ \varphi$
is syntomic,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes and the vertical arrows are \'etale
the top horizontal arrow is syntomic,
\item there exists a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes, the vertical arrows are \'etale, and
$U \to X$ is surjective such that the top horizontal arrow is syntomic, and
\item there exist Zariski coverings $Y = \bigcup_{i \in I} Y_i$,
and $f^{-1}(Y_i) = \bigcup X_{ij}$ such that
each morphism $X_{ij} \to Y_i$ is syntomic.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-syntomic-locally-finite-presentation}
A syntomic morphism is locally of finite presentation.
\end{lemma}

\begin{proof}
Follows immediately from the case of schemes
(Morphisms, Lemma \ref{morphisms-lemma-syntomic-locally-finite-presentation}).
\end{proof}

\begin{lemma}
\label{lemma-syntomic-flat}
A syntomic morphism is flat.
\end{lemma}

\begin{proof}
Follows immediately from the case of schemes
(Morphisms, Lemma \ref{morphisms-lemma-syntomic-flat}).
\end{proof}

\begin{lemma}
\label{lemma-syntomic-open}
A syntomic morphism is universally open.
\end{lemma}

\begin{proof}
Combine
Lemmas \ref{lemma-syntomic-locally-finite-presentation},
\ref{lemma-syntomic-flat}, and
\ref{lemma-fppf-open}.
\end{proof}





\section{Smooth morphisms}
\label{section-smooth}

\noindent
The property ``smooth'' of morphisms of schemes is
\'etale local on the source-and-target, see
Descent, Remark \ref{descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-smooth}
and
Descent, Lemma \ref{descent-lemma-descending-property-smooth}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define the notion of a smooth morphism of algebraic spaces as
follows and it agrees with the already existing notion defined in
Section \ref{section-representable}
when the morphism is representable.

\begin{definition}
\label{definition-smooth}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item We say $f$ is {\it smooth} if the equivalent conditions of
Lemma \ref{lemma-local-source-target} hold with
$\mathcal{P} =$``smooth''.
\item Let $x \in |X|$. We say $f$ is {\it smooth at $x$} if there exists
an open neighbourhood $X' \subset X$ of $x$ such that $f|_{X'} : X' \to Y$
is smooth.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-composition-smooth}
The composition of smooth morphisms is smooth.
\end{lemma}

\begin{proof}
See Remark \ref{remark-composition-P} and
Morphisms, Lemma \ref{morphisms-lemma-composition-smooth}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-smooth}
The base change of a smooth morphism is smooth.
\end{lemma}

\begin{proof}
See Remark \ref{remark-base-change-P} and
Morphisms, Lemma \ref{morphisms-lemma-base-change-smooth}.
\end{proof}

\begin{lemma}
\label{lemma-smooth-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is smooth,
\item for every $x \in |X|$ the morphism $f$ is smooth at $x$,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is smooth,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is smooth,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is a smooth morphism,
\item there exists a scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$ such that the composition $f \circ \varphi$
is smooth,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes and the vertical arrows are \'etale
the top horizontal arrow is smooth,
\item there exists a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes, the vertical arrows are \'etale, and $U \to X$ is
surjective such that the top horizontal arrow is smooth, and
\item there exist Zariski coverings $Y = \bigcup_{i \in I} Y_i$,
and $f^{-1}(Y_i) = \bigcup X_{ij}$ such that
each morphism $X_{ij} \to Y_i$ is smooth.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-smooth-locally-finite-presentation}
A smooth morphism of algebraic spaces is locally of finite presentation.
\end{lemma}

\begin{proof}
Let $X \to Y$ be a smooth morphism of algebraic spaces. By
definition this means there exists a diagram as in
Lemma \ref{lemma-local-source-target}
with $h$ smooth and surjective vertical arrow $a$. By
Morphisms, Lemma \ref{morphisms-lemma-smooth-locally-finite-presentation}
$h$ is locally of finite presentation. Hence $X \to Y$ is
locally of finite presentation by definition.
\end{proof}

\begin{lemma}
\label{lemma-smooth-locally-finite-type}
A smooth morphism of algebraic spaces is locally of finite type.
\end{lemma}

\begin{proof}
Combine
Lemmas \ref{lemma-smooth-locally-finite-presentation} and
\ref{lemma-finite-presentation-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-smooth-flat}
A smooth morphism of algebraic spaces is flat.
\end{lemma}

\begin{proof}
Let $X \to Y$ be a smooth morphism of algebraic spaces. By
definition this means there exists a diagram as in
Lemma \ref{lemma-local-source-target}
with $h$ smooth and surjective vertical arrow $a$. By
Morphisms, Lemma \ref{morphisms-lemma-smooth-locally-finite-presentation}
$h$ is flat. Hence $X \to Y$ is flat by definition.
\end{proof}

\begin{lemma}
\label{lemma-smooth-syntomic}
A smooth morphism of algebraic spaces is syntomic.
\end{lemma}

\begin{proof}
Let $X \to Y$ be a smooth morphism of algebraic spaces. By
definition this means there exists a diagram as in
Lemma \ref{lemma-local-source-target}
with $h$ smooth and surjective vertical arrow $a$. By
Morphisms, Lemma \ref{morphisms-lemma-smooth-syntomic}
$h$ is syntomic. Hence $X \to Y$ is syntomic by definition.
\end{proof}

\begin{lemma}
\label{lemma-where-smooth}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic
spaces over $S$. There is a maximal open subspace $U \subset X$
such that $f|_U : U \to Y$ is smooth. Moreover, formation of
this open commutes with base change by
\begin{enumerate}
\item morphisms which are flat and
locally of finite presentation,
\item flat morphisms provided $f$ is locally of finite presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
The existence of $U$ follows from the fact that the property
of being smooth is Zariski (and even \'etale) local on the source, see
Lemma \ref{lemma-smooth-local}. Moreover, this lemma allows
us to translate properties (1) and (2) into the case
of morphisms of schemes. The case of schemes is
Morphisms, Lemma \ref{morphisms-lemma-set-points-where-fibres-smooth}.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-smoothness-dimension-spaces}
Let $X$ and $Y$ be locally Noetherian algebraic spaces over a scheme
$S$, and let $f : X \to Y$ be a smooth morphism.
For every point $x \in |X|$ with image $y \in |Y|$,
$$
\dim_x(X) = \dim_y(Y) + \dim_x(X_y)
$$
where $\dim_x(X_y)$ is the relative dimension of $f$ at $x$ as
in Definition \ref{definition-dimension-fibre}.
\end{lemma}

\begin{proof}
By definition of the dimension of an algebraic space
at a point (Properties of Spaces, Definition
\ref{spaces-properties-definition-dimension-at-point}),
this reduces to the corresponding statement for schemes
(Morphisms, Lemma \ref{morphisms-lemma-smoothness-dimension}).
\end{proof}



\section{Unramified morphisms}
\label{section-unramified}

\noindent
The property ``unramified'' (resp.\ ``G-unramified'')
of morphisms of schemes is \'etale local on the source-and-target, see
Descent, Remark \ref{descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-unramified} and
Descent, Lemma \ref{descent-lemma-descending-property-unramified}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define the notion of an unramified morphism
(resp.\ G-unramified morphism) of algebraic spaces
as follows and it agrees with the already existing notion defined in
Section \ref{section-representable}
when the morphism is representable.

\begin{definition}
\label{definition-unramified}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item We say $f$ is {\it unramified} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold with $\mathcal{P} = \text{unramified}$.
\item Let $x \in |X|$. We say $f$ is {\it unramified at $x$} if there
exists an open neighbourhood $X' \subset X$ of $x$ such that
$f|_{X'} : X' \to Y$ is unramified.
\item We say $f$ is {\it G-unramified} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold with $\mathcal{P} = \text{G-unramified}$.
\item Let $x \in |X|$. We say $f$ is {\it G-unramified at $x$} if there
exists an open neighbourhood $X' \subset X$ of $x$ such that
$f|_{X'} : X' \to Y$ is G-unramified.
\end{enumerate}
\end{definition}

\noindent
Because of the following lemma, from here on we will only develop theory
for unramified morphisms, and whenever we want to use a G-unramified
morphism we will simply say ``an unramified morphism locally of finite
presentation''.

\begin{lemma}
\label{lemma-unramified-G-unramified}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Then $f$ is G-unramified if and only if $f$ is unramified and
locally of finite presentation.
\end{lemma}

\begin{proof}
Consider any diagram as in
Lemma \ref{lemma-local-source-target}.
Then all we are saying is that the morphism $h$ is
G-unramified if and only if it is unramified and locally of finite
presentation. This is clear from
Morphisms, Definition \ref{morphisms-definition-unramified}.
\end{proof}

\begin{lemma}
\label{lemma-composition-unramified}
The composition of unramified morphisms is unramified.
\end{lemma}

\begin{proof}
See Remark \ref{remark-composition-P} and
Morphisms, Lemma \ref{morphisms-lemma-composition-unramified}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-unramified}
The base change of an unramified morphism is unramified.
\end{lemma}

\begin{proof}
See Remark \ref{remark-base-change-P} and
Morphisms, Lemma \ref{morphisms-lemma-base-change-unramified}.
\end{proof}

\begin{lemma}
\label{lemma-unramified-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is unramified,
\item for every $x \in |X|$ the morphism $f$ is unramified at $x$,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is unramified,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is unramified,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is an unramified morphism,
\item there exists a scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$ such that the composition $f \circ \varphi$
is unramified,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes and the vertical arrows are \'etale
the top horizontal arrow is unramified,
\item there exists a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes, the vertical arrows are \'etale, and
$U \to X$ is surjective such that the top horizontal arrow is unramified, and
\item there exist Zariski coverings $Y = \bigcup_{i \in I} Y_i$,
and $f^{-1}(Y_i) = \bigcup X_{ij}$ such that
each morphism $X_{ij} \to Y_i$ is unramified.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}


\begin{lemma}
\label{lemma-unramified-locally-finite-type}
An unramified morphism of algebraic spaces is locally of finite type.
\end{lemma}

\begin{proof}
Via a diagram as in
Lemma \ref{lemma-local-source-target}
this translates into
Morphisms, Lemma \ref{morphisms-lemma-unramified-locally-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-unramified-quasi-finite}
If $f$ is unramified at $x$ then $f$ is quasi-finite at $x$.
In particular, an unramified morphism is locally quasi-finite.
\end{lemma}

\begin{proof}
Via a diagram as in
Lemma \ref{lemma-local-source-target}
this translates into
Morphisms, Lemma \ref{morphisms-lemma-unramified-quasi-finite}.
\end{proof}

\begin{lemma}
\label{lemma-immersion-unramified}
An immersion of algebraic spaces is unramified.
\end{lemma}

\begin{proof}
Let $i : X \to Y$ be an immersion of algebraic spaces. Choose a scheme
$V$ and a surjective \'etale morphism $V \to Y$. Then $V \times_Y X \to V$
is an immersion of schemes, hence unramified (see
Morphisms, Lemmas \ref{morphisms-lemma-open-immersion-unramified} and
\ref{morphisms-lemma-closed-immersion-unramified}).
Thus by definition $i$ is unramified.
\end{proof}

\begin{lemma}
\label{lemma-diagonal-unramified-morphism}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item If $f$ is unramified, then the diagonal morphism
$\Delta_{X/Y} : X \to X \times_Y X$ is an open immersion.
\item If $f$ is locally of finite type
and $\Delta_{X/Y}$ is an open immersion, then $f$ is unramified.
\end{enumerate}
\end{lemma}

\begin{proof}
We know in any case that $\Delta_{X/Y}$ is a representable monomorphism, see
Lemma \ref{lemma-properties-diagonal}.
Choose a scheme $V$ and a surjective \'etale morphism $V \to Y$.
Choose a scheme $U$ and a surjective \'etale morphism $U \to X \times_Y V$.
Consider the commutative diagram
$$
\xymatrix{
U \ar[d] \ar[rr]_-{\Delta_{U/V}} & &
U \times_V U \ar[d] \ar[r] &
V \ar[d]^{\Delta_{V/Y}} \\
X \ar[rr]^-{\Delta_{X/Y}} & &
X \times_Y X \ar[r] &
V \times_Y V
}
$$
with cartesian right square. The left vertical arrow is surjective \'etale.
The right vertical arrow is \'etale as a morphism between schemes
\'etale over $Y$, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-etale-permanence}.
Hence the middle vertical arrow is \'etale too (but it need not be
surjective).

\medskip\noindent
Assume $f$ is unramified. Then $U \to V$ is unramified, hence
$\Delta_{U/V}$ is an open immersion by
Morphisms, Lemma \ref{morphisms-lemma-diagonal-unramified-morphism}.
Looking at the left square of the diagram above we conclude that
$\Delta_{X/Y}$ is an \'etale morphism, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-etale-local}.
Hence $\Delta_{X/Y}$ is a representable \'etale monomorphism, which
implies that it is an open immersion by
\'Etale Morphisms, Theorem \ref{etale-theorem-etale-radicial-open}.
(See also
Spaces, Lemma
\ref{spaces-lemma-representable-transformations-property-implication}
for the translation from schemes language into the language of functors.)

\medskip\noindent
Assume that $f$ is locally of finite type and that $\Delta_{X/Y}$
is an open immersion. This implies that $U \to V$ is locally of finite
type too (by definition of a morphism of algebraic spaces which is
locally of finite type). Looking at the displayed diagram above
we conclude that $\Delta_{U/V}$ is \'etale as a morphism between
schemes \'etale over $X \times_Y X$, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-etale-permanence}.
But since $\Delta_{U/V}$ is the diagonal of a morphism between schemes
we see that it is in any case an immersion, see
Schemes, Lemma \ref{schemes-lemma-diagonal-immersion}.
Hence it is an open immersion, and we conclude
that $U \to V$ is unramified by
Morphisms, Lemma \ref{morphisms-lemma-diagonal-unramified-morphism}.
This in turn means that $f$ is unramified by definition.
\end{proof}

\begin{lemma}
\label{lemma-where-unramified}
Let $S$ be a scheme. Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces over $S$. Assume that $X \to Z$ is locally of
finite type. Then there exists an open subspace $U(f) \subset X$
such that $|U(f)| \subset |X|$ is the set of points where $f$ is unramified.
Moreover, for any morphism of algebraic spaces $Z' \to Z$, if
$f' : X' \to Y'$ is the base change of $f$ by $Z' \to Z$, then
$U(f')$ is the inverse image of $U(f)$ under the projection $X' \to X$.
\end{lemma}

\begin{proof}
This lemma is the analogue of
Morphisms, Lemma \ref{morphisms-lemma-set-points-where-fibres-unramified}
and in fact we will deduce the lemma from it. By
Definition \ref{definition-unramified}
the set $\{x \in |X| : f \text{ is unramified at }x\}$ is
open in $X$. Hence we only need to prove the final statement. By
Lemma \ref{lemma-permanence-finite-type}
the morphism $X \to Y$ is locally of finite type. By
Lemma \ref{lemma-base-change-finite-type}
the morphism $X' \to Y'$ is locally of finite type.

\medskip\noindent
Choose a scheme $W$ and a surjective \'etale morphism $W \to Z$.
Choose a scheme $V$ and a surjective \'etale morphism $V \to W \times_Z Y$.
Choose a scheme $U$ and a surjective \'etale morphism $U \to V \times_Y X$.
Finally, choose a scheme $W'$ and a surjective \'etale morphism
$W' \to W \times_Z Z'$.
Set $V' = W' \times_W V$ and $U' = W' \times_W U$, so that we obtain
surjective \'etale morphisms $V' \to Y'$ and $U' \to X'$.
We will use without further mention an \'etale morphism of algebraic spaces
induces an open map of associated topological spaces (see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-etale-open}).
This combined with
Lemma \ref{lemma-unramified-local}
implies that $U(f)$ is the image in $|X|$ of the set $T$ of points in $U$
where the morphism $U \to V$ is unramified. Similarly, $U(f')$ is the image
in $|X'|$ of the set $T'$ of points in $U'$ where the morphism $U' \to V'$
is unramified. Now, by construction the diagram
$$
\xymatrix{
U' \ar[r] \ar[d] & U \ar[d] \\
V' \ar[r] & V
}
$$
is cartesian (in the category of schemes). Hence the aforementioned
Morphisms, Lemma \ref{morphisms-lemma-set-points-where-fibres-unramified}
applies to show that $T'$ is the inverse image of $T$. Since
$|U'| \to |X'|$ is surjective this implies the lemma.
\end{proof}

\begin{lemma}
\label{lemma-permanence-unramified}
Let $S$ be a scheme.
Let $X \to Y \to Z$ be morphisms of algebraic spaces over $S$.
If $X \to Z$ is unramified, then $X \to Y$ is unramified.
\end{lemma}

\begin{proof}
Choose a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \ar[r] & W \ar[d] \\
X \ar[r] & Y \ar[r] & Z
}
$$
with vertical arrows \'etale and surjective. (See
Spaces, Lemma \ref{spaces-lemma-lift-morphism-presentations}.)
Apply
Morphisms, Lemma \ref{morphisms-lemma-unramified-permanence}
to the top row.
\end{proof}














\section{\'Etale morphisms}
\label{section-etale}

\noindent
The notion of an \'etale morphism of algebraic spaces was defined in
Properties of Spaces, Definition \ref{spaces-properties-definition-etale}.
Here is what it means for a morphism to be \'etale at a point.

\begin{definition}
\label{definition-etale}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $x \in |X|$. We say $f$ is {\it \'etale at $x$} if there
exists an open neighbourhood $X' \subset X$ of $x$ such that
$f|_{X'} : X' \to Y$ is \'etale.
\end{definition}

\begin{lemma}
\label{lemma-etale-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is \'etale,
\item for every $x \in |X|$ the morphism $f$ is \'etale at $x$,
\item for every scheme $Z$ and any morphism $Z \to Y$ the morphism
$Z \times_Y X \to Z$ is \'etale,
\item for every affine scheme $Z$ and any morphism
$Z \to Y$ the morphism $Z \times_Y X \to Z$ is \'etale,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is an \'etale morphism,
\item there exists a scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$ such that the composition $f \circ \varphi$
is \'etale,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes and the vertical arrows are \'etale
the top horizontal arrow is \'etale,
\item there exists a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
where $U$, $V$ are schemes, the vertical arrows are \'etale, and
$U \to X$ surjective such that the top horizontal arrow is \'etale, and
\item there exist Zariski coverings $Y = \bigcup Y_i$ and
$f^{-1}(Y_i) = \bigcup X_{ij}$ such that each morphism
$X_{ij} \to Y_i$ is \'etale.
\end{enumerate}
\end{lemma}

\begin{proof}
Combine
Properties of Spaces, Lemmas
\ref{spaces-properties-lemma-etale-local},
\ref{spaces-properties-lemma-base-change-etale} and
\ref{spaces-properties-lemma-composition-etale}.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-etale}
The composition of two \'etale morphisms of algebraic spaces
is \'etale.
\end{lemma}

\begin{proof}
This is a copy of
Properties of Spaces, Lemma \ref{spaces-properties-lemma-composition-etale}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-etale}
The base change of an \'etale morphism of algebraic spaces
by any morphism of algebraic spaces is \'etale.
\end{lemma}

\begin{proof}
This is a copy of
Properties of Spaces, Lemma \ref{spaces-properties-lemma-base-change-etale}.
\end{proof}

\begin{lemma}
\label{lemma-etale-locally-quasi-finite}
An \'etale morphism of algebraic spaces is locally quasi-finite.
\end{lemma}

\begin{proof}
Let $X \to Y$ be an \'etale morphism of algebraic spaces, see
Properties of Spaces, Definition \ref{spaces-properties-definition-etale}.
By
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-local}
we see this means there exists a diagram as in
Lemma \ref{lemma-local-source-target}
with $h$ \'etale and surjective vertical arrow $a$. By
Morphisms, Lemma \ref{morphisms-lemma-etale-locally-quasi-finite}
$h$ is locally quasi-finite. Hence $X \to Y$ is locally quasi-finite
by definition.
\end{proof}

\begin{lemma}
\label{lemma-etale-smooth}
An \'etale morphism of algebraic spaces is smooth.
\end{lemma}

\begin{proof}
The proof is identical to the proof of
Lemma \ref{lemma-etale-locally-quasi-finite}.
It uses the fact that an \'etale morphism of schemes is smooth
(by definition of an \'etale morphism of schemes).
\end{proof}

\begin{lemma}
\label{lemma-etale-flat}
An \'etale morphism of algebraic spaces is flat.
\end{lemma}

\begin{proof}
The proof is identical to the proof of
Lemma \ref{lemma-etale-locally-quasi-finite}.
It uses
Morphisms, Lemma \ref{morphisms-lemma-etale-flat}.
\end{proof}

\begin{lemma}
\label{lemma-etale-locally-finite-presentation}
\begin{slogan}
\'Etale implies locally of finite presentation.
\end{slogan}
An \'etale morphism of algebraic spaces is locally of finite presentation.
\end{lemma}

\begin{proof}
The proof is identical to the proof of
Lemma \ref{lemma-etale-locally-quasi-finite}.
It uses
Morphisms, Lemma \ref{morphisms-lemma-etale-locally-finite-presentation}.
\end{proof}

\begin{lemma}
\label{lemma-etale-locally-finite-type}
An \'etale morphism of algebraic spaces is locally of finite type.
\end{lemma}

\begin{proof}
An \'etale morphism is locally of finite presentation
and a morphism locally of finite presentation is locally of finite type,
see
Lemmas \ref{lemma-etale-locally-finite-presentation} and
\ref{lemma-finite-presentation-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-etale-unramified}
An \'etale morphism of algebraic spaces is unramified.
\end{lemma}

\begin{proof}
The proof is identical to the proof of
Lemma \ref{lemma-etale-locally-quasi-finite}.
It uses
Morphisms, Lemma \ref{morphisms-lemma-etale-smooth-unramified}.
\end{proof}

\begin{lemma}
\label{lemma-etale-permanence}
Let $S$ be a scheme. Let $X, Y$ be algebraic spaces \'etale over
an algebraic space $Z$. Any morphism $X \to Y$ over $Z$ is \'etale.
\end{lemma}

\begin{proof}
This is a copy of
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-permanence}.
\end{proof}

\begin{lemma}
\label{lemma-unramified-flat-lfp-etale}
A locally finitely presented, flat, unramified morphism of algebraic
spaces is \'etale.
\end{lemma}

\begin{proof}
Let $X \to Y$ be a locally finitely presented, flat, unramified morphism
of algebraic spaces. By
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-local}
we see this means there exists a diagram as in
Lemma \ref{lemma-local-source-target}
with $h$ locally finitely presented, flat, unramified
and surjective vertical arrow $a$. By
Morphisms, Lemma \ref{morphisms-lemma-flat-unramified-etale}
$h$ is \'etale. Hence $X \to Y$ is \'etale by definition.
\end{proof}






\section{Proper morphisms}
\label{section-proper}

\noindent
The notion of a proper morphism plays an important role in algebraic geometry.
Here is the definition of a proper morphism of algebraic spaces.

\begin{definition}
\label{definition-proper}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
We say $f$ is {\it proper} if $f$ is separated, finite type, and
universally closed.
\end{definition}

\begin{lemma}
\label{lemma-proper-local}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. The following are equivalent
\begin{enumerate}
\item $f$ is proper,
\item for every scheme $Z$ and every morphism $Z \to Y$
the projection $Z \times_Y X \to Z$ is proper,
\item for every affine scheme $Z$ and every morphism $Z \to Y$
the projection $Z \times_Y X \to Z$ is proper,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is proper, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that
each of the morphisms $f^{-1}(Y_i) \to Y_i$ is proper.
\end{enumerate}
\end{lemma}

\begin{proof}
Combine Lemmas \ref{lemma-separated-local},
\ref{lemma-finite-type-local},
\ref{lemma-quasi-compact-local}, and
\ref{lemma-universally-closed-local}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-proper}
A base change of a proper morphism is proper.
\end{lemma}

\begin{proof}
See
Lemmas \ref{lemma-base-change-separated},
\ref{lemma-base-change-finite-type}, and
\ref{lemma-base-change-universally-closed}.
\end{proof}

\begin{lemma}
\label{lemma-composition-proper}
A composition of proper morphisms is proper.
\end{lemma}

\begin{proof}
See
Lemmas \ref{lemma-composition-separated},
\ref{lemma-composition-finite-type}, and
\ref{lemma-composition-universally-closed}.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-proper}
A closed immersion of algebraic spaces is a proper morphism of
algebraic spaces.
\end{lemma}

\begin{proof}
As a closed immersion is by definition representable this follows from
Spaces,
Lemma \ref{spaces-lemma-representable-transformations-property-implication}
and the corresponding result for morphisms of schemes, see
Morphisms, Lemma \ref{morphisms-lemma-closed-immersion-proper}.
\end{proof}

\begin{lemma}
\label{lemma-universally-closed-permanence}
Let $S$ be a scheme.
Consider a commutative diagram of algebraic spaces
$$
\xymatrix{
X \ar[rr] \ar[rd] & &
Y \ar[ld] \\
& B &
}
$$
over $S$.
\begin{enumerate}
\item If $X \to B$ is universally closed and $Y \to B$ is
separated, then the morphism $X \to Y$ is universally closed.
In particular, the image of $|X|$ in $|Y|$ is closed.
\item If $X \to B$ is proper and $Y \to B$ is separated, then
the morphism $X \to Y$ is proper.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $X \to B$ is universally closed and $Y \to B$ is separated.
We factor the morphism as $X \to X \times_B Y \to Y$.
The first morphism is a closed immersion, see
Lemma \ref{lemma-semi-diagonal}
hence universally closed.
The projection $X \times_B Y \to Y$ is the base change
of a universally closed morphism and hence
universally closed, see
Lemma \ref{lemma-base-change-universally-closed}.
Thus $X \to Y$ is universally closed as the composition
of universally closed morphisms, see
Lemma \ref{lemma-composition-universally-closed}.
This proves (1). To deduce (2) combine (1) with
Lemmas \ref{lemma-compose-after-separated},
\ref{lemma-quasi-compact-permanence}, and
\ref{lemma-permanence-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-image-proper-is-proper}
Let $S$ be a scheme. Let $B$ be an algebraic space over $S$.
Let $f : X \to Y$ be a morphism of algebraic spaces over $B$.
If $X$ is universally closed over $B$ and $f$ is surjective then
$Y$ is universally closed over $B$. In particular, if also $Y$ is
separated and of finite type over $B$, then $Y$ is proper over $B$.
\end{lemma}

\begin{proof}
Assume $X$ is universally closed and $f$ surjective.
Denote $p : X \to B$, $q : Y \to B$ the structure morphisms.
Let $B' \to B$ be a morphism of algebraic spaces over $S$.
The base change $f' : X_{B'} \to Y_{B'}$ is surjective
(Lemma \ref{lemma-base-change-surjective}), and the base
change $p' : X_{B'} \to B'$ is closed.
If $T \subset Y_{B'}$ is closed, then $(f')^{-1}(T) \subset X_{B'}$
is closed, hence $p'((f')^{-1}(T)) = q'(T)$ is closed.
So $q'$ is closed.
\end{proof}

\begin{lemma}
\label{lemma-scheme-theoretic-image-is-proper}
Let $S$ be a scheme. Let
$$
\xymatrix{
X \ar[rr]_h \ar[rd]_f & & Y \ar[ld]^g \\
& B
}
$$
be a commutative diagram of morphism of algebraic spaces over $S$.
Assume
\begin{enumerate}
\item $X \to B$ is a proper morphism,
\item $Y \to B$ is separated and locally of finite type,
\end{enumerate}
Then the scheme theoretic image $Z \subset Y$ of $h$
is proper over $B$ and $X \to Z$ is surjective.
\end{lemma}

\begin{proof}
The scheme theoretic image of $h$ is constructed in Section
\ref{section-scheme-theoretic-image}.
Observe that $h$ is quasi-compact
(Lemma \ref{lemma-quasi-compact-quasi-separated-permanence})
hence $|h|(|X|) \subset |Z|$
is dense (Lemma \ref{lemma-quasi-compact-scheme-theoretic-image}).
On the other hand $|h|(|X|)$ is closed in $|Y|$
(Lemma \ref{lemma-universally-closed-permanence})
hence $X \to Z$ is surjective.
Thus $Z \to B$ is a proper (Lemma \ref{lemma-image-proper-is-proper}).
\end{proof}

\begin{lemma}
\label{lemma-separated-diagonal-proper}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is separated,
\item $\Delta_{X/Y} : X \to X \times_Y X$ is universally closed, and
\item $\Delta_{X/Y} : X \to X \times_Y X$ is proper.
\end{enumerate}
\end{lemma}

\begin{proof}
The implication (1) $\Rightarrow$ (3) follows from
Lemma \ref{lemma-closed-immersion-proper}.
We will use
Spaces, Lemma
\ref{spaces-lemma-representable-transformations-property-implication}
without further mention in the rest of the proof.
Recall that $\Delta_{X/Y}$ is a representable
monomorphism which is locally of finite type, see
Lemma \ref{lemma-properties-diagonal}.
Since proper $\Rightarrow$ universally closed for morphisms of schemes
we conclude that (3) implies (2).
If $\Delta_{X/Y}$ is universally closed then
\'Etale Morphisms,
Lemma \ref{etale-lemma-characterize-closed-immersion}
implies that it is a closed immersion. Thus (2) $\Rightarrow$ (1)
and we win.
\end{proof}





\section{Valuative criteria}
\label{section-valuative}

\noindent
The section introduces the basics on valuative criteria for morphisms
of algebraic spaces. Here is a list of references to further results
\begin{enumerate}
\item the valuative criterion for universal closedness can be found in
Section \ref{section-valuative-criterion-universally-closed},
\item the valuative criterion of separatedness can be found in
Section \ref{section-valuative-separatedness},
\item the valuative criterion for properness can be found in
Section \ref{section-valuative-criterion-properness},
\item additional converse statements can be found in
Decent Spaces, Section
\ref{decent-spaces-section-valuative-criterion-universally-closed}
and Decent Spaces, Lemma
\ref{decent-spaces-lemma-re-characterize-universally-closed}, and
\item in the Noetherian case it is enough to check the criterion for
discrete valuation rings as is shown in Cohomology of Spaces, Section
\ref{spaces-cohomology-section-Noetherian-valuative-criterion}, and
\item refined versions of the valuative criteria in the Noetherian
case can be found in Limits of Spaces, Section
\ref{spaces-limits-section-Noetherian-valuative-criterion}.
\end{enumerate}
We first formally state the definition and then we discuss how this
differs from the case of morphisms of schemes.

\begin{definition}
\label{definition-valuative-criterion}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
We say $f$ {\it satisfies the uniqueness part of the valuative criterion}
if given any commutative solid diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] \ar@{-->}[ru] & Y
}
$$
where $A$ is a valuation ring with field of fractions $K$, there exists
at most one dotted arrow (without requiring existence).
We say $f$ {\it satisfies the existence part of the valuative criterion}
if given any solid diagram as above there exists an extension
$K \subset K'$ of fields, a valuation ring $A' \subset K'$ dominating
$A$ and a morphism $\Spec(A') \to X$ such that the following
diagram commutes
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & \Spec(K) \ar[r] & X \ar[d] \\
\Spec(A') \ar[r] \ar[rru] & \Spec(A) \ar[r] & Y
}
$$
We say $f$ {\it satisfies the valuative criterion}
if $f$ satisfies both the existence and uniqueness part.
\end{definition}

\noindent
The formulation of the existence part of the valuative criterion is
slightly different for morphisms of algebraic spaces, since it may be
necessary to extend the fraction field of the valuation ring.
In practice this difference almost never plays a role.
\begin{enumerate}
\item Checking the uniqueness part of the valuative criterion never
involves any fraction field extensions, hence this is exactly the same
as in the case of schemes.
\item It is necessary to allow for field extensions in general, see
Example \ref{example-finite-separable-needed}.
\item For morphisms of algebraic spaces it always suffices to
take a finite separable extensions $K \subset K'$ in the existence
part of the valuative criterion, see Lemma \ref{lemma-finite-separable-enough}.
\item If $f : X \to Y$ is a separated morphism of algebraic spaces, then
we can always take $K = K'$ when we check the existence part of the
valuative criterion, see Lemma \ref{lemma-usual-enough}.
\item For a quasi-compact and quasi-separated
morphism $f : X \to Y$, we get an equivalence between
``$f$ is separated and universally closed'' and ``$f$ satisfies
the usual valuative criterion'', see
Lemma \ref{lemma-characterize-separated-and-universally-closed}.
The valuative criterion for properness is the usual one, see
Lemma \ref{lemma-characterize-proper}.
\end{enumerate}
As a first step in the theory, we show that the criterion is identical
to the criterion as formulated for morphisms of schemes
in case the morphism of algebraic spaces is representable.

\begin{lemma}
\label{lemma-valuative-criterion-representable}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Assume $f$ is representable. The following are equivalent
\begin{enumerate}
\item $f$ satisfies the existence part of the valuative criterion
as in Definition \ref{definition-valuative-criterion},
\item given any commutative solid diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] \ar@{-->}[ru] & Y
}
$$
where $A$ is a valuation ring with field of fractions $K$, there exists
a dotted arrow, i.e., $f$ satisfies the existence part of the valuative
criterion as in
Schemes, Definition \ref{schemes-definition-valuative-criterion}.
\end{enumerate}
\end{lemma}

\begin{proof}
It suffices to show that given a commutative diagram of the form
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & \Spec(K) \ar[r] & X \ar[d] \\
\Spec(A') \ar[r] \ar[rru]^\varphi & \Spec(A) \ar[r] & Y
}
$$
as in Definition \ref{definition-valuative-criterion}, then we can
find a morphism $\Spec(A) \to X$ fitting into the diagram too.
Set $X_A = \Spec(A) \times_Y Y$. As $f$ is representable we see
that $X_A$ is a scheme. The morphism $\varphi$ gives a morphism
$\varphi' : \Spec(A') \to X_A$. Let $x \in X_A$ be the image of
the closed point of $\varphi' : \Spec(A') \to X_A$. Then we
have the following commutative diagram of rings
$$
\xymatrix{
K' & K \ar[l] & \mathcal{O}_{X_A, x} \ar[l] \ar[lld] \\
A' \ar[u] & A \ar[l] & A \ar[l] \ar[u]
}
$$
Since $A$ is a valuation ring, and since $A'$ dominates $A$, we see
that $K \cap A' = A$. Hence the ring map $\mathcal{O}_{X_A, x} \to K$
has image contained in $A$. Whence a morphism $\Spec(A) \to X_A$ (see
Schemes, Section \ref{schemes-section-points})
as desired.
\end{proof}

\begin{lemma}
\label{lemma-finite-separable-enough}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent
\begin{enumerate}
\item $f$ satisfies the existence part of the valuative criterion
as in Definition \ref{definition-valuative-criterion},
\item $f$ satisfies the existence part of the valuative criterion
as in Definition \ref{definition-valuative-criterion} modified by
requiring the extension $K \subset K'$ to be finite separable.
\end{enumerate}
\end{lemma}

\begin{proof}
We have to show that (1) implies (2). Suppose given a diagram
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & \Spec(K) \ar[r] & X \ar[d] \\
\Spec(A') \ar[r] \ar[rru] & \Spec(A) \ar[r] & Y
}
$$
as in Definition \ref{definition-valuative-criterion} with $K \subset K'$
arbitrary. Choose a scheme $U$ and a surjective \'etale morphism $U \to X$.
Then
$$
\Spec(A') \times_X U \longrightarrow \Spec(A')
$$
is surjective \'etale. Let $p$ be a point of $\Spec(A') \times_X U$
mapping to the closed point of $\Spec(A')$. Let $p' \leadsto p$
be a generalization of $p$ mapping to the generic point of $\Spec(A')$.
Such a generalization exists because generalizations lift along flat
morphisms of schemes, see
Morphisms, Lemma \ref{morphisms-lemma-generalizations-lift-flat}.
Then $p'$ corresponds to a point of the scheme $\Spec(K') \times_X U$.
Note that
$$
\Spec(K') \times_X U
=
\Spec(K') \times_{\Spec(K)} (\Spec(K) \times_X U)
$$
Hence $p'$ maps to a point $q' \in \Spec(K) \times_X U$ whose
residue field is a finite separable extension of $K$. Finally,
$p' \leadsto p$ maps to a specialization $u' \leadsto u$ on the
scheme $U$. With all this notation we get the following diagram of
rings
$$
\xymatrix{
\kappa(p') & & \kappa(q') \ar[ll] & \kappa(u') \ar[l] \\
& \mathcal{O}_{\Spec(A') \times_X U, p} \ar[lu] & &
\mathcal{O}_{U, u} \ar[ll] \ar[u] \\
K' \ar[uu] & A' \ar[l] \ar[u] & A \ar[l] \ar'[u][uu]
}
$$
This means that the ring $B \subset \kappa(q')$ generated by
the images of $A$ and $\mathcal{O}_{U, u}$ maps to a subring
of $\kappa(p')$ contained in the image $B'$ of
$\mathcal{O}_{\Spec(A') \times_X U, p} \to \kappa(p')$.
Note that $B'$ is a local ring. Let $\mathfrak m \subset B$
be the maximal ideal. By construction $A \cap \mathfrak m$,
(resp.\ $\mathcal{O}_{U, u} \cap \mathfrak m$, resp.\ $A' \cap \mathfrak m$)
is the maximal ideal of $A$ (resp.\ $\mathcal{O}_{U, u}$, resp.\ $A'$).
Set $\mathfrak q = B \cap \mathfrak m$. This is a
prime ideal such that $A \cap \mathfrak q$ is the maximal ideal of $A$.
Hence $B_{\mathfrak q} \subset \kappa(q')$ is a local ring dominating
$A$. By
Algebra, Lemma \ref{algebra-lemma-dominate}
we can find a valuation ring $A_1 \subset \kappa(q')$
with field of fractions $\kappa(q')$
dominating $B_{\mathfrak q}$. The (local) ring map
$\mathcal{O}_{U, u} \to A_1$ gives a morphism
$\Spec(A_1) \to U \to X$
such that the diagram
$$
\xymatrix{
\Spec(\kappa(q')) \ar[r] \ar[d] & \Spec(K) \ar[r] & X \ar[d] \\
\Spec(A_1) \ar[r] \ar[rru] & \Spec(A) \ar[r] & Y
}
$$
is commutative. Since the fraction field of $A_1$ is $\kappa(q')$
and since $\kappa(q')/K$ is finite
separable by construction the lemma is proved.
\end{proof}

\begin{lemma}
\label{lemma-push-down-solution}
Let $S$ be a scheme. Let $f : X \to Y$ be a separated morphism of
algebraic spaces over $S$. Suppose given a diagram
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & \Spec(K) \ar[r] & X \ar[d] \\
\Spec(A') \ar[r] \ar[rru] & \Spec(A) \ar[r] \ar@{-->}[ru] & Y
}
$$
as in Definition \ref{definition-valuative-criterion} with $K \subset K'$
arbitrary. Then the dotted arrow exists making the diagram commute.
\end{lemma}

\begin{proof}
We have to show that we can find a morphism $\Spec(A) \to X$ fitting
into the diagram.

\medskip\noindent
Consider the base change $X_A = \Spec(A) \times_Y X$ of $X$.
Then $X_A \to \Spec(A)$ is a separated morphism of algebraic
spaces (Lemma \ref{lemma-base-change-separated}). Base changing
all the morphisms of the diagram above we obtain
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & \Spec(K) \ar[r] & X_A \ar[d] \\
\Spec(A') \ar[r] \ar[rru] & \Spec(A) \ar@{=}[r] & \Spec(A)
}
$$
Thus we may replace $X$ by $X_A$, assume that $Y = \Spec(A)$ and
that we have a diagram as above. We may and do replace $X$ by
a quasi-compact open subspace containing the image of $|\Spec(A')| \to |X|$.

\medskip\noindent
The morphism $\Spec(A') \to X$ is quasi-compact by
Lemma \ref{lemma-quasi-compact-permanence}.
Let $Z \subset X$ be the scheme theoretic image of
$\Spec(A') \to X$. Then $Z$ is a reduced
(Lemma \ref{lemma-scheme-theoretic-image-reduced}),
quasi-compact (as a closed subspace of $X$), separated
(as a closed subspace of $X$) algebraic space over $A$.
Consider the base change
$$
\Spec(K') = \Spec(A') \times_{\Spec(A)} \Spec(K) \to
X \times_{\Spec(A)} \Spec(K) = X_K
$$
of the morphism $\Spec(A') \to X$ by the flat morphism of schemes
$\Spec(K) \to \Spec(A)$. By
Lemma \ref{lemma-flat-base-change-scheme-theoretic-image}
we see that the scheme theoretic image of this morphism
is the base change $Z_K$ of $Z$. On the other hand, by
assumption (i.e., the commutative diagram above)
this morphism factors through a morphism
$\Spec(K) \to Z_K$ which is a section to the structure morphism
$Z_K \to \Spec(K)$. As $Z_K$ is separated, this section is a
closed immersion (Lemma \ref{lemma-section-immersion}).
We conclude that $Z_K = \Spec(K)$.

\medskip\noindent
Let $V \to Z$ be a surjective \'etale morphism with $V$ an
affine scheme (Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}).
Say $V = \Spec(B)$. Then $V \times_Z \Spec(A') = \Spec(C)$
is affine as $Z$ is separated. Note that $B \to C$ is injective
as $V$ is the scheme theoretic image of $V \times_Z \Spec(A') \to V$
by Lemma \ref{lemma-quasi-compact-scheme-theoretic-image}.
On the other hand, $A' \to C$ is \'etale as corresponds
to the base change of $V \to Z$.
Since $A'$ is a torsion free $A$-module,
the flatness of $A' \to C$ implies $C$ is a torsion free
$A$-module, hence $B$ is a torsion free $A$-module.
Note that being torsion free as an $A$-module is
equivalent to being flat (More on Algebra, Lemma
\ref{more-algebra-lemma-valuation-ring-torsion-free-flat}).
Next, we write
$$
V \times_Z V = \Spec(B')
$$
Note that the two ring maps $B \to B'$ are \'etale as $V \to Z$
is \'etale. The canonical surjective map $B \otimes_A B \to B'$
becomes an isomorphism after tensoring with $K$ over $A$
because $Z_K = \Spec(K)$. However, $B \otimes_A B$ is torsion
free as an $A$-module by our remarks above. Thus $B' = B \otimes_A B$.
It follows that the base change of the ring map
$A \to B$ by the faithfully flat ring map $A \to B$
is \'etale (note that $\Spec(B) \to \Spec(A)$ is surjective
as $X \to \Spec(A)$ is surjective). Hence $A \to B$ is
\'etale (Descent, Lemma \ref{descent-lemma-descending-property-etale}),
in other words, $V \to X$ is \'etale.
Since we have $V \times_Z V = V \times_{\Spec(A)} V$
we conclude that $Z = \Spec(A)$ as algebraic spaces
(for example by Spaces, Lemma \ref{spaces-lemma-space-presentation})
and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-usual-enough}
Let $S$ be a scheme. Let $f : X \to Y$ be a separated morphism of
algebraic spaces over $S$. The following are equivalent
\begin{enumerate}
\item $f$ satisfies the existence part of the valuative criterion
as in Definition \ref{definition-valuative-criterion},
\item given any commutative solid diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] \ar@{-->}[ru] & Y
}
$$
where $A$ is a valuation ring with field of fractions $K$, there exists
a dotted arrow, i.e., $f$ satisfies the existence part of the valuative
criterion as in
Schemes, Definition \ref{schemes-definition-valuative-criterion}.
\end{enumerate}
\end{lemma}

\begin{proof}
We have to show that (1) implies (2). Suppose given a commutative diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] & Y
}
$$
as in part (2). By (1) there exists a commutative diagram
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & \Spec(K) \ar[r] & X \ar[d] \\
\Spec(A') \ar[r] \ar[rru] & \Spec(A) \ar[r] & Y
}
$$
as in Definition \ref{definition-valuative-criterion} with $K \subset K'$
arbitrary. By Lemma \ref{lemma-push-down-solution} we can find a morphism
$\Spec(A) \to X$ fitting into the diagram, i.e., (2) holds.
\end{proof}

\begin{example}
\label{example-finite-separable-needed}
Consider the algebraic space $X$ constructed in
Spaces, Example \ref{spaces-example-non-representable-descent}.
Recall that it is Galois twist of the affine line with zero doubled.
The Galois twist is with respect to a degree two Galois extension
$k'/k$ of fields. As such it comes with a morphism
$$
\pi : X \longrightarrow S = \mathbf{A}^1_k
$$
which is quasi-compact. We claim that $\pi$ is universally closed.
Namely, after base change by $\Spec(k') \to \Spec(k)$
the morphism $\pi$ is identified with the morphism
$$
\text{affine line with zero doubled}
\longrightarrow
\text{affine line}
$$
which is universally closed (some details omitted). Since the morphism
$\Spec(k') \to \Spec(k)$ is universally closed and
surjective, a diagram chase shows that $\pi$ is universally closed.
On the other hand, consider the diagram
$$
\xymatrix{
\Spec(k((x))) \ar[r] \ar[d] & X \ar[d]^\pi \\
\Spec(k[[x]]) \ar[r] \ar@{..>}[ru] & \mathbf{A}^1_k
}
$$
Since the unique point of $X$ above $0 \in \mathbf{A}^1_k$
corresponds to a monomorphism $\Spec(k') \to X$
it is clear there cannot exist a dotted arrow! This shows that
a finite separable field extension is needed in general.
\end{example}

\begin{lemma}
\label{lemma-base-change-valuative-criteria}
The base change of a morphism of algebraic spaces which satisfies the
existence part of (resp.\ uniqueness part of) the valuative criterion
by any morphism of algebraic spaces satisfies the
existence part of (resp.\ uniqueness part of) the valuative criterion.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ be a morphism of algebraic spaces over the scheme $S$.
Let $Z \to Y$ be any morphism of algebraic spaces over $S$.
Consider a solid commutative diagram of the following shape
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & Z \times_Y X \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] \ar@{-->}[ru] \ar@{-->}[rru] & Z \ar[r] & Y
}
$$
Then the set of north-west dotted arrows making the diagram commute
is in 1-1 correspondence with the set of west-north-west dotted arrows
making the diagram commute. This proves the lemma in the case of
``uniqueness''. For the existence part, assume $f$ satisfies the existence
part of the valuative criterion. If we are given a solid commutative
diagram as above, then by assumption there exists an extension $K \subset K'$
of fields and a valuation ring $A' \subset K'$ dominating $A$ and
a morphism $\Spec(A') \to X$ fitting into the following commutative
diagram
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] &
\Spec(K) \ar[r] & Z \times_Y X \ar[r] & X \ar[d] \\
\Spec(A') \ar[r] \ar[rrru] & \Spec(A) \ar[r] & Z \ar[r] & Y
}
$$
And by the remarks above the skew arrow corresponds to an arrow
$\Spec(A') \to Z \times_Y X$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-composition-valuative-criteria}
The composition of two morphisms of algebraic spaces which satisfy the
(existence part of, resp.\ uniqueness part of) the valuative criterion
satisfies the (existence part of, resp.\ uniqueness part of) the valuative
criterion.
\end{lemma}

\begin{proof}
Let $f : X \to Y$, $g : Y \to Z$ be morphisms of algebraic spaces over the
scheme $S$. Consider a solid commutative diagram of the following shape
$$
\xymatrix{
\Spec(K) \ar[dd] \ar[r] & X \ar[d]^f \\
& Y \ar[d]^g \\
\Spec(A) \ar[r] \ar@{-->}[ru] \ar@{-->}[ruu] & Z
}
$$
If we have the uniqueness part for $g$, then there exists at
most one north-west dotted arrow making the diagram commute.
If we also have the uniqueness part for $f$, then we have
at most one north-north-west dotted arrow making the diagram
commute. The proof in the existence case comes from contemplating
the following diagram
$$
\xymatrix{
\Spec(K'') \ar[r] \ar[dd] &
\Spec(K') \ar[r] &
\Spec(K) \ar[r] &
X \ar[d]^f \\
& & & Y \ar[d]^g \\
\Spec(A'') \ar[r] \ar[rrruu] &
\Spec(A') \ar[r] \ar[rru] &
\Spec(A) \ar[r] &
Z
}
$$
Namely, the existence part for $g$ gives us the extension $K'$, the
valuation ring $A'$ and the arrow $\Spec(A') \to Y$, whereupon
the existence part for $f$ gives us the extension $K''$, the
valuation ring $A''$ and the arrow $\Spec(A'') \to X$.
\end{proof}






\section{Valuative criterion for universal closedness}
\label{section-valuative-criterion-universally-closed}

\noindent
The existence part of the valuative criterion implies universal
closedness for quasi-compact morphisms, see
Lemma \ref{lemma-quasi-compact-existence-universally-closed}.
In the case of schemes, this is an ``if and only if'' statement,
but for morphisms of algebraic spaces this is wrong.
Example \ref{example-strange-universally-closed}
shows that $\mathbf{A}^1_k/\mathbf{Z} \to \Spec(k)$ is universally
closed, but it is easy to see that the existence part of
the valuative criterion fails. We revisit this topic in
Decent Spaces, Section
\ref{decent-spaces-section-valuative-criterion-universally-closed}
and show the converse holds if the source of the morphism is a decent space
(see also
Decent Spaces,
Lemma \ref{decent-spaces-lemma-re-characterize-universally-closed}
for a relative version).

\begin{lemma}
\label{lemma-quasi-compact-existence-universally-closed}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Assume
\begin{enumerate}
\item $f$ is quasi-compact, and
\item $f$ satisfies the existence part of the valuative criterion.
\end{enumerate}
Then $f$ is universally closed.
\end{lemma}

\begin{proof}
By Lemmas \ref{lemma-base-change-quasi-compact}
and \ref{lemma-base-change-valuative-criteria}
properties (1) and (2) are preserved under
any base change. By Lemma \ref{lemma-universally-closed-local}
we only have to show that $|T \times_Y X| \to |T|$ is closed,
whenever $T$ is an affine scheme over $S$ mapping into $Y$. Hence it
suffices to prove: If $Y$ is an affine scheme, $f : X \to Y$ is quasi-compact
and satisfies the existence part of the valuative criterion, then
$f : |X| \to |Y|$ is closed. In this situation $X$ is a quasi-compact
algebraic space. By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-quasi-compact-affine-cover}
there exists an affine scheme $U$ and a surjective \'etale morphism
$\varphi : U \to X$. Let $T \subset |X|$ closed. The inverse image
$\varphi^{-1}(T) \subset U$ is closed, and hence is the set of points
of an affine closed subscheme $Z \subset U$. Thus, by
Algebra, Lemma \ref{algebra-lemma-image-stable-specialization-closed}
we see that $f(T) = f(\varphi(|Z|)) \subset |Y|$ is closed if it is
closed under specialization.

\medskip\noindent
Let $y' \leadsto y$ be a specialization in $Y$ with $y' \in f(T)$.
Choose a point $x' \in T \subset |X|$ mapping to $y'$ under $f$.
We may represent $x'$ by a morphism $\Spec(K) \to X$
for some field $K$. Thus we have the following diagram
$$
\xymatrix{
\Spec(K) \ar[r]_-{x'} \ar[d] & X \ar[d]^f \\
\Spec(\mathcal{O}_{Y, y}) \ar[r] & Y,
}
$$
see
Schemes, Section \ref{schemes-section-points}
for the existence of the left vertical map.
Choose a valuation ring $A \subset K$ dominating the image of
the ring map $\mathcal{O}_{Y, y} \to K$ (this is possible since
the image is a local ring and not a field as $y' \not = y$, see
Algebra, Lemma \ref{algebra-lemma-dominate}).
By assumption there exists a field extension $K \subset K'$ and a
valuation ring $A' \subset K'$ dominating $A$, and a morphism
$\Spec(A') \to X$ fitting into the commutative diagram.
Since $A'$ dominates $A$, and $A$ dominates $\mathcal{O}_{Y, y}$
we see that the closed point of $\Spec(A')$ maps to
a point $x \in X$ with $f(x) = y$ which is a specialization of $x'$.
Hence $x \in T$ as $T$ is closed, and hence $y \in f(T)$ as desired.
\end{proof}

\noindent
The following lemma will be generalized in Decent Spaces, Lemma
\ref{decent-spaces-lemma-re-characterize-universally-closed}.

\begin{lemma}
\label{lemma-characterize-universally-closed-quasi-separated}
Let $S$ be a scheme. Let $f : X \to Y$ be a
morphism of algebraic spaces over $S$.
\begin{enumerate}
\item If $f$ is quasi-separated and universally closed, then
$f$ satisfies the existence part of the valuative criterion.
\item If $f$ is quasi-compact and quasi-separated, then
$f$ is universally closed if and only if the existence part of the
valuative criterion holds.
\end{enumerate}
\end{lemma}

\begin{proof}
If (1) is true then combined with
Lemma \ref{lemma-quasi-compact-existence-universally-closed}
we obtain (2). Assume $f$ is quasi-separated and universally closed.
Assume given a diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] & Y
}
$$
as in Definition \ref{definition-valuative-criterion}.
A formal argument shows that the existence of the desired diagram
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & \Spec(K) \ar[r] & X \ar[d] \\
\Spec(A') \ar[r] \ar[rru] & \Spec(A) \ar[r] & Y
}
$$
follows from existence in the case of the morphism $X_A \to \Spec(A)$.
Since being quasi-separated and universally closed are preserved
by base change, the lemma follows from the result in the next paragraph.

\medskip\noindent
Consider a solid diagram
$$
\xymatrix{
\Spec(K) \ar[r]_-x \ar[d] & X \ar[d]^f \\
\Spec(A) \ar@{=}[r] \ar@{..>}[ru] & \Spec(A)
}
$$
where $A$ is a valuation ring with field of fractions $K$.
By Lemma \ref{lemma-quasi-compact-permanence} and the fact
that $f$ is quasi-separated we have that
the morphism $x$ is quasi-compact.
Since $f$ is universally closed, we have in particular
that $|f|(\overline{\{x\}})$ is closed in $\Spec(A)$.
Since this image contains the generic point of $\Spec(A)$
there exists a point $x' \in |X|$ in the closure
of $x$ mapping to the closed point of $\Spec(A)$.
By Lemma \ref{lemma-reach-points-scheme-theoretic-image}
we can find a commutative diagram
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & \Spec(K) \ar[d] \\
\Spec(A') \ar[r] & X
}
$$
such that the closed point of $\Spec(A')$ maps to $x' \in |X|$.
It follows that $\Spec(A') \to \Spec(A)$ maps the closed point
to the closed point, i.e., $A'$ dominates $A$ and this finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-characterize-universally-closed-separated}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. Assume $f$ is quasi-compact and separated. Then the following
are equivalent
\begin{enumerate}
\item $f$ is universally closed,
\item the existence part of the valuative criterion holds
as in Definition \ref{definition-valuative-criterion}, and
\item given any commutative solid diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] \ar@{-->}[ru] & Y
}
$$
where $A$ is a valuation ring with field of fractions $K$, there exists
a dotted arrow, i.e., $f$ satisfies the existence part of the valuative
criterion as in
Schemes, Definition \ref{schemes-definition-valuative-criterion}.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $f$ is separated parts (2) and (3) are equivalent by
Lemma \ref{lemma-usual-enough}.
The equivalence of (3) and (1) follows from
Lemma \ref{lemma-characterize-universally-closed-quasi-separated}.
\end{proof}

\begin{lemma}
\label{lemma-lift-valuation-ring-through-flat-morphism}
Let $S$ be a scheme. Let $f : X \to Y$ be a flat morphism
of algebraic spaces over $S$.
Let $\Spec(A) \to Y$ be a morphism where $A$ is a
valuation ring. If the closed point of $\Spec(A)$ maps to a
point of $|Y|$ in the image of $|X| \to |Y|$, then there exists
a commutative diagram
$$
\xymatrix{
\Spec(A') \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] & Y
}
$$
where $A \to A'$ is an extension of valuation rings
(More on Algebra, Definition
\ref{more-algebra-definition-extension-valuation-rings}).
\end{lemma}

\begin{proof}
The base change $X_A \to \Spec(A)$ is flat
(Lemma \ref{lemma-base-change-flat}) and the closed point of
$\Spec(A)$ is in the image of $|X_A| \to |\Spec(A)|$
(Properties of Spaces, Lemma \ref{spaces-properties-lemma-points-cartesian}).
Thus we may assume $Y = \Spec(A)$. Let $U \to X$ be a surjective
\'etale morphism where $U$ is a scheme. Let $u \in U$ map to
the closed point of $\Spec(A)$. Consider the flat local ring map
$A \to B = \mathcal{O}_{U, u}$. By
Algebra, Lemma \ref{algebra-lemma-ff-rings}
there exists a prime ideal $\mathfrak q \subset B$ such that
$\mathfrak q$ lies over $(0) \subset A$. By
Algebra, Lemma \ref{algebra-lemma-dominate}
we can find a valuation ring $A' \subset \kappa(\mathfrak q)$
dominating $B/\mathfrak q$. The induced morphism
$\Spec(A') \to U \to X$ is a solution to the problem
posed by the lemma.
\end{proof}

\begin{lemma}
\label{lemma-refined-valuative-criterion-universally-closed}
Let $S$ be a scheme. Let $f : X \to Y$ and $h : U \to X$ be morphisms of
algebraic spaces over $S$. If
\begin{enumerate}
\item $f$ and $h$ are quasi-compact,
\item $|h|(|U|)$ is dense in $|X|$, and
\end{enumerate}
given any commutative solid diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & U \ar[r] & X \ar[d] \\
\Spec(A) \ar[rr] \ar@{-->}[rru] & & Y
}
$$
where $A$ is a valuation ring with field of fractions $K$
\begin{enumerate}
\item[(3)] there exists at most one dotted arrow making the diagram
commute, and
\item[(4)] there exists an extension $K \subset K'$ of fields, a
valuation ring $A' \subset K'$ dominating $A$ and a morphism
$\Spec(A') \to X$ such that the following diagram commutes
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & \Spec(K) \ar[r] & U \ar[r] & X \ar[d] \\
\Spec(A') \ar[r] \ar[rrru] & \Spec(A) \ar[rr] & & Y
}
$$
\end{enumerate}
then $f$ is universally closed. If moreover
\begin{enumerate}
\item[(5)] $f$ is quasi-separated
\end{enumerate}
then $f$ is separated and universally closed.
\end{lemma}

\begin{proof}
Assume (1), (2), (3), and (4).
We will verify the existence part of the valuative criterion for $f$
which will imply $f$ is universally closed by
Lemma \ref{lemma-quasi-compact-existence-universally-closed}.
To do this, consider a commutative diagram
\begin{equation}
\label{equation-start-with}
\vcenter{
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] & Y
}
}
\end{equation}
where $A$ is a valuation ring and $K$ is the fraction field of $A$.
Note that since valuation rings and fields are reduced, we may
replace $U$, $X$, and $S$ by their respective reductions by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-map-into-reduction}.
In this case the assumption that $h(U)$ is dense means that
the scheme theoretic image of $h : U \to X$ is $X$, see
Lemma \ref{lemma-scheme-theoretic-image-reduced}.

\medskip\noindent
Reduction to the case $Y$ affine. Choose an \'etale morphism
$\Spec(R) \to Y$ such that the closed point of $\Spec(A)$ maps
to an element of $\Im(|\Spec(R)| \to |Y|)$. By
Lemma \ref{lemma-lift-valuation-ring-through-flat-morphism}
we can find a local ring map $A \to A'$ of valuation rings
and a morphism $\Spec(A') \to \Spec(R)$ fitting into a commutative
diagram
$$
\xymatrix{
\Spec(A') \ar[r] \ar[d] & \Spec(R) \ar[d] \\
\Spec(A) \ar[r] & Y
}
$$
Since in Definition \ref{definition-valuative-criterion}
we allow for extensions of valuation rings
it is clear that we may replace $A$ by $A'$, $Y$ by $\Spec(R)$,
$X$ by $X \times_Y \Spec(R)$ and $U$ by $U \times_Y \Spec(R)$.

\medskip\noindent
From now on we assume that $Y = \Spec(R)$ is an affine scheme.
Let $\Spec(B) \to X$ be an \'etale morphism from an affine scheme
such that the morphism $\Spec(K) \to X$ is in the image of
$|\Spec(B)| \to |X|$. Since we may replace $K$ by an extension
$K' \supset K$ and $A$ by a valuation ring $A' \subset K'$
dominating $A$ (which exists by
Algebra, Lemma \ref{algebra-lemma-dominate}),
we may assume the morphism $\Spec(K) \to X$ factors through $\Spec(B)$
(by definition of $|X|$). In other words, we may think of $K$ as a $B$-algebra.
Choose a polynomial algebra $P$ over $B$ and a $B$-algebra surjection
$P \to K$. Then $\Spec(P) \to X$ is flat as a composition
$\Spec(P) \to \Spec(B) \to X$. Hence the scheme theoretic image
of the morphism $U \times_X \Spec(P) \to \Spec(P)$ is $\Spec(P)$ by
Lemma \ref{lemma-flat-base-change-scheme-theoretic-image}.
By Lemma \ref{lemma-reach-points-scheme-theoretic-image}
we can find a commutative diagram
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & U \times_X \Spec(P) \ar[d] \\
\Spec(A') \ar[r] & \Spec(P)
}
$$
where $A'$ is a valuation ring and $K'$ is the fraction field of $A'$
such that the closed point of $\Spec(A')$ maps to
$\Spec(K) \subset \Spec(P)$. In other words, there is a $B$-algebra map
$\varphi : K \to A'/\mathfrak m_{A'}$. Choose a valuation ring
$A'' \subset A'/\mathfrak m_{A'}$ dominating $\varphi(A)$ with
field of fractions $K'' = A'/\mathfrak m_{A'}$
(Algebra, Lemma \ref{algebra-lemma-dominate}). We set
$$
C = \{\lambda \in A' \mid \lambda \bmod \mathfrak m_{A'} \in A''\}.
$$
which is a valuation ring by
Algebra, Lemma \ref{algebra-lemma-stack-valuation-rings}.
As $C$ is an $R$-algebra with fraction field $K'$, we obtain a solid
commutative diagram
$$
\xymatrix{
\Spec(K'_1) \ar@{-->}[r] \ar@{-->}[d] &
\Spec(K') \ar[r] \ar[d] & U \ar[r] & X \ar[d] \\
\Spec(C_1) \ar@{-->}[r] \ar@{-->}[rrru] & \Spec(C) \ar[rr] & & Y
}
$$
as in the statement of the lemma. Thus assumption (4) produces
$C \to C_1$ and the dotted arrows making the diagram commute.
Let $A_1' = (C_1)_\mathfrak p$ be the localization of $C_1$
at a prime $\mathfrak p \subset C_1$ lying over
$\mathfrak m_{A'} \subset C$. Since $C \to C_1$ is flat by
More on Algebra, Lemma
\ref{more-algebra-lemma-valuation-ring-torsion-free-flat}
such a prime $\mathfrak p$ exists by
Algebra, Lemmas \ref{algebra-lemma-local-flat-ff} and
\ref{algebra-lemma-ff-rings}.
Note that $A'$ is the localization of $C$ at $\mathfrak m_{A'}$
and that $A'_1$ is a valuation ring
(Algebra, Lemma \ref{algebra-lemma-make-valuation-rings}).
In other words, $A' \to A'_1$ is a local ring map of valuation
rings. Assumption (3) implies
$$
\xymatrix{
\Spec(A'_1) \ar[r] \ar[d] & \Spec(C_1) \ar[r] & X \\
\Spec(A') \ar[r] & \Spec(P) \ar[r] & \Spec(B) \ar[u]
}
$$
commutes. Hence the restriction of the morphism $\Spec(C_1) \to X$
to $\Spec(C_1/\mathfrak p)$ restricts to the composition
$$
\Spec(\kappa(\mathfrak p)) \to
\Spec(A'/\mathfrak m_{A'}) = \Spec(K'') \to
\Spec(K) \to X
$$
on the generic point of $\Spec(C_1/\mathfrak p)$. Moreover,
$C_1/\mathfrak p$ is a valuation ring
(Algebra, Lemma \ref{algebra-lemma-make-valuation-rings})
dominating $A''$ which dominates $A$.
Thus the morphism $\Spec(C_1/\mathfrak p) \to X$ witnesses the
existence part of the valuative criterion for the diagram
(\ref{equation-start-with}) as desired.

\medskip\noindent
Next, suppose that (5) is satisfied as well, i.e., the morphism
$\Delta : X \to X \times_S X$ is quasi-compact. In this case
assumptions (1) -- (4) hold for $h$ and $\Delta$. Hence the first
part of the proof shows that $\Delta$ is universally closed.
By Lemma \ref{lemma-separated-diagonal-proper} we conclude that
$f$ is separated.
\end{proof}

















\section{Valuative criterion of separatedness}
\label{section-valuative-separatedness}

\noindent
First we prove a converse and then we state the criterion.

\begin{lemma}
\label{lemma-separated-implies-valuative}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
If $f$ is separated, then $f$ satisfies the uniqueness
part of the valuative criterion.
\end{lemma}

\begin{proof}
Let a diagram as in Definition \ref{definition-valuative-criterion}
be given. Suppose there are two distinct morphisms
$a, b : \Spec(A) \to X$ fitting into the diagram.
Let $Z \subset \Spec(A)$ be the equalizer of $a$ and $b$.
Then $Z = \Spec(A) \times_{(a, b), X \times_Y X, \Delta} X$.
If $f$ is separated, then $\Delta$ is a closed immersion, and
this is a closed subscheme of $\Spec(A)$. By assumption it contains
the generic point of $\Spec(A)$. Since $A$ is a domain
this implies $Z = \Spec(A)$. Hence $a = b$ as desired.
\end{proof}

\begin{lemma}[Valuative criterion separatedness]
\label{lemma-valuative-criterion-separatedness}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Assume
\begin{enumerate}
\item the morphism $f$ is quasi-separated, and
\item the morphism $f$ satisfies the uniqueness
part of the valuative criterion.
\end{enumerate}
Then $f$ is separated.
\end{lemma}

\begin{proof}
Assumption (1) means $\Delta_{X/Y}$ is quasi-compact.
We claim the morphism
$\Delta_{X/Y} : X \to X \times_Y X$ satisfies the existence
part of the valuative criterion.
Let a solid commutative diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] \ar@{-->}[ru] & X \times_Y X
}
$$
be given. The lower right arrow corresponds to a
pair of morphisms $a, b : \Spec(A) \to X$ over $Y$.
By assumption (2) we see that $a = b$. Hence using $a$ as the dotted
arrow works. Hence
Lemma \ref{lemma-quasi-compact-existence-universally-closed}
applies, and we see that $\Delta_{X/Y}$ is universally closed.
Since always $\Delta_{X/Y}$ is locally of finite type and
separated, we conclude from
More on Morphisms, Lemma \ref{more-morphisms-lemma-characterize-finite}
that $\Delta_{X/Y}$ is a finite morphism (also, use the
general principle of
Spaces, Lemma
\ref{spaces-lemma-representable-transformations-property-implication}).
At this point $\Delta_{X/Y}$ is a representable, finite monomorphism,
hence a closed immersion by
Morphisms, Lemma \ref{morphisms-lemma-finite-monomorphism-closed}.
\end{proof}

\begin{lemma}
\label{lemma-characterize-separated-and-universally-closed}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. Assume $f$ is quasi-compact and quasi-separated. Then the
following are equivalent
\begin{enumerate}
\item $f$ is separated and universally closed,
\item the valuative criterion holds as in Definition
\ref{definition-valuative-criterion},
\item given any commutative solid diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] \ar@{-->}[ru] & Y
}
$$
where $A$ is a valuation ring with field of fractions $K$, there exists
a unique dotted arrow, i.e., $f$ satisfies the valuative
criterion as in
Schemes, Definition \ref{schemes-definition-valuative-criterion}.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $f$ is quasi-separated, the uniqueness
part of the valutative criterion implies $f$ is separated
(Lemma \ref{lemma-valuative-criterion-separatedness}).
Conversely, if $f$ is separated, then it satisfies the
uniqueness part of the valuative criterion
(Lemma \ref{lemma-separated-implies-valuative}).
Having said this, we see that in each of the three cases the
morphism $f$ is separated and satisfies the uniqueness part
of the valuative criterion. In this case the lemma is a formal
consequence of
Lemma \ref{lemma-characterize-universally-closed-separated}.
\end{proof}



\section{Valuative criterion of properness}
\label{section-valuative-criterion-properness}

\noindent
Here is a statement.

\begin{lemma}[Valuative criterion for properness]
\label{lemma-characterize-proper}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. Assume $f$ is of finite type and quasi-separated. Then the
following are equivalent
\begin{enumerate}
\item $f$ is proper,
\item the valuative criterion holds as in Definition
\ref{definition-valuative-criterion},
\item given any commutative solid diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X \ar[d] \\
\Spec(A) \ar[r] \ar@{-->}[ru] & Y
}
$$
where $A$ is a valuation ring with field of fractions $K$, there exists
a unique dotted arrow, i.e., $f$ satisfies the valuative
criterion as in
Schemes, Definition \ref{schemes-definition-valuative-criterion}.
\end{enumerate}
\end{lemma}

\begin{proof}
Formal consequence of
Lemma \ref{lemma-characterize-separated-and-universally-closed}
and the definitions.
\end{proof}





\section{Integral and finite morphisms}
\label{section-integral}

\noindent
We have already defined in Section \ref{section-representable}
what it means for a representable morphism of algebraic spaces
to be integral (resp.\ finite).

\begin{lemma}
\label{lemma-integral-representable}
Let $S$ be a scheme. Let $f : X \to Y$ be a representable
morphism of algebraic spaces over $S$. Then
$f$ is integral, resp.\ finite
(in the sense of Section \ref{section-representable}),
if and only if for all affine schemes $Z$
and morphisms $Z \to Y$ the scheme $X \times_Y Z$ is affine and
integral, resp.\ finite, over $Z$.
\end{lemma}

\begin{proof}
This follows directly from the definition of an integral (resp.\ finite)
morphism of schemes
(Morphisms, Definition \ref{morphisms-definition-integral}).
\end{proof}

\noindent
This clears the way for the following definition.

\begin{definition}
\label{definition-integral}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
\begin{enumerate}
\item We say that $f$ is {\it integral} if for every affine scheme $Z$
and morphisms $Z \to Y$ the algebraic space $X \times_Y Z$ is
representable by an affine scheme integral over $Z$.
\item We say that $f$ is {\it finite} if for every affine scheme $Z$
and morphisms $Z \to Y$ the algebraic space $X \times_Y Z$ is
representable by an affine scheme finite over $Z$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-integral-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is representable and integral (resp.\ finite),
\item $f$ is integral (resp.\ finite),
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is integral (resp. finite), and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that
each of the morphisms $f^{-1}(Y_i) \to Y_i$ is integral (resp.\ finite).
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (1) implies (2) and that (2) implies (3) by taking
$V$ to be a disjoint union of affines \'etale over $Y$, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}.
Assume $V \to Y$ is as in (3). Then for every affine open $W$ of $V$ we see
that $W \times_Y X$ is an affine open of $V \times_Y X$. Hence by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-subscheme}
we conclude that $V \times_Y X$ is a scheme. Moreover the morphism
$V \times_Y X \to V$ is affine. This means we can apply
Spaces,
Lemma \ref{spaces-lemma-morphism-sheaves-with-P-effective-descent-etale}
because the class of integral (resp.\ finite) morphisms
satisfies all the required properties (see
Morphisms, Lemmas \ref{morphisms-lemma-base-change-finite} and
Descent, Lemmas
\ref{descent-lemma-descending-property-integral},
\ref{descent-lemma-descending-property-finite},
and \ref{descent-lemma-affine}).
The conclusion of applying this lemma is that $f$ is representable
and integral (resp.\ finite), i.e., (1) holds.

\medskip\noindent
The equivalence of (1) and (4) follows from the fact that being
integral (resp.\ finite) is Zariski local on the target (the
reference above shows that being integral or finite is in fact
fpqc local on the target).
\end{proof}

\begin{lemma}
\label{lemma-composition-integral}
The composition of integral (resp.\ finite) morphisms is integral
(resp.\ finite).
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-integral}
The base change of an integral (resp.\ finite) morphism is integral
(resp.\ finite).
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-finite-integral}
A finite morphism of algebraic spaces is integral.
An integral morphism of algebraic spaces
which is locally of finite type is finite.
\end{lemma}

\begin{proof}
In both cases the morphism is representable, and you can check the condition
after a base change by an affine scheme mapping into $Y$, see
Lemmas \ref{lemma-integral-local}. Hence this lemma follows from the
same lemma for the case of schemes, see
Morphisms, Lemma \ref{morphisms-lemma-finite-integral}.
\end{proof}

\begin{lemma}
\label{lemma-integral-universally-closed}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent
\begin{enumerate}
\item $f$ is integral, and
\item $f$ is affine and universally closed.
\end{enumerate}
\end{lemma}

\begin{proof}
In both cases the morphism is representable, and you can check the condition
after a base change by an affine scheme mapping into $Y$, see
Lemmas \ref{lemma-integral-local},
\ref{lemma-affine-local}, and
\ref{lemma-universally-closed-local}.
Hence the result follows from
Morphisms, Lemma \ref{morphisms-lemma-integral-universally-closed}.
\end{proof}

\begin{lemma}
\label{lemma-finite-quasi-finite}
A finite morphism of algebraic spaces is quasi-finite.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ be a morphism of algebraic spaces.
By
Definition \ref{definition-integral}
and
Lemmas \ref{lemma-quasi-compact-local} and
\ref{lemma-quasi-finite-local}
both properties may be checked after base change to an affine over $Y$,
i.e., we may assume $Y$ affine.
If $f$ is finite then $X$ is a scheme.
Hence the result follows from the corresponding result for schemes, see
Morphisms, Lemma \ref{morphisms-lemma-finite-quasi-finite}.
\end{proof}

\begin{lemma}
\label{lemma-finite-proper}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces over
$S$. The following are equivalent
\begin{enumerate}
\item $f$ is finite, and
\item $f$ is affine and proper.
\end{enumerate}
\end{lemma}

\begin{proof}
In both cases the morphism is representable, and you can check the condition
after base change to an affine scheme mapping into $Y$, see
Lemmas \ref{lemma-integral-local}, \ref{lemma-affine-local}, and
\ref{lemma-proper-local}. Hence the result follows from
Morphisms, Lemma \ref{morphisms-lemma-finite-proper}.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-finite}
A closed immersion is finite (and a fortiori integral).
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-finite-union-finite}
Let $S$ be a scheme.
Let $X_i \to Y$, $i = 1, \ldots, n$ be finite morphisms of
algebraic spaces over $S$.
Then $X_1 \amalg \ldots \amalg X_n \to Y$ is finite too.
\end{lemma}

\begin{proof}
Follows from the case of schemes
(Morphisms, Lemma \ref{morphisms-lemma-finite-union-finite})
by \'etale localization.
\end{proof}

\begin{lemma}
\label{lemma-finite-permanence}
Let $S$ be a scheme.
Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of algebraic spaces over $S$.
\begin{enumerate}
\item If $g \circ f$ is finite and $g$ separated then $f$ is finite.
\item If $g \circ f$ is integral and $g$ separated then $f$ is integral.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $g \circ f$ is finite (resp.\ integral) and $g$ separated.
The base change $X \times_Z Y \to Y$ is finite (resp.\ integral) by
Lemma \ref{lemma-base-change-integral}.
The morphism $X \to X \times_Z Y$ is
a closed immersion as $Y \to Z$ is separated, see
Lemma \ref{lemma-section-immersion}.
A closed immersion is finite (resp.\ integral),
see Lemma \ref{lemma-closed-immersion-finite}.
The composition of finite (resp.\ integral) morphisms is finite
(resp.\ integral),
see Lemma \ref{lemma-composition-integral}. Thus we win.
\end{proof}





\section{Finite locally free morphisms}
\label{section-finite-locally-free}

\noindent
We have already defined in Section \ref{section-representable}
what it means for a representable morphism of algebraic spaces
to be finite locally free.

\begin{lemma}
\label{lemma-finite-locally-free-representable}
Let $S$ be a scheme. Let $f : X \to Y$ be a representable morphism
of algebraic spaces over $S$. Then $f$ is finite locally free
(in the sense of Section \ref{section-representable})
if and only if $f$ is affine and the sheaf $f_*\mathcal{O}_X$ is
a finite locally free $\mathcal{O}_Y$-module.
\end{lemma}

\begin{proof}
Assume $f$ is finite locally free (as defined in
Section \ref{section-representable}). This means that
for every morphism $V \to Y$ whose source is a scheme the
base change $f' : V \times_Y X \to V$ is a finite locally free morphism
of schemes. This in turn means (by the definition of a finite locally
free morphism of schemes) that
$f'_*\mathcal{O}_{V \times_Y X}$
is a finite locally free $\mathcal{O}_V$-module. We may choose $V \to Y$
to be surjective and \'etale. By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-pushforward-etale-base-change-modules}
we conclude the restriction of $f_*\mathcal{O}_X$ to $V$ is
finite locally free. Hence by
Modules on Sites, Lemma \ref{sites-modules-lemma-local-final-object}
applied to the sheaf $f_*\mathcal{O}_X$ on $Y_{spaces, \etale}$
we conclude that $f_*\mathcal{O}_X$ is finite locally free.

\medskip\noindent
Conversely, assume $f$ is affine and that $f_*\mathcal{O}_X$ is a finite
locally free $\mathcal{O}_Y$-module. Let $V$ be a scheme, and let
$V \to Y$ be a surjective \'etale morphism. Again by
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-pushforward-etale-base-change-modules}
we see that $f'_*\mathcal{O}_{V \times_Y X}$ is finite locally free.
Hence $f' : V \times_Y X \to V$ is finite locally free (as it is also affine).
By
Spaces,
Lemma \ref{spaces-lemma-morphism-sheaves-with-P-effective-descent-etale}
we conclude that $f$ is finite locally free (use
Morphisms, Lemma \ref{morphisms-lemma-base-change-finite-locally-free}
Descent, Lemmas \ref{descent-lemma-descending-property-finite-locally-free}
and \ref{descent-lemma-affine}). Thus we win.
\end{proof}

\noindent
This clears the way for the following definition.

\begin{definition}
\label{definition-finite-locally-free}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
We say that $f$ is {\it finite locally free} if $f$ is affine
and $f_*\mathcal{O}_X$ is a finite locally free $\mathcal{O}_Y$-module.
In this case we say $f$ is
has {\it rank} or {\it degree} $d$
if the sheaf $f_*\mathcal{O}_X$ is finite locally free of rank $d$.
\end{definition}

\begin{lemma}
\label{lemma-finite-locally-free-local}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is representable and finite locally free,
\item $f$ is finite locally free,
\item there exists a scheme $V$ and a surjective \'etale morphism
$V \to Y$ such that $V \times_Y X \to V$ is finite locally free, and
\item there exists a Zariski covering $Y = \bigcup Y_i$ such that
each morphism $f^{-1}(Y_i) \to Y_i$ is finite locally free.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (1) implies (2) and that (2) implies (3) by taking
$V$ to be a disjoint union of affines \'etale over $Y$, see
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-cover-by-union-affines}.
Assume $V \to Y$ is as in (3). Then for every affine open $W$ of $V$ we see
that $W \times_Y X$ is an affine open of $V \times_Y X$. Hence by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-subscheme}
we conclude that $V \times_Y X$ is a scheme. Moreover the morphism
$V \times_Y X \to V$ is affine. This means we can apply
Spaces,
Lemma \ref{spaces-lemma-morphism-sheaves-with-P-effective-descent-etale}
because the class of finite locally free morphisms
satisfies all the required properties (see
Morphisms, Lemma \ref{morphisms-lemma-base-change-finite-locally-free}
Descent, Lemmas \ref{descent-lemma-descending-property-finite-locally-free}
and \ref{descent-lemma-affine}).
The conclusion of applying this lemma is that $f$ is representable
and finite locally free, i.e., (1) holds.

\medskip\noindent
The equivalence of (1) and (4) follows from the fact that being
finite locally free is Zariski local on the target (the reference above shows
that being finite locally free is in fact fpqc local on the target).
\end{proof}

\begin{lemma}
\label{lemma-composition-finite-locally-free}
The composition of finite locally free morphisms is finite locally free.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-finite-locally-free}
The base change of a finite locally free morphism is finite locally free.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-finite-flat}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
The following are equivalent:
\begin{enumerate}
\item $f$ is finite locally free,
\item $f$ is finite, flat, and locally of finite presentation.
\end{enumerate}
If $Y$ is locally Noetherian these are also equivalent to
\begin{enumerate}
\item[(3)] $f$ is finite and flat.
\end{enumerate}
\end{lemma}

\begin{proof}
In each of the three cases the morphism is representable and you
can check the property after base change by a surjective \'etale morphism
$V \to Y$, see
Lemmas \ref{lemma-integral-local},
\ref{lemma-finite-locally-free-local},
\ref{lemma-flat-local}, and
\ref{lemma-finite-presentation-local}.
If $Y$ is locally Noetherian, then $V$ is locally Noetherian.
Hence the result follows from the corresponding result
in the schemes case, see
Morphisms, Lemma \ref{morphisms-lemma-finite-flat}.
\end{proof}





\section{Rational maps}
\label{section-rational-maps}

\noindent
This section is the analogue of
Morphisms, Section \ref{morphisms-section-rational-maps}.
We will use without further mention that the intersection of dense opens
of a topological space is a dense open.

\begin{definition}
\label{definition-rational-map}
Let $S$ be a scheme. Let $X$, $Y$ be algebraic spaces over $S$.
\begin{enumerate}
\item Let $f : U \to Y$, $g : V \to Y$ be morphisms of algebraic spaces
over $S$ defined on dense open subspaces $U$, $V$ of $X$. We say that $f$ is
{\it equivalent} to $g$ if $f|_W = g|_W$ for some dense open
subspace $W \subset U \cap V$.
\item A {\it rational map from $X$ to $Y$}
is an equivalence class for the equivalence relation defined in (1).
\item Given morphisms $X \to B$ and $Y \to B$ of algebraic spaces over $S$
we say that a rational map from $X$ to $Y$ is a
{\it $B$-rational map from $X$ to $Y$}
if there exists a representative $f : U \to Y$ of the equivalence
class which is a morphism over $B$.
\end{enumerate}
\end{definition}

\noindent
We say that two morphisms $f$, $g$ as in (1) of the definition
define the same rational map instead of saying that they are equivalent.
In many cases we will consider in the future, the algebraic spaces
$X$ and $Y$ will contain a dense open subspaces $X'$ and $Y'$ which
are schemes. In that case a rational map from $X$ to $Y$ is the same
as an $S$-rational map from $X'$ to $Y'$ in the sense of
Morphisms, Definition \ref{definition-rational-map}.
Then all of the theory developed for schemes can be brought to bear.

\begin{definition}
\label{definition-rational-function}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$. A
{\it rational function on $X$} is a rational map from $X$ to $\mathbf{A}^1_S$.
\end{definition}

\noindent
Looking at the discussion following
Morphisms, Definition \ref{morphisms-definition-rational-function}
we find that this is the same as the notion defined there in case
$X$ happens to be a scheme.

\medskip\noindent
Recall that we have the canonical identification
$$
\Mor_S(T, \mathbf{A}^1_S) = \Mor(T, \mathbf{A}^1_\mathbf{Z}) =
\Gamma(T, \mathcal{O}_T)
$$
for any scheme $T$ over $S$, see
Schemes, Example \ref{schemes-example-global-sections}.
Hence $\mathbf{A}^1_S$ is a ring-object in the
category of schemes over $S$. In other words, addition
and multiplication define morphisms
$$
+ : \mathbf{A}^1_S \times_S \mathbf{A}^1_S \to \mathbf{A}^1_S
\quad\text{and}\quad
* : \mathbf{A}^1_S \times_S \mathbf{A}^1_S \to \mathbf{A}^1_S
$$
satisfying the axioms of the addition and multiplication in a ring
(commutative with $1$ as always). Hence also the set of rational
maps into $\mathbf{A}^1_S$ has a natural ring structure.

\begin{definition}
\label{definition-ring-of-rational-functions}
Let $S$ be a scheme.
Let $X$ be an algebraic space over $S$.
The {\it ring of rational functions on $X$}
is the ring $R(X)$ whose elements are rational functions with
addition and multiplication as just described.
\end{definition}

\noindent
We will define function fields for integral algebraic spaces later, see
Spaces over Fields, Section \ref{spaces-over-fields-section-integral-spaces}.

\begin{definition}
\label{definition-domain-of-definition}
Let $S$ be a scheme. Let $\varphi$ be a rational map between two
algebraic spaces $X$ and $Y$ over $S$. We say
$\varphi$ is {\it defined in a point $x \in |X|$} if there exists a
representative $(U, f)$ of $\varphi$ with $x \in |U|$. The
{\it domain of definition} of $\varphi$ is the set of all points
where $\varphi$ is defined.
\end{definition}

\noindent
The domain of definition is viewed as an open subspace of $X$ via
Properties of Spaces, Lemma \ref{spaces-properties-lemma-open-subspaces}.
With this definition it isn't true in general that $\varphi$ has a
representative which is defined on all of the domain of definition.

\begin{lemma}
\label{lemma-rational-map-from-reduced-to-separated}
Let $S$ be a scheme. Let $X$ and $Y$ be algebraic spaces over $S$.
Assume $X$ is reduced and $Y$ is separated over $S$. Let
$\varphi$ be a rational map from $X$ to $Y$ with domain of definition
$U \subset X$. Then there exists a unique morphism $f : U \to Y$
of algebraic spaces representing $\varphi$.
\end{lemma}

\begin{proof}
Let $(V, g)$ and $(V', g')$ be representatives of $\varphi$. Then
$g, g'$ agree on a dense open subspace $W \subset V \cap V'$.
On the other hand, the equalizer $E$ of $g|_{V \cap V'}$ and $g'|_{V \cap V'}$
is a closed subspace of $V \cap V'$ because it is the base change
of $\Delta : Y \to Y \times_S Y$ by the morphism
$V \cap V' \to Y \times_S Y$ given by $g|_{V \cap V'}$ and $g'|_{V \cap V'}$.
Now $W \subset E$ implies that $|E| = |V \cap V'|$. As $V \cap V'$
is reduced we conclude $E = V \cap V'$ scheme theoretically, i.e.,
$g|_{V \cap V'} = g'|_{V \cap V'}$, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-map-into-reduction}.
It follows that we can glue the representatives $g : V \to Y$ of $\varphi$
to a morphism $f : U \to Y$ because $\coprod V \to U$ is a surjection of
fppf sheaves and
$\coprod_{V, V'} V \cap V' = (\coprod V) \times_U (\coprod V)$.
\end{proof}

\noindent
In general it does not make sense to compose rational maps. The reason
is that the image of a representative of the first rational map may
have empty intersection with the domain of definition of the second.
However, if we assume that our spaces are irreducible and we look
at dominant rational maps, then we can compose rational maps.

\begin{definition}
\label{definition-dominant-rational}
Let $S$ be a scheme. Let $X$ and $Y$ be algebraic spaces over $S$.
Assume $|X|$ and $|Y|$ are irreducible. A rational map from $X$ to $Y$
is called {\it dominant} if any representative $f : U \to Y$ is a dominant
morphism in the sense of Definition \ref{definition-dominant}.
\end{definition}

\noindent
We can compose a dominant rational map
$\varphi$ between irreducible algebraic spaces
$X$ and $Y$ with an arbitrary rational
map $\psi$ from $Y$ to $Z$. Namely, choose
representatives $f : U \to Y$ with $|U| \subset |X|$ open dense
and $g : V \to Z$ with $|V| \subset |Y|$ open dense. Then
$W = |f|^{-1}(V) \subset |X|$ is open nonempty (because
the image of $|f|$ is dense and hence must meet the nonempty open $V$)
and hence dense as $|X|$ is irreducible. We define $\psi \circ \varphi$
as the equivalence class of $g \circ f|_W : W \to Z$. We omit the verification
that this is well defined.

\medskip\noindent
In this way we obtain a category whose objects are irreducible algebraic
spaces over $S$ and whose morphisms are dominant rational maps.

\begin{definition}
\label{definition-birational-spaces}
Let $S$ be a scheme. Let $X$ and $Y$ be algebraic spaces
over $S$ with $|X|$ and $|Y|$ irreducible.
We say $X$ and $Y$ are {\it birational} if $X$ and $Y$ are isomorphic
in the category of irreducible algebraic spaces over $S$
and dominant rational maps.
\end{definition}

\noindent
If $X$ and $Y$ are birational irreducible algebraic spaces,
then the set of rational maps from $X$ to $Z$ is bijective
with the set of rational map from $Y$ to $Z$ for all algebraic
spaces $Z$ (functorially in $Z$). For ``general'' irreducible algebraic spaces
this is just one possible definition. Another would be
to require $X$ and $Y$ have isomorphic rings of
rational functions; sometimes these two notions are equivalent
(insert future reference here).

\begin{lemma}
\label{lemma-birational}
Let $S$ be a scheme. Let $X$ and $Y$ be algebraic
space over $S$ with $|X|$ and $|Y|$ irreducible.
Then $X$ and $Y$ are birational if and only if
there are nonempty open subspaces $U \subset X$ and $V \subset Y$
which are isomorphic as algebraic spaces over $S$.
\end{lemma}

\begin{proof}
Assume $X$ and $Y$ are birational. Let $f : U \to Y$ and $g : V \to X$
define inverse dominant rational maps from $X$ to $Y$ and from $Y$ to $X$.
After shrinking $U$ we may assume $f : U \to Y$ factors through $V$.
As $g \circ f$ is the identity as a dominant rational map, we see that
the composition $U \to V \to X$ is the identity on a dense open of $U$.
Thus after replacing $U$ by a smaller open we may assume that
$U \to V \to X$ is the inclusion of $U$ into $X$.
By symmetry we find there exists an open subspace $V' \subset V$
such that $g|_{V'} : V' \to X$ factors through $U \subset X$
and such that $V' \to U \to Y$ is the identity.
The inverse image of $|V'|$ by $|U| \to |V|$ is an open of $|U|$
and hence equal to $|U'|$ for some open subspace $U' \subset U$, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-open-subspaces}.
Then $U' \subset U \to V$ factors as $U' \to V'$.
Similarly $V' \to U$ factors as $V' \to U'$.
The reader finds that $U' \to V'$
and $V' \to U'$ are mutually inverse
morphisms of algebraic spaces over $S$
and the proof is complete.
\end{proof}









\section{Relative normalization of algebraic spaces}
\label{section-normalization-X-in-Y}

\noindent
This section is the analogue of
Morphisms, Section \ref{morphisms-section-normalization-X-in-Y}.

\begin{lemma}
\label{lemma-integral-closure}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{A}$ be a quasi-coherent sheaf of $\mathcal{O}_X$-algebras.
There exists a quasi-coherent sheaf of $\mathcal{O}_X$-algebras
$\mathcal{A}' \subset \mathcal{A}$ such that
for any affine object $U$ of $X_\etale$ the ring
$\mathcal{A}'(U) \subset \mathcal{A}(U)$ is
the integral closure of $\mathcal{O}_X(U)$ in $\mathcal{A}(U)$.
\end{lemma}

\begin{proof}
By Properties of Spaces, Lemma \ref{spaces-properties-lemma-alternative}
it suffices to prove that the rule given above defines a quasi-coherent
module on $X_{affine, \etale}$. To see this it suffices
to show the following: Let $U_1 \to U_2$ be a morphism of affine objects of
$X_\etale$. Say $U_i = \Spec(R_i)$.
Say $\mathcal{A}|_{(U_1)_\etale}$
is the quasi-coherent sheaf associated to
the $R_2$-algebra $A$. Let $A' \subset A$ be the integral closure
of $R_2$ in $A$. Then $A' \otimes_{R_2} R_1$ is the integral closure
of $R_1$ in $A \otimes_{R_2} R_1$. This is
Algebra, Lemma \ref{algebra-lemma-integral-closure-commutes-etale}.
\end{proof}

\begin{definition}
\label{definition-integral-closure}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{A}$ be a quasi-coherent sheaf of $\mathcal{O}_X$-algebras.
The {\it integral closure of $\mathcal{O}_X$ in $\mathcal{A}$} is the
quasi-coherent $\mathcal{O}_X$-subalgebra $\mathcal{A}' \subset \mathcal{A}$
constructed in Lemma \ref{lemma-integral-closure} above.
\end{definition}

\noindent
We will apply this in particular when $\mathcal{A} = f_*\mathcal{O}_Y$
for a quasi-compact and quasi-separated morphism of algebraic spaces
$f : Y \to X$ (see Lemma \ref{lemma-pushforward}). We can then take
the relative spectrum of the quasi-coherent $\mathcal{O}_X$-algebra
(Lemma \ref{lemma-affine-equivalence-algebras}) to obtain the
normalization of $X$ in $Y$.

\begin{definition}
\label{definition-normalization-X-in-Y}
Let $S$ be a scheme. Let $f : Y \to X$ be a quasi-compact and quasi-separated
morphism of algebraic spaces over $S$. Let $\mathcal{O}'$ be the integral
closure of $\mathcal{O}_X$ in $f_*\mathcal{O}_Y$. The {\it normalization of
$X$ in $Y$} is the morphism of algebraic spaces
$$
\nu : X' = \underline{\Spec}_X(\mathcal{O}') \to X
$$
over $S$. It comes equipped with a natural factorization
$$
Y \xrightarrow{f'} X' \xrightarrow{\nu} X
$$
of the initial morphism $f$.
\end{definition}

\noindent
To get the factorization, use Remark
\ref{remark-factorization-quasi-compact-quasi-separated}
and functoriality of the $\underline{\Spec}$ construction.

\begin{lemma}
\label{lemma-properties-normalization}
Let $S$ be a scheme. Let $f : Y \to X$ be a quasi-compact and quasi-separated
morphism of algebraic spaces over $S$. Let $Y \to X' \to X$ be the
normalization of $X$ in $Y$.
\begin{enumerate}
\item If $W \to X$ is an \'etale morphism of algebraic spaces over $S$,
then $W \times_X X'$ is the normalization of $W$ in $W \times_X Y$.
\item If $Y$ and $X$ are representable, then $Y'$ is representable
and is canonically isomorphic to the normalization of the scheme $X$
in the scheme $Y$ as constructed in
Morphisms, Section \ref{morphisms-section-normalization}.
\end{enumerate}
\end{lemma}

\begin{proof}
It is immediate from the construction that the formation
of the normalization of $X$ in $Y$ commutes with \'etale
base change, i.e., part (1) holds. On the other hand, if
$X$ and $Y$ are schemes, then for $U \subset X$ affine open,
$f_*\mathcal{O}_Y(U) = \mathcal{O}_Y(f^{-1}(U))$ and hence
$\nu^{-1}(U)$ is the spectrum of exactly the same ring as
we get in the corresponding construction for schemes.
\end{proof}

\noindent
Here is a characterization of this construction.

\begin{lemma}
\label{lemma-characterize-normalization}
Let $S$ be a scheme. Let $f : Y \to X$ be a quasi-compact and quasi-separated
morphism of algebraic spaces over $S$. The factorization $f = \nu \circ f'$,
where $\nu : X' \to X$ is the normalization of $X$ in $Y$ is characterized
by the following two properties:
\begin{enumerate}
\item the morphism $\nu$ is integral, and
\item for any factorization $f = \pi \circ g$, with $\pi : Z \to X$
integral, there exists a commutative diagram
$$
\xymatrix{
Y \ar[d]_{f'} \ar[r]_g & Z \ar[d]^\pi \\
X' \ar[ru]^h \ar[r]^\nu & X
}
$$
for a unique morphism $h : X' \to Z$.
\end{enumerate}
Moreover, in (2) the morphism $h : X' \to Z$ is the normalization of
$Z$ in $Y$.
\end{lemma}

\begin{proof}
Let $\mathcal{O}' \subset f_*\mathcal{O}_Y$ be the integral closure of
$\mathcal{O}_X$ as in Definition \ref{definition-normalization-X-in-Y}.
The morphism $\nu$ is integral by construction, which proves (1).
Assume given a factorization $f = \pi \circ g$ with $\pi : Z \to X$
integral as in (2). By Definition \ref{definition-integral}
$\pi$ is affine, and hence $Z$ is the relative
spectrum of a quasi-coherent sheaf of $\mathcal{O}_X$-algebras $\mathcal{B}$.
The morphism $g : X \to Z$ corresponds to a map of $\mathcal{O}_X$-algebras
$\chi : \mathcal{B} \to f_*\mathcal{O}_Y$. Since $\mathcal{B}(U)$ is
integral over $\mathcal{O}_X(U)$ for every affine $U$ \'etale over $X$
(by Definition \ref{definition-integral})
we see from Lemma \ref{lemma-integral-closure}
that $\chi(\mathcal{B}) \subset \mathcal{O}'$.
By the functoriality of the relative spectrum
Lemma \ref{lemma-affine-equivalence-algebras}
this provides us with a unique morphism
$h : X' \to Z$. We omit the verification that the diagram commutes.

\medskip\noindent
It is clear that (1) and (2) characterize the
factorization $f = \nu \circ f'$ since it characterizes it
as an initial object in a category. The morphism $h$ in (2)
is integral by Lemma \ref{lemma-finite-permanence}.
Given a factorization $g = \pi' \circ g'$ with $\pi' : Z' \to Z$
integral, we get a factorization $f = (\pi \circ \pi') \circ g'$ and
we get a morphism $h' : X' \to Z'$. Uniqueness implies that
$\pi' \circ h' = h$. Hence the characterization (1), (2) applies
to the morphism $h : X' \to Z$ which gives the last statement of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-normalization-in-reduced}
Let $S$ be a scheme. Let $f : Y \to X$ be a quasi-compact and
quasi-separated morphism of algebraic spaces over $S$.
Let $X' \to X$ be the normalization of $X$ in $Y$.
If $Y$ is reduced, so is $X'$.
\end{lemma}

\begin{proof}
This follows from the fact that a subring of a reduced ring is reduced.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-normalization-generic}
Let $S$ be a scheme. Let $f : Y \to X$ be a quasi-compact and quasi-separated
morphism of schemes. Let $X' \to X$ be the normalization of $X$ in $Y$.
If $x' \in |X'|$ is a point of codimension $0$
(Properties of Spaces, Definition
\ref{spaces-properties-definition-dimension-local-ring}), then
$x'$ is the image of some $y \in |Y|$ of codimension $0$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-properties-normalization} and the definitions, we may
assume that $X = \Spec(A)$ is affine. Then $X' = \Spec(A')$ where $A'$ is
the integral closure of $A$ in $\Gamma(Y, \mathcal{O}_Y)$ and $x'$ corresponds
to a minimal prime of $A'$. Choose a surjective \'etale
morphism $V \to Y$ where $V = \Spec(B)$ is affine. Then
$A' \to B$ is injective, hence every minimal prime of $A'$ is
the image of a minimal prime of $B$, see
Algebra, Lemma \ref{algebra-lemma-injective-minimal-primes-in-image}.
The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-normalization-in-disjoint-union}
Let $S$ be a scheme.
Let $f : Y \to X$ be a quasi-compact and quasi-separated morphism of
algebraic spaces over $S$.
Suppose that $Y = Y_1 \amalg Y_2$ is a disjoint union of two
algebraic spaces.
Write $f_i = f|_{Y_i}$. Let $X_i'$ be the normalization of $X$ in $Y_i$.
Then $X_1' \amalg X_2'$ is the normalization of $X$ in $Y$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-normalization-in-universally-closed}
Let $S$ be a scheme.
Let $f : X \to Y$ be a quasi-compact, quasi-separated and
universally closed morphisms of algebraic spaces over $S$.
Then $f_*\mathcal{O}_X$ is integral over $\mathcal{O}_Y$. In other
words, the normalization of $Y$ in $X$ is equal to the factorization
$$
X \longrightarrow \underline{\Spec}_Y(f_*\mathcal{O}_X)
\longrightarrow Y
$$
of Remark \ref{remark-factorization-quasi-compact-quasi-separated}.
\end{lemma}

\begin{proof}
The question is \'etale local on $Y$, hence we may reduce to the
case where $Y = \Spec(R)$ is affine. Let $h \in \Gamma(X, \mathcal{O}_X)$.
We have to show that $h$ satisfies a monic equation over $R$. Think of $h$
as a morphism as in the following commutative diagram
$$
\xymatrix{
X \ar[rr]_h \ar[rd]_f & & \mathbf{A}^1_Y \ar[ld] \\
& Y &
}
$$
Let $Z \subset \mathbf{A}^1_Y$ be the scheme theoretic image of $h$,
see Definition \ref{definition-scheme-theoretic-image}.
The morphism $h$ is quasi-compact as $f$ is quasi-compact and
$\mathbf{A}^1_Y \to Y$ is separated, see
Lemma \ref{lemma-quasi-compact-permanence}.
By Lemma \ref{lemma-quasi-compact-scheme-theoretic-image} the
morphism $X \to Z$ has dense image on underlying topological spaces. By
Lemma \ref{lemma-universally-closed-permanence} the morphism
$X \to Z$ is closed. Hence $h(X) = Z$ (set theoretically).
Thus we can use
Lemma \ref{lemma-image-proper-is-proper}
to conclude that $Z \to Y$ is universally closed (and even proper).
Since $Z \subset \mathbf{A}^1_Y$, we see that $Z \to Y$ is affine
and proper, hence integral by Lemma \ref{lemma-integral-universally-closed}.
Writing $\mathbf{A}^1_Y = \Spec(R[T])$ we conclude that
the ideal $I \subset R[T]$ of $Z$ contains a monic polynomial
$P(T) \in R[T]$. Hence $P(h) = 0$ and we win.
\end{proof}

\begin{lemma}
\label{lemma-normalization-in-integral}
Let $S$ be a scheme. Let $f : Y \to X$ be an integral morphism
of algebraic spaces over $S$.
Then the integral closure of $X$ in $Y$ is equal to $Y$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-integral-universally-closed} this is a special case of
Lemma \ref{lemma-normalization-in-universally-closed}.
\end{proof}

\begin{lemma}
\label{lemma-nagata-normalization-finite}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic spaces
over $S$. Assume that
\begin{enumerate}
\item $Y$ is Nagata,
\item $f$ is quasi-separated of finite type,
\item $X$ is reduced.
\end{enumerate}
Then the normalization $\nu : X' \to X$ of $X$ in $Y$ is finite.
\end{lemma}

\begin{proof}
The question is \'etale local on $Y$, see
Lemma \ref{lemma-properties-normalization}.
Thus we may assume $Y = \Spec(R)$ is affine.
Then $R$ is a Noetherian Nagata ring
and we have to show that the integral closure of
$R$ in $\Gamma(X, \mathcal{O}_X)$ is finite over $R$.
Since $f$ is quasi-compact we see that $X$ is quasi-compact.
Choose an affine scheme $U$ and a surjective \'etale
morphism $U \to X$ (Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}).
Then $\Gamma(X, \mathcal{O}_X) \subset \Gamma(U, \mathcal{O}_X)$.
Since $R$ is Noetherian it suffices to show that
the integral closure of $R$ in $\Gamma(U, \mathcal{O}_U)$
is finite over $R$. As $U \to Y$ is of finite type
this follows from
Morphisms, Lemma \ref{morphisms-lemma-nagata-normalization-finite}.
\end{proof}






\section{Normalization}
\label{section-normalization}

\noindent
This section is the analogue of
Morphisms, Section \ref{morphisms-section-normalization}.

\begin{lemma}
\label{lemma-prepare-normalization}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
The following are equivalent
\begin{enumerate}
\item there is a surjective \'etale morphism $U \to X$ where $U$
is as scheme such that every quasi-compact open of $U$ has
finitely many irreducible components,
\item for every scheme $U$ and every \'etale morphism
$U \to X$ every quasi-compact open of $U$ has finitely many
irreducible components, and
\item for every quasi-compact algebraic space $Y$ \'etale over $X$
the space $|Y|$ has finitely many irreducible components.
\end{enumerate}
If $X$ is representable this means that every quasi-compact open of $X$
has finitely many irreducible components.
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) and the final statement follow from
Descent, Lemma \ref{descent-lemma-locally-finite-nr-irred-local-fppf} and
Properties of Spaces, Lemma \ref{spaces-properties-lemma-type-property}.
It is clear that (3) implies (1) and (2). Conversely, assume (2) and
let $Y \to X$ be an \'etale morphism of algebraic spaces with $Y$
quasi-compact. Then we can choose an affine scheme $V$ and a surjective
\'etale morphism $V \to Y$ (Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}).
Since $V$ has finitely many irreducible components by (2) and since
$|V| \to |Y|$ is surjective and continuous, we conclude that
$|Y|$ has finitely many irreducible components.
\end{proof}

\begin{lemma}
\label{lemma-normalization}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$ satisfying
the equivalent conditions of Lemma \ref{lemma-prepare-normalization}.
Then there exists an integral morphism of algebraic spaces
$$
X^\nu \longrightarrow X
$$
such that for every scheme $U$ and \'etale morphism $U \to X$
the fibre product $X^\nu \times_X U$ is the normalization of $U$.
\end{lemma}

\begin{proof}
Let $U \to X$ be a surjective \'etale morphism where $U$ is a scheme.
Set $R = U \times_X U$ with projections $s, t : R \to U$ and
$j = (t, s) : R \to U \times_S U$ so that $X = U/R$, see
Spaces, Lemma \ref{spaces-lemma-space-presentation}.
The assumption on $X$ means that the normalization $U^\nu$ of $U$
is defined, see Morphisms, Definition
\ref{morphisms-definition-normalization}.
By More on Morphisms, Lemma
\ref{more-morphisms-lemma-normalization-and-smooth}
taking normalization commutes with \'etale morphisms of schemes.
Thus we see that the normalization $R^\nu$ of $R$
is isomorphic to both $R \times_{s, U} U^\nu$ and $U^\nu \times_{U, t} R$.
Thus we obtain two \'etale morphisms
$s^\nu : R^\nu \to U^\nu$ and $t^\nu : R^\nu \to U^\nu$
of schemes. The induced morphism $j^\nu : R^\nu \to U^\nu \times_S U^\nu$
is a monomorphism as $R^\nu$ is a subscheme of the restriction of
$R$ to $U^\nu$. A formal computation with fibre products shows that
$R^\nu \times_{s^\nu, U^\nu, t^\nu} R^\nu$ is the normalization
of $R \times_{s, U, t} R$. Hence the (\'etale) morphism
$c : R \times_{s, U, t} R \to R$ extends to $c^\nu$ as well.
Combined we see that we obtain an \'etale equivalence relation.
Setting $X^\nu = U^\nu/R^\nu$
(Spaces, Theorem \ref{spaces-theorem-presentation})
we see that we have $U^\nu = X^\nu \times_X U$ by
Groupoids, Lemma \ref{groupoids-lemma-criterion-fibre-product}.
We omit the verification that this property then holds for every
\'etale morphism from a scheme to $X$.
\end{proof}

\noindent
This leads us to the following definition.

\begin{definition}
\label{definition-normalization}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$ satisfying the
equivalent conditions of Lemma \ref{lemma-prepare-normalization}.
We define the {\it normalization} of $X$ as the morphism
$$
\nu : X^\nu \longrightarrow X
$$
constructed in Lemma \ref{lemma-normalization}.
\end{definition}

\noindent
Any locally Noetherian scheme has a locally finite set of irreducible
components. Hence the definition applies to locally Noetherian algebraic
spaces. Usually the normalization is defined only for reduced algebraic
spaces. With the definition above the normalization of $X$ is the same
as the normalization of the reduction $X_{red}$ of $X$.

\begin{lemma}
\label{lemma-normalization-reduced}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$ satisfying the
equivalent conditions of Lemma \ref{lemma-prepare-normalization}.
The normalization morphism $\nu$ factors through the reduction $X_{red}$
and $X^\nu \to X_{red}$ is the normalization of $X_{red}$.
\end{lemma}

\begin{proof}
We may check this \'etale locally on $X$ and hence reduce to the case
of schemes which is
Morphisms, Lemma \ref{morphisms-lemma-normalization-reduced}.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-normalization-normal}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$ satisfying the
equivalent conditions of Lemma \ref{lemma-prepare-normalization}.
\begin{enumerate}
\item The normalization $X^\nu$ is normal.
\item The morphism $\nu : X^\nu \to X$ is integral and surjective.
\item The map $|\nu| : |X^\nu| \to |X|$ induces a bijection between
the sets of points of codimension $0$ (Properties of Spaces,
Definition \ref{spaces-properties-definition-dimension-local-ring}).
\item Let $Z \to X$ be a morphism. Assume $Z$ is a normal algebraic space
and that for $z \in |Z|$ we have: $z$ has codimension $0$ in
$Z \Rightarrow f(z)$ has codimension $0$ in $X$. Then
there exists a unique factorization $Z \to X^\nu \to X$.
\end{enumerate}
\end{lemma}

\begin{proof}
Properties (1), (2), and (3) follow from the corresponding results
for schemes (Morphisms, Lemma \ref{morphisms-lemma-normalization-normal})
combined with the fact that a point of a scheme is a generic
point of an irreducible component if and only if the dimension
of the local ring is zero
(Properties, Lemma \ref{properties-lemma-generic-point}).

\medskip\noindent
Let $Z \to X$ be a morphism as in (4). Let $U$ be a scheme and let
$U \to X$ be a surjective \'etale morphism. Choose a scheme $V$ and
a surjective \'etale morphism $V \to U \times_X Z$. The condition on
geometric points assures us that $V \to U$ maps generic points of
irreducible components of $V$ to generic points of irreducible
components of $U$. Thus we obtain a unique factorization
$V \to U^\nu \to U$ by
Morphisms, Lemma \ref{morphisms-lemma-normalization-normal}.
The uniqueness guarantees us that the two maps
$$
V \times_{U \times_X Z} V \to V \to U^\nu
$$
agree because these maps are the unique factorization of the map
$V \times_{U \times_X Z} V \to V \to U$.
Since the algebraic space $U \times_X Z$ is equal to the quotient
$V/V \times_{U \times_X Z} V$
(see Spaces, Section \ref{spaces-section-presentations})
we find a canonical morphism
$U \times_X Z \to U^\nu$. Picture
$$
\xymatrix{
U \times_X Z \ar[r] \ar[d] & U^\nu \ar[r] \ar[d] & U \ar[d] \\
Z \ar@/_/[rr] \ar@{..>}[r] & X^\nu \ar[r] & X
}
$$
To obtain the dotted arrow we note that the construction of the
arrow $U \times_X Z$ is functorial in the \'etale morphism $U \to X$
(precise formulation and proof omitted).
Hence if we set $R = U \times_X U$ with projections $s, t : R \to U$,
then we obtain a morphism $R \times_X Z \to R^\nu$ commuting with
$s, t : R \to U$ and $s^\nu, t^\nu : R^\nu \to U^\nu$.
Recall that $X^\nu = U^\nu/R^\nu$, see proof of
Lemma \ref{lemma-normalization}. Since $X = U/R$ a
simple sheaf theoretic argument
shows that $Z = (U \times_X Z)/(R \times_X Z)$. Thus the morphisms
$U \times_X Z \to U^\nu$ and $R \times_X Z \to R^\nu$ define a
morphism $Z \to X^\nu$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-nagata-normalization}
Let $S$ be a scheme. Let $X$ be a Nagata algebraic space over $S$.
The normalization $\nu : X^\nu \to X$ is a finite morphism.
\end{lemma}

\begin{proof}
Since $X$ being Nagata is locally Noetherian,
Definition \ref{definition-normalization} applies.
By construction of $X^\nu$ in Lemma \ref{lemma-normalization}
we immediately reduce to the case of schemes which is
Morphisms, Lemma \ref{morphisms-lemma-nagata-normalization}.
\end{proof}












\section{Separated, locally quasi-finite morphisms}
\label{section-schemehood}

\noindent
In this section we prove that an algebraic space which is locally
quasi-finite and separated over a scheme, is representable. This
implies that a separated and locally quasi-finite morphism is
representable (see
Lemma \ref{lemma-locally-quasi-finite-separated-representable}).
But first...\ a lemma (which will be obsoleted by
Proposition \ref{proposition-locally-quasi-finite-separated-over-scheme}).

\begin{lemma}
\label{lemma-neighbourhood-scheme}
Let $S$ be a scheme. Consider a commutative diagram
$$
\xymatrix{
V' \ar[r] \ar[rd] & T' \times_T X \ar[r] \ar[d] & X \ar[d] \\
& T' \ar[r] & T
}
$$
of algebraic spaces over $S$. Assume
\begin{enumerate}
\item $T' \to T$ is an \'etale morphism of affine schemes,
\item $X \to T$ is a separated, locally quasi-finite morphism,
\item $V'$ is an open subspace of $T' \times_T X$, and
\item $V' \to T'$ is quasi-affine.
\end{enumerate}
In this situation the image $U$ of $V'$ in $X$ is a quasi-compact
open subspace of $X$ which is representable.
\end{lemma}

\begin{proof}
We first make some trivial observations.
Note that $V'$ is representable by Lemma \ref{lemma-quasi-affine-local}.
It is also quasi-compact (as a quasi-affine scheme over an affine scheme, see
Morphisms, Lemma \ref{morphisms-lemma-quasi-affine-separated}).
Since $T' \times_T X \to X$ is \'etale
(Properties of Spaces, Lemma \ref{spaces-properties-lemma-base-change-etale})
the map $|T' \times_T X| \to |X|$ is open, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-open}.
Let $U \subset X$ be the open subspace corresponding to the image of
$|V'|$, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-open-subspaces}.
As $|V'|$ is quasi-compact we see that $|U|$ is quasi-compact, hence
$U$ is a quasi-compact algebraic space, by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-quasi-compact-space}.

\medskip\noindent
By
Morphisms,
Lemma \ref{morphisms-lemma-locally-quasi-finite-qc-source-universally-bounded}
the morphism $T' \to T$ is universally bounded. Hence we can do induction on
the integer $n$ bounding the degree of the fibres of $T' \to T$, see
Morphisms, Lemma \ref{morphisms-lemma-etale-universally-bounded}
for a description of this integer in the case of an \'etale morphism.
If $n = 1$, then $T' \to T$ is an open immersion (see
\'Etale Morphisms, Theorem \ref{etale-theorem-etale-radicial-open}),
and the result is clear. Assume $n > 1$.

\medskip\noindent
Consider the affine scheme $T'' = T' \times_T T'$.
As $T' \to T$ is \'etale we have a decomposition (into open and closed affine
subschemes) $T'' = \Delta(T') \amalg T^*$. Namely $\Delta = \Delta_{T'/T}$
is open by
Morphisms, Lemma \ref{morphisms-lemma-diagonal-unramified-morphism}
and closed because $T' \to T$ is separated as a morphism of affines.
As a base change the degrees of the fibres of the second projection
$\text{pr}_1 : T' \times_T T' \to T'$ are bounded by $n$, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-universally-bounded}.
On the other hand, $\text{pr}_1|_{\Delta(T')} : \Delta(T') \to T'$ is
an isomorphism and every fibre has exactly one point.
Thus, on applying
Morphisms, Lemma \ref{morphisms-lemma-etale-universally-bounded}
we conclude the degrees of the fibres of the restriction
$\text{pr}_1|_{T^*} : T^* \to T'$ are bounded by $n - 1$.
Hence the induction hypothesis applied to the diagram
$$
\xymatrix{
p_0^{-1}(V') \cap X^* \ar[r] \ar[rd] &
X^* \ar[r]_{p_1|_{X^*}} \ar[d] &
X' \ar[d] \\
& T^* \ar[r]^{\text{pr}_1|_{T^*}} & T'
}
$$
gives that $p_1(p_0^{-1}(V') \cap X^*)$
is a quasi-compact scheme. Here we set
$X'' = T'' \times_T X$, $X^* = T^* \times_T X$, and $X' = T' \times_T X$,
and $p_0, p_1 : X'' \to X'$ are the base changes of $\text{pr}_0, \text{pr}_1$.
Most of the hypotheses of the lemma imply
by base change the corresponding hypothesis for the diagram above.
For example $p_0^{-1}(V') = T'' \times_{T'} V'$
is a scheme quasi-affine over $T''$ as a base change. Some
verifications omitted.

\medskip\noindent
By
Properties of Spaces, Lemma \ref{spaces-properties-lemma-subscheme}
we conclude that
$$
p_1(p_0^{-1}(V')) =
V' \cup p_1(p_0^{-1}(V') \cap X^*)
$$
is a quasi-compact scheme. Moreover, it is clear that
$p_1(p_0^{-1}(V'))$ is the inverse image of the
quasi-compact open subspace $U \subset X$ discussed in the
first paragraph of the proof. In other words, $T' \times_T U$ is a scheme!
Note that $T' \times_T U$ is quasi-compact and
separated and locally quasi-finite over $T'$, as
$T' \times_T X \to T'$ is locally quasi-finite and separated
being a base change of the original morphism $X \to T$ (see
Lemmas \ref{lemma-base-change-separated} and
\ref{lemma-base-change-quasi-finite}).
This implies by
More on Morphisms,
Lemma \ref{more-morphisms-lemma-quasi-finite-separated-quasi-affine}
that $T' \times_T U \to T'$ is quasi-affine.

\medskip\noindent
By
Descent, Lemma \ref{descent-lemma-descent-data-sheaves}
this gives a descent datum on $T' \times_T U / T'$
relative to the \'etale covering $\{T' \to W\}$, where $W \subset T$
is the image of the morphism $T' \to T$.
Because $U'$ is quasi-affine over $T'$ we see from
Descent, Lemma \ref{descent-lemma-quasi-affine}
that this datum is effective, and by the last part of
Descent, Lemma \ref{descent-lemma-descent-data-sheaves}
this implies that $U$ is a scheme as desired.
Some minor details omitted.
\end{proof}

\begin{proposition}
\label{proposition-locally-quasi-finite-separated-over-scheme}
Let $S$ be a scheme.
Let $f : X \to T$ be a morphism of algebraic spaces over $S$.
Assume
\begin{enumerate}
\item $T$ is representable,
\item $f$ is locally quasi-finite, and
\item $f$ is separated.
\end{enumerate}
Then $X$ is representable.
\end{proposition}

\begin{proof}
Let $T = \bigcup T_i$ be an affine open covering of the scheme $T$.
If we can show that the open subspaces $X_i = f^{-1}(T_i)$ are
representable, then $X$ is representable, see
Properties of Spaces, Lemma \ref{spaces-properties-lemma-subscheme}.
Note that $X_i = T_i \times_T X$ and that locally quasi-finite and
separated are both stable under base change, see
Lemmas \ref{lemma-base-change-separated} and
\ref{lemma-base-change-quasi-finite}.
Hence we may assume $T$ is an affine scheme.

\medskip\noindent
By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-union-of-quasi-compact}
there exists a Zariski covering $X = \bigcup X_i$
such that each $X_i$ has a surjective \'etale covering by
an affine scheme. By
Properties of Spaces, Lemma \ref{spaces-properties-lemma-subscheme}
again it suffices to prove the proposition for each $X_i$.
Hence we may assume there exists an affine scheme $U$ and a
surjective \'etale morphism $U \to X$. This reduces us to the
situation in the next paragraph.

\medskip\noindent
Assume we have
$$
U \longrightarrow X \longrightarrow T
$$
where $U$ and $T$ are affine schemes, $U \to X$ is \'etale surjective, and
$X \to T$ is separated and locally quasi-finite. By
Lemmas \ref{lemma-etale-locally-quasi-finite} and
\ref{lemma-composition-quasi-finite}
the morphism $U \to T$ is locally quasi-finite.
Since $U$ and $T$ are affine it is quasi-finite.
Set $R = U \times_X U$. Then $X = U/R$, see
Spaces, Lemma \ref{spaces-lemma-space-presentation}.
As $X \to T$ is separated the
morphism $R \to U \times_T U$ is a closed immersion, see
Lemma \ref{lemma-fibre-product-after-map}.
In particular $R$ is an affine scheme also.
As $U \to X$ is \'etale the projection morphisms
$t, s : R \to U$ are \'etale as well. In particular $s$ and $t$ are
quasi-finite, flat and of finite presentation (see
Morphisms, Lemmas \ref{morphisms-lemma-etale-locally-quasi-finite},
\ref{morphisms-lemma-etale-flat} and
\ref{morphisms-lemma-etale-locally-finite-presentation}).

\medskip\noindent
Let $(U, R, s, t, c)$ be the groupoid associated to the \'etale
equivalence relation $R$ on $U$. Let $u \in U$ be a point, and
denote $p \in T$ its image. We are going to use
More on Groupoids,
Lemma \ref{more-groupoids-lemma-quasi-finite-over-base-j-proper}
for the groupoid $(U, R, s, t, c)$ over the scheme $T$ with
points $p$ and $u$ as above.
By the discussion in the previous paragraph all the
assumptions (1) -- (7) of that lemma are satisfied.
Hence we get an \'etale neighbourhood
$(T', p') \to (T, p)$ and disjoint union decompositions
$$
U_{T'} = U' \amalg W, \quad
R_{T'} = R' \amalg W'
$$
and $u' \in U'$ satisfying conclusions
(a), (b), (c), (d), (e), (f), (g), and (h) of the aforementioned
More on Groupoids,
Lemma \ref{more-groupoids-lemma-quasi-finite-over-base-j-proper}.
We may and do assume that $T'$ is affine (after possibly shrinking $T'$).
Conclusion (h) implies that $R' = U' \times_{X_{T'}} U'$ with projection
mappings identified with the restrictions of $s'$ and $t'$.
Thus $(U', R', s'|_{R'}, t'|_{R'}, c'|_{R' \times_{t', U', s'} R'})$ of
conclusion (g) is an \'etale equivalence relation. By
Spaces, Lemma \ref{spaces-lemma-finding-opens}
we conclude that $U'/R'$ is an open subspace of $X_{T'}$. By conclusion (d)
the schemes $U'$, $R'$ are affine and the morphisms
$s'|_{R'}, t'|_{R'}$ are finite \'etale. Hence
Groupoids, Proposition \ref{groupoids-proposition-finite-flat-equivalence}
kicks in and we see that $U'/R'$ is an affine scheme.

\medskip\noindent
We conclude that for every pair of points $(u, p)$ as above we can
find an \'etale neighbourhood $(T', p') \to (T, p)$ with
$\kappa(p) = \kappa(p')$ and a point $u' \in U_{T'}$ mapping to $u$
such that the image $x'$ of $u'$ in $|X_{T'}|$ has an open neighbourhood
$V'$ in $X_{T'}$ which is an affine scheme. We apply
Lemma \ref{lemma-neighbourhood-scheme}
to obtain an open subspace $W \subset X$ which is a scheme, and
which contains $x$ (the image of $u$ in $|X|$).
Since this works for every $x$ we see that $X$
is a scheme by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-subscheme}.
This ends the proof.
\end{proof}



\section{Applications}
\label{section-applications}

\noindent
An alternative proof of the following lemma is to see it as a consequence
of Zariski's main theorem for (nonrepresentable) morphisms of algebraic spaces
as discussed in More on Morphisms of Spaces, Section
\ref{spaces-more-morphisms-section-structure-quasi-finite}.
Namely, More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-quasi-finite-separated-quasi-affine}
implies that a quasi-finite and separated morphism of algebraic spaces
is quasi-affine and therefore representable.

\begin{lemma}
\label{lemma-locally-quasi-finite-separated-representable}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic
spaces over $S$. If $f$ is locally quasi-finite and separated, then
$f$ is representable.
\end{lemma}

\begin{proof}
This is immediate from
Proposition \ref{proposition-locally-quasi-finite-separated-over-scheme}
and the fact that being locally quasi-finite and separated is
preserved under any base change, see
Lemmas \ref{lemma-base-change-quasi-finite} and
\ref{lemma-base-change-separated}.
\end{proof}

\begin{lemma}
\label{lemma-etale-universally-injective-open}
\begin{slogan}
Universally injective \'etale maps are open immersions.
\end{slogan}
Let $S$ be a scheme. Let $f : X \to Y$ be an \'etale and universally
injective morphism of algebraic spaces over $S$. Then $f$ is an open
immersion.
\end{lemma}

\begin{proof}
Let $T \to Y$ be a morphism from a scheme into $Y$.
If we can show that $X \times_Y T \to T$ is an open immersion, then we
are done. Since being \'etale and being universally injective are
properties of morphisms stable under base change (see
Lemmas \ref{lemma-base-change-etale} and
\ref{lemma-base-change-universally-injective})
we may assume that $Y$ is a scheme. Note that the
diagonal $\Delta_{X/Y} : X \to X \times_Y X$ is \'etale, a monomorphism, and
surjective by
Lemma \ref{lemma-universally-injective}.
Hence we see that $\Delta_{X/Y}$ is an isomorphism (see
Spaces, Lemma
\ref{spaces-lemma-surjective-flat-locally-finite-presentation}),
in particular we see that $X$ is separated over $Y$.
It follows that $X$ is a scheme too, by
Proposition \ref{proposition-locally-quasi-finite-separated-over-scheme}.
Finally, $X \to Y$ is an open immersion by the fundamental theorem
for \'etale morphisms of schemes, see
\'Etale Morphisms, Theorem \ref{etale-theorem-etale-radicial-open}.
\end{proof}



\section{Zariski's Main Theorem (representable case)}
\label{section-Zariski}

\noindent
This is the version you can prove using that normalization
commutes with \'etale localization. Before we can prove more
powerful versions (for non-representable morphisms) we need to
develop more tools. See
More on Morphisms of Spaces, Section
\ref{spaces-more-morphisms-section-structure-quasi-finite}.

\begin{lemma}
\label{lemma-finite-type-separated}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of algebraic
spaces over $S$ which is representable, of finite type, and separated.
Let $Y'$ be the normalization of $Y$ in $X$. Picture:
$$
\xymatrix{
X \ar[rd]_f \ar[rr]_{f'} & & Y' \ar[ld]^\nu \\
& Y &
}
$$
Then there exists an open subspace $U' \subset Y'$ such that
\begin{enumerate}
\item $(f')^{-1}(U') \to U'$ is an isomorphism, and
\item $(f')^{-1}(U') \subset X$ is the set of points at which
$f$ is quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $W \to Y$ be a surjective \'etale morphism where $W$ is a scheme.
Then $W \times_Y X$ is a scheme as well. By
Lemma \ref{lemma-properties-normalization}
the algebraic space $W \times_Y Y'$ is representable and is
the normalization of the scheme $W$ in the scheme $W \times_Y X$. Picture
$$
\xymatrix{
W \times_Y X \ar[rd]_{(1, f)} \ar[rr]_{(1, f')} & &
W \times_Y Y' \ar[ld]^{(1, \nu)} \\
& W &
}
$$
By More on Morphisms, Lemma \ref{more-morphisms-lemma-finite-type-separated}
the result of the lemma holds over $W$. Let $V' \subset W \times_Y Y'$
be the open subscheme such that
\begin{enumerate}
\item $(1, f')^{-1}(V') \to V'$ is an isomorphism, and
\item $(1, f')^{-1}(V') \subset W \times_Y X$ is the set of points at which
$(1, f)$ is quasi-finite.
\end{enumerate}
By Lemma \ref{lemma-locally-finite-type-quasi-finite-part}
there is a maximal open set of points $U \subset X$ where $f$
is quasi-finite and $W \times_Y U = (1, f')^{-1}(V')$.
The morphism $f'|_U : U \to Y'$ is an open immersion
by Lemma \ref{lemma-closed-immersion-local}
as its base change to $W$ is the isomorphism $(1, f')^{-1}(V') \to V'$
followed by the open immersion $V' \to W \times_Y Y'$.
Setting $U' = \Im(U \to Y')$ finishes the proof
(omitted: the verification that $(f')^{-1}(U') = U$).
\end{proof}

\noindent
In the following lemma we can drop the assumption of being
representable as we've shown that a locally quasi-finite
separated morphism is representable.

\begin{lemma}
\label{lemma-quasi-finite-separated-quasi-affine}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Assume $f$ is quasi-finite and separated.
Let $Y'$ be the normalization of $Y$ in $X$.
Picture:
$$
\xymatrix{
X \ar[rd]_f \ar[rr]_{f'} & & Y' \ar[ld]^\nu \\
& Y &
}
$$
Then $f'$ is a quasi-compact open immersion and $\nu$ is integral.
In particular $f$ is quasi-affine.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-locally-quasi-finite-separated-representable}
the morphism $f$ is representable. Hence we may apply
Lemma \ref{lemma-finite-type-separated}. Thus there exists an open
subspace $U' \subset Y'$ such that
$(f')^{-1}(U') = X$ (!) and $X \to U'$ is an isomorphism! In other
words, $f'$ is an open immersion. Note that $f'$ is quasi-compact as
$f$ is quasi-compact and $\nu : Y' \to Y$ is separated
(Lemma \ref{lemma-quasi-compact-permanence}).
Hence for every affine scheme $Z$ and morphism $Z \to Y$ the
fibre product $Z \times_Y X$ is a quasi-compact open subscheme
of the affine scheme $Z \times_Y Y'$. Hence $f$ is quasi-affine by
definition.
\end{proof}








\section{Universal homeomorphisms}
\label{section-universal-homeomorphisms}

\noindent
The class of universal homeomorphisms of schemes is closed under
composition and arbitrary base change and is fppf local on the base. See
Morphisms, Lemmas
\ref{morphisms-lemma-composition-universal-homeomorphism} and
\ref{morphisms-lemma-base-change-universal-homeomorphism} and
Descent, Lemma \ref{descent-lemma-descending-property-universal-homeomorphism}.
Thus, if we apply the discussion in
Section \ref{section-representable}
to this notion we see that we know what it means for a representable
morphism of algebraic spaces to be a universal homeomorphism.

\begin{lemma}
\label{lemma-universal-homeomorphism-representable}
Let $S$ be a scheme.
Let $f : X \to Y$ be a representable morphism of algebraic spaces over $S$.
Then $f$ is a universal homeomorphism
(in the sense of Section \ref{section-representable}) if and only
if for every morphism of algebraic spaces $Z \to Y$ the base change
map $Z \times_Y X \to Z$ induces a homeomorphism
$|Z \times_Y X| \to |Z|$.
\end{lemma}

\begin{proof}
If for every morphism of algebraic spaces $Z \to Y$ the base change
map $Z \times_Y X \to Z$ induces a homeomorphism
$|Z \times_Y X| \to |Z|$, then the same is true whenever $Z$ is a scheme,
which formally implies that $f$ is a universal homeomorphism in the
sense of
Section \ref{section-representable}.
Conversely, if $f$ is a universal homeomorphism in the sense of
Section \ref{section-representable}
then $X \to Y$ is integral, universally injective and surjective
(by Spaces, Lemma
\ref{spaces-lemma-representable-transformations-property-implication}
and
Morphisms, Lemma \ref{morphisms-lemma-universal-homeomorphism}).
Hence $f$ is universally closed, see
Lemma \ref{lemma-integral-universally-closed}
and universally injective and (universally) surjective, i.e.,
$f$ is a universal homeomorphism.
\end{proof}

\begin{definition}
\label{definition-universal-homeomorphism}
Let $S$ be a scheme.
A morphism $f : X \to Y$ of algebraic spaces over $S$
is called a {\it universal homeomorphism}
if and only if for every morphism of algebraic spaces $Z \to Y$
the base change $Z \times_Y X \to Z$ induces a homeomorphism
$|Z \times_Y X| \to |Z|$.
\end{definition}

\noindent
This definition does not clash with the pre-existing definition for
representable morphisms of algebraic spaces by our
Lemma \ref{lemma-universal-homeomorphism-representable}.
For morphisms of algebraic spaces it is not the case that universal
homeomorphisms are always integral.

\begin{example}
\label{example-universal-homeomorphism}
This is a continuation of
Remark \ref{remark-universally-injective-not-separated}.
Consider the algebraic space
$X = \mathbf{A}^1_k/\{x \sim -x \mid x \not = 0\}$.
There are morphisms
$$
\mathbf{A}^1_k \longrightarrow X \longrightarrow \mathbf{A}^1_k
$$
such that the first arrow is \'etale surjective, the second arrow is
universally injective, and the composition is the map $x \mapsto x^2$.
Hence the composition is universally closed. Thus it follows that the
map $X \to \mathbf{A}^1_k$ is a universal homeomorphism, but
$X \to \mathbf{A}^1_k$ is not separated.
\end{example}

\noindent
Let $S$ be a scheme.
Let $f : X \to Y$ be a universal homeomorphism of algebraic spaces
over $S$. Then $f$ is universally closed, hence is quasi-compact, see
Lemma \ref{lemma-universally-closed-quasi-compact}.
But $f$ need not be separated (see example above), and not even
quasi-separated: an example is to take infinite dimensional affine
space $\mathbf{A}^\infty = \Spec(k[x_1, x_2, \ldots])$ modulo
the equivalence relation given by flipping finitely many signs of
nonzero coordinates (details omitted).

\medskip\noindent
First we state the obligatory lemmas.

\begin{lemma}
\label{lemma-base-change-universal-homeomorphism}
The base change of a universal homeomorphism of algebraic spaces
by any morphism of algebraic spaces is a universal homeomorphism.
\end{lemma}

\begin{proof}
This is immediate from the definition.
\end{proof}

\begin{lemma}
\label{lemma-composition-universal-homeomorphism}
The composition of a pair of universal homeomorphisms of
algebraic spaces is a universal homeomorphism.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-reduction-universal-homeomorphism}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
The canonical closed immersion $X_{red} \to X$ (see
Properties of Spaces, Definition
\ref{spaces-properties-definition-reduced-induced-space})
is a universal homeomorphism.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
We put the following result here as we do not currently have a better
place to put it.

\begin{lemma}
\label{lemma-integral-universally-injective-push-pull}
Let $S$ be a scheme. Let $f : Y \to X$ be a universally injective,
integral morphism of algebraic spaces over $S$.
\begin{enumerate}
\item The functor
$$
f_{small, *} : \Sh(Y_\etale) \longrightarrow \Sh(X_\etale)
$$
is fully faithful and its essential image is those sheaves of sets
$\mathcal{F}$ on $X_\etale$ whose restriction to $|X| \setminus f(|Y|)$
is isomorphic to $*$, and
\item the functor
$$
f_{small, *} : \textit{Ab}(Y_\etale) \longrightarrow \textit{Ab}(X_\etale)
$$
is fully faithful and its essential image is those abelian sheaves on
$Y_\etale$ whose support is contained in $f(|Y|)$.
\end{enumerate}
In both cases $f_{small}^{-1}$ is a left inverse to the functor $f_{small, *}$.
\end{lemma}

\begin{proof}
Since $f$ is integral it is universally closed
(Lemma \ref{lemma-integral-universally-closed}).
In particular, $f(|Y|)$ is a closed subset of $|X|$
and the statements make sense.
The rest of the proof is identical to the proof of
Lemma \ref{lemma-closed-immersion-push-pull}
except that we use
\'Etale Cohomology, Proposition
\ref{etale-cohomology-proposition-integral-universally-injective-pushforward}
instead of
\'Etale Cohomology, Proposition
\ref{etale-cohomology-proposition-closed-immersion-pushforward}.
\end{proof}























\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
