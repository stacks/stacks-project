\input{preamble}

% OK, start here.
%
\begin{document}

\title{Morphisms of Algebraic Stacks}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we introduce some types of morphisms of algebraic stacks.
A reference in the case of quasi-separated algebraic stacks with representable
diagonal is \cite{LM-B}.

\medskip\noindent
The goal is to extend the definition of each of the types of morphisms of
algebraic spaces to morphisms of algebraic stacks. Each case is slightly
different and it seems best to treat them all separately.

\medskip\noindent
For morphisms of algebraic stacks which are representable
by algebraic spaces we have already defined a large number of types of
morphisms, see
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}.
For each corresponding case in this chapter
we have to make sure the definition in the general
case is compatible with the definition given there.




\section{Conventions and abuse of language}
\label{section-conventions}

\noindent
We continue to use the conventions and the abuse of language
introduced in
Properties of Stacks, Section \ref{stacks-properties-section-conventions}.




\section{Properties of diagonals}
\label{section-diagonals}

\noindent
The diagonal of an algebraic stack is closely related to the
$\mathit{Isom}$-sheaves, see
Algebraic Stacks, Lemma \ref{algebraic-lemma-representable-diagonal}.
By the second defining property of an algebraic stack these
$\mathit{Isom}$-sheaves are always algebraic spaces.

\begin{lemma}
\label{lemma-isom-locally-finite-type}
Let $\mathcal{X}$ be an algebraic stack.
Let $T$ be a scheme and let $x, y$ be objects of the fibre category of
$\mathcal{X}$ over $T$. Then the morphism
$\mathit{Isom}_\mathcal{X}(x, y) \to T$ is locally of finite type.
\end{lemma}

\begin{proof}
By
Algebraic Stacks, Lemma \ref{algebraic-lemma-stack-presentation}
we may assume that $\mathcal{X} = [U/R]$ for some smooth
groupoid in algebraic spaces.
By
Descent on Spaces,
Lemma \ref{spaces-descent-lemma-descending-property-locally-finite-type}
it suffices to check the property fppf locally on $T$.
Thus we may assume that $x, y$ come from morphisms
$x', y' : T \to U$. By
Groupoids in Spaces,
Lemma \ref{spaces-groupoids-lemma-quotient-stack-morphisms}
we see that in this case
$\mathit{Isom}_\mathcal{X}(x, y) = T \times_{(y', x'), U \times_S U} R$.
Hence it suffices to prove that $R \to U \times_S U$ is
locally of finite type. This follows from the fact that the composition
$s : R \to U \times_S U \to U$ is smooth (hence locally of finite type, see
Morphisms of Spaces, Lemmas
\ref{spaces-morphisms-lemma-smooth-locally-finite-presentation} and
\ref{spaces-morphisms-lemma-finite-presentation-finite-type})
and
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-permanence-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-isom-pseudo-torsor-aut}
Let $\mathcal{X}$ be an algebraic stack.
Let $T$ be a scheme and let $x, y$ be objects of the fibre category of
$\mathcal{X}$ over $T$. Then
\begin{enumerate}
\item $\mathit{Isom}_\mathcal{X}(y, y)$ is a group algebraic space
over $T$, and
\item $\mathit{Isom}_\mathcal{X}(x, y)$ is a pseudo torsor for
$\mathit{Isom}_\mathcal{X}(y, y)$ over $T$.
\end{enumerate}
\end{lemma}

\begin{proof}
See
Groupoids in Spaces,
Definitions \ref{spaces-groupoids-definition-group-space} and
\ref{spaces-groupoids-definition-pseudo-torsor}.
The lemma follows immediately from the fact that $\mathcal{X}$ is a
stack in groupoids.
\end{proof}

\noindent
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
The {\it diagonal of $f$} is the morphism
$$
\Delta_f :
\mathcal{X}
\longrightarrow
\mathcal{X} \times_\mathcal{Y} \mathcal{X}
$$
Here are two properties that every diagonal morphism has.

\begin{lemma}
\label{lemma-properties-diagonal}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Then
\begin{enumerate}
\item $\Delta_f$ is representable by algebraic spaces,
and
\item $\Delta_f$ is locally of finite type.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $T$ be a scheme and let
$a : T \to \mathcal{X} \times_\mathcal{Y} \mathcal{X}$
be a morphism. By definition of the fibre product and the
$2$-Yoneda lemma the morphism $a$ is given by a triple
$a = (x, x', \alpha)$ where $x, x'$ are objects of $\mathcal{X}$
over $T$, and $\alpha : f(x) \to f(x')$ is a morphism in the fibre
category of $\mathcal{Y}$ over $T$. By definition of an algebraic
stack the sheaves $\mathit{Isom}_\mathcal{X}(x, x')$ and
$\mathit{Isom}_\mathcal{Y}(f(x), f(x'))$ are algebraic spaces
over $T$. In this language $\alpha$ defines a section of the morphism
$\mathit{Isom}_\mathcal{Y}(f(x), f(x')) \to T$. A $T'$-valued point of
$\mathcal{X} \times_{\mathcal{X} \times_\mathcal{Y} \mathcal{X}, a} T$
for $T' \to T$ a scheme over $T$ is the same thing as an isomorphism
$x|_{T'} \to x'|_{T'}$ whose image under $f$ is $\alpha|_{T'}$.
Thus we see that
\begin{equation}
\label{equation-diagonal}
\vcenter{
\xymatrix{
\mathcal{X} \times_{\mathcal{X} \times_\mathcal{Y} \mathcal{X}, a} T
\ar[d] \ar[r] &
\mathit{Isom}_\mathcal{X}(x, x') \ar[d] \\
T\ar[r]^-\alpha &
\mathit{Isom}_\mathcal{Y}(f(x), f(x'))
}
}
\end{equation}
is a fibre square of sheaves over $T$. In particular we see that
$\mathcal{X} \times_{\mathcal{X} \times_\mathcal{Y} \mathcal{X}, a} T$
is an algebraic space which proves part (1) of the lemma.

\medskip\noindent
To prove the second statement we have to show that the left
vertical arrow of Diagram (\ref{equation-diagonal}) is locally
of finite type. By
Lemma \ref{lemma-isom-locally-finite-type}
the algebraic space $\mathit{Isom}_\mathcal{X}(x, x')$ and
is locally of finite type over $T$. Hence the right vertical arrow of
Diagram (\ref{equation-diagonal}) is locally of finite type, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-permanence-finite-type}.
We conclude by
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-base-change-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-properties-diagonal-representable}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks
which is representable by algebraic spaces. Then
\begin{enumerate}
\item $\Delta_f$ is representable
(by schemes),
\item $\Delta_f$ is locally of finite type,
\item $\Delta_f$ is a monomorphism,
\item $\Delta_f$ is separated, and
\item $\Delta_f$ is locally quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
We have already seen in
Lemma \ref{lemma-properties-diagonal}
that $\Delta_f$ is representable by algebraic
spaces. Hence the statements (2) -- (5) make sense, see
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}.
Also
Lemma \ref{lemma-properties-diagonal}
guarantees (2) holds.
Let $T \to \mathcal{X} \times_\mathcal{Y} \mathcal{X}$ be a morphism
and contemplate Diagram (\ref{equation-diagonal}). By
Algebraic Stacks, Lemma
\ref{algebraic-lemma-criterion-map-representable-spaces-fibred-in-groupoids}
the right vertical arrow is injective as a map of sheaves, i.e., a
monomorphism of algebraic spaces. Hence also the morphism
$T \times_{\mathcal{X} \times_\mathcal{Y} \mathcal{X}} \mathcal{X} \to T$
is a monomorphism. Thus (3) holds. We already know that
$T \times_{\mathcal{X} \times_\mathcal{Y} \mathcal{X}} \mathcal{X} \to T$
is locally of finite type. Thus
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-monomorphism-loc-finite-type-loc-quasi-finite}
allows us to conclude that
$T \times_{\mathcal{X} \times_\mathcal{Y} \mathcal{X}} \mathcal{X} \to T$
is locally quasi-finite and separated. This proves (4) and (5).
Finally,
Morphisms of Spaces, Proposition
\ref{spaces-morphisms-proposition-locally-quasi-finite-separated-over-scheme}
implies that
$T \times_{\mathcal{X} \times_\mathcal{Y} \mathcal{X}} \mathcal{X}$
is a scheme which proves (1).
\end{proof}

\begin{lemma}
\label{lemma-representable-separated-diagonal-closed}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks
representable by algebraic spaces. Then the following are equivalent
\begin{enumerate}
\item $f$ is separated,
\item $\Delta_f$ is a closed immersion,
\item $\Delta_f$ is proper, or
\item $\Delta_f$ is universally closed.
\end{enumerate}
\end{lemma}

\begin{proof}
The statements
``$f$ is separated'',
``$\Delta_f$ is a closed immersion'',
``$\Delta_f$ is universally closed'', and
``$\Delta_f$ is proper''
refer to the notions defined in
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}.
Choose a scheme $V$ and a surjective smooth morphism $V \to \mathcal{Y}$.
Set $U = \mathcal{X} \times_\mathcal{Y} V$ which is an algebraic
space by assumption, and the morphism $U \to \mathcal{X}$ is surjective
and smooth. By
Categories, Lemma \ref{categories-lemma-base-change-diagonal}
and
Properties of Stacks,
Lemma \ref{stacks-properties-lemma-check-property-covering}
we see that for any property $P$ (as in that lemma) we have:
$\Delta_f$ has $P$ if and only if $\Delta_{U/V} : U \to  U \times_V U$ has $P$.
Hence the equivalence of (2), (3) and (4) follows from
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-separated-diagonal-proper}
applied to $U \to V$.
Moreover, if (1) holds, then $U \to V$ is separated and we see that
$\Delta_{U/V}$ is a closed immersion, i.e., (2) holds.
Finally, assume (2) holds. Let $T$ be a scheme, and $a : T \to \mathcal{Y}$
a morphism. Set $T' = \mathcal{X} \times_\mathcal{Y} T$. To prove
(1) we have to show that the morphism of algebraic spaces $T' \to T$
is separated. Using
Categories, Lemma \ref{categories-lemma-base-change-diagonal}
once more we see that $\Delta_{T'/T}$ is the base change of
$\Delta_f$. Hence our assumption (2) implies that $\Delta_{T'/T}$
is a closed immersion, hence $T' \to T$ is separated as desired.
\end{proof}

\begin{lemma}
\label{lemma-representable-quasi-separated-diagonal-quasi-compact}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks
representable by algebraic spaces. Then the following are equivalent
\begin{enumerate}
\item $f$ is quasi-separated,
\item $\Delta_f$ is quasi-compact, or
\item $\Delta_f$ is finite type.
\end{enumerate}
\end{lemma}

\begin{proof}
The statements
``$f$ is quasi-separated'',
``$\Delta_f$ is quasi-compact'', and
``$\Delta_f$ is finite type''
refer to the notions defined in
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}.
Note that (2) and (3) are equivalent in view of the fact that
$\Delta_f$ is locally of finite type by
Lemma \ref{lemma-properties-diagonal-representable}
(and
Algebraic Stacks, Lemma
\ref{algebraic-lemma-representable-transformations-property-implication}).
Choose a scheme $V$ and a surjective smooth morphism $V \to \mathcal{Y}$.
Set $U = \mathcal{X} \times_\mathcal{Y} V$ which is an algebraic
space by assumption, and the morphism $U \to \mathcal{X}$ is surjective
and smooth. By
Categories, Lemma \ref{categories-lemma-base-change-diagonal}
and
Properties of Stacks,
Lemma \ref{stacks-properties-lemma-check-property-covering}
we see that we have: $\Delta_f$ is quasi-compact if and only if
$\Delta_{U/V} : U \to  U \times_V U$ is quasi-compact.
If (1) holds, then $U \to V$ is quasi-separated and we see that
$\Delta_{U/V}$ is quasi-compact, i.e., (2) holds.
Assume (2) holds. Let $T$ be a scheme, and $a : T \to \mathcal{Y}$
a morphism. Set $T' = \mathcal{X} \times_\mathcal{Y} T$. To prove
(1) we have to show that the morphism of algebraic spaces $T' \to T$
is quasi-separated. Using
Categories, Lemma \ref{categories-lemma-base-change-diagonal}
once more we see that $\Delta_{T'/T}$ is the base change of
$\Delta_f$. Hence our assumption (2) implies that $\Delta_{T'/T}$
is quasi-compact, hence $T' \to T$ is quasi-separated as desired.
\end{proof}

\begin{lemma}
\label{lemma-representable-locally-separated-diagonal-immersion}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks
representable by algebraic spaces. Then the following are equivalent
\begin{enumerate}
\item $f$ is locally separated, and
\item $\Delta_f$ is an immersion.
\end{enumerate}
\end{lemma}

\begin{proof}
The statements ``$f$ is quasi-separated'', and ``$\Delta_f$ is an immersion''
refer to the notions defined in
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}.
Proof omitted. Hint: Argue as in the proofs of
Lemmas \ref{lemma-representable-separated-diagonal-closed} and
\ref{lemma-representable-quasi-separated-diagonal-quasi-compact}.
\end{proof}






\section{Separation axioms}
\label{section-separated}

\noindent
Let $\mathcal{X} = [U/R]$ be a presentation of an algebraic stack.
Then the properties of the diagonal of $\mathcal{X}$ over $S$, are
the properties of the morphism $j : R \to U \times_S U$. For example,
if $\mathcal{X} = [S/G]$ for some smooth group $G$ in algebraic spaces
over $S$ then $j$ is the structure morphism $G \to U$. Hence the diagonal
is not automatically separated itself (contrary to what happens in the
case of schemes and algebraic spaces). To say that $[S/G]$ is quasi-separated
over $S$ should certainly imply that $G \to S$ is quasi-compact, but we
hesitate to say that $[S/G]$ is quasi-separated over $S$ without also
requiring the morphism $G \to S$ to be quasi-separated. In other words,
requiring the diagonal morphism to be quasi-compact does not really agree
with our intuition for a ``quasi-separated algebraic stack'', and we should
also require the diagonal itself to be quasi-separated.

\medskip\noindent
What about ``separated algebraic stacks''? We have seen in
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-separated-diagonal-proper}
that an algebraic space is separated if and only if the diagonal is proper.
This is the condition that is usually used to define separated algebraic
stacks too. In the example $[S/G] \to S$ above this means that $G \to S$
is a proper group scheme. This means algebraic stacks of the form
$[\Spec(k)/E]$ are proper over $k$ where $E$ is an elliptic curve
over $k$ (insert future reference here). In certain situations it may be
more natural to assume the diagonal is finite.

\begin{definition}
\label{definition-separated}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
\begin{enumerate}
\item We say $f$ is {\it DM} if $\Delta_f$ is unramified\footnote{The
letters DM stand for Deligne-Mumford. If $f$ is DM then given any scheme
$T$ and any morphism $T \to \mathcal{Y}$ the fibre product
$\mathcal{X}_T = \mathcal{X} \times_\mathcal{Y} T$
is an algebraic stack over $T$ whose diagonal is unramified, i.e.,
$\mathcal{X}_T$ is DM. This implies $\mathcal{X}_T$
is a Deligne-Mumford stack, see Theorem \ref{theorem-DM}.
In other words a DM morphism is one whose ``fibres'' are Deligne-Mumford
stacks. This hopefully at least motivates the terminology.}.
\item We say $f$ is {\it quasi-DM} if $\Delta_f$ is
locally quasi-finite\footnote{If $f$ is quasi-DM, then the
``fibres'' $\mathcal{X}_T$ of $\mathcal{X} \to \mathcal{Y}$ are quasi-DM. An
algebraic stack $\mathcal{X}$ is quasi-DM exactly if there exists a
scheme $U$ and a surjective flat morphism $U \to \mathcal{X}$ of finite
presentation which is locally quasi-finite, see
Theorem \ref{theorem-quasi-DM}.
Note the similarity to being Deligne-Mumford, which
is defined in terms of having an \'etale covering by a scheme.}.
\item We say $f$ is {\it separated} if $\Delta_f$ is proper.
\item We say $f$ is {\it quasi-separated} if $\Delta_f$
is quasi-compact and quasi-separated.
\end{enumerate}
\end{definition}

\noindent
In this definition we are using that $\Delta_f$ is representable by algebraic
spaces and we are using
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}
to make sense out of imposing conditions on $\Delta_f$.
We note that these definitions do not conflict with the already
existing notions if $f$ is representable by algebraic spaces, see
Lemmas \ref{lemma-representable-quasi-separated-diagonal-quasi-compact} and
\ref{lemma-representable-separated-diagonal-closed}.
There is an interesting way to characterize these conditions by looking
at higher diagonals, see
Lemma \ref{lemma-definition-separated}.

\begin{definition}
\label{definition-absolute-separated}
Let $\mathcal{X}$ be an algebraic stack over the base scheme $S$.
Denote $p : \mathcal{X} \to S$ the structure morphism.
\begin{enumerate}
\item We say $\mathcal{X}$ is {\it DM over $S$}
if $p : \mathcal{X} \to S$ is DM.
\item We say $\mathcal{X}$ is {\it quasi-DM over $S$}
if $p : \mathcal{X} \to S$ is quasi-DM.
\item We say $\mathcal{X}$ is {\it separated over $S$}
if $p : \mathcal{X} \to S$ is separated.
\item We say $\mathcal{X}$ is {\it quasi-separated over $S$} if
$p : \mathcal{X} \to S$ is quasi-separated.
\item We say $\mathcal{X}$ is {\it DM}
if $\mathcal{X}$ is DM\footnote{Theorem \ref{theorem-DM} shows
that this is equivalent to $\mathcal{X}$ being a Deligne-Mumford stack.}
over $\Spec(\mathbf{Z})$.
\item We say $\mathcal{X}$ is {\it quasi-DM}
if $\mathcal{X}$ is quasi-DM over $\Spec(\mathbf{Z})$.
\item We say $\mathcal{X}$ is {\it separated} if $\mathcal{X}$
is separated over $\Spec(\mathbf{Z})$.
\item We say $\mathcal{X}$ is {\it quasi-separated} if $\mathcal{X}$
is quasi-separated over $\Spec(\mathbf{Z})$.
\end{enumerate}
In the last 4 definitions we view $\mathcal{X}$
as an algebraic stack over $\Spec(\mathbf{Z})$
via
Algebraic Stacks, Definition \ref{algebraic-definition-viewed-as}.
\end{definition}

\noindent
Thus in each case we have an absolute notion and a notion relative to
our given base scheme (mention of which is usually suppressed by our
abuse of notation introduced in
Properties of Stacks, Section \ref{stacks-properties-section-conventions}).
We will see that (1) $\Leftrightarrow$ (5) and (2) $\Leftrightarrow$ (6) in
Lemma \ref{lemma-separated-implies-morphism-separated}.
We spend some time proving some standard results on these notions.

\begin{lemma}
\label{lemma-trivial-implications}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
\begin{enumerate}
\item If $f$ is separated, then $f$ is quasi-separated.
\item If $f$ is DM, then $f$ is quasi-DM.
\item If $f$ is representable by algebraic spaces, then $f$ is DM.
\end{enumerate}
\end{lemma}

\begin{proof}
To see (1) note that a proper morphism of algebraic spaces is quasi-compact
and quasi-separated, see
Morphisms of Spaces, Definition \ref{spaces-morphisms-definition-proper}.
To see (2) note that an unramified morphism of algebraic spaces is locally
quasi-finite, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-unramified-quasi-finite}.
Finally (3) follows from Lemma \ref{lemma-properties-diagonal-representable}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-separated}
All of the separation axioms listed in
Definition \ref{definition-separated}
are stable under base change.
\end{lemma}

\begin{proof}
Let $f : \mathcal{X} \to \mathcal{Y}$ and
$\mathcal{Y}' \to \mathcal{Y}$ be morphisms of algebraic stacks.
Let $f' : \mathcal{Y}' \times_\mathcal{Y} \mathcal{X} \to \mathcal{Y}'$
be the base change of $f$ by $\mathcal{Y}' \to \mathcal{Y}$.
Then $\Delta_{f'}$ is the base change of $\Delta_f$ by the morphism
$\mathcal{X}' \times_{\mathcal{Y}'} \mathcal{X}' \to
\mathcal{X} \times_\mathcal{Y} \mathcal{X}$, see
Categories, Lemma \ref{categories-lemma-base-change-diagonal}.
By the results of
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}
each of the properties of the diagonal used in
Definition \ref{definition-separated}
is stable under base change. Hence the lemma is true.
\end{proof}

\begin{lemma}
\label{lemma-check-separated-covering}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Let $W \to \mathcal{Y}$ be a surjective, flat, and locally of finite
presentation where $W$ is an algebraic space. If the base change
$W \times_\mathcal{Y} \mathcal{X} \to W$ has one of the separation properties
of Definition \ref{definition-separated}
then so does $f$.
\end{lemma}

\begin{proof}
Denote $g : W \times_\mathcal{Y} \mathcal{X} \to W$ the base change.
Then $\Delta_g$ is the base change of $\Delta_f$ by the morphism
$q : W \times_\mathcal{Y} (\mathcal{X} \times_\mathcal{Y} \mathcal{X})
\to \mathcal{X} \times_\mathcal{Y} \mathcal{X}$. Since $q$ is the base
change of $W \to \mathcal{Y}$ we see that $q$ is representable by algebraic
spaces, surjective, flat, and locally of finite presentation. Hence the
result follows from
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-check-property-weak-covering}.
\end{proof}

\begin{lemma}
\label{lemma-change-of-base-separated}
Let $S$ be a scheme. The property of being
quasi-DM over $S$, quasi-separated over $S$, or separated over $S$ (see
Definition \ref{definition-absolute-separated})
is stable under change of base scheme, see
Algebraic Stacks, Definition \ref{algebraic-definition-change-of-base}.
\end{lemma}

\begin{proof}
Follows immediately from
Lemma \ref{lemma-base-change-separated}.
\end{proof}

\begin{lemma}
\label{lemma-fibre-product-after-map}
Let $f : \mathcal{X} \to \mathcal{Z}$, $g : \mathcal{Y} \to \mathcal{Z}$
and $\mathcal{Z} \to \mathcal{T}$ be morphisms of algebraic stacks.
Consider the induced morphism
$i : \mathcal{X} \times_\mathcal{Z} \mathcal{Y} \to
\mathcal{X} \times_\mathcal{T} \mathcal{Y}$.
Then
\begin{enumerate}
\item $i$ is representable by algebraic spaces and locally of finite type,
\item if $\Delta_{\mathcal{Z}/\mathcal{T}}$ is quasi-separated, then
$i$ is quasi-separated,
\item if $\Delta_{\mathcal{Z}/\mathcal{T}}$ is separated, then
$i$ is separated,
\item if $\mathcal{Z} \to \mathcal{T}$ is DM,
then $i$ is unramified,
\item if $\mathcal{Z} \to \mathcal{T}$ is quasi-DM,
then $i$ is locally quasi-finite,
\item if $\mathcal{Z} \to \mathcal{T}$ is separated, then $i$ is proper, and
\item if $\mathcal{Z} \to \mathcal{T}$ is quasi-separated, then
$i$ is quasi-compact and quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
The following diagram
$$
\xymatrix{
\mathcal{X} \times_\mathcal{Z} \mathcal{Y} \ar[r]_i \ar[d] &
\mathcal{X} \times_\mathcal{T} \mathcal{Y} \ar[d] \\
\mathcal{Z} \ar[r]^-{\Delta_{\mathcal{Z}/\mathcal{T}}} \ar[r] &
\mathcal{Z} \times_\mathcal{T} \mathcal{Z}
}
$$
is a $2$-fibre product diagram, see
Categories, Lemma \ref{categories-lemma-fibre-product-after-map}.
Hence $i$ is the base change of the
diagonal morphism $\Delta_{\mathcal{Z}/\mathcal{T}}$. Thus the lemma follows
from
Lemma \ref{lemma-properties-diagonal},
and the material in
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}.
\end{proof}

\begin{lemma}
\label{lemma-semi-diagonal}
Let $\mathcal{T}$ be an algebraic stack. Let $g : \mathcal{X} \to \mathcal{Y}$
be a morphism of algebraic stacks over $\mathcal{T}$. Consider the graph
$i : \mathcal{X} \to \mathcal{X} \times_\mathcal{T} \mathcal{Y}$ of $g$. Then
\begin{enumerate}
\item $i$ is representable by algebraic spaces and locally of finite type,
\item if $\mathcal{Y} \to \mathcal{T}$ is DM, then $i$ is unramified,
\item if $\mathcal{Y} \to \mathcal{T}$ is quasi-DM, then $i$ is locally
quasi-finite,
\item if $\mathcal{Y} \to \mathcal{T}$ is separated, then $i$ is proper, and
\item if $\mathcal{Y} \to \mathcal{T}$ is quasi-separated, then $i$ is
quasi-compact and quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-fibre-product-after-map}
applied to the morphism
$\mathcal{X} = \mathcal{X} \times_\mathcal{Y} \mathcal{Y} \to
\mathcal{X} \times_\mathcal{T} \mathcal{Y}$.
\end{proof}

\begin{lemma}
\label{lemma-section-immersion}
Let $f : \mathcal{X} \to \mathcal{T}$ be a morphism of algebraic stacks.
Let $s : \mathcal{T} \to \mathcal{X}$ be a morphism such that
$f \circ s$ is $2$-isomorphic to $\text{id}_\mathcal{T}$. Then
\begin{enumerate}
\item $s$ is representable by algebraic spaces and locally of finite type,
\item if $f$ is DM, then $s$ is unramified,
\item if $f$ is quasi-DM, then $s$ is locally quasi-finite,
\item if $f$ is separated, then $s$ is proper, and
\item if $f$ is quasi-separated, then $s$ is quasi-compact and quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-semi-diagonal} applied to
$g = s$ and $\mathcal{Y} = \mathcal{T}$ in which case
$i : \mathcal{T} \to \mathcal{T} \times_\mathcal{T} \mathcal{X}$
is $2$-isomorphic to $s$.
\end{proof}

\begin{lemma}
\label{lemma-composition-separated}
All of the separation axioms listed in
Definition \ref{definition-separated}
are stable under composition of morphisms.
\end{lemma}

\begin{proof}
Let $f : \mathcal{X} \to \mathcal{Y}$ and
$g : \mathcal{Y} \to \mathcal{Z}$ be morphisms of algebraic stacks
to which the axiom in question applies.
The diagonal $\Delta_{\mathcal{X}/\mathcal{Z}}$ is the composition
$$
\mathcal{X} \longrightarrow
\mathcal{X} \times_\mathcal{Y} \mathcal{X} \longrightarrow
\mathcal{X} \times_\mathcal{Z} \mathcal{X}.
$$
Our separation axiom is defined by requiring the diagonal
to have some property $\mathcal{P}$. By
Lemma \ref{lemma-fibre-product-after-map}
above we see that the second arrow also has this property.
Hence the lemma follows since the composition of
morphisms which are representable by algebraic spaces with property
$\mathcal{P}$ also is a morphism with property $\mathcal{P}$, see
our general discussion in
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}
and
Morphisms of Spaces, Lemmas
\ref{spaces-morphisms-lemma-composition-unramified},
\ref{spaces-morphisms-lemma-composition-quasi-finite},
\ref{spaces-morphisms-lemma-composition-proper},
\ref{spaces-morphisms-lemma-composition-quasi-compact}, and
\ref{spaces-morphisms-lemma-composition-separated}.
\end{proof}

\begin{lemma}
\label{lemma-separated-over-separated}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks
over the base scheme $S$.
\begin{enumerate}
\item If $\mathcal{Y}$ is DM over $S$ and $f$ is DM,
then $\mathcal{X}$ is DM over $S$.
\item If $\mathcal{Y}$ is quasi-DM over $S$ and $f$ is quasi-DM,
then $\mathcal{X}$ is quasi-DM over $S$.
\item If $\mathcal{Y}$ is separated over $S$ and $f$ is separated,
then $\mathcal{X}$ is separated over $S$.
\item If $\mathcal{Y}$ is quasi-separated over $S$ and $f$ is quasi-separated,
then $\mathcal{X}$ is quasi-separated over $S$.
\item If $\mathcal{Y}$ is DM and $f$ is DM,
then $\mathcal{X}$ is DM.
\item If $\mathcal{Y}$ is quasi-DM and $f$ is quasi-DM,
then $\mathcal{X}$ is quasi-DM.
\item If $\mathcal{Y}$ is separated and $f$ is separated,
then $\mathcal{X}$ is separated.
\item If $\mathcal{Y}$ is quasi-separated and $f$ is quasi-separated,
then $\mathcal{X}$ is quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (1), (2), (3), and (4) follow immediately from
Lemma \ref{lemma-composition-separated}
and
Definition \ref{definition-absolute-separated}.
For (5), (6), (7), and (8) think of $\mathcal{X}$ and $\mathcal{Y}$ as
algebraic stacks over $\Spec(\mathbf{Z})$ and apply
Lemma \ref{lemma-composition-separated}.
Details omitted.
\end{proof}

\noindent
The following lemma is a bit different to the analogue for algebraic
spaces. To compare take a look at
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-compose-after-separated}.

\begin{lemma}
\label{lemma-compose-after-separated}
Let $f : \mathcal{X} \to \mathcal{Y}$ and
$g : \mathcal{Y} \to \mathcal{Z}$ be morphisms of algebraic stacks.
\begin{enumerate}
\item If $g \circ f$ is DM then so is $f$.
\item If $g \circ f$ is quasi-DM then so is $f$.
\item If $g \circ f$ is separated and $\Delta_g$ is separated, then
$f$ is separated.
\item If $g \circ f$ is quasi-separated and
$\Delta_g$ is quasi-separated, then $f$ is quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
Consider the factorization
$$
\mathcal{X} \to
\mathcal{X} \times_\mathcal{Y} \mathcal{X} \to
\mathcal{X} \times_\mathcal{Z} \mathcal{X}
$$
of the diagonal morphism of $g \circ f$. Both morphisms are representable by
algebraic spaces, see
Lemmas \ref{lemma-properties-diagonal} and
\ref{lemma-fibre-product-after-map}.
Hence for any scheme $T$ and morphism
$T \to \mathcal{X} \times_\mathcal{Y} \mathcal{X}$
we get morphisms of algebraic spaces
$$
A = \mathcal{X} \times_{(\mathcal{X} \times_\mathcal{Z} \mathcal{X})} T
\longrightarrow
B = (\mathcal{X} \times_\mathcal{Y} \mathcal{X})
\times_{(\mathcal{X} \times_\mathcal{Z} \mathcal{X})} T
\longrightarrow
T.
$$
If $g \circ f$ is DM (resp.\ quasi-DM), then the composition $A \to T$
is unramified (resp.\ locally quasi-finite). Hence (1) (resp.\ (2))
follows on applying
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-permanence-unramified}
(resp.
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-permanence-quasi-finite}).
This proves (1) and (2).

\medskip\noindent
Proof of (3). Assume $g \circ f$ is quasi-separated and $\Delta_g$ is
quasi-separated. Consider the factorization
$$
\mathcal{X} \to
\mathcal{X} \times_\mathcal{Y} \mathcal{X} \to
\mathcal{X} \times_\mathcal{Z} \mathcal{X}
$$
of the diagonal morphism of $g \circ f$. Both morphisms are
representable by algebraic spaces and the second one is quasi-separated, see
Lemmas \ref{lemma-properties-diagonal} and
\ref{lemma-fibre-product-after-map}.
Hence for any scheme $T$ and morphism
$T \to \mathcal{X} \times_\mathcal{Y} \mathcal{X}$
we get morphisms of algebraic spaces
$$
A = \mathcal{X} \times_{(\mathcal{X} \times_\mathcal{Z} \mathcal{X})} T
\longrightarrow
B = (\mathcal{X} \times_\mathcal{Y} \mathcal{X})
\times_{(\mathcal{X} \times_\mathcal{Z} \mathcal{X})} T
\longrightarrow
T
$$
such that $B \to T$ is quasi-separated.
The composition $A \to T$ is quasi-compact and quasi-separated
as we have assumed that $g \circ f$ is quasi-separated.
Hence $A \to B$ is quasi-separated by
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-compose-after-separated}.
And $A \to B$ is quasi-compact by
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-quasi-compact-permanence}.
Thus $f$ is quasi-separated.

\medskip\noindent
Proof of (4). Assume $g \circ f$ is separated and $\Delta_g$ is
separated. Consider the factorization
$$
\mathcal{X} \to
\mathcal{X} \times_\mathcal{Y} \mathcal{X} \to
\mathcal{X} \times_\mathcal{Z} \mathcal{X}
$$
of the diagonal morphism of $g \circ f$. Both morphisms are
representable by algebraic spaces and the second one is separated, see
Lemmas \ref{lemma-properties-diagonal} and
\ref{lemma-fibre-product-after-map}.
Hence for any scheme $T$ and morphism
$T \to \mathcal{X} \times_\mathcal{Y} \mathcal{X}$
we get morphisms of algebraic spaces
$$
A = \mathcal{X} \times_{(\mathcal{X} \times_\mathcal{Z} \mathcal{X})} T
\longrightarrow
B = (\mathcal{X} \times_\mathcal{Y} \mathcal{X})
\times_{(\mathcal{X} \times_\mathcal{Z} \mathcal{X})} T
\longrightarrow
T
$$
such that $B \to T$ is separated.
The composition $A \to T$ is proper as we have assumed that
$g \circ f$ is quasi-separated. Hence $A \to B$ is proper by
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-universally-closed-permanence}
which means that $f$ is separated.
\end{proof}

\begin{lemma}
\label{lemma-separated-implies-morphism-separated}
Let $\mathcal{X}$ be an algebraic stack over the base scheme $S$.
\begin{enumerate}
\item
$\mathcal{X}$ is DM $\Leftrightarrow$
$\mathcal{X}$ is DM over $S$.
\item
$\mathcal{X}$ is quasi-DM $\Leftrightarrow$
$\mathcal{X}$ is quasi-DM over $S$.
\item If $\mathcal{X}$ is separated, then
$\mathcal{X}$ is separated over $S$.
\item If $\mathcal{X}$ is quasi-separated, then
$\mathcal{X}$ is quasi-separated over $S$.
\end{enumerate}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks
over the base scheme $S$.
\begin{enumerate}
\item[(5)] If $\mathcal{X}$ is DM over $S$, then $f$ is DM.
\item[(6)] If $\mathcal{X}$ is quasi-DM over $S$, then $f$ is quasi-DM.
\item[(7)] If $\mathcal{X}$ is separated over $S$ and
$\Delta_{\mathcal{Y}/S}$ is separated, then $f$ is separated.
\item[(8)] If $\mathcal{X}$ is quasi-separated over $S$ and
$\Delta_{\mathcal{Y}/S}$ is quasi-separated, then $f$ is quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (5), (6), (7), and (8) follow immediately from
Lemma \ref{lemma-compose-after-separated}
and
Spaces, Definition \ref{spaces-definition-separated}.
To prove (3) and (4) think of $X$ and $Y$ as algebraic stacks over
$\Spec(\mathbf{Z})$ and apply
Lemma \ref{lemma-compose-after-separated}.
Similarly, to prove (1) and (2), think of $\mathcal{X}$ as an algebraic
stack over $\Spec(\mathbf{Z})$ consider the
morphisms
$$
\mathcal{X} \longrightarrow
\mathcal{X} \times_S \mathcal{X} \longrightarrow
\mathcal{X} \times_{\Spec(\mathbf{Z})} \mathcal{X}
$$
Both arrows are representable by algebraic spaces.
The second arrow is unramified and locally quasi-finite as the base change of
the immersion $\Delta_{S/\mathbf{Z}}$. Hence the composition is
unramified (resp.\ locally quasi-finite) if and only if the first arrow
is unramified (resp.\ locally quasi-finite), see
Morphisms of Spaces,
Lemmas \ref{spaces-morphisms-lemma-composition-unramified} and
\ref{spaces-morphisms-lemma-permanence-unramified}
(resp.\ Morphisms of Spaces,
Lemmas \ref{spaces-morphisms-lemma-composition-quasi-finite} and
\ref{spaces-morphisms-lemma-permanence-quasi-finite}).
\end{proof}

\begin{lemma}
\label{lemma-properties-covering-imply-diagonal}
Let $\mathcal{X}$ be an algebraic stack.
Let $W$ be an algebraic space, and let $f : W \to \mathcal{X}$
be a surjective, flat, locally finitely presented morphism.
\begin{enumerate}
\item If $f$ is unramified (i.e., \'etale, i.e., $\mathcal{X}$
is Deligne-Mumford), then $\mathcal{X}$ is DM.
\item If $f$ is locally quasi-finite, then $\mathcal{X}$ is quasi-DM.
\end{enumerate}
\end{lemma}

\begin{proof}
Note that if $f$ is unramified, then it is \'etale by
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-unramified-flat-lfp-etale}.
This explains the parenthetical remark in (1).
Assume $f$ is unramified (resp.\ locally quasi-finite). We have to show that
$\Delta_\mathcal{X} : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$
is unramified (resp.\ locally quasi-finite). Note that
$W \times W \to \mathcal{X} \times \mathcal{X}$ is also
surjective, flat, and locally of finite presentation. Hence it suffices to
show that
$$
W \times_{\mathcal{X} \times \mathcal{X}, \Delta_\mathcal{X}} \mathcal{X}
=
W \times_\mathcal{X} W
\longrightarrow
W \times W
$$
is unramified (resp.\ locally quasi-finite), see
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-check-property-covering}.
By assumption the morphism $\text{pr}_i : W \times_\mathcal{X} W \to W$
is unramified (resp.\ locally quasi-finite). Hence
the displayed arrow is unramified (resp.\ locally quasi-finite) by
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-permanence-unramified}
(resp.\ Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-permanence-quasi-finite}).
\end{proof}

\begin{lemma}
\label{lemma-monomorphism-separated}
A monomorphism of algebraic stacks is separated and DM.
The same is true for immersions of algebraic stacks.
\end{lemma}

\begin{proof}
If $f : \mathcal{X} \to \mathcal{Y}$ is a monomorphism of algebraic stacks,
then $\Delta_f$ is an isomorphism, see
Properties of Stacks, Lemma \ref{stacks-properties-lemma-monomorphism}.
Since an isomorphism of algebraic spaces is proper and unramified we
see that $f$ is separated and DM. The second assertion follows from the
first as an immersion is a monomorphism, see
Properties of Stacks,
Lemma \ref{stacks-properties-lemma-immersion-monomorphism}.
\end{proof}

\begin{lemma}
\label{lemma-separation-properties-residual-gerbe}
Let $\mathcal{X}$ be an algebraic stack. Let $x \in |\mathcal{X}|$.
Assume the residual gerbe $\mathcal{Z}_x$ of $\mathcal{X}$ at $x$ exists.
If $\mathcal{X}$ is DM, resp.\ quasi-DM, resp.\ separated,
resp.\ quasi-separated, then so is $\mathcal{Z}_x$.
\end{lemma}

\begin{proof}
This is true because $\mathcal{Z}_x \to \mathcal{X}$ is a monomorphism
hence DM and separated by
Lemma \ref{lemma-monomorphism-separated}.
Apply
Lemma \ref{lemma-separated-over-separated}
to conclude.
\end{proof}


















\section{Inertia stacks}
\label{section-inertia}

\noindent
The (relative) inertia stack of a stack in groupoids is defined in
Stacks, Section \ref{stacks-section-the-inertia-stack}.
The actual construction, in the setting of fibred categories, and some
of its properties is in
Categories, Section \ref{categories-section-inertia}.

\begin{lemma}
\label{lemma-inertia}
Let $\mathcal{X}$ be an algebraic stack. Then the inertia stack
$\mathcal{I}_\mathcal{X}$ is an algebraic stack as well.
The morphism
$$
\mathcal{I}_\mathcal{X} \longrightarrow \mathcal{X}
$$
is representable by algebraic spaces and locally of finite type.
More generally, let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism
of algebraic stacks. Then the morphism
$$
\mathcal{I}_{\mathcal{X}/\mathcal{Y}} \longrightarrow \mathcal{X}
$$
is representable by algebraic spaces and locally of finite type.
\end{lemma}

\begin{proof}
By
Categories, Lemma \ref{categories-lemma-inertia-fibred-category}
there are equivalences
$$
\mathcal{I}_\mathcal{X} \to
\mathcal{X} \times_{\Delta, \mathcal{X} \times_S \mathcal{X}, \Delta}
\mathcal{X}
\quad\text{and}\quad
\mathcal{I}_{\mathcal{X}/\mathcal{Y}} \to
\mathcal{X}
\times_{\Delta, \mathcal{X} \times_\mathcal{Y} \mathcal{X}, \Delta}
\mathcal{X}
$$
which shows that the inertia stacks are algebraic stacks.
Let $T \to \mathcal{X}$ be a morphism given by
the object $x$ of the fibre category of $\mathcal{X}$ over $T$.
Then we get a $2$-fibre product square
$$
\xymatrix{
\mathit{Isom}_\mathcal{X}(x, x) \ar[d] \ar[r] &
\mathcal{I}_\mathcal{X} \ar[d] \\
T \ar[r]^x & \mathcal{X}
}
$$
This follows immediately from the definition of $\mathcal{I}_\mathcal{X}$.
Since $\mathit{Isom}_\mathcal{X}(x, x)$ is always an algebraic space
locally of finite type over $T$ (see
Lemma \ref{lemma-isom-locally-finite-type})
we conclude that $\mathcal{I}_\mathcal{X} \to \mathcal{X}$ is representable
by algebraic spaces and locally of finite type. Finally, for
the relative inertia we get
$$
\vcenter{
\xymatrix{
\mathit{Isom}_\mathcal{X}(x, x) \ar[d] &
K \ar[l] \ar[d] \ar[r] &
\mathcal{I}_{\mathcal{X}/\mathcal{Y}} \ar[d] \\
\mathit{Isom}_\mathcal{Y}(f(x), f(x)) &
T \ar[l]_-e \ar[r]^x & \mathcal{X}
}
}
$$
with both squares $2$-fibre products. This follows from
Categories, Lemma \ref{categories-lemma-relative-inertia-as-fibre-product}.
The left vertical arrow is a morphism of algebraic spaces locally of finite
type over $T$, and hence is locally of finite type, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-permanence-finite-type}.
Thus $K$ is an algebraic space and $K \to T$ is locally of finite type.
This proves the assertion on the relative inertia.
\end{proof}

\begin{remark}
\label{remark-inertia-is-group-in-spaces}
Let $\mathcal{X}$ be an algebraic stack. In
Properties of Stacks, Remark \ref{stacks-properties-remark-representable-over}
we have seen that the $2$-category of morphisms
$\mathcal{X}' \to \mathcal{X}$ representable by algebraic spaces
with target $\mathcal{X}$ forms a category.
In this category the inertia stack of $\mathcal{X}$ is
a {\it group object}. Recall that an object of $\mathcal{I}_\mathcal{X}$
is just a pair $(x, \alpha)$ where $x$ is an object of $\mathcal{X}$
and $\alpha$ is an automorphism of $x$ in the fibre category of $\mathcal{X}$
that $x$ lives in. The composition
$$
c :
\mathcal{I}_\mathcal{X} \times_\mathcal{X} \mathcal{I}_\mathcal{X}
\longrightarrow
\mathcal{I}_\mathcal{X}
$$
is given by the rule on objects
$$
((x, \alpha), (x', \alpha'), \beta) \mapsto
(x, \alpha \circ \beta^{-1} \circ \alpha' \circ \beta)
$$
which makes sense as $\beta : x \to x'$ is an isomorphism in the fibre
category by our definition of fibre products. The neutral element
$e : \mathcal{X} \to \mathcal{I}_\mathcal{X}$ is given by the
functor $x \mapsto (x, \text{id}_x)$. We omit the proof that the
axioms of a group object hold.
There is a variant of this remark for relative inertia stacks.
\end{remark}

\noindent
Let $\mathcal{X}$ be an algebraic stack and let $\mathcal{I}_\mathcal{X}$
be its inertia stack. We have seen in the proof of
Lemma \ref{lemma-inertia}
that for any scheme $T$ and object $x$ of $\mathcal{X}$ over $T$ there is
a canonical cartesian square
$$
\xymatrix{
\mathit{Isom}_\mathcal{X}(x, x) \ar[d] \ar[r] &
\mathcal{I}_\mathcal{X} \ar[d] \\
T \ar[r]^x & \mathcal{X}
}
$$
The group structure on $\mathcal{I}_\mathcal{X}$ discussed in
Remark \ref{remark-inertia-is-group-in-spaces}
induces the group structure on $\mathit{Isom}_\mathcal{X}(x, x)$ of
Lemma \ref{lemma-isom-pseudo-torsor-aut}.
This allows us to define the sheaf $\mathit{Isom}_\mathcal{X}$
also for morphisms from algebraic spaces to $\mathcal{X}$. We formalize
this in the following definition.

\begin{definition}
\label{definition-isom}
Let $\mathcal{X}$ be an algebraic stack and let $X$ be an algebraic space.
Let $x : X \to \mathcal{X}$ be a morphism. We set
$$
\mathit{Isom}_\mathcal{X}(x, x) =
X \times_{x, \mathcal{X}} \mathcal{I}_\mathcal{X}
$$
We endow it with the structure of a group algebraic space over $X$
by pulling back the composition law discussed in
Remark \ref{remark-inertia-is-group-in-spaces}.
We will sometimes refer to $\mathit{Isom}_\mathcal{X}(x, x)$ as the
{\it sheaf of automorphisms of $x$}.
\end{definition}

\noindent
As a variant we may occasionally use the notation
$\mathit{Isom}_\mathcal{X}(x, y)$ when given two morphisms
$x, y : X \to \mathcal{X}$. This will mean simply the algebraic
space
$$
(X \times_{x, \mathcal{X}, y} X) \times_{X \times X, \Delta_X} X.
$$
Then it is true, as in
Lemma \ref{lemma-isom-pseudo-torsor-aut},
that $\mathit{Isom}_\mathcal{X}(x, y)$ is a pseudo torsor for
$\mathit{Isom}_\mathcal{X}(x, x)$ over $X$. We omit the verification.

\begin{lemma}
\label{lemma-cartesian-square-inertia}
Let $\pi : \mathcal{X} \to X$ be a morphism from an algebraic stack to
an algebraic space. Let $f : X' \to X$ be a morphism of algebraic spaces.
Set $\mathcal{X}' = X' \times_X \mathcal{X}$. Then both squares in
the diagram
$$
\xymatrix{
\mathcal{I}_{\mathcal{X}'} \ar[r]
\ar[d]_{
\text{Categories, Equation}\ (\ref{categories-equation-inertia-structure-map})
} &
\mathcal{X}' \ar[r] \ar[d] & X' \ar[d] \\
\mathcal{I}_\mathcal{X} \ar[r] &
\mathcal{X} \ar[r] & X
}
$$
are fibre product squares.
\end{lemma}

\begin{proof}
The inertia stack $\mathcal{I}_{\mathcal{X}'}$ is the defined as the
category of pairs $(x', \alpha')$ where $x'$ is an object of $\mathcal{X}'$
and $\alpha'$ is an automorphism of $x'$ in its fibre category over
$(\Sch/S)_{fppf}$, see
Categories, Section \ref{categories-section-inertia}.
Suppose that $x'$ lies over the scheme $U$ and maps to the object
$x$ of $\mathcal{X}$. By the construction of the $2$-fibre product in
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C}
we see that $x' = (U, a', x, 1)$ where $a' : U \to X'$ is a morphism
and $1$ indicates that $f \circ a' = \pi \circ x$ as morphisms $U \to X$.
Moreover we have
$\mathit{Isom}_{\mathcal{X}'}(x', x') = \mathit{Isom}_\mathcal{X}(x, x)$
as sheaves on $U$ (by the very construction of the $2$-fibre product).
This implies that the left square is a fibre product square (details omitted).
\end{proof}

\begin{lemma}
\label{lemma-monomorphism-cartesian-square-inertia}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a monomorphism of algebraic stacks.
Then the diagram
$$
\xymatrix{
\mathcal{I}_\mathcal{X} \ar[r] \ar[d] &
\mathcal{X} \ar[d] & \\
\mathcal{I}_\mathcal{Y} \ar[r] &
\mathcal{Y}
}
$$
is a fibre product square.
\end{lemma}

\begin{proof}
This follows immediately from the fact that $f$ is fully faithful (see
Properties of Stacks, Lemma \ref{stacks-properties-lemma-monomorphism})
and the definition of the inertia in
Categories, Section \ref{categories-section-inertia}.
Namely, an object of $\mathcal{I}_\mathcal{X}$ over a scheme $T$ is
the same thing as a pair $(x, \alpha)$ consisting of an object
$x$ of $\mathcal{X}$ over $T$ and a morphism $\alpha : x \to x$ in
the fibre category of $\mathcal{X}$ over $T$. As $f$ is fully faithful
we see that $\alpha$ is the same thing as a morphism
$\beta : f(x) \to f(x)$ in the fibre category of $\mathcal{Y}$ over $T$.
Hence we can think of objects of $\mathcal{I}_\mathcal{X}$ over $T$
as triples $((y, \beta), x, \gamma)$ where $y$ is an object of
$\mathcal{Y}$ over $T$, $\beta : y \to y$ in $\mathcal{Y}_T$ and
$\gamma : y \to f(x)$ is an isomorhism over $T$, i.e., an object
of $\mathcal{I}_\mathcal{Y} \times_\mathcal{Y} \mathcal{X}$ over $T$.
\end{proof}

\begin{lemma}
\label{lemma-presentation-inertia}
Let $\mathcal{X}$ be an algebraic stack. Let $[U/R] \to \mathcal{X}$
be a presentation. Let $G/U$ be the stabilizer group algebraic space
associated to the groupoid $(U, R, s, t, c)$. Then
$$
\xymatrix{
G \ar[d] \ar[r] & U \ar[d] \\
\mathcal{I}_\mathcal{X} \ar[r] & \mathcal{X}
}
$$
is a fibre product diagram.
\end{lemma}

\begin{proof}
Immediate from
Groupoids in Spaces, Lemma \ref{spaces-groupoids-lemma-2-cartesian-inertia}.
\end{proof}









\section{Higher diagonals}
\label{section-higher-diagonals}

\noindent
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
In this situation it makes sense to consider not only the diagonal
$$
\Delta_f : \mathcal{X} \to \mathcal{X} \times_\mathcal{Y} \mathcal{X}
$$
but also the diagonal of the diagonal, i.e., the morphism
$$
\Delta_{\Delta_f} :
\mathcal{X}
\longrightarrow
\mathcal{X} \times_{(\mathcal{X} \times_\mathcal{Y} \mathcal{X})} \mathcal{X}
$$
Because of this we sometimes use the following terminology. We denote
$\Delta_{f, 0} = f$ the {\it zeroth diagonal},
we denote $\Delta_{f, 1} = \Delta_f$ the {\it first diagonal}, and
we denote $\Delta_{f, 2} = \Delta_{\Delta_f}$ the {\it second diagonal}.
Note that $\Delta_{f, 1}$ is representable by algebraic spaces and locally of
finite type, see
Lemma \ref{lemma-properties-diagonal}.
Hence $\Delta_{f, 2}$ is representable, a monomorphism, locally of finite type,
separated, and locally quasi-finite, see
Lemma \ref{lemma-properties-diagonal-representable}.

\medskip\noindent
We can describe the second diagonal using the relative inertia stack.
Namely, the fibre product
$\mathcal{X}
\times_{(\mathcal{X} \times_\mathcal{Y} \mathcal{X})} \mathcal{X}$
is equivalent to the relative inertia stack
$\mathcal{I}_{\mathcal{X}/\mathcal{Y}}$ by
Categories, Lemma \ref{categories-lemma-inertia-fibred-category}.
Moreover, via this identification the second diagonal becomes the
{\it neutral section}
$$
e : \mathcal{X} \to \mathcal{I}_{\mathcal{X}/\mathcal{Y}}
$$
of the relative inertia stack. Moreover, recall from the proof of
Lemma \ref{lemma-inertia}
that given a morphism $x : T \to \mathcal{X}$ the fibre product
$T \times_{x, \mathcal{X}} \mathcal{I}_{\mathcal{X}/\mathcal{Y}}$
is given as the {\it kernel} $K$ of the homomorphism of group algebraic spaces
$$
\mathit{Isom}_\mathcal{X}(x, x)
\longrightarrow
\mathit{Isom}_\mathcal{Y}(f(x), f(x))
$$
over $T$. The morphism $e$ corresponds to the neutral section
$e : T \to K$ in this situation.

\begin{lemma}
\label{lemma-second-diagonal}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Then $f$ is representable by algebraic spaces if and only if
the second diagonal is an isomorphism.
\end{lemma}

\begin{proof}
Namely, $f$ is representable by algebraic spaces if and only if $f$ is
faithful, see
Algebraic Stacks,
Lemma \ref{algebraic-lemma-characterize-representable-by-algebraic-spaces}.
On the other hand, $f$ is faithful if and only if for every object $x$
of $\mathcal{X}$ over a scheme $T$ the functor $f$ induces an injection
$\mathit{Isom}_\mathcal{X}(x, x) \to
\mathit{Isom}_\mathcal{Y}(f(x), f(x))$,
which happens if and only if the kernel $K$ is trivial, which happens if and
only if $e : T \to K$ is an isomorphism for every $x : T \to \mathcal{X}$.
Since $K = T \times_{x, \mathcal{X}} \mathcal{I}_{\mathcal{X}/\mathcal{Y}}$
as discussed above, this proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-first-diagonal-separated-second-diagonal-closed}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Then
\begin{enumerate}
\item $\Delta_{f, 1}$ separated $\Leftrightarrow$
$\Delta_{f, 2}$ closed immersion $\Leftrightarrow$
$\Delta_{f, 2}$ proper $\Leftrightarrow$
$\Delta_{f, 2}$ universally closed,
\item $\Delta_{f, 1}$ quasi-separated $\Leftrightarrow$
$\Delta_{f, 2}$ finite type $\Leftrightarrow$ $\Delta_{f, 2}$ quasi-compact,
and
\item $\Delta_{f, 1}$ locally separated $\Leftrightarrow$
$\Delta_{f, 2}$ immersion.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows from
Lemmas \ref{lemma-representable-separated-diagonal-closed},
\ref{lemma-representable-quasi-separated-diagonal-quasi-compact}, and
\ref{lemma-representable-locally-separated-diagonal-immersion}
applied to $\Delta_{f, 1}$.
\end{proof}

\noindent
The following lemma is kind of cute and it may suggest a generalization
of these conditions to higher algebraic stacks.

\begin{lemma}
\label{lemma-definition-separated}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Then
\begin{enumerate}
\item $f$ is separated if and only if $\Delta_{f, 1}$ and $\Delta_{f, 2}$
are universally closed, and
\item $f$ is quasi-separated if and only if $\Delta_{f, 1}$ and $\Delta_{f, 2}$
are quasi-compact.
\item $f$ is quasi-DM if and only if $\Delta_{f, 1}$ and $\Delta_{f, 2}$
are locally quasi-finite.
\item $f$ is DM if and only if $\Delta_{f, 1}$ and $\Delta_{f, 2}$
are unramified.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Assume that $\Delta_{f, 2}$ and $\Delta_{f, 1}$ are
universally closed. Then $\Delta_{f, 1}$ is separated and universally
closed by
Lemma \ref{lemma-first-diagonal-separated-second-diagonal-closed}.
By
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-universally-closed-quasi-compact}
and
Algebraic Stacks,
Lemma \ref{algebraic-lemma-representable-transformations-property-implication}
we see that $\Delta_{f, 1}$ is quasi-compact.
Hence it is quasi-compact, separated, universally closed and locally of
finite type (by
Lemma \ref{lemma-properties-diagonal})
so proper. This proves ``$\Leftarrow$'' of (1).
The proof of the implication in the other direction is omitted.

\medskip\noindent
Proof of (2). This follows immediately from
Lemma \ref{lemma-first-diagonal-separated-second-diagonal-closed}.

\medskip\noindent
Proof of (3). This follows from the fact that $\Delta_{f, 2}$ is always locally
quasi-finite by
Lemma \ref{lemma-properties-diagonal-representable}
applied to $\Delta_f = \Delta_{f, 1}$.

\medskip\noindent
Proof of (4). This follows from the fact that $\Delta_{f, 2}$ is always
unramified as
Lemma \ref{lemma-properties-diagonal-representable}
applied to $\Delta_f = \Delta_{f, 1}$ shows that
$\Delta_{f, 2}$ is locally of finite type and a monomorphism.
See
More on Morphisms of Spaces,
Lemma \ref{spaces-more-morphisms-lemma-universally-injective-unramified}.
\end{proof}










\section{Quasi-compact morphisms}
\label{section-quasi-compact}

\noindent
Let $f$ be a morphism of algebraic stacks which is representable by
algebraic spaces. In
Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}
we have defined what it means for $f$ to be quasi-compact.
Here is another characterization.

\begin{lemma}
\label{lemma-characterize-representable-quasi-compact}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks
which is representable by algebraic spaces. The following are equivalent:
\begin{enumerate}
\item $f$ is quasi-compact, and
\item for every quasi-compact algebraic stack $\mathcal{Z}$
and any morphism $\mathcal{Z} \to \mathcal{Y}$ the algebraic stack
$\mathcal{Z} \times_\mathcal{Y} \mathcal{X}$ is quasi-compact.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1), and let $\mathcal{Z} \to \mathcal{Y}$
be a morphism of algebraic stacks with $\mathcal{Z}$ quasi-compact. By
Properties of Stacks,
Lemma \ref{stacks-properties-lemma-quasi-compact-stack}
there exists a quasi-compact scheme $U$ and a surjective smooth
morphism $U \to \mathcal{Z}$. Since $f$ is representable by algebraic
spaces and quasi-compact we see by definition that
$U \times_\mathcal{Y} \mathcal{X}$ is an algebraic space, and that
$U \times_\mathcal{Y} \mathcal{X} \to U$ is quasi-compact.
Hence $U \times_Y X$ is a quasi-compact algebraic space.
The morphism
$U \times_\mathcal{Y} \mathcal{X} \to
\mathcal{Z} \times_\mathcal{Y} \mathcal{X}$
is smooth and surjective (as the base change of the smooth
and surjective morphism $U \to \mathcal{Z}$).
Hence $\mathcal{Z} \times_\mathcal{Y} \mathcal{X}$
is quasi-compact by another application of
Properties of Stacks,
Lemma \ref{stacks-properties-lemma-quasi-compact-stack}

\medskip\noindent
Assume (2). Let $Z \to \mathcal{Y}$ be a morphism, where $Z$ is a scheme.
We have to show that the morphism of algebraic spaces
$p : Z \times_\mathcal{Y} \mathcal{X} \to Z$ is quasi-compact.
Let $U \subset Z$ be affine open. Then
$p^{-1}(U) = U \times_\mathcal{Y} \mathcal{Z}$
and the algebraic space $U \times_\mathcal{Y} \mathcal{Z}$
is quasi-compact by assumption (2). Hence $p$ is quasi-compact, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-quasi-compact-local}.
\end{proof}

\noindent
This motivates the following definition.

\begin{definition}
\label{definition-quasi-compact}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
We say $f$ is {\it quasi-compact} if for every quasi-compact
algebraic stack $\mathcal{Z}$ and morphism $\mathcal{Z} \to \mathcal{Y}$
the fibre product $\mathcal{Z} \times_\mathcal{Y} \mathcal{X}$
is quasi-compact.
\end{definition}

\noindent
By
Lemma \ref{lemma-characterize-representable-quasi-compact}
above this agrees with the already existing notion
for morphisms of algebraic stacks representable by algebraic spaces.
In particular this notion agrees with the notions already defined
for morphisms between algebraic stacks and schemes.

\begin{lemma}
\label{lemma-base-change-quasi-compact}
The base change of a quasi-compact morphism of algebraic stacks
by any morphism of algebraic stacks is quasi-compact.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-quasi-compact}
The composition of a pair of quasi-compact morphisms of algebraic stacks
is quasi-compact.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-surjection-from-quasi-compact}
Let
$$
\xymatrix{
\mathcal{X} \ar[rr]_f \ar[rd]_p & &
\mathcal{Y} \ar[dl]^q \\
& \mathcal{Z}
}
$$
be a $2$-commutative diagram of morphisms of algebraic stacks.
If $f$ is surjective and $p$ is quasi-compact, then $q$ is quasi-compact.
\end{lemma}

\begin{proof}
Let $\mathcal{T}$ be a quasi-compact algebraic stack, and let
$\mathcal{T} \to \mathcal{Z}$ be a morphism. By
Properties of Stacks,
Lemma \ref{stacks-properties-lemma-base-change-surjective}
the morphism
$\mathcal{T} \times_\mathcal{Z} \mathcal{X} \to
\mathcal{T} \times_\mathcal{Z} \mathcal{Y}$
is surjective and by assumption
$\mathcal{T} \times_\mathcal{Z} \mathcal{X}$
is quasi-compact. Hence
$\mathcal{T} \times_\mathcal{Z} \mathcal{Y}$
is quasi-compact by
Properties of Stacks, Lemma \ref{stacks-properties-lemma-quasi-compact-stack}.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact-permanence}
Let $f : \mathcal{X} \to \mathcal{Y}$ and
$g : \mathcal{Y} \to \mathcal{Z}$ be morphisms of algebraic stacks.
If $g \circ f$ is quasi-compact and $g$ is quasi-separated
then $f$ is quasi-compact.
\end{lemma}

\begin{proof}
This is true because $f$ equals the composition
$(1, f) : \mathcal{X} \to \mathcal{X} \times_\mathcal{Z} \mathcal{Y} \to
\mathcal{Y}$.
The first map is quasi-compact by
Lemma \ref{lemma-section-immersion}
because it is a section of the quasi-separated morphism
$\mathcal{X} \times_\mathcal{Z} \mathcal{Y} \to \mathcal{X}$
(a base change of $g$, see
Lemma \ref{lemma-base-change-separated}).
The second map is quasi-compact as it is the base change of $f$, see
Lemma \ref{lemma-base-change-quasi-compact}.
And compositions of quasi-compact
morphisms are quasi-compact, see Lemma \ref{lemma-composition-quasi-compact}.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact-quasi-separated-permanence}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
\begin{enumerate}
\item If $\mathcal{X}$ is quasi-compact and $\mathcal{Y}$ is
quasi-separated, then $f$ is quasi-compact.
\item If $\mathcal{X}$ is quasi-compact and quasi-separated and $\mathcal{Y}$
is quasi-separated, then $f$ is quasi-compact and quasi-separated.
\item A fibre product of quasi-compact and quasi-separated algebraic stacks
is quasi-compact and quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) follows from
Lemma \ref{lemma-quasi-compact-permanence}.
Part (2) follows from (1) and
Lemma \ref{lemma-compose-after-separated}.
For (3) let $\mathcal{X} \to \mathcal{Y}$ and $\mathcal{Z} \to \mathcal{Y}$
be morphisms of quasi-compact and quasi-separated algebraic stacks.
Then $\mathcal{X} \times_\mathcal{Y} \mathcal{Z} \to \mathcal{Z}$
is quasi-compact and quasi-separated as a base change of
$\mathcal{X} \to \mathcal{Y}$ using (2) and
Lemmas \ref{lemma-base-change-quasi-compact} and
\ref{lemma-base-change-separated}.
Hence $\mathcal{X} \times_\mathcal{Y} \mathcal{Z}$
is quasi-compact and quasi-separated as
an algebraic stack quasi-compact and quasi-separated over
$\mathcal{Z}$, see
Lemmas \ref{lemma-separated-over-separated} and
\ref{lemma-composition-quasi-compact}.
\end{proof}








\section{Noetherian algebraic stacks}
\label{section-noetherian}

\noindent
We have already defined locally Noetherian algebraic stacks in
Properties of Stacks, Section \ref{stacks-properties-section-types-properties}.

\begin{definition}
\label{definition-noetherian}
Let $\mathcal{X}$ be an algebraic stack. We say $\mathcal{X}$ is
{\it Noetherian} if $\mathcal{X}$ is quasi-compact, quasi-separated
and locally Noetherian.
\end{definition}

\noindent
Note that a Noetherian algebraic stack $\mathcal{X}$ is not just quasi-compact
and locally Noetherian, but also quasi-separated. In the language of
Section \ref{section-higher-diagonals}
if we denote $p : \mathcal{X} \to \Spec(\mathbf{Z})$ the
``absolute'' structure morphism (i.e., the structure morphism of
$\mathcal{X}$ viewed as an algebraic stack over $\mathbf{Z}$), then
$$
\mathcal{X}\text{ Noetherian}
\Leftrightarrow
\mathcal{X}\text{ locally Noetherian and }
\Delta_{p, 0}, \Delta_{p, 1}, \Delta_{p, 2}
\text{ quasi-compact}.
$$
This will later mean that an algebraic stack of finite type over a
Noetherian algebraic stack is not automatically Noetherian.










\section{Open morphisms}
\label{section-open}

\noindent
Let $f$ be a morphism of algebraic stacks which is representable by
algebraic spaces. In
Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}
we have defined what it means for $f$ to be universally open.
Here is another characterization.

\begin{lemma}
\label{lemma-characterize-representable-universally-open}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of
algebraic stacks which is representable by algebraic spaces.
The following are equivalent
\begin{enumerate}
\item $f$ is universally open, and
\item for every morphism of algebraic stacks $\mathcal{Z} \to \mathcal{Y}$
the morphism of topological spaces
$|\mathcal{Z} \times_\mathcal{Y} \mathcal{X}| \to |\mathcal{Z}|$ is open.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1), and let $\mathcal{Z} \to \mathcal{Y}$ be as in (2).
Choose a scheme $V$ and a surjective smooth morphism $V \to \mathcal{Z}$.
By assumption the morphism $V \times_\mathcal{Y} \mathcal{X} \to V$
of algebraic spaces is universally open, in particular the map
$|V \times_\mathcal{Y} \mathcal{X}| \to |V|$ is open. By
Properties of Stacks, Section \ref{stacks-properties-section-points}
in the commutative diagram
$$
\xymatrix{
|V \times_\mathcal{Y} \mathcal{X}| \ar[r] \ar[d] &
|\mathcal{Z} \times_\mathcal{Y} \mathcal{X}| \ar[d] \\
|V| \ar[r] & |\mathcal{Z}|
}
$$
the horizontal arrows are open and surjective, and moreover
$$
|V \times_\mathcal{Y} \mathcal{X}| \longrightarrow
|V| \times_{|\mathcal{Z}|} |\mathcal{Z} \times_\mathcal{Y} \mathcal{X}|
$$
is surjective. Hence as the left vertical arrow is open it follows that
the right vertical arrow is open. This proves (2).
The implication (2) $\Rightarrow$ (1) follows from the definitions.
\end{proof}

\noindent
Thus we may use the following natural definition.

\begin{definition}
\label{definition-open}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
\begin{enumerate}
\item We say $f$ is {\it open} if the map of topological
spaces $|\mathcal{X}| \to |\mathcal{Y}|$ is open.
\item We say $f$ is {\it universally open} if for every morphism
of algebraic stacks $\mathcal{Z} \to \mathcal{Y}$
the morphism of topological spaces
$$
|\mathcal{Z} \times_\mathcal{Y} \mathcal{X}| \to |\mathcal{Z}|
$$
is open, i.e., the base change
$\mathcal{Z} \times_\mathcal{Y} \mathcal{X} \to \mathcal{Z}$ is open.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-base-change-universally-open}
The base change of a universally open morphism of algebraic stacks
by any morphism of algebraic stacks is universally open.
\end{lemma}

\begin{proof}
This is immediate from the definition.
\end{proof}

\begin{lemma}
\label{lemma-composition-universally-open}
The composition of a pair of (universally) open morphisms of
algebraic stacks is (universally) open.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}







\section{Submersive morphisms}
\label{section-submersive}

\begin{definition}
\label{definition-submersive}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
\begin{enumerate}
\item We say $f$ is {\it submersive}\footnote{This is very different
from the notion of a submersion of differential manifolds.}
if the continuous map $|\mathcal{X}| \to |\mathcal{Y}|$ is submersive, see
Topology, Definition \ref{topology-definition-submersive}.
\item We say $f$ is {\it universally submersive} if for every
morphism of algebraic stacks $\mathcal{Y}' \to \mathcal{Y}$
the base change $\mathcal{Y}' \times_\mathcal{Y} \mathcal{X} \to \mathcal{Y}'$
is submersive.
\end{enumerate}
\end{definition}

\noindent
We note that a submersive morphism is in particular surjective.













\section{Universally closed morphisms}
\label{section-universally-closed}

\noindent
Let $f$ be a morphism of algebraic stacks which is representable by
algebraic spaces. In
Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}
we have defined what it means for $f$ to be universally closed.
Here is another characterization.

\begin{lemma}
\label{lemma-characterize-representable-universally-closed}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of
algebraic stacks which is representable by algebraic spaces.
The following are equivalent
\begin{enumerate}
\item $f$ is universally closed, and
\item for every morphism of algebraic stacks $\mathcal{Z} \to \mathcal{Y}$
the morphism of topological spaces
$|\mathcal{Z} \times_\mathcal{Y} \mathcal{X}| \to |\mathcal{Z}|$ is closed.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1), and let $\mathcal{Z} \to \mathcal{Y}$ be as in (2).
Choose a scheme $V$ and a surjective smooth morphism $V \to \mathcal{Z}$.
By assumption the morphism $V \times_\mathcal{Y} \mathcal{X} \to V$
of algebraic spaces is universally closed, in particular the map
$|V \times_\mathcal{Y} \mathcal{X}| \to |V|$ is closed. By
Properties of Stacks, Section \ref{stacks-properties-section-points}
in the commutative diagram
$$
\xymatrix{
|V \times_\mathcal{Y} \mathcal{X}| \ar[r] \ar[d] &
|\mathcal{Z} \times_\mathcal{Y} \mathcal{X}| \ar[d] \\
|V| \ar[r] & |\mathcal{Z}|
}
$$
the horizontal arrows are open and surjective, and moreover
$$
|V \times_\mathcal{Y} \mathcal{X}| \longrightarrow
|V| \times_{|\mathcal{Z}|} |\mathcal{Z} \times_\mathcal{Y} \mathcal{X}|
$$
is surjective. Hence as the left vertical arrow is closed it follows that
the right vertical arrow is closed. This proves (2).
The implication (2) $\Rightarrow$ (1) follows from the definitions.
\end{proof}

\noindent
Thus we may use the following natural definition.

\begin{definition}
\label{definition-closed}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
\begin{enumerate}
\item We say $f$ is {\it closed} if the map of topological
spaces $|\mathcal{X}| \to |\mathcal{Y}|$ is closed.
\item We say $f$ is {\it universally closed} if for every morphism
of algebraic stacks $\mathcal{Z} \to \mathcal{Y}$
the morphism of topological spaces
$$
|\mathcal{Z} \times_\mathcal{Y} \mathcal{X}| \to |\mathcal{Z}|
$$
is closed, i.e., the base change
$\mathcal{Z} \times_\mathcal{Y} \mathcal{X} \to \mathcal{Z}$ is closed.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-base-change-universally-closed}
The base change of a universally closed morphism of algebraic stacks
by any morphism of algebraic stacks is universally closed.
\end{lemma}

\begin{proof}
This is immediate from the definition.
\end{proof}

\begin{lemma}
\label{lemma-composition-universally-closed}
The composition of a pair of (universally) closed morphisms of
algebraic stacks is (universally) closed.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}












\section{Types of morphisms smooth local on source-and-target}
\label{section-local-source-target}

\noindent
Given a property of morphisms of algebraic spaces which is
{\it smooth local on the source-and-target}, see
Descent on Spaces,
Definition \ref{spaces-descent-definition-local-source-target}
we may use it to define a corresponding
property of morphisms of algebraic stacks, namely by imposing either of
the equivalent conditions of the lemma below.

\begin{lemma}
\label{lemma-local-source-target}
Let $\mathcal{P}$ be a property of morphisms of algebraic spaces
which is smooth local on the source-and-target.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Consider commutative diagrams
$$
\xymatrix{
U \ar[d]_a \ar[r]_h & V \ar[d]^b \\
\mathcal{X} \ar[r]^f & \mathcal{Y}
}
$$
where $U$ and $V$ are algebraic spaces and the vertical arrows are smooth.
The following are equivalent
\begin{enumerate}
\item for any diagram as above such that in addition
$U \to \mathcal{X} \times_\mathcal{Y} V$ is smooth
the morphism $h$ has property $\mathcal{P}$, and
\item for some diagram as above with $a : U \to \mathcal{X}$ surjective
the morphism $h$ has property $\mathcal{P}$.
\end{enumerate}
If $\mathcal{X}$ and $\mathcal{Y}$ are representable by algebraic spaces,
then this is also equivalent to $f$ (as a morphism of algebraic spaces)
having property $\mathcal{P}$. If $\mathcal{P}$ is also preserved under
any base change, and fppf local on the base, then for morphisms $f$
which are representable by algebraic spaces this
is also equivalent to $f$ having property $\mathcal{P}$ in the sense
of
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}.
\end{lemma}

\begin{proof}
Let us prove the implication (1) $\Rightarrow$ (2). Pick an algebraic
space $V$ and a surjective and smooth morphism $V \to \mathcal{Y}$.
Pick an algebraic space $U$ and a surjective and smooth morphism
$U \to \mathcal{X} \times_\mathcal{Y} V$. Note that $U \to \mathcal{X}$
is surjective and smooth as well, as a composition of the base change
$\mathcal{X} \times_\mathcal{Y} V \to \mathcal{X}$ and the chosen
map $U \to \mathcal{X} \times_\mathcal{Y} V$. Hence we obtain a
diagram as in (1). Thus if (1) holds, then $h : U \to V$ has property
$\mathcal{P}$, which means that (2) holds as $U \to \mathcal{X}$ is surjective.

\medskip\noindent
Conversely, assume (2) holds and let $U, V, a, b, h$ be as in (2).
Next, let $U', V', a', b', h'$ be any diagram as in (1).
Picture
$$
\xymatrix{
U \ar[d] \ar[r]_h & V \ar[d] \\
\mathcal{X} \ar[r]^f & \mathcal{Y}
}
\quad\quad
\xymatrix{
U' \ar[d] \ar[r]_{h'} & V' \ar[d] \\
\mathcal{X} \ar[r]^f & \mathcal{Y}
}
$$
To show that (2) implies (1) we have to prove that $h'$ has $\mathcal{P}$.
To do this consider the commutative diagram
$$
\xymatrix{
U \ar[dd]^h &
U \times_\mathcal{X} U' \ar[d] \ar[l] \ar@/^6ex/[dd]^{(h, h')} \ar[r] &
U' \ar[dd]^{h'} \\
& U \times_\mathcal{Y} V' \ar[lu] \ar[d] & \\
V &
V \times_\mathcal{Y} V' \ar[l] \ar[r] &
V'
}
$$
of algebraic spaces. Note that the horizontal arrows are
smooth as base changes of the smooth morphisms
$V \to \mathcal{Y}$, $V' \to \mathcal{Y}$, $U \to \mathcal{X}$, and
$U' \to \mathcal{X}$. Note that
$$
\xymatrix{
U \times_\mathcal{X} U' \ar[d] \ar[r] & U' \ar[d] \\
U \times_\mathcal{Y} V' \ar[r] & \mathcal{X} \times_\mathcal{Y} V'
}
$$
is cartesian, hence the left vertical arrow is smooth as
$U', V', a', b', h'$ is as in (1).
Since $\mathcal{P}$ is local on the target we see
that the base change $U \times_\mathcal{Y} V' \to V \times_\mathcal{Y} V'$
has $\mathcal{P}$ and hence after precomposing by the smooth morphism
$U \times_\mathcal{X} U' \to U \times_\mathcal{Y} V'$ the morphism
we conclude $(h, h')$ has $\mathcal{P}$. Finally, since $U \times_X U' \to U'$
is surjective this implies that $h'$ has $\mathcal{P}$ as $\mathcal{P}$
is local on the source-and-target. This finishes the proof of the equivalence
of (1) and (2).

\medskip\noindent
If $\mathcal{X}$ and $\mathcal{Y}$ are representable, then
Descent on Spaces,
Lemma \ref{spaces-descent-lemma-local-source-target-characterize}
applies which shows that (1) and (2) are equivalent to $f$ having
$\mathcal{P}$.

\medskip\noindent
Finally, suppose $f$ is representable, and $U, V, a, b, h$ are
as in part (2) of the lemma, and that $\mathcal{P}$ is preserved under
arbitrary base change. We have to show that for any scheme
$Z$ and morphism $Z \to \mathcal{X}$ the base change
$Z \times_\mathcal{Y} \mathcal{X} \to Z$
has property $\mathcal{P}$. Consider the diagram
$$
\xymatrix{
Z \times_\mathcal{Y} U \ar[d] \ar[r] &
Z \times_\mathcal{Y} V \ar[d] \\
Z \times_\mathcal{Y} \mathcal{X} \ar[r] &
Z
}
$$
Note that the top horizontal arrow is a base change of $h$ and
hence has property $\mathcal{P}$. The left vertical arrow is smooth
and surjective and the right vertical arrow is smooth. Thus
Descent on Spaces,
Lemma \ref{spaces-descent-lemma-local-source-target-characterize}
kicks in and shows that $Z \times_\mathcal{Y} \mathcal{X} \to Z$
has property $\mathcal{P}$.
\end{proof}

\begin{definition}
\label{definition-P}
Let $\mathcal{P}$ be a property of morphisms of algebraic spaces
which is smooth local on the source-and-target.
We say a morphism $f : \mathcal{X} \to \mathcal{Y}$ of algebraic stacks
{\it has property $\mathcal{P}$} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold.
\end{definition}

\begin{remark}
\label{remark-composition}
Let $\mathcal{P}$ be a property of morphisms of algebraic spaces
which is smooth local on the source-and-target and stable under composition.
Then the property of morphisms of algebraic stacks defined in
Definition \ref{definition-P}
is stable under composition. Namely, let $f : \mathcal{X} \to \mathcal{Y}$
and $g : \mathcal{Y} \to \mathcal{Z}$ be morphisms of algebraic stacks
having property $\mathcal{P}$. Choose an algebraic space $W$ and a
surjective smooth morphism $W \to \mathcal{Z}$. Choose an algebraic space
$V$ and a surjective smooth morphism $V \to \mathcal{Y} \times_\mathcal{Z} W$.
Finally, choose an algebraic space $U$ and a surjective and smooth morphism
$U \to \mathcal{X} \times_\mathcal{Y} V$. Then the morphisms
$V \to W$ and $U \to V$ have property $\mathcal{P}$ by definition.
Whence $U \to W$ has property $\mathcal{P}$ as we assumed that
$\mathcal{P}$ is stable under composition. Thus, by definition again,
we see that $g \circ f : \mathcal{X} \to \mathcal{Z}$ has
property $\mathcal{P}$.
\end{remark}

\begin{remark}
\label{remark-base-change}
Let $\mathcal{P}$ be a property of morphisms of algebraic spaces
which is smooth local on the source-and-target and stable under base change.
Then the property of morphisms of algebraic stacks defined in
Definition \ref{definition-P}
is stable under base change. Namely, let $f : \mathcal{X} \to \mathcal{Y}$
and $g : \mathcal{Y}' \to \mathcal{Y}$ be morphisms of algebraic stacks
and assume $f$ has property $\mathcal{P}$. Choose an algebraic space $V$
and a surjective smooth morphism $V \to \mathcal{Y}$. Choose an algebraic
space $U$ and a surjective smooth morphism
$U \to \mathcal{X} \times_\mathcal{Y} V$. Finally, choose an algebraic space
$V'$ and a surjective and smooth morphism
$V' \to \mathcal{Y}' \times_\mathcal{Y} V$. Then the morphism
$U \to V$ has property $\mathcal{P}$ by definition.
Whence $V' \times_V U \to V'$ has property $\mathcal{P}$ as we assumed that
$\mathcal{P}$ is stable under base change. Considering the diagram
$$
\xymatrix{
V' \times_V U \ar[r] \ar[d] &
\mathcal{Y}' \times_\mathcal{Y} \mathcal{X} \ar[r] \ar[d] &
\mathcal{X} \ar[d] \\
V' \ar[r] & \mathcal{Y}' \ar[r] & \mathcal{Y}
}
$$
we see that the left top horizontal arrow is smooth and surjective,
whence by definition we see that the projection
$\mathcal{Y}' \times_\mathcal{Y} \mathcal{X} \to \mathcal{Y}'$ has
property $\mathcal{P}$.
\end{remark}

\begin{remark}
\label{remark-implication}
Let $\mathcal{P}, \mathcal{P}'$ be properties of morphisms of algebraic spaces
which are smooth local on the source-and-target and stable under base change.
Suppose that we have $\mathcal{P} \Rightarrow \mathcal{P}'$ for morphisms
of algebraic spaces. Then we also have $\mathcal{P} \Rightarrow \mathcal{P}'$
for the properties of morphisms of algebraic stacks defined in
Definition \ref{definition-P}
using $\mathcal{P}$ and $\mathcal{P}'$. This is clear from the definition.
\end{remark}









\section{Morphisms of finite type}
\label{section-finite-type}

\noindent
The property ``locally of finite type'' of morphisms of algebraic spaces
is smooth local on the source-and-target, see
Descent on Spaces, Remark \ref{spaces-descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-base-change-finite-type}
and
Descent on Spaces,
Lemma \ref{spaces-descent-lemma-descending-property-locally-finite-type}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define what it means for a morphism of algebraic spaces
to be locally of finite type as follows and it agrees with the already
existing notion defined in
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}
when the morphism is representable by algebraic spaces.

\begin{definition}
\label{definition-locally-finite-type}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
\begin{enumerate}
\item We say $f$
{\it locally of finite type} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold with
$\mathcal{P} = \text{locally of finite type}$.
\item We say $f$ is
{\it of finite type} if it is locally of finite type and quasi-compact.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-composition-finite-type}
The composition of finite type morphisms is of finite type.
The same holds for locally of finite type.
\end{lemma}

\begin{proof}
Combine
Remark \ref{remark-composition}
with
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-composition-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-finite-type}
A base change of a finite type morphism is finite type.
The same holds for locally of finite type.
\end{lemma}

\begin{proof}
Combine
Remark \ref{remark-base-change}
with
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-base-change-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-immersion-locally-finite-type}
An immersion is locally of finite type.
\end{lemma}

\begin{proof}
Follows from
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-immersion-locally-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-locally-finite-type-locally-noetherian}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
If $f$ is locally of finite type and $\mathcal{Y}$ is locally Noetherian,
then $\mathcal{X}$ is locally Noetherian.
\end{lemma}

\begin{proof}
Let
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
\mathcal{X} \ar[r] & \mathcal{Y}
}
$$
be a commutative diagram where $U$, $V$ are schemes,
$V \to \mathcal{Y}$ is surjective and smooth, and
$U \to V \times_\mathcal{Y} \mathcal{X}$ is surjective and smooth.
Then $U \to V$ is locally of finite type. If $\mathcal{Y}$ is
locally Noetherian, then $V$ is locally Noetherian. By
Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}
we see that $U$ is locally Noetherian, which means that $\mathcal{X}$
is locally Noetherian.
\end{proof}

\noindent
The following two lemmas will be improved on later (after we have discussed
morphisms of algebraic stacks which are locally of finite presentation).

\begin{lemma}
\label{lemma-check-finite-type-covering}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Let $W \to \mathcal{Y}$ be a surjective, flat, and locally of finite
presentation where $W$ is an algebraic space. If the base change
$W \times_\mathcal{Y} \mathcal{X} \to W$ is
locally of finite type, then $f$ is locally of finite type.
\end{lemma}

\begin{proof}
Choose an algebraic space $V$ and a surjective smooth morphism
$V \to \mathcal{Y}$. Choose an algebraic space $U$ and a surjective
smooth morphism $U \to V \times_\mathcal{Y} \mathcal{X}$.
We have to show that $U \to V$ is locally of finite presentation.
Now we base change everything by $W \to \mathcal{Y}$: Set
$U' = W \times_\mathcal{Y} U$,
$V' = W \times_\mathcal{Y} V$,
$\mathcal{X}' = W \times_\mathcal{Y} \mathcal{X}$,
and $\mathcal{Y}' = W \times_\mathcal{Y} \mathcal{Y} = W$.
Then it is still true that $U' \to V' \times_{\mathcal{Y}'} \mathcal{X}'$
is smooth by base change. Hence by our definition of locally finite type
morphisms of algebraic stacks and the assumption that
$\mathcal{X}' \to \mathcal{Y}'$ is locally of finite type,
we see that $U' \to V'$ is locally of finite type. Then, since
$V' \to V$ is surjective, flat, and locally of finite presentation
as a base change of $W \to \mathcal{Y}$ we see that $U \to V$ is
locally of finite type by
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-descending-property-locally-finite-type}
and we win.
\end{proof}

\begin{lemma}
\label{lemma-check-finite-type-precompose}
Let $\mathcal{X} \to \mathcal{Y} \to \mathcal{Z}$ be morphisms of
algebraic stacks. Assume $\mathcal{X} \to \mathcal{Z}$ is locally of finite
type and that $\mathcal{X} \to \mathcal{Y}$ is representable by algebraic
spaces, surjective, flat, and locally of finite presentation.
Then $\mathcal{Y} \to \mathcal{Z}$ is locally of finite type.
\end{lemma}

\begin{proof}
Choose an algebraic space $W$ and a surjective smooth morphism
$W \to \mathcal{Z}$. Choose an algebraic space $V$ and a surjective smooth
morphism $V \to W \times_\mathcal{Z} \mathcal{Y}$. Set
$U = V \times_\mathcal{Y} \mathcal{X}$ which is an algebraic space.
We know that $U \to V$ is surjective, flat, and locally of finite presentation
and that $U \to W$ is locally of finite type.
Hence the lemma reduces to the case of morphisms of algebraic spaces.
The case of morphisms of algebraic spaces is
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-locally-finite-type-fppf-local-source}.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-permanence}
Let $f : \mathcal{X} \to \mathcal{Y}$,
$g : \mathcal{Y} \to \mathcal{Z}$ be morphisms of algebraic stacks.
If $g \circ f : \mathcal{X} \to \mathcal{Z}$ is locally of finite type,
then $f : \mathcal{X} \to \mathcal{Y}$ is locally of finite type.
\end{lemma}

\begin{proof}
We can find a diagram
$$
\xymatrix{
U \ar[r] \ar[d] & V \ar[r] \ar[d] & W \ar[d] \\
\mathcal{X} \ar[r] & \mathcal{Y} \ar[r] & \mathcal{Z}
}
$$
where $U$, $V$, $W$ are schemes, the vertical arrow $W \to \mathcal{Z}$
is surjective and smooth, the arrow $V \to \mathcal{Y} \times_\mathcal{Z} W$
is surjective and smooth, and the arrow
$U \to \mathcal{X} \times_\mathcal{Y} V$ is surjective and smooth.
Then also $U \to \mathcal{X} \times_\mathcal{Z} V$ is surjective and
smooth (as a composition of a surjective and smooth morphism with a
base change of such). By definition we see that $U \to W$ is locally
of finite type. Hence $U \to V$ is locally of finite type by
Morphisms, Lemma \ref{morphisms-lemma-permanence-finite-type}
which in turn means (by definition) that $\mathcal{X} \to \mathcal{Y}$
is locally of finite type.
\end{proof}










\section{Points of finite type}
\label{section-points-finite-type}

\noindent
Let $\mathcal{X}$ be an algebraic stack.
A finite type point $x \in |\mathcal{X}|$ is a point which can be represented
by a morphism $\Spec(k) \to \mathcal{X}$ which is locally of finite type.
Finite type points are a suitable replacement of closed points for algebraic
spaces and algebraic stacks. There are always ``enough of them'' for example.

\begin{lemma}
\label{lemma-point-finite-type}
Let $\mathcal{X}$ be an algebraic stack.
Let $x \in |\mathcal{X}|$. The following are equivalent:
\begin{enumerate}
\item There exists a morphism $\Spec(k) \to \mathcal{X}$
which is locally of finite type and represents $x$.
\item There exists a scheme $U$, a closed point $u \in U$, and a smooth
morphism $\varphi : U \to \mathcal{X}$ such that $\varphi(u) = x$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $u \in U$ and $U \to \mathcal{X}$ be as in (2). Then
$\Spec(\kappa(u)) \to U$ is of finite type, and $U \to \mathcal{X}$ is
representable and locally of finite type (by
Morphisms of Spaces,
Lemmas \ref{spaces-morphisms-lemma-etale-locally-finite-presentation} and
\ref{spaces-morphisms-lemma-finite-presentation-finite-type}).
Hence we see (1) holds by
Lemma \ref{lemma-composition-finite-type}.

\medskip\noindent
Conversely, assume $\Spec(k) \to \mathcal{X}$ is locally of finite type
and represents $x$. Let $U \to \mathcal{X}$ be a surjective smooth morphism
where $U$ is a scheme. By assumption
$U \times_\mathcal{X} \Spec(k) \to U$ is a morphism of algebraic
spaces which is locally of finite type. Pick a finite type point $v$ of
$U \times_\mathcal{X} \Spec(k)$ (there exists at least one, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-identify-finite-type-points}).
By
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-finite-type-points-morphism}
the image $u \in U$ of $v$ is a finite type point of $U$.
Hence by
Morphisms, Lemma \ref{morphisms-lemma-identify-finite-type-points}
after shrinking $U$ we may assume that $u$ is a closed point of $U$, i.e.,
(2) holds.
\end{proof}

\begin{definition}
\label{definition-finite-type-point}
Let $\mathcal{X}$ be an algebraic stack. We say a point $x \in |\mathcal{X}|$
is a {\it finite type point}\footnote{This is a
slight abuse of language as it would perhaps be more correct to say
``locally finite type point''.} if the equivalent conditions of
Lemma \ref{lemma-point-finite-type}
are satisfied. We denote $\mathcal{X}_{\text{ft-pts}}$
the set of finite type points of $\mathcal{X}$.
\end{definition}

\noindent
We can describe the set of finite type points as follows.

\begin{lemma}
\label{lemma-identify-finite-type-points}
Let $\mathcal{X}$ be an algebraic stack. We have
$$
\mathcal{X}_{\text{ft-pts}} =
\bigcup\nolimits_{\varphi : U \to X\text{ smooth}} |\varphi|(U_0)
$$
where $U_0$ is the set of closed points of $U$.
Here we may let $U$ range over all schemes smooth over $\mathcal{X}$
or over all affine schemes smooth over $\mathcal{X}$.
\end{lemma}

\begin{proof}
Immediate from
Lemma \ref{lemma-point-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-points-morphism}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
If $f$ is locally of finite type, then
$f(\mathcal{X}_{\text{ft-pts}}) \subset \mathcal{Y}_{\text{ft-pts}}$.
\end{lemma}

\begin{proof}
Take $x \in \mathcal{X}_{\text{ft-pts}}$. Represent $x$ by a locally
finite type morphism $x : \Spec(k) \to \mathcal{X}$. Then
$f \circ x$ is locally of finite type by
Lemma \ref{lemma-composition-finite-type}.
Hence $f(x) \in \mathcal{Y}_{\text{ft-pts}}$.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-points-surjective-morphism}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
If $f$ is locally of finite type and surjective, then
$f(\mathcal{X}_{\text{ft-pts}}) = \mathcal{Y}_{\text{ft-pts}}$.
\end{lemma}

\begin{proof}
We have $f(\mathcal{X}_{\text{ft-pts}}) \subset \mathcal{Y}_{\text{ft-pts}}$ by
Lemma \ref{lemma-finite-type-points-morphism}.
Let $y \in |\mathcal{Y}|$ be a finite type point. Represent $y$ by a morphism
$\Spec(k) \to \mathcal{Y}$ which is locally of finite type.
As $f$ is surjective the algebraic stack
$\mathcal{X}_k = \Spec(k) \times_\mathcal{Y} \mathcal{X}$ is nonempty,
therefore has a finite type point $x \in |\mathcal{X}_k|$ by
Lemma \ref{lemma-identify-finite-type-points}.
Now $\mathcal{X}_k \to \mathcal{X}$ is a morphism which is locally of finite
type as a base change of $\Spec(k) \to \mathcal{Y}$
(Lemma \ref{lemma-base-change-finite-type}).
Hence the image of $x$ in $\mathcal{X}$ is a finite type point by
Lemma \ref{lemma-finite-type-points-morphism}
which maps to $y$ by construction.
\end{proof}

\begin{lemma}
\label{lemma-enough-finite-type-points}
Let $\mathcal{X}$ be an algebraic stack.
For any locally closed subset $T \subset |\mathcal{X}|$ we have
$$
T \not = \emptyset
\Rightarrow
T \cap \mathcal{X}_{\text{ft-pts}} \not = \emptyset.
$$
In particular, for any closed subset $T \subset |\mathcal{X}|$ we
see that $T \cap \mathcal{X}_{\text{ft-pts}}$ is dense in $T$.
\end{lemma}

\begin{proof}
Let $i : \mathcal{Z} \to \mathcal{X}$ be the reduced induced substack
structure on $T$, see
Properties of Stacks,
Remark \ref{stacks-properties-remark-stack-structure-locally-closed-subset}.
An immersion is locally of finite type, see
Lemma \ref{lemma-immersion-locally-finite-type}.
Hence by
Lemma \ref{lemma-finite-type-points-morphism}
we see
$\mathcal{Z}_{\text{ft-pts}} \subset \mathcal{X}_{\text{ft-pts}} \cap T$.
Finally, any nonempty affine scheme $U$ with a smooth morphism towards
$\mathcal{Z}$ has at least one closed point, hence $\mathcal{Z}$ has at least
one finite type point by
Lemma \ref{lemma-identify-finite-type-points}.
The lemma follows.
\end{proof}

\noindent
Here is another, more technical, characterization of a finite type
point on an algebraic stack. It tells us in particular that the residual
gerbe of $\mathcal{X}$ at $x$ exists whenever $x$ is a finite type point!

\begin{lemma}
\label{lemma-point-finite-type-monomorphism}
Let $\mathcal{X}$ be an algebraic stack.
Let $x \in |\mathcal{X}|$. The following are equivalent:
\begin{enumerate}
\item $x$ is a finite type point,
\item there exists an algebraic stack $\mathcal{Z}$
whose underlying topological space $|\mathcal{Z}|$ is a singleton,
and a morphism $f : \mathcal{Z} \to \mathcal{X}$ which is
locally of finite type such that $\{x\} = |f|(|\mathcal{Z}|)$, and
\item the residual gerbe $\mathcal{Z}_x$ of $\mathcal{X}$ at $x$ exists
and the inclusion morphism $\mathcal{Z}_x \to \mathcal{X}$ is locally of
finite type.
\end{enumerate}
\end{lemma}

\begin{proof}
(All of the morphisms occurring in this paragraph are representable
by algebraic spaces, hence the conventions and results of
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}
are applicable.)
Assume $x$ is a finite type point. Choose an affine scheme $U$,
a closed point $u \in U$, and a smooth morphism $\varphi : U \to \mathcal{X}$
with $\varphi(u) = x$, see
Lemma \ref{lemma-identify-finite-type-points}.
Set $u = \Spec(\kappa(u))$ as usual. Set $R = u \times_\mathcal{X} u$
so that we obtain a groupoid in algebraic spaces
$(u, R, s, t, c)$, see
Algebraic Stacks, Lemma \ref{algebraic-lemma-map-space-into-stack}.
The projection morphisms $R \to u$ are the compositions
$$
R = u \times_\mathcal{X} u \to
u \times_\mathcal{X} U \to
u \times_\mathcal{X} X = u
$$
where the first arrow is of finite type (a base change of the closed
immersion of schemes $u \to U$) and the second arrow is smooth (a base
change of the smooth morphism $U \to \mathcal{X}$). Hence
$s, t : R \to u$ are locally of finite type (as compositions, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-composition-finite-type}).
Since $u$ is the spectrum of a field, it follows that
$s, t$ are flat and locally of finite presentation (by
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-noetherian-finite-type-finite-presentation}).
We see that $\mathcal{Z} = [u/R]$ is an algebraic stack by
Criteria for Representability,
Theorem \ref{criteria-theorem-flat-groupoid-gives-algebraic-stack}.
By
Algebraic Stacks, Lemma \ref{algebraic-lemma-map-space-into-stack}
we obtain a canonical morphism
$$
f : \mathcal{Z} \longrightarrow \mathcal{X}
$$
which is fully faithful. Hence this morphism is representable by
algebraic spaces, see
Algebraic Stacks, Lemma
\ref{algebraic-lemma-characterize-representable-by-algebraic-spaces}
and a monomorphism, see
Properties of Stacks, Lemma \ref{stacks-properties-lemma-monomorphism}.
It follows that the residual gerbe $\mathcal{Z}_x \subset \mathcal{X}$
of $\mathcal{X}$ at $x$ exists and that $f$ factors through an
equivalence $\mathcal{Z} \to \mathcal{Z}_x$, see
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-residual-gerbe-unique}.
By construction the diagram
$$
\xymatrix{
u \ar[d] \ar[r] & U \ar[d] \\
\mathcal{Z} \ar[r]^f & \mathcal{X}
}
$$
is commutative. By
Criteria for Representability,
Lemma \ref{criteria-lemma-flat-quotient-flat-presentation}
the left vertical arrow is surjective, flat, and locally of finite
presentation. Consider
$$
\xymatrix{
u \times_\mathcal{X} U \ar[d] \ar[r] &
\mathcal{Z} \times_\mathcal{X} U \ar[r] \ar[d] & U \ar[d] \\
u \ar[r] & \mathcal{Z} \ar[r]^f & \mathcal{X}
}
$$
As $u \to \mathcal{X}$ is locally of finite type, we see that the base change
$u \times_\mathcal{X} U \to U$ is locally of finite type. Moreover,
$u \times_\mathcal{X} U \to \mathcal{Z} \times_\mathcal{X} U$ is
surjective, flat, and locally of finite presentation as a base change of
$u \to \mathcal{Z}$. Thus
$\{u \times_\mathcal{X} U \to \mathcal{Z} \times_\mathcal{X} U\}$
is an fppf covering of algebraic spaces, and we conclude that
$\mathcal{Z} \times_\mathcal{X} U \to U$ is locally of finite type by
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-locally-finite-presentation-fppf-local-source}.
By definition this means that $f$ is locally of finite type (because the
vertical arrow $\mathcal{Z} \times_\mathcal{X} U \to \mathcal{Z}$ is smooth
as a base change of $U \to \mathcal{X}$ and surjective as $\mathcal{Z}$ has
only one point). Since $\mathcal{Z} = \mathcal{Z}_x$ we see that (3) holds.

\medskip\noindent
It is clear that (3) implies (2).
If (2) holds then $x$ is a finite type point of $\mathcal{X}$ by
Lemma \ref{lemma-finite-type-points-morphism}
and
Lemma \ref{lemma-enough-finite-type-points}
to see that $\mathcal{Z}_{\text{ft-pts}}$ is nonempty, i.e., the
unique point of $\mathcal{Z}$ is a finite type point of $\mathcal{Z}$.
\end{proof}










\section{Special presentations of algebraic stacks}
\label{section-presentations}

\noindent
The following lemma gives a criterion for when a ``slice''
of a presentation is still flat over the algebraic stack.

\begin{lemma}
\label{lemma-slice}
Let $\mathcal{X}$ be an algebraic stack.
Consider a cartesian diagram
$$
\xymatrix{
U \ar[d] & F \ar[l]^p \ar[d] \\
\mathcal{X} & \Spec(k) \ar[l]
}
$$
where $U$ is an algebraic space, $k$ is a field, and $U \to \mathcal{X}$
is flat and locally of finite presentation. Let
$f_1, \ldots, f_r \in \Gamma(U, \mathcal{O}_U)$
and $z \in |F|$ such that $f_1, \ldots, f_r$ map to a regular sequence
in the local ring $\mathcal{O}_{F, \overline{z}}$.
Then, after replacing $U$ by an open subspace containing $p(z)$, the morphism
$$
V(f_1, \ldots, f_r) \longrightarrow \mathcal{X}
$$
is flat and locally of finite presentation.
\end{lemma}

\begin{proof}
Choose a scheme $W$ and a surjective smooth morphism $W \to \mathcal{X}$.
Choose an extension of fields $k \subset k'$ and a morphism
$w : \Spec(k') \to W$ such that $\Spec(k') \to W \to \mathcal{X}$
is $2$-isomorphic to $\Spec(k') \to \Spec(k) \to \mathcal{X}$.
This is possible as $W \to \mathcal{X}$ is surjective.
Consider the commutative diagram
$$
\xymatrix{
U \ar[d] &
U \times_\mathcal{X} W \ar[l]^-{\text{pr}_0} \ar[d] &
F' \ar[l]^-{p'} \ar[d] \\
\mathcal{X} &
W \ar[l] &
\Spec(k') \ar[l]
}
$$
both of whose squares are cartesian. By our choice of $w$ we see that
$F' = F \times_{\Spec(k)} \Spec(k')$. Thus $F' \to F$ is
surjective and we can choose a point $z' \in |F'|$ mapping to $z$.
Since $F' \to F$ is flat we see that
$\mathcal{O}_{F, \overline{z}} \to \mathcal{O}_{F', \overline{z}'}$ is
flat, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-flat-at-point-etale-local-rings}.
Hence $f_1, \ldots, f_r$ map to a regular sequence in
$\mathcal{O}_{F', \overline{z}'}$, see
Algebra, Lemma \ref{algebra-lemma-flat-increases-depth}.
Note that $U \times_\mathcal{X} W \to W$ is a morphism of algebraic spaces
which is flat and locally of finite presentation. Hence by
More on Morphisms of Spaces, Lemma \ref{spaces-more-morphisms-lemma-slice}
we see that there exists an open subspace $U'$ of $U \times_\mathcal{X} W$
containing $p(z')$ such that the intersection
$U' \cap (V(f_1, \ldots, f_r) \times_\mathcal{X} W)$ is flat and locally
of finite presentation over $W$. Note that
$\text{pr}_0(U')$ is an open subspace of $U$ containing $p(z)$
as $\text{pr}_0$ is smooth hence open. Now we see that
$U' \cap (V(f_1, \ldots, f_r) \times_\mathcal{X} W) \to \mathcal{X}$
is flat and locally of finite presentation as the composition
$$
U' \cap (V(f_1, \ldots, f_r) \times_\mathcal{X} W) \to W \to \mathcal{X}.
$$
Hence
Properties of Stacks,
Lemma \ref{stacks-properties-lemma-check-property-after-precomposing}
implies $\text{pr}_0(U') \cap V(f_1, \ldots, f_r) \to \mathcal{X}$
is flat and locally of finite presentation as desired.
\end{proof}

\begin{lemma}
\label{lemma-quasi-finite-at-point}
Let $\mathcal{X}$ be an algebraic stack. Consider a cartesian diagram
$$
\xymatrix{
U \ar[d] & F \ar[l]^p \ar[d] \\
\mathcal{X} & \Spec(k) \ar[l]
}
$$
where $U$ is an algebraic space, $k$ is a field, and $U \to \mathcal{X}$
is locally of finite type. Let $z \in |F|$ be such that $\dim_z(F) = 0$.
Then, after replacing $U$ by an open subspace containing $p(z)$, the morphism
$$
U \longrightarrow \mathcal{X}
$$
is locally quasi-finite.
\end{lemma}

\begin{proof}
Since $f : U \to \mathcal{X}$ is locally of finite type there exists a
maximal open $W(f) \subset U$ such that the restriction
$f|_{W(f)} : W(f) \to \mathcal{X}$ is locally quasi-finite, see
Properties of Stacks, Remark
\ref{stacks-properties-remark-local-source-apply}
(\ref{stacks-properties-item-loc-quasi-finite}).
Hence all we need to do is prove that $p(z)$ is a point of $W(f)$.
Moreover, the remark referenced above also shows the formation of $W(f)$
commutes with arbitrary base change by a morphism which is representable
by algebraic spaces. Hence it suffices to show that the morphism
$F \to \Spec(k)$ is locally quasi-finite at $z$. This follows
immediately from
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-locally-quasi-finite-rel-dimension-0}.
\end{proof}

\noindent
A quasi-DM stack has a locally quasi-finite ``covering'' by a scheme.

\begin{theorem}
\label{theorem-quasi-DM}
Let $\mathcal{X}$ be an algebraic stack. The following are equivalent
\begin{enumerate}
\item $\mathcal{X}$ is quasi-DM, and
\item there exists a scheme $W$ and a surjective, flat, locally finitely
presented, locally quasi-finite morphism $W \to \mathcal{X}$.
\end{enumerate}
\end{theorem}

\begin{proof}
The implication (2) $\Rightarrow$ (1) is
Lemma \ref{lemma-properties-covering-imply-diagonal}.
Assume (1).
Let $x \in |\mathcal{X}|$ be a finite type point. We will produce a scheme
over $\mathcal{X}$ which ``works'' in a neighbourhood of $x$. At the end
of the proof we will take the disjoint union of all of these to conclude.

\medskip\noindent
Let $U$ be an affine scheme, $U \to \mathcal{X}$ a smooth morphism, and
$u \in U$ a closed point which maps to $x$, see
Lemma \ref{lemma-point-finite-type}.
Denote $u = \Spec(\kappa(u))$ as usual. Consider the following
commutative diagram
$$
\xymatrix{
u \ar[d] & R \ar[l] \ar[d] \\
U \ar[d] & F \ar[d] \ar[l]^p \\
\mathcal{X} & u \ar[l]
}
$$
with both squares fibre product squares, in particular
$R = u \times_\mathcal{X} u$. In the proof of
Lemma \ref{lemma-point-finite-type-monomorphism}
we have seen that $(u, R, s, t, c)$ is a groupoid in algebraic spaces
with $s, t$ locally of finite type. Let $G \to u$ be the stabilizer group
algebraic space (see
Groupoids in Spaces, Definition
\ref{spaces-groupoids-definition-stabilizer-groupoid}).
Note that
$$
G = R \times_{(u \times u)} u =
(u \times_\mathcal{X} u) \times_{(u \times u)} u =
\mathcal{X} \times_{\mathcal{X} \times \mathcal{X}} u.
$$
As $\mathcal{X}$ is quasi-DM we see that
$G$ is locally quasi-finite over $u$. By
More on Groupoids in Spaces, Lemma
\ref{spaces-more-groupoids-lemma-groupoid-on-field-dimension-equal-stabilizer}
we have $\dim(R) = 0$.

\medskip\noindent
Let $e : u \to R$ be the identity of the groupoid. Thus both compositions
$u \to R \to u$ are equal to the identity morphism of $u$.
Note that $R \subset F$ is a closed
subspace as $u \subset U$ is a closed subscheme. Hence we can also think
of $e$ as a point of $F$. Consider the maps of \'etale local rings
$$
\mathcal{O}_{U, u}
\xrightarrow{p^\sharp}
\mathcal{O}_{F, \overline{e}}
\longrightarrow
\mathcal{O}_{R, \overline{e}}
$$
Note that $\mathcal{O}_{R, \overline{e}}$ has dimension $0$ by the result
of the first paragraph. On the other hand, the kernel of the second arrow is
$p^\sharp(\mathfrak m_u)\mathcal{O}_{F, \overline{e}}$ as
$R$ is cut out in $F$ by $\mathfrak m_u$. Thus we see that
$$
\mathfrak m_{\overline{z}} =
\sqrt{p^\sharp(\mathfrak m_u)\mathcal{O}_{F, \overline{e}}}
$$
On the other hand, as the morphism $U \to \mathcal{X}$ is smooth
we see that $F \to u$ is a smooth morphism of algebraic spaces.
This means that $F$ is a regular algebraic space
(Spaces over Fields, Lemma \ref{spaces-over-fields-lemma-smooth-regular}).
Hence $\mathcal{O}_{F, \overline{e}}$ is a regular local ring
(Properties of Spaces, Lemma \ref{spaces-properties-lemma-regular}).
Note that a regular local ring is Cohen-Macaulay
(Algebra, Lemma \ref{algebra-lemma-regular-ring-CM}).
Let $d = \dim(\mathcal{O}_{F, \overline{e}})$. By
Algebra, Lemma \ref{algebra-lemma-find-sequence-image-regular}
we can find $f_1, \ldots, f_d \in \mathcal{O}_{U, u}$ whose images
$\varphi(f_1), \ldots, \varphi(f_d)$ form a regular sequence
in $\mathcal{O}_{F, \overline{z}}$. By
Lemma \ref{lemma-slice}
after shrinking $U$ we may assume that
$Z = V(f_1, \ldots, f_d) \to \mathcal{X}$ is flat and
locally of finite presentation. Note that by construction
$F_Z = Z \times_\mathcal{X} u$ is a closed subspace of
$F = U \times_\mathcal{X} u$, that $e$ is a point of this closed subspace,
and that
$$
\dim(\mathcal{O}_{F_Z, \overline{e}}) = 0.
$$
By
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-dimension-fibre-at-a-point}
it follows that $\dim_e(F_Z) = 0$ because the transcendence degree
of $e$ relative to $u$ is zero. Hence it follows from
Lemma \ref{lemma-quasi-finite-at-point}
that after possibly shrinking $U$ the morphism $Z \to \mathcal{X}$
is locally quasi-finite.

\medskip\noindent
We conclude that for every finite type point $x$ of $\mathcal{X}$ there
exists a locally quasi-finite, flat, locally finitely presented
morphism $f_x : Z_x \to \mathcal{X}$ with $x$ in the image of $|f_x|$.
Set $W = \coprod_x Z_x$ and $f = \coprod f_x$. Then $f$ is flat, locally
of finite presentation, and locally quasi-finite. In particular the
image of $|f|$ is open, see
Properties of Stacks, Lemma \ref{stacks-properties-lemma-topology-points}.
By construction the image contains all finite type points of $\mathcal{X}$,
hence $f$ is surjective by
Lemma \ref{lemma-enough-finite-type-points} (and
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-characterize-surjective}).
\end{proof}

\begin{lemma}
\label{lemma-DM-residual-gerbe}
Let $\mathcal{Z}$ be a DM, locally Noetherian, reduced algebraic stack
with $|\mathcal{Z}|$ a singleton. Then there exists a field $k$ and
a surjective \'etale morphism $\Spec(k) \to \mathcal{Z}$.
\end{lemma}

\begin{proof}
By
Properties of Stacks, Lemma \ref{stacks-properties-lemma-unique-point-better}
there exists a field $k$ and a surjective, flat, locally finitely presented
morphism $\Spec(k) \to \mathcal{Z}$. Set $U = \Spec(k)$ and
$R = U \times_\mathcal{Z} U$ so we obtain a groupoid in algebraic spaces
$(U, R, s, t, c)$, see
Algebraic Stacks, Lemma
\ref{algebraic-lemma-criterion-map-representable-spaces-fibred-in-groupoids}.
Note that by
Algebraic Stacks, Remark \ref{algebraic-remark-flat-fp-presentation}
we have an equivalence
$$
f_{can} : [U/R] \longrightarrow \mathcal{Z}
$$
The projections $s, t : R \to U$ are locally of finite presentation.
As $\mathcal{Z}$ is DM we see that the stabilizer group algebraic space
$$
G = U \times_{U \times U} R = U \times_{U \times U} (U \times_\mathcal{Z} U) =
U \times_{\mathcal{X} \times \mathcal{X}, \Delta_\mathcal{X}} \mathcal{X}
$$
is unramified over $U$. In particular $\dim(G) = 0$ and by
More on Groupoids in Spaces, Lemma
\ref{spaces-more-groupoids-lemma-groupoid-on-field-dimension-equal-stabilizer}
we have $\dim(R) = 0$. This implies that $R$ is a scheme, see
Spaces over Fields, Lemma
\ref{spaces-over-fields-lemma-locally-finite-type-dim-zero}.
By
Varieties, Lemma \ref{varieties-lemma-algebraic-scheme-dim-0}
we see that $R$ (and also $G$) is the disjoint union of spectra of
Artinian local rings finite over $k$ via either $s$ or $t$. Let
$P = \Spec(A) \subset R$ be the open and
closed subscheme whose underlying point is the identity $e$ of the groupoid
scheme $(U, R, s, t, c)$. As
$s \circ e = t \circ e = \text{id}_{\Spec(k)}$ we see that $A$
is an Artinian local ring whose residue field is identified with $k$
via either $s^\sharp : k \to A$ or $t^\sharp : k \to A$.
Note that $s, t : \Spec(A) \to \Spec(k)$
are finite (by the lemma referenced above). Since
$G \to \Spec(k)$ is unramified we see that
$$
G \cap P = P \times_{U \times U} U = \Spec(A \otimes_{k \otimes k} k)
$$
is unramified over $k$. On the other hand $A \otimes_{k \otimes k} k$
is local as a quotient of $A$ and surjects onto $k$. We conclude that
$A \otimes_{k \otimes k} k = k$. It follows that $P \to U \times U$
is universally injective (as $P$ has only one point with residue field $k$,
unramified (by the computation of the fibre over the unique image point
above), and of finite type (because $s, t$ are) hence a monomorphism (see
\'Etale Morphisms, Lemma
\ref{etale-lemma-universally-injective-unramified}).
Thus $s|_P, t|_P : P \to U$ define a finite flat equivalence
relation. Thus we may apply
Groupoids, Proposition \ref{groupoids-proposition-finite-flat-equivalence}
to conclude that $U/P$ exists and is a scheme $\overline{U}$.
Moreover, $U \to \overline{U}$ is finite locally free and
$P = U \times_{\overline{U}} U$.
In fact $\overline{U} = \Spec(k_0)$ where $k_0 \subset k$ is the
ring of $R$-invariant functions. As $k$ is a field it follows
from the definition
Groupoids, Equation (\ref{groupoids-equation-invariants})
that $k_0$ is a field.

\medskip\noindent
We claim that
\begin{equation}
\label{equation-etale-covering}
\Spec(k_0) = \overline{U} = U/P \to [U/R] = \mathcal{Z}
\end{equation}
is the desired surjective \'etale morphism. It follows from
Properties of Stacks, Lemma \ref{stacks-properties-lemma-flat-cover-by-field}
that this morphism is surjective. Thus it suffices to show that
(\ref{equation-etale-covering}) is \'etale\footnote{We urge the
reader to find his/her own proof of this fact. In fact the argument
has a lot in common with the final argument of the proof of
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}
hence probably should be isolated into its own lemma somewhere.}.
Instead of proving the \'etaleness
directly we first apply
Bootstrap, Lemma \ref{bootstrap-lemma-divide-subgroupoid}
to see that there exists a groupoid scheme
$(\overline{U}, \overline{R}, \overline{s}, \overline{t}, \overline{c})$
such that $(U, R, s, t, c)$ is the restriction of
$(\overline{U}, \overline{R}, \overline{s}, \overline{t}, \overline{c})$
via the quotient morphism $U \to \overline{U}$.
(We verified all the hypothesis of the lemma above except for the assertion
that $j : R \to U \times U$ is separated and locally quasi-finite
which follows from the fact that $R$ is a separated scheme locally quasi-finite
over $k$.) Since $U \to \overline{U}$ is finite locally free
we see that $[U/R] \to [\overline{U}/\overline{R}]$ is an equivalence, see
Groupoids in Spaces,
Lemma \ref{spaces-groupoids-lemma-quotient-stack-restrict-equivalence}.

\medskip\noindent
Note that $s, t$ are the base changes of the morphisms
$\overline{s}, \overline{t}$ by $U \to \overline{U}$.
As $\{U \to \overline{U}\}$ is an fppf covering we conclude
$\overline{s}, \overline{t}$ are flat, locally of finite presentation, and
locally quasi-finite, see
Descent, Lemmas \ref{descent-lemma-descending-property-flat},
\ref{descent-lemma-descending-property-locally-finite-presentation}, and
\ref{descent-lemma-descending-property-quasi-finite}.
Consider the commutative diagram
$$
\xymatrix{
U \times_{\overline{U}} U \ar@{=}[r] \ar[rd] & P \ar[r] \ar[d] & R \ar[d] \\
& \overline{U} \ar[r]^{\overline{e}} & \overline{R}
}
$$
It is a general fact about restrictions that the outer four corners
form a cartesian diagram. By the equality we see the inner square is
cartesian. Since $P$ is open in $R$ we conclude that $\overline{e}$
is an open immersion by
Descent, Lemma \ref{descent-lemma-descending-property-open-immersion}.

\medskip\noindent
But of course, if $\overline{e}$ is an open immersion and
$\overline{s}, \overline{t}$ are flat and locally of finite presentation
then the morphisms $\overline{t}, \overline{s}$ are \'etale.
For example you can see this by applying
More on Groupoids, Lemma \ref{more-groupoids-lemma-sheaf-differentials}
which shows that $\Omega_{\overline{R}/\overline{U}} = 0$
implies that $\overline{s}, \overline{t} : \overline{R} \to \overline{U}$
is unramified (see
Morphisms, Lemma \ref{morphisms-lemma-unramified-omega-zero}),
which in turn implies that $\overline{s}, \overline{t}$ are \'etale
(see
Morphisms, Lemma \ref{morphisms-lemma-flat-unramified-etale}).
Hence $\mathcal{Z} = [\overline{U}/\overline{R}]$ is an \'etale
presentation of the algebraic stack $\mathcal{Z}$ and we conclude that
$\overline{U} \to \mathcal{Z}$ is \'etale by
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-check-property-covering}.
\end{proof}

\begin{lemma}
\label{lemma-etale-at-point}
Let $\mathcal{X}$ be an algebraic stack. Consider a cartesian diagram
$$
\xymatrix{
U \ar[d] & F \ar[l]^p \ar[d] \\
\mathcal{X} & \Spec(k) \ar[l]
}
$$
where $U$ is an algebraic space, $k$ is a field, and $U \to \mathcal{X}$
is flat and locally of finite presentation. Let $z \in |F|$ be such that
$F \to \Spec(k)$ is unramified at $z$. Then, after replacing $U$ by
an open subspace containing $p(z)$, the morphism
$$
U \longrightarrow \mathcal{X}
$$
is \'etale.
\end{lemma}

\begin{proof}
Since $f : U \to \mathcal{X}$ is flat and locally of finite presentation
there exists a maximal open $W(f) \subset U$ such that the restriction
$f|_{W(f)} : W(f) \to \mathcal{X}$ is \'etale, see
Properties of Stacks, Remark
\ref{stacks-properties-remark-local-source-apply}
(\ref{stacks-properties-item-etale}).
Hence all we need to do is prove that $p(z)$ is a point of $W(f)$.
Moreover, the remark referenced above also shows the formation of $W(f)$
commutes with arbitrary base change by a morphism which is representable
by algebraic spaces. Hence it suffices to show that the morphism
$F \to \Spec(k)$ is \'etale at $z$. Since it is flat and locally
of finite presentation as a base change of $U \to \mathcal{X}$ and since
$F \to \Spec(k)$ is unramified at $z$ by assumption, this follows
from
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-unramified-flat-lfp-etale}.
\end{proof}

\noindent
A DM stack is a Deligne-Mumford stack.

\begin{theorem}
\label{theorem-DM}
Let $\mathcal{X}$ be an algebraic stack. The following are equivalent
\begin{enumerate}
\item $\mathcal{X}$ is DM,
\item $\mathcal{X}$ is Deligne-Mumford, and
\item there exists a scheme $W$ and a surjective \'etale
morphism $W \to \mathcal{X}$.
\end{enumerate}
\end{theorem}

\begin{proof}
Recall that (3) is the definition of (2), see
Algebraic Stacks, Definition \ref{algebraic-definition-deligne-mumford}.
The implication (3) $\Rightarrow$ (1) is
Lemma \ref{lemma-properties-covering-imply-diagonal}.
Assume (1). Let $x \in |\mathcal{X}|$ be a finite type point.
We will produce a scheme over $\mathcal{X}$ which ``works'' in a
neighbourhood of $x$. At the end of the proof we will take the disjoint
union of all of these to conclude.

\medskip\noindent
By
Lemma \ref{lemma-point-finite-type-monomorphism}
the residual gerbe $\mathcal{Z}_x$ of $\mathcal{X}$ at $x$ exists and
$\mathcal{Z}_x \to \mathcal{X}$ is locally of finite type. By
Lemma \ref{lemma-separation-properties-residual-gerbe}
the algebraic stack $\mathcal{Z}_x$ is DM. By
Lemma \ref{lemma-DM-residual-gerbe}
there exists a field $k$ and a surjective \'etale morphism
$z : \Spec(k) \to \mathcal{Z}_x$.
In particular the composition $x : \Spec(k) \to \mathcal{X}$
is locally of finite type (by
Morphisms of Spaces, Lemmas
\ref{spaces-morphisms-lemma-composition-finite-type} and
\ref{spaces-morphisms-lemma-etale-locally-finite-type}).

\medskip\noindent
Pick a scheme $U$ and a smooth morphism $U \to \mathcal{X}$ such that
$x$ is in the image of $|U| \to |\mathcal{X}|$.
Consider the following fibre square
$$
\xymatrix{
U \ar[d] & F  \ar[l] \ar[d] \\
\mathcal{X} & \Spec(k) \ar[l]_-x
}
$$
in other words $F = U \times_{\mathcal{X}, x} \Spec(k)$. By
Properties of Stacks, Lemma \ref{stacks-properties-lemma-points-cartesian}
we see that $F$ is nonempty.
As $\mathcal{Z}_x \to \mathcal{X}$ is a monomorphism we have
$$
\Spec(k) \times_{z, \mathcal{Z}_x, z} \Spec(k)
=
\Spec(k) \times_{x, \mathcal{X}, x} \Spec(k)
$$
with \'etale projection maps to $\Spec(k)$ by construction of $z$.
Since
$$
F \times_U F =
(\Spec(k) \times_\mathcal{X} \Spec(k))
\times_{\Spec(k)} F
$$
we see that the projections maps $F \times_U F \to F$ are \'etale as well.
It follows that $\Delta_{F/U} : F \to F \times_U F$ is \'etale (see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-etale-permanence}).
By
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-etale-universally-injective-open}
this implies that $\Delta_{F/U}$ is an open immersion, which finally
implies by
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-diagonal-unramified-morphism}
that $F \to U$ is unramified.

\medskip\noindent
Pick a nonempty affine scheme $V$ and an \'etale morphism $V \to F$.
(This could be avoided by working directly with $F$, but it seems easier
to explain what's going on by doing so.) Picture
$$
\xymatrix{
U \ar[d] & F  \ar[l] \ar[d] & V \ar[l] \ar[ld] \\
\mathcal{X} & \Spec(k) \ar[l]_-x
}
$$
Then $V \to \Spec(k)$ is a smooth morphism of schemes and $V \to U$ is an
unramified morphism of schemes (see
Morphisms of Spaces, Lemmas
\ref{spaces-morphisms-lemma-composition-smooth} and
\ref{spaces-morphisms-lemma-composition-unramified}).
Pick a closed point $v \in V$ with $k \subset \kappa(v)$ finite separable, see
Varieties, Lemma \ref{varieties-lemma-smooth-separable-closed-points-dense}.
Let $u \in U$ be the image point. The local ring
$\mathcal{O}_{V, v}$ is regular (see
Varieties, Lemma \ref{varieties-lemma-smooth-regular})
and the local ring homomorphism
$$
\varphi : \mathcal{O}_{U, u} \longrightarrow \mathcal{O}_{V, v}
$$
coming from the morphism $V \to U$ is such that
$\varphi(\mathfrak m_u)\mathcal{O}_{V, v} = \mathfrak m_v$, see
Morphisms, Lemma \ref{morphisms-lemma-unramified-at-point}.
Hence we can find $f_1, \ldots, f_d \in \mathcal{O}_{U, u}$
such that the images $\varphi(f_1), \ldots, \varphi(f_d)$
form a basis for $\mathfrak m_v/\mathfrak m_v^2$ over $\kappa(v)$.
Since $\mathcal{O}_{V, v}$ is a regular local ring this implies
that $\varphi(f_1), \ldots, \varphi(f_d)$ form a regular sequence
in $\mathcal{O}_{V, v}$ (see
Algebra, Lemma \ref{algebra-lemma-regular-ring-CM}).
After replacing $U$ by an open neighbourhood of $u$ we may assume
$f_1, \ldots, f_d \in \Gamma(U, \mathcal{O}_U)$. After replacing
$U$ by a possibly even smaller open neighbourhood of $u$ we may
assume that $V(f_1, \ldots, f_d) \to \mathcal{X}$ is flat and
locally of finite presentation, see
Lemma \ref{lemma-slice}.
By construction
$$
V(f_1, \ldots, f_d) \times_\mathcal{X} \Spec(k)
\longleftarrow
V(f_1, \ldots, f_d) \times_\mathcal{X} V
$$
is \'etale and $V(f_1, \ldots, f_d) \times_\mathcal{X} V$
is the closed subscheme $T \subset V$ cut out by $f_1|_V, \ldots, f_d|_V$.
Hence by construction $v \in T$ and
$$
\mathcal{O}_{T, v} =
\mathcal{O}_{V, v}/(\varphi(f_1), \ldots, \varphi(f_d)) = \kappa(v)
$$
a finite separable extension of $k$. It follows that $T \to \Spec(k)$
is unramified at $v$, see
Morphisms, Lemma \ref{morphisms-lemma-unramified-at-point}.
By definition of an unramified morphism of algebraic spaces this means that
$V(f_1, \ldots, f_d) \times_\mathcal{X} \Spec(k) \to \Spec(k)$
is unramified at the image of $v$ in
$V(f_1, \ldots, f_d) \times_\mathcal{X} \Spec(k)$.
Applying
Lemma \ref{lemma-etale-at-point}
we see that on shrinking $U$ to yet another open neighbourhood of $u$
the morphism $V(f_1, \ldots, f_d) \to \mathcal{X}$ is \'etale.

\medskip\noindent
We conclude that for every finite type point $x$ of $\mathcal{X}$ there
exists an \'etale morphism $f_x : W_x \to \mathcal{X}$ with $x$ in the
image of $|f_x|$. Set $W = \coprod_x W_x$ and $f = \coprod f_x$. Then $f$
is \'etale. In particular the image of $|f|$ is open, see
Properties of Stacks, Lemma \ref{stacks-properties-lemma-topology-points}.
By construction the image contains all finite type points of $\mathcal{X}$,
hence $f$ is surjective by
Lemma \ref{lemma-enough-finite-type-points} (and
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-characterize-surjective}).
\end{proof}








\section{Quasi-finite morphisms}
\label{section-quasi-finite}

\noindent
The property ``locally quasi-finite'' of morphisms of algebraic spaces
is not smooth local on the source-and-target so we cannot use the material in
Section \ref{section-local-source-target}
to define locally quasi-finite morphisms of algebraic stacks.
We do already know what it means for a morphism of algebraic stacks
representable by algebraic spaces to be locally quasi-finite, see
Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}.
To find a condition suitable for general morphisms we make the following
observation.

\begin{lemma}
\label{lemma-representable-by-spaces-quasi-finite}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Assume $f$ is representable by algebraic spaces.
The following are equivalent
\begin{enumerate}
\item $f$ is locally quasi-finite, and
\item $f$ is locally of finite type and for every morphism
$\Spec(k) \to \mathcal{Y}$ where $k$ is a field the
space $|\Spec(k) \times_\mathcal{Y} \mathcal{X}|$ is discrete.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1). In this case the morphism of algebraic spaces
$\mathcal{X}_k \to \Spec(k)$ is locally quasi-finite as a base change
of $f$. Hence $|\mathcal{X}_k|$ is discrete by
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-locally-quasi-finite}.
Conversely, assume (2). Pick a surjective smooth morphism
$V \to \mathcal{Y}$ where $V$ is a scheme. It suffices to show that the
morphism of algebraic spaces $V \times_\mathcal{Y} \mathcal{X} \to V$
is locally quasi-finite, see
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-check-property-covering}.
The morphism $V \times_\mathcal{Y} \mathcal{X} \to V$ is locally of finite
type by assumption. For any morphism $\Spec(k) \to V$ where $k$ is a
field
$$
\Spec(k) \times_V (V \times_\mathcal{Y} \mathcal{X}) =
\Spec(k) \times_\mathcal{Y} \mathcal{X}
$$
has a discrete space of points by assumption. Hence we conclude that
$V \times_\mathcal{Y} \mathcal{X} \to V$ is locally quasi-finite by
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-locally-quasi-finite}.
\end{proof}

\noindent
A morphism of algebraic stacks which is representable by algebraic spaces
is quasi-DM, see
Lemma \ref{lemma-trivial-implications}.
Combined with the lemma above we see that the following definition
does not conflict with all of the already existing notion in the case
of morphisms representable by algebraic spaces.

\begin{definition}
\label{definition-quasi-finite}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
We say $f$ is {\it locally quasi-finite} if $f$ is quasi-DM, locally of
finite type, and for every morphism $\Spec(k) \to \mathcal{Y}$
where $k$ is a field the space $|\mathcal{X}_k|$ is discrete.
\end{definition}

\noindent
The condition that $f$ be quasi-DM is natural. For example, let $k$ be
a field and consider the morphism
$\pi : [\Spec(k)/\mathbf{G}_m] \to \Spec(k)$
which has singleton fibres and is locally of finite type. As we will see
later this morphism is smooth of relative dimension $-1$, and we'd
like our locally quasi-finite morphisms to have relative dimension $0$.
Also, note that the section $\Spec(k) \to [\Spec(k)/\mathbf{G}_m]$
does not have discrete fibres, hence is not locally quasi-finite, and we'd
like to have the following permanence property for locally quasi-finite
morphisms: If $f : \mathcal{X} \to \mathcal{X}'$ is a morphism of algebraic
stacks locally quasi-finite over the algebraic stack $\mathcal{Y}$, then
$f$ is locally quasi-finite (in fact something a bit stronger holds, see
Lemma \ref{lemma-quasi-finite-permanence}).

\medskip\noindent
Another justification for the definition above is
Lemma \ref{lemma-characterize-locally-quasi-finite}
below which characterizes being locally quasi-finite in terms of the
existence of suitable ``presentations'' or ``coverings'' of
$\mathcal{X}$ and $\mathcal{Y}$.

\begin{lemma}
\label{lemma-base-change-locally-quasi-finite}
A base change of a locally quasi-finite morphism is locally quasi-finite.
\end{lemma}

\begin{proof}
We have seen this for quasi-DM morphisms in
Lemma \ref{lemma-base-change-separated}
and for locally finite type morphisms in
Lemma \ref{lemma-base-change-finite-type}.
It is immediate that the condition on fibres is inherited by a base change.
\end{proof}

\begin{lemma}
\label{lemma-locally-quasi-finite-over-field}
Let $\mathcal{X} \to \Spec(k)$ be a locally quasi-finite morphism
where $\mathcal{X}$ is an algebraic stack and $k$ is a field.
Let $f : V \to \mathcal{X}$ be a locally quasi-finite morphism where
$V$ is a scheme. Then $V \to \Spec(k)$ is locally quasi-finite.
\end{lemma}

\begin{proof}
By
Lemma \ref{lemma-composition-finite-type}
we see that $V \to \Spec(k)$ is locally of finite type.
Assume, to get a contradiction, that $V \to \Spec(k)$ is not
locally quasi-finite. Then there exists a nontrivial specialization
$v \leadsto v'$ of points of $V$, see
Morphisms, Lemma \ref{morphisms-lemma-quasi-finite-at-point-characterize}.
In particular $\text{trdeg}_k(\kappa(v)) > \text{trdeg}_k(\kappa(v'))$, see
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-specialization}.
Because $|\mathcal{X}|$ is discrete we see that $|f|(v) = |f|(v')$.
Consider $R = V \times_\mathcal{X} V$. Then $R$ is an algebraic space
and the projections $s, t : R \to V$ are locally quasi-finite as base
changes of $V \to \mathcal{X}$ (which is representable by algebraic spaces
so this follows from the discussion in
Properties of Stacks, Section
\ref{stacks-properties-section-properties-morphisms}).
By
Properties of Stacks, Lemma \ref{stacks-properties-lemma-points-cartesian}
we see that there exists an $r \in |R|$ such that $s(r) = v$ and $t(r) = v'$.
By
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-compare-tr-deg}
we see that the transcendence degree of $v/k$ is equal to the
transcendence degree of $r/k$ is equal to the transcendence degree of
$v'/k$. This contradiction proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-composition-locally-quasi-finite}
A composition of a locally quasi-finite morphisms is locally quasi-finite.
\end{lemma}

\begin{proof}
We have seen this for quasi-DM morphisms in
Lemma \ref{lemma-composition-separated}
and for locally finite type morphisms in
Lemma \ref{lemma-composition-finite-type}.
Let $\mathcal{X} \to \mathcal{Y}$ and $\mathcal{Y} \to \mathcal{Z}$
be locally quasi-finite. Let $k$ be a field and let
$\Spec(k) \to \mathcal{Z}$ be a morphism.
It suffices to show that $|\mathcal{X}_k|$ is discrete. By
Lemma \ref{lemma-base-change-locally-quasi-finite}
the morphisms $\mathcal{X}_k \to \mathcal{Y}_k$
and $\mathcal{Y}_k \to \Spec(k)$ are locally quasi-finite.
In particular we see that $\mathcal{Y}_k$ is
a quasi-DM algebraic stack, see
Lemma \ref{lemma-separated-implies-morphism-separated}.
By
Theorem \ref{theorem-quasi-DM}
we can find a scheme $V$ and a surjective, flat, locally finitely presented,
locally quasi-finite morphism $V \to \mathcal{Y}_k$. By
Lemma \ref{lemma-locally-quasi-finite-over-field}
we see that $V$ is locally quasi-finite over $k$, in particular
$|V|$ is discrete. The morphism
$V \times_{\mathcal{Y}_k} \mathcal{X}_k \to \mathcal{X}_k$ is
surjective, flat, and locally of finite presentation hence
$|V \times_{\mathcal{Y}_k} \mathcal{X}_k| \to |\mathcal{X}_k|$
is surjective and open. Thus it suffices to show that
$|V \times_{\mathcal{Y}_k} \mathcal{X}_k|$ is discrete.
Note that $V$ is a disjoint union of spectra of Artinian local
$k$-algebras $A_i$ with residue fields $k_i$, see
Varieties, Lemma \ref{varieties-lemma-algebraic-scheme-dim-0}.
Thus it suffices to show that each
$$
|\Spec(A_i) \times_{\mathcal{Y}_k} \mathcal{X}_k| =
|\Spec(k_i) \times_{\mathcal{Y}_k} \mathcal{X}_k| =
|\Spec(k_i) \times_\mathcal{Y} \mathcal{X}|
$$
is discrete, which follows from the assumption that
$\mathcal{X} \to \mathcal{Y}$ is locally quasi-finite.
\end{proof}

\noindent
Before we characterize locally quasi-finite morphisms in terms of coverings
we do it for quasi-DM morphisms.

\begin{lemma}
\label{lemma-characterize-quasi-DM}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
The following are equivalent
\begin{enumerate}
\item $f$ is quasi-DM,
\item for any morphism $V \to \mathcal{Y}$ with $V$ an algebraic space
there exists a surjective, flat, locally finitely presented, locally
quasi-finite morphism $U \to \mathcal{X} \times_\mathcal{Y} V$ where
$U$ is an algebraic space, and
\item there exist algebraic spaces $U$, $V$ and a morphism
$V \to \mathcal{Y}$ which is surjective, flat, and
locally of finite presentation, and a morphism
$U \to \mathcal{X} \times_\mathcal{Y} V$ which is surjective, flat,
locally of finite presentation, and locally quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
The implication (2) $\Rightarrow$ (3) is immediate.

\medskip\noindent
Assume (1) and let $V \to \mathcal{Y}$ be as in (2). Then
$\mathcal{X} \times_\mathcal{Y} V \to V$ is quasi-DM, see
Lemma \ref{lemma-base-change-separated}.
By
Lemma \ref{lemma-trivial-implications}
the algebraic space $V$ is DM, hence quasi-DM. Thus
$\mathcal{X} \times_\mathcal{Y} V$ is quasi-DM by
Lemma \ref{lemma-separated-over-separated}.
Hence we may apply
Theorem \ref{theorem-quasi-DM}
to get the morphism $U \to \mathcal{X} \times_\mathcal{Y} V$
as in (2).

\medskip\noindent
Assume (3). Let $V \to \mathcal{Y}$ and
$U \to \mathcal{X} \times_\mathcal{Y} V$ be as in (3).
To prove that $f$ is quasi-DM it suffices to show that
$\mathcal{X} \times_\mathcal{Y} V \to V$ is quasi-DM, see
Lemma \ref{lemma-check-separated-covering}.
By
Lemma \ref{lemma-properties-covering-imply-diagonal}
we see that $\mathcal{X} \times_\mathcal{Y} V$ is quasi-DM.
Hence $\mathcal{X} \times_\mathcal{Y} V \to V$ is quasi-DM by
Lemma \ref{lemma-separated-implies-morphism-separated}
and (1) holds. This finishes the proof of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-characterize-locally-quasi-finite}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
The following are equivalent
\begin{enumerate}
\item $f$ is locally quasi-finite,
\item $f$ is quasi-DM and for any morphism $V \to \mathcal{Y}$ with $V$
an algebraic space and any locally quasi-finite morphism
$U \to \mathcal{X} \times_\mathcal{Y} V$ where $U$ is an algebraic space
the morphism $U \to V$ is locally quasi-finite,
\item for any morphism $V \to \mathcal{Y}$ from an algebraic space $V$
there exists a surjective, flat, locally finitely presented, and locally
quasi-finite morphism $U \to \mathcal{X} \times_\mathcal{Y} V$ where
$U$ is an algebraic space such that $U \to V$ is locally quasi-finite,
\item there exists algebraic spaces $U$, $V$, a surjective, flat,
and locally of finitely presented morphism $V \to \mathcal{Y}$,
and a morphism $U \to \mathcal{X} \times_\mathcal{Y} V$ which
is surjective, flat, locally of finite presentation, and
locally quasi-finite such that $U \to V$ is locally quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1). Then $f$ is quasi-DM by assumption. Let
$V \to \mathcal{Y}$ and $U \to \mathcal{X} \times_\mathcal{Y} V$
be as in (2). By
Lemma \ref{lemma-composition-locally-quasi-finite}
the composition $U \to \mathcal{X} \times_\mathcal{Y} V \to V$ is
locally quasi-finite. Thus (1) implies (2).

\medskip\noindent
Assume (2). Let $V \to \mathcal{Y}$ be as in (3). By
Lemma \ref{lemma-characterize-quasi-DM}
we can find an algebraic space $U$ and a surjective, flat, locally
finitely presented, locally quasi-finite morphism
$U \to \mathcal{X} \times_\mathcal{Y} V$. By (2) the composition
$U \to V$ is locally quasi-finite. Thus (2) implies (3).

\medskip\noindent
It is immediate that (3) implies (4).

\medskip\noindent
Assume (4). We will prove (1) holds, which finishes the proof. By
Lemma \ref{lemma-characterize-quasi-DM}
we see that $f$ is quasi-DM. To prove that $f$ is locally of finite type
it suffices to prove that $g : \mathcal{X} \times_\mathcal{Y} V \to V$ is
locally of finite type, see
Lemma \ref{lemma-check-finite-type-covering}.
Then it suffices to check that $g$ precomposed with
$h : U \to \mathcal{X} \times_\mathcal{Y} V$ is locally of finite type, see
Lemma \ref{lemma-check-finite-type-precompose}.
Since $g \circ h : U \to V$ was assumed to be locally quasi-finite
this holds, hence $f$ is locally of finite type.
Finally, let $k$ be a field and let $\Spec(k) \to \mathcal{Y}$
be a morphism. Then $V \times_\mathcal{Y} \Spec(k)$ is
a nonempty algebraic space which is locally of finite presentation
over $k$. Hence we can find a finite extension $k \subset k'$ and
a morphism $\Spec(k') \to V$ such that
$$
\xymatrix{
\Spec(k') \ar[r] \ar[d] & V \ar[d] \\
\Spec(k) \ar[r] & \mathcal{Y}
}
$$
commutes (details omitted). Then $\mathcal{X}_{k'} \to \mathcal{X}_k$
is representable (by schemes), surjective, and finite locally free. In
particular $|\mathcal{X}_{k'}| \to |\mathcal{X}_k|$ is surjective and open.
Thus it suffices to prove that $|\mathcal{X}_{k'}|$ is discrete. Since
$$
U \times_V \Spec(k') =
U \times_{\mathcal{X} \times_\mathcal{Y} V} \mathcal{X}_{k'}
$$
we see that $U \times_V \Spec(k') \to \mathcal{X}_{k'}$ is
surjective, flat, and locally of finite presentation (as a base change
of $U \to \mathcal{X} \times_\mathcal{Y} V$). Hence
$|U \times_V \Spec(k')| \to |\mathcal{X}_{k'}|$ is surjective and
open. Thus it suffices to show that $|U \times_V \Spec(k')|$ is
discrete. This follows from the fact that $U \to V$ is locally
quasi-finite (either by our definition above or from the original definition
for morphisms of algebraic spaces, via
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-locally-quasi-finite}).
\end{proof}

\begin{lemma}
\label{lemma-quasi-finite-permanence}
Let $\mathcal{X} \to \mathcal{Y} \to \mathcal{Z}$ be morphisms
of algebraic stacks. Assume that $\mathcal{X} \to \mathcal{Z}$
is locally quasi-finite and $\mathcal{Y} \to \mathcal{Z}$ is quasi-DM.
Then $\mathcal{X} \to \mathcal{Y}$ is locally quasi-finite.
\end{lemma}

\begin{proof}
Write $\mathcal{X} \to \mathcal{Y}$ as the composition
$$
\mathcal{X} \longrightarrow
\mathcal{X} \times_\mathcal{Z} \mathcal{Y} \longrightarrow
\mathcal{Y}
$$
The second arrow is locally quasi-finite as a base change of
$\mathcal{X} \to \mathcal{Z}$, see
Lemma \ref{lemma-base-change-locally-quasi-finite}.
The first arrow is locally quasi-finite by
Lemma \ref{lemma-semi-diagonal}
as $\mathcal{Y} \to \mathcal{Z}$ is quasi-DM.
Hence $\mathcal{X} \to \mathcal{Y}$ is locally quasi-finite by
Lemma \ref{lemma-composition-locally-quasi-finite}.
\end{proof}





















\section{Flat morphisms}
\label{section-flat}

\noindent
The property ``being flat'' of morphisms of algebraic
spaces is smooth local on the source-and-target, see
Descent on Spaces, Remark \ref{spaces-descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-base-change-flat}
and
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-descending-property-flat}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define what it means for a morphism of algebraic spaces
to be flat as follows and it agrees with the already
existing notion defined in
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}
when the morphism is representable by algebraic spaces.

\begin{definition}
\label{definition-flat}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
We say $f$ is {\it flat} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold with $\mathcal{P} = \text{flat}$.
\end{definition}

\begin{lemma}
\label{lemma-composition-flat}
The composition of flat morphisms is flat.
\end{lemma}

\begin{proof}
Combine
Remark \ref{remark-composition}
with
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-composition-flat}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-flat}
A base change of a flat morphism is flat.
\end{lemma}

\begin{proof}
Combine
Remark \ref{remark-base-change}
with
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-flat}.
\end{proof}

\begin{lemma}
\label{lemma-descent-flat}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Let $\mathcal{Z} \to \mathcal{Y}$ be a surjective flat morphism of algebraic
stacks. If the base change
$\mathcal{Z} \times_\mathcal{Y} \mathcal{X} \to \mathcal{Z}$
is flat, then $f$ is flat.
\end{lemma}

\begin{proof}
Choose an algebraic space $W$ and a surjective smooth morphism
$W \to \mathcal{Z}$. Then $W \to \mathcal{Z}$ is surjective and flat
(Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-smooth-flat})
hence $W \to \mathcal{Y}$ is surjective and flat (by
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-composition-surjective}
and
Lemma \ref{lemma-composition-flat}).
Since the base change of
$\mathcal{Z} \times_\mathcal{Y} \mathcal{X} \to \mathcal{Z}$
by $W \to \mathcal{Z}$ is a flat morphism
(Lemma \ref{lemma-base-change-flat})
we may replace $\mathcal{Z}$ by $W$.

\medskip\noindent
Choose an algebraic space $V$ and a surjective smooth morphism
$V \to \mathcal{Y}$. Choose an algebraic space $U$ and a surjective
smooth morphism $U \to V \times_\mathcal{Y} \mathcal{X}$.
We have to show that $U \to V$ is flat. Now we base change
everything by $W \to \mathcal{Y}$: Set $U' = W \times_\mathcal{Y} U$,
$V' = W \times_\mathcal{Y} V$,
$\mathcal{X}' = W \times_\mathcal{Y} \mathcal{X}$,
and $\mathcal{Y}' = W \times_\mathcal{Y} \mathcal{Y} = W$.
Then it is still true that $U' \to V' \times_{\mathcal{Y}'} \mathcal{X}'$
is smooth by base change. Hence by our definition of flat morphisms
of algebraic stacks and the assumption that $\mathcal{X}' \to \mathcal{Y}'$
is flat, we see that $U' \to V'$ is flat. Then, since
$V' \to V$ is surjective as a base change of $W \to \mathcal{Y}$ we see
that $U \to V$ is flat by
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-module-flat} (2)
and we win.
\end{proof}

\begin{lemma}
\label{lemma-flat-permanence}
Let $\mathcal{X} \to \mathcal{Y} \to \mathcal{Z}$ be morphisms of
algebraic stacks. If $\mathcal{X} \to \mathcal{Z}$ is flat
and $\mathcal{X} \to \mathcal{Y}$ is surjective and flat, then
$\mathcal{Y} \to \mathcal{Z}$ is flat.
\end{lemma}

\begin{proof}
Choose an algebraic space $W$ and a surjective smooth morphism
$W \to \mathcal{Z}$. Choose an algebraic space $V$ and a surjective smooth
morphism $V \to W \times_\mathcal{Z} \mathcal{Y}$. Choose an algebraic space
$U$ and a surjective smooth morphism $U \to V \times_\mathcal{Y} \mathcal{X}$.
We know that $U \to V$ is flat and that $U \to W$ is flat.
Also, as $\mathcal{X} \to \mathcal{Y}$ is surjective we see that
$U \to V$ is surjective (as a composition of surjective morphisms).
Hence the lemma reduces to the case of morphisms of algebraic spaces.
The case of morphisms of algebraic spaces is
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-flat-permanence}.
\end{proof}










\section{Morphisms of finite presentation}
\label{section-finite-presentation}

\noindent
The property ``locally of finite presentation'' of morphisms of algebraic
spaces is smooth local on the source-and-target, see
Descent on Spaces, Remark \ref{spaces-descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-base-change-finite-presentation}
and
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-descending-property-locally-finite-presentation}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define what it means for a morphism of algebraic spaces
to be locally of finite presentation as follows and it agrees with the already
existing notion defined in
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}
when the morphism is representable by algebraic spaces.

\begin{definition}
\label{definition-locally-finite-presentation}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
\begin{enumerate}
\item We say $f$
{\it locally of finite presentation} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold with
$\mathcal{P} = \text{locally of finite presentation}$.
\item We say $f$ is
{\it of finite presentation} if it is locally of finite presentation,
quasi-compact, and quasi-separated.
\end{enumerate}
\end{definition}

\noindent
Note that a morphism of finite presentation is {\bf not} just a quasi-compact
morphism which is locally of finite presentation.

\begin{lemma}
\label{lemma-composition-finite-presentation}
The composition of finitely presented morphisms is of finite presentation.
The same holds for morphisms which are locally of finite presentation.
\end{lemma}

\begin{proof}
Combine
Remark \ref{remark-composition}
with
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-composition-finite-presentation}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-finite-presentation}
A base change of a finitely presented morphism is of finite presentation.
The same holds for morphisms which are locally of finite presentation.
\end{lemma}

\begin{proof}
Combine
Remark \ref{remark-base-change}
with
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-finite-presentation}.
\end{proof}

\begin{lemma}
\label{lemma-finite-presentation-finite-type}
A morphism which is locally of finite presentation is locally of finite type.
A morphism of finite presentation is of finite type.
\end{lemma}

\begin{proof}
Combine
Remark \ref{remark-implication}
with
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-finite-presentation-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-finite-presentation-permanence}
Let $f : \mathcal{X} \to \mathcal{Y}$ and
$g : \mathcal{Y} \to \mathcal{Z}$ be morphisms of algebraic stacks
If $g \circ f$ is locally of finite presentation and $g$ is locally of
finite type, then $f$ is locally of finite presentation.
\end{lemma}

\begin{proof}
Choose an algebraic space $W$ and a surjective smooth morphism
$W \to \mathcal{Z}$.
Choose an algebraic space $V$ and a surjective smooth morphism
$V \to \mathcal{Y} \times_\mathcal{Z} W$.
Choose an algebraic space $U$ and a surjective smooth morphism
$U \to \mathcal{X} \times_\mathcal{Y} V$.
The lemma follows upon applying
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-finite-presentation-permanence}
to the morphisms $U \to V \to W$.
\end{proof}

\begin{lemma}
\label{lemma-open-immersion-locally-finite-presentation}
An open immersion is locally of finite presentation.
\end{lemma}

\begin{proof}
Follows from
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-open-immersion-locally-finite-presentation}.
\end{proof}

\begin{lemma}
\label{lemma-descent-finite-presentation}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Let $\mathcal{Z} \to \mathcal{Y}$ be a surjective, flat, locally finitely
presented morphism of algebraic stacks. If the base change
$\mathcal{Z} \times_\mathcal{Y} \mathcal{X} \to \mathcal{Z}$
is locally of finite presentation, then $f$ is locally of finite
presentation.
\end{lemma}

\begin{proof}
Choose an algebraic space $W$ and a surjective smooth morphism
$W \to \mathcal{Z}$. Then $W \to \mathcal{Z}$ is surjective, flat,
and locally of finite presentation
(Morphisms of Spaces, Lemmas
\ref{spaces-morphisms-lemma-smooth-flat} and
\ref{spaces-morphisms-lemma-smooth-locally-finite-presentation})
hence $W \to \mathcal{Y}$ is surjective, flat, and locally of finite
presentation (by
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-composition-surjective}
and
Lemmas \ref{lemma-composition-flat} and
\ref{lemma-composition-finite-presentation}).
Since the base change of
$\mathcal{Z} \times_\mathcal{Y} \mathcal{X} \to \mathcal{Z}$
by $W \to \mathcal{Z}$ is
locally of finite presentation
(Lemma \ref{lemma-base-change-flat})
we may replace $\mathcal{Z}$ by $W$.

\medskip\noindent
Choose an algebraic space $V$ and a surjective smooth morphism
$V \to \mathcal{Y}$. Choose an algebraic space $U$ and a surjective
smooth morphism $U \to V \times_\mathcal{Y} \mathcal{X}$.
We have to show that $U \to V$ is locally of finite presentation.
Now we base change everything by $W \to \mathcal{Y}$: Set
$U' = W \times_\mathcal{Y} U$,
$V' = W \times_\mathcal{Y} V$,
$\mathcal{X}' = W \times_\mathcal{Y} \mathcal{X}$,
and $\mathcal{Y}' = W \times_\mathcal{Y} \mathcal{Y} = W$.
Then it is still true that $U' \to V' \times_{\mathcal{Y}'} \mathcal{X}'$
is smooth by base change. Hence by our definition of locally finitely
presented morphisms of algebraic stacks and the assumption that
$\mathcal{X}' \to \mathcal{Y}'$ is locally of finite presentation,
we see that $U' \to V'$ is locally of finite presentation. Then, since
$V' \to V$ is surjective, flat, and locally of finite presentation
as a base change of $W \to \mathcal{Y}$ we see that $U \to V$ is
locally of finite presentation by
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-descending-property-locally-finite-presentation}
and we win.
\end{proof}

\begin{lemma}
\label{lemma-flat-finite-presentation-permanence}
Let $\mathcal{X} \to \mathcal{Y} \to \mathcal{Z}$ be morphisms of
algebraic stacks. If $\mathcal{X} \to \mathcal{Z}$ is locally of finite
presentation and $\mathcal{X} \to \mathcal{Y}$ is surjective, flat, and
locally of finite presentation, then $\mathcal{Y} \to \mathcal{Z}$
is locally of finite presentation.
\end{lemma}

\begin{proof}
Choose an algebraic space $W$ and a surjective smooth morphism
$W \to \mathcal{Z}$. Choose an algebraic space $V$ and a surjective smooth
morphism $V \to W \times_\mathcal{Z} \mathcal{Y}$. Choose an algebraic space
$U$ and a surjective smooth morphism $U \to V \times_\mathcal{Y} \mathcal{X}$.
We know that $U \to V$ is flat and locally of finite presentation
and that $U \to W$ is locally of finite presentation.
Also, as $\mathcal{X} \to \mathcal{Y}$ is surjective we see that
$U \to V$ is surjective (as a composition of surjective morphisms).
Hence the lemma reduces to the case of morphisms of algebraic spaces.
The case of morphisms of algebraic spaces is
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-locally-finite-presentation-fppf-local-source}.
\end{proof}

\begin{lemma}
\label{lemma-surjective-flat-locally-finite-presentation}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks
which is surjective, flat, and locally of finite presentation.
Then for every scheme $U$ and object $y$ of $\mathcal{Y}$ over $U$
there exists an fppf covering $\{U_i \to U\}$ and objects $x_i$
of $\mathcal{X}$ over $U_i$ such that $f(x_i) \cong y|_{U_i}$ in
$\mathcal{Y}_{U_i}$.
\end{lemma}

\begin{proof}
We may think of $y$ as a morphism $U \to \mathcal{Y}$. By
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-base-change-surjective}
and
Lemmas \ref{lemma-base-change-finite-presentation} and
\ref{lemma-base-change-flat}
we see that $\mathcal{X} \times_\mathcal{Y} U \to U$ is surjective, flat,
and locally of finite presentation. Let $V$ be a scheme and let
$V \to \mathcal{X} \times_\mathcal{Y} U$ smooth and surjective.
Then $V \to \mathcal{X} \times_\mathcal{Y} U$ is also surjective, flat, and
locally of finite presentation (see
Morphisms of Spaces, Lemmas
\ref{spaces-morphisms-lemma-smooth-flat} and
\ref{spaces-morphisms-lemma-smooth-locally-finite-presentation}).
Hence also $V \to U$ is surjective, flat, and
locally of finite presentation, see
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-composition-surjective}
and
Lemmas \ref{lemma-composition-finite-presentation}, and
\ref{lemma-composition-flat}.
Hence $\{V \to U\}$ is the desired fppf covering and $x : V \to \mathcal{X}$
is the desired object.
\end{proof}

\begin{lemma}
\label{lemma-surjective-family-flat-locally-finite-presentation}
Let $f_j : \mathcal{X}_j \to \mathcal{X}$, $j \in J$ be a family of morphisms
of algebraic stacks which are each flat and locally of finite presentation
and which are jointly surjective, i.e.,
$|\mathcal{X}| = \bigcup |\mathcal{X}_i|$.
Then for every scheme $U$ and object $x$ of $\mathcal{X}$ over $U$
there exists an fppf covering $\{U_i \to U\}_{i \in I}$, a map
$a : I \to J$, and objects $x_i$ of $\mathcal{X}_{a(i)}$ over $U_i$
such that $f_{a(i)}(x_i) \cong y|_{U_i}$ in $\mathcal{X}_{U_i}$.
\end{lemma}

\begin{proof}
Apply
Lemma \ref{lemma-surjective-flat-locally-finite-presentation}
to the morphism $\coprod_{j \in J} \mathcal{X}_j \to \mathcal{X}$.
(There is a slight set theoretic issue here -- due to our setup of
things -- which we ignore.) To finish, note that a morphism
$x_i : U_i \to \coprod_{j \in J} \mathcal{X}_j$ is given by a
disjoint union decomposition $U_i = \coprod U_{i, j}$ and morphisms
$U_{i, j} \to \mathcal{X}_j$. Then the fppf covering $\{U_{i, j} \to U\}$
and the morphisms $U_{i, j} \to \mathcal{X}_j$ do the job.
\end{proof}

\begin{lemma}
\label{lemma-fppf-open}
Let $f : \mathcal{X} \to \mathcal{Y}$ be flat and locally of finite
presentation. Then $|f| : |\mathcal{X}| \to |\mathcal{Y}|$ is open.
\end{lemma}

\begin{proof}
Choose a scheme $V$ and a smooth surjective morphism $V \to \mathcal{Y}$.
Choose a scheme $U$ and a smooth surjective morphism
$U \to V \times_\mathcal{Y} \mathcal{X}$. By assumption the morphism
of schemes $U \to V$ is flat and locally of finite presentation.
Hence $U \to V$ is open by
Morphisms, Lemma \ref{morphisms-lemma-fppf-open}.
By construction of the topology on $|\mathcal{Y}|$ the map
$|V| \to |\mathcal{Y}|$ is open.
The map $|U| \to |\mathcal{X}|$ is surjective.
The result follows from these facts by elementary topology.
\end{proof}















\section{Gerbes}
\label{section-gerbes}

\noindent
An important type of algebraic stack are the stacks of the
form $[B/G]$ where $B$ is an algebraic space and $G$ is a flat
and locally finitely presented group algebraic space over $B$
(acting trivially on $B$), see
Criteria for Representability, Lemma \ref{criteria-lemma-BG-algebraic}.
It turns out that an algebraic stack is a gerbe when it locally in the
fppf topology is of this form, see
Lemma \ref{lemma-gerbe-fppf}.
In this section we briefly discuss this notion and the corresponding
relative notion.

\begin{definition}
\label{definition-gerbe}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
We say $\mathcal{X}$ is a {\it gerbe over} $\mathcal{Y}$ if
$\mathcal{X}$ is a gerbe over $\mathcal{Y}$ as stacks
in groupoids over $(\Sch/S)_{fppf}$, see
Stacks, Definition \ref{stacks-definition-gerbe-over-stack-in-groupoids}.
We say an algebraic stack $\mathcal{X}$ is a {\it gerbe} if there exists
a morphism $\mathcal{X} \to X$ where $X$ is an algebraic space which
turns $\mathcal{X}$ into a gerbe over $X$.
\end{definition}

\noindent
The condition that $\mathcal{X}$ be a gerbe over $\mathcal{Y}$ is defined
purely in terms of the topology and category theory underlying the given
algebraic stacks; but as we will see later this condition has
geometric consequences. For example it implies that
$\mathcal{X} \to \mathcal{Y}$ is surjective, flat, and
locally of finite presentation, see
Lemma \ref{lemma-local-structure-gerbe}.
The absolute notion is trickier to parse, because it
may not be at first clear that $X$ is well determined. Actually, it is.

\begin{lemma}
\label{lemma-gerbe-over-iso-classes}
Let $\mathcal{X}$ be an algebraic stack. If $\mathcal{X}$ is a gerbe, then
the sheafification of the presheaf
$$
(\Sch/S)_{fppf}^{opp} \to \textit{Sets}, \quad
U \mapsto \Ob(\mathcal{X}_U)/\!\!\cong
$$
is an algebraic space and $\mathcal{X}$ is a gerbe over it.
\end{lemma}

\begin{proof}
(In this proof the abuse of language introduced in
Section \ref{section-conventions}
really pays off.)
Choose a morphism $\pi : \mathcal{X} \to X$ where $X$ is an
algebraic space which turns $\mathcal{X}$ into a gerbe over $X$.
It suffices to prove that $X$ is the sheafification of the presheaf
$\mathcal{F}$ displayed in the lemma.
It is clear that there is a map $c : \mathcal{F} \to X$.
We will use
Stacks, Lemma \ref{stacks-lemma-when-gerbe}
properties (2)(a) and (2)(b) to see that the map $c^\# : \mathcal{F}^\# \to X$
is surjective and injective, hence an isomorphism, see
Sites, Lemma \ref{sites-lemma-mono-epi-sheaves}.
Surjective: Let $T$ be a scheme and let $f : T \to X$. By property (2)(a)
there exists an fppf covering $\{h_i : T_i \to T\}$ and morphisms
$x_i : T_i \to \mathcal{X}$ such that $f \circ h_i$ corresponds to
$\pi \circ x_i$. Hence we see that $f|_{T_i}$ is in the image of $c$.
Injective: Let $T$ be a scheme and let $x, y : T \to \mathcal{X}$
be morphisms such that $c \circ x = c \circ y$.
By (2)(b) we can find a covering $\{T_i \to T\}$ and morphisms
$x|_{T_i} \to y|_{T_i}$ in the fibre category $\mathcal{X}_{T_i}$.
Hence the restrictions $x|_{T_i}, y|_{T_i}$ are equal in
$\mathcal{F}(T_i)$. This proves that $x, y$ give the same section
of $\mathcal{F}^\#$ over $T$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-base-change-gerbe}
Let
$$
\xymatrix{
\mathcal{X}' \ar[r] \ar[d] & \mathcal{X} \ar[d] \\
\mathcal{Y}' \ar[r] & \mathcal{Y}
}
$$
be a fibre product of algebraic stacks.
If $\mathcal{X}$ is a gerbe over $\mathcal{Y}$, then
$\mathcal{X}'$ is a gerbe over $\mathcal{Y}'$.
\end{lemma}

\begin{proof}
Immediate from the definitions and
Stacks, Lemma \ref{stacks-lemma-base-change-gerbe}.
\end{proof}

\begin{lemma}
\label{lemma-composition-gerbe}
Let $\mathcal{X} \to \mathcal{Y}$ and $\mathcal{Y} \to \mathcal{Z}$
be morphisms of algebraic stacks. If $\mathcal{X}$ is a gerbe over
$\mathcal{Y}$ and $\mathcal{Y}$ is a gerbe over $\mathcal{Z}$, then
$\mathcal{X}$ is a gerbe over $\mathcal{Z}$.
\end{lemma}

\begin{proof}
Immediate from
Stacks, Lemma \ref{stacks-lemma-composition-gerbe}.
\end{proof}

\begin{lemma}
\label{lemma-gerbe-descent}
Let
$$
\xymatrix{
\mathcal{X}' \ar[r] \ar[d] & \mathcal{X} \ar[d] \\
\mathcal{Y}' \ar[r] & \mathcal{Y}
}
$$
be a fibre product of algebraic stacks.
If $\mathcal{Y}' \to \mathcal{Y}$ is surjective, flat, and locally
of finite presentation and $\mathcal{X}'$ is a gerbe over $\mathcal{Y}'$,
then $\mathcal{X}$ is a gerbe over $\mathcal{Y}$.
\end{lemma}

\begin{proof}
Follows immediately from
Lemma \ref{lemma-surjective-flat-locally-finite-presentation}
and
Stacks, Lemma \ref{stacks-lemma-gerbe-descent}.
\end{proof}

\begin{lemma}
\label{lemma-gerbe-with-section}
Let $\pi : \mathcal{X} \to U$ be a morphism from an algebraic stack to
an algebraic space and let $x : U \to \mathcal{X}$ be a section of $\pi$.
Set $G = \mathit{Isom}_\mathcal{X}(x, x)$, see
Definition \ref{definition-isom}.
If $\mathcal{X}$ is a gerbe over $U$, then
\begin{enumerate}
\item there is a canonical equivalence of stacks in groupoids
$$
x_{can} : [U/G] \longrightarrow \mathcal{X}.
$$
where $[U/G]$ is the quotient stack for the trivial
action of $G$ on $U$,
\item $G \to U$ is flat and locally of finite presentation, and
\item $U \to \mathcal{X}$ is surjective, flat, and locally of finite
presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
Set $R = U \times_{x, \mathcal{X}, x} U$. The morphism $R \to U \times U$
factors through the diagonal $\Delta_U : U \to U \times U$ as it factors
through $U \times_U U = U$. Hence $R = G$ because
\begin{align*}
G & = \mathit{Isom}_\mathcal{X}(x, x) \\
& = U \times_{x, \mathcal{X}} \mathcal{I}_\mathcal{X} \\
& = U \times_{x, \mathcal{X}}
(\mathcal{X}
\times_{\Delta, \mathcal{X} \times_S \mathcal{X}, \Delta}
\mathcal{X}) \\
& = (U \times_{x, \mathcal{X}, x} U) \times_{U \times U, \Delta_U} U \\
& = R \times_{U \times U, \Delta_U} U \\
& = R
\end{align*}
for the fourth equality use
Categories, Lemma \ref{categories-lemma-diagonal-2}.
Let $t, s : R \to U$ be the projections.
The composition law $c : R \times_{s, U, t} R \to R$ constructed on $R$ in
Algebraic Stacks, Lemma \ref{algebraic-lemma-map-space-into-stack}
agrees with the group law on $G$ (proof omitted). Thus
Algebraic Stacks, Lemma \ref{algebraic-lemma-map-space-into-stack}
shows we obtain a canonical fully faithful $1$-morphism
$$
x_{can} : [U/G] \longrightarrow \mathcal{X}
$$
of stacks in groupoids over $(\Sch/S)_{fppf}$. To see that it is
an equivalence it suffices to show that it is essentially surjective.
To do this it suffices to show that any object of $\mathcal{X}$ over
a scheme $T$ comes fppf locally from $x$ via a morphism $T \to U$, see
Stacks, Lemma \ref{stacks-lemma-characterize-essentially-surjective-when-ff}.
However, this follows the condition that $\pi$ turns $\mathcal{X}$
into a gerbe over $X$, see property (2)(a) of
Stacks, Lemma \ref{stacks-lemma-when-gerbe}.

\medskip\noindent
By
Criteria for Representability, Lemma \ref{criteria-lemma-BG-algebraic}
we conclude that $G \to U$ is flat and locally of finite presentation.
Finally, $U \to \mathcal{X}$ is surjective, flat, and locally of finite
presentation by
Criteria for Representability, Lemma
\ref{criteria-lemma-flat-quotient-flat-presentation}.
\end{proof}

\begin{lemma}
\label{lemma-local-structure-gerbe}
Let $\pi : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
The following are equivalent
\begin{enumerate}
\item $\mathcal{X}$ is a gerbe over $\mathcal{Y}$, and
\item there exists an algebraic space $U$, a group algebraic space $G$
flat and locally of finite presentation over $U$, and a
surjective, flat, and locally finitely presented
morphism $U \to \mathcal{Y}$ such that
$\mathcal{X} \times_\mathcal{Y} U \cong [U/G]$ over $U$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (2). By
Lemma \ref{lemma-gerbe-descent}
to prove (1) it suffices to show that $[U/G]$ is a gerbe over $U$.
This is immediate from
Groupoids in Spaces, Lemma \ref{spaces-groupoids-lemma-group-quotient-gerbe}.

\medskip\noindent
Assume (1). Any base change of $\pi$ is a gerbe, see
Lemma \ref{lemma-base-change-gerbe}.
As a first step we choose a scheme $V$ and a surjective smooth morphism
$V \to \mathcal{Y}$. Thus we may assume that $\pi : \mathcal{X} \to V$
is a gerbe over a scheme. This means that there exists an
fppf covering $\{V_i \to V\}$ such that the fibre category
$\mathcal{X}_{V_i}$ is nonempty, see
Stacks, Lemma \ref{stacks-lemma-when-gerbe} (2)(a).
Note that $U = \coprod V_i \to U$ is surjective, flat, and
locally of finite presentation. Hence we may replace $V$ by $U$ and
assume that $\pi : \mathcal{X} \to U$ is a gerbe over a scheme $U$ and
that there exists an object $x$ of $\mathcal{X}$ over $U$. By
Lemma \ref{lemma-gerbe-with-section}
we see that $\mathcal{X} = [U/G]$ over $U$ for some flat
and locally finitely presented group algebraic space $G$ over $U$.
\end{proof}

\begin{lemma}
\label{lemma-gerbe-fppf}
Let $\pi : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
If $\mathcal{X}$ is a gerbe over $\mathcal{Y}$, then $\pi$ is surjective,
flat, and locally of finite presentation.
\end{lemma}

\begin{proof}
By
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-descent-surjective}
and
Lemmas \ref{lemma-descent-flat} and
\ref{lemma-descent-finite-presentation}
it suffices to prove to the lemma after replacing $\pi$ by a base change
with a surjective, flat, locally finitely presented morphism
$\mathcal{Y}' \to \mathcal{Y}$. By
Lemma \ref{lemma-local-structure-gerbe}
we may assume $\mathcal{Y} = U$ is an algebraic space and
$\mathcal{X} = [U/G]$ over $U$.
Then $U \to [U/G]$ is surjective, flat, and
locally of finite presentation, see
Lemma \ref{lemma-gerbe-with-section}.
This implies that $\pi$ is surjective, flat, and locally
of finite presentation by
Properties of Stacks,
Lemma \ref{stacks-properties-lemma-surjective-permanence}
and
Lemmas \ref{lemma-flat-permanence} and
\ref{lemma-flat-finite-presentation-permanence}.
\end{proof}

\begin{proposition}
\label{proposition-when-gerbe}
Let $\mathcal{X}$ be an algebraic stack. The following are equivalent
\begin{enumerate}
\item $\mathcal{X}$ is a gerbe, and
\item $\mathcal{I}_\mathcal{X} \to \mathcal{X}$ is flat and locally of
finite presentation.
\end{enumerate}
\end{proposition}

\begin{proof}
Assume (1). Choose a morphism $\mathcal{X} \to X$ into an algebraic space $X$
which turns $\mathcal{X}$ into a gerbe over $X$. Let $X' \to X$ is a
surjective, flat, locally finitely presented morphism and
set $\mathcal{X}' = X' \times_X \mathcal{X}$. Note that $\mathcal{X}'$
is a gerbe over $X'$ by
Lemma \ref{lemma-base-change-gerbe}.
Then both squares in
$$
\xymatrix{
\mathcal{I}_{\mathcal{X}'} \ar[r] \ar[d] &
\mathcal{X}' \ar[r] \ar[d] & X' \ar[d] \\
\mathcal{I}_\mathcal{X} \ar[r] &
\mathcal{X} \ar[r] & X
}
$$
are fibre product squares, see
Lemma \ref{lemma-cartesian-square-inertia}.
Hence to prove $\mathcal{I}_\mathcal{X} \to \mathcal{X}$ is flat and
locally of finite presentation it suffices to do so after such a base
change by
Lemmas \ref{lemma-descent-flat} and
\ref{lemma-descent-finite-presentation}.
Thus we can apply
Lemma \ref{lemma-local-structure-gerbe}
to assume that $\mathcal{X} = [U/G]$.
By
Lemma \ref{lemma-gerbe-with-section}
we see $G$ is flat and locally of finite presentation over $U$ and
that $x : U \to [U/G]$ is surjective, flat, and locally of finite
presentation. Moreover, the pullback of $\mathcal{I}_\mathcal{X}$
by $x$ is $G$ and we conclude that (2) holds by descent again, i.e., by
Lemmas \ref{lemma-descent-flat} and
\ref{lemma-descent-finite-presentation}.

\medskip\noindent
Conversely, assume (2). Choose a smooth presentation $\mathcal{X} = [U/R]$, see
Algebraic Stacks, Section \ref{algebraic-section-stack-to-presentation}.
Denote $G \to U$ the stabilizer group algebraic space of the groupoid
$(U, R, s, t, c, e, i)$, see
Groupoids in Spaces, Definition
\ref{spaces-groupoids-definition-stabilizer-groupoid}.
By
Lemma \ref{lemma-presentation-inertia}
we see that $G \to U$ is flat and locally of finite presentation as
a base change of $\mathcal{I}_\mathcal{X} \to \mathcal{X}$, see
Lemmas \ref{lemma-base-change-flat} and
\ref{lemma-base-change-finite-presentation}.
Consider the following action
$$
a : G \times_{U, t} R \to R, \quad (g, r) \mapsto c(g, r)
$$
of $G$ on $R$. This action is free on $T$-valued points for any
scheme $T$ as $R$ is a groupoid. Hence $R' = R/G$ is an algebraic
space and the quotient morphism $\pi : R \to R'$ is surjective,
flat, and locally of finite presentation by
Bootstrap, Lemma \ref{bootstrap-lemma-quotient-free-action}.
The projections $s, t : R \to U$ are $G$-invariant, hence
we obtain morphisms $s' , t' : R' \to U$ such that $s = s' \circ \pi$
and $t = t' \circ \pi$.
Since $s, t : R \to U$ are flat and locally of finite presentation
we conclude that $s', t'$ are flat and locally of finite presentation, see
Morphisms of Spaces, Lemmas
\ref{spaces-morphisms-lemma-flat-permanence} and
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-locally-finite-presentation-fppf-local-source}.
Consider the morphism
$$
j' = (t', s') : R' \longrightarrow U \times U.
$$
We claim this is a monomorphism. Namely, suppose that $T$ is a scheme
and that $a, b : T \to R'$ are morphisms which have the same image
in $U \times U$. By definition of the quotient $R' = R/G$ there
exists an fppf covering $\{h_j : T_j \to T\}$ such
that $a \circ h_j = \pi \circ a_j$ and $b \circ h_j = \pi \circ b_j$
for some morphisms $a_j, b_j : T_j \to R$. Since $a_j, b_j$ have the same
image in $U \times U$ we see that $g_j = c(a_j, i(b_j))$ is a $T_j$-valued
point of $G$ such that $c(g_j, b_j) = a_j$. In other words, $a_j$ and
$b_j$ have the same image in $R'$ and the claim is proved.
Since $j : R \to U \times U$ is a pre-equivalence relation (see
Groupoids in Spaces, Lemma
\ref{spaces-groupoids-lemma-groupoid-pre-equivalence})
and $R \to R'$ is surjective (as a map of sheaves) we see that
$j' : R' \to U \times U$ is an equivalence relation.
Hence
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}
shows that $X = U/R'$ is an algebraic space.
Finally, we claim that the morphism
$$
\mathcal{X} = [U/R] \longrightarrow X = U/R'
$$
turns $\mathcal{X}$ into a gerbe over $X$. This follows from
Groupoids in Spaces, Lemma \ref{spaces-groupoids-lemma-when-gerbe}
as $R \to R'$ is surjective, flat, and locally of finite presentation
(if needed use
Bootstrap, Lemma
\ref{bootstrap-lemma-surjective-flat-locally-finite-presentation}
to see this implies the required hypothesis).
\end{proof}

\noindent
At this point we have developed enough machinery to prove that residual
gerbes (when they exist) are gerbes.

\begin{lemma}
\label{lemma-noetherian-singleton-stack-gerbe}
Let $\mathcal{Z}$ be a reduced, locally Noetherian algebraic stack
such that $|\mathcal{Z}|$ is a singleton. Then $\mathcal{Z}$ is a gerbe
over a reduced, locally Noetherian algebraic space $Z$ with $|Z|$ a
singleton.
\end{lemma}

\begin{proof}
By
Properties of Stacks, Lemma \ref{stacks-properties-lemma-unique-point-better}
there exists a surjective, flat, locally finitely presented morphism
$\Spec(k) \to \mathcal{Z}$ where $k$ is a field.
Then $\mathcal{I}_Z \times_\mathcal{Z} \Spec(k) \to \Spec(k)$
is representable by algebraic spaces and
locally of finite type (as a base change of
$\mathcal{I}_\mathcal{Z} \to \mathcal{Z}$, see
Lemmas \ref{lemma-inertia} and \ref{lemma-base-change-finite-type}).
Therefore it is locally of finite presentation, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-noetherian-finite-type-finite-presentation}.
Of course it is also flat as $k$ is a field. Hence we may apply
Lemmas \ref{lemma-descent-flat} and
\ref{lemma-descent-finite-presentation}
to see that $\mathcal{I}_\mathcal{Z} \to \mathcal{Z}$ is flat and
locally of finite presentation. We conclude that $\mathcal{Z}$
is a gerbe by
Proposition \ref{proposition-when-gerbe}.
Let $\pi : \mathcal{Z} \to Z$ be a morphism to an algebraic space such
that $\mathcal{Z}$ is a gerbe over $Z$. Then $\pi$ is surjective, flat, and
locally of finite presentation by
Lemma \ref{lemma-gerbe-fppf}.
Hence $\Spec(k) \to Z$ is surjective, flat, and locally of finite
presentation as a composition, see
Properties of Stacks,
Lemma \ref{stacks-properties-lemma-composition-surjective}
and
Lemmas \ref{lemma-composition-flat} and
\ref{lemma-composition-finite-presentation}.
Hence by
Properties of Stacks, Lemma \ref{stacks-properties-lemma-unique-point-better}
we see that $|Z|$ is a singleton and that $Z$ is locally Noetherian
and reduced.
\end{proof}

\begin{lemma}
\label{lemma-gerbe-bijection-points}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
If $\mathcal{X}$ is a gerbe over $\mathcal{Y}$ then the map
$|\mathcal{X}| \to |\mathcal{Y}|$ is a homeomorphism of topological spaces.
\end{lemma}

\begin{proof}
Let $k$ be a field and let $y$ be an object
of $\mathcal{Y}$ over $\Spec(k)$. By
Stacks, Lemma \ref{stacks-lemma-when-gerbe} property (2)(a)
there exists an fppf covering $\{T_i \to \Spec(k)\}$
and objects $x_i$ of $\mathcal{X}$ over $T_i$ with $f(x_i) \cong y|_{T_i}$.
Choose an $i$ such that $T_i \not = \emptyset$. Choose a
morphism $\Spec(K) \to T_i$ for some field $K$.
Then $k \subset K$ and $x_i|_K$ is an object of $\mathcal{X}$ lying
over $y|_K$. Thus we see that
$|\mathcal{Y}| \to |\mathcal{X}|$. is surjective. The map
$|\mathcal{Y}| \to |\mathcal{X}|$ is also injective. Namely, if
$x, x'$ are objects of $\mathcal{X}$ over $\Spec(k)$ whose images
$f(x), f(x')$ become isomorphic (over an extension) in $\mathcal{Y}$, then
Stacks, Lemma \ref{stacks-lemma-when-gerbe} property (2)(b)
guarantees the existence of an extension of $k$ over which $x$ and $x'$
become isomorphic (details omitted).
Hence $|\mathcal{X}| \to |\mathcal{Y}|$ is continuous and bijective
and it suffices to show that it is also open.
This follows from
Lemmas \ref{lemma-gerbe-fppf} and \ref{lemma-fppf-open}.
\end{proof}

\noindent
The following lemma tells us that residual gerbes exist for all points
on any algebraic stack which is a gerbe.

\begin{lemma}
\label{lemma-gerbe-residual-gerbe-exists}
Let $\mathcal{X}$ be an algebraic stack. If $\mathcal{X}$ is a gerbe
then for every $x \in |\mathcal{X}|$ the residual gerbe of $\mathcal{X}$
at $x$ exists.
\end{lemma}

\begin{proof}
Let $\pi : \mathcal{X} \to X$ be a morphism from $\mathcal{X}$ into
an algebraic space $X$ which turns $\mathcal{X}$ into a gerbe over $X$.
Let $Z_x \to X$ be the residual space of $X$ at $x$, see
Decent Spaces, Definition \ref{decent-spaces-definition-residual-space}.
Let $\mathcal{Z} = \mathcal{X} \times_X Z_x$. By
Lemma \ref{lemma-base-change-gerbe}
the algebraic stack $\mathcal{Z}$ is a gerbe over $Z_x$.
Hence $|\mathcal{Z}| = |Z_x|$
(Lemma \ref{lemma-gerbe-bijection-points})
is a singleton. Since $\mathcal{Z} \to Z_x$ is locally of finite presentation
as a base change of $\pi$ (see
Lemmas \ref{lemma-gerbe-fppf} and \ref{lemma-base-change-finite-presentation})
we see that $\mathcal{Z}$ is locally Noetherian, see
Lemma \ref{lemma-locally-finite-type-locally-noetherian}.
Thus the residual gerbe $\mathcal{Z}_x$ of $\mathcal{X}$ at $x$
exists and is equal to $\mathcal{Z}_x = \mathcal{Z}_{red}$ the reduction
of the algebraic stack $\mathcal{Z}$. Namely, we have seen above
that $|\mathcal{Z}_{red}|$ is a singleton mapping to $x \in |\mathcal{X}|$,
it is reduced by construction, and it is locally Noetherian (as the
reduction of a locally Noetherian algebraic stack is locally Noetherian,
details omitted).
\end{proof}









\section{Stratification by gerbes}
\label{section-stratify}

\noindent
The goal of this section is to show that many algebraic stacks
$\mathcal{X}$ have a ``stratification'' by locally closed substacks
$\mathcal{X}_i \subset \mathcal{X}$ such that each $\mathcal{X}_i$ is
a gerbe. This shows that in some sense gerbes are the building blocks
out of which any algebraic stack is constructed. Note that by stratification
we only mean that
$$
|\mathcal{X}| = \bigcup\nolimits_i |\mathcal{X}_i|
$$
is a stratification of the topological space associated to $\mathcal{X}$
and nothing more (in this section). Hence it is harmless to replace
$\mathcal{X}$ by its reduction (see
Properties of Stacks, Section \ref{stacks-properties-section-reduced})
in order to study this stratification.

\medskip\noindent
The following proposition tells us there is (almost always) a dense
open substack of the reduction of $\mathcal{X}$

\begin{proposition}
\label{proposition-open-stratum}
Let $\mathcal{X}$ be a reduced algebraic stack such that
$\mathcal{I}_\mathcal{X} \to \mathcal{X}$ is quasi-compact.
Then there exists a dense open substack $\mathcal{U} \subset \mathcal{X}$
which is a gerbe.
\end{proposition}

\begin{proof}
According to
Proposition \ref{proposition-when-gerbe}
it is enough to find a dense open substack $\mathcal{U}$ such that
$\mathcal{I}_\mathcal{U} \to \mathcal{U}$ is flat and locally of finite
presentation. Note that
$\mathcal{I}_\mathcal{U} =
\mathcal{I}_\mathcal{X} \times_\mathcal{X} \mathcal{U}$, see
Lemma \ref{lemma-cartesian-square-inertia}.

\medskip\noindent
Choose a presentation $\mathcal{X} = [U/R]$. Let $G \to U$ be the stabilizer
group algebraic space of the groupoid $R$. By
Lemma \ref{lemma-presentation-inertia}
we see that $G \to U$ is the base change of
$\mathcal{I}_\mathcal{X} \to \mathcal{X}$ hence quasi-compact (by assumption)
and locally of finite type (by
Lemma \ref{lemma-inertia}).
Let $W \subset U$ be the largest open (possibly empty) subscheme such that
the restriction $G_W \to W$ is flat and locally of finite presentation
(we omit the proof that $W$ exists; hint: use that the properties are local).
By
Morphisms of Spaces, Proposition
\ref{spaces-morphisms-proposition-generic-flatness-reduced}
we see that $W \subset U$ is dense. Note that $W \subset U$ is $R$-invariant
by
More on Groupoids in Spaces, Lemma
\ref{spaces-more-groupoids-lemma-property-G-invariant}.
Hence $W$ corresponds to an open substack $\mathcal{U} \subset \mathcal{X}$ by
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-substacks-presentation}.
Since $|U| \to |\mathcal{X}|$ is open and $|W| \subset |U|$ is dense we
conclude that $\mathcal{U}$ is dense in $\mathcal{X}$.
Finally, the morphism $\mathcal{I}_\mathcal{U} \to \mathcal{U}$
is flat and locally of finite presentation because the base change by
the surjective smooth morphism $W \to \mathcal{U}$ is the morphism
$G_W \to W$ which is flat and locally of finite presentation by construction.
See
Lemmas \ref{lemma-descent-flat} and
\ref{lemma-descent-finite-presentation}.
\end{proof}

\noindent
The above proposition immediately implies that any point has a residual
gerbe on an algebraic stack with quasi-compact inertia, as we will show in
Lemma \ref{lemma-every-point-residual-gerbe}.
It turns out that there doesn't always exist a finite stratification
by gerbes. Here is an example.

\begin{example}
\label{example-infinite-stratification}
Let $k$ be a field.
Take $U = \Spec(k[x_0, x_1, x_2, \ldots])$
and let $\mathbf{G}_m$ act by
$t(x_0, x_1, x_2, \ldots) = (tx_0, t^p x_1, t^{p^2} x_2, \ldots)$
where $p$ is a prime number. Let $\mathcal{X} = [U/\mathbf{G}_m]$.
This is an algebraic stack. There is a stratification of $\mathcal{X}$
by strata
\begin{enumerate}
\item $\mathcal{X}_0$ is where $x_0$ is not zero,
\item $\mathcal{X}_1$ is where $x_0$ is zero but $x_1$ is not zero,
\item $\mathcal{X}_2$ is where $x_0, x_1$ are zero, but $x_2$ is not zero,
\item and so on, and
\item $\mathcal{X}_{\infty}$ is where all the $x_i$ are zero.
\end{enumerate}
Each stratum is a gerbe over a scheme with group $\mu_{p^i}$ for
$\mathcal{X}_i$ and $\mathbf{G}_m$ for $\mathcal{X}_{\infty}$.
The strata are reduced locally closed substacks. There is no coarser
stratification with the same properties.
\end{example}

\noindent
Nonetheless, using transfinite induction we can use
Proposition \ref{proposition-open-stratum}
find possibly infinite stratifications by gerbes...!

\begin{lemma}
\label{lemma-every-point-in-a-stratum}
Let $\mathcal{X}$ be an algebraic stack such that
$\mathcal{I}_\mathcal{X} \to \mathcal{X}$ is quasi-compact.
Then there exists a well ordered index set $I$ and for every $i \in I$
a reduced locally closed substack $\mathcal{U}_i \subset \mathcal{X}$ such that
\begin{enumerate}
\item each $\mathcal{U}_i$ is a gerbe,
\item we have $|\mathcal{X}| = \bigcup_{i \in I} |\mathcal{U}_i|$,
\item $T_i = |\mathcal{X}| \setminus \bigcup_{i' < i} |\mathcal{U}_{i'}|$
is closed in $|\mathcal{X}|$ for all $i \in I$, and
\item $|\mathcal{U}_i|$ is open in $T_i$.
\end{enumerate}
We can moreover arrange it so that either (a) $|\mathcal{U}_i| \subset T_i$
is dense, or (b) $\mathcal{U}_i$ is quasi-compact. In case (a), if
we choose $\mathcal{U}_i$ as large as possible (see proof for details), then
the stratification is canonical.
\end{lemma}

\begin{proof}
Let $T \subset |\mathcal{X}|$ be a nonempty closed subset. We are going
to find (resp.\ choose) for every such $T$ a reduced locally closed substack
$\mathcal{U}(T) \subset \mathcal{X}$ with $|\mathcal{U}(T)| \subset T$
open dense (resp.\ nonempty quasi-compact). Namely, by
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-reduced-closed-substack}
there exists a unique reduced closed substack
$\mathcal{X}' \subset \mathcal{X}$ such that $T = |\mathcal{X}'|$.
Note that $\mathcal{I}_{\mathcal{X}'} =
\mathcal{I}_\mathcal{X} \times_\mathcal{X} \mathcal{X}'$ by
Lemma \ref{lemma-monomorphism-cartesian-square-inertia}.
Hence $\mathcal{I}_{\mathcal{X}'} \to \mathcal{X}'$ is
quasi-compact as a base change, see
Lemma \ref{lemma-base-change-quasi-compact}.
Therefore
Proposition \ref{proposition-open-stratum}
implies there exists a dense maximal (see proof proposition)
open substack $\mathcal{U} \subset \mathcal{X}'$
which is a gerbe. In case (a) we set $\mathcal{U}(T) = \mathcal{U}$
(this is canonical) and in case (b) we simply choose a nonempty quasi-compact
open $\mathcal{U}(T) \subset \mathcal{U}$, see
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-space-locally-quasi-compact}
(we can do this for all $T$
simultaneously by the axiom of choice).

\medskip\noindent
By transfinite induction we construct for every ordinal $\alpha$ a
closed subset $T_\alpha \subset |\mathcal{X}|$. For $\alpha = 0$
we set $T_0 = |\mathcal{X}|$. Given $T_\alpha$ set
$$
T_{\alpha + 1} = T_\alpha \setminus |\mathcal{U}(T_\alpha)|.
$$
If $\beta$ is a limit ordinal we set
$$
T_\beta = \bigcap\nolimits_{\alpha < \beta} T_\alpha.
$$
We claim that $T_\alpha = \emptyset$ for all $\alpha$
large enough. Namely, assume that $T_\alpha \not = \emptyset$
for all $\alpha$. Then we obtain an injective map from the class
of ordinals into the set of subsets of $|\mathcal{X}|$ which is a
contradiction.

\medskip\noindent
The claim implies the lemma. Namely, let
$$
I = \{\alpha \mid \mathcal{U}_\alpha \not = \emptyset \}.
$$
This is a well ordered set by the claim. For $i = \alpha \in I$ we set
$\mathcal{U}_i = \mathcal{U}_\alpha$. So $\mathcal{U}_i$ is a reduced
locally closed substack and a gerbe, i.e., (1) holds. By construction
$T_i = T\alpha$ if $i = \alpha \in I$, hence (3) holds. Also, (4) and
(a) or (b) hold by our choice of $\mathcal{U}(T)$ as well. Finally, to see
(2) let $x \in |\mathcal{X}|$. There exists a smallest ordinal $\beta$
with $x \not \in T_\beta$ (because the ordinals are well-ordered).
In this case $\beta$ has to be a successor ordinal by the definition
of $T_\beta$ for limit ordinals. Hence $\beta = \alpha + 1$ and
$x \in |\mathcal{U}(T_\alpha)|$ and we win.
\end{proof}

\begin{remark}
\label{remark-order-type}
We can wonder about the order type of the canonical stratifications which
occur as output of the stratifications of type (a) constructed in
Lemma \ref{lemma-every-point-in-a-stratum}.
A natural guess is that the well ordered set $I$ has
{\it cardinality} at most $\aleph_0$. We have no idea if this is true
or false. If you do please email
\href{mailto:stacks.project@gmail.com}{stacks.project@gmail.com}.
\end{remark}





\section{Existence of residual gerbes}
\label{section-existence-residual-gerbes}

\noindent
In this section we prove that residual gerbes (as defined in
Properties of Stacks, Definition
\ref{stacks-properties-definition-residual-gerbe})
exist on many algebraic stacks. First, here is the promised
application of
Proposition \ref{proposition-open-stratum}.

\begin{lemma}
\label{lemma-every-point-residual-gerbe}
Let $\mathcal{X}$ be an algebraic stack such that
$\mathcal{I}_\mathcal{X} \to \mathcal{X}$ is quasi-compact.
Then the residual gerbe of $\mathcal{X}$ at $x$ exists for
every $x \in |\mathcal{X}|$.
\end{lemma}

\begin{proof}
Let $T = \overline{\{x\}} \subset |\mathcal{X}|$ be the closure of $x$.
By
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-reduced-closed-substack}
there exists a reduced closed substack $\mathcal{X}' \subset \mathcal{X}$
such that $T = |\mathcal{X}'|$. Note that
$\mathcal{I}_{\mathcal{X}'} =
\mathcal{I}_\mathcal{X} \times_\mathcal{X} \mathcal{X}'$ by
Lemma \ref{lemma-monomorphism-cartesian-square-inertia}.
Hence $\mathcal{I}_{\mathcal{X}'} \to \mathcal{X}'$ is
quasi-compact as a base change, see
Lemma \ref{lemma-base-change-quasi-compact}.
Therefore
Proposition \ref{proposition-open-stratum}
implies there exists a dense open substack
$\mathcal{U} \subset \mathcal{X}'$
which is a gerbe. Note that $x \in |\mathcal{U}|$ because $\{x\} \subset T$
is a dense subset too. Hence a residual gerbe
$\mathcal{Z}_x \subset \mathcal{U}$ of $\mathcal{U}$ at $x$ exists by
Lemma \ref{lemma-gerbe-residual-gerbe-exists}.
It is immediate from the definitions that $\mathcal{Z}_x \to \mathcal{X}$
is a residual gerbe of $\mathcal{X}$ at $x$.
\end{proof}

\noindent
If the stack is quasi-DM then residual gerbes exist too.
In particular, residual gerbes always exist for Delinge-Mumford stacks.

\begin{lemma}
\label{lemma-every-point-residual-gerbe-quasi-DM}
Let $\mathcal{X}$ be a quasi-DM algebraic stack.
Then the residual gerbe of $\mathcal{X}$ at $x$ exists for
every $x \in |\mathcal{X}|$.
\end{lemma}

\begin{proof}
Choose a scheme $U$ and a surjective, flat, locally finite presented,
and locally quasi-finite morphism $U \to \mathcal{X}$, see
Theorem \ref{theorem-quasi-DM}.
Set $R = U \times_\mathcal{X} U$. The projections $s, t : R \to U$
are surjective, flat, locally of finite presentation, and
locally quasi-finite as base changes of the morphism $U \to \mathcal{X}$.
There is a canonical morphism $[U/R] \to \mathcal{X}$ (see
Algebraic Stacks, Lemma \ref{algebraic-lemma-map-space-into-stack})
which is an equivalence because $U \to \mathcal{X}$ is surjective, flat,
and locally of finite presentation, see
Algebraic Stacks, Remark \ref{algebraic-remark-flat-fp-presentation}.
Thus we may assume that $\mathcal{X} = [U/R]$ where
$(U, R, s, t, c)$ is a groupoid in algebraic spaces such that
$s, t : R \to U$ are surjective, flat, locally of finite presentation,
and locally quasi-finite. Set
$$
U' = \coprod\nolimits_{u \in U\text{ lying over }x} \Spec(\kappa(u)).
$$
The canonical morphism $U' \to U$ is a monomorphism. Let
$$
R' = U' \times_\mathcal{X} U' =
R \times_{(U \times U)} (U' \times U')
$$
Because $U' \to U$ is a monomorphism we see that both projections
$s', t' : R' \to U'$ factor as a monomorphism followed by a locally
quasi-finite morphism. Hence, as $U'$ is a disjoint union of spectra
of fields, using
Spaces over Fields, Lemma
\ref{spaces-over-fields-lemma-mono-towards-locally-quasi-finite-over-field}
we conclude that the morphisms $s', t' : R' \to U'$ are locally quasi-finite.
Again since $U'$ is a disjoint union of spectra of fields, the morphisms
$s', t'$ are also flat. Finally, $s', t'$ locally quasi-finite
implies $s', t'$ locally of finite type, hence $s', t'$ locally of finite
presentation (because $U'$ is a disjoint union of spectra of fields
in particular locally Noetherian, so that
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-noetherian-finite-type-finite-presentation}
applies). Hence $\mathcal{Z} = [U'/R']$ is an algebraic stack by
Criteria for Representability, Theorem
\ref{criteria-theorem-flat-groupoid-gives-algebraic-stack}.
As $R'$ is the restriction of $R$ by $U' \to U$ we see
$\mathcal{Z} \to \mathcal{X}$ is a monomorphism by
Groupoids in Spaces, Lemma
\ref{spaces-groupoids-lemma-quotient-stack-restrict}
and
Properties of Stacks, Lemma \ref{stacks-properties-lemma-monomorphism}.
Since $\mathcal{Z} \to \mathcal{X}$ is a monomorphism we see that
$|\mathcal{Z}| \to |\mathcal{X}|$ is injective, see
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-monomorphism-injective-points}.
By
Properties of Stacks, Lemma \ref{stacks-properties-lemma-points-cartesian}
we see that
$$
|U'| = |\mathcal{Z} \times_\mathcal{X} U'|
\longrightarrow
|\mathcal{Z}| \times_{|\mathcal{X}|} |U'|
$$
is surjective which implies (by our choice of $U'$) that
$|\mathcal{Z}| \to |\mathcal{X}|$ has image $\{x\}$.
We conclude that $|\mathcal{Z}|$ is a singleton.
Finally, by construction $U'$ is locally Noetherian and reduced, i.e.,
$\mathcal{Z}$ is reduced and locally Noetherian. This means that
the essential image of $\mathcal{Z} \to \mathcal{X}$
is the residual gerbe of $\mathcal{X}$ at $x$, see
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-residual-gerbe-unique}.
\end{proof}







\section{Smooth morphisms}
\label{section-smooth}

\noindent
The property ``being smooth'' of morphisms of algebraic
spaces is smooth local on the source-and-target, see
Descent on Spaces, Remark \ref{spaces-descent-remark-list-local-source-target}.
It is also stable under base change and fpqc local on the target, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-base-change-smooth}
and
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-descending-property-smooth}.
Hence, by
Lemma \ref{lemma-local-source-target}
above, we may define what it means for a morphism of algebraic spaces
to be smooth as follows and it agrees with the already
existing notion defined in
Properties of Stacks,
Section \ref{stacks-properties-section-properties-morphisms}
when the morphism is representable by algebraic spaces.

\begin{definition}
\label{definition-smooth}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
We say $f$ is {\it smooth} if the equivalent conditions of
Lemma \ref{lemma-local-source-target}
hold with $\mathcal{P} = \text{smooth}$.
\end{definition}

\begin{lemma}
\label{lemma-composition-smooth}
The composition of smooth morphisms is smooth.
\end{lemma}

\begin{proof}
Combine
Remark \ref{remark-composition}
with
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-composition-smooth}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-smooth}
A base change of a smooth morphism is smooth.
\end{lemma}

\begin{proof}
Combine
Remark \ref{remark-base-change}
with
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-smooth}.
\end{proof}








\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
