\input{preamble}

% OK, start here.
%
\begin{document}

\title{\'Etale Cohomology}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents


\section{Introduction}
\label{section-introduction}

\noindent
These are the notes of a course on \'etale cohomology taught by Johan de Jong
at Columbia University in the Fall of 2009. The original note takers were
Thibaut Pugin, Zachary Maddock and Min Lee. Over time we will add references
to background material in the rest of the stacks project and provide rigorous
proofs of all the statements.



\section{Which sections to skip on a first reading?}
\label{section-skip}

\noindent
We want to use the material in this chapter for the development of
theory related to algebraic spaces, Deligne-Mumford stacks, algebraic stacks,
etc. Thus we have added some pretty technical material to the original
exposition of \'etale cohomology for schemes. The reader can recognize this
material by the frequency of the word ``topos'', or by discussions related
to set theory, or by proofs dealing with very general properties of morphisms
of schemes. Some of these discussions can be skipped on a first reading.

\medskip\noindent
In particular, we suggest that the reader skip the following sections:
\begin{enumerate}
\item Comparing big and small topoi,
Section \ref{section-compare}.
\item Recovering morphisms,
Section \ref{section-morphisms}.
\item Push and pull,
Section \ref{section-monomorphisms}.
\item Property (A),
Section \ref{section-A}.
\item Property (B),
Section \ref{section-B}.
\item Property (C),
Section \ref{section-C}.
\item Topological invariance of the small \'etale site,
Section \ref{section-topological-invariance}.
\item Integral universally injective morphisms,
Section \ref{section-integral-universally-injective}.
\item Big sites and pushforward,
Section \ref{section-big}.
\item Exactness of big lower shriek,
Section \ref{section-exactness-lower-shriek}.
\end{enumerate}
Besides these sections there are some sporadic results that may be skipped
that the reader can recognize by the keywords given above.



%9.08.09
\section{Prologue}
\label{section-prologue}

\noindent
These lectures are about another cohomology theory. The first thing to remark
is that the Zariski topology is not entirely satisfactory. One of the main
reasons that it fails to give the results that we would want is that if $X$ is
a complex variety and $\mathcal{F}$ is a constant sheaf then
$$
H^i(X, \mathcal{F}) = 0, \quad \text{ for all } i > 0.
$$
The reason for that is the following. In an irreducible scheme (a variety in
particular), any two nonempty open subsets meet, and so the restriction
mappings of a constant sheaf are surjective. We say that the sheaf is
{\it flasque}. In this case, all higher \u Cech cohomology groups vanish, and
so do all higher Zariski cohomology groups. In other words, there are ``not
enough'' open sets in the Zariski topology to detect this higher cohomology.

\medskip\noindent
On the other hand, if $X$ is a smooth projective complex variety, then
$$
H_{Betti}^{2 \dim X}(X (\mathbf{C}), \Lambda) = \Lambda \quad \text{ for }
\Lambda = \mathbf{Z}, \ \mathbf{Z}/n\mathbf{Z},
$$
where $X(\mathbf{C})$ means the set of complex points of $X$. This is a feature
that would be nice to replicate in algebraic geometry. In positive
characteristic in particular.




\section{The \'etale topology}
\label{section-etale-topology}

\noindent
It is very hard to simply ``add'' extra open sets to refine the Zariski
topology. One efficient way to define a topology is to consider not only open
sets, but also some schemes that lie over them. To define the \'etale topology,
one considers all morphisms $\varphi: U \to X$ which are \'etale. If
$X$ is a smooth projective variety over $\mathbf{C}$, then this means
\begin{enumerate}
\item $U$ is a disjoint union of smooth varieties ; and
\item $\varphi$ is (analytically) locally an isomorphism.
\end{enumerate}
The word ``analytically'' refers to the usual (transcendental) topology over
$\mathbf{C}$. So the second condition means that the derivative of $\varphi$
has full rank everywhere (and in particular all the components of $U$
have the same dimension as $X$).

\medskip\noindent
A double cover -- loosely defined as a finite degree $2$ map between varieties
-- for example
$$
\Spec(\mathbf{C}[t])
\longrightarrow
\Spec(\mathbf{C}[t]),
\quad t \longmapsto t^2
$$
will not be an \'etale morphism if it has a fibre consisting of a single point.
In the example this happens when $t = 0$. For a finite map between varieties
over $\mathbf{C}$ to be \'etale all the fibers should have the same number of
points. Removing the point $t = 0$ from the source of the map in the example
will make the morphism \'etale. But we can remove other points from the source
of the morphism also, and the morphism will still be \'etale.  To consider the
\'etale topology, we have to look at all such morphisms. Unlike the Zariski
topology, these need not be merely be open subsets of $X$, even though their
images always are.

\begin{definition}
\label{definition-etale-covering-initial}
A family of morphisms $\{ \varphi_i : U_i \to X\}_{i \in I}$ is
called an {\it \'etale covering} if each $\varphi_i$ is an \'etale morphism
and their images cover $X$, i.e.,
$X = \bigcup_{i \in I} \varphi_i(U_i)$.
\end{definition}

\noindent
This ``defines'' the \'etale topology. In other words, we can now say what the
sheaves are. An {\it \'etale sheaf} $\mathcal{F}$ of sets
(resp.\ abelian groups, vector spaces, etc) on $X$ is the data:
\begin{enumerate}
\item for each \'etale morphism $\varphi : U \to X$ a set
(resp.\ abelian group, vector space, etc) $\mathcal{F}(U)$,
\item for each pair $U, \ U'$ of \'etale schemes over $X$,
and each morphism $U \to U'$ over $X$ (which is
automatically \'etale) a restriction map $\rho^{U}_{U'}
: \mathcal{F}(U) \to \mathcal{F}(U')$
\end{enumerate}
These data have to satisfy the following {\it sheaf axiom}:
\begin{list}{(*)}{}
\item for every \'etale covering $\{ \varphi_i : U_i \to X\}_{i \in
I}$, the diagram
$$
\xymatrix{
\emptyset \ar[r] &
\mathcal{F} (U) \ar[r] &
\Pi_{i \in I} \mathcal{F} (U_i) \ar@<1ex>[r] \ar@<-1ex>[r] &
\Pi_{i, j \in I} \mathcal{F} (U_i \times_U U_j)
}
$$
is exact in the category of sets (resp.\ abelian groups, vector spaces, etc).
\end{list}

\begin{remark}
\label{remark-i-is-j}
In the last statement, it is essential not to forget the case where $i = j$
which is in general a highly nontrivial condition (unlike in the Zariski
topology). In fact, frequently important coverings have only one element.
\end{remark}

\noindent
Since the identity is an \'etale morphism, we can compute the global sections
of an \'etale sheaf, and cohomology will simply be the corresponding
right-derived functors. In other words, once more theory has been developed and
statements have been made precise, there will be no obstacle to defining
cohomology.




\section{Feats of the \'etale topology}
\label{section-feats}

\noindent
For a natural number $n \in \mathbf{N} = \{1, 2, 3, 4, \dots\}$ it is true that
$$
H_\etale^2 (\mathbf{P}^1_\mathbf{C}, \mathbf{Z}/n\mathbf{Z}) =
\mathbf{Z}/n\mathbf{Z}.
$$
More generally, if $X$ is a complex variety, then its \'etale Betti numbers
with coefficients in a finite field agree with the usual Betti numbers of
$X(\mathbf{C})$, i.e.,
$$
\dim_{\mathbf{F}_q} H_\etale^{2i} (X, \mathbf{F}_q) =
\dim_{\mathbf{F}_q} H_{Betti}^{2i} (X(\mathbf{C}), \mathbf{F}_q).
$$
This is extremely satisfactory. However, these equalities only hold for torsion
coefficients, not in general. For integer coefficients, one has
$$
H_\etale^2 (\mathbf{P}^1_\mathbf{C}, \mathbf{Z}) = 0.
$$
There are ways to get back to nontorsion coefficients from torsion ones by a
limit procedure which we will come to shortly.




\section{A computation}
\label{section-computation}

\noindent
How do we compute the cohomology of $\mathbf{P}^1_\mathbf{C}$ with coefficients
$\Lambda = \mathbf{Z}/n\mathbf{Z}$?
We use \u Cech cohomology. A covering of $\mathbf{P}^1_\mathbf{C}$ is given by
the two standard opens $U_0, U_1$, which are both
isomorphic to $\mathbf{A}^1_\mathbf{C}$, and which intersection is isomorphic
to $\mathbf{A}^1_\mathbf{C} \setminus \{0\} = \mathbf{G}_{m, \mathbf{C}}$.
It turns out that the Mayer-Vietoris sequence holds in \'etale cohomology.
This gives an exact sequence
$$
H_\etale^{i-1}(U_0\cap U_1, \Lambda) \to
H_\etale^i(\mathbf{P}^1_C, \Lambda) \to
H_\etale^i(U_0, \Lambda) \oplus
H_\etale^i(U_1, \Lambda) \to H_\etale^i(U_0\cap U_1,
\Lambda).
$$
To get the answer we expect, we would need to show that the direct sum in the
third term vanishes. In fact, it is true that, as for the usual topology,
$$
H_\etale^q (\mathbf{A}^1_\mathbf{C}, \Lambda) = 0
\quad \text{ for } q \geq 1,
$$
and
$$
H_\etale^q (\mathbf{A}^1_\mathbf{C} \setminus \{0\}, \Lambda) = \left\{
\begin{matrix}
\Lambda & \text{ if $q = 1$, and} \\
0 & \text{ for $q \geq 2$.}
\end{matrix}
\right.
$$
These results are already quite hard (what is an elementary proof?). Let us
explain how we would compute this once the machinery of \'etale cohomology is
at our disposal.

\medskip\noindent
{\bf Higher cohomology.} This is taken care of by the following general
fact: if $X$ is an affine curve over $\mathbf{C}$, then
$$
H_\etale^q (X, \mathbf{Z}/n\mathbf{Z}) = 0 \quad \text{ for } q \geq 2.
$$
This is proved by considering the generic point of the curve and doing some
Galois cohomology. So we only have to worry about the cohomology in degree 1.

\medskip\noindent
{\bf Cohomology in degree 1.} We use the following identifications:
\begin{eqnarray*}
H_\etale^1 (X, \mathbf{Z}/n\mathbf{Z}) = \left\{
\begin{matrix}
\text{sheaves of sets $\mathcal{F}$ on the \'etale site $X_{\text{\'et}}$
endowed with an} \\
\text{action $\mathbf{Z}/n\mathbf{Z} \times \mathcal{F} \to \mathcal{F}$ such
that $\mathcal{F}$ is a $\mathbf{Z}/n\mathbf{Z}$-torsor.}
\end{matrix}
\right\}
\Big/ \cong
\\
 = \left\{
\begin{matrix}
\text{morphisms $Y \to X$ which are finite \'etale together} \\
\text{ with a free $\mathbf{Z}/n\mathbf{Z}$ action such that $X = Y
/(\mathbf{Z}/n\mathbf{Z})$.}
\end{matrix}
\right\}
\Big/ \cong.
\end{eqnarray*}
The first identification is very general (it is true for any cohomology theory
on a site) and has nothing to do with the \'etale topology. The second
identification is a consequence of descent theory. The last set describes a
collection of geometric objects on which we can get our hands.

\medskip\noindent
The curve $\mathbf{A}^1_\mathbf{C}$ has no nontrivial finite \'etale covering
and hence
$H_\etale^1 (\mathbf{A}^1_\mathbf{C}, \mathbf{Z}/n\mathbf{Z}) = 0$.
This can be seen either topologically or by using the argument in the next
paragraph.

\medskip\noindent
Let us describe the finite \'etale coverings
$\varphi: Y \to \mathbf{A}^1_\mathbf{C} \setminus \{0\}$.
It suffices to consider the case where $Y$ is
connected, which we assume. We are going to find out what $Y$ can be
by applying the Riemann-Hurwitz formula (of course this is a bit silly, and
you can go ahead and skip the next section if you like).
Say that this morphism is $n$ to 1, and consider a
projective compactification
$$
\xymatrix{
{Y\ } \ar@{^{(}->}[r] \ar^{\varphi}[d] &
{\bar Y} \ar^{\bar\varphi}[d] \\
{\mathbf{A}^1_\mathbf{C} \setminus \{0\}} \ar@{^{(}->}[r] &
{\mathbf{P}^1_\mathbf{C}}
}
$$
Even though $\varphi$ is \'etale and does not ramify, $\bar{\varphi}$ may
ramify at 0 and $\infty$. Say that the preimages of 0 are the points $y_1,
\dots, y_r$ with indices of ramification $e_1, \dots e_r$, and that the
preimages of $\infty$ are the points $y_1', \dots, y_s'$ with indices of
ramification $d_1, \dots d_s$. In particular, $\sum e_i = n = \sum d_j$.
Applying the Riemann-Hurwitz formula, we get
$$
2 g_Y - 2 = -2n + \sum (e_i - 1) + \sum (d_j - 1)
$$
and therefore $g_Y = 0$, $r=s=1$ and $e_1 = d_1 = n$.
Hence $Y \cong {\mathbf{A}^1_\mathbf{C} \setminus \{0\}}$, and it is easy to
see that $\varphi(z) = \lambda z^n$ for some $\lambda \in \mathbf{C}^*$.
After reparametrizing $Y$ we may assume $\lambda = 1$. Thus our
covering is given by taking the $n$th root of the coordinate on
$\mathbf{A}^1_{\mathbf{C}} \setminus \{0\}$.

\medskip\noindent
Remember that we need to classify the coverings of
${\mathbf{A}^1_\mathbf{C} \setminus \{0\}}$ together with free
$\mathbf{Z}/n\mathbf{Z}$-actions on them.
In our case any such action corresponds
to an automorphism of $Y$ sending $z$ to $\zeta_n z$, where $\zeta_n$ is a
primitive $n$th root of unity. There are $\phi(n)$ such actions
(here $\phi(n)$ means the Euler function). Thus there are exactly
$\phi(n)$ connected finite \'etale coverings with a given free
$\mathbf{Z}/n\mathbf{Z}$-action, each corresponding to a primitive
$n$th root of unity. We leave it to the reader to see that the
disconnected finite \'etale degree $n$ coverings of
$\mathbf{A}^1_{\mathbf{C}} \setminus \{0\}$ with a given free
$\mathbf{Z}/n\mathbf{Z}$-action correspond one-to-one with $n$th
roots of $1$ which are not primitive.
In other words, this computation shows that
$$
H_\etale^1 (\mathbf{A}^1_\mathbf{C} \setminus \{0\},
\mathbf{Z}/n\mathbf{Z}) =
\Hom(\mu_n(\mathbf{C}), \mathbf{Z}/n\mathbf{Z}) \cong \mathbf{Z}/n\mathbf{Z}.
$$
The first identification is canonical, the second isn't, see
Remark \ref{remark-normalize-H1-Gm}.
Since the proof of Riemann-Hurwitz does not use the computation of
cohomology, the above actually constitutes a proof (provided we
fill in the details on vanishing, etc).




\section{Nontorsion coefficients}
\label{section-nontorsion}

\noindent
To study nontorsion coefficients, one makes the following definition:
$$
H_\etale^i (X, \mathbf{Q}_\ell) :=
\left( \lim_n H_\etale^i(X, \mathbf{Z}/\ell^n\mathbf{Z}) \right)
\otimes_{\mathbf{Z}_\ell} \mathbf{Q}_\ell.
$$
The symbol $\lim_n$ denote the {\it limit} of the system of
cohomology groups $H_\etale^i(X, \mathbf{Z}/\ell^n\mathbf{Z})$ indexed
by $n$, see
Categories, Section \ref{categories-section-posets-limits}.
Thus we will need to study systems of sheaves satisfying some compatibility
conditions.




\section{Sheaf theory}
\label{section-sheaf-theory}
%9.10.09

\noindent
At this point we start talking about sites and sheaves in earnest.
There is an amazing amount of useful abstract material that could fit
in the next few sections. Some of this material is worked out in earlier
chapters, such as the chapter on sites, modules on sites, and cohomology
on sites. We try to refrain from adding to much material here, just
enough so the material later in this chapter makes sense.




\section{Presheaves}
\label{section-presheaves}

\noindent
A reference for this section is
Sites, Section \ref{sites-section-presheaves}.

\begin{definition}
\label{definition-presheaf}
Let $\mathcal{C}$ be a category. A {\it presheaf of sets} (respectively, an
{\it abelian presheaf}) on $\mathcal{C}$ is a functor $\mathcal{C}^{opp} \to
\textit{Sets}$ (resp.\ $\textit{Ab}$).
\end{definition}

\noindent
{\bf Terminology.} If $U \in \Ob(\mathcal{C})$, then elements of
$\mathcal{F}(U)$ are called {\it sections} of $\mathcal{F}$ over
$U$. For $\varphi: V \to U$ in $\mathcal{C}$, the
map $\mathcal{F}(\varphi) : \mathcal{F}(V) \to \mathcal{F}(U)$
is called the {\it restriction map} and is often denoted $s \mapsto s|_V$
or sometimes $s \mapsto \varphi^*s$. The notation $s|_V$ is ambiguous
since the restriction map depends on $\varphi$, but it is a standard
abuse of notation. We also use the notation
$\Gamma(U, \mathcal{F}) = \mathcal{F}(U)$.

\medskip\noindent
Saying that $\mathcal{F}$ is a functor means that if
$W \to V \to U$ are morphisms in $\mathcal{C}$ and
$s \in \Gamma(U, \mathcal{F})$ then
$(s|_V)|_W = s |_W$, with the abuse of
notation just seen. Moreover, the restriction mappings corresponding to
the identity morphisms $\text{id}_U : U \to U$ are the identity.

\medskip\noindent
The category of presheaves of sets (respectively of abelian presheaves) on
$\mathcal{C}$ is denoted $\textit{PSh} (\mathcal{C})$ (resp. $\textit{PAb}
(\mathcal{C})$). It is the category of functors from $\mathcal{C}^{opp}$ to
$\textit{Sets}$ (resp. $\textit{Ab}$), which is to say that the morphisms of
presheaves are natural transformations of functors. We only consider the
categories $\textit{PSh}(\mathcal{C})$ and $\textit{PAb}(\mathcal{C})$
when the category $\mathcal{C}$ is small. (Our convention is that a category
is small unless otherwise mentioned, and if it isn't small it should be
listed in Categories, Remark \ref{categories-remark-big-categories}.)

\begin{example}
\label{example-representable-presheaf}
Given an object $X \in \Ob(\mathcal{C})$, we consider the functor
$$
\begin{matrix}
h_X : & \mathcal{C}^{opp} & \longrightarrow & \textit{Sets} \\
& U & \longmapsto & h_X(U) = \Mor_\mathcal{C}(U, X) \\
& V \xrightarrow{\varphi} U & \longmapsto &
\varphi \circ - : h_X(U) \to h_X(V).
\end{matrix}
$$
It is a presheaf, called the {\it representable presheaf associated to $X$.}
It is not true that representable presheaves are sheaves in every topology on
every site.
\end{example}

\begin{lemma}[Yoneda]
\label{lemma-yoneda}
Let $\mathcal{C}$ be a category, and $X, Y \in
\Ob(\mathcal{C})$. There is a natural bijection
$$
\begin{matrix}
\Mor_\mathcal{C}(X, Y) &
\longrightarrow &
\Mor_{\textit{PSh}(\mathcal{C})} (h_X, h_Y) \\
\psi &
\longmapsto &
h_\psi = \psi \circ - : h_X \to h_Y.
\end{matrix}
$$
\end{lemma}

\begin{proof}
See
Categories, Lemma \ref{categories-lemma-yoneda}.
\end{proof}




\section{Sites}
\label{section-sites}


\begin{definition}
\label{definition-family-morphisms-fixed-target}
Let $\mathcal{C}$ be a category. A {\it family of morphisms with fixed target}
$\mathcal{U} = \{\varphi_i : U_i \to U\}_{i\in I}$ is the data of
\begin{enumerate}
\item an object $U \in \mathcal{C}$ ;
\item a set $I$ (possibly empty) ; and
\item for all $i\in I$, a morphism $\varphi_i : U_i \to U$ of $\mathcal{C}$
with target $U$.
\end{enumerate}
\end{definition}

\noindent
There is a notion of a {\it morphism of families of morphisms with fixed
target}. A special case of that is the notion of a {\it refinement}.
A reference for this material is
Sites, Section \ref{sites-section-refinements}.

\begin{definition}
\label{definition-site}
A {\it site}\footnote{What we call a site is a called a category endowed with
a pretopology in \cite[Expos\'e II, D\'efinition 1.3]{SGA4}.
In \cite{ArtinTopologies} it is called a category with a Grothendieck
topology.} consists of a category $\mathcal{C}$ and a set
$\text{Cov}(\mathcal{C})$ consisting of families of morphisms with fixed target
called {\it coverings}, such that
\begin{enumerate}
\item (isomorphism) if $\varphi : V \to U$ is an isomorphism in $\mathcal{C}$,
then $\{\varphi : V \to U\}$ is a covering,
\item (locality) if $\{\varphi_i : U_i \to U\}_{i\in I}$ is a covering and
for all $i \in I$ we are given a covering
$\{\psi_{ij} : U_{ij} \to U_i \}_{j\in I_i}$, then
$$
\{
\varphi_i \circ \psi_{ij} : U_{ij} \to U
\}_{(i, j)\in \prod_{i\in I} \{i\} \times I_i}
$$
is also a covering, and
\item (base change) if $\{U_i \to U\}_{i\in I}$
is a covering and $V \to U$ is a morphism in $\mathcal{C}$, then
\begin{enumerate}
\item for all $i \in I$ the fibre product
$U_i \times_U V$ exists in $\mathcal{C}$, and
\item $\{U_i \times_U V \to V\}_{i\in I}$ is a covering.
\end{enumerate}
\end{enumerate}
\end{definition}

\noindent
For us the category underlying a site is always ``small'', i.e., its
collection of objects form a set, and the collection of coverings of
a site is a set as well (as in the definition above). We will mostly,
in this chapter, leave out the arguments that cut down the collection
of objects and coverings to a set. For further discussion, see
Sites, Remark \ref{sites-remark-no-big-sites}.

\begin{example}
\label{example-site-topological-space}
If $X$ is a topological space, then it has an associated site $X_{Zar}$
defined as follows: the objects of $X_{Zar}$ are the open subsets of $X$,
the morphisms between these are the inclusion mappings, and the coverings are
the usual topological (surjective) coverings. Observe that if
$U, V \subset W \subset X$ are open subsets then $U \times_W V = U \cap V$
exists: this category has fiber products. All the verifications are trivial and
everything works as expected.
\end{example}




\section{Sheaves}
\label{section-sheaves}

\begin{definition}
\label{definition-sheaf}
A presheaf $\mathcal{F}$ of sets (resp. abelian presheaf) on a site
$\mathcal{C}$ is said to be a {\it separated presheaf} if for all coverings
$\{\varphi_i : U_i \to U\}_{i\in I} \in \text{Cov} (\mathcal{C})$
the map
$$
\mathcal{F}(U) \longrightarrow \prod\nolimits_{i\in I} \mathcal{F}(U_i)
$$
is injective. Here the map is $s \mapsto (s|_{U_i})_{i\in I}$.
The presheaf $\mathcal{F}$ is a {\it sheaf} if for all coverings
$\{\varphi_i : U_i \to U\}_{i\in I} \in \text{Cov} (\mathcal{C})$, the
diagram
\begin{equation}
\label{equation-sheaf-axiom}
\xymatrix{
\mathcal{F}(U) \ar[r] &
\prod_{i\in I} \mathcal{F}(U_i) \ar@<1ex>[r] \ar@<-1ex>[r] &
\prod_{i, j \in I} \mathcal{F}(U_i \times_U U_j),
}
\end{equation}
where the first map is $s \mapsto (s|_{U_i})_{i\in I}$ and the two
maps on the right are
$(s_i)_{i\in I} \mapsto (s_i |_{U_i \times_U U_j})$ and
$(s_i)_{i\in I} \mapsto (s_j |_{U_i \times_U U_j})$,
is an equalizer diagram in the category of sets (resp.\ abelian groups).
\end{definition}

\begin{remark}
\label{remark-empty-covering}
For the empty covering (where $I = \emptyset$), this implies that
$\mathcal{F}(\emptyset)$ is an empty product, which is a final object in the
corresponding category (a singleton, for both $\textit{Sets}$ and
$\textit{Ab}$).
\end{remark}

\begin{example}
\label{example-sheaf-site-space}
Working this out for the site $X_{Zar}$ associated to a topological
space, see Example \ref{example-site-topological-space}, gives the usual
notion of sheaves.
\end{example}

\begin{definition}
\label{definition-category-sheaves}
We denote $\Sh(\mathcal{C})$ (resp.\ $\textit{Ab}(\mathcal{C})$)
the full subcategory of $\textit{PSh}(\mathcal{C})$
(resp.\ $\textit{PAb}(\mathcal{C})$) whose objects are sheaves. This is the
{\it category of sheaves of sets} (resp.\ {\it abelian sheaves}) on
$\mathcal{C}$.
\end{definition}




\section{The example of G-sets}
\label{section-G-sets}

\noindent
Let $G$ be a group and define a site $\mathcal{T}_G$ as follows: the underlying
category is the category of $G$-sets, i.e., its objects are sets endowed
with a left $G$-action and the morphisms are equivariant maps; and the
coverings of $\mathcal{T}_G$ are the families
$\{\varphi_i : U_i \to U\}_{i\in I}$ satisfying
$U = \bigcup_{i\in I} \varphi_i(U_i)$.

\medskip\noindent
There is a special object in the site $\mathcal{T}_G$, namely the $G$-set $G$
endowed with its natural action by left translations. We denote it ${}_G G$.
Observe that there is a natural group isomorphism
$$
\begin{matrix}
\rho: & G^{opp} & \longrightarrow & \text{Aut}_{G\textit{-Sets}}({}_G G) \\
& g & \longmapsto & (h \mapsto hg).
\end{matrix}
$$
In particular, for any presheaf $\mathcal{F}$, the set $\mathcal{F}({}_G G)$
inherits a $G$-action via $\rho$. (Note that by contravariance of
$\mathcal{F}$, the set $\mathcal{F}({}_G G)$ is again a left $G$-set.) In fact,
the functor
$$
\begin{matrix}
\Sh(\mathcal{T}_G) & \longrightarrow & G\textit{-Sets} \\
\mathcal{F} & \longmapsto & \mathcal{F}({}_G G)
\end{matrix}
$$
is an equivalence of categories. Its quasi-inverse is the functor $X \mapsto
h_X$. Without giving the complete proof (which can be found in
Sites, Section \ref{sites-section-example-sheaf-G-sets})
let us try to explain why this is true.
\begin{enumerate}
\item
If $S$ is a $G$-set, we can decompose it into orbits $S = \coprod_{i\in I}
O_i$. The sheaf axiom for the covering $\{O_i \to S\}_{i\in I}$ says that
$$
\xymatrix{
\mathcal{F}(S) \ar[r] &
\prod_{i\in I} \mathcal{F}(O_i) \ar@<1ex>[r] \ar@<-1ex>[r] &
\prod_{i, j \in I} \mathcal{F}(O_i \times_S O_j)
}
$$
is an equalizer. Observing that fibered products in $G\textit{-Sets}$ are
induced from fibered products in $\textit{Sets}$, and using the fact that
$\mathcal{F}(\emptyset)$ is a $G$-singleton, we get that
$$
\prod_{i, j \in I} \mathcal{F}(O_i \times_S O_j) = \prod_{i \in I}
\mathcal{F}(O_i)
$$
and the two maps above are in fact the same. Therefore the sheaf axiom merely
says that $\mathcal{F}(S) = \prod_{i\in I} \mathcal{F}(O_i)$.
\item
If $S$ is the $G$-set $S= G/H$ and $\mathcal{F}$ is a sheaf on $\mathcal{T}_G$,
then we claim that
$$
\mathcal{F}(G/H) = \mathcal{F}({}_G G)^H
$$
and in particular $\mathcal{F}(\{*\}) = \mathcal{F}({}_G G)^G$. To see this,
let's use the sheaf axiom for the covering $\{ {}_G G \to G/H \}$ of $S$. We
have
\begin{eqnarray*}
{}_G G \times_{G/H} {}_G G & \cong & G \times H \\
(g_1, g_2) & \longmapsto & (g_1, g_1 g_2^{-1})
\end{eqnarray*}
is a disjoint union of copies of ${}_G G$ (as a $G$-set). Hence the sheaf axiom
reads
$$
\xymatrix{
\mathcal{F} (G/H) \ar[r] &
\mathcal{F}({}_G G) \ar@<1ex>[r] \ar@<-1ex>[r] &
\prod_{h\in H} \mathcal{F}({}_G G)
}
$$
where the two maps on the right are $s \mapsto (s)_{h \in H}$ and $s \mapsto
(hs)_{h \in H}$. Therefore $\mathcal{F}(G/H) = \mathcal{F}({}_G G)^H$ as
claimed.
\end{enumerate}
This doesn't quite prove the claimed equivalence of categories, but it shows at
least that a sheaf $\mathcal{F}$ is entirely determined by its sections over
${}_G G$. Details (and set theoretical remarks) can be found in
Sites, Section \ref{sites-section-example-sheaf-G-sets}.




\section{Sheafification}
\label{section-sheafification}

\begin{definition}
\label{definition-0-cech}
Let $\mathcal{F}$ be a presheaf on the site $\mathcal{C}$ and
$\mathcal{U} = \{U_i \to U\} \in \text{Cov} (\mathcal{C})$.
We define the {\it zeroth \u Cech cohomology group} of
$\mathcal{F}$ with respect to $\mathcal{U}$ by
$$
\check H^0 (\mathcal{U}, \mathcal{F}) =
\left\{
(s_i)_{i\in I} \in \prod\nolimits_{i\in I }\mathcal{F}(U_i)
\text{ such that }
s_i|_{U_i \times_U U_j} = s_j |_{U_i \times_U U_j}
\right\}.
$$
\end{definition}

\noindent
There is a canonical map
$\mathcal{F}(U) \to \check H^0 (\mathcal{U}, \mathcal{F})$,
$s \mapsto (s |_{U_i})_{i\in I}$.
We say that a {\it morphism of coverings} from a covering
$\mathcal{V} = \{V_j \to V\}_{j \in J}$ to $\mathcal{U}$ is a triple
$(\chi, \alpha, \chi_j)$, where
$\chi : V \to U$ is a morphism,
$\alpha : J \to I$ is a map of sets, and for all
$j \in J$ the morphism $\chi_j$ fits into a commutative diagram
$$
\xymatrix{
V_j \ar[rr]_{\chi_j} \ar[d] & & U_{\alpha(j)} \ar[d] \\
V \ar[rr]^\chi & & U.
}
$$
Given the data $\chi, \alpha, \{\chi_j\}_{i\in J}$ we define
\begin{eqnarray*}
\check H^0(\mathcal{U}, \mathcal{F}) & \longrightarrow &
\check H^0(\mathcal{V}, \mathcal{F}) \\
(s_i)_{i\in I} & \longmapsto &
\left(\chi_j^*\left(s_{\alpha(j)}\right)\right)_{j\in J}.
\end{eqnarray*}
We then claim that
\begin{enumerate}
\item the map is well-defined, and
\item depends only on $\chi$ and is independent of the choice of
$\alpha, \{\chi_j\}_{i\in J}$.
\end{enumerate}
We omit the proof of the first fact.
To see part (2), consider another triple $(\psi, \beta, \psi_j)$ with
$\chi = \psi$. Then we have the commutative diagram
$$
\xymatrix{
V_j \ar^{(\chi_j, \psi_j)\qquad}[rrr] \ar[dd] & & &
U_{\alpha(j)} \times_U U_{\beta(j)} \ar[dl] \ar[dr] \\
& & U_{\alpha(j)} \ar[dr] & &
U_{\beta(j)} \ar[dl] \\
V \ar[rrr]^{\chi = \psi} & & & U.
}
$$
Given a section $s \in \mathcal{F}(\mathcal{U})$, its image in
$\mathcal{F}(V_j)$ under the map given by
$(\chi, \alpha, \{\chi_j\}_{i\in J})$
is $\chi_j^*s_{\alpha(j)}$, and
its image under the map given by $(\psi, \beta, \{\psi_j\}_{i\in J})$
is $\psi_j^*s_{\beta(j)}$. These
two are equal since by assumption $s \in \check H(\mathcal{U}, \mathcal{F})$
and hence both are equal to the pullback of the common value
$$
s_{\alpha(j)}|_{U_{\alpha(j)} \times_U U_{\beta(j)}} =
s_{\beta(j)}|_{U_{\alpha(j)} \times_U U_{\beta(j)}}
$$
pulled back by the map $(\chi_j, \psi_j)$ in the diagram.

\begin{theorem}
\label{theorem-sheafification}
Let $\mathcal{C}$ be a site and $\mathcal{F}$ a presheaf on $\mathcal{C}$.
\begin{enumerate}
\item The rule
$$
U \mapsto \mathcal{F}^+(U) :=
\colim_{\mathcal{U} \text{ covering of }U}
\check H^0(\mathcal{U}, \mathcal{F})
$$
is a presheaf. And the colimit is a directed one.
\item There is a canonical map of presheaves $\mathcal{F} \to \mathcal{F}^+$.
\item If $\mathcal{F}$ is a separated presheaf then $\mathcal{F}^+$ is a sheaf
and the map in (2) is injective.
\item $\mathcal{F}^+$ is a separated presheaf.
\item $\mathcal{F}^\# = (\mathcal{F}^+)^+$ is a sheaf, and the canonical
map induces a functorial isomorphism
$$
\Hom_{\textit{PSh}(\mathcal{C})}(\mathcal{F}, \mathcal{G}) =
\Hom_{\Sh(\mathcal{C})}(\mathcal{F}^\#, \mathcal{G})
$$
for any $\mathcal{G} \in \Sh(\mathcal{C})$.
\end{enumerate}
\end{theorem}

\begin{proof}
See Sites, Theorem \ref{sites-theorem-plus}.
\end{proof}

\noindent
In other words, this means that the natural map
$\mathcal{F} \to \mathcal{F}^\#$ is a left adjoint to the forgetful functor
$\Sh(\mathcal{C}) \to \textit{PSh}(\mathcal{C})$.




\section{Cohomology}
\label{section-cohomology}

\noindent
The following is the basic result that makes it possible to define cohomology
for abelian sheaves on sites.

\begin{theorem}
\label{theorem-enough-injectives}
The category of abelian sheaves on a site is an abelian category
which has enough injectives.
\end{theorem}

\begin{proof}
See
Modules on Sites, Lemma \ref{sites-modules-lemma-abelian-abelian} and
Injectives, Theorem \ref{injectives-theorem-sheaves-injectives}.
\end{proof}

\noindent
So we can define cohomology as the right-derived functors of the
sections functor: if $U \in \Ob(\mathcal{C})$ and
$\mathcal{F} \in \textit{Ab}(\mathcal{C})$,
$$
H^p(U, \mathcal{F}) :=
R^p\Gamma(U, \mathcal{F}) =
H^p(\Gamma(U, \mathcal{I}^\bullet))
$$
where $\mathcal{F} \to \mathcal{I}^\bullet$ is an injective resolution. To do
this, we should check that the functor $\Gamma(U, -)$ is left exact. This is
true and is part of why the category $\textit{Ab}(\mathcal{C})$ is abelian,
see
Modules on Sites, Lemma \ref{sites-modules-lemma-abelian-abelian}.
For more general discussion of cohomology on sites (including the
global sections functor and its right derived functors), see
Cohomology on Sites, Section \ref{sites-cohomology-section-cohomology-sheaves}.



\section{The fpqc topology}
\label{section-fpqc}
%9.15.09

\noindent
Before doing \'etale cohomology we study a bit the fpqc topology, since
it works well for quasi-coherent sheaves.

\begin{definition}
\label{definition-fpqc-covering}
Let $T$ be a scheme. An {\it fpqc covering} of $T$ is a family
$\{ \varphi_i : T_i \to T\}_{i \in I}$ such that
\begin{enumerate}
\item each $\varphi_i$ is a flat morphism and
$\bigcup_{i\in I} \varphi_i(T_i) = T$, and
\item for each affine open $U \subset T$ there exists a finite
set $K$, a map $\mathbf{i} : K \to I$ and affine opens
$U_{\mathbf{i}(k)} \subset T_{\mathbf{i}(k)}$ such that
$U = \bigcup_{k \in K} \varphi_{\mathbf{i}(k)}(U_{\mathbf{i}(k)})$.
\end{enumerate}
\end{definition}

\begin{remark}
\label{remark-fpqc}
The first condition corresponds to fp, which stands for
{\it fid\`element plat}, faithfully flat in french, and
the second to qc, {\it quasi-compact}. The second part of
the first condition is unnecessary when the second condition holds.
\end{remark}

\begin{example}
\label{example-fpqc-coverings}
Examples of fpqc coverings.
\begin{enumerate}
\item Any Zariski open covering of $T$ is an fpqc covering.
\item A family $\{\Spec(B) \to \Spec(A)\}$ is an fpqc
covering if and only if $A \to B$ is a faithfully flat ring map.
\item If $f: X \to Y$ is flat, surjective and quasi-compact, then $\{ f: X\to
Y\}$ is an fpqc covering.
\item The morphism
$\varphi :
\coprod_{x \in \mathbf{A}^1_k} \Spec(\mathcal{O}_{\mathbf{A}^1_k, x})
\to \mathbf{A}^1_k$,
where $k$ is a field, is flat and surjective. It is not quasi-compact, and
in fact the family $\{\varphi\}$ is not an fpqc covering.
\item Write
$\mathbf{A}^2_k = \Spec(k[x, y])$. Denote $i_x : D(x) \to \mathbf{A}^2_k$
and $i_y : D(y) \hookrightarrow \mathbf{A}^2_k$ the standard opens.
Then the families
$\{i_x, i_y, \Spec(k[[x, y]]) \to \mathbf{A}^2_k\}$
and
$\{i_x, i_y, \Spec(\mathcal{O}_{\mathbf{A}^2_k, 0}) \to \mathbf{A}^2_k\}$
are fpqc coverings.
\end{enumerate}
\end{example}

\begin{lemma}
\label{lemma-site-fpqc}
The collection of fpqc coverings on the category of schemes
satisfies the axioms of site.
\end{lemma}

\begin{proof}
See Topologies, Lemma \ref{topologies-lemma-fpqc}.
\end{proof}

\noindent
It seems that this lemma allows us to define the fpqc site of the category
of schemes. However, there is a set theoretical problem that comes up when
considering the fpqc topology, see
Topologies, Section \ref{topologies-section-fpqc}.
It comes from our requirement that sites are ``small'', but that no small
category of schemes can contain a cofinal system of fpqc coverings of a
given nonempty scheme. Although this does not strictly speaking prevent
us from defining  ``partial'' fpqc
sites, it does not seem prudent to do so. The work-around is to allow
the notion of a sheaf for the fpqc topology (see below) but to prohibit
considering the category of all fpqc sheaves.

\begin{definition}
\label{definition-sheaf-property-fpqc}
Let $S$ be a scheme. The category of schemes over $S$ is denoted
$\Sch/S$. Consider a functor
$\mathcal{F} : (\Sch/S)^{opp} \to \textit{Sets}$, in other words
a presheaf of sets. We say $\mathcal{F}$
{\it satisfies the sheaf property for the fpqc topology}
if for every fpqc covering $\{U_i \to U\}_{i \in I}$ of schemes over $S$
the diagram (\ref{equation-sheaf-axiom}) is an equalizer diagram.
\end{definition}

\noindent
We similarly say that $\mathcal{F}$
{\it satisfies the sheaf property for the Zariski topology} if for
every open covering $U = \bigcup_{i \in I} U_i$ the diagram
(\ref{equation-sheaf-axiom}) is an equalizer diagram. See
Schemes, Definition \ref{schemes-definition-representable-by-open-immersions}.
Clearly, this is equivalent to saying that for every scheme $T$ over $S$ the
restriction of $\mathcal{F}$ to the opens of $T$ is a (usual) sheaf.

\begin{lemma}
\label{lemma-fpqc-sheaves}
Let $\mathcal{F}$ be a presheaf on $\Sch/S$. Then
$\mathcal{F}$ satisfies the sheaf property for the fpqc topology
if and only if
\begin{enumerate}
\item $\mathcal{F}$ satisfies the sheaf property with respect to the
Zariski topology, and
\item for every faithfully flat morphism $\Spec(B) \to \Spec(A)$
of affine schemes over $S$, the sheaf axiom holds for the covering
$\{\Spec(B) \to \Spec(A)\}$. Namely, this means that
$$
\xymatrix{
\mathcal{F}(\Spec(A)) \ar[r] &
\mathcal{F}(\Spec(B)) \ar@<1ex>[r] \ar@<-1ex>[r] &
\mathcal{F}(\Spec(B \otimes_A B))
}
$$
is an equalizer diagram.
\end{enumerate}
\end{lemma}

\begin{proof}
See Topologies, Lemma \ref{topologies-lemma-sheaf-property-fpqc}.
\end{proof}

\noindent
An alternative way to think of a presheaf $\mathcal{F}$ on
$\Sch/S$ which satisfies the sheaf condition for the
fpqc topology is as the following data:
\begin{enumerate}
\item for each $T/S$, a usual (i.e., Zariski) sheaf $\mathcal{F}_T$ on
$T_{Zar}$,
\item for every map $f : T' \to T$ over $S$, a restriction mapping
$f^{-1}\mathcal{F}_T \to \mathcal{F}_{T'}$
\end{enumerate}
such that
\begin{enumerate}
\item[(a)] the restriction mappings are functorial,
\item[(b)] if $f : T' \to T$ is an open immersion then the restriction
mapping $f^{-1}\mathcal{F}_T \to \mathcal{F}_{T'}$ is an isomorphism, and
\item[(c)] for every faithfully flat morphism
$\Spec(B) \to \Spec(A)$ over $S$, the diagram
$$
\xymatrix{
\mathcal{F}_{\Spec(A)}(\Spec(A)) \ar[r] &
\mathcal{F}_{\Spec(B)}(\Spec(B)) \ar@<1ex>[r] \ar@<-1ex>[r] &
\mathcal{F}_{\Spec(B \otimes_A B)}(\Spec(B \otimes_A B))
}
$$
is an equalizer.
\end{enumerate}
Data (1) and (2) and conditions (a), (b) give the data of a presheaf
on $\Sch/S$ satisfying the sheaf condition for the Zariski topology.
By Lemma \ref{lemma-fpqc-sheaves} condition (c) then suffices to get the
sheaf condition for the fpqc topology.

\begin{example}
\label{example-quasi-coherent}
Consider the presheaf
$$
\begin{matrix}
\mathcal{F} : & (\Sch/S)^{opp} & \longrightarrow & \textit{Ab} \\
& T/S & \longmapsto & \Gamma(T, \Omega_{T/S}).
\end{matrix}
$$
The compatibility of differentials with localization implies that
$\mathcal{F}$ is a sheaf on the Zariski site.
However, it does not satisfy the sheaf condition for the fpqc topology.
Namely, consider the case
$S = \Spec(\mathbf{F}_p)$ and the morphism
$$
\varphi :
V = \Spec(\mathbf{F}_p[v])
\to
U = \Spec(\mathbf{F}_p[u])
$$
given by mapping $u$ to $v^p$. The family $\{\varphi\}$ is an fpqc covering,
yet the restriction mapping
$\mathcal{F}(U) \to \mathcal{F}(V)$
sends the generator $\mathrm{d} u$ to $\mathrm{d}(v^p)
= 0$, so it is the zero map, and the diagram
$$
\xymatrix{
\mathcal{F}(U) \ar[r]^{0} &
\mathcal{F}(V) \ar@<1ex>[r] \ar@<-1ex>[r] &
\mathcal{F}(V \times_U V)
}
$$
is not an equalizer. We will see later that $\mathcal{F}$ does in fact
give rise to a sheaf on the \'etale and smooth sites.
\end{example}

\begin{lemma}
\label{lemma-representable-sheaf-fpqc}
Any representable presheaf on $\Sch/S$ satisfies the
sheaf condition for the fpqc topology.
\end{lemma}

\begin{proof}
See
Descent, Lemma \ref{descent-lemma-fpqc-universal-effective-epimorphisms}.
\end{proof}

\noindent
We will return to this later, since the proof of this fact uses
descent for quasi-coherent sheaves, which we will discuss in the next
section. A fancy way of expressing the lemma is to say that
{\it the fpqc topology is weaker than the canonical topology}, or
that the fpqc topology is {\it subcanonical}. In the setting of sites
this is discussed in
Sites, Section \ref{sites-section-representable-sheaves}.

\begin{remark}
\label{remark-fpqc-finest}
The fpqc is the finest topology that we will see. Hence any presheaf
satisfying the sheaf condition for the fpqc topology will be a
sheaf in the subsequent sites (\'etale, smooth, etc). In particular
representable presheaves will be sheaves on the \'etale site of a scheme
for example.
\end{remark}

\begin{example}
\label{example-additive-group-sheaf}
Let $S$ be a scheme.
Consider the additive group scheme $\mathbf{G}_{a, S} = \mathbf{A}^1_S$
over $S$, see
Groupoids, Example \ref{groupoids-example-additive-group}.
The associated representable presheaf is given by
$$
h_{\mathbf{G}_{a, S}}(T) =
\Mor_S(T, \mathbf{G}_{a, S}) =
\Gamma(T, \mathcal{O}_T).
$$
By the above we now know that this is a presheaf of sets which satisfies the
sheaf condition for the fpqc topology. On the other hand, it is clearly
a presheaf of rings as well. Hence we can think of this as a functor
$$
\begin{matrix}
\mathcal{O} : &
(\Sch/S)^{opp} &
\longrightarrow &
\textit{Rings} \\
&
T/S &
\longmapsto &
\Gamma(T, \mathcal{O}_T)
\end{matrix}
$$
which satisfies the sheaf condition for the fpqc topology.
Correspondingly there is a notion of $\mathcal{O}$-module, and so on and
so forth.
\end{example}




\section{Faithfully flat descent}
\label{section-fpqc-descent}

\begin{definition}
\label{definition-descent-datum}
Let $\mathcal{U} = \{ t_i : T_i \to T\}_{i \in I}$ be a family of
morphisms of schemes with fixed target. A {\it descent datum} for
quasi-coherent sheaves with respect to
$\mathcal{U}$ is a family $(\mathcal{F}_i, \varphi_{ij})_{i, j\in I}$ where
\begin{enumerate}
\item for all $i$, $\mathcal{F}_i$ is a quasi-coherent sheaf on $T_i$ ; and
\item for all $i, j \in I$ the map
$\varphi_{ij} : \text{pr}_0^* \mathcal{F}_i \cong \text{pr}_1^* \mathcal{F}_j$
is an isomorphism on $T_i \times_T T_j$ such that the diagrams
$$
\xymatrix{
{\text{pr}_0^* \mathcal{F}_i} \ar_{\text{pr}_{02}^*\varphi_{ik}}[dr]
\ar^{\text{pr}_{01}^*\varphi_{ij}}[rr] & & {\text{pr}_1^*
\mathcal{F}_j}\ar^{\text{pr}_{12}^*\varphi_{jk}}[dl] \\
& {\text{pr}_2^* \mathcal{F}_k}
}
$$
commute on $T_i \times_T T_j \times_T T_k$.
\end{enumerate}
This descent datum is called {\it effective} if there exist a quasi-coherent
sheaf $\mathcal{F}$ over $T$ and $\mathcal{O}_{T_i}$-module isomorphisms
$\varphi_i : t_i^* \mathcal{F} \cong \mathcal{F}_i$ satisfying the cocycle
condition, namely
$$
\varphi_{ij} = \text{pr}_1^* (\varphi_j) \circ \text{pr}_0^* (\varphi_i)^{-1}.
$$
\end{definition}

\noindent
In this and the next section we discuss some ingredients of the proof
of the following theorem, as well as some related material.

\begin{theorem}
\label{theorem-descent-quasi-coherent}
If $\mathcal{V} = \{T_i \to T\}_{i\in I}$ is an fpqc covering, then all
descent data for quasi-coherent sheaves with respect to $\mathcal{V}$
are effective.
\end{theorem}

\begin{proof}
See
Descent, Proposition \ref{descent-proposition-fpqc-descent-quasi-coherent}.
\end{proof}

\noindent
In other words, the fibered category of quasi-coherent sheaves is a stack on
the fpqc site.
The proof of the theorem is in two steps. The first one is to realize that for
Zariski coverings this is easy (or well-known) using standard glueing of
sheaves (see
Sheaves, Section \ref{sheaves-section-glueing-sheaves})
and the locality of quasi-coherence. The second step is the case of an
fpqc covering of the form $\{\Spec(B) \to \Spec(A)\}$
where $A \to B$ is a faithfully flat ring map.
This is a lemma in algebra, which we now present.

\medskip\noindent
{\bf Descent of modules.}
If $A \to B$ is a ring map, we consider the complex
$$
(B/A)_\bullet : \qquad B \to B \otimes_A B \to B \otimes_A B \otimes_A B \to
\cdots
$$
where $B$ is in degree 0, $B \otimes_A B$ in degree 1, etc, and the maps are
given by
\begin{eqnarray*}
b & \mapsto & 1 \otimes b - b \otimes 1, \\
b_0 \otimes b_1 & \mapsto & 1 \otimes b_0 \otimes b_1 - b_0 \otimes 1 \otimes
b_1 + b_0 \otimes b_1 \otimes 1, \\
& \text{etc.}
\end{eqnarray*}

\begin{lemma}
\label{lemma-algebra-descent}
If $A \to B$ is faithfully flat, then the complex $(B/A)_\bullet$ is exact in
positive degrees, and $H^0((B/A)_\bullet) = A$.
\end{lemma}

\begin{proof}
See Descent, Lemma \ref{descent-lemma-ff-exact}.
\end{proof}

\noindent
Grothendieck proves this in three steps. Firstly, he assumes that the map $A
\to B$ has a section, and constructs an explicit homotopy to the complex where
$A$ is the only nonzero term, in degree 0. Secondly, he observes that to prove
the result, it suffices to do so after a faithfully flat base change $A \to
A'$, replacing $B$ with $B' = B \otimes_A A'$. Thirdly, he applies the
faithfully flat base change $A \to A' =B$ and remarks that the map $A' = B \to
B' = B \otimes_A B$ has a natural section.

\medskip\noindent
The same strategy proves the following lemma.

\begin{lemma}
\label{lemma-descent-modules}
If $A \to B$ is faithfully flat and $M$ is an $A$-module, then the
complex $(B/A)_\bullet \otimes_A M$ is exact in positive degrees, and
$H^0((B/A)_\bullet \otimes_A M) = M$.
\end{lemma}

\begin{proof}
See Descent, Lemma \ref{descent-lemma-ff-exact}.
\end{proof}

\begin{definition}
\label{definition-descent-datum-modules}
Let $A \to B$ be a ring map and $N$ a $B$-module. A {\it descent datum} for
$N$ with respect to $A \to B$ is an isomorphism
$\varphi : N \otimes_A B \cong B \otimes_A N$ of $B \otimes_A B$-modules such
that the diagram of $B \otimes_A B \otimes_A B$-modules
$$
\xymatrix{
{N \otimes_A B \otimes_A B} \ar_{\varphi_{01}}[dr] \ar^{\varphi_{02}}[rr] & &
{B \otimes_A N \otimes_A B}\ar^{\varphi_{12}}[dl] \\
& {B \otimes_A B \otimes_A N}
}
$$
commutes.
\end{definition}

\noindent
If $N' = B \otimes_A M$ for some $A$-module M, then it has a canonical descent
datum given by the map
$$
\begin{matrix}
\varphi_\text{can}: & N' \otimes_A B & \to & B \otimes_A N' \\
& b_0 \otimes m \otimes b_1 & \mapsto & b_0 \otimes b_1 \otimes m.
\end{matrix}
$$

\begin{definition}
\label{definition-effective-modules}
A descent datum $(N, \varphi)$ is called {\it effective} if there exists an
$A$-module $M$ such that $(N, \varphi) \cong (B \otimes_A M,
\varphi_\text{can})$, with the obvious notion of isomorphism of descent data.
\end{definition}

\noindent
Theorem \ref{theorem-descent-quasi-coherent} is a consequence the
following result.

\begin{theorem}
\label{theorem-descent-modules}
If $A \to B$ is faithfully flat then descent data with respect to $A\to B$
are effective.
\end{theorem}

\begin{proof}
See
Descent, Proposition \ref{descent-proposition-descent-module}.
See also
Descent, Remark \ref{descent-remark-homotopy-equivalent-cosimplicial-algebras}
for an alternative view of the proof.
\end{proof}

\begin{remarks}
\label{remarks-theorem-modules-exactness}
The results on descent of modules have several applications:
\begin{enumerate}
\item The exactness of the \u Cech complex in positive degrees for
the covering $\{\Spec(B) \to \Spec(A)\}$ where $A \to B$ is
faithfully flat. This will give some vanishing of cohomology.
\item If $(N, \varphi)$ is a descent datum with respect to a faithfully
flat map $A \to B$, then the corresponding $A$-module is given by
$$
M = \ker \left(
\begin{matrix}
N & \longrightarrow & B \otimes_A N \\
n & \longmapsto & 1 \otimes n - \varphi(n \otimes 1)
\end{matrix}
\right).
$$
See
Descent, Proposition \ref{descent-proposition-descent-module}.
\end{enumerate}
\end{remarks}




%9.17.09
\section{Quasi-coherent sheaves}
\label{section-quasi-coherent}

\noindent
We can apply the descent of modules to study quasi-coherent sheaves.

\begin{proposition}
\label{proposition-quasi-coherent-sheaf-fpqc}
For any quasi-coherent sheaf $\mathcal{F}$ on $S$ the presheaf
$$
\begin{matrix}
\mathcal{F}^a : & \Sch/S & \to & \textit{Ab}\\
& (f: T \to S) & \mapsto & \Gamma(T, f^*\mathcal{F})
\end{matrix}
$$
is an $\mathcal{O}$-module which satisfies the sheaf condition for the
fpqc topology.
\end{proposition}

\begin{proof}
This is proved in
Descent, Lemma \ref{descent-lemma-sheaf-condition-holds}.
We indicate the proof here. As established in
Lemma \ref{lemma-fpqc-sheaves},
it is enough to check the sheaf property
on Zariski coverings and faithfully flat morphisms of affine schemes. The
sheaf property for Zariski coverings is standard scheme theory, since
$\Gamma(U, i^\ast \mathcal{F}) = \mathcal{F}(U)$ when
$i : U \hookrightarrow S$ is an open immersion.

\medskip\noindent
For $\left\{\Spec(B)\to \Spec(A)\right\}$ with $A\to B$ faithfully
flat and
$\mathcal{F}|_{\Spec(A)} = \widetilde{M}$
this corresponds to the fact that
$M = H^0\left((B/A)_\bullet \otimes_A M \right)$, i.e., that
\begin{align*}
0 \to M \to B \otimes_A M \to B \otimes_A B \otimes_A M
\end{align*}
is exact by
Lemma \ref{lemma-descent-modules}.
\end{proof}

\noindent
There is an abstract notion of a quasi-coherent sheaf on a ringed site.
We briefly introduce this here. For more information please consult
Modules on Sites, Section \ref{sites-modules-section-local}.
Let $\mathcal{C}$ be a category, and let $U$ be an object of $\mathcal{C}$.
Then $\mathcal{C}/U$ indicates the category of objects over $U$, see
Categories, Example \ref{categories-example-category-over-X}.
If $\mathcal{C}$ is a site, then $\mathcal{C}/U$ is a site as well, namely
the coverings of $V/U$ are families $\{V_i/U \to V/U\}$ of morphisms
of $\mathcal{C}/U$ with fixed target such that
$\{V_i \to V\}$ is a covering of $\mathcal{C}$. Moreover, given any
sheaf $\mathcal{F}$ on $\mathcal{C}$ the {\it restriction}
$\mathcal{F}|_{\mathcal{C}/U}$ (defined in the obvious manner)
is a sheaf as well. See
Sites, Section \ref{sites-section-localize}
for details.

\begin{definition}
\label{definition-ringed-site}
Let $\mathcal{C}$ be a {\it ringed site}, i.e., a site endowed with a
sheaf of rings $\mathcal{O}$. A sheaf of $\mathcal{O}$-modules $\mathcal{F}$ on
$\mathcal{C}$ is called {\it quasi-coherent} if for all
$U \in \Ob(\mathcal{C})$ there exists a covering
$\{U_i \to U\}_{i\in I}$ of $\mathcal{C}$ such that the restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is isomorphic to the cokernel of
an $\mathcal{O}$-linear map of free $\mathcal{O}$-modules
$$
\bigoplus\nolimits_{k \in K} \mathcal{O}|_{\mathcal{C}/U_i}
\longrightarrow
\bigoplus\nolimits_{l \in L} \mathcal{O}|_{\mathcal{C}/U_i}.
$$
The direct sum over $K$ is the sheaf associated to the presheaf
$V \mapsto \bigoplus_{k \in K} \mathcal{O}(V)$ and similarly for the other.
\end{definition}

\noindent
Although it is useful to be able to give a general definition as above
this notion is not well behaved in general.

\begin{remark}
\label{remark-final-object}
In the case where $\mathcal{C}$ has a final object, e.g.\ $S$, it
suffices to check the condition of the definition for
$U = S$ in the above statement. See
Modules on Sites, Lemma \ref{sites-modules-lemma-local-final-object}.
\end{remark}

\begin{theorem}[Meta theorem on quasi-coherent sheaves]
\label{theorem-quasi-coherent}
Let $S$ be a scheme.
Let $\mathcal{C}$ be a site. Assume that
\begin{enumerate}
\item the underlying category $\mathcal{C}$ is a
full subcategory of $\Sch/S$,
\item any Zariski covering of $T \in \Ob(\mathcal{C})$
can be refined by a covering of $\mathcal{C}$,
\item $S/S$ is an object of $\mathcal{C}$,
\item every covering of $\mathcal{C}$ is an fpqc covering of schemes.
\end{enumerate}
Then the presheaf $\mathcal{O}$ is a sheaf on $\mathcal{C}$ and
any quasi-coherent $\mathcal{O}$-module on $(\mathcal{C}, \mathcal{O})$
is of the form $\mathcal{F}^a$ for some quasi-coherent sheaf
$\mathcal{F}$ on $S$.
\end{theorem}

\begin{proof}
After some formal arguments this is exactly Theorem
\ref{theorem-descent-quasi-coherent}. Details omitted. In
Descent, Proposition \ref{descent-proposition-equivalence-quasi-coherent}
we prove a more precise version of the theorem for the
big Zariski, fppf, \'etale, smooth, and syntomic sites of $S$,
as well as the small Zariski and \'etale sites of $S$.
\end{proof}

\noindent
In other words, there is no difference between quasi-coherent
modules on the scheme $S$ and quasi-coherent $\mathcal{O}$-modules
on sites $\mathcal{C}$ as in the theorem. More precise statements
for the big and small sites $(\Sch/S)_{fppf}$, $S_\etale$, etc
can be found in
Descent, Section \ref{descent-section-quasi-coherent-sheaves}.
In this chapter we will sometimes refer to a
``site as in Theorem \ref{theorem-quasi-coherent}''
in order to conveniently state results which hold in any of those
situations.






\section{Cech cohomology}
\label{section-cech-cohomology}

\noindent
Our next goal is to use descent theory to show that
$H^i(\mathcal{C}, \mathcal{F}^a) = H_{Zar}^i(S, \mathcal{F})$
for all quasi-coherent sheaves $\mathcal{F}$ on $S$, and
any site $\mathcal{C}$ as in Theorem \ref{theorem-quasi-coherent}.
To this end, we introduce \u Cech cohomology on sites.
See \cite{ArtinTopologies} and
Cohomology on Sites, Sections \ref{sites-cohomology-section-cech},
\ref{sites-cohomology-section-cech-functor}
and \ref{sites-cohomology-section-cech-cohomology-cohomology}
for more details.

\begin{definition}
\label{definition-cech-complex}
Let $\mathcal{C}$ be a category,
$\mathcal{U} = \{U_i \to U\}_{i \in I}$ a family of morphisms of $\mathcal{C}$
with fixed target, and $\mathcal{F} \in \textit{PAb}(\mathcal{C})$ an abelian
presheaf. We define the {\it \u Cech complex}
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$ by
$$
\prod_{i_0\in I} \mathcal{F}(U_{i_0}) \to
\prod_{i_0, i_1\in I} \mathcal{F}(U_{i_0} \times_U U_{i_1}) \to
\prod_{i_0, i_1, i_2 \in I}
\mathcal{F}(U_{i_0} \times_U U_{i_1} \times_U U_{i_2}) \to \cdots
$$
where the first term is in degree 0, and the maps are the usual ones. Again, it
is essential to allow the case $i_0 = i_1$ etc. The
{\it \u Cech cohomology groups} are defined by
$$
\check{H}^p(\mathcal{U}, \mathcal{F}) =
H^p(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})).
$$
\end{definition}

\begin{lemma}
\label{lemma-cech-presheaves}
The functor $\check{\mathcal{C}}^\bullet(\mathcal{U}, -)$
is exact on the category $\textit{PAb}(\mathcal{C})$.
\end{lemma}

\noindent
In other words, if $0\to \mathcal{F}_1\to \mathcal{F}_2\to \mathcal{F}_3\to 0$
is a short exact sequence of presheaves of abelian groups, then
$$
0 \to \check{\mathcal{C}}^\bullet\left(\mathcal{U}, \mathcal{F}_1\right)
\to\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}_2) \to
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}_3)\to 0
$$
is a short exact sequence of complexes.

\begin{proof}
This follows at once from the definition of a short exact sequence of
presheaves. Namely, as the category of abelian presheaves is the category of
functors on some category with values in $\textit{Ab}$, it is automatically an
abelian category: a sequence $\mathcal{F}_1\to \mathcal{F}_2\to \mathcal{F}_3$
is exact in $\textit{PAb}$ if and only if for all
$U \in \Ob(\mathcal{C})$, the sequence
$\mathcal{F}_1(U) \to \mathcal{F}_2(U) \to \mathcal{F}_3(U)$ is exact in
$\textit{Ab}$. So the complex above is merely a product of short exact
sequences in each degree. See also
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cech-exact-presheaves}.
\end{proof}

\noindent
This shows that $\check{H}^\bullet(\mathcal{U}, -)$ is a $\delta$-functor.
We now proceed to show that it is a universal $\delta$-functor. We thus need to
show that it is an {\it effaceable} functor. We start by recalling the Yoneda
lemma.

\begin{lemma}[Yoneda Lemma]
\label{lemma-yoneda-presheaf}
For any presheaf $\mathcal{F}$ on a category $\mathcal{C}$ there is a
functorial isomorphism
$$
\Hom_{\textit{PSh}(\mathcal{C})}(h_U, \mathcal{F}) =
\mathcal{F}(U).
$$
\end{lemma}

\begin{proof}
See Categories, Lemma \ref{categories-lemma-yoneda}.
\end{proof}

\noindent
Given a set $E$ we denote (in this section)
$\mathbf{Z}[E]$ the free abelian group on $E$. In a formula
$\mathbf{Z}[E] = \bigoplus_{e \in E} \mathbf{Z}$, i.e., $\mathbf{Z}[E]$ is
a free $\mathbf{Z}$-module having a basis consisting of the elements of $E$.
Using this notation we introduce the free abelian presheaf on a
presheaf of sets.

\begin{definition}
\label{definition-free-abelian-presheaf}
Let $\mathcal{C}$ be a category.
Given a presheaf of sets $\mathcal{G}$, we define the
{\it free abelian presheaf on $\mathcal{G}$},
denoted $\mathbf{Z}_\mathcal{G}$, by the rule
$$
\mathbf{Z}_\mathcal{G}(U)
=
\mathbf{Z}[\mathcal{G}(U)]
$$
for $U \in \Ob(\mathcal{C})$
with restriction maps induced by the restriction maps of $\mathcal{G}$.
In the special case $\mathcal{G} = h_U$ we write simply
$\mathbf{Z}_U = \mathbf{Z}_{h_U}$.
\end{definition}

\noindent
The functor $\mathcal{G} \mapsto \mathbf{Z}_\mathcal{G}$ is left adjoint to the
forgetful functor $\textit{PAb}(\mathcal{C}) \to \textit{PSh}(\mathcal{C})$.
Thus, for any presheaf $\mathcal{F}$, there is a canonical isomorphism
$$
\Hom_{\textit{PAb}(\mathcal{C})}(\mathbf{Z}_U, \mathcal{F})
=
\Hom_{\textit{PSh}(\mathcal{C})}(h_U, \mathcal{F})
=
\mathcal{F}(U)
$$
the last equality by the Yoneda lemma. In particular, we have the following
result.

\begin{lemma}
\label{lemma-cech-complex-describe}
The \u Cech complex $\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$
can be described explicitly as follows
\begin{eqnarray*}
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
& = &
\left(
\prod_{i_0 \in I}
\Hom_{\textit{PAb}(\mathcal{C})}(\mathbf{Z}_{U_{i_0}}, \mathcal{F}) \to
\prod_{i_0, i_1 \in I}
\Hom_{\textit{PAb}(\mathcal{C})}(
\mathbf{Z}_{U_{i_0} \times_U U_{i_1}}, \mathcal{F}) \to \ldots
\right) \\
& = &
\Hom_{\textit{PAb}(\mathcal{C})}\left(
\left(
\displaystyle
\bigoplus_{i_0 \in I} \mathbf{Z}_{U_{i_0}} \leftarrow
\bigoplus_{i_0, i_1 \in I} \mathbf{Z}_{U_{i_0} \times_U U_{i_1}} \leftarrow
\ldots
\right), \mathcal{F}\right)
\end{eqnarray*}
\end{lemma}

\begin{proof}
This follows from the formula above. See
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cech-map-into}.
\end{proof}

\noindent
This reduces us to studying only the complex in the first argument of the
last $\Hom$.

\begin{lemma}
\label{lemma-exact}
The complex of abelian presheaves
\begin{align*}
\mathbf{Z}_\mathcal{U}^\bullet \quad : \quad
\bigoplus_{i_0 \in I} \mathbf{Z}_{U_{i_0}} \leftarrow
\bigoplus_{i_0, i_1 \in I} \mathbf{Z}_{U_{i_0} \times_U U_{i_1}} \leftarrow
\bigoplus_{i_0, i_1, i_2 \in I}
\mathbf{Z}_{U_{i_0} \times_U U_{i_1} \times_U U_{i_2}} \leftarrow
\ldots
\end{align*}
is exact in all degrees except $0$ in $\textit{PAb}(\mathcal{C})$.
\end{lemma}

\begin{proof}
For any $V\in \Ob(\mathcal{C})$ the complex of abelian groups
$\mathbf{Z}_\mathcal{U}^\bullet(V)$ is
$$
\begin{matrix}
\displaystyle
\mathbf{Z}\left[
\coprod_{i_0\in I} \Mor_\mathcal{C}(V, U_{i_0})\right]
\leftarrow
\mathbf{Z}\left[
\coprod_{i_0, i_1 \in I}
\Mor_\mathcal{C}(V, U_{i_0} \times_U U_{i_1})\right]
\leftarrow \ldots = \\
\displaystyle
\bigoplus_{\varphi: V \to U}
\left(
\mathbf{Z}\left[\coprod_{i_0 \in I} \Mor_\varphi(V, U_{i_0})\right]
\leftarrow
\mathbf{Z}\left[\coprod_{i_0, i_1\in I} \Mor_\varphi(V, U_{i_0}) \times
\Mor_\varphi(V, U_{i_1})\right]
\leftarrow
\ldots
\right)
\end{matrix}
$$
where
$$
\Mor_{\varphi}(V, U_i)
=
\{ V \to U_i \text{ such that } V \to U_i \to U \text{ equals } \varphi \}.
$$
Set $S_\varphi = \coprod_{i\in I} \Mor_\varphi(V, U_i)$, so that
$$
\mathbf{Z}_\mathcal{U}^\bullet(V)
=
\bigoplus_{\varphi: V \to U}
\left(
\mathbf{Z}[S_\varphi] \leftarrow
\mathbf{Z}[S_\varphi \times S_\varphi] \leftarrow
\mathbf{Z}[S_\varphi \times S_\varphi \times S_\varphi] \leftarrow
\ldots \right).
$$
Thus it suffices to show that for each $S = S_\varphi$, the complex
\begin{align*}
\mathbf{Z}[S] \leftarrow
\mathbf{Z}[S \times S] \leftarrow
\mathbf{Z}[S \times S \times S] \leftarrow \ldots
\end{align*}
is exact in negative degrees. To see this, we can give an explicit homotopy.
Fix $s\in S$ and define $K: n_{(s_0, \ldots, s_p)} \mapsto n_{(s, s_0,
\ldots, s_p)}.$ One easily checks that $K$ is a nullhomotopy for the operator
$$
\delta :
\eta_{(s_0, \ldots, s_p)}
\mapsto
\sum\nolimits_{i=0}^p (-1)^p \eta_{(s_0, \ldots, \hat s_i, \ldots, s_p)}.
$$
See
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-homology-complex}
for more details.
\end{proof}

\begin{lemma}
\label{lemma-hom-injective}
Let $\mathcal{C}$ be a category. If $\mathcal{I}$ is an injective object of
$\textit{PAb}(\mathcal{C})$ and $\mathcal{U}$ is a family of morphisms with
fixed target in $\mathcal{C}$, then $\check H^p(\mathcal{U}, \mathcal{I}) = 0$
for all $p>0$.
\end{lemma}

\begin{proof}
The \u Cech complex is the result of applying the functor
$\Hom_{\textit{PAb}(\mathcal{C})}(-, \mathcal{I}) $ to the complex $
\mathbf{Z}^\bullet_\mathcal{U} $, i.e.,
$$
\check H^p(\mathcal{U} ; \mathcal{I}) = H^p
(\Hom_{\textit{PAb}(\mathcal{C})} (\mathbf{Z}^\bullet_\mathcal{U},
\mathcal{I})).
$$
But we have just seen that $\mathbf{Z}^\bullet_\mathcal{U}$ is exact in
negative degrees, and the functor $\Hom_{\textit{PAb}(\mathcal{C})}(-,
\mathcal{I})$ is exact, hence $\Hom_{\textit{PAb}(\mathcal{C})}
(\mathbf{Z}^\bullet_\mathcal{U}, \mathcal{I})$ is exact in positive degrees.
\end{proof}

\begin{theorem}
\label{theorem-cech-derived}
On $\textit{PAb}(\mathcal{C})$ the functors $\check{H}^p(\mathcal{U}, -)$ are
the right derived functors of $\check{H}^0(\mathcal{U}, -)$.
\end{theorem}

\begin{proof}
By the Lemma \ref{lemma-hom-injective}, the functors $\check
H^p(\mathcal{U}, -)$ are universal $\delta$-functors since they are effaceable.
So are the right derived functors of $\check H^0(\mathcal{U}, -)$. Since they
agree in degree $0$, they agree by the universal property of universal
$\delta$-functors. For more details see
Cohomology on Sites,
Lemma \ref{sites-cohomology-lemma-cech-cohomology-derived-presheaves}.
\end{proof}

\begin{remark}
\label{remark-presheaves-no-topology}
Observe that all of the preceding statements are about presheaves so we haven't
made use of the topology yet.
\end{remark}




\section{The Cech-to-cohomology spectral sequence}
\label{section-cech-ss}

\noindent
This spectral sequence is fundamental in proving foundational results on
cohomology of sheaves.

\begin{lemma}
\label{lemma-forget-injectives}
The forgetful functor $\textit{Ab}(\mathcal{C})\to \textit{PAb}(\mathcal{C})$
transforms injectives into injectives.
\end{lemma}

\begin{proof}
This is formal using the fact that the forgetful functor has a left adjoint,
namely sheafification, which is an exact functor. For more details see
Cohomology on Sites,
Lemma \ref{sites-cohomology-lemma-injective-abelian-sheaf-injective-presheaf}.
\end{proof}

\begin{theorem}
\label{theorem-cech-ss}
Let $\mathcal{C}$ be a site. For any covering
$\mathcal{U} = \{U_i \to U\}_{i \in I}$ of $U \in \Ob(\mathcal{C})$
and any abelian sheaf $\mathcal{F}$ on $\mathcal{C}$
there is a spectral sequence
$$
E_2^{p, q}
=
\check H^p(\mathcal{U}, \underline{H}^q(\mathcal{F}))
\Rightarrow
H^{p+q}(U, \mathcal{F}),
$$
where $\underline{H}^q(\mathcal{F})$ is the abelian presheaf
$V \mapsto H^q(V, \mathcal{F})$.
\end{theorem}

\begin{proof}
Choose an injective resolution $\mathcal{F}\to \mathcal{I}^\bullet$ in
$\textit{Ab}(\mathcal{C})$, and consider the double complex
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}^\bullet)$
and the maps
$$
\xymatrix{
\Gamma(U, I^\bullet) \ar[r] &
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}^\bullet) \\
& \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) \ar[u]
}
$$
Here the horizontal map is the natural map
$\Gamma(U, I^\bullet) \to
\check{\mathcal{C}}^0(\mathcal{U}, \mathcal{I}^\bullet)$
to the left column, and the vertical map is induced by
$\mathcal{F}\to \mathcal{I}^0$ and lands in the bottom row.
By assumption, $\mathcal{I}^\bullet$ is a complex of injectives in
$\textit{Ab}(\mathcal{C})$, hence by
Lemma \ref{lemma-forget-injectives}, it is a complex of injectives in
$\textit{PAb}(\mathcal{C})$. Thus, the rows of the double complex are
exact in positive degrees (Lemma \ref{lemma-hom-injective}), and
the kernel of the horizontal map is equal to
$\Gamma(U, \mathcal{I}^\bullet)$, since $\mathcal{I}^\bullet$
is a complex of sheaves. In particular, the cohomology of the total complex
is the standard
cohomology of the global sections functor $H^0(U, \mathcal{F})$.

\medskip\noindent
For the vertical direction, the $q$th cohomology group of the $p$th column is
$$
\prod_{i_0, \ldots, i_p}
H^q(U_{i_0} \times_U \ldots \times_U U_{i_p}, \mathcal{F})
=
\prod_{i_0, \dots, i_p}
\underline{H}^q(\mathcal{F})(U_{i_0} \times_U \ldots \times_U U_{i_p})
$$
in the entry $E_1^{p, q}$. So this is a standard double complex spectral
sequence, and the $E_2$-page is as prescribed. For more details see
Cohomology on Sites,
Lemma \ref{sites-cohomology-lemma-cech-spectral-sequence}.
\end{proof}

\begin{remark}
\label{remark-grothendieck-ss}
This is a Grothendieck spectral sequence for the composition of functors
$$
\textit{Ab}(\mathcal{C}) \longrightarrow
\textit{PAb}(\mathcal{C}) \xrightarrow{\check H^0} \textit{Ab}.
$$
\end{remark}








\section{Big and small sites of schemes}
\label{section-big-small}

\noindent
Let $S$ be a scheme.
Let $\tau$ be one of the topologies we will be discussing.
Thus $\tau \in \{fppf, syntomic, smooth, \etale, Zariski\}$.
Of course if you are only interested in the \'etale topology, then
you can simply assume $\tau = \etale$ throughout. Moreover, we will
discuss \'etale morphisms, \'etale coverings, and \'etale sites
in more detail starting in Section \ref{section-etale-site}.
In order to proceed with the discussion of cohomology of
quasi-coherent sheaves it is convenient to introduce the
big $\tau$-site and in case $\tau \in \{\etale, Zariski\}$, the
small $\tau$-site of $S$. In order to do this we first introduce
the notion of a $\tau$-covering.

\begin{definition}
\label{definition-tau-covering}
(See
Topologies, Definitions
\ref{topologies-definition-fppf-covering},
\ref{topologies-definition-syntomic-covering},
\ref{topologies-definition-smooth-covering},
\ref{topologies-definition-etale-covering}, and
\ref{topologies-definition-zariski-covering}.)
Let $\tau \in \{fppf, syntomic, smooth, \etale, Zariski\}$.
A family of morphisms of schemes $\{f_i : T_i \to T\}_{i \in I}$ with fixed
target is called a {\it $\tau$-covering} if and only if
each $f_i$ is flat of finite presentation, syntomic, smooth, \'etale,
resp.\ an open immersion, and we have $\bigcup f_i(T_i) = T$.
\end{definition}

\noindent
It turns out that the class of all $\tau$-coverings satisfies the axioms
(1), (2) and (3) of
Definition \ref{definition-site} (our definition of a site), see
Topologies, Lemmas
\ref{topologies-lemma-fppf},
\ref{topologies-lemma-syntomic},
\ref{topologies-lemma-smooth},
\ref{topologies-lemma-etale}, and
\ref{topologies-lemma-zariski}.
In order to be able to compare any of these new topologies to the fpqc topology
and to use the preceding results on descent on modules we single out a special
class of $\tau$-coverings of affine schemes called standard coverings.

\begin{definition}
\label{definition-standard-tau}
(See
Topologies, Definitions
\ref{topologies-definition-standard-fppf},
\ref{topologies-definition-standard-syntomic},
\ref{topologies-definition-standard-smooth},
\ref{topologies-definition-standard-etale}, and
\ref{topologies-definition-standard-Zariski}.)
Let $\tau \in \{fppf, syntomic, smooth, \etale, Zariski\}$.
Let $T$ be an affine scheme.
A {\it standard $\tau$-covering} of $T$ is a family
$\{f_j : U_j \to T\}_{j = 1, \ldots, m}$ with each $U_j$ is affine,
and each $f_j$ flat and of finite presentation,
standard syntomic, standard smooth, \'etale, resp.\ the immersion of a
standard principal open in $T$ and $T = \bigcup f_j(U_j)$.
\end{definition}

\begin{lemma}
\label{lemma-tau-affine}
Let $\tau \in \{fppf, syntomic, smooth, \etale, Zariski\}$.
Any $\tau$-covering of an affine scheme can be refined by a
standard $\tau$-covering.
\end{lemma}

\begin{proof}
See
Topologies, Lemmas
\ref{topologies-lemma-fppf-affine},
\ref{topologies-lemma-syntomic-affine},
\ref{topologies-lemma-smooth-affine},
\ref{topologies-lemma-etale-affine}, and
\ref{topologies-lemma-zariski-affine}.
\end{proof}

\noindent
Finally, we come to our definition of the sites we will be working with.
This is actually somewhat involved since, contrary to what happens in
\cite{SGA4}, we do not want to choose a universe. Instead we pick a ``partial
universe'' (which just means a suitably large set), and consider all schemes
contained in this set. Of course we make sure that our favorite base scheme
$S$ is contained in the partial universe. Having picked the underlying category
we pick a suitably large set of $\tau$-coverings which turns this into a site.
The details are in the chapter on topologies on schemes; there is a lot of
freedom in the choices made, but in the end the actual choices made will not
affect the \'etale (or other) cohomology of $S$ (just as in \cite{SGA4} the
actual choice of universe doesn't matter at the end). Moreover, the way the
material is written the reader who is happy using strongly inaccessible
cardinals (i.e., universes) can do so as a substitute.

\begin{definition}
\label{definition-tau-site}
Let $S$ be a scheme.
Let $\tau \in \{fppf, syntomic, smooth, \etale, \linebreak[0] Zariski\}$.
\begin{enumerate}
\item A {\it big $\tau$-site of $S$} is any of the sites
$(\Sch/S)_\tau$ constructed as explained above and in more detail in
Topologies, Definitions
\ref{topologies-definition-big-small-fppf},
\ref{topologies-definition-big-small-syntomic},
\ref{topologies-definition-big-small-smooth},
\ref{topologies-definition-big-small-etale}, and
\ref{topologies-definition-big-small-Zariski}.
\item If $\tau \in \{\etale, Zariski\}$, then the
{\it small $\tau$-site of $S$}
is the full subcategory $S_\tau$ of $(\Sch/S)_\tau$ whose objects
are schemes $T$ over $S$ whose structure morphism $T \to S$ is \'etale,
resp.\ an open immersion. A covering in $S_\tau$ is a covering
$\{U_i \to U\}$ in $(\Sch/S)_\tau$
such that $U$ is an object of $S_\tau$.
\end{enumerate}
\end{definition}

\noindent
The underlying category of the site $(\Sch/S)_\tau$ has reasonable
``closure'' properties, i.e., given a scheme $T$ in it any locally closed
subscheme of $T$ is isomorphic to an object of $(\Sch/S)_\tau$.
Other such closure properties are: closed under fibre products of schemes,
taking countable disjoint unions,
taking finite type schemes over a given scheme, given an affine scheme
$\Spec(R)$ one can complete, localize, or take the quotient of $R$
by an ideal while staying inside the category, etc.
On the other hand, for example arbitrary disjoint unions
of schemes in $(\Sch/S)_\tau$ will take you outside of it.
Also note that, given an object $T$ of $(\Sch/S)_\tau$ there will exist
$\tau$-coverings $\{T_i \to T\}_{i \in I}$ (as in
Definition \ref{definition-tau-covering})
which are not coverings in $(\Sch/S)_\tau$ for example
because the schemes $T_i$ are not objects of the category
$(\Sch/S)_\tau$. But our choice of the sites $(\Sch/S)_\tau$
is such that there always does exist
a covering $\{U_j \to T\}_{j \in J}$ of $(\Sch/S)_\tau$ which refines
the covering $\{T_i \to T\}_{i \in I}$, see
Topologies, Lemmas
\ref{topologies-lemma-fppf-induced},
\ref{topologies-lemma-syntomic-induced},
\ref{topologies-lemma-smooth-induced},
\ref{topologies-lemma-etale-induced}, and
\ref{topologies-lemma-zariski-induced}.
We will mostly ignore these issues in this chapter.

\medskip\noindent
If $\mathcal{F}$ is a sheaf on $(\Sch/S)_\tau$ or $S_\tau$, then
we denote
$$
H^p_\tau(U, \mathcal{F}), \text{ in particular }
H^p_\tau(S, \mathcal{F})
$$
the cohomology groups of $\mathcal{F}$ over the object $U$ of the site, see
Section \ref{section-cohomology}. Thus we have
$H^p_{fppf}(S, \mathcal{F})$,
$H^p_{syntomic}(S, \mathcal{F})$,
$H^p_{smooth}(S, \mathcal{F})$,
$H^p_\etale(S, \mathcal{F})$, and
$H^p_{Zar}(S, \mathcal{F})$. The last two are potentially ambiguous since
they might refer to either the big or small \'etale or Zariski site. However,
this ambiguity is harmless by the following lemma.

\begin{lemma}
\label{lemma-compare-cohomology-big-small}
Let $\tau \in \{\etale, Zariski\}$.
If $\mathcal{F}$ is an abelian sheaf defined on
$(\Sch/S)_\tau$, then
the cohomology groups of $\mathcal{F}$ over $S$ agree with the cohomology
groups of $\mathcal{F}|_{S_\tau}$ over $S$.
\end{lemma}

\begin{proof}
By
Topologies, Lemmas \ref{topologies-lemma-at-the-bottom} and
\ref{topologies-lemma-at-the-bottom-etale}
the functors $S_\tau \to (\Sch/S)_\tau$
satisfy the hypotheses of
Sites, Lemma \ref{sites-lemma-bigger-site}.
Hence our lemma follows from
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cohomology-bigger-site}.
\end{proof}

\noindent
For completeness we state and prove the invariance under choice of partial
universe of the cohomology groups we are considering. We will prove invariance
of the small \'etale topos in
Lemma \ref{lemma-etale-topos-independent-partial-universe} below.
For notation and terminology used in this lemma we refer to
Topologies, Section \ref{topologies-section-change-alpha}.

\begin{lemma}
\label{lemma-cohomology-enlarge-partial-universe}
Let $\tau \in \{fppf, syntomic, smooth, \etale, Zariski\}$.
Let $S$ be a scheme.
Let $(\Sch/S)_\tau$ and $(\Sch'/S)_\tau$ be two
big $\tau$-sites of $S$, and assume that the first is contained in the second.
In this case
\begin{enumerate}
\item for any abelian sheaf $\mathcal{F}'$ defined on $(\Sch'/S)_\tau$ and
any object $U$ of $(\Sch/S)_\tau$ we have
$$
H^p_\tau(U, \mathcal{F}'|_{(\Sch/S)_\tau}) =
H^p_\tau(U, \mathcal{F}')
$$
In words: the cohomology of $\mathcal{F}'$ over $U$ computed in the bigger site
agrees with the cohomology of $\mathcal{F}'$ restricted to the smaller site
over $U$.
\item for any abelian sheaf $\mathcal{F}$ on $(\Sch/S)_\tau$ there is an
abelian sheaf $\mathcal{F}'$ on $(\Sch/S)_\tau'$ whose restriction to
$(\Sch/S)_\tau$ is isomorphic to $\mathcal{F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
By Topologies, Lemma \ref{topologies-lemma-change-alpha} the inclusion functor
$(\Sch/S)_\tau \to (\Sch'/S)_\tau$ satisfies the assumptions of
Sites, Lemma \ref{sites-lemma-bigger-site}. This implies (2) and (1)
follows from
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cohomology-bigger-site}.
\end{proof}




\section{The \'etale topos}
\label{section-etale-topos}

\noindent
A {\it topos} is the category of sheaves of sets on a site, see
Sites, Definition \ref{sites-definition-topos}. Hence it is customary
to refer to the use the phrase ``\'etale topos of a scheme'' to refer to
the category of sheaves on the small \'etale site of a scheme.
Here is the formal definition.

\begin{definition}
\label{definition-etale-topos}
Let $S$ be a scheme.
\begin{enumerate}
\item The {\it \'etale topos}, or the {\it small \'etale topos}
of $S$ is the category $\Sh(S_\etale)$ of sheaves of sets on
the small \'etale site of $S$.
\item The {\it Zariski topos}, or the {\it small Zariski topos}
of $S$ is the category $\Sh(S_{Zar})$ of sheaves of sets on the
small Zariski site of $S$.
\item For $\tau \in \{fppf, syntomic, smooth, \etale, Zariski\}$ a
{\it big $\tau$-topos} is the category of sheaves of set on a
big $\tau$-topos of $S$.
\end{enumerate}
\end{definition}

\noindent
Note that the small Zariski topos of $S$ is simply the category of sheaves
of sets on the underlying topological space of $S$, see
Topologies, Lemma \ref{topologies-lemma-Zariski-usual}.
Whereas the small \'etale topos does not depend on the choices made in the
construction of the small \'etale site, in general the big topoi do depend
on those choices.

\medskip\noindent
Here is a lemma, which is one of many possible lemmas expressing the
fact that it doesn't matter too much which site we choose to define
the small \'etale topos of a scheme.

\begin{lemma}
\label{lemma-alternative}
Let $S$ be a scheme. Let $S_{affine, \etale}$ denote the
full subcategory of $S_\etale$
whose objects are those $U/S \in \Ob(S_\etale)$ with
$U$ affine. A covering of $S_{affine, \etale}$ will be a standard
\'etale covering, see
Topologies, Definition \ref{topologies-definition-standard-etale}.
Then restriction
$$
\mathcal{F} \longmapsto \mathcal{F}|_{S_{affine, \etale}}
$$
defines an equivalence of topoi
$\Sh(S_\etale) \cong \Sh(S_{affine, \etale})$.
\end{lemma}

\begin{proof}
This you can show directly from the definitions, and is a good exercise.
But it also follows immediately from
Sites, Lemma \ref{sites-lemma-equivalence}
by checking that the inclusion functor
$S_{affine, \etale} \to S_\etale$
is a special cocontinuous functor (see
Sites, Definition \ref{sites-definition-special-cocontinuous-functor}).
\end{proof}

\begin{lemma}
\label{lemma-etale-topos-independent-partial-universe}
Let $S$ be a scheme. The \'etale topos of $S$ is independent
(up to canonical equivalence) of the construction of the small
\'etale site in Definition \ref{definition-tau-site}.
\end{lemma}

\begin{proof}
We have to show, given two big \'etale sites
$\Sch_\etale$ and $\Sch_\etale'$ containing
$S$, then $\Sh(S_\etale) \cong \Sh(S_\etale')$
with obvious notation. By Topologies, Lemma \ref{topologies-lemma-contained-in}
we may assume $\Sch_\etale \subset \Sch_\etale'$.
By Sets, Lemma \ref{sets-lemma-what-is-in-it}
any affine scheme \'etale over $S$ is isomorphic to an object
of both $\Sch_\etale$ and $\Sch_\etale'$.
Thus the induced functor
$S_{affine, \etale} \to S_{affine, \etale}'$
is an equivalence. Moreover, it is clear that both this functor
and a quasi-inverse map transform standard \'etale coverings into
standard \'etale coverings.
Hence the result follows from Lemma \ref{lemma-alternative}.
\end{proof}





\section{Cohomology of quasi-coherent sheaves}
\label{section-cohomology-quasi-coherent}
%9.22.09

\noindent
We start with a simple lemma (which holds in greater generality than
stated). It says that the \u Cech complex of a standard covering is
equal to the \u Cech complex of an fpqc covering of the form
$\{\Spec(B) \to \Spec(A)\}$ with $A \to B$ faithfully flat.

\begin{lemma}
\label{lemma-cech-complex}
Let $\tau \in \{fppf, syntomic, smooth, \etale, Zariski\}$.
Let $S$ be a scheme.
Let $\mathcal{F}$ be an abelian sheaf on $(\Sch/S)_\tau$, or on
$S_\tau$ in case $\tau = \etale$, and let
$\mathcal{U} = \{U_i \to U\}_{i \in I}$
be a standard $\tau$-covering of this site.
Let $V = \coprod_{i \in I} U_i$. Then
\begin{enumerate}
\item $V$ is an affine scheme,
\item $\mathcal{V} = \{V \to U\}$ is a $\tau$-covering and an fpqc covering,
\item the \u Cech complexes
$\check{\mathcal{C}}^\bullet (\mathcal{U}, \mathcal{F})$ and
$\check{\mathcal{C}}^\bullet (\mathcal{V}, \mathcal{F})$ agree.
\end{enumerate}
\end{lemma}

\begin{proof}
As the covering is a standard $\tau$-covering each of the schemes
$U_i$ is affine and $I$ is a finite set. Hence $V$ is an affine scheme.
It is clear that $V \to U$ is flat and surjective, hence
$\mathcal{V}$ is an fpqc covering, see
Example \ref{example-fpqc-coverings}.
Note that $\mathcal{U}$ is a refinement of $\mathcal{V}$
and hence there is a map of \u Cech complexes
$\check{\mathcal{C}}^\bullet (\mathcal{V}, \mathcal{F}) \to
\check{\mathcal{C}}^\bullet (\mathcal{U}, \mathcal{F})$, see
Cohomology on Sites,
Equation (\ref{sites-cohomology-equation-map-cech-complexes}).
Next, we observe that if $T = \coprod_{j \in J} T_j$ is a
disjoint union of schemes in the site on which $\mathcal{F}$ is defined
then the family of morphisms with fixed target
$\{T_j \to T\}_{j \in J}$ is a Zariski covering, and so
\begin{equation}
\label{equation-sheaf-coprod}
\mathcal{F}(T) =
\mathcal{F}(\coprod\nolimits_{j \in J} T_j) =
\prod\nolimits_{j \in J} \mathcal{F}(T_j)
\end{equation}
by the sheaf condition of $\mathcal{F}$.
This implies the map of \u Cech complexes above is an isomorphism
in each degree because
$$
V \times_U \ldots \times_U V
=
\prod\nolimits_{i_0, \ldots i_p} U_{i_0} \times_U \ldots \times_U U_{i_p}
$$
as schemes.
\end{proof}

\noindent
Note that Equality (\ref{equation-sheaf-coprod})
is false for a general presheaf. Even for sheaves it does not hold on any
site, since coproducts may not lead to coverings, and may not be disjoint.
But it does for all the usual ones (at least all the ones we will study).

\begin{remark}
\label{remark-refinement}
In the statement of Lemma \ref{lemma-cech-complex} the covering $\mathcal{U}$
is a refinement of $\mathcal{V}$ but not the other way around. Coverings
of the form $\{V \to U\}$ do not form an initial subcategory of the
category of all coverings of $U$. Yet it is still true that
we can compute \u Cech cohomology $\check H^n(U, \mathcal{F})$ (which
is defined as the colimit over the opposite of the category of
coverings $\mathcal{U}$ of $U$ of the Cech cohomology groups of
$\mathcal{F}$ with respect to $\mathcal{U}$) in terms of the coverings
$\{V \to U\}$. We will formulate a precise lemma (it only works for sheaves)
and add it here if we ever need it.
\end{remark}

\begin{lemma}[Locality of cohomology]
\label{lemma-locality-cohomology}
Let $\mathcal{C}$ be a site, $\mathcal{F}$ an abelian sheaf on $\mathcal{C}$,
$U$ an object of $\mathcal{C}$, $p >0$ an integer and $\xi \in
H^p(U, \mathcal{F})$. Then there exists a covering
$\mathcal{U} = \{U_i \to U\}_{i \in I}$ of $U$ in $\mathcal{C}$
such that $\xi |_{U_i} = 0$ for all $i \in I$.
\end{lemma}

\begin{proof}
Choose an injective resolution $\mathcal{F} \to \mathcal{I}^\bullet$. Then
$\xi$ is represented by a cocycle $\tilde{\xi} \in \mathcal{I}^p(U)$
with $d^p(\tilde{\xi}) = 0$. By assumption, the sequence
$\mathcal{I}^{p - 1} \to \mathcal{I}^p \to \mathcal{I}^{p + 1}$ in exact in
$\textit{Ab}(\mathcal{C})$, which means that there exists a covering
$\mathcal{U} = \{U_i \to U\}_{i \in I}$ such that
$\tilde{\xi}|_{U_i} = d^{p - 1}(\xi_i)$ for some
$\xi_i \in \mathcal{I}^{p-1}(U_i)$. Since
the cohomology class $\xi|_{U_i}$ is represented by the cocycle
$\tilde{\xi}|_{U_i}$ which is a coboundary, it vanishes.
For more details see
Cohomology on Sites,
Lemma \ref{sites-cohomology-lemma-kill-cohomology-class-on-covering}.
\end{proof}

\begin{theorem}
\label{theorem-zariski-fpqc-quasi-coherent}
Let $S$ be a scheme and $\mathcal{F}$ a quasi-coherent $\mathcal{O}_S$-module.
Let $\mathcal{C}$ be either $(\Sch/S)_\tau$ for
$\tau \in \{fppf, syntomic, smooth, \etale, Zariski\}$ or
$S_\etale$. Then
$$
H^p(S, \mathcal{F}) = H^p_\tau(S, \mathcal{F}^a)
$$
for all $p \geq 0$ where
\begin{enumerate}
\item the left hand side indicates the usual cohomology of the sheaf
$\mathcal{F}$ on the underlying topological space of the scheme $S$, and
\item the right hand side indicates cohomology
of the abelian sheaf $\mathcal{F}^a$ (see
Proposition \ref{proposition-quasi-coherent-sheaf-fpqc})
on the site $\mathcal{C}$.
\end{enumerate}
\end{theorem}

\begin{proof}
We are going to show that
$H^p(U, f^*\mathcal{F}) = H^p_\tau(U, \mathcal{F}^a)$
for any object $f : U \to S$ of the site $\mathcal{C}$.
The result is true for $p = 0$ by the sheaf property.

\medskip\noindent
Assume that $U$ is affine. Then we want to prove that
$H^p_\tau(U, \mathcal{F}^a) = 0$ for all $p > 0$. We use induction on $p$.
\begin{enumerate}
\item[$p = 1$]
Pick $\xi \in H^1_\tau(U, \mathcal{F}^a)$.
By Lemma \ref{lemma-locality-cohomology},
there exists an fpqc covering $\mathcal{U} = \{U_i \to U\}_{i \in I}$
such that $\xi|_{U_i} = 0$ for all $i \in I$. Up to refining
$\mathcal{U}$, we may assume that $\mathcal{U}$ is a standard
$\tau$-covering. Applying the spectral sequence of
Theorem \ref{theorem-cech-ss},
we see that $\xi$ comes from a cohomology class
$\check{\xi} \in \check H^1(\mathcal{U}, \mathcal{F}^a)$.
Consider the covering $\mathcal{V} = \{\coprod_{i\in I} U_i \to U\}$. By
Lemma \ref{lemma-cech-complex},
$\check H^\bullet(\mathcal{U}, \mathcal{F}^a) =
\check H^\bullet(\mathcal{V}, \mathcal{F}^a)$.
On the other hand, since $\mathcal{V}$ is a covering of the form
$\{\Spec(B) \to \Spec(A)\}$ and $f^*\mathcal{F} = \widetilde{M}$
for some $A$-module $M$, we see the \u Cech complex
$\check{\mathcal{C}}^\bullet(\mathcal{V}, \mathcal{F})$
is none other than the complex $(B/A)_\bullet \otimes_A M$.
Now by Lemma \ref{lemma-descent-modules},
$H^p((B/A)_\bullet \otimes_A M) = 0$ for $p>0$, hence $\check{\xi} = 0$ and so
$\xi = 0$.
\item[$p > 1$]
Pick $\xi \in H^p_\tau(U, \mathcal{F}^a)$. By
Lemma \ref{lemma-locality-cohomology},
there exists an fpqc covering $\mathcal{U} = \{U_i \to U\}_{i \in I}$
such that $\xi|_{U_i} = 0$ for all $i \in I$. Up to refining
$\mathcal{U}$, we may assume that $\mathcal{U}$ is a standard
$\tau$-covering. We apply the spectral sequence of
Theorem \ref{theorem-cech-ss}.
Observe that the intersections $U_{i_0} \times_U \ldots \times_U U_{i_p}$
are affine, so that by induction hypothesis the cohomology groups
$$
E_2^{p, q} = \check H^p(\mathcal{U}, \underline{H}^q(\mathcal{F}^a))
$$
vanish for all $0 < q < p$. We see that $\xi$ must come from a
$\check{\xi} \in \check H^p(\mathcal{U}, \mathcal{F}^a)$. Replacing
$\mathcal{U}$ with the covering $\mathcal{V}$ containing only one morphism
and using Lemma \ref{lemma-descent-modules} again,
we see that the \u Cech cohomology class $\check{\xi}$ must be zero,
hence $\xi = 0$.
\end{enumerate}
Next, assume that $U$ is separated. Choose an affine open covering
$U = \bigcup_{i \in I} U_i$ of $U$. The family
$\mathcal{U} = \{U_i \to U\}_{i \in I}$ is then an fpqc covering,
and all the intersections
$U_{i_0} \times_S \cdots \times_S U_{i_p}$ are affine
since $U$ is separated. So all rows of the spectral sequence of
Theorem \ref{theorem-cech-ss}
are zero, except the zeroth row. Therefore
$$
H^p_\tau(S, \mathcal{F}^a) =
\check H^p(\mathcal{U}, \mathcal{F}^a) =
\check H^p(\mathcal{U}, \mathcal{F}) = H^p(S, \mathcal{F})
$$
where the last equality results from standard scheme theory, see
Cohomology of Schemes, Lemma
\ref{coherent-lemma-cech-cohomology-quasi-coherent}.

\medskip\noindent
The general case is technical and (to extend the proof as given here)
requires a discussion about maps of spectral sequences, so we won't treat it.
It follows from
Descent, Proposition \ref{descent-proposition-same-cohomology-quasi-coherent}
(whose proof takes a slightly different approach) combined with
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cohomology-of-open}.
\end{proof}

\begin{remark}
\label{remark-right-derived-global-sections}
Comment on Theorem \ref{theorem-zariski-fpqc-quasi-coherent}.
Since $S$ is a final object in the category $\mathcal{C}$, the cohomology
groups on the right-hand side are merely the right derived functors of the
global sections functor. In fact the proof shows that
$H^p(U, f^*\mathcal{F}) = H^p_\tau(U, \mathcal{F}^a)$
for any object $f : U \to S$ of the site $\mathcal{C}$.
\end{remark}





\section{Examples of sheaves}
\label{section-examples-sheaves}

\noindent
Let $S$ and $\tau$ be as in Section \ref{section-big-small}.
We have already seen that any representable presheaf is a sheaf on
$(\Sch/S)_\tau$ or $S_\tau$, see
Lemma \ref{lemma-representable-sheaf-fpqc}
and
Remark \ref{remark-fpqc-finest}.
Here are some special cases.

\begin{definition}
\label{definition-additive-sheaf}
On any of the sites $(\Sch/S)_\tau$ or $S_\tau$ of
Section \ref{section-big-small}.
\begin{enumerate}
\item The sheaf $T \mapsto \Gamma(T, \mathcal{O}_T)$ is denoted
$\mathcal{O}_S$, or $\mathbf{G}_a$, or $\mathbf{G}_{a, S}$ if we
want to indicate the base scheme.
\item Similarly, the sheaf
$T \mapsto \Gamma(T, \mathcal{O}^*_T)$ is denoted $\mathcal{O}_S^*$, or
$\mathbf{G}_m$, or $\mathbf{G}_{m, S}$ if we want
to indicate the base scheme.
\item The {\it constant sheaf} $\underline{\mathbf{Z}/n\mathbf{Z}}$ on any
site is the sheafification of the constant presheaf
$U \mapsto \mathbf{Z}/n\mathbf{Z}$.
\end{enumerate}
\end{definition}

\noindent
The first is a sheaf by
Theorem \ref{theorem-quasi-coherent}
for example. The second is a sub presheaf of the first, which is easily seen
to be a sheaf itself. The third is a sheaf by definition.
Note that each of these sheaves is representable.
The first and second by the schemes $\mathbf{G}_{a, S}$ and
$\mathbf{G}_{m, S}$, see
Groupoids, Section \ref{groupoids-section-group-schemes}.
The third by the finite \'etale group scheme $\mathbf{Z}/n\mathbf{Z}_S$
sometimes denoted $(\mathbf{Z}/n\mathbf{Z})_S$
which is just $n$ copies of $S$ endowed
with the obvious group scheme structure over $S$, see
Groupoids, Example \ref{groupoids-example-constant-group}
and the following remark.

\begin{remark}
\label{remark-constant-locally-constant-maps}
Let $G$ be an abstract group.
On any of the sites $(\Sch/S)_\tau$ or $S_\tau$ of
Section \ref{section-big-small}
the sheafification $\underline{G}$
of the constant presheaf associated to $G$ in the
{\it Zariski topology} of the site already gives
$$
\Gamma(U, \underline{G}) =
\{\text{Zariski locally constant maps }U \to G\}
$$
This Zariski sheaf is representable by the group scheme $G_S$ according to
Groupoids, Example \ref{groupoids-example-constant-group}.
By
Lemma \ref{lemma-representable-sheaf-fpqc}
any representable presheaf satisfies the sheaf condition for the
$\tau$-topology as well, and hence we conclude that the Zariski
sheafification $\underline{G}$ above is also the $\tau$-sheafification.
\end{remark}

\begin{definition}
\label{definition-structure-sheaf}
Let $S$ be a scheme. The {\it structure sheaf} of $S$ is the sheaf of rings
$\mathcal{O}_S$
on any of the sites $S_{Zar}$, $S_\etale$, or $(\Sch/S)_\tau$
discussed above.
\end{definition}

\noindent
If there is some possible confusion as to which site we are working on
then we will indicate this by using indices. For example we may use
$\mathcal{O}_{S_\etale}$ to stress the fact that we are working on the
small \'etale site of $S$.

\begin{remark}
\label{remark-special-case-fpqc-cohomology-quasi-coherent}
In the terminology introduced above a special case of
Theorem \ref{theorem-zariski-fpqc-quasi-coherent}
is
$$
H_{fppf}^p(X, \mathbf{G}_a) =
H_\etale^p(X, \mathbf{G}_a) =
H_{Zar}^p(X, \mathbf{G}_a) =
H^p(X, \mathcal{O}_X)
$$
for all $p \geq 0$. Moreover, we could use the notation
$H^p_{fppf}(X, \mathcal{O}_X)$ to indicate the cohomology of the
structure sheaf on the big fppf site of $X$.
\end{remark}




\section{Picard groups}
\label{section-picard-groups}

\noindent
The following theorem is sometimes called ``Hilbert 90''.

\begin{theorem}
\label{theorem-picard-group}
For any scheme $X$ we have canonical identifications
\begin{align*}
H_{fppf}^1(X, \mathbf{G}_m) & = H^1_{syntomic}(X, \mathbf{G}_m) \\
& = H^1_{smooth}(X, \mathbf{G}_m) \\
& = H_\etale^1(X, \mathbf{G}_m) \\
& = H^1_{Zar}(X, \mathbf{G}_m) \\
& = \text{Pic}(X) \\
& = H^1(X, \mathcal{O}_X^*)
\end{align*}
\end{theorem}

\begin{proof}
Let $\tau$ be one of the topologies considered in
Section \ref{section-big-small}.
By
Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-h1-invertible}
we see that
$H^1_\tau(X, \mathbf{G}_m) =
H^1_\tau(X, \mathcal{O}_\tau^*) =
\text{Pic}(\mathcal{O}_\tau)$
where $\mathcal{O}_\tau$ is the structure sheaf of the site
$(\Sch/X)_\tau$. Now an invertible $\mathcal{O}_\tau$-module
is a quasi-coherent $\mathcal{O}_\tau$-module.
By Theorem \ref{theorem-quasi-coherent} or the more precise
Descent, Proposition \ref{descent-proposition-equivalence-quasi-coherent}
we see that $\text{Pic}(\mathcal{O}_\tau) = \text{Pic}(X)$.
The last equality is proved in the same way.
\end{proof}






\section{The \'etale site}
\label{section-etale-site}

\noindent
At this point we start exploring the \'etale site of a scheme in
more detail. As a first step we discuss a little the notion of an
\'etale morphism.





\section{\'Etale morphisms}
\label{section-etale-morphism}

\noindent
For more details, see
Morphisms, Section \ref{morphisms-section-etale}
for the formal definition and
\'Etale Morphisms, Sections
\ref{etale-section-etale-morphisms},
\ref{etale-section-structure-etale-map},
\ref{etale-section-etale-smooth},
\ref{etale-section-topological-etale},
\ref{etale-section-functorial-etale}, and
\ref{etale-section-properties-permanence}
for a survey of interesting properties of \'etale morphisms.

\medskip\noindent
Recall that an algebra $A$ over an algebraically closed field $k$ is
{\it smooth} if it is of finite type and the module of differentials
$\Omega_{A/k}$ is finite locally free of rank equal to the dimension.
A scheme $X$ over $k$ is {\it smooth} over $k$ if it is locally of finite
type and each affine open is the spectrum of a smooth $k$-algebra.
If $k$ is not algebraically closed then an $A$-algebra is said to be
a smooth $k$-algebra if $A \otimes_k \overline{k}$ is a smooth
$\overline{k}$-algebra. A ring map $A \to B$ is smooth if it is
flat, finitely presented, and for all primes $\mathfrak p \subset A$
the fibre ring $\kappa(\mathfrak p) \otimes_A B$ is smooth over the residue
field $\kappa(\mathfrak p)$. More generally, a morphism of schemes is
{\it smooth} if it is flat, locally of finite presentation, and the
geometric fibers are smooth.

\medskip\noindent
For these facts please see
Morphisms, Section \ref{morphisms-section-smooth}.
Using this we may define an \'etale morphism as follows.

\begin{definition}
\label{definition-etale-morphism}
A morphism of schemes is {\it \'etale} if it is smooth of relative dimension 0.
\end{definition}

\noindent
In particular, a morphism of schemes $X \to S$ is \'etale if it is smooth
and $\Omega_{X/S} = 0$.

\begin{proposition}
\label{proposition-etale-morphisms}
Facts on \'etale morphisms.
\begin{enumerate}
\item Let $k$ be a field. A morphism of schemes $U \to \Spec(k)$ is
\'etale if and only if $U \cong \coprod_{i \in I} \Spec(k_i)$
such that for each $i \in I$
the ring $k_i$ is a field which is a finite separable extension of $k$.
\item Let $\varphi : U \to S$ be a morphism of schemes. The following
conditions are equivalent:
\begin{enumerate}
\item $\varphi$ is \'etale,
\item $\varphi$ is locally finitely presented, flat, and all its fibres are
\'etale,
\item $\varphi$ is flat, unramified and locally of finite presentation.
\end{enumerate}
\item A ring map $A \to B$ is \'etale if and only if
$B \cong A[x_1, \dots, x_n]/(f_1, \dots, f_n)$
such that $\Delta = \det \left( \frac{\partial f_i}{\partial x_j} \right)$
is invertible in $B$.
\item The base change of an \'etale morphism is \'etale.
\item Compositions of \'etale morphisms are \'etale.
\item Fibre products and products of \'etale morphisms are \'etale.
\item An \'etale morphism has relative dimension 0.
\item Let $Y \to X$ be an \'etale morphism.
If $X$ is reduced (respectively regular) then so is $Y$.
\item \'Etale morphisms are open.
\item If $X \to S$ and $Y \to S$ are \'etale, then any
$S$-morphism $X \to Y$ is also \'etale.
\end{enumerate}
\end{proposition}

\begin{proof}
We have proved these facts (and more) in the preceding chapters.
Here is a list of references:
(1) Morphisms, Lemma \ref{morphisms-lemma-etale-over-field}.
(2) Morphisms, Lemmas \ref{morphisms-lemma-etale-flat-etale-fibres}
and \ref{morphisms-lemma-flat-unramified-etale}.
(3) Algebra, Lemma \ref{algebra-lemma-etale-standard-smooth}.
(4) Morphisms, Lemma \ref{morphisms-lemma-base-change-etale}.
(5) Morphisms, Lemma \ref{morphisms-lemma-composition-etale}.
(6) Follows formally from (4) and (5).
(7) Morphisms, Lemmas \ref{morphisms-lemma-etale-locally-quasi-finite}
and \ref{morphisms-lemma-locally-quasi-finite-rel-dimension-0}.
(8) See Algebra, Lemmas \ref{algebra-lemma-reduced-goes-up} and
\ref{algebra-lemma-Rk-goes-up}, see also more results of this kind
in \'Etale Morphisms, Section \ref{etale-section-properties-permanence}.
(9) See Morphisms, Lemma \ref{morphisms-lemma-fppf-open} and
\ref{morphisms-lemma-etale-flat}.
(10) See Morphisms, Lemma \ref{morphisms-lemma-etale-permanence}.
\end{proof}

\begin{definition}
\label{definition-standard-etale}
A ring map $A \to B$ is called {\it standard \'etale} if
$B \cong \left(A[t]/(f)\right)_g$ with $f, g \in A[t]$, with $f$ monic,
and $\text{d}f/\text{d}t$ invertible in $B$.
\end{definition}

\noindent
It is true that a standard \'etale ring map is \'etale. Namely, suppose
that $B = \left(A[t]/(f)\right)_g$ with $f, g \in A[t]$, with $f$ monic,
and $\text{d}f/\text{d}t$ invertible in $B$. Then $A[t]/(f)$ is a finite
free $A$-module of rank equal to the degree of the monic polynomial $f$.
Hence $B$, as a localization of this free algebra is finitely presented
and flat over $A$. To finish the proof that $B$ is \'etale it suffices
to show that the fibre rings
$$
\kappa(\mathfrak p) \otimes_A B
\cong
\kappa(\mathfrak p) \otimes_A (A[t]/(f))_g
\cong
\kappa(\mathfrak p)[t, 1/\overline{g}]/(\overline{f})
$$
are finite products of finite separable field extensions.
Here $\overline{f}, \overline{g} \in \kappa(\mathfrak p)[t]$ are
the images of $f$ and $g$. Let
$$
\overline{f} = \overline{f}_1 \ldots \overline{f}_a
\overline{f}_{a + 1}^{e_1} \ldots \overline{f}_{a + b}^{e_b}
$$
be the factorization of $\overline{f}$ into powers of pairwise distinct
irreducible monic factors $\overline{f}_i$ with $e_1, \ldots, e_b > 0$.
By assumption $\text{d}\overline{f}/\text{d}t$ is invertible in
$\kappa(\mathfrak p)[t, 1/\overline{g}]$. Hence we see that
at least all the $\overline{f}_i$, $i > a$ are invertible. We conclude
that
$$
\kappa(\mathfrak p)[t, 1/\overline{g}]/(\overline{f})
\cong
\prod\nolimits_{i \in I} \kappa(\mathfrak p)[t]/(\overline{f}_i)
$$
where $I \subset \{1, \ldots, a\}$ is the subset of indices $i$ such that
$\overline{f}_i$ does not divide $\overline{g}$. Moreover, the image of
$\text{d}\overline{f}/\text{d}t$ in the factor
$\kappa(\mathfrak p)[t]/(\overline{f}_i)$ is clearly equal to a
unit times $\text{d}\overline{f}_i/\text{d}t$. Hence we conclude that
$\kappa_i = \kappa(\mathfrak p)[t]/(\overline{f}_i)$ is a finite field
extension of $\kappa(\mathfrak p)$ generated by one element whose
minimal polynomial is separable, i.e., the field extension
$\kappa(\mathfrak p) \subset \kappa_i$ is finite separable as desired.

\medskip\noindent
It turns out that any \'etale ring map is locally standard \'etale.
To formulate this we introduce the following notation.
A ring map $A \to B$ is {\it \'etale at a prime $\mathfrak q$} of $B$ if there
exists $h \in B$, $h \not \in \mathfrak q$ such that $A \to B_h$ is \'etale.
Here is the result.

\begin{theorem}
\label{theorem-standard-etale}
A ring map $A \to B$ is \'etale at a prime $\mathfrak q$ if and only if there
exists $g \in B$, $g \not \in \mathfrak q$ such that $B_g$ is standard
\'etale over $A$.
\end{theorem}

\begin{proof}
See
Algebra, Proposition \ref{algebra-proposition-etale-locally-standard}.
\end{proof}





\section{\'Etale coverings}
\label{section-etale-covering}

\noindent
We recall the definition.

\begin{definition}
\label{definition-etale-covering}
An {\it \'etale covering} of a scheme $U$ is a family of morphisms
of schemes
$\{\varphi_i : U_i \to U\}_{i \in I}$ such that
\begin{enumerate}
\item each $\varphi_i$ is an \'etale morphism ;
\item the $U_i$ cover $U$, i.e., $U = \bigcup_{i\in I}\varphi_i(U_i)$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-etale-fpqc}
Any \'etale covering is an fpqc covering.
\end{lemma}

\begin{proof}
(See also
Topologies,
Lemma \ref{topologies-lemma-zariski-etale-smooth-syntomic-fppf-fpqc}.)
Let $\{\varphi_i : U_i \to U\}_{i \in I}$ be an \'etale covering.
Since an \'etale morphism is flat, and the elements of the covering should
cover its target, the property fp (faithfully flat) is satisfied.
To check the property qc (quasi-compact), let $V \subset U$ be an affine
open, and write $\varphi_i^{-1} = \bigcup_{j \in J_i} V_{ij}$
for some affine opens $V_{ij} \subset U_i$. Since $\varphi_i$ is open
(as \'etale morphisms are open), we see that
$V = \bigcup_{i\in I} \bigcup_{j \in J_i} \varphi_i(V_{ij})$
is an open covering of $U$.
Further, since $V$ is quasi-compact, this covering has a finite
refinement.
\end{proof}

\noindent
So any statement which is true for fpqc coverings
remains true {\it a fortiori} for \'etale coverings. For
instance, the \'etale site is subcanonical.

\begin{definition}
\label{definition-big-etale-site}
(For more details see Section \ref{section-big-small}, or
Topologies, Section \ref{topologies-section-etale}.)
Let $S$ be a scheme.
The {\it big \'etale site over $S$} is the site
$(\Sch/S)_\etale$, see
Definition \ref{definition-tau-site}.
The {\it small \'etale site over $S$} is the site $S_\etale$, see
Definition \ref{definition-tau-site}.
We define similarly the {\it big} and {\it small Zariski sites} on $S$,
denoted $(\Sch/S)_{Zar}$ and $S_{Zar}$.
\end{definition}

\noindent
Loosely speaking the big \'etale site of $S$ is made up out of schemes over $S$
and coverings the \'etale coverings. The small \'etale site of $S$ is made up
out of schemes \'etale over $S$ with coverings the \'etale coverings.
Actually any morphism between objects of $S_\etale$ is \'etale, in
virtue of
Proposition \ref{proposition-etale-morphisms},
hence to check that $\{U_i \to U\}_{i \in I}$ in $S_\etale$
is a covering it suffices to check that $\coprod U_i \to U$ is surjective.

\medskip\noindent
The small \'etale site has fewer objects than the big \'etale site, it
contains only the ``opens'' of the \'etale topology on $S$. It is a full
subcategory of the big \'etale site, and its topology is induced from the
topology on the big site. Hence it is true that the restriction functor
from the big \'etale site to the small one is exact and maps injectives to
injectives. This has the following consequence.

\begin{proposition}
\label{proposition-cohomology-restrict-small-site}
Let $S$ be a scheme and $\mathcal{F}$ an abelian sheaf on
$(\Sch/S)_\etale$.
Then $\mathcal{F}|_{S_\etale}$ is a sheaf on $S_\etale$ and
$$
H^p_\etale(S, \mathcal{F}|_{S_\etale}) =
H^p_\etale(S, \mathcal{F})
$$
for all $p \geq 0$.
\end{proposition}

\begin{proof}
This is a special case of Lemma \ref{lemma-compare-cohomology-big-small}.
\end{proof}

\noindent
In accordance with the general notation introduced in
Section \ref{section-big-small}
we write $H_\etale^p(S, \mathcal{F})$ for the above cohomology group.





%9.24.09
\section{Kummer theory}
\label{section-kummer}

\noindent
Let $n \in \mathbf{N}$ and consider the functor $\mu_n$ defined by
$$
\begin{matrix}
\Sch^{opp} & \longrightarrow & \textit{Ab} \\
S & \longmapsto &
\mu_n(S)
=
\{t \in \Gamma(S, \mathcal{O}_S^*) \mid t^n = 1 \}.
\end{matrix}
$$
By
Groupoids, Example \ref{groupoids-example-roots-of-unity}
this is a representable functor, and the scheme representing it
is denoted $\mu_n$ also. By
Lemma \ref{lemma-representable-sheaf-fpqc}
this functor satisfies the sheaf condition for the fpqc topology
(in particular, it is also satisfies the sheaf condition for the
\'etale, Zariski, etc topology).

\begin{lemma}
\label{lemma-kummer-sequence}
If $n\in \mathcal{O}_S^*$ then
$$
0 \to
\mu_{n, S} \to
\mathbf{G}_{m, S} \xrightarrow{(\cdot)^n}
\mathbf{G}_{m, S} \to 0
$$
is a short exact sequence of sheaves on both the small and
big \'etale site of $S$.
\end{lemma}

\begin{proof}
By definition the sheaf $\mu_{n, S}$ is the kernel of the map
$(\cdot)^n$. Hence it suffices to show that the last map is surjective.
Let $U$ be a scheme over $S$. Let
$f \in \mathbf{G}_m(U) = \Gamma(U, \mathcal{O}_U^*)$.
We need to show that we can find an \'etale cover of
$U$ over the members of which the restriction of $f$ is an $n$th power.
Set
$$
U' =
\underline{\Spec}_U(\mathcal{O}_U[T]/(T^n-f))
\xrightarrow{\pi}
U.
$$
(See
Constructions, Section \ref{constructions-section-spec-via-glueing} or
\ref{constructions-section-spec}
for a discussion of the relative spectrum.)
Let $\Spec(A) \subset U$ be an affine open, and say $f|_{\Spec(A)}$ corresponds
to the unit $a \in A^*$. Then $\pi^{-1}(\Spec(A)) = \Spec(B)$ with
$B = A[T]/(T^n - a)$. The ring map $A \to B$ is finite free of rank $n$,
hence it is faithfully flat, and hence we conclude that
$\Spec(B) \to \Spec(A)$ is surjective. Since this holds for every
affine open in $U$ we conclude that $\pi$ is surjective.
In addition, $n$ and $T^{n - 1}$ are invertible in $B$, so
$nT^{n-1} \in B^*$ and the ring map $A \to B$ is standard \'etale,
in particular \'etale. Since this holds for every affine open of $U$
we conclude that $\pi$ is \'etale. Hence
$\mathcal{U} = \{\pi : U' \to U\}$ is an \'etale covering.
Moreover, $f|_{U'} = (f')^n$ where $f'$ is the class of $T$
in $\Gamma(U', \mathcal{O}_{U'}^*)$, so $\mathcal{U}$ has the desired property.
\end{proof}

\begin{remark}
\label{remark-no-kummer-sequence-zariski}
Lemma \ref{lemma-kummer-sequence} is false when ``\'etale'' is replaced
with ``Zariski''.
Since the \'etale topology is coarser than the smooth topology, see
Topologies, Lemma \ref{topologies-lemma-zariski-etale-smooth}
it follows that the sequence is also exact in the smooth topology.
\end{remark}

\noindent
By
Theorem \ref{theorem-picard-group}
and
Lemma \ref{lemma-kummer-sequence}
and general properties of cohomology we obtain
the long exact cohomology sequence
$$
\xymatrix{
0 \ar[r] &
H_\etale^0(S, \mu_{n, S}) \ar[r] &
\Gamma(S, \mathcal{O}_S^*) \ar^{(\cdot)^n}[r] &
\Gamma(S, \mathcal{O}_S^*) \ar@(rd, ul)[rdllllr]
\\
& H_\etale^1(S, \mu_{n, S}) \ar[r] &
\text{Pic}(S) \ar^{(\cdot)^n}[r] &
\text{Pic} (S) \ar@(rd, ul)[rdllllr] \\
& H_\etale^2(S, \mu_{n, S}) \ar[r] &
\cdots
}
$$
at least if $n$ is invertible on $S$. When $n$ is not invertible on $S$
we can apply the following lemma.

\begin{lemma}
\label{lemma-kummer-sequence-syntomic}
For any $n \in \mathbf{N}$ the sequence
$$
0 \to
\mu_{n, S} \to
\mathbf{G}_{m, S} \xrightarrow{(\cdot)^n}
\mathbf{G}_{m, S} \to 0
$$
is a short exact sequence of sheaves on the site
$(\Sch/S)_{fppf}$ and $(\Sch/S)_{syntomic}$.
\end{lemma}

\begin{proof}
By definition the sheaf $\mu_{n, S}$ is the kernel of the map
$(\cdot)^n$. Hence it suffices to show that the last map is surjective.
Since the syntomic topology is stronger than the fppf topology, see
Topologies, Lemma \ref{topologies-lemma-zariski-etale-smooth-syntomic-fppf},
it suffices to prove this for the syntomic topology.
Let $U$ be a scheme over $S$. Let
$f \in \mathbf{G}_m(U) = \Gamma(U, \mathcal{O}_U^*)$.
We need to show that we can find a syntomic cover of
$U$ over the members of which the restriction of $f$ is an $n$th power.
Set
$$
U' =
\underline{\Spec}_U(\mathcal{O}_U[T]/(T^n-f))
\xrightarrow{\pi}
U.
$$
(See
Constructions, Section \ref{constructions-section-spec-via-glueing} or
\ref{constructions-section-spec}
for a discussion of the relative spectrum.)
Let $\Spec(A) \subset U$ be an affine open, and say $f|_{\Spec(A)}$ corresponds
to the unit $a \in A^*$. Then $\pi^{-1}(\Spec(A)) = \Spec(B)$ with
$B = A[T]/(T^n - a)$. The ring map $A \to B$ is finite free of rank $n$,
hence it is faithfully flat, and hence we conclude that
$\Spec(B) \to \Spec(A)$ is surjective. Since this holds for every
affine open in $U$ we conclude that $\pi$ is surjective.
In addition, $B$ is a global relative complete intersection over $A$, so
the ring map $A \to B$ is standard syntomic,
in particular syntomic. Since this holds for every affine open of $U$
we conclude that $\pi$ is syntomic. Hence
$\mathcal{U} = \{\pi : U' \to U\}$ is a syntomic covering.
Moreover, $f|_{U'} = (f')^n$ where $f'$ is the class of $T$
in $\Gamma(U', \mathcal{O}_{U'}^*)$, so $\mathcal{U}$ has the desired property.
\end{proof}

\begin{remark}
\label{remark-no-kummer-sequence-smooth-etale-zariski}
Lemma \ref{lemma-kummer-sequence-syntomic}
is false for the smooth, \'etale, or Zariski topology.
\end{remark}

\noindent
By
Theorem \ref{theorem-picard-group}
and
Lemma \ref{lemma-kummer-sequence-syntomic}
and general properties of cohomology we obtain
the long exact cohomology sequence
$$
\xymatrix{
0 \ar[r] &
H_{fppf}^0(S, \mu_{n, S}) \ar[r] &
\Gamma(S, \mathcal{O}_S^*) \ar^{(\cdot)^n}[r] &
\Gamma(S, \mathcal{O}_S^*) \ar@(rd, ul)[rdllllr]
\\
& H_{fppf}^1(S, \mu_{n, S}) \ar[r] &
\text{Pic}(S) \ar^{(\cdot)^n}[r] &
\text{Pic} (S) \ar@(rd, ul)[rdllllr] \\
& H_{fppf}^2(S, \mu_{n, S}) \ar[r] &
\cdots
}
$$
for any scheme $S$ and any integer $n$. Of course there is a similar sequence
with syntomic cohomology.

\medskip\noindent
Let $n \in \mathbf{N}$ and let $S$ be any scheme.
There is another more direct way to describe the first cohomology group with
values in $\mu_n$. Consider pairs
$(\mathcal{L}, \alpha)$ where $\mathcal{L}$ is an invertible sheaf on $S$
and $\alpha : \mathcal{L}^{\otimes n} \to \mathcal{O}_S$ is a trivialization
of the $n$th tensor power of $\mathcal{L}$.
Let $(\mathcal{L}', \alpha')$ be a second such pair.
An isomorphism $\varphi : (\mathcal{L}, \alpha) \to (\mathcal{L}', \alpha')$
is an isomorphism $\varphi : \mathcal{L} \to \mathcal{L}'$ of invertible
sheaves such that the diagram
$$
\xymatrix{
\mathcal{L}^{\otimes n} \ar[d]_{\varphi^{\otimes n}} \ar[r]_\alpha &
\mathcal{O}_S \ar[d]^1 \\
(\mathcal{L}')^{\otimes n} \ar[r]^{\alpha'} &
\mathcal{O}_S \\
}
$$
commutes. Thus we have
\begin{equation}
\label{equation-isomorphisms-pairs}
\mathit{Isom}_S((\mathcal{L}, \alpha), (\mathcal{L}', \alpha'))
=
\left\{
\begin{matrix}
\emptyset & \text{if} & \text{they are not isomorphic} \\
H^0(S, \mu_{n, S})\cdot \varphi & \text{if} &
\varphi \text{ isomorphism of pairs}
\end{matrix}
\right.
\end{equation}
Moreover, given two pairs $(\mathcal{L}, \alpha)$, $(\mathcal{L}', \alpha')$
the tensor product
$$
(\mathcal{L}, \alpha) \otimes (\mathcal{L}', \alpha')
=
(\mathcal{L} \otimes \mathcal{L}', \alpha \otimes \alpha')
$$
is another pair. The pair $(\mathcal{O}_S, 1)$ is an identity for this
tensor product operation, and an inverse is given by
$$
(\mathcal{L}, \alpha)^{-1} = (\mathcal{L}^{\otimes -1}, \alpha^{\otimes -1}).
$$
Hence the collection of isomorphism classes of pairs forms an abelian group.
Note that
$$
(\mathcal{L}, \alpha)^{\otimes n}
=
(\mathcal{L}^{\otimes n}, \alpha^{\otimes n})
\xrightarrow{\alpha}
(\mathcal{O}_S, 1)
$$
hence every element of this group has order dividing $n$. We warn the reader
that this group is in general {\bf not} the $n$-torsion in $\text{Pic}(S)$.

\begin{lemma}
\label{lemma-describe-h1-mun}
Let $S$ be a scheme. There is a canonical identification
$$
H_\etale^1(S, \mu_n) =
\text{group of pairs }(\mathcal{L}, \alpha)\text{ up to isomorphism as above}
$$
if $n$ is invertible on $S$. In general we have
$$
H_{fppf}^1(S, \mu_n) =
\text{group of pairs }(\mathcal{L}, \alpha)\text{ up to isomorphism as above}.
$$
The same result holds with fppf replaced by syntomic.
\end{lemma}

\begin{proof}
We first prove the second isomorphism.
Let $(\mathcal{L}, \alpha)$ be a pair as above.
Choose an affine open covering $S = \bigcup U_i$ such that
$\mathcal{L}|_{U_i} \cong \mathcal{O}_{U_i}$. Say $s_i \in \mathcal{L}(U_i)$
is a generator. Then $\alpha(s_i^{\otimes n}) = f_i \in \mathcal{O}_S^*(U_i)$.
Writing $U_i = \Spec(A_i)$ we see there exists a global
relative complete intersection $A_i \to B_i = A_i[T]/(T^n - f_i)$
such that $f_i$ maps to an $n$th power in $B_i$. In other words, setting
$V_i = \Spec(B_i)$ we obtain a syntomic covering
$\mathcal{V} = \{V_i \to S\}_{i \in I}$ and trivializations
$\varphi_i : (\mathcal{L}, \alpha)|_{V_i} \to (\mathcal{O}_{V_i}, 1)$.

\medskip\noindent
We will use this result (the existence of the covering $\mathcal{V}$)
to associate to this pair a cohomology class in
$H^1_{syntomic}(S, \mu_{n, S})$. We give two (equivalent) constructions.

\medskip\noindent
First construction: using \u Cech cohomology.
Over the double overlaps $V_i \times_S V_j$ we have the isomorphism
$$
(\mathcal{O}_{V_i \times_S V_j}, 1)
\xrightarrow{\text{pr}_0^*\varphi_i^{-1}}
(\mathcal{L}|_{V_i \times_S V_j}, \alpha|_{V_i \times_S V_j})
\xrightarrow{\text{pr}_1^*\varphi_j}
(\mathcal{O}_{V_i \times_S V_j}, 1)
$$
of pairs. By (\ref{equation-isomorphisms-pairs}) this is given by an
element $\zeta_{ij} \in \mu_n(V_i \times_S V_j)$. We omit the verification
that these $\zeta_{ij}$'s give a $1$-cocycle, i.e., give
an element $(\zeta_{i_0i_1}) \in \check C(\mathcal{V}, \mu_n)$
with $d(\zeta_{i_0i_1}) = 0$. Thus its class is an element in
$\check H^1(\mathcal{V}, \mu_n)$ and by
Theorem \ref{theorem-cech-ss}
it maps to a cohomology class in $H^1_{syntomic}(S, \mu_{n, S})$.

\medskip\noindent
Second construction: Using torsors. Consider the presheaf
$$
\mu_n(\mathcal{L}, \alpha) :
U
\longmapsto
\mathit{Isom}_U((\mathcal{O}_U, 1), (\mathcal{L}, \alpha)|_U)
$$
on $(\Sch/S)_{syntomic}$.
We may view this as a subpresheaf of
$\SheafHom_\mathcal{O}(\mathcal{O}, \mathcal{L})$ (internal hom
sheaf, see
Modules on Sites, Section \ref{sites-modules-section-internal-hom}).
Since the conditions defining this subpresheaf are local, we see that it is
a sheaf.
By (\ref{equation-isomorphisms-pairs}) this sheaf has a free action of
the sheaf $\mu_{n, S}$. Hence the only thing we have to check is that
it locally has sections. This is true because of the existence of the
trivializing cover $\mathcal{V}$. Hence $\mu_n(\mathcal{L}, \alpha)$
is a $\mu_{n, S}$-torsor and by
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-torsors-h1}
we obtain a corresponding element of $H^1_{syntomic}(S, \mu_{n, S})$.

\medskip\noindent
Ok, now we have to still show the following
\begin{enumerate}
\item The two constructions give the same cohomology class.
\item Isomorphic pairs give rise to the same cohomology class.
\item The cohomology class of
$(\mathcal{L}, \alpha) \otimes (\mathcal{L}', \alpha')$
is the sum of the cohomology classes of
$\mathcal{L}, \alpha)$ and $(\mathcal{L}', \alpha')$.
\item If the cohomology class is trivial, then the pair is trivial.
\item Any element of $H^1_{syntomic}(S, \mu_{n, S})$ is the
cohomology class of a pair.
\end{enumerate}
We omit the proof of (1). Part (2) is clear from the second construction,
since isomorphic torsors give the same cohomology classes.
Part (3) is clear from the first construction, since the resulting
Cech classes add up. Part (4) is clear from the second construction
since a torsor is trivial if and only if it has a global section, see
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-trivial-torsor}.

\medskip\noindent
Part (5) can be seen as follows (although a direct proof would be
preferable). Suppose $\xi \in H^1_{syntomic}(S, \mu_{n, S})$.
Then $\xi$ maps to an element
$\overline{\xi} \in H^1_{syntomic}(S, \mathbf{G}_{m, S})$
with $n \overline{\xi} = 0$. By
Theorem \ref{theorem-picard-group}
we see that $\overline{\xi}$ corresponds to an invertible sheaf $\mathcal{L}$
whose $n$th tensor power is isomorphic to $\mathcal{O}_S$.
Hence there exists a pair $(\mathcal{L}, \alpha')$ whose cohomology
class $\xi'$ has the same image $\overline{\xi'}$ in
$H^1_{syntomic}(S, \mathbf{G}_{m, S})$. Thus it suffices to show
that $\xi - \xi'$ is the class of a pair. By construction, and the
long exact cohomology sequence above, we see that
$\xi - \xi' = \partial(f)$ for some $f \in H^0(S, \mathcal{O}_S^*)$.
Consider the pair $(\mathcal{O}_S, f)$. We omit the verification
that the cohomology class of this pair is $\partial(f)$, which
finishes the proof of the first identification (with fppf replaced
with syntomic).

\medskip\noindent
To see the first, note that if $n$ is invertible on $S$, then the
covering $\mathcal{V}$ constructed in the first part of the proof
is actually an \'etale covering (compare with the proof of
Lemma \ref{lemma-kummer-sequence}). The rest of the proof is independent
of the topology, apart from the very last argument which uses that
the Kummer sequence is exact, i.e., uses Lemma \ref{lemma-kummer-sequence}.
\end{proof}






\section{Neighborhoods, stalks and points}
\label{section-stalks}

\noindent
We can associate to any geometric point of $S$ a stalk functor which is
exact. A map of sheaves on $S_\etale$ is an isomorphism if and only
if it
is an isomorphism on all these stalks. A complex of abelian sheaves is
exact if and only if the complex of stalks is exact at all geometric points.
Altogether this means that the small \'etale site of a scheme $S$
has enough points. It also turns out that any point of the small \'etale topos
of $S$ (an abstract notion) is given by a geometric point.
Thus in some sense the small \'etale topos of $S$ can be understood in
terms of geometric points and neighbourhoods.

\begin{definition}
\label{definition-geometric-point}
Let $S$ be a scheme.
\begin{enumerate}
\item A {\it geometric point} of $S$ is a morphism
$\Spec(k) \to S$ where $k$ is algebraically closed.
Such a point is usually denoted $\overline{s}$, i.e., by an overlined
small case letter. We often use $\overline{s}$ to denote the scheme
$\Spec(k)$ as well as the morphism, and we use $\kappa(\overline{s})$
to denote $k$.
\item We say $\overline{s}$ {\it lies over} $s$
to indicate that $s \in S$ is the image of $\overline{s}$.
\item An {\it \'etale neighborhood} of a geometric point $\overline{s}$
of $S$ is a commutative diagram
$$
\xymatrix{
& U \ar^{\varphi}[d] \\
{\overline{s}} \ar^{\overline{s}}[r] \ar^{\bar u}[ur] & S
}
$$
where $\varphi$ is an \'etale morphism of schemes.
We write $(U, \overline{u}) \to (S, \overline{s})$.
\item A {\it morphism of \'etale neighborhoods}
$(U, \overline{u}) \to (U', \overline{u}')$
is an $S$-morphism $h: U \to U'$
such that $\overline{u}' = h \circ \overline{u}$.
\end{enumerate}
\end{definition}

\begin{remark}
\label{remark-etale-between-etale}
Since $U$ and $U'$ are \'etale over $S$, any $S$-morphism
between them is also \'etale, see
Proposition \ref{proposition-etale-morphisms}.
In particular all morphisms of \'etale neighborhoods are \'etale.
\end{remark}

\begin{remark}
\label{remark-etale-neighbourhoods}
Let $S$ be a scheme and $s \in S$ a point. In
More on Morphisms,
Definition \ref{more-morphisms-definition-etale-neighbourhood}
we defined the notion of an \'etale neighbourhood $(U, u) \to (S, s)$
of $(S, s)$. If $\overline{s}$ is a geometric point of $S$ lying over
$s$, then any \'etale neighbourhood $(U, \overline{u}) \to (S, \overline{s})$
gives rise to an \'etale neighbourhood $(U, u)$ of $(S, s)$ by taking
$u \in U$ to be the unique point of $U$ such that $\overline{u}$
lies over $u$. Conversely, given an \'etale neighbourhood $(U, u)$
of $(S, s)$ the residue field extension $\kappa(s) \subset \kappa(u)$
is finite separable (see
Proposition \ref{proposition-etale-morphisms})
and hence we can find an embedding $\kappa(u) \subset \kappa(\overline{s})$
over $\kappa(s)$. In other words, we can find a geometric point
$\overline{u}$ of $U$ lying over $u$ such that $(U, \overline{u})$
is an \'etale neighbourhood of $(S, \overline{s})$.
We will use these observations to go between the two types of
\'etale neighbourhoods.
\end{remark}

\begin{lemma}
\label{lemma-cofinal-etale}
Let $S$ be a scheme, and let $\overline{s}$ be a geometric point of $S$.
The category of \'etale neighborhoods is cofiltered. More precisely:
\begin{enumerate}
\item Let $(U_i, \overline{u}_i)_{i=1, 2}$ be two \'etale neighborhoods of
$\overline{s}$ in $S$. Then there exists a third \'etale neighborhood
$(U, \overline{u})$ and morphisms
$(U, \overline{u}) \to (U_i, \overline{u}_i)$, $i = 1, 2$.
\item Let $h_1, h_2: (U, \overline{u}) \to (U', \overline{u}')$ be two
morphisms between \'etale neighborhoods of $\overline{s}$. Then there exist an
\'etale neighborhood $(U'', \overline{u}'')$ and a morphism
$h : (U'', \overline{u}'') \to (U, \overline{u})$
which equalizes $h_1$ and $h_2$, i.e., such that
$h_1 \circ h = h_2 \circ h$.		
\end{enumerate}
\end{lemma}

\begin{proof}
For part (1), consider the fibre product $U = U_1 \times_S U_2$.
It is \'etale over both $U_1$ and $U_2$ because \'etale morphisms are
preserved under base change, see
Proposition \ref{proposition-etale-morphisms}.
The map $\overline{s} \to U$ defined by $(\overline{u}_1, \overline{u}_2)$
gives it the structure of an \'etale neighborhood mapping to both
$U_1$ and $U_2$. For part (2), define $U''$ as the fibre product
$$
\xymatrix{
U'' \ar[r] \ar[d] & U \ar^{(h_1, h_2)}[d] \\
U' \ar^-\Delta[r] & U' \times_S U'.
}
$$
Since $\overline{u}$ and $\overline{u}'$ agree over $S$ with $\overline{s}$,
we see that $\overline{u}'' = (\overline{u}, \overline{u}')$ is a geometric
point of $U''$. In particular $U'' \not = \emptyset$.
Moreover, since $U'$ is \'etale over $S$, so is the fibre product
$U'\times_S U'$ (see
Proposition \ref{proposition-etale-morphisms}).
Hence the vertical arrow $(h_1, h_2)$ is \'etale by
Remark \ref{remark-etale-between-etale} above.
Therefore $U''$ is \'etale over $U'$ by base change, and hence also
\'etale over $S$ (because compositions of \'etale morphisms are \'etale).
Thus $(U'', \overline{u}'')$ is a solution to the problem.
\end{proof}

\begin{lemma}
\label{lemma-geometric-lift-to-cover}
Let $S$ be a scheme.
Let $\overline{s}$ be a geometric point of $S$.
Let $(U, \overline{u})$ an \'etale neighborhood of $\overline{s}$.
Let $\mathcal{U} = \{\varphi_i : U_i \to U \}_{i\in I}$ be an \'etale covering.
Then there exist $i \in I$ and $\overline{u}_i : \overline{s} \to U_i$
such that $\varphi_i : (U_i, \overline{u}_i) \to (U, \overline{u})$
is a morphism of \'etale neighborhoods.
\end{lemma}

\begin{proof}
As $U = \bigcup_{i\in I} \varphi_i(U_i)$, the fibre product
$\overline{s} \times_{\overline{u}, U, \varphi_i} U_i$ is not empty
for some $i$. Then look at the cartesian diagram
$$
\xymatrix{
\overline{s} \times_{\overline{u}, U, \varphi_i} U_i
\ar[d]^{\text{pr}_1} \ar[r]_-{\text{pr}_2} & U_i
\ar[d]^{\varphi_i} \\
\Spec(k) = \overline{s} \ar@/^1pc/[u]^\sigma
\ar[r]^-{\overline{u}} & U
}
$$
The projection $\text{pr}_1$ is the base change of an \'etale morphisms so it
is \'etale, see
Proposition \ref{proposition-etale-morphisms}.
Therefore, $\overline{s} \times_{\overline{u}, U, \varphi_i} U_i$
is a disjoint union of finite separable extensions of $k$, by
Proposition \ref{proposition-etale-morphisms}. Here
$\overline{s} = \Spec(k)$. But $k$ is algebraically closed, so all
these extensions are trivial, and there exists a section $\sigma$ of
$\text{pr}_1$. The composition
$\text{pr}_2 \circ \sigma$ gives a map compatible with $\overline{u}$.
\end{proof}

\begin{definition}
\label{definition-stalk}
Let $S$ be a scheme.
Let $\mathcal{F}$ be a presheaf on $S_\etale$.
Let $\overline{s}$ be a geometric point of $S$.
The {\it stalk} of $\mathcal{F}$ at $\overline{s}$ is
$$
\mathcal{F}_{\overline{s}}
=
\colim_{(U, \overline{u})} \mathcal{F}(U)
$$
where $(U, \overline{u})$ runs over all \'etale
neighborhoods of $\overline{s}$ in $S$.
\end{definition}

\noindent
By Lemma \ref{lemma-cofinal-etale}, this colimit is over a filtered
index category, namely the opposite of the category of \'etale neighbourhoods.
In other words, an element of $\mathcal{F}_{\overline{s}}$ can be
thought of as a triple $(U, \overline{u}, \sigma)$ where
$\sigma \in \mathcal{F}(U)$. Two triples
$(U, \overline{u}, \sigma)$, $(U', \overline{u}', \sigma')$
define the same element of the stalk if there exists a third
\'etale neighbourhood $(U'', \overline{u}'')$ and morphisms of \'etale
neighbourhoods $h : (U'', \overline{u}'') \to (U, \overline{u})$,
$h' : (U'', \overline{u}'') \to (U', \overline{u}')$ such that
$h^*\sigma = (h')^*\sigma'$ in $\mathcal{F}(U'')$. See
Categories, Section \ref{categories-section-directed-colimits}.

\begin{lemma}
\label{lemma-stalk-gives-point}
Let $S$ be a scheme. Let $\overline{s}$ be a geometric point of $S$.
Consider the functor
\begin{align*}
u : S_\etale & \longrightarrow \textit{Sets}, \\
U & \longmapsto
|U_{\overline{s}}|
=
\{\overline{u} \text{ such that }(U, \overline{u})
\text{ is an \'etale neighbourhood of }\overline{s}\}.
\end{align*}
Here $|U_{\overline{s}}|$ denotes the underlying set of the geometric fibre.
Then $u$ defines a point $p$ of the site $S_\etale$
(Sites, Definition \ref{sites-definition-point})
and its associated stalk functor $\mathcal{F} \mapsto \mathcal{F}_p$
(Sites, Equation \ref{sites-equation-stalk})
is the functor $\mathcal{F} \mapsto \mathcal{F}_{\overline{s}}$
defined above.
\end{lemma}

\begin{proof}
In the proof of
Lemma \ref{lemma-geometric-lift-to-cover}
we have seen that the scheme $U_{\overline{s}}$ is a disjoint union of
schemes isomorphic to $\overline{s}$. Thus we can also think of
$|U_{\overline{s}}|$ as the set of geometric points of $U$ lying over
$\overline{s}$, i.e., as the collection of morphisms
$\overline{u} : \overline{s} \to U$ fitting into the diagram of
Definition \ref{definition-geometric-point}.
From this it follows that $u(S)$ is a singleton, and that
$u(U \times_V W) = u(U) \times_{u(V)} u(W)$
whenever $U \to V$ and $W \to V$ are morphisms in $S_\etale$.
And, given a covering $\{U_i \to U\}_{i \in I}$ in $S_\etale$
we see that $\coprod u(U_i) \to u(U)$ is surjective by
Lemma \ref{lemma-geometric-lift-to-cover}.
Hence
Sites, Proposition \ref{sites-proposition-point-limits}
applies, so $p$ is a point of the site $S_\etale$.
Finally, the our functor $\mathcal{F} \mapsto \mathcal{F}_{\overline{s}}$
is given by exactly the same colimit as the functor
$\mathcal{F} \mapsto \mathcal{F}_p$ associated to $p$ in
Sites, Equation \ref{sites-equation-stalk}
which proves the final assertion.
\end{proof}

\begin{remark}
\label{remark-map-stalks}
Let $S$ be a scheme and let $\overline{s} : \Spec(k) \to S$
and $\overline{s}' : \Spec(k') \to S$ be two geometric points of
$S$. A {\it morphism $a : \overline{s} \to \overline{s}'$ of geometric points}
is simply a morphism $a : \Spec(k) \to \Spec(k')$ such that
$a \circ \overline{s}' = \overline{s}$. Given such a morphism we obtain
a functor from the category of \'etale neighbourhoods of $\overline{s}'$
to the category of \'etale neighbourhoods of $\overline{s}$ by the rule
$(U, \overline{u}') \mapsto (U, \overline{u}' \circ a)$. Hence we obtain
a canonical map
$$
\mathcal{F}_{\overline{s}'}
=
\colim_{(U, \overline{u}')} \mathcal{F}(U)
\longrightarrow
\colim_{(U, \overline{u})} \mathcal{F}(U)
=
\mathcal{F}_{\overline{s}}
$$
from Categories, Lemma \ref{categories-lemma-functorial-colimit}. Using the
description of elements of stalks as triples this maps the element of
$\mathcal{F}_{\overline{s}'}$ represented by the triple
$(U, \overline{u}', \sigma)$ to the element of $\mathcal{F}_{\overline{s}}$
represented by the triple $(U, \overline{u}' \circ a, \sigma)$.
Since the functor above is clearly an equivalence we conclude that this
canonical map is an isomorphism of stalk functors.

\medskip\noindent
Let us make sure we have the map of stalks corresponding to $a$ pointing
in the correct direction. Note that the above means, according to
Sites, Definition \ref{sites-definition-morphism-points},
that $a$ defines a morphism $a : p \to p'$ between the points $p, p'$ of
the site $S_\etale$ associated to $\overline{s}, \overline{s}'$ by
Lemma \ref{lemma-stalk-gives-point}. There are more general morphisms of
points (corresponding to specializations of points of $S$) which we will
describe later, and which will not be isomorphisms (insert future
reference here).
\end{remark}

\begin{lemma}
\label{lemma-stalk-exact}
Let $S$ be a scheme. Let $\overline{s}$ be a geometric point of $S$.
\begin{enumerate}
\item The stalk functor
$\textit{PAb}(S_\etale) \to \textit{Ab}$,
$\mathcal{F}  \mapsto  \mathcal{F}_{\overline{s}}$
is exact.
\item We have $(\mathcal{F}^\#)_{\overline{s}} = \mathcal{F}_{\overline{s}}$
for any presheaf of sets $\mathcal{F}$ on $S_\etale$.
\item The functor
$\textit{Ab}(S_\etale) \to \textit{Ab}$,
$\mathcal{F} \mapsto \mathcal{F}_{\overline{s}}$ is exact.
\item Similarly the functors
$\textit{PSh}(S_\etale) \to \textit{Sets}$ and
$\Sh(S_\etale) \to \textit{Sets}$ given by the stalk functor
$\mathcal{F} \mapsto \mathcal{F}_{\overline{x}}$ are exact (see
Categories, Definition \ref{categories-definition-exact})
and commute with arbitrary colimits.
\end{enumerate}
\end{lemma}

\begin{proof}
Before we indicate how to prove this by direct arguments
we note that the result follows from the general material in
Modules on Sites, Section \ref{sites-modules-section-stalks}.
This is true because $\mathcal{F} \mapsto \mathcal{F}_{\overline{s}}$
comes from a point of the small \'etale site of $S$, see
Lemma \ref{lemma-stalk-gives-point}.
We will only give a direct proof of (1), (2) and (3), and omit
a direct proof of (4).

\medskip\noindent
Exactness as a functor on $\textit{PAb}(S_\etale)$ is formal from the
fact that directed colimits commute with all colimits and with finite
limits. The identification of the stalks in (2) is via the map
$$
\kappa :
\mathcal{F}_{\overline{s}}
\longrightarrow
(\mathcal{F}^\#)_{\overline{s}}
$$
induced by the natural morphism $\mathcal{F}\to \mathcal{F}^\#$, see
Theorem \ref{theorem-sheafification}.
We claim that this map is an isomorphism of abelian groups. We will show
injectivity and omit the proof of surjectivity.

\medskip\noindent
Let $\sigma\in \mathcal{F}_{\overline{s}}$.
There exists an \'etale neighborhood
$(U, \overline{u})\to (S, \overline{s})$ such that $\sigma$ is the image of some
section $s \in \mathcal{F}(U)$. If $\kappa(\sigma) = 0$ in
$(\mathcal{F}^\#)_{\overline{s}}$ then there exists a morphism of \'etale
neighborhoods $(U', \overline{u}')\to (U, \overline{u})$ such that
$s|_{U'}$ is zero in $\mathcal{F}^\#(U')$. It follows there
exists an \'etale covering
$\{U_i'\to U'\}_{i\in I}$ such that $s|_{U_i'}=0$ in
$\mathcal{F}(U_i')$ for all $i$. By Lemma \ref{lemma-geometric-lift-to-cover}
there exist $i \in I$ and a morphism
$\overline{u}_i': \overline{s} \to U_i'$ such that
$(U_i', \overline{u}_i') \to (U', \overline{u}')\to (U, \overline{u})$
are morphisms of \'etale neighborhoods. Hence $\sigma = 0$
since $(U_i', \overline{u}_i') \to (U, \overline{u})$
is a morphism of \'etale neighbourhoods such that
we have $s|_{U'_i}=0$. This proves $\kappa$ is injective.

\medskip\noindent
To show that the functor $\textit{Ab}(S_\etale) \to \textit{Ab}$ is
exact, consider any short exact sequence in $\textit{Ab}(S_\etale)$:
$
0\to \mathcal{F}\to \mathcal{G}\to \mathcal H \to 0.
$
This gives us the exact sequence of presheaves
$$
0 \to \mathcal{F} \to \mathcal{G} \to \mathcal H \to
\mathcal H/^p\mathcal{G} \to 0,
$$
where $/^p$ denotes the quotient in $\textit{PAb}(S_\etale)$.
Taking stalks at
$\overline{s}$, we see that $(\mathcal H /^p\mathcal{G})_{\bar{s}} =
(\mathcal H /\mathcal{G})_{\bar{s}} = 0$, since the sheafification of
$\mathcal H/^p\mathcal{G}$ is $0$.
Therefore,
$$
0\to \mathcal{F}_{\overline{s}	} \to \mathcal{G}_{\overline{s}} \to
\mathcal{H}_{\overline{s}} \to 0 = (\mathcal H/^p\mathcal{G})_{\overline{s}}
$$
is exact, since taking stalks is exact as a functor from presheaves.
\end{proof}

\begin{theorem}
\label{theorem-exactness-stalks}
Let $S$ be a scheme.
A map $a : \mathcal{F} \to \mathcal{G}$ of sheaves of sets is injective
(resp.\ surjective) if and only if the map on stalks
$a_{\overline{s}} : \mathcal{F}_{\overline{s}} \to \mathcal{G}_{\overline{s}}$
is injective (resp.\ surjective) for all geometric points of $S$.
A sequence of abelian sheaves on $S_\etale$ is exact
if and only if it is exact on all stalks at geometric points of $S$.
\end{theorem}

\begin{proof}
The necessity of exactness on stalks follows from
Lemma \ref{lemma-stalk-exact}.
For the converse, it suffices to show that a map of sheaves is surjective
(respectively injective) if and only if it is surjective (respectively
injective) on all stalks. We prove this in the case of surjectivity, and omit
the proof in the case of injectivity.

\medskip\noindent
Let $\alpha : \mathcal{F} \to \mathcal{G}$ be a map of abelian sheaves such
that $\mathcal{F}_{\overline{s}} \to \mathcal{G}_{\overline{s}}$
is surjective for all geometric points. Fix
$U \in \Ob(S_\etale)$
and $s \in \mathcal{G}(U)$. For every $u \in U$ choose some
$\overline{u} \to U$ lying over $u$ and an \'etale neighborhood
$(V_u , \overline{v}_u) \to (U, \overline{u})$ such that
$s|_{V_u} = \alpha(s_{V_u})$ for some
$s_{V_u} \in \mathcal{F}(V_u)$.
This is possible since $\alpha$ is surjective on
stalks. Then $\{V_u \to U\}_{u \in U}$
is an \'etale covering on which the restrictions of $s$
are in the image of the map $\alpha$.
Thus, $\alpha$ is surjective, see
Sites, Section \ref{sites-section-sheaves-injective}.
\end{proof}

\begin{remarks}
\label{remarks-enough-points}
On points of the geometric sites.
\begin{enumerate}
\item Theorem \ref{theorem-exactness-stalks} says that the family of points
of $S_\etale$ given by the geometric points of $S$
(Lemma \ref{lemma-stalk-gives-point}) is conservative, see
Sites, Definition \ref{sites-definition-enough-points}.
In particular $S_\etale$ has enough points.
\item Suppose $\mathcal{F}$ is a sheaf on the big \'etale site
\label{item-stalks-big}
of $S$. Let $T \to S$ be an object of the big \'etale site of $S$,
and let $\overline{t}$ be a geometric point of $T$. Then we define
$\mathcal{F}_{\overline{t}}$ as the stalk
of the restriction $\mathcal{F}|_{T_\etale}$ of $\mathcal{F}$
to the small \'etale site of $T$. In other words, we can define
the stalk of $\mathcal{F}$ at any geometric point of any
scheme $T/S \in \Ob((\Sch/S)_\etale)$.
\item The big \'etale site of $S$ also has enough points, by
considering all geometric points of all objects of this site, see
(\ref{item-stalks-big}).
\end{enumerate}
\end{remarks}

\noindent
The following lemma should be skipped on a first reading.

\begin{lemma}
\label{lemma-points-small-etale-site}
Let $S$ be a scheme.
\begin{enumerate}
\item Let $p$ be a point of the small \'etale site
$S_\etale$ of $S$ given by a functor
$u : S_\etale \to \textit{Sets}$.
Then there exists a geometric point $\overline{s}$ of $S$ such that
$p$ is isomorphic to the point of $S_\etale$ associated to
$\overline{s}$ in
Lemma \ref{lemma-stalk-gives-point}.
\item Let $p : \Sh(pt) \to \Sh(S_\etale)$ be a point
of the small \'etale topos of $S$. Then $p$ comes from a geometric point
of $S$, i.e., the stalk functor $\mathcal{F} \mapsto \mathcal{F}_p$
is isomorphic to a stalk functor as defined in
Definition \ref{definition-stalk}.
\end{enumerate}
\end{lemma}

\begin{proof}
By
Sites, Lemma \ref{sites-lemma-point-site-topos}
there is a one to one correspondence between points of the site and points
of the associated topos, hence it suffices to prove (1).
By
Sites, Proposition \ref{sites-proposition-point-limits}
the functor $u$ has the following properties:
(a) $u(S) = \{*\}$, (b) $u(U \times_V W) = u(U) \times_{u(V)} u(W)$, and
(c) if $\{U_i \to U\}$ is an \'etale covering, then
$\coprod u(U_i) \to u(U)$ is surjective.
In particular, if $U' \subset U$ is an open subscheme,
then $u(U') \subset u(U)$. Moreover, by
Sites, Lemma \ref{sites-lemma-point-site-topos}
we can write $u(U) = p^{-1}(h_U^\#)$, in other words $u(U)$ is the
stalk of the representable sheaf $h_U$. If
$U = V \amalg W$, then we see that $h_U = (h_V \amalg h_W)^\#$ and we get
$u(U) = u(V) \amalg u(W)$ since $p^{-1}$ is exact.

\medskip\noindent
Consider the restriction of $u$ to $S_{Zar}$. By
Sites, Examples \ref{sites-example-point-topological} and
\ref{sites-example-point-topology}
there exists a unique point $s \in S$ such that for $S' \subset S$ open we
have $u(S') = \{*\}$ if $s \in S'$ and $u(S') = \emptyset$ if $s \not \in S'$.
Note that if $\varphi : U \to S$ is an object of $S_\etale$ then
$\varphi(U) \subset S$ is open (see
Proposition \ref{proposition-etale-morphisms})
and $\{U \to \varphi(U)\}$ is an \'etale covering. Hence we conclude that
$u(U) = \emptyset \Leftrightarrow s \in \varphi(U)$.

\medskip\noindent
Pick a geometric point $\overline{s} : \overline{s} \to S$ lying over $s$, see
Definition \ref{definition-geometric-point}
for customary abuse of notation. Suppose that $\varphi : U \to S$ is an object
of $S_\etale$ with $U$ affine. Note that $\varphi$ is separated, and
that the fibre $U_s$ of $\varphi$ over $s$ is an affine scheme over
$\Spec(\kappa(s))$ which is the spectrum of a finite product of
finite separable extensions $k_i$ of $\kappa(s)$. Hence we may apply
\'Etale Morphisms, Lemma \ref{etale-lemma-etale-etale-local-technical}
to get an \'etale neighbourhood $(V, \overline{v})$ of $(S, \overline{s})$
such that
$$
U \times_S V = U_1 \amalg \ldots \amalg U_n \amalg W
$$
with $U_i \to V$ an isomorphism and $W$ having no point lying over
$\overline{v}$. Thus we conclude that
$$
u(U) \times u(V) =
u(U \times_S V) =
u(U_1) \amalg \ldots \amalg u(U_n) \amalg u(W)
$$
and of course also $u(U_i) = u(V)$. After shrinking $V$ a bit we can
assume that $V$ has exactly one point lying over $s$, and hence $W$ has no
point lying over $s$. By the above this then gives $u(W) = \emptyset$.
Hence we obtain
$$
u(U) \times u(V) =
u(U_1) \amalg \ldots \amalg u(U_n) =
\coprod\nolimits_{i = 1, \ldots, n} u(V)
$$
Note that $u(V) \not = \emptyset$ as $s$ is in the image of $V \to S$.
In particular, we see that in this situation $u(U)$ is a finite
set with $n$ elements.

\medskip\noindent
Consider the limit
$$
\lim_{(V, \overline{v})} u(V)
$$
over the category of \'etale neighbourhoods $(V, \overline{v})$ of
$\overline{s}$. It is clear that we get the same value when taking
the limit over the subcategory of $(V, \overline{v})$ with $V$ affine.
By the previous paragraph (applied with the roles of $V$ and $U$ switched)
we see that in this case $u(V)$ is always a finite nonempty set.
Moreover, the limit is cofiltered, see
Lemma \ref{lemma-cofinal-etale}.
Hence by
Categories, Section \ref{categories-section-codirected-limits}
the limit is nonempty. Pick an element $x$ from this limit.
This means we obtain a $x_{V, \overline{v}} \in u(V)$ for
every \'etale neighbourhood $(V, \overline{v})$ of $(S, \overline{s})$
such that for every morphism of \'etale neighbourhoods
$\varphi : (V', \overline{v}') \to (V, \overline{v})$ we have
$u(\varphi)(x_{V', \overline{v}'}) = x_{V, \overline{v}}$.

\medskip\noindent
We will use the choice of $x$ to construct a functorial bijective map
$$
c : |U_{\overline{s}}| \longrightarrow u(U)
$$
for $U \in \Ob(S_\etale)$ which will conclude the proof. See
Lemma \ref{lemma-stalk-gives-point}
and its proof for a description of $|U_{\overline{s}}|$.
First we claim that it suffices to construct the map for $U$ affine.
We omit the proof of this claim.
Assume $U \to S$ in $S_\etale$ with $U$ affine, and let
$\overline{u} : \overline{s} \to U$ be an element of $|U_{\overline{s}}|$.
Choose a $(V, \overline{v})$ such that $U \times_S V$ decomposes
as in the third paragraph of the proof.
Then the pair $(\overline{u}, \overline{v})$ gives a geometric point of
$U \times_S V$ lying over $\overline{v}$ and determines one of the
components $U_i$ of $U \times_S V$. More precisely, there exists
a section $\sigma : V \to U \times_S V$ of the projection $\text{pr}_U$
such that $(\overline{u}, \overline{v}) = \sigma \circ \overline{v}$. Set
$c(\overline{u}) = u(\text{pr}_U)(u(\sigma)(x_{V, \overline{v}})) \in u(U)$.
We have to check this is independent of the choice of $(V, \overline{v})$. By
Lemma \ref{lemma-cofinal-etale}
the category of \'etale neighbourhoods is cofiltered.
Hence it suffice to show
that given a morphism of \'etale neighbourhood
$\varphi : (V', \overline{v}') \to (V, \overline{v})$ and a choice of a
section $\sigma' : V' \to U \times_S V'$ of the projection such that
$(\overline{u}, \overline{v'}) = \sigma' \circ \overline{v}'$
we have $u(\sigma')(x_{V', \overline{v}'}) = u(\sigma)(x_{V, \overline{v}})$.
Consider the diagram
$$
\xymatrix{
V' \ar[d]^{\sigma'} \ar[r]_\varphi & V \ar[d]^\sigma \\
U \times_S V' \ar[r]^{1 \times \varphi} &
U \times_S V
}
$$
Now, it may not be the case that this diagram commutes. The reason is
that the schemes $V'$ and $V$ may not be connected, and hence
the decompositions used to construct $\sigma'$ and $\sigma$ above may
not be unique. But we do know that
$\sigma \circ \varphi \circ \overline{v}' =
(1 \times \varphi) \circ \sigma' \circ \overline{v}'$
by construction. Hence, since $U \times_S V$ is \'etale over $S$,
there exists an open neighbourhood
$V'' \subset V'$ of $\overline{v'}$ such that the diagram does
commute when restricted to $V''$, see
Morphisms, Lemma \ref{morphisms-lemma-value-at-one-point}.
This means we may extend the diagram above to
$$
\xymatrix{
V'' \ar[r] \ar[d]^{\sigma'|_{V''}} &
V' \ar[d]^{\sigma'} \ar[r]_\varphi &
V \ar[d]^\sigma \\
U \times_S V'' \ar[r] &
U \times_S V' \ar[r]^{1 \times \varphi} &
U \times_S V
}
$$
such that the left square and the outer rectangle commute.
Since $u$ is a functor this implies that
$x_{V'', \overline{v}'}$ maps to the same element in
$u(U \times_S V)$ no matter which route we take through the
diagram. On the other hand, it maps to the elements
$x_{V', \overline{v}'}$ and $x_{V, \overline{v}}$ in
$u(V')$ and $u(V)$. This implies the desired equality
$u(\sigma')(x_{V', \overline{v}'}) = u(\sigma)(x_{V, \overline{v}})$.

\medskip\noindent
In a similar manner one proves that the construction
$c : |U_{\overline{s}}| \to u(U)$ is functorial in $U$;
details omitted. And finally, by the results of the
third paragraph it is clear that the map $c$ is bijective
which ends the proof of the lemma.
\end{proof}







\section{Points in other topologies}
\label{section-points-topologies}

\noindent
In this section we briefly discuss the existence of points for some
sites other than the \'etale site of a scheme. We refer to
Sites, Section \ref{sites-section-sites-enough-points}
and
Topologies, Section \ref{topologies-section-procedure} ff
for the terminology used in this section.
All of the geometric sites have enough points.

\begin{lemma}
\label{lemma-points-fppf}
Let $S$ be a scheme. All of the following sites have enough points
$S_{Zar}$, $S_\etale$,
$(\Sch/S)_{Zar}$, $(\textit{Aff}/S)_{Zar}$,
$(\Sch/S)_\etale$, $(\textit{Aff}/S)_\etale$,
$(\Sch/S)_{smooth}$, $(\textit{Aff}/S)_{smooth}$,
$(\Sch/S)_{syntomic}$, $(\textit{Aff}/S)_{syntomic}$,
$(\Sch/S)_{fppf}$, and $(\textit{Aff}/S)_{fppf}$.
\end{lemma}

\begin{proof}
For each of the big sites the associated topos is equivalent to the
topos defined by the site $(\textit{Aff}/S)_\tau$, see
Topologies, Lemmas \ref{topologies-lemma-affine-big-site-Zariski},
\ref{topologies-lemma-affine-big-site-etale},
\ref{topologies-lemma-affine-big-site-smooth},
\ref{topologies-lemma-affine-big-site-syntomic}, and
\ref{topologies-lemma-affine-big-site-fppf}.
The result for the sites $(\textit{Aff}/S)_\tau$ follows immediately
from Deligne's result
Sites, Proposition \ref{sites-proposition-criterion-points}.

\medskip\noindent
The result for $S_{Zar}$ is clear. The result for $S_\etale$
either follows from (the proof of)
Theorem \ref{theorem-exactness-stalks}
or from
Lemma \ref{lemma-alternative}
and Deligne's result applied to $S_{affine, \etale}$.
\end{proof}

\noindent
The lemma above guarantees the existence of points, but it doesn't
tell us what these points look like. We can explicitly construct
{\it some} points as follows.
Suppose $\overline{s} : \Spec(k) \to S$ is a geometric
point with $k$ algebraically closed. Consider the functor
$$
u : (\Sch/S)_{fppf} \longrightarrow \textit{Sets},
\quad
u(U) = U(k) = \Mor_S(\Spec(k), U).
$$
Note that $U \mapsto U(k)$ commutes with direct limits as
$S(k) = \{\overline{s}\}$ and
$(U_1 \times_U U_2)(k) = U_1(k) \times_{U(k)} U_2(k)$.
Moreover, if $\{U_i \to U\}$ is an fppf covering, then
$\coprod U_i(k) \to U(k)$ is surjective.
By
Sites, Proposition \ref{sites-proposition-point-limits}
we see that $u$ defines a point $p$ of $(\Sch/S)_{fppf}$ with
stalks
$$
\mathcal{F}_p = \colim_{(U, x)} \mathcal{F}(U)
$$
where the colimit is over pairs $U \to S$, $x \in U(k)$ as usual.
But... this category has an initial object, namely
$(\Spec(k), \text{id})$, hence we see that
$$
\mathcal{F}_p = \mathcal{F}(\Spec(k))
$$
which isn't terribly interesting! In fact, in general these points won't
form a conservative family of points. A more interesting type of point
is described in the following remark.

\begin{remark}
\label{remark-points-fppf-site}
Let $S = \Spec(A)$ be an affine scheme. Let $(p, u)$ be a point of
the site $(\textit{Aff}/S)_{fppf}$. Let $B = \mathcal{O}_p$ be the stalk
of the structure sheaf at the point $p$. Since $A = \Gamma(S, \mathcal{O})$
we see that $B$ is an $A$-algebra. Ignoring set theoretical difficulties, we
see that $\Spec(B)$ is an object of $(\textit{Aff}/S)_{fppf}$. Recall
that
$$
B = \colim_{(U, x)} \mathcal{O}(U) =
\colim_{(\Spec(C), x)} C
$$
where $x \in u(\Spec(C))$. Hence there are canonical maps $C \to B$
and we see that the system has an initial object $(\Spec(B), x_B)$
for a suitable $x_B \in u(\Spec(B))$. It follows that
$\mathcal{F}_p = \mathcal{F}(\Spec(B))$ for any sheaf $\mathcal{F}$
on $(\textit{Aff}/S)_{fppf}$. In other words, every stalk functor
is representable. It is straightforward to see that if
$\mathcal{F} \mapsto \mathcal{F}(B)$ comes from a point, then
$B$ has to be a local $A$-algebra such that for every faithfully flat,
finitely presented ring map $B \to B'$ there is a section $B' \to B$.
Conversely, any such $A$-algebra $B$ gives rise to a point.
Details omitted.
\end{remark}











\section{Supports of abelian sheaves}
\label{section-support}

\noindent
First we talk about supports of local sections.

\begin{lemma}
\label{lemma-support-subsheaf-final}
Let $S$ be a scheme. Let $\mathcal{F}$ be a subsheaf of the final
object of the \'etale topos of $S$ (see
Sites, Example \ref{sites-example-singleton-sheaf}).
Then there exists a unique open
$W \subset S$ such that $\mathcal{F} = h_W$.
\end{lemma}

\begin{proof}
The condition means that $\mathcal{F}(U)$ is a singleton or
empty for all $\varphi : U \to S$ in $\Ob(S_\etale)$.
In particular local sections always glue. If
$\mathcal{F}(U) \not = \emptyset$, then
$\mathcal{F}(\varphi(U)) \not = \emptyset$ because
$\{\varphi : U \to \varphi(U)\}$ is a covering.
Hence we can take
$W = \bigcup_{\varphi : U \to S, \mathcal{F}(U) \not = \emptyset} \varphi(U)$.
\end{proof}

\begin{lemma}
\label{lemma-zero-over-image}
Let $S$ be a scheme.
Let $\mathcal{F}$ be an abelian sheaf on $S_\etale$.
Let $\sigma \in \mathcal{F}(U)$ be a local section.
There exists an open subset $W \subset U$ such that
\begin{enumerate}
\item $W \subset U$ is the largest Zariski open subset of $U$ such
that $\sigma|_W = 0$,
\item for every $\varphi : V \to U$ in $S_\etale$ we have
$$
\sigma|_V = 0 \Leftrightarrow \varphi(V) \subset W,
$$
\item for every geometric point $\overline{u}$ of $U$ we have
$$
(U, \overline{u}, \sigma) = 0\text{ in }\mathcal{F}_{\overline{s}}
\Leftrightarrow
\overline{u} \in W
$$
where $\overline{s} = (U \to S) \circ \overline{u}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $\mathcal{F}$ is a sheaf in the \'etale topology the restriction of
$\mathcal{F}$ to $U_{Zar}$ is a sheaf on $U$ in the Zariski topology.
Hence there exists a Zariski open $W$ having property (1), see
Modules, Lemma \ref{modules-lemma-support-section-closed}. Let
$\varphi : V \to U$ be an arrow of $S_\etale$. Note that
$\varphi(V) \subset U$ is an open subset and that
$\{V \to \varphi(V)\}$ is an \'etale covering. Hence if
$\sigma|_V = 0$, then by the sheaf condition for $\mathcal{F}$ we
see that $\sigma|_{\varphi(V)} = 0$. This proves (2).
To prove (3) we have to show that if $(U, \overline{u}, \sigma)$
defines the zero element of $\mathcal{F}_{\overline{s}}$, then
$\overline{u} \in W$. This is true because the assumption means
there exists a morphism of \'etale neighbourhoods
$(V, \overline{v}) \to (U, \overline{u})$ such that
$\sigma|_V = 0$. Hence by (2) we see that $V \to U$ maps into $W$, and
hence $\overline{u} \in W$.
\end{proof}

\noindent
Let $S$ be a scheme. Let $s \in S$.
Let $\mathcal{F}$ be a sheaf on $S_\etale$. By
Remark \ref{remark-map-stalks}
the isomorphism class of the stalk of the sheaf $\mathcal{F}$
at a geometric points lying over $s$ is well defined.

\begin{definition}
\label{definition-support}
Let $S$ be a scheme.
Let $\mathcal{F}$ be an abelian sheaf on $S_\etale$.
\begin{enumerate}
\item The {\it support of $\mathcal{F}$} is the set of
points $s \in S$ such that $\mathcal{F}_{\overline{s}} \not = 0$
for any (some) geometric point $\overline{s}$ lying over $s$.
\item Let $\sigma \in \mathcal{F}(U)$ be a section.
The {\it support of $\sigma$} is the closed subset $U \setminus W$, where
$W \subset U$ is the largest open subset of $U$ on which $\sigma$
restricts to zero (see
Lemma \ref{lemma-zero-over-image}).
\end{enumerate}
\end{definition}

\noindent
In general the support of an abelian sheaf is not closed.
For example, suppose that $S = \Spec(\mathbf{A}^1_{\mathbf{C}})$.
Let $i_t : \Spec(\mathbf{C}) \to S$ be the inclusion of the
point $t \in \mathbf{C}$.
We will see later that $\mathbf{F}_t = i_{t, *}(\mathbf{Z}/2\mathbf{Z})$
is an abelian sheaf whose support is exactly $\{t\}$, see
Section \ref{section-closed-immersions}.
Then
$$
\bigoplus\nolimits_{n \in \mathbf{N}} \mathcal{F}_n
$$
is an abelian sheaf with support $\{1, 2, 3, \ldots\} \subset S$.
This is true because taking stalks commutes with colimits, see
Lemma \ref{lemma-stalk-exact}.
Thus an example of an abelian sheaf whose support is not closed.
Here are some basic facts on supports of sheaves and sections.

\begin{lemma}
\label{lemma-support-section-closed}
Let $S$ be a scheme.
Let $\mathcal{F}$ be an abelian sheaf on $S_\etale$.
Let $U \in \Ob(S_\etale)$ and $\sigma \in \mathcal{F}(U)$.
\begin{enumerate}
\item The support of $\sigma$ is closed in $U$.
\item The support of $\sigma + \sigma'$ is contained in the union of
the supports of $\sigma, \sigma' \in \mathcal{F}(U)$.
\item If $\varphi : \mathcal{F} \to \mathcal{G}$ is a map of
abelian sheaves on $S_\etale$, then the support of $\varphi(\sigma)$
is contained in the support of $\sigma \in \mathcal{F}(U)$.
\item The support of $\mathcal{F}$ is the union of the images of the
supports of all local sections of $\mathcal{F}$.
\item If $\mathcal{F} \to \mathcal{G}$ is surjective then the support
of $\mathcal{G}$ is a subset of the support of $\mathcal{F}$.
\item If $\mathcal{F} \to \mathcal{G}$ is injective then the support
of $\mathcal{F}$ is a subset of the support of $\mathcal{G}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) holds by definition.
Parts (2) and (3) hold because they holds for the restriction of
$\mathcal{F}$ and $\mathcal{G}$ to $U_{Zar}$, see
Modules, Lemma \ref{modules-lemma-support-section-closed}.
Part (4) is a direct consequence of
Lemma \ref{lemma-zero-over-image} part (3).
Parts (5) and (6) follow from the other parts.
\end{proof}

\begin{lemma}
\label{lemma-support-sheaf-rings-closed}
The support of a sheaf of rings on $S_\etale$ is closed.
\end{lemma}

\begin{proof}
This is true because (according to our conventions)
a ring is $0$ if and only if
$1 = 0$, and hence the support of a sheaf of rings
is the support of the unit section.
\end{proof}




\section{Henselian rings}
\label{section-henselian-ring}

\noindent
We begin by stating a theorem which has already been used many times
in the stacks project. There are many versions of this result; here we
just state the algebraic version.

\begin{theorem}
\label{theorem-quasi-finite-etale-locally}
Let $A\to B$ be finite type ring map and $\mathfrak p \subset A$ a prime
ideal. Then there exist an \'etale ring map $A \to A'$ and a prime
$\mathfrak p' \subset A'$ lying over $\mathfrak p$ such that
\begin{enumerate}
\item
$\kappa(\mathfrak p) = \kappa(\mathfrak p')$,
\item
$ B \otimes_A A' = B_1\times \cdots \times B_r \times C$,
\item
$ A'\to B_i$ is finite and there exists a unique prime $q_i\subset B_i$ lying
over $\mathfrak p'$, and
\item all irreducible components of the fibre
$\Spec(C \otimes_{A'} \kappa(\mathfrak p'))$ of $C$ over $\mathfrak p'$
have dimension at least 1.
\end{enumerate}
\end{theorem}

\begin{proof}
See Algebra, Lemma \ref{algebra-lemma-etale-makes-quasi-finite-finite}, or
see \cite[Th\'eor\`eme 18.12.1]{EGA4}. For a slew of versions in terms of
morphisms of schemes, see
More on Morphisms, Section \ref{more-morphisms-section-etale-localization}.
\end{proof}

\noindent
Recall Hensel's lemma.
There are many versions of this lemma. Here are two:
\begin{enumerate}
\item[(f)] if $f\in \mathbf{Z}_p[T]$ monic and
$f \bmod p = g_0 h_0$ with $gcd(g_0, h_0) = 1$ then $f$ factors
as $f = gh$ with $\bar g = g_0$ and $\bar h = h_0$,
\item[(r)] if $f \in \mathbf{Z}_p[T]$, monic $a_0 \in \mathbf{F}_p$,
$\bar f(a_0) =0$ but $\bar f'(a_0) \neq 0$
then there exists $a \in \mathbf{Z}_p$ with
$f(a) = 0$ and $\bar a = a_0$.
\end{enumerate}
Both versions are true (we will see this later). The first version
asks for lifts of factorizations into coprime parts,
and the second version asks for lifts of simple roots
modulo the maximal ideal. It turns out that requiring
these conditions for a general local ring are equivalent, and are
equivalent to many other conditions. We use the root lifting
property as the definition of a henselian local ring as it is
often the easiest one to check.

%10.01.09
\begin{definition}
\label{definition-henselian}
(See Algebra, Definition \ref{algebra-definition-henselian}.)
A local ring $(R, \mathfrak m, \kappa)$ is called
{\it henselian} if for all
$f \in R[T]$ monic, for all $a_0 \in \kappa$ such that
$\bar f(a_0) = 0$ and $\bar f'(a_0) \neq 0$, there exists
an $a \in R$ such that $f(a) = 0$ and $a \bmod \mathfrak m = a_0$.
\end{definition}

\noindent
A good example of henselian local rings
to keep in mind is complete local rings.
Recall
(Algebra, Definition \ref{algebra-definition-complete-local-ring})
that a complete local ring is a local ring $(R, \mathfrak m)$ such that
$R \cong \lim_n R/\mathfrak m^n$, i.e., it is complete and separated
for the $\mathfrak m$-adic topology.

\begin{theorem}
\label{theorem-hensel}
Complete local rings are henselian.
\end{theorem}

\begin{proof}
Newton's method. See
Algebra, Lemma \ref{algebra-lemma-complete-henselian}.
\end{proof}

\begin{theorem}
\label{theorem-henselian}
Let $(R, \mathfrak m, \kappa)$ be a local ring. The following are equivalent:
\begin{enumerate}
\item $R$ is henselian,
\item for any $f\in R[T]$ and any factorization $\bar f = g_0 h_0$ in
$\kappa[T]$ with $\gcd(g_0, h_0)=1$, there exists a factorization $f=gh$ in
$R[T]$ with $\bar g = g_0$ and $\bar h = h_0$,
\item any finite $R$-algebra $S$ is isomorphic to a finite product of finite
local rings,
\item any finite type $R$-algebra $A$ is isomorphic to a product
$A \cong A' \times C$ where $A' \cong A_1 \times \ldots \times A_r$
is a product of finite local $R$-algebras and all the irreducible
components of $C \otimes_R \kappa$ have dimension at least 1,
\item if $A$ is an \'etale $R$-algebra and $\mathfrak n$ is a maximal ideal of
$A$ lying over $\mathfrak m$ such that $\kappa \cong A/\mathfrak n$, then there
exists an isomorphism $\varphi: A \cong R \times A'$ such that
$\varphi(\mathfrak n) = \mathfrak m \times A' \subset R \times A'$.
\end{enumerate}
\end{theorem}

\begin{proof}
This is just a subset of the results from
Algebra, Lemma \ref{algebra-lemma-characterize-henselian}.
Note that part (5) above corresponds to part (8) of
Algebra, Lemma \ref{algebra-lemma-characterize-henselian}
but is formulated slightly differently.
\end{proof}

\begin{lemma}
\label{lemma-finite-over-henselian}
If $R$ is henselian and $A$ is a finite $R$-algebra, then $A$ is a finite
product of henselian local rings.
\end{lemma}

\begin{proof}
See
Algebra, Lemma \ref{algebra-lemma-finite-over-henselian}.
\end{proof}

\begin{definition}
\label{definition-strictly-henselian}
A local ring $R$ is called {\it strictly henselian} if it is henselian and its
residue field is separably closed.
\end{definition}

\begin{example}
\label{example-powerseries}
In the case $R = \mathbf{C}[[t]]$, the \'etale $R$-algebras are finite products
of the trivial extension $R \to R$ and the extensions
$R \to R[X, X^{-1}]/(X^n-t)$.
The latter ones factor through the open $D(t) \subset \Spec(R)$, so any
\'etale covering can be refined by the covering
$\{\text{id} : \Spec(R) \to \Spec(R)\}$. We will see below that
this is a somewhat general fact on \'etale coverings of spectra of henselian
rings. This will show that higher \'etale cohomology of the spectrum of a
strictly henselian ring is zero.
\end{example}

\begin{theorem}
\label{theorem-henselization}
Let $(R, \mathfrak m, \kappa)$ be a local ring and
$\kappa\subset\kappa^{sep}$ a separable algebraic closure.
There exist canonical flat local ring maps $R \to R^h \to R^{sh}$ where
\begin{enumerate}
\item $R^h$, $R^{sh}$ are filtered colimits of \'etale $R$-algebras,
\item $R^h$ is henselian, $R^{sh}$ is strictly henselian,
\item $\mathfrak m R^h$ (resp.\ $\mathfrak m R^{sh}$) is the
maximal ideal of $R^h$ (resp.\ $R^{sh}$), and
\item $\kappa = R^h/\mathfrak m R^h$, and
$\kappa^{sep} = R^{sh}/\mathfrak m R^{sh}$ as extensions of $\kappa$.
\end{enumerate}
\end{theorem}

\begin{proof}
The structure of $R^h$ and $R^{sh}$ is described in
Algebra, Lemmas \ref{algebra-lemma-henselization} and
\ref{algebra-lemma-strict-henselization}.
\end{proof}

\noindent
The rings constructed in Theorem \ref{theorem-henselization}
are called respectively the {\it henselization} and the
{\it strict henselization} of the local ring $R$, see
Algebra, Definition \ref{algebra-definition-henselization}.
Many of the properties of $R$ are reflected in its (strict) henselization,
see More on Algebra,
Section \ref{more-algebra-section-permanence-henselization}.




\section{Stalks of the structure sheaf}
\label{section-stalks-structure-sheaf}

\noindent
In this section we identify the stalk of the structure sheaf at a geometric
point with the strict henselization of the local ring at the corresponding
``usual'' point.

\begin{lemma}
\label{lemma-describe-etale-local-ring}
Let $S$ be a scheme.
Let $\overline{s}$ be a geometric point of $S$ lying over $s \in S$.
Let $\kappa = \kappa(s)$ and let
$\kappa \subset \kappa^{sep} \subset \kappa(\overline{s})$ denote
the separable algebraic closure of $\kappa$ in $\kappa(\overline{s})$.
Then there is a canonical identification
$$
(\mathcal{O}_{S, s})^{sh}
\cong
\mathcal{O}_{S, \overline{s}}
$$
where the left hand side is the strict henselization of the local ring
$\mathcal{O}_{S, s}$ as described in
Theorem \ref{theorem-henselization}
and right hand side is the stalk of the structure sheaf
$\mathcal{O}_S$ on $S_\etale$ at
the geometric point $\overline{s}$.
\end{lemma}

\begin{proof}
Let $\Spec(A) \subset S$ be an affine neighbourhood of $s$.
Let $\mathfrak p \subset A$ be the prime ideal corresponding to $s$.
With these choices we have canonical isomorphisms
$\mathcal{O}_{S, s} = A_{\mathfrak p}$ and $\kappa(s) = \kappa(\mathfrak p)$.
Thus we have
$\kappa(\mathfrak p) \subset \kappa^{sep} \subset \kappa(\overline{s})$.
Recall that
$$
\mathcal{O}_{S, \overline{s}} =
\colim_{(U, \overline{u})} \mathcal{O}(U)
$$
where the limit is over the \'etale neighbourhoods of $(S, \overline{s})$.
A cofinal system is given by those \'etale neighbourhoods $(U, \overline{u})$
such that $U$ is affine and $U \to S$ factors through $\Spec(A)$.
In other words, we see that
$$
\mathcal{O}_{S, \overline{s}} = \colim_{(B, \mathfrak q, \phi)} B
$$
where the colimit is over \'etale $A$-algebras $B$ endowed with a prime
$\mathfrak q$ lying over $\mathfrak p$ and a
$\kappa(\mathfrak p)$-algebra map
$\phi : \kappa(\mathfrak q) \to \kappa(\overline{s})$.
Note that since $\kappa(\mathfrak q)$ is finite separable over
$\kappa(\mathfrak p)$ the image of $\phi$ is contained in $\kappa^{sep}$.
Via these translations the result of the lemma is equivalent
to the result of
Algebra, Lemma \ref{algebra-lemma-strict-henselization-different}.
\end{proof}

\begin{definition}
\label{definition-etale-local-rings}
Let $S$ be a scheme. Let $\overline{s}$ be a geometric point of $S$
lying over the point $s \in S$.
\begin{enumerate}
\item The {\it \'etale local ring of $S$ at $\overline{s}$}
is the stalk of the structure sheaf $\mathcal{O}_S$ on $S_\etale$
at $\overline{s}$. We sometimes call this the
{\it strict henselization of $\mathcal{O}_{S, s}$} relative
to the geometric point $\overline{s}$.
Notation used:
$\mathcal{O}_{S, \overline{s}} = \mathcal{O}_{S, s}^{sh}$.
\item The {\it henselization of $\mathcal{O}_{S, s}$} is the
henselization of the local ring of $S$ at $s$. See
Algebra, Definition \ref{algebra-definition-henselization},
and
Theorem \ref{theorem-henselization}.
Notation: $\mathcal{O}_{S, s}^h$.
\item The {\it strict henselization of $S$ at $\overline{s}$}
is the scheme $\Spec(\mathcal{O}_{S, s}^{sh})$.
\item The {\it henselization of $S$ at $s$} is the scheme
$\Spec(\mathcal{O}_{S, s}^h)$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-describe-henselization}
Let $S$ be a scheme. Let $s \in S$. Then we have
$$
\mathcal{O}_{S, s}^h =
\colim_{(U, u)} \mathcal{O}(U)
$$
where the colimit is over the filtered category of
\'etale neighbourhoods $(U, u)$ of $(S, s)$ such that
$\kappa(s) = \kappa(u)$.
\end{lemma}

\begin{proof}
This lemma is a copy of
More on Morphisms, Lemma \ref{more-morphisms-lemma-describe-henselization}.
\end{proof}

\begin{remark}
\label{remark-henselization-Noetherian}
Let $S$ be a scheme. Let $s \in S$.
If $S$ is locally noetherian then $\mathcal{O}_{S, s}^h$
is also noetherian and it has the same completion:
$$
\widehat{\mathcal{O}_{S, s}} \cong \widehat{\mathcal{O}_{S, s}^h}.
$$
In particular,
$\mathcal{O}_{S, s} \subset
\mathcal{O}_{S, s}^h \subset
\widehat{\mathcal{O}_{S, s}}$.
The henselization of $\mathcal{O}_{S, s}$ is in general much
smaller than its completion and inherits many of its properties.
For example, if $\mathcal{O}_{S, s}$ is reduced, then so is
$\mathcal{O}_{S, s}^h$, but this is not true for the completion in general.
Insert future references here.
\end{remark}

\begin{lemma}
\label{lemma-etale-site-locally-ringed}
Let $S$ be a scheme. The small \'etale site $S_\etale$ endowed with
its structure sheaf $\mathcal{O}_S$ is a locally ringed site, see
Modules on Sites, Definition \ref{sites-modules-definition-locally-ringed}.
\end{lemma}

\begin{proof}
This follows because the stalks
$\mathcal{O}_{S, s}^{sh} = \mathcal{O}_{S, \overline{s}}$ are
local, and because $S_\etale$ has enough points, see
Lemma \ref{lemma-describe-etale-local-ring},
Theorem \ref{theorem-exactness-stalks},
and
Remarks \ref{remarks-enough-points}.
See
Modules on Sites, Lemmas \ref{sites-modules-lemma-locally-ringed-stalk} and
\ref{sites-modules-lemma-ringed-stalk-not-zero}
for the fact that this implies the small \'etale site is locally ringed.
\end{proof}






\section{Functoriality of small \'etale topos}
\label{section-functoriality}

\noindent
So far we haven't yet discussed the functoriality of the \'etale site, in
other words what happens when given a morphism of schemes. A precise formal
discussion can be found in
Topologies, Section \ref{topologies-section-etale}.
In this and the next sections we discuss this material briefly specifically
in the setting of small \'etale sites.

\medskip\noindent
Let $f : X \to Y$ be a morphism of schemes. We obtain a functor
\begin{equation}
\label{equation-functorial}
u : Y_\etale \longrightarrow X_\etale, \quad
V/Y \longmapsto X \times_Y V/X.
\end{equation}
This functor has the following important properties
\begin{enumerate}
\item $u(\text{final object}) = \text{final object}$,
\item $u$ preserves fibre products,
\item if $\{V_j \to V\}$ is a covering in $Y_\etale$, then
$\{u(V_j) \to u(V)\}$ is a covering in $X_\etale$.
\end{enumerate}
Each of these is easy to check (omitted). As a consequence we obtain what
is called a {\it morphism of sites}
$$
f_{small} : X_\etale \longrightarrow Y_\etale,
$$
see
Sites, Definition \ref{sites-definition-morphism-sites}
and
Sites, Proposition \ref{sites-proposition-get-morphism}.
It is not necessary to know about the abstract notion in detail
in order to work with \'etale sheaves and \'etale cohomology.
It usually suffices to know that there are functors
$f_{small, *}$ (pushforward) and $f_{small}^{-1}$ (pullback)
on \'etale sheaves, and to know some of their simple properties.
We will discuss these properties in the next sections, but we will
sometimes refer to the more abstract material for proofs since
that is often the natural setting to prove them.


\section{Direct images}
\label{section-direct-image}

\noindent
Let us define the pushforward of a presheaf.

\begin{definition}
\label{definition-direct-image-presheaf}
Let $f: X\to Y$ be a morphism of schemes.
Let $\mathcal{F} $ a presheaf of sets on $X_\etale$.
The {\it direct image}, or {\it pushforward} of $\mathcal{F}$
(under $f$) is
$$
f_*\mathcal{F} : Y_\etale^{opp} \longrightarrow \textit{Sets}, \quad
(V/Y) \longmapsto \mathcal{F}(X \times_Y V/X).
$$
We sometimes write $f_* = f_{small, *}$ to distinguish from other
direct image functors (such as usual Zariski pushforward or $f_{big, *}$).
\end{definition}

\noindent
This is a well-defined \'etale presheaf since the base change of an \'etale
morphism is again \'etale. A more categorical way of saying this is that
$f_*\mathcal{F}$ is the composition of functors $\mathcal{F} \circ u$
where $u$ is as in Equation (\ref{equation-functorial}). This makes it
clear that the construction is functorial in the presheaf
$\mathcal{F}$ and hence we obtain a functor
$$
f_* = f_{small, *} :
\textit{PSh}(X_\etale)
\longrightarrow
\textit{PSh}(Y_\etale)
$$
Note that if $\mathcal{F}$ is a presheaf of abelian groups, then
$f_*\mathcal{F}$ is also a presheaf of abelian groups and we obtain
$$
f_* = f_{small, *} :
\textit{PAb}(X_\etale)
\longrightarrow
\textit{PAb}(Y_\etale)
$$
as before (i.e., defined by exactly the same rule).

\begin{remark}
\label{remark-direct-image-sheaf}
We claim that the direct image of a sheaf is a sheaf.
Namely, if $\{V_j \to V\}$ is an \'etale covering in $Y_\etale$
then $\{X \times_Y V_j \to X \times_Y V\}$ is an \'etale covering in
$X_\etale$. Hence the sheaf condition for $\mathcal{F}$ with respect
to $\{X \times_Y V_i \to X \times_Y V\}$
is equivalent to the sheaf condition for $f_*\mathcal{F}$ with respect to
$\{V_i \to V\}$. Thus if $\mathcal{F}$ is a sheaf, so is
$f_*\mathcal{F}$.
\end{remark}

\begin{definition}
\label{definition-direct-image-sheaf}
Let $f: X\to Y$ be a morphism of schemes.
Let $\mathcal{F} $ a sheaf of sets on $X_\etale$.
The {\it direct image}, or {\it pushforward} of $\mathcal{F}$
(under $f$) is
$$
f_*\mathcal{F} : Y_\etale^{opp} \longrightarrow \textit{Sets}, \quad
(V/Y) \longmapsto \mathcal{F}(X \times_Y V/X)
$$
which is a sheaf by
Remark \ref{remark-direct-image-sheaf}.
We sometimes write $f_* = f_{small, *}$ to distinguish from other
direct image functors (such as usual Zariski pushforward or $f_{big, *}$).
\end{definition}

\noindent
The exact same discussion as above applies and we obtain functors
$$
f_* = f_{small, *} :
\Sh(X_\etale)
\longrightarrow
\Sh(Y_\etale)
$$
and
$$
f_* = f_{small, *} :
\textit{Ab}(X_\etale)
\longrightarrow
\textit{Ab}(Y_\etale)
$$
called {\it direct image} again.

\medskip\noindent
The functor $f_*$ on abelian sheaves is left exact. (See
Homology, Section \ref{homology-section-functors}
for what it means for a functor between abelian categories to be left exact.)
Namely, if
$0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3$
is exact on $X_\etale$, then for every
$U/X \in \Ob(X_\etale)$
the sequence of abelian groups
$0 \to \mathcal{F}_1(U) \to \mathcal{F}_2(U) \to \mathcal{F}_3(U)$
is exact. Hence for every $V/Y \in \Ob(Y_\etale)$
the sequence of abelian groups
$0 \to f_*\mathcal{F}_1(V) \to f_*\mathcal{F}_2(V) \to f_*\mathcal{F}_3(V)$
is exact, because this is the previous sequence with $U = X \times_Y V$.

\begin{definition}
\label{definition-higher-direct-images}
Let $f: X \to Y$ be a morphism of schemes.
The right derived functors $\{R^pf_*\}_{p \geq 1}$ of
$f_* : \textit{Ab}(X_\etale) \to \textit{Ab}(Y_\etale)$
are called {\it higher direct images}.
\end{definition}

\noindent
The higher direct images and their derived category variants are
discussed in more detail in (insert future reference here).



\section{Inverse image}
\label{section-inverse-image}

\noindent
In this section we briefly discuss pullback of sheaves on the small
\'etale sites. The precise construction of this is in
Topologies, Section \ref{topologies-section-etale}.

\begin{definition}
\label{definition-inverse-image}
Let $f: X\to Y$ be a morphism of schemes. The {\it inverse image}, or
{\it pullback}\footnote{We use the notation $f^{-1}$ for pullbacks of
sheaves of sets or sheaves of abelian groups, and we reserve $f^*$ for
pullbacks of sheaves of modules via a morphism of ringed sites/topoi.}
functors are the functors
$$
f^{-1} = f_{small}^{-1} :
\Sh(Y_\etale)
\longrightarrow
\Sh(X_\etale)
$$
and
$$
f^{-1} = f_{small}^{-1} :
\textit{Ab}(Y_\etale)
\longrightarrow
\textit{Ab}(X_\etale)
$$
which are left adjoint to $f_* = f_{small, *}$. Thus
$f^{-1}$ thus characterized by the fact that
$$
\Hom_{{\Sh(X_\etale)}} (f^{-1}\mathcal{G}, \mathcal{F})
=
\Hom_{\Sh(Y_\etale)} (\mathcal{G}, f_*\mathcal{F})
$$
functorially, for any $\mathcal{F} \in \Sh(X_\etale)$ and
$\mathcal{G} \in \Sh(Y_\etale)$. We similarly have
$$
\Hom_{{\textit{Ab}(X_\etale)}} (f^{-1}\mathcal{G}, \mathcal{F})
=
\Hom_{\textit{Ab}(Y_\etale)} (\mathcal{G}, f_*\mathcal{F})
$$
for $\mathcal{F} \in \textit{Ab}(X_\etale)$ and
$\mathcal{G} \in \textit{Ab}(Y_\etale)$.
\end{definition}

\noindent
It is not trivial that such an adjoint exists.
On the other hand, it exists in a fairly general setting, see
Remark \ref{remark-functoriality-general}
below. The general machinery shows that $f^{-1}\mathcal{G}$
is the sheaf associated to the presheaf
\begin{equation}
\label{equation-pullback}
U/X
\longmapsto
\colim_{U \to X \times_Y V} \mathcal{G}(V/Y)
\end{equation}
where the colimit is over the category of pairs
$(V/Y, \varphi : U/X \to X \times_Y V/X)$.
To see this apply
Sites, Proposition \ref{sites-proposition-get-morphism}
to the functor $u$ of Equation (\ref{equation-functorial})
and use the description of $u_s = (u_p\ )^\#$ in
Sites, Sections \ref{sites-section-continuous-functors} and
\ref{sites-section-functoriality-PSh}.
We will occasionally use this formula for the pullback
in order to prove some of its basic properties.

\begin{lemma}
\label{lemma-stalk-pullback}
Let $f : X \to Y$ be a morphism of schemes.
\begin{enumerate}
\item The functor
$f^{-1} : \textit{Ab}(Y_\etale) \to \textit{Ab}(X_\etale)$
is exact.
\item The functor
$f^{-1} : \Sh(Y_\etale) \to \Sh(X_\etale)$
is exact, i.e., it commutes with finite limits and colimits, see
Categories, Definition \ref{categories-definition-exact}.
\item Let $\overline{x} \to X$ be a geometric point.
Let $\mathcal{G}$ be a sheaf on $Y_\etale$.
Then there is a canonical identification
$$
(f^{-1}\mathcal{G})_{\overline{x}} = \mathcal{G}_{\overline{y}}.
$$
where $\overline{y} = f \circ \overline{x}$.
\item For any $V \to Y$ \'etale we have $f^{-1}h_V = h_{X \times_Y V}$.
\end{enumerate}
\end{lemma}

\begin{proof}
The exactness of $f^{-1}$ on sheaves of sets is a consequence of
Sites, Proposition \ref{sites-proposition-get-morphism}
applied to our functor $u$ of Equation (\ref{equation-functorial}).
In fact the exactness of pullback is part of the definition of
of a morphism of topoi (or sites if you like). Thus we see (2) holds.
It implies part (1) since given an abelian sheaf $\mathcal{G}$ on
$Y_\etale$
the underlying sheaf of sets of $f^{-1}\mathcal{F}$ is the same
as $f^{-1}$ of the underlying sheaf of sets of $\mathcal{F}$, see
Sites, Section \ref{sites-section-sheaves-algebraic-structures}.
See also
Modules on Sites, Lemma \ref{sites-modules-lemma-flat-pullback-exact}.
In the literature (1) and (2) are sometimes deduced from (3) via
Theorem \ref{theorem-exactness-stalks}.

\medskip\noindent
Part (3) is a general fact about stalks of pullbacks, see
Sites, Lemma \ref{sites-lemma-point-morphism-sites}.
We will also prove (3) directly as follows. Note that by
Lemma \ref{lemma-stalk-exact}
taking stalks commutes with sheafification.
Now recall that $f^{-1}\mathcal{G}$ is the sheaf
associated to the presheaf
$$
U \longrightarrow \colim_{U \to X \times_Y V} \mathcal{G}(V),
$$
see Equation (\ref{equation-pullback}).
Thus we have
\begin{align*}
(f^{-1}\mathcal{G})_{\overline{x}}
& = \colim_{(U, \overline{u})} f^{-1}\mathcal{G}(U) \\
& = \colim_{(U, \overline{u})}
\colim_{a : U \to X \times_Y V} \mathcal{G}(V) \\
& = \colim_{(V, \overline{v})} \mathcal{G}(V) \\
& = \mathcal{G}_{\overline{y}}
\end{align*}
in the third equality the pair $(U, \overline{u})$ and the map
$a : U \to X \times_Y V$ corresponds to the pair $(V, a \circ \overline{u})$.

\medskip\noindent
Part (4) can be proved in a similar manner by identifying the colimits
which define $f^{-1}h_V$. Or you can use
Yoneda's lemma (Categories, Lemma \ref{categories-lemma-yoneda})
and the functorial equalities
$$
\Mor_{\Sh(X_\etale)}(f^{-1}h_V, \mathcal{F}) =
\Mor_{\Sh(Y_\etale)}(h_V, f_*\mathcal{F}) =
f_*\mathcal{F}(V) = \mathcal{F}(X \times_Y V)
$$
combined with the fact that representable presheaves are sheaves. See also
Sites, Lemma \ref{sites-lemma-pullback-representable-sheaf}
for a completely general result.
\end{proof}

\noindent
The pair of functors $(f_*, f^{-1})$ define a morphism of small \'etale topoi
$$
f_{small} :
\Sh(X_\etale)
\longrightarrow
\Sh(Y_\etale)
$$
Many generalities on cohomology of sheaves hold for topoi and
morphisms of topoi. We will try to point out when results are
general and when they are specific to the \'etale topos.

\begin{remark}
\label{remark-functoriality-general}
More generally, let $\mathcal{C}_1, \mathcal{C}_2$ be sites, and
assume they have final objects and fibre products. Let
$u: \mathcal{C}_2 \to \mathcal{C}_1$ be a functor satisfying:
\begin{enumerate}
\item if $\{V_i \to V\}$ is a covering of $\mathcal{C}_2$, then
$\{u(V_i) \to V_i\}$ is a covering of $\mathcal{C}_1$ (we
say that $u$ is {\it continuous}), and
\item $u$ commutes with finite limits (i.e., $u$ is left exact, i.e.,
$u$ preserves fibre products and final objects).
\end{enumerate}
Then one can define
$f_*: \Sh(\mathcal{C}_1) \to \Sh(\mathcal{C}_2)$
by $ f_* \mathcal{F}(V) = \mathcal{F}(u(V))$.
Moreover, there exists an exact functor $f^{-1}$ which
is left adjoint to $f_*$, see
Sites, Definition \ref{sites-definition-morphism-sites} and
Proposition \ref{sites-proposition-get-morphism}.
Warning: It is not enough to require simply that $u$ is continuous
and commutes with fibre products in order to get a morphism of topoi.
\end{remark}




\section{Functoriality of big topoi}
\label{section-functoriality-big-topoi}

\noindent
Given a morphism of schemes $f : X \to Y$ there are a whole host of
morphisms of topoi associated to $f$, see
Topologies, Section \ref{topologies-section-change-topologies}
for a list. Perhaps the most used ones are the morphisms of topoi
$$
f_{big} = f_{big, \tau} :
\Sh((\Sch/X)_\tau)
\longrightarrow
\Sh((\Sch/Y)_\tau)
$$
where $\tau \in \{Zariski, \etale, smooth, syntomic, fppf\}$.
These each correspond to a continuous functor
$$
(\Sch/Y)_\tau \longrightarrow (\Sch/X)_\tau, \quad
V/Y \longmapsto X \times_Y V/X
$$
which preserves final objects, fibre products and covering, and hence
defines a morphism of sites
$$
f_{big} : (\Sch/X)_\tau \longrightarrow (\Sch/Y)_\tau.
$$
See
Topologies, Sections \ref{topologies-section-zariski},
\ref{topologies-section-etale},
\ref{topologies-section-smooth},
\ref{topologies-section-syntomic}, and
\ref{topologies-section-fppf}.
In particular, pushforward along $f_{big}$ is given by the rule
$$
(f_{big, *}\mathcal{F})(V/Y) = \mathcal{F}(X \times_Y V/X)
$$
It turns out that these morphisms of topoi have an inverse
image functor $f_{big}^{-1}$ which is very easy to describe.
Namely, we have
$$
(f_{big}^{-1}\mathcal{G})(U/X) = \mathcal{G}(U/Y)
$$
where the structure morphism of $U/Y$ is the composition of the
structure morphism $U \to X$ with $f$, see
Topologies, Lemmas \ref{topologies-lemma-morphism-big},
\ref{topologies-lemma-morphism-big-etale},
\ref{topologies-lemma-morphism-big-smooth},
\ref{topologies-lemma-morphism-big-syntomic}, and
\ref{topologies-lemma-morphism-big-fppf}.







\section{Functoriality and sheaves of modules}
\label{section-morphisms-modules}

\noindent
In this section we are going to reformulate some of the material explained in
Descent, Section \ref{descent-section-quasi-coherent-sheaves}
in the setting of \'etale topologies. Let $f : X \to Y$ be a morphism of
schemes. We have seen above, see
Sections \ref{section-functoriality}, \ref{section-direct-image}, and
\ref{section-inverse-image}
that this induces a morphism $f_{small}$ of small \'etale sites. In
Descent, Remark \ref{descent-remark-change-topologies-ringed}
we have seen that $f$ also induces a natural map
$$
f_{small}^\sharp :
\mathcal{O}_{Y_\etale}
\longrightarrow
f_{small, *}\mathcal{O}_{X_\etale}
$$
of sheaves of rings on
$Y_\etale$ such that $(f_{small}, f_{small}^\sharp)$
is a morphism of ringed sites. See
Modules on Sites, Definition \ref{sites-modules-definition-ringed-site}
for the definition of a morphism of ringed sites.
Let us just recall here that $f_{small}^\sharp$ is defined by the
compatible system of maps
$$
\text{pr}_V^\sharp : \mathcal{O}(V) \longrightarrow \mathcal{O}(X \times_Y V)
$$
for $V$ varying over the objects of $Y_\etale$.

\medskip\noindent
It is clear that this construction is compatible with compositions of
morphisms of schemes. More precisely, if $f : X \to Y$ and $g : Y \to Z$
are morphisms of schemes, then we have
$$
(g_{small}, g_{small}^\sharp)
\circ
(f_{small}, f_{small}^\sharp)
=
((g \circ f)_{small}, (g \circ f)_{small}^\sharp)
$$
as morphisms of ringed topoi. Moreover, by
Modules on Sites, Definition \ref{sites-modules-definition-pushforward}
we see that given a morphism $f : X \to Y$ of schemes
we get well defined pullback and direct image functors
\begin{align*}
f_{small}^* :
\textit{Mod}(\mathcal{O}_{Y_\etale})
\longrightarrow
\textit{Mod}(\mathcal{O}_{X_\etale}), \\
f_{small, *} :
\textit{Mod}(\mathcal{O}_{X_\etale})
\longrightarrow
\textit{Mod}(\mathcal{O}_{Y_\etale})
\end{align*}
which are adjoint in the usual way. If $g : Y \to Z$ is another morphism
of schemes, then we have
$(g \circ f)_{small}^* = f_{small}^* \circ g_{small}^*$
and $(g \circ f)_{small, *} = g_{small, *} \circ f_{small, *}$
because of what we said about compositions.

\medskip\noindent
There is quite a bit of difference between the category
of all $\mathcal{O}_X$ modules on $X$ and the category between all
$\mathcal{O}_{X_\etale}$-modules on $X_\etale$. But the
results of
Descent, Section \ref{descent-section-quasi-coherent-sheaves}
tell us that there is not much difference between considering quasi-coherent
modules on $S$ and quasi-coherent modules on $S_\etale$.
(We have already seen this in
Theorem \ref{theorem-quasi-coherent}
for example.)
In particular, if $f : X \to Y$ is any morphism of schemes, then
the pullback functors $f_{small}^*$ and $f^*$ match for
quasi-coherent sheaves, see
Descent,
Proposition \ref{descent-proposition-equivalence-quasi-coherent-functorial}.
Moreover, the same is true for pushforward provided $f$ is
quasi-compact and quasi-separated, see
Descent, Lemma \ref{descent-lemma-higher-direct-images-small-etale}.

\medskip\noindent
A few words about functoriality of the structure sheaf on big sites.
Let $f : X \to Y$ be a morphism of schemes. Choose any of the
topologies $\tau \in \{Zariski,\linebreak[0]
\etale,\linebreak[0] smooth,\linebreak[0] syntomic,\linebreak[0]
fppf\}$. Then the morphism
$f_{big} : (\Sch/X)_\tau \to (\Sch/Y)_\tau$
becomes a morphism of ringed sites by a map
$$
f_{big}^\sharp : \mathcal{O}_Y \longrightarrow f_{big, *}\mathcal{O}_X
$$
see Descent, Remark \ref{descent-remark-change-topologies-ringed}.
In fact it is given by the same construction as in the case of small
sites explained above.








\section{Comparing big and small topoi}
\label{section-compare}

\noindent
Let $X$ be a scheme. In
Topologies, Lemma \ref{topologies-lemma-at-the-bottom-etale}
we have introduced comparison morphisms
$\pi_X : (\Sch/X)_\etale \to X_\etale$ and
$i_X : \Sh(X_\etale) \to \Sh((\Sch/X)_\etale)$
with $\pi_X \circ i_X = \text{id}$ and $\pi_{X, *} = i_X^{-1}$.
In
Descent, Remark \ref{descent-remark-change-topologies-ringed}
we have extended these to a morphism of ringed sites
$$
\pi_X : ((\Sch/X)_\etale, \mathcal{O})
\to
(X_\etale, \mathcal{O}_X)
$$
and a morphism of ringed topoi
$$
i_X : (\Sh(X_\etale), \mathcal{O}_X) \to
(\Sh((\Sch/X)_\etale), \mathcal{O})
$$
Note that the restriction $i_X^{-1} = \pi_{X, *}$ (see
Topologies, Definition \ref{topologies-definition-restriction-small-etale})
transforms $\mathcal{O}$ into $\mathcal{O}_X$. Hence
$i_X^*\mathcal{F} = i_X^{-1}\mathcal{F}$ for any $\mathcal{O}$-module
$\mathcal{F}$ on $(\Sch/X)_\etale$. In particular $i_X^*$ is
exact. This functor is often denoted
$\mathcal{F} \mapsto \mathcal{F}|_{X_\etale}$.

\begin{lemma}
\label{lemma-compare-injectives}
Let $X$ be a scheme.
\begin{enumerate}
\item $\mathcal{I}|_{X_\etale}$ is injective in
$\textit{Ab}(X_\etale)$ for $\mathcal{I}$ injective in
$\textit{Ab}((\Sch/X)_\etale)$, and
\item $\mathcal{I}|_{X_\etale}$ is injective in
$\textit{Mod}(X_\etale, \mathcal{O}_X)$
for $\mathcal{I}$ injective in
$\textit{Mod}((\Sch/X)_\etale, \mathcal{O})$.
\end{enumerate}
\end{lemma}

\begin{proof}
This follows formally from the fact that the restriction functor
$\pi_{X, *} = i_X^{-1}$ is an exact left adjoint of $i_{X, *}$, see
Homology, Lemma \ref{homology-lemma-adjoint-preserve-injectives}.
\end{proof}

\noindent
Let $f : X \to Y$ be a morphism of schemes. The commutative diagram of
Topologies, Lemma \ref{topologies-lemma-morphism-big-small-etale} (3)
leads to a commutative diagram of ringed sites
$$
\xymatrix{
(T_\etale, \mathcal{O}_T) \ar[d]_{f_{small}} &
((\Sch/T)_\etale, \mathcal{O}) \ar[d]^{f_{big}} \ar[l]^{\pi_T} \\
(S_\etale, \mathcal{O}_S) &
((\Sch/S)_\etale, \mathcal{O}) \ar[l]_{\pi_S}
}
$$
as one easily sees by writing out the definitions of
$f_{small}^\sharp$, $f_{big}^\sharp$, $\pi_S^\sharp$, and $\pi_T^\sharp$.
In particular this means that
\begin{equation}
\label{equation-compare-big-small}
(f_{big, *}\mathcal{F})|_{Y_\etale} =
f_{small, *}(\mathcal{F}|_{X_\etale})
\end{equation}
for any sheaf $\mathcal{F}$ on $(\Sch/X)_\etale$ and if $\mathcal{F}$
is a sheaf of $\mathcal{O}$-modules, then (\ref{equation-compare-big-small})
is an isomorphism of $\mathcal{O}_Y$-modules on $Y_\etale$.

\begin{lemma}
\label{lemma-compare-higher-direct-image}
Let $f : X \to Y$ be a morphism of schemes.
\begin{enumerate}
\item For any $\mathcal{F} \in \textit{Ab}((\Sch/X)_\etale)$
we have
$$
(Rf_{big, *}\mathcal{F})|_{Y_\etale} =
Rf_{small, *}(\mathcal{F}|_{X_\etale}).
$$
in $D(Y_\etale)$.
\item For any object $\mathcal{F}$ of
$\textit{Mod}((\Sch/X)_\etale, \mathcal{O})$
we have
$$
(Rf_{big, *}\mathcal{F})|_{Y_\etale} =
Rf_{small, *}(\mathcal{F}|_{X_\etale}).
$$
in $D(\textit{Mod}(Y_\etale, \mathcal{O}_Y))$.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows immediately from
Lemma \ref{lemma-compare-injectives}
and (\ref{equation-compare-big-small})
on choosing an injective resolution of $\mathcal{F}$.
\end{proof}












\section{Comparing topologies}
\label{section-compare-topologies}

\noindent
In this section we start studying what happens when you compare
sheaves with respect to different topologies.

\begin{lemma}
\label{lemma-where-sections-are-equal}
Let $S$ be a scheme. Let $\mathcal{F}$ be a sheaf of sets on $S_\etale$.
Let $s, t \in \mathcal{F}(S)$. Then there exists an open $W \subset S$
characterized by the following property: A morphism $f : T \to S$
factors through $W$ if and only if $s|_T = t|_T$ (restriction is
pullback by $f_{small}$).
\end{lemma}

\begin{proof}
Consider the presheaf which assigns to $U \in \Ob(S_\etale)$ the emptyset
if $s|_U \not = t|_U$ and a singleton else. It is clear that this is
a subsheaf of the final object of $\Sh(S_\etale)$. By
Lemma \ref{lemma-support-subsheaf-final}
we find an open $W \subset S$ representing this presheaf.
For a geometric point $\overline{x}$ of $S$ we see that $\overline{x} \in W$
if and only if the stalks of $s$ and $t$ at $\overline{x}$ agree.
By the description of stalks of pullbacks in
Lemma \ref{lemma-stalk-pullback}
we see that $W$ has the desired property.
\end{proof}

\begin{lemma}
\label{lemma-describe-pullback}
Let $S$ be a scheme. Let $\tau \in \{Zariski, \etale\}$. Consider the morphism
$$
\pi : (\Sch/S)_\tau \longrightarrow S_\tau
$$
of Topologies, Lemma \ref{topologies-lemma-at-the-bottom} or
\ref{topologies-lemma-at-the-bottom-etale}. Let $\mathcal{F}$ be a sheaf on
$S_\tau$. Then $\pi^{-1}\mathcal{F}$ is given by the rule
$$
\pi^{-1}\mathcal{F}(T) = \Gamma(T_\tau, f_{small}^{-1}\mathcal{F})
$$
where $f : T \to S$. Moreover, $\pi^{-1}\mathcal{F}$ satisfies the
sheaf condition with respect to fpqc coverings.
\end{lemma}

\begin{proof}
Observe that we have a morphism $i_f : \Sh(T_\tau) \to \Sh(\Sch/S)_\tau)$
such that $\pi \circ i_f = f_{small}$ as morphisms
$T_\tau \to S_\tau$, see
Topologies, Lemmas \ref{topologies-lemma-put-in-T},
\ref{topologies-lemma-morphism-big-small},
\ref{topologies-lemma-put-in-T-etale}, and
\ref{topologies-lemma-morphism-big-small-etale}.
Since pullback is transitive we see that
$i_f^{-1} \pi^{-1}\mathcal{F} = f_{small}^{-1}\mathcal{F}$ as desired.

\medskip\noindent
Let $\{g_i : T_i \to T\}_{i \in I}$ be an fpqc covering.
The final statement means the following: Given a sheaf $\mathcal{G}$
on $T_\tau$ and given sections
$s_i \in \Gamma(T_i, g_{i, small}^{-1}\mathcal{G})$ whose pullbacks
to $T_i \times_T T_j$ agree, there is a unique section $s$ of $\mathcal{G}$
over $T$ whose pullback to $T_i$ agrees with $s_i$.

\medskip\noindent
Let $V \to T$ be an object of $T_\tau$ and let $t \in \mathcal{G}(V)$.
For every $i$ there is a largest open $W_i \subset T_i \times_T V$
such that the pullbacks of $s_i$ and $t$ agree as sections of the pullback
of $\mathcal{G}$ to $W_i \subset T_i \times_T V$, see
Lemma \ref{lemma-where-sections-are-equal}.
Because $s_i$ and $s_j$ agree over $T_i \times_T T_j$ we find
that $W_i$ and $W_j$ pullback to the same open over
$T_i \times_T T_j \times_T V$. By
Descent, Lemma \ref{descent-lemma-open-fpqc-covering}
we find an open $W \subset V$ whose inverse image to $T_i \times_T V$
recovers $W_i$. 

\medskip\noindent
By construction of $g_{i, small}^{-1}\mathcal{G}$ there exists
a $\tau$-covering $\{T_{ij} \to T_i\}_{j \in J_i}$, for each $j$ an
open immersion or \'etale morphism $V_{ij} \to T$, a section
$t_{ij} \in \mathcal{G}(V_{ij})$, and commutative diagrams
$$
\xymatrix{
T_{ij} \ar[r] \ar[d] & V_{ij} \ar[d] \\
T_i \ar[r] & T
}
$$
such that $s_i|_{T_{ij}}$ is the pullback of $t_{ij}$. In other words,
after replacing the covering $\{T_i \to T\}$ by $\{T_{ij} \to T\}$
we may assume there are factorizations $T_i \to V_i \to T$ with
$V_i \in \Ob(T_\tau)$ and sections $t_i \in \mathcal{G}(V_i)$
pulling back to $s_i$ over $T_i$.
By the result of the previous paragraph we find opens $W_i \subset V_i$
such that $t_i|_{W_i}$ ``agrees with'' every $s_j$ over $T_j \times_T W_i$.
Note that $T_i \to V_i$ factors through $W_i$.
Hence $\{W_i \to T\}$ is a $\tau$-covering and the lemma is proven.
\end{proof}

\begin{lemma}
\label{lemma-sections-upstairs}
Let $S$ be a scheme. Let $f : T \to S$ be a morphism such that
\begin{enumerate}
\item $f$ is flat and quasi-compact, and
\item the geometric fibres of $f$ are connected.
\end{enumerate}
Let $\mathcal{F}$ be a sheaf on $S_\etale$.
Then $\Gamma(S, \mathcal{F}) = \Gamma(T, f^{-1}_{small}\mathcal{F})$.
\end{lemma}

\begin{proof}
There is a canonical map
$\Gamma(S, \mathcal{F}) \to \Gamma(T, f_{small}^{-1}\mathcal{F})$.
Since $f$ is surjective (because its fibres are connected) we see that
this map is injective.

\medskip\noindent
To show that the map is surjective, let
$\alpha \in \Gamma(T, f_{small}^{-1}\mathcal{F})$.
Since $\{T \to S\}$ is an fpqc covering we can use
Lemma \ref{lemma-describe-pullback} to see that suffices to prove that
$\alpha$ pulls back to the same section over $T \times_S T$ by the
two projections. Let $\overline{s} \to S$ be a geometric point.
It suffices to show the agreement holds over $(T \times_S T)_{\overline{s}}$
as every geometric point of $T \times_S T$ is contained in one of
these geometric fibres. In other words, we are trying to show that
$\alpha|_{X_{\overline{s}}}$ pulls back to the same section over
$(T \times_S T)_{\overline{s}}$ by the two projections
$T_{\overline{s}} \times_{\overline{s}} T_{\overline{s}}$.
Howeover, since $\mathcal{F}|_{T_{\overline{s}}}$ is the
pullback of $\mathcal{F}|_{\overline{s}}$ it is a constant sheaf
with value $\mathcal{F}_{\overline{s}}$. Since $T_{\overline{s}}$
is connected by assumption, any section of a constant sheaf is constant
and this proves what we want.
\end{proof}

\begin{lemma}
\label{lemma-sections-base-field-extension}
Let $k \subset K$ be an extension of fields with $k$ separably
algebraically closed. Let $S$ be a scheme over $k$. Denote
$p : S_K = S \times_{\Spec(k)} \Spec(K) \to S$ the projection.
Let $\mathcal{F}$ be a sheaf on $S_\etale$.
Then $\Gamma(S, \mathcal{F}) = \Gamma(S_K, p^{-1}_{small}\mathcal{F})$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-sections-upstairs}. Namely, it is clear
that $p$ is flat and quasi-compact as the base change of
$\Spec(K) \to \Spec(k)$. On the other hand, if $\overline{s} : \Spec(L) \to S$
is a geometric point, then the fibre of $p$ over $\overline{s}$
is the spectrum of $K \otimes_k L$ which is irreducible hence connected by
Algebra, Lemma \ref{algebra-lemma-separably-closed-irreducible}.
\end{proof}









\section{Recovering morphisms}
\label{section-morphisms}

\noindent
In this section we prove that the rule which associates to a scheme
its locally ringed small \'etale topos is fully faithful in a suitable
sense, see
Theorem \ref{theorem-fully-faithful}.

\begin{lemma}
\label{lemma-morphism-locally-ringed}
Let $f : X \to Y$ be a morphism of schemes.
The morphism of ringed sites $(f_{small}, f_{small}^\sharp)$
associated to $f$ is a morphism of locally ringed sites, see
Modules on Sites,
Definition \ref{sites-modules-definition-morphism-locally-ringed-topoi}.
\end{lemma}

\begin{proof}
Note that the assertion makes sense since we have seen that
$(X_\etale, \mathcal{O}_{X_\etale})$ and
$(Y_\etale, \mathcal{O}_{Y_\etale})$
are locally ringed sites, see
Lemma \ref{lemma-etale-site-locally-ringed}.
Moreover, we know that $X_\etale$ has enough points, see
Theorem \ref{theorem-exactness-stalks}
and
Remarks \ref{remarks-enough-points}.
Hence it suffices to prove that $(f_{small}, f_{small}^\sharp)$
satisfies condition (3) of
Modules on Sites,
Lemma \ref{sites-modules-lemma-locally-ringed-morphism}.
To see this take a point $p$ of $X_\etale$. By
Lemma \ref{lemma-points-small-etale-site}
$p$ corresponds to a geometric point $\overline{x}$ of $X$.
By
Lemma \ref{lemma-stalk-pullback}
the point $q = f_{small} \circ p$ corresponds to the
geometric point $\overline{y} = f \circ \overline{x}$ of $Y$.
Hence the assertion we have to prove is that the induced map
of stalks
$$
\mathcal{O}_{Y, \overline{y}} \longrightarrow \mathcal{O}_{X, \overline{x}}
$$
is a local ring map. Suppose that $a \in \mathcal{O}_{Y, \overline{y}}$
is an element of the left hand side which maps to an element of the maximal
ideal of the right hand side. Suppose that $a$ is the equivalence class
of a triple $(V, \overline{v}, a)$ with $V \to Y$ \'etale,
$\overline{v} : \overline{x} \to V$ over $Y$, and $a \in \mathcal{O}(V)$.
It maps to the equivalence class of
$(X \times_Y V, \overline{x} \times \overline{v}, \text{pr}_V^\sharp(a))$
in the local ring $\mathcal{O}_{X, \overline{x}}$. But it is clear that
being in the maximal ideal means that pulling back $\text{pr}_V^\sharp(a)$
to an element of $\kappa(\overline{x})$ gives zero. Hence also pulling back
$a$ to $\kappa(\overline{x})$ is zero. Which means that $a$ lies in the
maximal ideal of $\mathcal{O}_{Y, \overline{y}}$.
\end{proof}

\begin{lemma}
\label{lemma-2-morphism}
Let $X$, $Y$ be schemes. Let $f : X \to Y$ be a morphism of schemes.
Let $t$ be a $2$-morphism from $(f_{small}, f_{small}^\sharp)$ to itself, see
Modules on Sites,
Definition \ref{sites-modules-definition-2-morphism-ringed-topoi}.
Then $t = \text{id}$.
\end{lemma}

\begin{proof}
This means that $t : f^{-1}_{small} \to f^{-1}_{small}$
is a transformation of functors such that the diagram
$$
\xymatrix{
f_{small}^{-1}\mathcal{O}_Y
\ar[rd]_{f_{small}^\sharp}  & &
f_{small}^{-1}\mathcal{O}_Y \ar[ll]^t \ar[ld]^{f_{small}^\sharp} \\
& \mathcal{O}_X
}
$$
is commutative. Suppose $V \to Y$ is \'etale with $V$ affine. By
Morphisms, Lemma \ref{morphisms-lemma-quasi-affine-finite-type-over-S}
we may choose an immersion $i : V \to \mathbf{A}^n_Y$ over $Y$.
In terms of sheaves this means that $i$ induces an injection
$h_i : h_V \to \prod_{j = 1, \ldots, n} \mathcal{O}_Y$ of sheaves.
The base change $i'$ of $i$ to $X$ is an immersion
(Schemes, Lemma \ref{schemes-lemma-base-change-immersion}).
Hence $i' : X \times_Y V \to \mathbf{A}^n_X$ is an immersion, which
in turn means that
$h_{i'} : h_{X \times_Y V} \to \prod_{j = 1, \ldots, n} \mathcal{O}_X$
is an injection of sheaves.
Via the identification $f_{small}^{-1}h_V = h_{X \times_Y V}$ of
Lemma \ref{lemma-stalk-pullback}
the map $h_{i'}$ is equal to
$$
\xymatrix{
f_{small}^{-1}h_V \ar[r]^-{f^{-1}h_i} &
\prod_{j = 1, \ldots, n} f_{small}^{-1}\mathcal{O}_Y
\ar[r]^{\prod f^\sharp} &
\prod_{j = 1, \ldots, n} \mathcal{O}_X
}
$$
(verification omitted). This means that the map
$t : f_{small}^{-1}h_V \to f_{small}^{-1}h_V$
fits into the commutative diagram
$$
\xymatrix{
f_{small}^{-1}h_V \ar[r]^-{f^{-1}h_i} \ar[d]^t &
\prod_{j = 1, \ldots, n} f_{small}^{-1}\mathcal{O}_Y
\ar[r]^-{\prod f^\sharp} \ar[d]^{\prod t} &
\prod_{j = 1, \ldots, n} \mathcal{O}_X \ar[d]^{\text{id}}\\
f_{small}^{-1}h_V \ar[r]^-{f^{-1}h_i} &
\prod_{j = 1, \ldots, n} f_{small}^{-1}\mathcal{O}_Y
\ar[r]^-{\prod f^\sharp} &
\prod_{j = 1, \ldots, n} \mathcal{O}_X
}
$$
The commutativity of the right square holds by our assumption on $t$
explained above.
Since the composition of the horizontal arrows is injective
by the discussion above we conclude that the left vertical arrow
is the identity map as well. Any sheaf of sets on
$Y_\etale$ admits a surjection from a (huge) coproduct of sheaves
of the form $h_V$ with $V$ affine (combine
Lemma \ref{lemma-alternative}
with
Sites, Lemma \ref{sites-lemma-sheaf-coequalizer-representable}).
Thus we conclude that $t : f_{small}^{-1} \to f_{small}^{-1}$
is the identity transformation as desired.
\end{proof}

\begin{lemma}
\label{lemma-faithful}
Let $X$, $Y$ be schemes.
Any two morphisms $a, b : X \to Y$ of schemes
for which there exists a $2$-isomorphism
$(a_{small}, a_{small}^\sharp) \cong (b_{small}, b_{small}^\sharp)$
in the $2$-category of ringed topoi are equal.
\end{lemma}

\begin{proof}
Let us argue this carefuly since it is a bit confusing.
Let $t : a_{small}^{-1} \to b_{small}^{-1}$ be the $2$-isomorphism.
Consider any open $V \subset Y$. Note that $h_V$ is a subsheaf of the
final sheaf $*$. Thus both $a_{small}^{-1}h_V = h_{a^{-1}(V)}$
and $b_{small}^{-1}h_V = h_{b^{-1}(V)}$ are subsheaves of the final sheaf.
Thus the isomorphism
$$
t : a_{small}^{-1}h_V = h_{a^{-1}(V)} \to b_{small}^{-1}h_V = h_{b^{-1}(V)}
$$
has to be the identity, and $a^{-1}(V) = b^{-1}(V)$.
It follows that $a$ and $b$ are equal on underlying topological spaces.
Next, take a section $f \in \mathcal{O}_Y(V)$. This determines and
is determined by a map of sheaves of sets
$f : h_V \to \mathcal{O}_Y$.
Pull this back and apply $t$ to get a commutative diagram
$$
\xymatrix{
h_{b^{-1}(V)} \ar@{=}[r] &
b_{small}^{-1}h_V \ar[d]^{b_{small}^{-1}(f)} & &
a_{small}^{-1}h_V \ar[d]^{a_{small}^{-1}(f)} \ar[ll]^t &
h_{a^{-1}(V)} \ar@{=}[l]
\\
& b_{small}^{-1}\mathcal{O}_Y
\ar[rd]_{b^\sharp}  & &
a_{small}^{-1}\mathcal{O}_Y \ar[ll]^t \ar[ld]^{a^\sharp} \\
& & \mathcal{O}_X
}
$$
where the triangle is commutative by definition of a $2$-isomorphism in
Modules on Sites, Section \ref{sites-modules-section-2-category}.
Above we have seen that the composition of the top horizontal
arrows comes from the identity $a^{-1}(V) = b^{-1}(V)$.
Thus the commutativity of the diagram tells us that
$a_{small}^\sharp(f) = b_{small}^\sharp(f)$ in
$\mathcal{O}_X(a^{-1}(V)) = \mathcal{O}_X(b^{-1}(V))$.
Since this holds for every open $V$ and every $f \in \mathcal{O}_Y(V)$
we conclude that $a = b$ as morphisms of schemes.
\end{proof}

\begin{lemma}
\label{lemma-morphism-ringed-etale-topoi-affines}
Let $X$, $Y$ be affine schemes.
Let
$$
(g, g^\#) :
(\Sh(X_\etale), \mathcal{O}_X)
\longrightarrow
(\Sh(Y_\etale), \mathcal{O}_Y)
$$
be a morphism of locally ringed topoi. Then there exists a
unique morphism of schemes $f : X \to Y$ such that
$(g, g^\#)$ is $2$-isomorphic to $(f_{small}, f_{small}^\sharp)$,
see
Modules on Sites,
Definition \ref{sites-modules-definition-2-morphism-ringed-topoi}.
\end{lemma}

\begin{proof}
In this proof we write $\mathcal{O}_X$ for the structure sheaf
of the small \'etale site $X_\etale$, and similarly for
$\mathcal{O}_Y$. Say $Y = \Spec(B)$ and $X = \Spec(A)$. Since
$B = \Gamma(Y_\etale, \mathcal{O}_Y)$,
$A = \Gamma(X_\etale, \mathcal{O}_X)$
we see that $g^\sharp$ induces a ring map $\varphi : B \to A$.
Let $f = \Spec(\varphi) : X \to Y$ be the corresponding morphism
of affine schemes. We will show this $f$ does the job.

\medskip\noindent
Let $V \to Y$ be an affine scheme \'etale over $Y$. Thus we may write
$V = \Spec(C)$ with $C$ an \'etale $B$-algebra. We can write
$$
C = B[x_1, \ldots, x_n]/(P_1, \ldots, P_n)
$$
with $P_i$ polynomials such that $\Delta = \det(\partial P_i/ \partial x_j)$
is invertible in $C$, see for example
Algebra, Lemma \ref{algebra-lemma-etale-standard-smooth}.
If $T$ is a scheme over $Y$, then a $T$-valued point of $V$ is given by
$n$ sections of $\Gamma(T, \mathcal{O}_T)$ which satisfy the polynomial
equations $P_1 = 0, \ldots, P_n = 0$. In other words, the sheaf $h_V$
on $Y_\etale$ is the equalizer of the two maps
$$
\xymatrix{
\prod\nolimits_{i = 1, \ldots, n} \mathcal{O}_Y
\ar@<1ex>[r]^a \ar@<-1ex>[r]_b &
\prod\nolimits_{j = 1, \ldots, n} \mathcal{O}_Y
}
$$
where $b(h_1, \ldots, h_n) = 0$ and
$a(h_1, \ldots, h_n) =
(P_1(h_1, \ldots, h_n), \ldots, P_n(h_1, \ldots, h_n))$.
Since $g^{-1}$ is exact we conclude that the top row of the
following solid commutative diagram is an equalizer diagram as well:
$$
\xymatrix{
g^{-1}h_V \ar[r] \ar@{..>}[d] &
\prod\nolimits_{i = 1, \ldots, n} g^{-1}\mathcal{O}_Y
\ar@<1ex>[r]^{g^{-1}a} \ar@<-1ex>[r]_{g^{-1}b} \ar[d]^{\prod g^\sharp} &
\prod\nolimits_{j = 1, \ldots, n} g^{-1}\mathcal{O}_Y \ar[d]^{\prod g^\sharp}\\
h_{X \times_Y V} \ar[r] &
\prod\nolimits_{i = 1, \ldots, n} \mathcal{O}_X
\ar@<1ex>[r]^{a'} \ar@<-1ex>[r]_{b'} &
\prod\nolimits_{j = 1, \ldots, n} \mathcal{O}_X  \\
}
$$
Here $b'$ is the zero map and $a'$ is the map defined by the
images $P'_i = \varphi(P_i) \in A[x_1, \ldots, x_n]$ via the same
rule
$a'(h_1, \ldots, h_n) =
(P'_1(h_1, \ldots, h_n), \ldots, P'_n(h_1, \ldots, h_n))$.
that $a$ was defined by. The commutativity of the diagram follows from
the fact that $\varphi = g^\sharp$ on global sections. The lower
row is an equalizer diagram also, by exactly the same arguments as
before since $X \times_Y V$ is the affine scheme
$\Spec(A \otimes_B C)$ and
$A \otimes_B C = A[x_1, \ldots, x_n]/(P'_1, \ldots, P'_n)$.
Thus we obtain a unique dotted arrow
$g^{-1}h_V \to h_{X \times_Y V}$ fitting into the diagram

\medskip\noindent
We claim that the map of sheaves $g^{-1}h_V \to h_{X \times_Y V}$
is an isomorphism. Since the small \'etale site of $X$ has enough points
(Theorem \ref{theorem-exactness-stalks})
it suffices to prove this on stalks. Hence let $\overline{x}$ be a
geometric point of $X$, and denote $p$ the associate point of the
small \'etale topos of $X$. Set $q = g \circ p$. This is a point of
the small \'etale topos of $Y$. By
Lemma \ref{lemma-points-small-etale-site}
we see that $q$ corresponds to a geometric point $\overline{y}$ of
$Y$. Consider the map of stalks
$$
(g^\sharp)_p :
\mathcal{O}_{Y, \overline{y}} =
\mathcal{O}_{Y, q} =
(g^{-1}\mathcal{O}_Y)_p
\longrightarrow
\mathcal{O}_{X, p} =
\mathcal{O}_{X, \overline{x}}
$$
Since $(g, g^\sharp)$ is a morphism of {\it locally} ringed topoi
$(g^\sharp)_p$ is a local ring homomorphism of strictly henselian
local rings. Applying localization to the big commutative diagram above and
Algebra, Lemma \ref{algebra-lemma-strictly-henselian-solutions}
we conclude that $(g^{-1}h_V)_p \to (h_{X \times_Y V})_p$ is an isomorphism
as desired.

\medskip\noindent
We claim that the isomorphisms $g^{-1}h_V \to h_{X \times_Y V}$ are
functorial. Namely, suppose that $V_1 \to V_2$ is a morphism of affine
schemes \'etale over $Y$. Write
$V_i = \Spec(C_i)$ with
$$
C_i = B[x_{i, 1}, \ldots, x_{i, n_i}]/(P_{i, 1}, \ldots, P_{i, n_i})
$$
The morphism $V_1 \to V_2$ is given by a $B$-algebra map $C_2 \to C_1$
which in turn is given by some polynomials
$Q_j \in B[x_{1, 1}, \ldots, x_{1, n_1}]$ for $j = 1, \ldots, n_2$.
Then it is an easy matter to show that the diagram of sheaves
$$
\xymatrix{
h_{V_1} \ar[d] \ar[r] & \prod_{i = 1, \ldots, n_1} \mathcal{O}_Y
\ar[d]^{Q_1, \ldots, Q_{n_2}}\\
h_{V_2} \ar[r] & \prod_{i = 1, \ldots, n_2} \mathcal{O}_Y
}
$$
is commutative, and pulling back to $X_\etale$ we obtain the
solid commutative diagram
$$
\xymatrix{
g^{-1}h_{V_1} \ar@{..>}[dd] \ar[rrd] \ar[r] &
\prod_{i = 1, \ldots, n_1} g^{-1}\mathcal{O}_Y
\ar[dd]^{g^\sharp}
\ar[rrd]^{Q_1, \ldots, Q_{n_2}} \\
& & g^{-1}h_{V_2} \ar@{..>}[dd] \ar[r] &
\prod_{i = 1, \ldots, n_2} g^{-1}\mathcal{O}_Y
\ar[dd]^{g^\sharp} \\
h_{X \times_Y V_1} \ar[r] \ar[rrd] &
\prod\nolimits_{i = 1, \ldots, n_1} \mathcal{O}_X
\ar[rrd]^{Q'_1, \ldots, Q'_{n_2}} \\
& & h_{X \times_Y V_2} \ar[r] &
\prod\nolimits_{i = 1, \ldots, n_2} \mathcal{O}_X
}
$$
where $Q'_j \in A[x_{1, 1}, \ldots, x_{1, n_1}]$ is the image of
$Q_j$ via $\varphi$. Since the dotted arrows exist, make the
two squares commute, and the horizontal arrows are injective
we see that the whole diagram commutes. This proves functoriality
(and also that the construction of $g^{-1}h_V \to h_{X \times_Y V}$
is independent of the choice of the presentation, although we
strictly speaking do not need to show this).

\medskip\noindent
At this point we are able to show that $f_{small, *} \cong g_*$.
Namely, let $\mathcal{F}$ be a sheaf on $X_\etale$. For every
$V \in \Ob(X_\etale)$ affine we have
\begin{align*}
(g_*\mathcal{F})(V)
& =
\Mor_{\Sh(Y_\etale)}(h_V, g_*\mathcal{F}) \\
& =
\Mor_{\Sh(X_\etale)}(g^{-1}h_V, \mathcal{F}) \\
& =
\Mor_{\Sh(X_\etale)}(h_{X \times_Y V}, \mathcal{F}) \\
& =
\mathcal{F}(X \times_Y V) \\
& =
f_{small, *}\mathcal{F}(V)
\end{align*}
where in the third equality we use the isomorphism
$g^{-1}h_V \cong h_{X \times_Y V}$ constructed above. These isomorphisms
are clearly functorial in $\mathcal{F}$ and functorial in $V$
as the isomorphisms $g^{-1}h_V \cong h_{X \times_Y V}$ are functorial.
Now any sheaf on $Y_\etale$ is determined by the restriction
to the subcategory of affine schemes
(Lemma \ref{lemma-alternative}),
and hence we obtain an isomorphism of functors $f_{small, *} \cong g_*$
as desired.

\medskip\noindent
Finally, we have to check that, via the isomorphism
$f_{small, *} \cong g_*$ above, the maps $f_{small}^\sharp$ and
$g^\sharp$ agree. By construction this is already the case for the
global sections of $\mathcal{O}_Y$, i.e., for the elements of $B$.
We only need to check the result on
sections over an affine $V$ \'etale over $Y$ (by
Lemma \ref{lemma-alternative}
again). Writing
$V = \Spec(C)$, $C = B[x_i]/(P_j)$ as before it suffices
to check that the coordinate functions $x_i$ are mapped to
the same sections of $\mathcal{O}_X$ over $X \times_Y V$.
And this is exactly what it means that the diagram
$$
\xymatrix{
g^{-1}h_V \ar[r] \ar@{..>}[d] &
\prod\nolimits_{i = 1, \ldots, n} g^{-1}\mathcal{O}_Y
\ar[d]^{\prod g^\sharp} \\
h_{X \times_Y V} \ar[r] &
\prod\nolimits_{i = 1, \ldots, n} \mathcal{O}_X
}
$$
commutes. Thus the lemma is proved.
\end{proof}

\noindent
Here is a version for general schemes.

\begin{theorem}
\label{theorem-fully-faithful}
Let $X$, $Y$ be schemes. Let
$$
(g, g^\#) :
(\Sh(X_\etale), \mathcal{O}_X)
\longrightarrow
(\Sh(Y_\etale), \mathcal{O}_Y)
$$
be a morphism of locally ringed topoi. Then there exists a
unique morphism of schemes $f : X \to Y$ such that
$(g, g^\#)$ is isomorphic to $(f_{small}, f_{small}^\sharp)$.
In other words, the construction
$$
\Sch \longrightarrow \textit{Locally ringed topoi},
\quad
X \longrightarrow (X_\etale, \mathcal{O}_X)
$$
is fully faithful (morphisms up to $2$-isomorphisms on the right hand side).
\end{theorem}

\begin{proof}
You can prove this theorem by carefuly adjusting the arguments of
the proof of
Lemma \ref{lemma-morphism-ringed-etale-topoi-affines}
to the global setting. However, we want to indicate how we
can glue the result of that lemma to get a global morphism
due to the rigidity provided by the result of
Lemma \ref{lemma-2-morphism}.
Unfortunately, this is a bit messy.

\medskip\noindent
Let us prove existence when $Y$ is affine. In this case choose an
affine open covering $X = \bigcup U_i$. For each $i$ the inclusion
morphism $j_i : U_i \to X$ induces a morphism of locally ringed topoi
$(j_{i, small}, j_{i, small}^\sharp) :
(\Sh(U_{i, \etale}), \mathcal{O}_{U_i})
\to
(\Sh(X_\etale), \mathcal{O}_X)$
by
Lemma \ref{lemma-morphism-locally-ringed}.
We can compose this with $(g, g^\sharp)$ to obtain a morphism
of locally ringed topoi
$$
(g, g^\sharp) \circ (j_{i, small}, j_{i, small}^\sharp) :
(\Sh(U_{i, \etale}), \mathcal{O}_{U_i})
\to
(\Sh(X_\etale), \mathcal{O}_X)
$$
see
Modules on Sites,
Lemma \ref{sites-modules-lemma-composition-morphisms-locally-ringed-topoi}.
By
Lemma \ref{lemma-morphism-ringed-etale-topoi-affines}
there exists a unique morphism of schemes $f_i : U_i \to Y$
and a $2$-isomorphism
$$
t_i :
(f_{i, small}, f_{i, small}^\sharp)
\longrightarrow
(g, g^\sharp) \circ (j_{i, small}, j_{i, small}^\sharp).
$$
Set $U_{i, i'} = U_i \cap U_{i'}$, and denote $j_{i, i'} : U_{i, i'} \to U_i$
the inclusion morphism. Since we have
$j_i \circ j_{i, i'} = j_{i'} \circ j_{i', i}$
we see that
\begin{align*}
(g, g^\sharp) \circ
(j_{i, small}, j_{i, small}^\sharp) \circ
(j_{i, i', small}, j_{i, i', small}^\sharp)
= \\
(g, g^\sharp) \circ
(j_{i', small}, j_{i', small}^\sharp) \circ
(j_{i', i, small}, j_{i', i, small}^\sharp)
\end{align*}
Hence by uniqueness (see
Lemma \ref{lemma-faithful})
we conclude that
$f_i \circ j_{i, i'} = f_{i'} \circ j_{i', i}$, in other words the
morphisms of schemes $f_i = f \circ j_i$ are the restrictions of a
global morphism of schemes $f : X \to Y$. Consider the diagram
of $2$-isomorphisms (where we drop the components ${}^\sharp$ to ease the
notation)
$$
\xymatrix{
g \circ j_{i, small} \circ j_{i, i', small}
\ar[rr]^{t_i \star \text{id}_{j_{i, i', small}}}
\ar@{=}[d] & &
f_{small} \circ j_{i, small} \circ j_{i, i', small} \ar@{=}[d] \\
g \circ j_{i', small} \circ j_{i', i, small}
\ar[rr]^{t_{i'} \star \text{id}_{j_{i', i, small}}} & &
f_{small} \circ j_{i', small} \circ j_{i', i, small}
}
$$
The notation $\star$ indicates horizontal composition, see
Categories, Definition \ref{categories-definition-2-category}
in general and
Sites, Section \ref{sites-section-2-category}
for our particular case. By the result of
Lemma \ref{lemma-2-morphism}
this diagram commutes. Hence for any sheaf $\mathcal{G}$
on $Y_\etale$ the isomorphisms
$t_i : f_{small}^{-1}\mathcal{G}|_{U_i} \to g^{-1}\mathcal{G}|_{U_i}$
agree over $U_{i, i'}$ and we obtain a global isomorphism
$t : f_{small}^{-1}\mathcal{G} \to g^{-1}\mathcal{G}$.
It is clear that this isomorphism is functorial in $\mathcal{G}$
and is compatible with the maps $f_{small}^\sharp$ and $g^\sharp$
(because it is compatible with these maps locally).
This proves the theorem in case $Y$ is affine.

\medskip\noindent
In the general case, let $V \subset Y$ be an affine open.
Then $h_V$ is a subsheaf of the final sheaf $*$ on $Y_\etale$.
As $g$ is exact we see that $g^{-1}h_V$ is a subsheaf of the final
sheaf on $X_\etale$. Hence by
Lemma \ref{lemma-support-subsheaf-final}
there exists an open subscheme $W \subset X$ such that $g^{-1}h_V = h_W$. By
Modules on Sites,
Lemma \ref{sites-modules-lemma-localize-morphism-locally-ringed-topoi}
there exists a commutative diagram of morphisms of locally ringed
topoi
$$
\xymatrix{
(\Sh(W_\etale), \mathcal{O}_W) \ar[r] \ar[d]_{g'} &
(\Sh(X_\etale), \mathcal{O}_X) \ar[d]^g \\
(\Sh(V_\etale), \mathcal{O}_V) \ar[r] &
(\Sh(Y_\etale), \mathcal{O}_Y)
}
$$
where the horizontal arrows are the localization morphisms
(induced by the inclusion morphisms $V \to Y$ and $W \to X$)
and where $g'$ is induced from $g$. By the result of the preceding
paragraph we obtain a morphism of schemes $f' : W \to V$ and
a $2$-isomorphism
$t : (f'_{small}, (f'_{small})^\sharp) \to (g', (g')^\sharp)$.
Exactly as before these morphisms $f'$ (for varying affine opens $V \subset Y$)
agree on overlaps by uniqueness, so we get a morphism $f : X \to Y$.
Moreover, the $2$-isomorphisms $t$ are compatible on overlaps by
Lemma \ref{lemma-2-morphism}
again and we obtain a global $2$-isomorphism
$(f_{small}, (f_{small})^\sharp) \to (g, (g)^\sharp)$.
as desired. Some details omitted.
\end{proof}










\section{Push and pull}
\label{section-monomorphisms}

\noindent
Let $f : X \to Y$ be a morphism of schemes.
Here is a list of conditions we will consider in the following:
\begin{enumerate}
\item[(A)] For every \'etale morphism $U \to X$ and $u \in U$ there exist
an \'etale morphism $V \to Y$ and a disjoint union decomposition
$X \times_Y V = W \amalg W'$ and a morphism $h : W \to U$ over $X$
with $u$ in the image of $h$.
\item[(B)] For every $V \to Y$ \'etale, and every \'etale covering
$\{U_i \to X \times_Y V\}$ there exists an \'etale covering
$\{V_j \to V\}$ such that for each $j$ we have
$X \times_Y V_j = \coprod W_{ji}$ where $W_{ij} \to X \times_Y V$
factors through $U_i \to X \times_Y V$ for some $i$.
\item[(C)] For every $U \to X$ \'etale, there exists a $V \to Y$ \'etale
and a surjective morphism $X \times_Y V \to U$ over $X$.
\end{enumerate}
It turns out that each of these properties has meaning in terms of
the behaviour of the functor $f_{small, *}$. We will work this
out in the next few sections.



\section{Property (A)}
\label{section-A}

\noindent
Please see Section \ref{section-monomorphisms} for the definition of propery
(A).

\begin{lemma}
\label{lemma-property-A-implies}
Let $f : X \to Y$ be a morphism of schemes.
Assume (A).
\begin{enumerate}
\item
$f_{small, *} :
\textit{Ab}(X_\etale)
\to
\textit{Ab}(Y_\etale)$
reflects injections and surjections,
\item $f_{small}^{-1}f_{small, *}\mathcal{F} \to \mathcal{F}$
is surjective for any abelian sheaf $\mathcal{F}$ on $X_\etale$,
\item
$f_{small, *} :
\textit{Ab}(X_\etale)
\to
\textit{Ab}(Y_\etale)$
is faithful.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$.
Let $U$ be an object of $X_\etale$. By assumption we can find a
covering $\{W_i \to U\}$ in $X_\etale$ such that each $W_i$ is
an open and closed subscheme of $X \times_Y V_i$ for some object
$V_i$ of $Y_\etale$. The sheaf condition shows that
$$
\mathcal{F}(U) \subset \prod \mathcal{F}(W_i)
$$
and that $\mathcal{F}(W_i)$ is a direct summand of
$\mathcal{F}(X \times_Y V_i) = f_{small, *}\mathcal{F}(V_i)$.
Hence it is clear that $f_{small, *}$ reflects injections.

\medskip\noindent
Next, suppose that $a : \mathcal{G} \to \mathcal{F}$ is a map of
abelian sheaves such that $f_{small, *}a$ is surjective. Let
$s \in \mathcal{F}(U)$ with $U$ as above. With $W_i$, $V_i$ as
above we see that it suffices to show that $s|_{W_i}$ is \'etale locally
the image of a section of $\mathcal{G}$ under $a$. Since $\mathcal{F}(W_i)$
is a direct summand of $\mathcal{F}(X \times_Y V_i)$
it suffices to show that for any $V \in \Ob(Y_\etale)$
any element $s \in \mathcal{F}(X \times_Y V)$
is \'etale locally on $X \times_Y V$ the image of a section of
$\mathcal{G}$ under $a$. Since
$\mathcal{F}(X \times_Y V) = f_{small, *}\mathcal{F}(V)$
we see by assumption that there exists a covering $\{V_j \to V\}$ such that
$s$ is the image of
$s_j \in f_{small, *}\mathcal{G}(V_j) = \mathcal{G}(X \times_Y V_j)$.
This proves $f_{small, *}$ reflects surjections.

\medskip\noindent
Parts (2), (3) follow formally from part (1), see
Modules on Sites, Lemma \ref{sites-modules-lemma-reflect-surjections}.
\end{proof}

\begin{lemma}
\label{lemma-locally-quasi-finite-A}
Let $f : X \to Y$ be a separated locally quasi-finite morphism of schemes.
Then property (A) above holds.
\end{lemma}

\begin{proof}
Let $U \to X$ be an \'etale morphism and $u \in U$.
The geometric statement (A) reduces directly to the case where $U$ and $Y$
are affine schemes. Denote $x \in X$ and $y \in Y$ the
images of $u$. Since $X \to Y$ is locally quasi-finite, and $U \to X$ is
locally quasi-finite (see
Morphisms, Lemma \ref{morphisms-lemma-etale-locally-quasi-finite})
we see that $U \to Y$ is locally quasi-finite (see
Morphisms, Lemma \ref{morphisms-lemma-composition-quasi-finite}).
Moreover both $X \to Y$ and $U \to Y$ are separated. Thus
More on Morphisms, Lemma
\ref{more-morphisms-lemma-etale-splits-off-quasi-finite-part-technical-variant}
applies to both morphisms. This means we may pick an \'etale neighbourhood
$(V, v) \to (Y, y)$ such that
$$
X \times_Y V = W \amalg R, \quad
U \times_Y V = W' \amalg R'
$$
and points $w \in W$, $w' \in W'$ such that
\begin{enumerate}
\item $W$, $R$ are open and closed in $X \times_Y V$,
\item $W'$, $R'$ are open and closed in $U \times_Y V$,
\item $W \to V$ and $W' \to V$ are finite,
\item $w$, $w'$ map to $v$,
\item $\kappa(v) \subset \kappa(w)$ and $\kappa(v) \subset \kappa(w')$
are purely inseparable, and
\item no other point of $W$ or $W'$ maps to $v$.
\end{enumerate}
Here is a commutative diagram
$$
\xymatrix{
U \ar[d] & U \times_Y V \ar[l] \ar[d] & W' \amalg R' \ar[d] \ar[l] \\
X \ar[d] & X \times_Y V \ar[l] \ar[d] & W \amalg R \ar[l] \\
Y & V \ar[l]
}
$$
After shrinking $V$ we may assume that $W'$ maps into $W$:
just remove the image the inverse image of $R$ in $W'$; this is
a closed set (as $W' \to V$ is finite) not containing $v$.
Then $W' \to W$ is finite because both $W \to V$ and $W' \to V$ are finite.
Hence $W' \to W$ is finite \'etale, and there is exactly one point in the
fibre over $w$ with $\kappa(w) = \kappa(w')$. Hence $W' \to W$ is an
isomorphism in an open neighbourhood $W^\circ$ of $w$, see
\'Etale Morphisms, Lemma \ref{etale-lemma-finite-etale-one-point}.
Since $W \to V$ is finite the image of $W \setminus W^\circ$ is a closed
subset $T$ of $V$ not containing $v$. Thus after replacing $V$ by
$V \setminus T$ we may assume that $W' \to W$ is an isomorphism.
Now the decomposition $X \times_Y V = W \amalg R$ and the morphism
$W \to U$ are as desired and we win.
\end{proof}

\begin{lemma}
\label{lemma-integral-A}
Let $f : X \to Y$ be an integral morphism of schemes.
Then property (A) holds.
\end{lemma}

\begin{proof}
Let $U \to X$ be \'etale, and let $u \in U$ be a point.
We have to find $V \to Y$ \'etale, a disjoint union decomposition
$X \times_Y V = W \amalg W'$ and an $X$-morphism $W \to U$
with $u$ in the image. We may shrink $U$ and $Y$ and assume
$U$ and $Y$ are affine. In this case also $X$ is affine, since
an integral morphism is affine by definition. Write $Y = \Spec(A)$,
$X = \Spec(B)$ and $U = \Spec(C)$. Then $A \to B$ is an
integral ring map, and $B \to C$ is an \'etale ring map. By
Algebra, Lemma \ref{algebra-lemma-etale}
we can find a finite $A$-subalgebra $B' \subset B$ and an \'etale ring
map $B' \to C'$ such that $C = B \otimes_{B'} C'$. Thus the question
reduces to the \'etale morphism
$U' = \Spec(C') \to X' = \Spec(B')$
over the finite morphism $X' \to Y$. In this case the result follows from
Lemma \ref{lemma-locally-quasi-finite-A}.
\end{proof}

\begin{lemma}
\label{lemma-when-push-pull-surjective}
Let $f : X \to Y$ be a morphism of schemes. Denote
$f_{small} :
\Sh(X_\etale)
\to
\Sh(Y_\etale)$
the associated morphism of small \'etale topoi. Assume at least one
of the following
\begin{enumerate}
\item $f$ is integral, or
\item $f$ is separated and locally quasi-finite.
\end{enumerate}
Then the functor
$f_{small, *} :
\textit{Ab}(X_\etale)
\to
\textit{Ab}(Y_\etale)$
has the following properties
\begin{enumerate}
\item the map
$f_{small}^{-1}f_{small, *}\mathcal{F} \to \mathcal{F}$
is always surjective,
\item $f_{small, *}$ is faithful, and
\item $f_{small, *}$ reflects injections and surjections.
\end{enumerate}
\end{lemma}

\begin{proof}
Combine
Lemmas \ref{lemma-locally-quasi-finite-A},
\ref{lemma-integral-A}, and
\ref{lemma-property-A-implies}.
\end{proof}



\section{Property (B)}
\label{section-B}

\noindent
Please see Section \ref{section-monomorphisms} for the definition of propery
(B).

\begin{lemma}
\label{lemma-property-B-implies}
Let $f : X \to Y$ be a morphism of schemes. Assume (B) holds.
Then the functor
$f_{small, *} :
\Sh(X_\etale)
\to
\Sh(Y_\etale)$
transforms surjections into surjections.
\end{lemma}

\begin{proof}
This follows from
Sites, Lemma \ref{sites-lemma-weaker}.
\end{proof}

\begin{lemma}
\label{lemma-simplify-B}
Let $f : X \to Y$ be a morphism of schemes. Suppose
\begin{enumerate}
\item $V \to Y$ is an \'etale morphism of schemes,
\item $\{U_i \to X \times_Y V\}$ is an \'etale covering, and
\item $v \in V$ is a point.
\end{enumerate}
Assume that for any such data there exists an \'etale neighbourhood
$(V', v') \to (V, v)$, a disjoint union decomposition
$X \times_Y V' = \coprod W'_i$, and morphisms $W'_i \to U_i$
over $X \times_Y V$. Then property (B) holds.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-finite-B}
Let $f : X \to Y$ be a finite morphism of schemes.
Then property (B) holds.
\end{lemma}

\begin{proof}
Consider $V \to Y$ \'etale, $\{U_i \to X \times_Y V\}$ an \'etale covering, and
$v \in V$. We have to find a $V' \to V$ and decomposition and maps as in
Lemma \ref{lemma-simplify-B}.
We may shrink $V$ and $Y$, hence we may assume that $V$ and $Y$ are affine.
Since $X$ is finite over $Y$, this also implies that $X$ is affine.
During the proof we may (finitely often) replace $(V, v)$ by an
\'etale neighbourhood $(V', v')$ and correspondingly the covering
$\{U_i \to X \times_Y V\}$ by $\{V' \times_V U_i \to X \times_Y V'\}$.

\medskip\noindent
Since $X \times_Y V \to V$ is finite there exist finitely
many (pairwise distinct) points $x_1, \ldots, x_n \in X \times_Y V$
mapping to $v$. We may apply
More on Morphisms, Lemma
\ref{more-morphisms-lemma-etale-splits-off-quasi-finite-part-technical-variant}
to $X \times_Y V \to V$ and the points $x_1, \ldots, x_n$ lying over
$v$ and find an \'etale neighbourhood $(V', v') \to (V, v)$
such that
$$
X \times_Y V' = R \amalg \coprod T_a
$$
with $T_a \to V'$ finite with exactly one point $p_a$ lying over $v'$
and moreover $\kappa(v') \subset \kappa(p_a)$ purely inseparable, and
such that $R \to V'$ has empty fibre over $v'$.
Because $X \to Y$ is finite, also $R \to V'$ is finite. Hence after
shrinking $V'$ we may assume that $R = \emptyset$. Thus we may
assume that $X \times_Y V = X_1 \amalg \ldots \amalg X_n$ with
exactly one point $x_l \in X_l$ lying over $v$ with moreover
$\kappa(v) \subset \kappa(x_l)$ purely inseparable. Note that this
property is preserved under refinement of the \'etale neighbourhood
$(V, v)$.

\medskip\noindent
For each $l$ choose an $i_l$ and a point $u_l \in U_{i_l}$ mapping to $x_l$.
Now we apply property (A) for the finite morphism
$X \times_Y V \to V$ and the \'etale
morphisms $U_{i_l} \to X \times_Y V$ and the points $u_l$.
This is permissible by
Lemma \ref{lemma-integral-A}
This gives produces an \'etale neighbourhood $(V', v') \to (V, v)$
and decompositions
$$
X \times_Y V' = W_l \amalg R_l
$$
and $X$-morphisms $a_l : W_l \to U_{i_l}$ whose image contains $u_{i_l}$.
Here is a picture:
$$
\xymatrix{
& & & U_{i_l} \ar[d] & \\
W_l \ar[rrru] \ar[r] & W_l \amalg R_l \ar@{=}[r] &
X \times_Y V' \ar[r] \ar[d] &
X \times_Y V \ar[r] \ar[d] & X \ar[d] \\
& & V' \ar[r] & V \ar[r] & Y
}
$$
After replacing $(V, v)$ by $(V', v')$ we conclude that each
$x_l$ is contained in an open and closed neighbourhood $W_l$ such that
the inclusion morphism $W_l \to X \times_Y V$ factors through
$U_i \to X \times_Y V$ for some $i$. Replacing $W_l$ by $W_l \cap X_l$
we see that these open and closed sets are disjoint and moreover
that $\{x_1, \ldots, x_n\} \subset W_1 \cup \ldots \cup W_n$.
Since $X \times_Y V \to V$ is finite we may shrink $V$ and assume that
$X \times_Y V = W_1 \amalg \ldots \amalg W_n$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-integral-B}
Let $f : X \to Y$ be an integral morphism of schemes.
Then property (B) holds.
\end{lemma}

\begin{proof}
Consider $V \to Y$ \'etale, $\{U_i \to X \times_Y V\}$ an \'etale covering, and
$v \in V$. We have to find a $V' \to V$ and decomposition and maps as in
Lemma \ref{lemma-simplify-B}.
We may shrink $V$ and $Y$, hence we may assume that $V$ and $Y$ are affine.
Since $X$ is integral over $Y$, this also implies that $X$ and
$X \times_Y V$ are affine. We may refine the covering
$\{U_i \to X \times_Y V\}$, and hence we may assume that
$\{U_i \to X \times_Y V\}_{i = 1, \ldots, n}$ is a standard \'etale covering.
Write $Y = \Spec(A)$, $X = \Spec(B)$,
$V = \Spec(C)$, and $U_i = \Spec(B_i)$.
Then $A \to B$ is an integral ring map, and $B \otimes_A C \to B_i$ are
\'etale ring maps. By
Algebra, Lemma \ref{algebra-lemma-etale}
we can find a finite $A$-subalgebra $B' \subset B$ and an \'etale ring
map $B' \otimes_A C \to B'_i$ for $i = 1, \ldots, n$
such that $B_i = B \otimes_{B'} B'_i$. Thus the question
reduces to the \'etale covering
$\{\Spec(B'_i) \to X' \times_Y V\}_{i = 1, \ldots, n}$
with $X' = \Spec(B')$ finite over $Y$.
In this case the result follows from
Lemma \ref{lemma-finite-B}.
\end{proof}

\begin{lemma}
\label{lemma-what-integral}
Let $f : X \to Y$ be a morphism of schemes.
Assume $f$ is integral (for example finite).
Then
\begin{enumerate}
\item $f_{small, *}$ transforms surjections into surjections (on sheaves
of sets and on abelian sheaves),
\item $f_{small}^{-1}f_{small, *}\mathcal{F} \to \mathcal{F}$
is surjective for any abelian sheaf $\mathcal{F}$ on $X_\etale$,
\item
$f_{small, *} :
\textit{Ab}(X_\etale)
\to
\textit{Ab}(Y_\etale)$
is faithful and reflects injections and surjections, and
\item
$f_{small, *} :
\textit{Ab}(X_\etale)
\to
\textit{Ab}(Y_\etale)$
is exact.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (2), (3) we have seen in
Lemma \ref{lemma-when-push-pull-surjective}.
Part (1) follows from
Lemmas \ref{lemma-integral-B} and \ref{lemma-property-B-implies}.
Part (4) is a consequence of part (1), see
Modules on Sites, Lemma \ref{sites-modules-lemma-exactness}.
\end{proof}








\section{Property (C)}
\label{section-C}

\noindent
Please see Section \ref{section-monomorphisms} for the definition of propery
(C).

\begin{lemma}
\label{lemma-property-C-implies}
Let $f : X \to Y$ be a morphism of schemes. Assume (C) holds. Then the functor
$f_{small, *} :
\Sh(X_\etale)
\to
\Sh(Y_\etale)$
reflects injections and surjections.
\end{lemma}

\begin{proof}
Follows from
Sites, Lemma \ref{sites-lemma-cover-from-below}.
We omit the verification that property (C) implies that the functor
$Y_\etale \to X_\etale$, $V \mapsto X \times_Y V$
satisfies the assumption of
Sites, Lemma \ref{sites-lemma-cover-from-below}.
\end{proof}

\begin{remark}
\label{remark-property-C-strong}
Property (C) holds if $f : X \to Y$ is an open immersion. Namely, if
$U \in \Ob(X_\etale)$, then we can view $U$ also as an object
of $Y_\etale$ and $U \times_Y X = U$. Hence property (C)
does not imply that $f_{small, *}$ is exact as this is not
the case for open immersions (in general).
\end{remark}

\begin{lemma}
\label{lemma-property-C-closed-implies}
Let $f : X \to Y$ be a morphism of schemes. Assume that
for any $V \to Y$ \'etale we have that
\begin{enumerate}
\item $X \times_Y V \to V$ has property (C), and
\item $X \times_Y V \to V$ is closed.
\end{enumerate}
Then the functor
$Y_\etale \to X_\etale$, $V \mapsto X \times_Y V$
is almost cocontinuous, see
Sites, Definition \ref{sites-definition-almost-cocontinuous}.
\end{lemma}

\begin{proof}
Let $V \to Y$ be an object of $Y_\etale$ and let
$\{U_i \to X \times_Y V\}_{i \in I}$ be a covering of $X_\etale$.
By assumption (1) for each $i$ we can find an \'etale morphism
$h_i : V_i \to V$ and a surjective morphism $X \times_Y V_i \to U_i$
over $X \times_Y V$. Note that $\bigcup h_i(V_i) \subset V$ is an
open set containing the closed set $Z = \Im(X \times_Y V \to V)$.
Let $h_0 : V_0 = V \setminus Z \to V$ be the open immersion.
It is clear that $\{V_i \to V\}_{i \in I \cup \{0\}}$ is an
\'etale covering such that for each $i \in I \cup \{0\}$ we have
either $V_i \times_Y X = \emptyset$ (namely if $i = 0$), or
$V_i \times_Y X \to V \times_Y X$ factors through $U_i \to X \times_Y V$
(if $i \not = 0$). Hence the functor $Y_\etale \to X_\etale$
is almost cocontinuous.
\end{proof}

\begin{lemma}
\label{lemma-integral-homeo-onto-image-C}
Let $f : X \to Y$ be an integral morphism of schemes which defines
a homeomorphism of $X$ with a closed subset of $Y$.
Then property (C) holds.
\end{lemma}

\begin{proof}
Let $g : U \to X$ be an \'etale morphism. We need to find an object
$V \to Y$ of $Y_\etale$ and a surjective morphism $X \times_Y V \to U$
over $X$. Suppose that for every $u \in U$ we can find an object
$V_u \to Y$ of $Y_\etale$ and a morphism $h_u : X \times_Y V_u \to U$
over $X$ with $u \in \Im(h_u)$. Then we can take $V = \coprod V_u$
and $h = \coprod h_u$ and we win. Hence given a point
$u \in U$ we find a pair $(V_u, h_u)$ as above. To do this we may
shrink $U$ and assume that $U$ is affine. In this case
$g : U \to X$ is locally quasi-finite. Let
$g^{-1}(g(\{u\})) = \{u, u_2, \ldots, u_n\}$. Since there are no
specializations $u_i \leadsto u$ we may replace $U$ by an affine neighbourhood
so that $g^{-1}(g(\{u\})) = \{u\}$.

\medskip\noindent
The image $g(U) \subset X$ is open,
hence $f(g(U))$ is locally closed in $Y$. Choose an open $V \subset Y$ such
that $f(g(U)) = f(X) \cap V$. It follows that $g$ factors through
$X \times_Y V$ and that the resulting $\{U \to X \times_Y V\}$ is an \'etale
covering. Since $f$ has property (B) , see
Lemma \ref{lemma-integral-B},
we see that there exists an \'etale covering $\{V_j \to V\}$ such that
$X \times_Y V_j \to X \times_Y V$ factor through $U$.
This implies that $V' = \coprod V_j$ is \'etale over $Y$ and that there is a
morphism $h : X \times_Y V' \to U$ whose image
surjects onto $g(U)$. Since $u$ is the only point in its fibre it must
be in the image of $h$ and we win.
\end{proof}

\noindent
We urge the reader to think of the following lemma as a
way station\footnote{A way station is a place where people stop to eat
and rest when they are on a long journey.} on the journey towards the
ultimate truth regarding $f_{small, *}$ for integral universally injective
morphisms.

\begin{lemma}
\label{lemma-integral-universally-injective}
Let $f : X \to Y$ be a morphism of schemes. Assume that $f$ is
universally injective and integral (for example a closed immersion).
Then
\begin{enumerate}
\item
$f_{small, *} :
\Sh(X_\etale)
\to
\Sh(Y_\etale)$
reflects injections and surjections,
\item
$f_{small, *} :
\Sh(X_\etale)
\to
\Sh(Y_\etale)$
commutes with pushouts and coequalizers (and more generally
finite connected colimits),
\item $f_{small, *}$ transforms surjections into surjections (on sheaves
of sets and on abelian sheaves),
\item the map
$f_{small}^{-1}f_{small, *}\mathcal{F} \to \mathcal{F}$
is surjective for any sheaf (of sets or of abelian groups)
$\mathcal{F}$ on $X_\etale$,
\item the functor $f_{small, *}$ is faithful (on sheaves of sets and
on abelian sheaves),
\item
$f_{small, *} :
\textit{Ab}(X_\etale)
\to
\textit{Ab}(Y_\etale)$
is exact, and
\item the functor
$Y_\etale \to X_\etale$, $V \mapsto X \times_Y V$ is
almost cocontinuous.
\end{enumerate}
\end{lemma}

\begin{proof}
By
Lemmas \ref{lemma-integral-A},
\ref{lemma-integral-B} and
\ref{lemma-integral-homeo-onto-image-C}
we know that the morphism $f$ has properties (A), (B), and (C).
Moreover, by
Lemma \ref{lemma-property-C-closed-implies}
we know that the functor $Y_\etale \to X_\etale$ is
almost cocontinuous. Now we have
\begin{enumerate}
\item property (C) implies (1) by
Lemma \ref{lemma-property-C-implies},
\item almost continuous implies (2) by
Sites, Lemma \ref{sites-lemma-morphism-of-sites-almost-cocontinuous},
\item property (B) implies (3) by
Lemma \ref{lemma-property-B-implies}.
\end{enumerate}
Properties (4), (5), and (6) follow formally from the first three, see
Sites, Lemma \ref{sites-lemma-exactness-properties}
and
Modules on Sites, Lemma \ref{sites-modules-lemma-exactness}.
Property (7) we saw above.
\end{proof}




\section{Topological invariance of the small \'etale site}
\label{section-topological-invariance}

\noindent
In the following theorem we show that the small \'etale site is a topological
invariant in the following sense: If $f : X \to Y$ is a morphism of schemes
which is a universal homeomorphism, then
$X_\etale \cong Y_\etale$
as sites. This improves the result of
\'Etale Morphisms, Theorem \ref{etale-theorem-remarkable-equivalence}.

\begin{theorem}
\label{theorem-topological-invariance}
Let $f : X \to Y$ be a morphism of schemes.
Assume $f$ is integral, universally injective and surjective
(i.e., $f$ is a universal homeomorphism, see
Morphisms, Lemma \ref{morphisms-lemma-universal-homeomorphism}).
The functor
$$
V \longmapsto V_X = X \times_Y V
$$
defines an equivalence of categories
$$
\{
\text{schemes }V\text{ \'etale over }Y
\}
\leftrightarrow
\{
\text{schemes }U\text{ \'etale over }X
\}
$$
\end{theorem}

\begin{proof}
We claim that it suffices to prove that the functor defines
an equivalence
\begin{equation}
\label{equation-affine-etale}
\{
\text{affine schemes }V\text{ \'etale over }Y
\}
\leftrightarrow
\{
\text{affine schemes }U\text{ \'etale over }X
\}
\end{equation}
when $X$ and $Y$ are affine. We omit the proof of this claim.

\medskip\noindent
Assume $X$ and $Y$ affine.
Let us prove (\ref{equation-affine-etale}) is fully faithful. Suppose that
$V, V'$ are affine schemes \'etale over $Y$, and that $\varphi : V_X \to V'_X$
is a morphism over $X$. To prove that $\varphi = \psi_X$ for some
$\psi : V \to V'$ over $Y$ we may work locally on $V$. The graph
$$
\Gamma_\varphi \subset (V \times_Y V')_X
$$
of $\varphi$ is an open and closed subscheme, see
\'Etale Morphisms, Proposition \ref{etale-proposition-properties-sections}.
Since $f$ is a universal homeomorphism we see that there exists an
open and closed subscheme $\Gamma \subset V \times_Y V'$ with
$\Gamma_X = \Gamma_\varphi$. We see that $\Gamma$ is an affine scheme
endowed with an \'etale, universally injective, and surjective morphism
$\Gamma \to V$. This implies that $\Gamma \to V$ is an isomorphism (see
\'Etale Morphisms, Theorem \ref{etale-theorem-etale-radicial-open}),
and hence $\Gamma$ is the graph of a morphism $\psi : V \to V'$ over $Y$
as desired.

\medskip\noindent
Let us prove (\ref{equation-affine-etale}) is essentially surjective.
Let $U \to X$ be an affine scheme \'etale over $X$.
We have to find $V \to Y$ \'etale (and affine) such that $X \times_Y V$
is isomorphic to $U$ over $X$. Note that an \'etale morphism of affines
has universally bounded fibres, see
Morphisms,
Lemmas \ref{morphisms-lemma-etale-locally-quasi-finite} and
\ref{morphisms-lemma-locally-quasi-finite-qc-source-universally-bounded}.
Hence we can do induction on the integer $n$ bounding the degree of the fibres
of $U \to X$. See
Morphisms, Lemma \ref{morphisms-lemma-etale-universally-bounded}
for a description of this integer in the case of an \'etale morphism.
If $n = 1$, then $U \to X$ is an open immersion (see
\'Etale Morphisms, Theorem \ref{etale-theorem-etale-radicial-open}),
and the result is clear. Assume $n > 1$.

\medskip\noindent
By
Lemma \ref{lemma-integral-homeo-onto-image-C}
there exists an \'etale morphism of schemes $W \to Y$ and a
surjective morphism $W_X \to U$ over $X$.
As $U$ is quasi-compact we may replace $W$ by a disjoint union of
finitely many affine opens of $W$, hence we may assume that $W$
is affine as well. Here is a diagram
$$
\xymatrix{
U \ar[d] & U \times_Y W \ar[l] \ar[d] & W_X \amalg R \ar@{=}[l]\\
X \ar[d] & W_X \ar[l] \ar[d] \\
Y & W \ar[l]
}
$$
The disjoint union decomposition arises because by construction the
\'etale morphism of affine schemes $U \times_Y W \to W_X$ has a section.
OK, and now we see that the morphism $R \to X \times_Y W$ is an \'etale
morphism of affine schemes whose fibres have degree universally bounded
by $n - 1$. Hence by induction assumption there exists a scheme
$V' \to W$ \'etale such that $R \cong W_X \times_W V'$.
Taking $V'' = W \amalg V'$ we find a scheme $V''$ \'etale over $W$ whose
base change to $W_X$ is isomorphic to $U \times_Y W$
over $X \times_Y W$.

\medskip\noindent
At this point we can use descent to find $V$ over $Y$ whose base
change to $X$ is isomorphic to $U$ over $X$. Namely, by the fully
faithfulness of the functor (\ref{equation-affine-etale})
corresponding to the universal homeomorphism
$X \times_Y (W \times_Y W) \to (W \times_Y W)$
there exists a unique isomorphism $\varphi : V'' \times_Y W \to W \times_Y V''$
whose base change to $X \times_Y (W \times_Y W)$ is the canonical
descent datum for $U \times_Y W$ over $X \times_Y W$. In particular
$\varphi$ satisfies the cocycle condition. Hence by
Descent, Lemma \ref{descent-lemma-affine}
we see that $\varphi$ is effective (recall that all schemes above are affine).
Thus we obtain $V \to Y$ and an isomorphism $V'' \cong W \times_Y V$
such that the canonical descent datum on $W \times_Y V/W/Y$ agrees
with $\varphi$. Note that $V \to Y$ is \'etale, by
Descent, Lemma \ref{descent-lemma-descending-property-etale}.
Moreover, there is an isomorphism $V_X \cong U$ which comes from
descending the isomorphism
$$
V_X \times_X W_X =
X \times_Y V \times_Y W =
(X \times_Y W) \times_W (W \times_Y V) \cong
W_X  \times_W V'' \cong U \times_Y W
$$
which we have by construction. Some details omitted.
\end{proof}

\begin{remark}
\label{remark-affine-inside-equivalence}
In the situation of
Theorem \ref{theorem-topological-invariance}
it is also true that $V \mapsto V_X$ induces an equivalence
between those \'etale morphisms $V \to Y$ with $V$ affine and
those \'etale morphisms $U \to X$ with $U$ affine.
This follows for example from
Limits, Proposition \ref{limits-proposition-affine}.
\end{remark}

\begin{proposition}[Topological invariance of \'etale cohomology]
\label{proposition-topological-invariance}
Let $X_0 \to X$ be a universal homeomorphism of schemes
(for example the closed immersion defined by a nilpotent sheaf of ideals).
Then
\begin{enumerate}
\item the \'etale sites $X_\etale$ and $(X_0)_\etale$ are isomorphic,
\item the \'etale topoi $\Sh(X_\etale)$ and $\Sh((X_0)_\etale)$
are equivalent, and
\item $H^q_\etale(X, \mathcal{F}) = H^q_\etale(X_0, \mathcal{F}|_{X_0})$
for all $q$ and
for any abelian sheaf $\mathcal{F}$ on $X_\etale$.
\end{enumerate}
\end{proposition}

\begin{proof}
The equivalence of categories $X_\etale \to (X_0)_\etale$ is
given by Theorem \ref{theorem-topological-invariance}. We omit
the proof that under this equivalence the \'etale coverings correspond.
Hence (1) holds. Parts (2) and (3) follow formally from (1).
\end{proof}






\section{Closed immersions and pushforward}
\label{section-closed-immersions}

\noindent
Before stating and proving
Proposition \ref{proposition-closed-immersion-pushforward}
in its correct generality we briefly state and prove it for
closed immersions. Namely, some of the preceding arguments
are quite a bit easier to follow in the case of a closed immersion and
so we repeat them here in their simplified form.

\medskip\noindent
In the rest of this section $i : Z \to X$ is a closed immersion.
The functor
$$
\Sch/X \longrightarrow \Sch/Z, \quad
U \longmapsto U_Z = Z \times_X U
$$
will be denoted $U \mapsto U_Z$ as indicated. Since being a closed immersion
is preserved under arbitrary base change the scheme $U_Z$ is a closed subscheme
of $U$.

\begin{lemma}
\label{lemma-closed-immersion-almost-full}
Let $i : Z \to X$ be a closed immersion of schemes.
Let $U, U'$ be schemes \'etale over $X$. Let $h : U_Z \to U'_Z$
be a morphism over $Z$. Then there exists a diagram
$$
\xymatrix{
U & W \ar[l]_a \ar[r]^b & U'
}
$$
such that $a_Z : W_Z \to U_Z$ is an isomorphism and $h = b_Z \circ (a_Z)^{-1}$.
\end{lemma}

\begin{proof}
Consider the scheme $M = U \times_Y U'$. The graph $\Gamma_h \subset M_Z$
of $h$ is open. This is true for example as $\Gamma_h$ is the image of a
section of the \'etale morphism $\text{pr}_{1, Z} : M_Z \to U_Z$, see
\'Etale Morphisms, Proposition \ref{etale-proposition-properties-sections}.
Hence there exists an open subscheme $W \subset M$ whose intersection with
the closed subset $M_Z$ is $\Gamma_h$. Set $a = \text{pr}_1|_W$
and $b = \text{pr}_2|_W$.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-almost-essentially-surjective}
Let $i : Z \to X$ be a closed immersion of schemes.
Let $V \to Z$ be an \'etale morphism of schemes.
There exist \'etale morphisms $U_i \to X$ and morphisms
$U_{i, Z} \to V$ such that $\{U_{i, Z} \to V\}$
is a Zariski covering of $V$.
\end{lemma}

\begin{proof}
Since we only have to find a Zariski covering of $V$ consisting of schemes
of the form $U_Z$ with $U$ \'etale over $X$, we may Zariski localize on $X$
and $V$. Hence we may assume $X$ and $V$ affine. In the affine case this is
Algebra, Lemma \ref{algebra-lemma-lift-etale}.
\end{proof}

\noindent
If $\overline{x} : \Spec(k) \to X$ is a geometric point of $X$, then
either $\overline{x}$ factors (uniquely) through the closed subscheme $Z$, or
$Z_{\overline{x}} = \emptyset$. If $\overline{x}$ factors through $Z$
we say that $\overline{x}$ is a geometric point of $Z$ (because it is) and
we use the notation ``$\overline{x} \in Z$'' to indicate this.

\begin{lemma}
\label{lemma-stalk-pushforward-closed-immersion}
Let $i : Z \to X$ be a closed immersion of schemes.
Let $\mathcal{G}$ be a sheaf of sets on $Z_\etale$.
Let $\overline{x}$ be a geometric point of $X$.
Then
$$
(i_{small, *}\mathcal{G})_{\overline{x}} =
\left\{
\begin{matrix}
* & \text{if} & \overline{x} \not \in Z \\
\mathcal{F}_{\overline{x}} & \text{if} & \overline{x} \in Z
\end{matrix}
\right.
$$
where $*$ denotes a singleton set.
\end{lemma}

\begin{proof}
Note that $i_{small, *}\mathcal{G}|_{U_\etale} = *$ is the final
object in the category of \'etale sheaves on $U$, i.e., the sheaf
which associates a singleton set to each scheme \'etale over $U$.
This explains the value of $(i_{small, *}\mathcal{G})_{\overline{x}}$
if $\overline{x} \not \in Z$.

\medskip\noindent
Next, suppose that $\overline{x} \in Z$. Note that
$$
(i_{small, *}\mathcal{G})_{\overline{x}}
=
\colim_{(U, \overline{u})} \mathcal{G}(U_Z)
$$
and on the other hand
$$
\mathcal{G}_{\overline{x}}
=
\colim_{(V, \overline{v})} \mathcal{G}(V).
$$
Let $\mathcal{C}_1 = \{(U, \overline{u})\}^{opp}$ be the opposite of the
category of \'etale neighbourhoods of $\overline{x}$ in $X$, and let
$\mathcal{C}_2 = \{(V, \overline{v})\}^{opp}$ be the opposite of the
category of \'etale neighbourhoods of $\overline{x}$ in $Z$. The canonical map
$$
\mathcal{G}_{\overline{x}}
\longrightarrow
(i_{small, *}\mathcal{G})_{\overline{x}}
$$
corresponds to the functor $F : \mathcal{C}_1 \to \mathcal{C}_2$,
$F(U, \overline{u}) = (U_Z, \overline{x})$. Now
Lemmas \ref{lemma-closed-immersion-almost-essentially-surjective} and
\ref{lemma-closed-immersion-almost-full}
imply that $\mathcal{C}_1$ is cofinal in $\mathcal{C}_2$, see
Categories, Definition \ref{categories-definition-cofinal}.
Hence it follows that the displayed arrow is an isomorphism, see
Categories, Lemma \ref{categories-lemma-cofinal}.
\end{proof}

\begin{proposition}
\label{proposition-closed-immersion-pushforward}
Let $i : Z \to X$ be a closed immersion of schemes.
\begin{enumerate}
\item The functor
$$
i_{small, *} :
\Sh(Z_\etale)
\longrightarrow
\Sh(X_\etale)
$$
is fully faithful and its essential image is those sheaves of sets
$\mathcal{F}$ on $X_\etale$ whose restriction to $X \setminus Z$ is
isomorphic to $*$, and
\item the functor
$$
i_{small, *} :
\textit{Ab}(Z_\etale)
\longrightarrow
\textit{Ab}(X_\etale)
$$
is fully faithful and its essential image is those abelian sheaves on
$X_\etale$ whose support is contained in $Z$.
\end{enumerate}
In both cases $i_{small}^{-1}$ is a left inverse to the functor
$i_{small, *}$.
\end{proposition}

\begin{proof}
Let's discuss the case of sheaves of sets.
For any sheaf $\mathcal{G}$ on $Z$ the morphism
$i_{small}^{-1}i_{small, *}\mathcal{G} \to \mathcal{G}$
is an isomorphism by
Lemma \ref{lemma-stalk-pushforward-closed-immersion}
(and
Theorem \ref{theorem-exactness-stalks}).
This implies formally that $i_{small, *}$ is fully faithful, see
Sites, Lemma \ref{sites-lemma-exactness-properties}.
It is clear that $i_{small, *}\mathcal{G}|_{U_\etale} \cong *$
where $U = X \setminus Z$. Conversely, suppose that $\mathcal{F}$
is a sheaf of sets on $X$ such that $\mathcal{F}|_{U_\etale} \cong *$.
Consider the adjunction mapping
$$
\mathcal{F} \longrightarrow i_{small, *}i_{small}^{-1}\mathcal{F}
$$
Combining
Lemmas \ref{lemma-stalk-pushforward-closed-immersion} and
\ref{lemma-stalk-pullback}
we see that it is an isomorphism. This finishes the proof of (1).
The proof of (2) is identical.
\end{proof}





\section{Integral universally injective morphisms}
\label{section-integral-universally-injective}

\noindent
Here is the general version of
Proposition \ref{proposition-closed-immersion-pushforward}.

\begin{proposition}
\label{proposition-integral-universally-injective-pushforward}
Let $f : X \to Y$ be a morphism of schemes which is integral
and universally injective.
\begin{enumerate}
\item The functor
$$
f_{small, *} :
\Sh(X_\etale)
\longrightarrow
\Sh(Y_\etale)
$$
is fully faithful and its essential image is those sheaves of sets
$\mathcal{F}$ on $Y_\etale$ whose restriction to $Y \setminus f(X)$ is
isomorphic to $*$, and
\item the functor
$$
f_{small, *} :
\textit{Ab}(X_\etale)
\longrightarrow
\textit{Ab}(Y_\etale)
$$
is fully faithful and its essential image is those abelian sheaves on
$Y_\etale$ whose support is contained in $f(X)$.
\end{enumerate}
In both cases $f_{small}^{-1}$ is a left inverse to the functor
$f_{small, *}$.
\end{proposition}

\begin{proof}
We may factor $f$ as
$$
\xymatrix{
X \ar[r]^h & Z \ar[r]^i & Y
}
$$
where $h$ is integral, universally injective and surjective
and $i : Z \to Y$ is a closed immersion.
Apply
Proposition \ref{proposition-closed-immersion-pushforward}
to $i$ and apply
Theorem \ref{theorem-topological-invariance}
to $h$.
\end{proof}









\section{Big sites and pushforward}
\label{section-big}

\noindent
In this section we prove some technical results on $f_{big, *}$ for
certain types of morphisms of schemes.

\begin{lemma}
\label{lemma-monomorphism-big-push-pull}
Let $\tau \in \{Zariski, \etale, smooth, syntomic, fppf\}$.
Let $f : X \to Y$ be a monomorphism of schemes.
Then the canonical map
$f_{big}^{-1}f_{big, *}\mathcal{F} \to \mathcal{F}$
is an isomorphism for any sheaf $\mathcal{F}$ on
$(\Sch/X)_\tau$.
\end{lemma}

\begin{proof}
In this case the functor $(\Sch/X)_\tau \to (\Sch/Y)_\tau$
is continuous, cocontinuous and fully faithful. Hence the result follows from
Sites, Lemma \ref{sites-lemma-back-and-forth}.
\end{proof}

\begin{remark}
\label{remark-push-pull-shriek}
In the situation of
Lemma \ref{lemma-monomorphism-big-push-pull}
it is true that the canonical map
$\mathcal{F} \to f_{big}^{-1}f_{big!}\mathcal{F}$
is an isomorphism for any sheaf of sets $\mathcal{F}$ on
$(\Sch/X)_\tau$. The proof is the same. This also
holds for sheaves of abelian groups. However, note
that the functor $f_{big!}$ for sheaves of abelian groups is defined in
Modules on Sites, Section \ref{sites-modules-section-exactness-lower-shriek}
and is in general different from $f_{big!}$ on sheaves of sets.
The result for sheaves of abelian groups follows from
Modules on Sites, Lemma \ref{sites-modules-lemma-back-and-forth}.
\end{remark}

\begin{lemma}
\label{lemma-closed-immersion-cover-from-below}
Let $f : X \to Y$ be a closed immersion of schemes.
Let $U \to X$ be a syntomic (resp.\ smooth, resp.\ \'etale) morphism.
Then there exist syntomic (resp.\ smooth, resp.\ \'etale) morphisms
$V_i \to Y$ and morphisms $V_i \times_Y X \to U$ such that
$\{V_i \times_Y X \to U\}$ is a Zariski covering of $U$.
\end{lemma}

\begin{proof}
Let us prove the lemma when $\tau = syntomic$.
The question is local on $U$. Thus we may assume that $U$ is
an affine scheme mapping into an affine of $Y$.
Hence we reduce to proving the following case:
$Y = \Spec(A)$, $X = \Spec(A/I)$, and
$U = \Spec(\overline{B})$, where
$A/I \to \overline{B}$ be a syntomic ring map.
By Algebra, Lemma \ref{algebra-lemma-lift-syntomic}
we can find elements $\overline{g}_i \in \overline{B}$
such that
$\overline{B}_{\overline{g}_i} = A_i/IA_i$ for certain syntomic ring maps
$A \to A_i$.
This proves the lemma in the syntomic case.
The proof of the smooth case is the same except it uses
Algebra, Lemma \ref{algebra-lemma-lift-smooth}.
In the \'etale case use
Algebra, Lemma \ref{algebra-lemma-lift-etale}.
\end{proof}

\begin{lemma}
\label{lemma-prepare-closed-immersion-almost-cocontinuous}
Let $f : X \to Y$ be a closed immersion of schemes.
Let $\{U_i \to X\}$ be a syntomic (resp.\ smooth, resp.\ \'etale) covering.
There exists a syntomic (resp.\ smooth, resp.\ \'etale) covering $\{V_j \to Y\}$
such that for each $j$, either $V_j \times_Y X = \emptyset$, or the
morphism $V_j \times_Y X \to X$ factors through $U_i$ for some $i$.
\end{lemma}

\begin{proof}
For each $i$ we can choose syntomic (resp.\ smooth, resp.\ \'etale) morphisms
$g_{ij} : V_{ij} \to Y$ and morphisms $V_{ij} \times_Y X \to U_i$ over $X$,
such that $\{V_{ij} \times_Y X \to U_i\}$ are Zariski coverings, see
Lemma \ref{lemma-closed-immersion-cover-from-below}.
This in particular implies that
$\bigcup_{ij} g_{ij}(V_{ij})$ contains the closed subset $f(X)$.
Hence the family of syntomic (resp.\ smooth, resp.\ \'etale) maps $g_{ij}$
together with the open immersion $Y \setminus f(X) \to Y$ forms the desired
syntomic (resp.\ smooth, resp.\ \'etale) covering of $Y$.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-almost-cocontinuous}
Let $f : X \to Y$ be a closed immersion of schemes.
Let $\tau \in \{syntomic, smooth, \etale\}$.
The functor $V \mapsto X \times_Y V$ defines an almost
cocontinuous functor (see
Sites, Definition \ref{sites-definition-almost-cocontinuous})
$(\Sch/Y)_\tau \to (\Sch/X)_\tau$ between
big $\tau$ sites.
\end{lemma}

\begin{proof}
We have to show the following: given a morphism $V \to Y$
and any syntomic (resp.\ smooth, resp.\ \'etale)
covering $\{U_i \to X \times_Y V\}$, there exists a
smooth (resp.\ smooth, resp.\ \'etale) covering $\{V_j \to V\}$
such that for each $j$, either $X \times_Y V_j$ is empty, or
$X \times_Y V_j \to Z \times_Y V$ factors through one of
the $U_i$. This follows on applying
Lemma \ref{lemma-prepare-closed-immersion-almost-cocontinuous}
above to the closed immersion $X \times_Y V \to V$.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-pushforward-exact}
Let $f : X \to Y$ be a closed immersion of schemes.
Let $\tau \in \{syntomic, smooth, \etale\}$.
\begin{enumerate}
\item The pushforward
$f_{big, *} :
\Sh((\Sch/X)_\tau)
\to
\Sh((\Sch/Y)_\tau)$
commutes with coequalizers and pushouts.
\item The pushforward
$f_{big, *} :
\textit{Ab}((\Sch/X)_\tau)
\to
\textit{Ab}((\Sch/Y)_\tau)$
is exact.
\end{enumerate}
\end{lemma}

\begin{proof}
This follows from
Sites, Lemma \ref{sites-lemma-morphism-of-sites-almost-cocontinuous},
Modules on Sites,
Lemma \ref{sites-modules-lemma-morphism-ringed-sites-almost-cocontinuous},
and
Lemma \ref{lemma-closed-immersion-almost-cocontinuous}
above.
\end{proof}

\begin{remark}
\label{remark-fppf-closed-immersion-not-closed}
In Lemma \ref{lemma-closed-immersion-pushforward-exact} the case $\tau = fppf$
is missing. The reason is that given a ring $A$, an ideal $I$ and a
faithfully flat, finitely presented ring map $A/I \to \overline{B}$, there
is no reason to think that one can find {\it any} flat finitely presented ring
map $A \to B$ with $B/IB \not = 0$ such that $A/I \to B/IB$ factors through
$\overline{B}$. Hence the proof of
Lemma \ref{lemma-closed-immersion-almost-cocontinuous}
does not work for the fppf topology.
In fact it is likely false that
$f_{big, *} : \textit{Ab}((\Sch/X)_{fppf})
\to \textit{Ab}((\Sch/Y)_{fppf})$
is exact when $f$ is a closed immersion.
If you know an example, please email
\href{mailto:stacks.project@gmail.com}{stacks.project@gmail.com}.
\end{remark}












\section{Exactness of big lower shriek}
\label{section-exactness-lower-shriek}

\noindent
This is just the following technical result. Note that the functor $f_{big!}$
has nothing whatsoever to do with cohomology with compact support in
general.

\begin{lemma}
\label{lemma-exactness-lower-shriek}
Let $\tau \in \{Zariski, \etale, smooth, syntomic, fppf\}$.
Let $f : X \to Y$ be a morphism of schemes. Let
$$
f_{big} :
\Sh((\Sch/X)_\tau)
\longrightarrow
\Sh((\Sch/Y)_\tau)
$$
be the corresponding morphism of topoi as in
Topologies, Lemma
\ref{topologies-lemma-morphism-big},
\ref{topologies-lemma-morphism-big-etale},
\ref{topologies-lemma-morphism-big-smooth},
\ref{topologies-lemma-morphism-big-syntomic}, or
\ref{topologies-lemma-morphism-big-fppf}.
\begin{enumerate}
\item The functor
$f_{big}^{-1} : \textit{Ab}((\Sch/Y)_\tau) \to \textit{Ab}((\Sch/X)_\tau)$
has a left adjoint
$$
f_{big!} : \textit{Ab}((\Sch/X)_\tau) \to \textit{Ab}((\Sch/Y)_\tau)
$$
which is exact.
\item The functor
$f_{big}^* :
\textit{Mod}((\Sch/Y)_\tau, \mathcal{O})
\to
\textit{Mod}((\Sch/X)_\tau, \mathcal{O})$
has a left adjoint
$$
f_{big!} :
\textit{Mod}((\Sch/X)_\tau, \mathcal{O})
\to
\textit{Mod}((\Sch/Y)_\tau, \mathcal{O})
$$
which is exact.
\end{enumerate}
Moreover, the two functors $f_{big!}$ agree on underlying sheaves
of abelian groups.
\end{lemma}

\begin{proof}
Recall that $f_{big}$ is the morphism of topoi associated to the
continuous and cocontinuous functor
$u : (\Sch/X)_\tau \to (\Sch/Y)_\tau$, $U/X \mapsto U/Y$.
Moreover, we have $f_{big}^{-1}\mathcal{O} = \mathcal{O}$.
Hence the existence of $f_{big!}$ follows from
Modules on Sites, Lemma \ref{sites-modules-lemma-g-shriek-adjoint},
respectively
Modules on Sites, Lemma \ref{sites-modules-lemma-lower-shriek-modules}.
Note that if $U$ is an object of $(\Sch/X)_\tau$ then the functor
$u$ induces an equivalence of categories
$$
u' :
(\Sch/X)_\tau/U
\longrightarrow
(\Sch/Y)_\tau/U
$$
because both sides of the arrow are equal to $(\Sch/U)_\tau$.
Hence the agreement of $f_{big!}$ on underlying abelian sheaves
follows from the discussion in
Modules on Sites, Remark \ref{sites-modules-remark-when-shriek-equal}.
The exactness of $f_{big!}$ follows from
Modules on Sites, Lemma \ref{sites-modules-lemma-exactness-lower-shriek}
as the functor $u$ above which commutes with fibre products and equalizers.
\end{proof}

\noindent
Next, we prove a technical lemma that will be useful later when comparing
sheaves of modules on different sites associated to algebraic stacks.

\begin{lemma}
\label{lemma-compare-structure-sheaves}
Let $X$ be a scheme. Let
$\tau \in \{Zariski, \etale, smooth, syntomic, fppf\}$.
Let $\mathcal{C}_1 \subset \mathcal{C}_2 \subset (\Sch/X)_\tau$ be full
subcategories with the following properties:
\begin{enumerate}
\item For an object $U/X$ of $\mathcal{C}_t$,
\begin{enumerate}
\item if $\{U_i \to U\}$ is a covering of $(\Sch/X)_\tau$, then
$U_i/X$ is an object of $\mathcal{C}_t$,
\item $U \times \mathbf{A}^1/X$ is an object of $\mathcal{C}_t$.
\end{enumerate}
\item $X/X$ is an object of $\mathcal{C}_t$.
\end{enumerate}
We endow $\mathcal{C}_t$ with the structure of a site whose coverings are
exactly those coverings $\{U_i \to U\}$ of $(\Sch/X)_\tau$ with
$U \in \Ob(\mathcal{C}_t)$. Then
\begin{enumerate}
\item[(\romannumeral1)] The functor $\mathcal{C}_1 \to \mathcal{C}_2$
is fully faithful, continuous, and cocontinuous.
\end{enumerate}
Denote $g : \Sh(\mathcal{C}_1) \to \Sh(\mathcal{C}_2)$ the corresponding
morphism of topoi. Denote $\mathcal{O}_t$ the restriction of $\mathcal{O}$
to $\mathcal{C}_t$. Denote $g_!$ the functor of
Modules on Sites, Definition \ref{sites-modules-definition-g-shriek}.
\begin{enumerate}
\item[(\romannumeral2)] The canonical map $g_!\mathcal{O}_1 \to \mathcal{O}_2$
is an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
Assertion (\romannumeral1) is immediate from the definitions.
In this proof all schemes are schemes over $X$ and all morphisms of
schemes are morphisms of schemes over $X$. Note that $g^{-1}$ is
given by restriction, so that for an object $U$ of $\mathcal{C}_1$
we have $\mathcal{O}_1(U) = \mathcal{O}_2(U) = \mathcal{O}(U)$.
Recall that $g_!\mathcal{O}_1$ is the sheaf associated to the presheaf
$g_{p!}\mathcal{O}_1$ which associates to $V$ in $\mathcal{C}_2$ the group
$$
\colim_{V \to U} \mathcal{O}(U)
$$
where $U$ runs over the objects of $\mathcal{C}_1$ and the colimit is
taken in the category of abelian groups. Below we will use frequently
that if
$$
V \to U \to U'
$$
are morphisms with $U, U' \in \Ob(\mathcal{C}_1)$
and if $f' \in \mathcal{O}(U')$ restricts to $f \in \mathcal{O}(U)$,
then $(V \to U, f)$ and $(V \to U', f')$ define the same element of the
colimit. Also, $g_!\mathcal{O}_1 \to \mathcal{O}_2$ maps the element
$(V \to U, f)$ simply to the pullback of $f$ to $V$.

\medskip\noindent
Surjectivity. Let $V$ be a scheme and let $h \in \mathcal{O}(V)$.
Then we obtain a morphism $V \to X \times \mathbf{A}^1$ induced by $h$
and the structure morphism $V \to X$. Writing
$\mathbf{A}^1 = \Spec(\mathbf{Z}[x])$ we see the element
$x \in \mathcal{O}(X \times \mathbf{A}^1)$ pulls
back to $h$. Since $X \times \mathbf{A}^1$ is an object of $\mathcal{C}_1$
by assumptions (1)(b) and (2) we obtain the desired surjectivity.

\medskip\noindent
Injectivity. Let $V$ be a scheme. Let
$s = \sum_{i = 1, \ldots, n} (V \to U_i, f_i)$ be an element of the colimit
displayed above. For any $i$ we can use the morphism
$f_i : U_i \to X \times \mathbf{A}^1$
to see that $(V \to U_i, f_i)$ defines the same element of the colimit as
$(f_i : V \to X \times \mathbf{A}^1, x)$. Then we can consider
$$
f_1 \times \ldots \times f_n : V \to X \times \mathbf{A}^n
$$
and we see that $s$ is equivalent in the colimit to
$$
\sum\nolimits_{i = 1, \ldots, n}
(f_1 \times \ldots \times f_n : V \to X \times \mathbf{A}^n, x_i) =
(f_1 \times \ldots \times f_n : V \to X \times \mathbf{A}^n,
x_1 + \ldots + x_n)
$$
Now, if $x_1 + \ldots + x_n$ restricts to zero on $V$, then we see
that $f_1 \times \ldots \times f_n$ factors through
$X \times \mathbf{A}^{n - 1} = V(x_1 + \ldots + x_n)$. Hence we see
that $s$ is equivalent to zero in the colimit.
\end{proof}











%9.29.09
\section{\'Etale cohomology}
\label{section-etale-cohomology}

\noindent
In the following sections we prove some basic results on \'etale cohomology.
Here is an example of something we know for cohomology of topological
spaces which also holds for \'etale cohomology.

\begin{lemma}[Mayer-Vietoris for \'etale cohomology]
\label{lemma-mayer-vietoris}
Let $X$ be a scheme. Suppose that $X = U \cup V$ is a
union of two opens. For any abelian sheaf $\mathcal{F}$ on $X_\etale$
there exists a long exact cohomology sequence
$$
\begin{matrix}
0 \to
H^0_\etale(X, \mathcal{F}) \to
H^0_\etale(U, \mathcal{F}) \oplus H^0_\etale(V, \mathcal{F}) \to
H^0_\etale(U \cap V, \mathcal{F}) \\
\phantom{0} \to H^1_\etale(X, \mathcal{F}) \to
H^1_\etale(U, \mathcal{F}) \oplus H^1_\etale(V, \mathcal{F}) \to
H^1_\etale(U \cap V, \mathcal{F})
\end{matrix}
$$
This long exact sequence is functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
Observe that if $\mathcal{I}$ is an injective abelian sheaf, then
$$
0 \to \mathcal{I}(X) \to \mathcal{I}(U) \oplus \mathcal{I}(V) \to
\mathcal{I}(U \cap V) \to 0
$$
is exact. This is true in the first and middle spots as $\mathcal{I}$
is a sheaf. It is true on the right, because
$\mathcal{I}(U) \to \mathcal{I}(U \cap V)$ is surjective by
Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-restriction-along-monomorphism-surjective}.
Another way to prove it would be to show that the cokernel
of the map $\mathcal{I}(U) \oplus \mathcal{I}(V) \to
\mathcal{I}(U \cap V)$ is the first {\v C}ech cohomology group
of $\mathcal{I}$ with respect to the covering
$X = U \cup V$ which vanishes by
Lemmas \ref{lemma-hom-injective} and \ref{lemma-forget-injectives}.
Thus, if $\mathcal{F} \to \mathcal{I}^\bullet$ is an injective
resolution, then
$$
0 \to \mathcal{I}^\bullet(X) \to
\mathcal{I}^\bullet(U) \oplus \mathcal{I}^\bullet(V) \to
\mathcal{I}^\bullet(U \cap V) \to 0
$$
is a short exact sequence of complexes and the associated long
exact cohomology sequence is the sequence of the statement of the lemma.
\end{proof}


\section{Colimits}
\label{section-colimit}

\noindent
We recall that if $(\mathcal{F}_i, \varphi_{ii'})$ is a diagram of sheaves on
a site $\mathcal{C}$ its colimit (in the category of sheaves) is the
sheafification of the presheaf $U \mapsto \colim_i \mathcal{F}_i(U)$. See
Sites, Lemma \ref{sites-lemma-colimit-sheaves}.
If the system is directed, $U$ is a quasi-compact object of
$\mathcal{C}$ which has a cofinal system of coverings by quasi-compact
objects, then $\mathcal{F}(U) = \colim \mathcal{F}_i(U)$, see
Sites, Lemma \ref{sites-lemma-directed-colimits-sections}.
See Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-colim-works-over-collection}
for a result dealing with higher cohomology groups of colimits
of abelian sheaves.

\medskip\noindent
We first state and prove a very general result on colimits and cohomology
and then we explain what it means in some special cases.

\begin{theorem}
\label{theorem-colimit}
Let $X = \lim_{i \in I} X_i$ be a limit of a directed system of schemes
with affine transition morphisms $f_{i'i} : X_{i'} \to X_i$. We assume
that $X_i$ is quasi-compact and quasi-separated for all $i \in I$.
Assume given
\begin{enumerate}
\item an abelian sheaf $\mathcal{F}_i$ on $(X_i)_\etale$ for all $i \in I$,
\item for $i' \geq i$ a map
$\varphi_{i'i} : f_{i'i}^{-1}\mathcal{F}_i \to \mathcal{F}_{i'}$
of abelian sheaves on $(X_{i'})_\etale$
\end{enumerate}
such that $\varphi_{i''i} = \varphi_{i''i'} \circ f_{i'' i'}^{-1}\varphi_{i'i}$
whenever $i'' \geq i' \geq i$.
Denote $f_i : X \to X_i$ the projection and set
$\mathcal{F} = \colim f_i^{-1}\mathcal{F}_i$. Then
$$
\colim_{i\in I} H_\etale^p(X_i, \mathcal{F}_i) = H_\etale^p(X, \mathcal{F}).
$$
for all $p \geq 0$.
\end{theorem}

\begin{proof}
Let us use the affine \'etale sites of $X$ and $X_i$ as introduced
in Lemma \ref{lemma-alternative}. We claim that
$$
X_{affine, \etale} = \colim (X_i)_{affine, \etale}
$$
as sites (see Sites, Lemma \ref{sites-lemma-colimit}).
If we prove this, then the theorem follows from
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-colimit}.
The category of schemes of finite presentation over $X$ is the
colimit of the categories of schemes of finite presentation over $X_i$, see
Limits, Lemma \ref{limits-lemma-descend-finite-presentation}.
The same holds for the subcategories of affine objects \'etale over
$X$ by Limits, Lemmas
\ref{limits-lemma-limit-affine} and \ref{limits-lemma-descend-etale}.
Finally, if $\{U^j \to U\}$ is a covering of $X_{affine, \etale}$
and if $U_i^j \to U_i$ is morphism of affine schemes \'etale over
$X_i$ whose base change to $X$ is $U^j \to U$, then we see that
the base change of $\{U^j_i \to U_i\}$ to some $X_{i'}$ is
a covering for $i'$ large enough, see
Limits, Lemma \ref{limits-lemma-descend-surjective}.
\end{proof}

\noindent
The following two results are special cases of the theorem above.

\begin{lemma}
\label{lemma-colimit}
Let $X$ be a quasi-compact and quasi-separated scheme. Let
$\left(\mathcal{F}_i, \varphi_{ij}\right)$ be a system of abelian sheaves on
$X_\etale$ over the partially ordered set $I$. If $I$ is directed then
$$
\colim_{i\in I} H_\etale^p(X, \mathcal{F}_i) = H_\etale^p(X,
\colim_{i\in I} \mathcal{F}_i).
$$
\end{lemma}

\begin{proof}
This is a special case of Theorem \ref{theorem-colimit}.
We also sketch a direct proof.
We prove it for all $X$ at the same time, by induction on $p$.
\begin{enumerate}
\item
For any quasi-compact and quasi-separated scheme $X$ and any \'etale covering
$\mathcal{U}$ of $X$, show that there exists a refinement
$\mathcal{V} = \{V_j \to X\}_{j\in J}$ with $J$ finite and each $V_j$
quasi-compact and quasi-separated such that all
$V_{j_0} \times_X \cdots \times_X V_{j_p}$ are also
quasi-compact and quasi-separated.
\item
Using the previous step and the definition of colimits in the category of
sheaves, show that the theorem holds for $p = 0$ and all $X$.
\item
Using the locality of cohomology
(Lemma \ref{lemma-locality-cohomology}),
the \u Cech-to-cohomology spectral sequence
(Theorem \ref{theorem-cech-ss}) and the fact that the induction
hypothesis applies to all
$V_{j_0} \times_X \cdots \times_X V_{j_p}$
in the above situation, prove the induction step $p \to p + 1$.
\end{enumerate}
\end{proof}

\begin{lemma}
\label{lemma-directed-colimit-cohomology}
Let $A$ be a ring, $(I, \leq)$ a directed poset and $(B_i, \varphi_{ij})$ a
system of $A$-algebras. Set $B = \colim_{i\in I} B_i$. Let $X \to \Spec(A)$
be a quasi-compact and quasi-separated morphism of schemes. Let
$\mathcal{F}$ an abelian sheaf on $X_\etale$.
Denote $Y_i = X \times_{\Spec(A)} \Spec(B_i)$,
$Y = X \times_{\Spec(A)} \Spec(B)$,
$\mathcal{G}_i = (Y_i \to X)^{-1}\mathcal{F}$ and
$\mathcal{G} = (Y \to X)^{-1}\mathcal{F}$. Then
$$
H_\etale^p(Y, \mathcal{G}) =
\colim_{i\in I} H_\etale^p (X_i, \mathcal{G}_i).
$$
\end{lemma}

\begin{proof}
This is a special case of Theorem \ref{theorem-colimit}.
We also outline a direct proof as follows.
\begin{enumerate}
\item Given $V \to Y$ \'etale with $V$ quasi-compact and
quasi-separated, there exist $i\in I$ and $V_i \to Y_i$ such that
$V = V_i \times_{Y_i} Y$.
If all the schemes considered were affine, this would correspond to the
following algebra statement: if $B = \colim B_i$ and $B \to C$ is \'etale,
then there exist $i \in I$ and $B_i \to C_i$ \'etale such that
$C \cong B \otimes_{B_i} C_i$.
This is proved in Algebra, Lemma \ref{algebra-lemma-etale}.
\item In the situation of (1) show that
$\mathcal{G}(V) = \colim_{i' \geq i} \mathcal{G}_{i'}(V_{i'})$
where $V_{i'}$ is the base change of $V_i$ to $Y_{i'}$.
\item By (1), we see that for every \'etale covering
$\mathcal{V} = \{V_j \to Y\}_{j\in J}$ with $J$ finite and the
$V_j$s quasi-compact and quasi-separated, there exists $i \in I$ and
an \'etale covering $\mathcal{V}_i = \{V_{ij} \to Y_i\}_{j \in J}$
such that $\mathcal{V} \cong \mathcal{V}_i \times_{Y_i} Y$.
\item Show that (2) and (3) imply
$$
\check H^*(\mathcal{V}, \mathcal{G})=
\colim_{i\in I} \check H^*(\mathcal{V}_i, \mathcal{G}_i).
$$
\item Cleverly use the \u Cech-to-cohomology spectral sequence
(Theorem \ref{theorem-cech-ss}).
\end{enumerate}
\end{proof}

\begin{lemma}
\label{lemma-higher-direct-images}
Let $f: X\to Y$ be a morphism of schemes and $\mathcal{F}\in
\textit{Ab}(X_\etale)$. Then $R^pf_*\mathcal{F}$ is the sheaf
associated to the presheaf
$$
(V \to Y) \longmapsto H_\etale^p(X \times_Y V, \mathcal{F}|_{X \times_Y V}).
$$
\end{lemma}

\begin{proof}
This lemma is valid for topological spaces, and the proof in this case is the
same. See
Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-higher-direct-images}
for details.
\end{proof}

\begin{lemma}
\label{lemma-relative-colimit}
Let $S$ be a scheme. Let $X = \lim_{i \in I} X_i$ be a limit of a
directed system of schemes over $S$ with affine transition morphisms
$f_{i'i} : X_{i'} \to X_i$. We assume the structure morphism
$g_i : X_i \to S$ is quasi-compact and quasi-separated for all $i \in I$
and we set $g : X \to S$. Assume given
\begin{enumerate}
\item an abelian sheaf $\mathcal{F}_i$ on $(X_i)_\etale$ for all $i \in I$,
\item for $i' \geq i$ a map
$\varphi_{i'i} : f_{i'i}^{-1}\mathcal{F}_i \to \mathcal{F}_{i'}$
of abelian sheaves on $(X_{i'})_\etale$
\end{enumerate}
such that $\varphi_{i''i} = \varphi_{i''i'} \circ f_{i'' i'}^{-1}\varphi_{i'i}$
whenever $i'' \geq i' \geq i$.
Denote $f_i : X \to X_i$ the projection and set
$\mathcal{F} = \colim f_i^{-1}\mathcal{F}_i$. Then
$$
\colim_{i\in I} R^p g_{i, *} \mathcal{F}_i = R^p g_* \mathcal{F}
$$
for all $p \geq 0$.
\end{lemma}

\begin{proof}
Recall (Lemma \ref{lemma-higher-direct-images})
that $R^p g_{i, *} \mathcal{F}_i$ is the sheaf associated to the
presheaf $U \mapsto H^p_\etale(U \times_S X_i, \mathcal{F}_i)$
and similarly for $R^pg_*\mathcal{F}$. Moreover, the colimit of a
system of sheaves is the sheafification of the colimit on the level
of presheaves. Note that every object of $S_\etale$ has a covering
by quasi-compact and quasi-separated objects (e.g., affine schemes).
Moreover, if $U$ is a quasi-compact and quasi-separated object,
then we have
$$
\colim H^p_\etale(U \times_S X_i, \mathcal{F}_i) =
H^p_\etale(U \times_S X, \mathcal{F})
$$
by Theorem \ref{theorem-colimit}. Thus the lemma follows.
\end{proof}





\section{Stalks of higher direct images}
\label{section-stalks-direct-image}

\begin{theorem}
\label{theorem-higher-direct-images}
Let $f: X \to S$ be a quasi-compact and quasi-separated morphism of schemes,
$\mathcal{F}$ an abelian sheaf on $X_\etale$, and $\overline{s}$ a
geometric point of $S$. Then
$$
\left(R^pf_* \mathcal{F}\right)_{\overline{s}} =
H_\etale^p( X \times_S \Spec(\mathcal{O}_{S, \overline{s}}^{sh}),
p^{-1}\mathcal{F})
$$
where $p : X \times_S \Spec(\mathcal{O}_{S, \overline{s}}^{sh}) \to X$
is the projection.
\end{theorem}

\begin{proof}
Let $\mathcal{I}$ be the category of \'etale neighborhoods of $\overline{s}$
on $S$. By Lemma \ref{lemma-higher-direct-images}
we have
$$
(R^pf_*\mathcal{F})_{\overline{s}} =
\colim_{(V, \overline{v}) \in \mathcal{I}^{opp}}
H^p(X \times_S V, \mathcal{F}|_{X \times_S V}).
$$
We may replace $\mathcal{I}$ by the initial subcategory consisting
of affine \'etale neighbourhoods of $\overline{s}$. Observe that
$$
\Spec(\mathcal{O}_{S, \overline{s}}^{sh}) =
\lim_{(V, \overline{v}) \in \mathcal{I}} V
$$
by Lemma \ref{lemma-describe-etale-local-ring} and
Limits, Lemma
\ref{limits-lemma-directed-inverse-system-affine-schemes-has-limit}.
Since fibre products commute with limits we also obtain
$$
X \times_S \Spec(\mathcal{O}_{S, \overline{s}}^{sh}) =
\lim_{(V, \overline{v}) \in \mathcal{I}} X \times_S V
$$
We conclude by Lemma \ref{lemma-directed-colimit-cohomology}.
\end{proof}





\section{The Leray spectral sequence}
\label{section-leray}

\begin{lemma}
\label{lemma-prepare-leray}
Let $f: X \to Y$ be a morphism and $\mathcal{I}$ an injective object of
$\textit{Ab}(X_\etale)$. Let $V \in \Ob(Y_\etale)$. Then
\begin{enumerate}
\item for any covering $\mathcal{V} = \{V_j\to V\}_{j \in J}$ we have
$\check H^p(\mathcal{V}, f_*\mathcal{I}) = 0$ for all $p > 0$,
\item $f_*\mathcal{I}$ is acyclic for the functor $\Gamma(V, -)$, and
\item if $g : Y \to Z$, then $f_*\mathcal{I}$ is acyclic for $g_*$.
\end{enumerate}
\end{lemma}

\begin{proof}
Observe that $\check{\mathcal{C}}^\bullet(\mathcal{V}, f_*\mathcal{I}) =
\check{\mathcal{C}}^\bullet(\mathcal{V} \times_Y X, \mathcal{I})$
which has vanishing higher cohomology groups by Lemma \ref{lemma-hom-injective}.
This proves (1). The second statement follows as a sheaf which has
vanishing higher {\v C}ech cohomology groups for any covering has vanishing
higher cohomology groups. This a wonderful exercise in using the
\u Cech-to-cohomology spectral sequence, but see
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cech-vanish-collection}
for details and a more precise and general statement.
Part (3) is a consequence of (2) and the description of
$R^pg_*$ in Lemma \ref{lemma-higher-direct-images}.
\end{proof}

\noindent
Using the formalism of Grothendieck spectral sequences, this gives the
following.

\begin{proposition}[Leray spectral sequence]
\label{proposition-leray}
Let $f: X \to Y$ be a morphism of schemes and $\mathcal{F}$ an \'etale sheaf on
$X$. Then there is a spectral sequence
$$
E_2^{p, q} = H_\etale^p(Y, R^qf_*\mathcal{F}) \Rightarrow
H_\etale^{p+q}(X, \mathcal{F}).
$$
\end{proposition}

\begin{proof}
See Lemma \ref{lemma-prepare-leray} and see
Derived Categories, Section
\ref{derived-section-composition-right-derived-functors}.
\end{proof}









\section{Vanishing of finite higher direct images}
\label{section-vanishing-finite-morphism}

\noindent
The next goal is to prove that the higher direct images of a finite morphism of
schemes vanish.

\begin{lemma}
\label{lemma-vanishing-etale-cohomology-strictly-henselian}
Let $R$ be a strictly henselian local ring. Set $S = \Spec(R)$ and let
$\overline{s}$ be its closed point. Then the global
sections functor
$\Gamma(S, -) : \textit{Ab}(S_\etale) \to \textit{Ab}$
is exact. In fact we have $\Gamma(S, \mathcal{F}) = \mathcal{F}_{\overline{s}}$
for any sheaf of sets $\mathcal{F}$. In particular
$$
\forall p\geq 1, \quad H_\etale^p(S, \mathcal{F})=0
$$
for all $\mathcal{F}\in \textit{Ab}(S_\etale)$.
\end{lemma}

\begin{proof}
If we show that $\Gamma(S, \mathcal{F}) = \mathcal{F}_{\overline{s}}$
the $\Gamma(S, -)$ is exact as the stalk functor is exact.
Let $(U, \overline{u})$ be an \'etale neighbourhood of $\overline{s}$.
Pick an affine open neighborhood $\Spec(A)$ of $\overline{u}$ in $U$.
Then $R \to A$ is \'etale and $\kappa(\overline{s}) = \kappa(\overline{u})$.
By Theorem \ref{theorem-henselian} we see that $A \cong R \times A'$
as an $R$-algebra compatible with maps to
$\kappa(\overline{s}) = \kappa(\overline{u})$.
Hence we get a section
$$
\xymatrix{
\Spec(A) \ar[r] & U \ar[d]\\
& S \ar[ul]
}
$$
It follows that in the system of \'etale neighbourhoods of $\overline{s}$
the identity map $(S, \overline{s}) \to (S, \overline{s})$ is cofinal.
Hence $\Gamma(S, \mathcal{F}) = \mathcal{F}_{\overline{s}}$.
The final statement of the lemma follows as the higher derived
functors of an exact functor are zero, see
Derived Categories, Lemma \ref{derived-lemma-right-derived-exact-functor}.
\end{proof}

\begin{proposition}
\label{proposition-finite-higher-direct-image-zero}
Let $f : X \to Y$ be a finite morphism of schemes.
\begin{enumerate}
\item For any geometric point $\overline{y} : \Spec(k) \to Y$ we have
$$
(f_*\mathcal{F})_{\overline{y}} =
\prod\nolimits_{\overline{x} : \Spec(k) \to X,\ f(\overline{x}) =
\overline{y}} \mathcal{F}_{\overline{x}}.
$$
for $\mathcal{F}$ in $\Sh(X_\etale)$ and
$$
(f_*\mathcal{F})_{\overline{y}} =
\bigoplus\nolimits_{\overline{x} : \Spec(k) \to X,\ f(\overline{x}) =
\overline{y}} \mathcal{F}_{\overline{x}}.
$$
for $\mathcal{F}$ in $\textit{Ab}(X_\etale)$.
\item For any $q \geq 1$ we have $R^q f_*\mathcal{F} = 0$.
\end{enumerate}
\end{proposition}

\begin{proof}
Let $X_{\overline{y}}^{sh}$ denote the fiber product
$X \times_Y \Spec(\mathcal{O}_{Y, \overline{y}}^{sh})$.
By Theorem \ref{theorem-higher-direct-images}
the stalk of $R^qf_*\mathcal{F}$ at $\overline{y}$ is computed by
$H_\etale^q(X_{\overline{y}}^{sh}, \mathcal{F})$.
Since $f$ is finite, $X_{\bar y}^{sh}$ is finite over
$\Spec(\mathcal{O}_{Y, \overline{y}}^{sh})$, thus
$X_{\bar y}^{sh} = \Spec(A)$ for some ring $A$
finite over $\mathcal{O}_{Y, \bar y}^{sh}$.
Since the latter is strictly henselian,
Lemma \ref{lemma-finite-over-henselian}
implies that $A$ is a finite product of henselian local rings
$A = A_1 \times \cdots \times A_r$. Since the residue field of
$\mathcal{O}_{Y, \overline{y}}^{sh}$ is separably closed the
same is true for each $A_i$. Hence $A_i$ is strictly henselian.
This implies that $X_{\overline{y}}^{sh} = \coprod_{i=1}^r \Spec(A_i)$.
The vanishing of
Lemma \ref{lemma-vanishing-etale-cohomology-strictly-henselian}
implies that $(R^qf_*\mathcal{F})_{\overline{y}} = 0$ for $q > 0$
which implies (2) by Theorem \ref{theorem-exactness-stalks}.
Part (1) follows from the corresponding statement of
Lemma \ref{lemma-vanishing-etale-cohomology-strictly-henselian}.
\end{proof}

\begin{lemma}
\label{lemma-finite-pushforward-commutes-with-base-change}
Consider a cartesian square
$$
\xymatrix{
X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\
Y' \ar[r]^g & Y
}
$$
of schemes with $f$ a finite morphism. For any sheaf of sets
$\mathcal{F}$ on $X_\etale$ we have
$f'_*(g')^{-1}\mathcal{F} = g^{-1}f_*\mathcal{F}$.
\end{lemma}

\begin{proof}
In great generality there is a pullback map
$g^{-1}f_*\mathcal{F} \to f'_*(g')^{-1}\mathcal{F}$, see
Sites, Section \ref{sites-section-pullback}.
To check this map is an isomorphism it suffices to check
on stalks (Theorem \ref{theorem-exactness-stalks}).
This is clear from the description of stalks
in Proposition \ref{proposition-finite-higher-direct-image-zero} and
Lemma \ref{lemma-stalk-pullback}.
\end{proof}

\noindent
The following lemma is a case of cohomological descent dealing with
\'etale sheaves and finite surjective morphisms. We will significantly
generalize this result once we prove the proper base change theorem.

\begin{lemma}
\label{lemma-cohomological-descent-finite}
Let $f : X \to Y$ be a surjective finite morphism of schemes.
Set $f_n : X_n \to Y$ equal to the $(n + 1)$-fold fibre product
of $X$ over $Y$. For $\mathcal{F} \in \textit{Ab}(Y_\etale)$ set
$\mathcal{F}_n = f_{n, *}f_n^{-1}\mathcal{F}$. There is an exact
sequence
$$
0 \to \mathcal{F} \to \mathcal{F}_0 \to \mathcal{F}_1 \to
\mathcal{F}_2 \to \ldots
$$
on $X_\etale$. Moreover, there is a spectral sequence
$$
E_1^{p, q} = H^q_\etale(X_p, f_p^{-1}\mathcal{F})
$$
converging to $H^{p + q}(Y_\etale, \mathcal{F})$.
This spectral sequence is functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
If we prove the first statement of the lemma, then we obtain a spectral
sequence with $E_1^{p, q} = H^q_\etale(Y, \mathcal{F})$ convering
to $H^{p + q}(Y_\etale, \mathcal{F})$, see
Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor}.
On the other hand, since
$R^if_{p, *}f_p^{-1}\mathcal{F} = 0$ for $i > 0$
(Proposition \ref{proposition-finite-higher-direct-image-zero})
we get
$$
H^q_\etale(X_p, f_p^{-1}\mathcal{F}) =
H^q_\etale(Y, f_{p, *}f_p^{-1} \mathcal{F}) =
H^q_\etale(Y, \mathcal{F}_p)
$$
by Proposition \ref{proposition-leray}
and we get the spectral sequence of the lemma.

\medskip\noindent
To prove the first statement of the lemma, observe that
$X_n$ forms a simplicial scheme over $Y$, see
Simplicial, Example \ref{simplicial-example-fibre-products-simplicial-object}.
Observe moreover, that for each of the projections
$d_j : X_{n + 1} \to X_n$ there is a map
$d_j^{-1} f_n^{-1}\mathcal{F} \to f_{n + 1}^{-1}\mathcal{F}$.
These maps induce maps
$$
\delta_j : \mathcal{F}_n \to \mathcal{F}_{n + 1}
$$
for $j = 0, \ldots, n + 1$. We use the alternating sum of these maps
to define the differentials $\mathcal{F}_n \to \mathcal{F}_{n + 1}$.
Similarly, there is a canonical augmentation $\mathcal{F} \to \mathcal{F}_0$,
namely this is just the canonical map $\mathcal{F} \to f_*f^{-1}\mathcal{F}$.
To check that this sequence of sheaves is an exact complex it suffices
to check on stalks at geometric points (Theorem \ref{theorem-exactness-stalks}).
Thus we let $\overline{y} : \Spec(k) \to Y$ be a geometric point. Let
$E = \{\overline{x} : \Spec(k) \to X \mid f(\overline{x}) = \overline{y}\}$.
Then $E$ is a finite nonempty set and we see that
$$
(\mathcal{F}_n)_{\overline{y}} =
\bigoplus\nolimits_{e \in E^{n + 1}} \mathcal{F}_{\overline{y}}
$$
by Proposition \ref{proposition-finite-higher-direct-image-zero}
and Lemma \ref{lemma-stalk-pullback}.
Thus we have to see that given an abelian group $M$ the sequence
$$
0 \to M \to \bigoplus\nolimits_{e \in E} M \to
\bigoplus\nolimits_{e \in E^2} M \to \ldots
$$
is exact. Here the first map is the diagonal map and the map
$\bigoplus_{e \in E^{n + 1}} M  \to \bigoplus_{e \in E^{n + 2}} M$
is the alternating sum of the maps induced by the $(n + 2)$
projections $E^{n + 2} \to E^{n + 1}$. This can be shown directly
or deduced by applying Simplicial, Lemma
\ref{simplicial-lemma-fibre-products-simplicial-object-w-section}
to the map $E \to \{*\}$.
\end{proof}

\begin{remark}
\label{remark-cohomological-descent-finite}
In the situation of Lemma \ref{lemma-cohomological-descent-finite}
if $\mathcal{G}$ is a sheaf of sets on $Y_\etale$, then we have
$$
\Gamma(Y, \mathcal{G}) =
\text{Equalizer}(
\xymatrix{
\Gamma(X_0, f_0^{-1}\mathcal{G})
\ar@<1ex>[r] \ar@<-1ex>[r] &
\Gamma(X_1, f_1^{-1}\mathcal{G})
}
)
$$
This is proved in exactly the same way, by showing that
the sheaf $\mathcal{G}$ is the equalizer of the two maps
$f_{0, *}f_0^{-1}\mathcal{G} \to f_{1, *}f_1^{-1}\mathcal{G}$.
\end{remark}





\noindent
Here is a fun generalization of
Lemma \ref{lemma-vanishing-etale-cohomology-strictly-henselian}.

\begin{lemma}
\label{lemma-local-rings-strictly-henselian}
Let $S$ be a scheme all of whose local rings are strictly henselian.
Then for any abelian sheaf $\mathcal{F}$ on $S_\etale$ we have
$H^i(S_\etale, \mathcal{F}) = H^i(S_{Zar}, \mathcal{F})$.
\end{lemma}

\begin{proof}
Let $\epsilon : S_\etale \to S_{Zar}$ be the morphism of sites given
by the inclusion functor. The Zariski sheaf $R^p\epsilon_*\mathcal{F}$
is the sheaf associated to the presheaf $U \mapsto H^p_\etale(U, \mathcal{F})$.
Thus the stalk at $x \in X$ is
$\colim H^p_\etale(U, \mathcal{F}) =
H^p_\etale(\Spec(\mathcal{O}_{X, x}), \mathcal{G}_x)$
where $\mathcal{G}_x$ denotes the pullback of $\mathcal{F}$
to $\Spec(\mathcal{O}_{X, x})$, see
Lemma \ref{lemma-directed-colimit-cohomology}.
Thus the higher direct images of $R^p\epsilon_*\mathcal{F}$ are
zero by
Lemma \ref{lemma-vanishing-etale-cohomology-strictly-henselian}
and we conclude by the Leray spectral sequence.
\end{proof}

\begin{lemma}
\label{lemma-affine-only-closed-points}
Let $S$ be an affine scheme such that
(1) all points are closed, and (2) all residue fields are separably
algebraically closed. Then
for any abelian sheaf $\mathcal{F}$ on $S_\etale$ we have
$H^i(S_\etale, \mathcal{F}) = 0$ for $i > 0$.
\end{lemma}

\begin{proof}
Condition (1) implies that the underlying topological space
of $S$ is profinite, see
Algebra, Lemma \ref{algebra-lemma-ring-with-only-minimal-primes}.
Thus the higher cohomology groups of an abelian sheaf on the topological
space $S$ (i.e., Zariski cohomology) is trivial, see
Cohomology, Lemma \ref{cohomology-lemma-vanishing-for-profinite}.
The local rings are strictly henselian by
Algebra, Lemma \ref{algebra-lemma-local-dimension-zero-henselian}.
Thus \'etale cohomology of $S$ is computed by Zariski cohomology
by Lemma \ref{lemma-local-rings-strictly-henselian}
and the proof is done.
\end{proof}


\section{Schemes \'etale over a point}
\label{section-schemes-etale-point}

\noindent
In this section we describe schemes \'etale over the spectrum of
a field. Before we state the result we introduce
the category of $G$-sets for a topological group $G$.

\begin{definition}
\label{definition-G-set-continuous}
Let $G$ be a topological group.
A {\it $G$-set}, sometime called a {\it discrete $G$-set},
is a set $X$ endowed with a left action $a : G \times X \to X$
such that $a$ is continuous when $X$ is given the discrete topology and
$G \times X$ the product topology.
A {\it morphism of $G$-sets} $f : X \to Y$ is simply any $G$-equivariant
map from $X$ to $Y$.
The category of $G$-sets is denoted {\it $G\textit{-Sets}$}.
\end{definition}

\noindent
The condition that $a : G \times X \to X$ is continuous signifies
simply that the stabilizer of any  $x \in X$ is open in $G$.
If $G$ is an abstract group $G$ (i.e., a group but not a topological group)
then this agrees with our preceding definition (see for example
Sites, Example \ref{sites-example-site-on-group})
provided we endow $G$ with the discrete topology.

\medskip\noindent
Recall that if $K \subset L$ is an infinite Galois extension the
Galois group $G = \text{Gal}(L/K)$ comes endowed with a canonical
topology. Namely the open subgroups are the subgroups of the form
$\text{Gal}(L/K') \subset G$ where $K'/K$ is a finite subextension of $L/K$.
The index of an open subgroup is always finite.
We say that $G$ is a profinite (topological) group.

\begin{lemma}
\label{lemma-sheaves-point}
Let $K$ be a field.
Let $K^{sep}$ a separable closure of $K$.
Consider the profinite group
$$
G = \text{Aut}_{\Spec(K)}(\Spec(K^{sep}))^{opp} =
\text{Gal}(K^{sep}/K)
$$
The functor
$$
\begin{matrix}
\text{schemes \'etale over }K &
\longrightarrow &
G\textit{-Sets} \\
X/K & \longmapsto &
\Mor_{\Spec(K)}(\Spec(K^{sep}), X)
\end{matrix}
$$
is an equivalence of categories.
\end{lemma}

\begin{proof}
A scheme $X$ over $K$ is \'etale over $K$ if and only if
$X \cong \coprod_{i\in I} \Spec(K_i)$ with
each $K_i$ a finite separable extension of $K$.
The functor of the lemma associates to $X$ the $G$-set
$$
\coprod\nolimits_i \Hom_K(K_i, K^{sep})
$$
with its natural left $G$-action. Each element has an open stabilizer
by definition of the topology on $G$. Conversely, any $G$-set $S$
is a disjoint union of its orbits. Say $S = \coprod S_i$. Pick $s_i \in S_i$
and denote $G_i \subset G$ its open stabilizer. By Galois theory the fields
$(K^{sep})^{G_i}$ are finite separable field extensions of $K$, and
hence the scheme
$$
\coprod\nolimits_i \Spec((K^{sep})^{G_i})
$$
is \'etale over $K$. This gives an inverse to the functor of the lemma.
Some details omitted.
\end{proof}

\begin{remark}
\label{remark-covering-surjective}
Under the correspondence of the lemma, the coverings in the small \'etale site
$\Spec(K)_\etale$ of $K$ correspond to surjective families of
maps in $G\textit{-Sets}$.
\end{remark}







%10.06.09
\section{Galois action on stalks}
\label{section-galois-action-stalks}

\noindent
In this section we define an action of the absolute Galois group of a residue
field of a point $s$ of $S$ on the stalk functor at any geometric point lying
over $s$.

\medskip\noindent
Galois action on stalks.
Let $S$ be a scheme.
Let $\overline{s}$ be a geometric point of $S$.
Let $\sigma \in \text{Aut}(\kappa(\overline{s})/\kappa(s))$.
Define an action of $\sigma$ on the stalk $\mathcal{F}_{\overline{s}}$
of a sheaf $\mathcal{F}$ as follows
\begin{equation}
\label{equation-galois-action}
\begin{matrix}
\mathcal{F}_{\overline{s}} &
\longrightarrow &
\mathcal{F}_{\overline{s}} \\
(U, \overline{u}, t) &
\longmapsto &
(U, \overline{u} \circ \Spec(\sigma), t).
\end{matrix}
\end{equation}
where we use the description of elements of the stalk in terms of triples
as in the discussion following
Definition \ref{definition-stalk}.
This is a left action, since if
$\sigma_i \in \text{Aut}(\kappa(\overline{s})/\kappa(s))$
then
\begin{align*}
\sigma_1 \cdot (\sigma_2 \cdot (U, \overline{u}, t))
& =
\sigma_1 \cdot (U, \overline{u} \circ \Spec(\sigma_2), t) \\
& =
(U, \overline{u} \circ \Spec(\sigma_2) \circ \Spec(\sigma_1), t) \\
& =
(U, \overline{u} \circ \Spec(\sigma_1 \circ \sigma_2), t) \\
& =
(\sigma_1 \circ \sigma_2) \cdot (U, \overline{u}, t)
\end{align*}
It is clear that this action is functorial in the sheaf $\mathcal{F}$.
We note that we could have defined this action by referring directly to
Remark \ref{remark-map-stalks}.

\begin{definition}
\label{definition-algebraic-geometric-point}
Let $S$ be a scheme.
Let $\overline{s}$ be a geometric point lying over the point $s$ of $S$.
Let $\kappa(s) \subset \kappa(s)^{sep} \subset \kappa(\overline{s})$
denote the separable algebraic closure of $\kappa(s)$ in the algebraically
closed field $\kappa(\overline{s})$.
\begin{enumerate}
\item In this situation the {\it absolute Galois group} of $\kappa(s)$
is $\text{Gal}(\kappa(s)^{sep}/\kappa(s))$. It is sometimes denoted
$\text{Gal}_{\kappa(s)}$.
\item The geometric point $\overline{s}$ is called
{\it algebraic} if $\kappa(s) \subset \kappa(\overline{s})$ is
an algebraic closure of $\kappa(s)$.
\end{enumerate}
\end{definition}

\begin{example}
\label{example-stupid}
The geometric point
$\Spec(\mathbf{C}) \to \Spec(\mathbf{Q})$
is not algebraic.
\end{example}

\noindent
Let $\kappa(s) \subset \kappa(s)^{sep} \subset \kappa(\overline{s})$
be as in the definition. Note that as $\kappa(\overline{s})$ is algebraically
closed the map
$$
\text{Aut}(\kappa(\overline{s})/\kappa(s))
\longrightarrow
\text{Gal}(\kappa(s)^{sep}/\kappa(s)) = \text{Gal}_{\kappa(s)}
$$
is surjective. Suppose $(U, \overline{u})$ is an
\'etale neighbourhood of $\overline{s}$, and say $\overline{u}$ lies over
the point $u$ of $U$. Since $U \to S$ is \'etale, the residue field extension
$\kappa(s) \subset \kappa(u)$ is finite separable.
This implies the following
\begin{enumerate}
\item If $\sigma \in \text{Aut}(\kappa(\overline{s})/\kappa(s)^{sep})$
then $\sigma$ acts trivially on $\mathcal{F}_{\overline{s}}$.
\item More precisely, the action of
$\text{Aut}(\kappa(\overline{s})/\kappa(s))$
determines and is determined by an action of the absolute Galois group
$\text{Gal}_{\kappa(s)}$ on $\mathcal{F}_{\overline{s}}$.
\item Given $(U, \overline{u}, t)$ representing an element $\xi$ of
$\mathcal{F}_{\overline{s}}$ any element of
$\text{Gal}(\kappa(s)^{sep}/K)$ acts trivially, where
$\kappa(s) \subset K \subset \kappa(s)^{sep}$ is the image of
$\overline{u}^\sharp : \kappa(u) \to \kappa(\overline{s})$.
\end{enumerate}
Altogether we see that $\mathcal{F}_{\overline{s}}$ becomes a
$\text{Gal}_{\kappa(s)}$-set (see
Definition \ref{definition-G-set-continuous}).
Hence we may think of the stalk functor as a functor
$$
\Sh(S_\etale) \longrightarrow
\text{Gal}_{\kappa(s)}\textit{-Sets},
\quad
\mathcal{F} \longmapsto \mathcal{F}_{\overline{s}}
$$
and from now on we usually do think about the stalk functor in this way.

\begin{theorem}
\label{theorem-equivalence-sheaves-point}
Let $S = \Spec(K)$ with $K$ a field.
Let $\overline{s}$ be a geometric point of $S$.
Let $G = \text{Gal}_{\kappa(s)}$ denote the absolute Galois group.
Then the functor above induces an equivalence of categories
$$
\Sh(S_\etale) \longrightarrow G\textit{-Sets},
\quad
\mathcal{F} \longmapsto \mathcal{F}_{\overline{s}}.
$$
\end{theorem}

\begin{proof}
Let us construct the inverse to this functor. In
Lemma \ref{lemma-sheaves-point}
we have seen that given a $G$-set $M$ there exists an \'etale morphism
$X \to \Spec(K)$
such that $\Mor_K(\Spec(K^{sep}), X)$ is
isomorphic to $M$ as a $G$-set. Consider the sheaf
$\mathcal{F}$ on $\Spec(K)_\etale$ defined by
the rule $U \mapsto \Mor_K(U, X)$. This is a sheaf as the \'etale
topology is subcanonical. Then we see that
$\mathcal{F}_{\overline{s}} = \Mor_K(\Spec(K^{sep}), X) = M$
as $G$-sets (details omitted). This gives the inverse of the functor and
we win.
\end{proof}

\begin{remark}
\label{remark-every-sheaf-representable}
Another way to state the conclusions of
Lemmas \ref{lemma-sheaves-point} and
Theorem \ref{theorem-equivalence-sheaves-point}
is to say that every sheaf on $\Spec(K)_\etale$ is representable
by a scheme $X$ \'etale over $\Spec(K)$.
This does not mean that every sheaf is representable in the sense of
Sites, Definition \ref{sites-definition-representable-sheaf}.
The reason is that in our construction of $\Spec(K)_\etale$
we chose a sufficiently large set of schemes \'etale over $\Spec(K)$,
whereas sheaves on $\Spec(K)_\etale$ form a proper class.
\end{remark}

\begin{lemma}
\label{lemma-global-sections-point}
Assumptions and notations as in
Theorem \ref{theorem-equivalence-sheaves-point}.
There is a functorial bijection
$$
\Gamma(S, \mathcal{F}) = (\mathcal{F}_{\overline{s}})^G
$$
\end{lemma}

\begin{proof}
We can prove this using formal arguments and the result of
Theorem \ref{theorem-equivalence-sheaves-point}
as follows. Given a sheaf $\mathcal{F}$ corresponding to
the $G$-set $M = \mathcal{F}_{\overline{s}}$ we have
\begin{eqnarray*}
\Gamma(S, \mathcal{F}) & = &
\Mor_{\Sh(S_\etale)}(h_{\Spec(K)},  \mathcal{F})
\\
& = & \Mor_{G\textit{-Sets})}(\{*\}, M) \\
& = & M^G
\end{eqnarray*}
Here the first identification is explained in
Sites, Sections \ref{sites-section-presheaves} and
\ref{sites-section-representable-sheaves},
the second results from
Theorem \ref{theorem-equivalence-sheaves-point}
and the third is clear. We will also give a direct proof\footnote{For
the doubting Thomases out there.}.

\medskip\noindent
Suppose that $t \in \Gamma(S, \mathcal{F})$ is a global section.
Then the triple $(S, \overline{s}, t)$ defines an element of
$\mathcal{F}_{\overline{s}}$ which is clearly invariant under the
action of $G$. Conversely, suppose that $(U, \overline{u}, t)$
defines an element of $\mathcal{F}_{\overline{s}}$ which is invariant.
Then we may shrink $U$ and assume $U = \Spec(L)$ for some
finite separable field extension of $K$, see
Proposition \ref{proposition-etale-morphisms}.
In this case the map $\mathcal{F}(U) \to \mathcal{F}_{\overline{s}}$
is injective, because for any morphism of \'etale neighbourhoods
$(U', \overline{u}') \to (U, \overline{u})$ the restriction map
$\mathcal{F}(U) \to \mathcal{F}(U')$ is injective since $U' \to U$
is a covering of $S_\etale$.
After enlarging $L$ a bit we may assume $K \subset L$ is a finite
Galois extension. At this point we use that
$$
\Spec(L) \times_{\Spec(K)} \Spec(L)
=
\coprod\nolimits_{\sigma \in \text{Gal}(L/K)} \Spec(L)
$$
where the maps $\Spec(L) \to \Spec(L \otimes_K L)$
come from the ring maps $a \otimes b \mapsto a\sigma(b)$. Hence we
see that the condition that $(U, \overline{u}, t)$ is invariant
under all of $G$ implies that $t \in \mathcal{F}(\Spec(L))$
maps to the same element of
$\mathcal{F}(\Spec(L) \times_{\Spec(K)} \Spec(L))$
via restriction by either projection (this uses the injectivity mentioned
above; details omitted). Hence the sheaf condition of $\mathcal{F}$
for the \'etale covering $\{\Spec(L) \to \Spec(K)\}$ kicks
in and we conclude that $t$ comes from a unique section of $\mathcal{F}$
over $\Spec(K)$.
\end{proof}

\begin{remark}
\label{remark-stalk-pullback}
Let $S$ be a scheme and let $\overline{s} : \Spec(k) \to S$
be a geometric point of $S$. By definition this means that $k$
is algebraically closed. In particular the absolute Galois group of $k$
is trivial. Hence by
Theorem \ref{theorem-equivalence-sheaves-point}
the category of sheaves on $\Spec(k)_\etale$ is equivalent
to the category of sets. The equivalence is given by taking
sections over $\Spec(k)$. This finally provides us with an
alternative definition of the stalk functor. Namely, the functor
$$
\Sh(S_\etale) \longrightarrow \textit{Sets}, \quad
\mathcal{F} \longmapsto \mathcal{F}_{\overline{s}}
$$
is isomorphic to the functor
$$
\Sh(S_\etale)
\longrightarrow
\Sh(\Spec(k)_\etale) = \textit{Sets},
\quad
\mathcal{F} \longmapsto \overline{s}^*\mathcal{F}
$$
To prove this rigorously one can use
Lemma \ref{lemma-stalk-pullback} part (3)
with $f = \overline{s}$. Moreover, having said this the general case of
Lemma \ref{lemma-stalk-pullback} part (3)
follows from functoriality of pullbacks.
\end{remark}






\section{Group cohomology}
\label{section-group-cohomology}

\noindent
Notation. If we write $H^i(G, M)$ we will mean that $G$ is a topological group
and $M$ a discrete $G$-module with continuous $G$-action. This includes
the case of an abstract group $G$, which simply means that $G$ is viewed
as a topological group with the discrete topology. When the module has a
nondiscrete topology, we will use the notation $H^i_{cont}(G, M)$ to
indicate the cohomology theory discussed in \cite{Tate}.

\begin{definition}
\label{definition-G-module-continuous}
Let $G$ be a topological group.
A {\it $G$-module}, sometime called a {\it discrete $G$-module},
is an abelian group $M$ endowed with a left action $a : G \times M \to M$
by group homomorphisms such that $a$ is continuous when $M$ is given the
discrete topology and $G \times M$ the product topology.
A {\it morphism of $G$-modules} $f : M \to N$ is simply any $G$-equivariant
homomorphism from $M$ to $N$.
The category of $G$-modules is denoted {\it $\textit{Mod}_G$}.
\end{definition}

\noindent
The condition that $a : G \times M \to M$ is continuous is equivalent
with the condition that the stabilizer of any  $x \in M$ is open in $G$.
If $G$ is an abstract group then this corresponds to the notion of an
abelian group endowed with a $G$-action provided we endow $G$ with the
discrete topology.

\medskip\noindent
The category $\textit{Mod}_G$ has enough injectives, see
Injectives, Lemma \ref{injectives-lemma-G-modules}.
Consider the left exact functor
$$
\textit{Mod}_G \longrightarrow \textit{Ab},
\quad
M \longmapsto M^G =
\{x \in M \mid g \cdot x = x\ \forall g \in G\}
$$
We sometimes denote $M^G = H^0(G, M)$ and sometimes we write
$M^G = \Gamma_G(M)$. This functor has a total right derived functor
$R\Gamma_G(M)$ and $i$th right derived functor
$R^i\Gamma_G(M) = H^i(G, M)$ for any $i \geq 0$.

\begin{definition}
\label{definition-galois-cohomology}
Let $G$ be a topological group. Let $M$ be a $G$-module.
\begin{enumerate}
\item The right derived functors $H^i(G, M)$ are called the
{\it continuous group cohomology groups} of $M$.
\item If $G$ is an abstract group endowed with the discrete topology
then the $H^i(G, M)$ are called the {\it group cohomology groups} of $M$.
\item If $G$ is a Galois group, then the groups $H^i(G, M)$ are called
the {\it Galois cohomology groups} of $M$.
\item If $G$ is the absolute Galois group of a field $K$, then the groups
$H^i(G, M)$ are sometimes called the {\it Galois cohomology groups of $K$
with coefficients in $M$}. In this case we sometimes write
$H^i(K, M)$ instead of $H^i(G, M)$.
\end{enumerate}
\end{definition}

\noindent
We can compute continuous group cohomology by the complex of
inhomogeneous cochains. In fact, we can define this when $M$ is an
arbitrary topological abelian group endowed with a continuous $G$-action.
Namely, we consider the complex
$$
C^\bullet_{cont}(G, M) :
M \to \text{Maps}_{cont}(G, M) \to
\text{Maps}_{cont}(G \times G, M) \to \ldots
$$
where the boundary map is defined for $n \geq 1$ by the rule
\begin{align*}
\text{d}(f)(g_1, \ldots, g_{n + 1})
& = g_1(f(g_2, \ldots, g_{n + 1})) \\
&
+ \sum\nolimits_{j = 1, \ldots, n}
(-1)^jf(g_1, \ldots, g_jg_{j + 1}, \ldots, g_{n + 1}) \\
&
+ (-1)^{n + 1}f(g_1, \ldots, g_n)
\end{align*}
and for $n = 0$ sends $m \in M$ to the map $g \mapsto g(m) - m$. We define
$$
H^i_{cont}(G, M) = H^i(C^\bullet_{cont}(G, M))
$$
Since the terms of the complex involve continuous maps from $G$ and
self products of $G$ into the topological module $M$, it is not clear
that this turns a short exact sequence of topological modules into
a long exact cohomology sequence. (One difficulty is that the category
of topological abelian groups isn't an abelian category!) However, this
is true when the topology on the modules is discrete. In fact, if $M$
is a $G$-module as in Definition \ref{definition-G-module-continuous},
then there is a canonical isomorphism
$$
H^i(G, M) = H^i_{cont}(G, M)
$$
of cohomology groups.






\section{Cohomology of a point}
\label{section-cohomology-point}

\noindent
As a consequence of the discussion in the preceding sections
we obtain the equivalence of \'etale cohomology of the spectrum of a
field with Galois cohomology.

\begin{lemma}
\label{lemma-equivalence-abelian-sheaves-point}
Let $S = \Spec(K)$ with $K$ a field.
Let $\overline{s}$ be a geometric point of $S$.
Let $G = \text{Gal}_{\kappa(s)}$ denote the absolute Galois group.
The stalk functor induces an equivalence of categories
$$
\textit{Ab}(S_\etale) \longrightarrow \textit{Mod}_G,
\quad
\mathcal{F} \longmapsto \mathcal{F}_{\overline{s}}.
$$
\end{lemma}

\begin{proof}
In
Theorem \ref{theorem-equivalence-sheaves-point}
we have seen the equivalence between sheaves of sets and $G$-sets.
The current lemma follows formally from this as an abelian sheaf is just
a sheaf of sets endowed with a commutative group law, and a $G$-module
is just a $G$-set endowed with a commutative group law.
\end{proof}

\begin{lemma}
\label{lemma-compare-cohomology-point}
Notation and assumptions as in
Lemma \ref{lemma-equivalence-abelian-sheaves-point}.
Let $\mathcal{F}$ be an abelian sheaf on $\Spec(K)_\etale$
which corresponds to the $G$-module $M$.
Then
\begin{enumerate}
\item in $D(\textit{Ab})$ we have a canonical isomorphism
$R\Gamma(S, \mathcal{F}) = R\Gamma_G(M)$,
\item $H_\etale^0(S, \mathcal{F}) = M^G$, and
\item $H_\etale^q(S, \mathcal{F}) = H^q(G, M)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Combine
Lemma \ref{lemma-equivalence-abelian-sheaves-point}
with
Lemma \ref{lemma-global-sections-point}.
\end{proof}

\begin{example}
\label{example-sheaves-point}
Sheaves on $\Spec(K)_\etale$.
Let $G = \text{Gal}(K^{sep}/K)$ be the absolute Galois group of $K$.
\begin{enumerate}
\item The constant sheaf $\underline{\mathbf{Z}/n\mathbf{Z}}$ corresponds to
the module $\mathbf{Z}/n\mathbf{Z}$ with trivial $G$-action,
\item the sheaf $\mathbf{G}_m|_{\Spec(K)_\etale}$ corresponds to
$(K^{sep})^*$ with its $G$-action,
\item the sheaf $\mathbf{G}_a|_{\Spec(K^{sep})}$ corresponds to
$(K^{sep}, +)$ with its $G$-action, and
\item the sheaf $\mu_n|_{\Spec(K^{sep})}$ corresponds to
$\mu_n(K^{sep})$ with its $G$-action.
\end{enumerate}
By
Remark \ref{remark-special-case-fpqc-cohomology-quasi-coherent}
and
Theorem \ref{theorem-picard-group}
we have the following identifications for cohomology groups:
\begin{align*}
H_\etale^0(S_\etale, \mathbf{G}_m) & =
\Gamma(S, \mathcal{O}_S^*) \\
H_\etale^1(S_\etale, \mathbf{G}_m) & =
H_{Zar}^1(S, \mathcal{O}_S^*) = \text{Pic}(S) \\
H_\etale^i(S_\etale, \mathbf{G}_a) & =
H_{Zar}^i(S, \mathcal{O}_S)
\end{align*}
Also, for any quasi-coherent sheaf $\mathcal{F}$ on $S_\etale$ we have
$$
H^i(S_\etale, \mathcal{F}) = H_{Zar}^i(S, \mathcal{F}),
$$
see
Theorem \ref{theorem-zariski-fpqc-quasi-coherent}.
In particular, this gives the following sequence of equalities
$$
0 =
\text{Pic}(\Spec(K)) =
H_\etale^1(\Spec(K)_\etale, \mathbf{G}_m) =
H^1(G, (K^{sep})^*)
$$
which is none other than Hilbert's 90 theorem. Similarly, for $i \geq 1$,
$$
0 = H^i(\Spec(K), \mathcal{O})
= H_\etale^i(\Spec(K)_\etale, \mathbf{G}_a)
= H^i(G, K^{sep})
$$
where the $K^{sep}$ indicates $K^{sep}$ as a Galois module with addition
as group law. In this way we may consider the work we have done so far as
a complicated way of computing Galois cohomology groups.
\end{example}











\section{Cohomology of curves}
\label{section-cohomology-curves}

\noindent
The next task at hand is to compute the \'etale cohomology of a smooth curve
over an algebraically closed field with torsion coefficients, and in
particular show that it vanishes in degree at least 3. To prove this, we
will compute cohomology at the generic point, which
amounts to some Galois cohomology.





\section{Brauer groups}
\label{section-brauer-groups}

\noindent
Brauer groups of fields are defined using finite central simple algebras.
In this section we review the relevant facts about Brauer groups, most of
which are discussed in the chapter
Brauer Groups, Section \ref{brauer-section-introduction}.
For other references, see \cite{SerreCorpsLocaux},
\cite{SerreGaloisCohomology} or \cite{Weil}.

\begin{theorem}
\label{theorem-central-simple-algebra}
Let $K$ be a field. For a unital, associative (not necessarily commutative)
$K$-algebra $A$ the following are equivalent
\begin{enumerate}
\item $A$ is finite central simple $K$-algebra,
\item $A$ is a finite dimensional $K$-vector space, $K$ is the center of $A$,
and $A$ has no nontrivial two-sided ideal,
\item there exists $d \geq 1$ such that
$A \otimes_K \bar K \cong \text{Mat}(d \times d, \bar K)$,
\item there exists $d \geq 1$ such that
$A \otimes_K K^{sep} \cong \text{Mat}(d \times d, K^{sep})$,
\item there exist $d \geq 1$ and a finite Galois extension $K \subset K'$
such that
$A \otimes_{K'} K' \cong \text{Mat}(d \times d, K')$,
\item there exist $n \geq 1$ and a finite central skew field $D$
over $K$ such that $A \cong \text{Mat}(n \times n, D)$.
\end{enumerate}
The integer $d$ is called the {\it degree} of $A$.
\end{theorem}

\begin{proof}
This is a copy of
Brauer Groups, Lemma \ref{brauer-lemma-finite-central-simple-algebra}.
\end{proof}

\begin{lemma}
\label{lemma-brauer-inverse}
Let $A$ be a finite central simple algebra over $K$. Then
$$
\begin{matrix}
A \otimes_K A^{opp} & \longrightarrow & \text{End}_K(A) \\
\ a \otimes a' & \longmapsto & (x \mapsto a x a')
\end{matrix}
$$
is an isomorphism of algebras over $K$.
\end{lemma}

\begin{proof}
See
Brauer Groups, Lemma \ref{brauer-lemma-inverse}.
\end{proof}

\begin{definition}
\label{definition-brauer-equivalent}
Two finite central simple algebras $A_1$ and $A_2$ over $K$ are called
{\it similar}, or {\it equivalent} if there exist $m, n \geq 1$
such that $\text{Mat}(n \times n, A_1)
\cong \text{Mat}(m \times m, A_2)$. We write $A_1 \sim A_2$.
\end{definition}

\noindent
By Brauer Groups, Lemma \ref{brauer-lemma-similar} this is an
equivalence relation.

\begin{definition}
\label{definition-brauer-group}
Let $K$ be a field. The {\it Brauer group} of $K$ is the set $\text{Br} (K)$
of similarity classes of finite central simple algebras over $K$, endowed with
the group law induced by tensor product (over $K$). The class of $A$ in
$\text{Br}(K)$ is denoted by $[A]$. The neutral element is
$[K] = [\text{Mat}(d \times d, K)]$ for any $d \geq 1$.
\end{definition}

\noindent
The previous lemma implies that inverses exist and that $-[A] = [A^{opp}]$.
The Brauer group of a field is always torsion.
In fact, we will see that $[A]$ has order $\deg(A)$
for any finite central simple algebra $A$ (see
Lemma \ref{lemma-annihilated-by-degree}).
In general the Brauer group is not finitely generated, for example
the Brauer group of a non-Archimedean local field is $\mathbf{Q}/\mathbf{Z}$.
The Brauer group of $\mathbf{C}(x, y)$ is uncountable.

\begin{lemma}
\label{lemma-central-simple-algebra-pgln}
Let $K$ be a field and let $K^{sep}$ be a separable algebraic closure.
Then the set of isomorphism classes of central simple algebras of degree
$d$ over $K$ is in bijection with the non-abelian cohomology
$H^1(\text{Gal}(K^{sep}/K), \text{PGL}_d(K^{sep}))$.
\end{lemma}

\begin{proof}[Sketch of proof.]
The Skolem-Noether theorem (see
Brauer Groups, Theorem \ref{brauer-theorem-skolem-noether})
implies that for any field $L$ the group
$\text{Aut}_{L\text{-Algebras}}(\text{Mat}_d(L))$
equals $\text{PGL}_d(L)$. By
Theorem \ref{theorem-central-simple-algebra}, we see that
central simple algebras of degree $d$ correspond
to forms of the $K$-algebra $\text{Mat}_d(K)$.
Combined we see that isomorphism classes of degree $d$ central
simple algebras correspond to elements of
$H^1(\text{Gal}(K^{sep}/K), \text{PGL}_d(K^{sep}))$.
For more details on twisting, see for example
\cite{SilvermanEllipticCurves}.
\end{proof}

\noindent
If $A$ is a finite central simple algebra of degree $d$ over a field $K$,
we denote $\xi_A$ the corresponding cohomology class in
$H^1(\text{Gal}(K^{sep}/K), \text{PGL}_d(K^{sep}))$.
Consider the short exact sequence
$$
1 \to (K^{sep})^* \to \text{GL}_d(K^{sep}) \to \text{PGL}_d(K^{sep}) \to 1,
$$
which gives rise to a long exact cohomology sequence (up to degree 2) with
coboundary map
$$
\delta_d :
H ^1(\text{Gal}(K^{sep}/K), \text{PGL}_d(K^{sep}))
\longrightarrow
H^2(\text{Gal}(K^{sep}/K), (K^{sep})^*).
$$
Explicitly, this is given as follows: if $\xi$ is a cohomology class
represented by the 1-cocycle $(g_\sigma)$, then $\delta_d(\xi)$ is the
class of the 2-cocycle
\begin{equation}
\label{equation-two-cocycle}
(\sigma, \tau)
\longmapsto
\tilde g_\sigma^{-1} \tilde g_{\sigma \tau} \sigma(\tilde g_\tau^{-1})
\in (K^{sep})^*
\end{equation}
where $\tilde g_\sigma \in \text{GL}_d(K^{sep})$ is a lift of $g_\sigma$.
Using this we can make explicit the map
$$
\delta : \text{Br}(K) \longrightarrow H^2(\text{Gal}(K^{sep}/K), (K^{sep})^*),
\quad
[A] \longmapsto \delta_{\deg A} (\xi_A)
$$
as follows. Assume $A$ has degree $d$ over $K$. Choose an isomorphism
$\varphi : \text{Mat}_d(K^{sep}) \to A \otimes_K K^{sep}$. For
$\sigma \in \text{Gal}(K^{sep}/K)$ choose an element
$\tilde g_\sigma \in \text{Gl}_d(K^{sep})$ such that
$\varphi^{-1} \circ \sigma(\varphi)$ is equal to the map
$x \mapsto \tilde g_\sigma x \tilde g_\sigma^{-1}$. The class in $H^2$
is defined by the two cocycle (\ref{equation-two-cocycle}).

\begin{theorem}
\label{theorem-brauer-delta}
Let $K$ be a field with separable algebraic closure $K^{sep}$. The map
$\delta : \text{Br}(K) \to H^2(\text{Gal}(K^{sep}/K), (K^{sep})^*)$
defined above is a group isomorphism.
\end{theorem}

\begin{proof}[Sketch of proof]
In the abelian case ($d = 1$), one has the identification
$$
H^1(\text{Gal}(K^{sep}/K), \text{GL}_d(K^{sep})) =
H_\etale^1(\Spec(K), \text{GL}_d(\mathcal{O}))
$$
the latter of which is trivial by fpqc descent. If this were true in the
non-abelian case, this would readily imply injectivity of $\delta$. (See
\cite{SGA4.5}.) Rather, to prove this, one can reinterpret $\delta([A])$ as the
obstruction to the existence of a $K$-vector space $V$ with a left $A$-module
structure and such that $\dim_K V = \deg A$. In the case where $V$ exists, one
has $A \cong \text{End}_K(V)$. For surjectivity, pick a
cohomology class $\xi \in H^2(\text{Gal}(K^{sep}/K), (K^{sep})^*)$,
then there exists a finite Galois extension $K \subset K' \subset K^{sep}$
such that $\xi$ is the image of some
$\xi' \in H^2(\text{Gal}(K'|K), (K')^*)$. Then write
down an explicit central simple algebra over $K$ using the data $K', \xi'$.
\end{proof}










\section{The Brauer group of a scheme}
\label{section-brauer-scheme}

\noindent
Let $S$ be a scheme. An $\mathcal{O}_S$-algebra
$\mathcal{A}$ is called {\it Azumaya} if it is \'etale locally a matrix
algebra, i.e., if there exists an \'etale covering
$\mathcal{U} = \{ \varphi_i : U_i \to S\}_{i \in I}$ such that
$\varphi_i^*\mathcal{A} \cong \text{Mat}_{d_i}(\mathcal{O}_{U_i})$
for some $d_i \geq 1$. Two such
$\mathcal{A}$ and $\mathcal{B}$ are called {\it equivalent} if there exist
finite locally free $\mathcal{O}_S$-modules $\mathcal{F}$ and $\mathcal{G}$
which have positive rank at every $s \in S$ such that
$$
\mathcal{A} \otimes_{\mathcal{O}_S}
\mathcal{E}\!{\it nd}_{\mathcal{O}_S}(\mathcal{F})
\cong
\mathcal{B} \otimes_{\mathcal{O}_S}
\mathcal{E}\!{\it nd}_{\mathcal{O}_S}(\mathcal{G})
$$
as $\mathcal{O}_S$-algebras. The {\it Brauer group} of
$S$ is the set $\text{Br}(S)$ of equivalence classes of Azumaya
$\mathcal{O}_S$-algebras with the operation induced by tensor product (over
$\mathcal{O}_S$).

\begin{lemma}
\label{lemma-end-unique-up-to-invertible}
Let $S$ be a scheme. Let $\mathcal{F}$ and $\mathcal{G}$ be finite locally
free sheaves of $\mathcal{O}_S$-modules of positive rank. If there
exists an isomorphism
$\mathcal{E}\!{\it nd}_{\mathcal{O}_S}(\mathcal{F}) \cong
\mathcal{E}\!{\it nd}_{\mathcal{O}_S}(\mathcal{G})$ of
$\mathcal{O}_S$-algebras, then there exists an invertible sheaf
$\mathcal{L}$ on $S$ such that
$\mathcal{F} \otimes_{\mathcal{O}_S} \mathcal{L} \cong \mathcal{G}$
and such that this isomorphism induces the given isomorphism of
endomorphism algebras.
\end{lemma}

\begin{proof}
Fix an isomorphism
$\mathcal{E}\!{\it nd}_{\mathcal{O}_S}(\mathcal{F}) \to
\mathcal{E}\!{\it nd}_{\mathcal{O}_S}(\mathcal{F})$.
Consider the sheaf $\mathcal{L} \subset \SheafHom(\mathcal{F}, \mathcal{G})$
generated as an $\mathcal{O}_S$-module by the local isomorphisms
$\varphi : \mathcal{F} \to \mathcal{G}$ such that conjugation by
$\varphi$ is the given isomorphism of endomorphism algebras.
A local calculation (reducing to the case that $\mathcal{F}$ and $\mathcal{G}$
are finite free and $S$ is affine) shows that $\mathcal{L}$ is invertible.
Another local calculation shows that the evaluation map
$$
\mathcal{F} \otimes_{\mathcal{O}_S} \mathcal{L} \longrightarrow \mathcal{G}
$$
is an isomorphism.
\end{proof}

\noindent
The argument given in the proof of the following lemma can be found in
\cite{Saltman-torsion}.

\begin{lemma}
\label{lemma-annihilated-by-degree}
\begin{reference}
Argument taken from \cite{Saltman-torsion}.
\end{reference}
Let $S$ be a scheme. Let $\mathcal{A}$ be an Azumaya algebra which is
locally free of rank $d^2$ over $S$. Then the class
of $\mathcal{A}$ in the Brauer group of $S$ is annihilated by $d$.
\end{lemma}

\begin{proof}
Choose an \'etale covering $\{U_i \to S\}$ and choose isomorphisms
$\mathcal{A}|_{U_i} \to \mathcal{E}\!{\it nd}(\mathcal{F}_i)$
for some locally free $\mathcal{O}_{U_i}$-modules $\mathcal{F}_i$
of rank $d$. (We may assume $\mathcal{F}_i$ is free.) Consider the
composition
$$
p_i : \mathcal{F}_i^{\otimes d} \to
\wedge^d(\mathcal{F}_i) \to \mathcal{F}_i^{\otimes d}
$$
The first arrow is the usual projection and the second arrow is
the isomorphism of the top exterior power of $\mathcal{F}_i$ with
the submodule of sections of $\mathcal{F}_i^{\otimes d}$ which transform
according to the sign character under the action of the symmetric group
on $d$ letters. Then $p_i^2 = p_i$ and the rank of $p_i$ is $1$.
Using the given isomorphism
$\mathcal{A}|_{U_i} \to \mathcal{E}\!{\it nd}(\mathcal{F}_i)$
and the canonical isomorphism
$$
\mathcal{E}\!{\it nd}(\mathcal{F}_i)^{\otimes d} =
\mathcal{E}\!{\it nd}(\mathcal{F}_i^{\otimes d})
$$
we may think of $p_i$ as a section of $\mathcal{A}^{\otimes d}$
over $U_i$. We claim that $p_i|_{U_i \times_S U_j} = p_j|_{U_i \times_S U_j}$
as sections of $\mathcal{A}^{\otimes d}$. Namely, applying
Lemma \ref{lemma-end-unique-up-to-invertible}
we obtain an invertible sheaf $\mathcal{L}_{ij}$ and a canonical isomorphism
$$
\mathcal{F}_i|_{U_i \times_S U_j} \otimes \mathcal{L}_{ij}
\longrightarrow
\mathcal{F}_j|_{U_i \times_S U_j}.
$$
Using this isomorphism we see that $p_i$ maps to $p_j$.
Since $\mathcal{A}^{\otimes d}$ is a sheaf on $S_\etale$
(Proposition \ref{proposition-quasi-coherent-sheaf-fpqc}) we find a canonical
global section $p \in \Gamma(S, \mathcal{A}^{\otimes d})$. A local calculation
shows that
$$
\mathcal{H} =
\Im(\mathcal{A}^{\otimes d} \to \mathcal{A}^{\otimes d}, f \mapsto fp)
$$
is a locally free module of rank $d^d$ and that (left) multiplication
by $\mathcal{A}^{\otimes d}$ induces an isomorphism
$\mathcal{A}^{\otimes d} \to \mathcal{E}\!{\it nd}(\mathcal{H})$.
In other words, $\mathcal{A}^{\otimes d}$ is the trivial element
of the Brauer group of $S$ as desired.
\end{proof}

\noindent
In this setting, the analogue of the isomorphism $\delta$ of
Theorem \ref{theorem-brauer-delta}
is a map
$$
\delta_S: \text{Br}(S) \to H_\etale^2(S, \mathbf{G}_m).
$$
It is true that $\delta_S$ is injective. If $S$ is quasi-compact or
connected, then $\text{Br}(S)$ is a torsion group, so in this case the
image of $\delta_S$ is contained in the {\it cohomological Brauer group} of $S$
$$
\text{Br}'(S) := H_\etale^2(S, \mathbf{G}_m)_\text{torsion}.
$$
So if $S$ is quasi-compact or connected, there is an inclusion $\text{Br}(S)
\subset \text{Br}'(S)$. This is not always an equality: there exists a
nonseparated singular surface $S$ for which $\text{Br}(S) \subset
\text{Br}'(S)$ is a strict inclusion. If $S$ is quasi-projective, then
$\text{Br}(S) = \text{Br}'(S)$. However, it is not known whether this holds for
a smooth proper variety over $\mathbf{C}$, say.




\section{Galois cohomology}
\label{section-galois-cohomology}

\noindent
In this section we will use the following result from Galois cohomology
to get vanishing of higher \'etale cohomology groups over the spectrum
of a field.

\begin{proposition}
\label{proposition-serre-galois}
\begin{reference}
\cite[Chapter II, Section 3, Proposition 5]{SerreGaloisCohomology}
\end{reference}
Let $K$ be a field with separable algebraic closure $K^{sep}$.
Assume that for any finite extension $K'$ of $K$ we have
$\text{Br}(K') = 0$. Then
\begin{enumerate}
\item $H^q(\text{Gal}(K^{sep}/K), (K^{sep})^*) = 0$
for all $q \geq 1$, and
\item $H^q(\text{Gal}(K^{sep}/K), M) = 0$
for any torsion $\text{Gal}(K^{sep}/K)$-module $M$ and any $q \geq 2$,
\end{enumerate}
\end{proposition}

\begin{proof}
Omitted.
\end{proof}

%10.08.09

\begin{definition}
\label{definition-Cr}
A field $K$ is called {\it $C_r$}
if for every $0 < d^r < n$ and every $f \in K[T_1,
\ldots, T_n]$ homogeneous of degree $d$, there exist $\alpha = (\alpha_1,
\ldots, \alpha_n)$, $\alpha_i \in K$ not all zero, such that $f(\alpha) = 0$.
Such an $\alpha$ is called a {\it nontrivial solution} of $f$.
\end{definition}

\begin{example}
\label{example-algebraically-closed-field-Cr}
An algebraically closed field is $C_r$.
\end{example}

\noindent
In fact, we have the following simple lemma.

\begin{lemma}
\label{lemma-algebraically-closed-find-solutions}
Let $k$ be an algebraically closed field. Let
$f_1, \ldots, f_s \in k[T_1, \ldots, T_n]$
be homogeneous polynomials of degree $d_1, \ldots, d_s$ with $d_i
> 0$. If $s < n$, then $f_1 = \ldots = f_s = 0$ have a common nontrivial
solution.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
The following result computes the Brauer group of $C_1$ fields.

\begin{theorem}
\label{theorem-C1-brauer-group-zero}
Let $K$ be a $C_1$ field. Then $\text{Br}(K) = 0$.
\end{theorem}

\begin{proof}
Let $D$ be a finite dimensional division algebra over $K$ with center $K$. We
have seen that
$$
D \otimes_K K^{sep} \cong \text{Mat}_d(K^{sep})
$$
uniquely up to inner isomorphism. Hence the determinant $\det :
\text{Mat}_d(K^{sep}) \to K^{sep}$ is Galois invariant and descends to a
homogeneous degree $d$ map
$$
\det = N_\text{red} : D \longrightarrow K
$$
called the {\it reduced norm}. Since $K$ is $C_1$, if $d > 1$, then there
exists a nonzero $x \in D$ with $N_\text{red}(x) = 0$. This clearly implies
that $x$ is not invertible, which is a contradiction. Hence $\text{Br}(K) = 0$.
\end{proof}

\begin{definition}
\label{definition-variety}
Let $k$ be a field. A {\it variety} is separated, integral scheme of
finite type over $k$. A {\it curve} is a variety of dimension $1$.
\end{definition}

\begin{theorem}[Tsen's theorem]
\label{theorem-tsen}
The function field of a variety of dimension $r$ over an algebraically closed
field $k$ is $C_r$.
\end{theorem}

\begin{proof}
For projective space one can show directly that the field
$k(x_1, \ldots, x_r)$ is $C_r$ (exercise).

\medskip\noindent
General case. Without loss of generality, we may assume $X$ to be projective.
Let $f \in K[T_1, \dots, T_n]_d$ with $0 < d^r <n$. Say the coefficients of $f$
are in $\Gamma(X, \mathcal{O}_X(H))$ for some ample $H \subset X$. Let
$\mathbf{\alpha} = (\alpha_1, \dots, \alpha_n)$ with $\alpha_i \in \Gamma(X,
\mathcal{O}_X(eH))$. Then $f(\mathbf{\alpha}) \in \Gamma(X,
\mathcal{O}_X((de+1)H))$. Consider the system of equations $f(\mathbf{\alpha})
=0$. Then by asymptotic Riemann-Roch,
\begin{itemize}
\item
the number of variables is $n\dim_K \Gamma(X, \mathcal{O}_X(eH)) \sim
n\frac{e^r}{r!} (H^r)$ ; and
\item
the number of equations is $\dim_K \Gamma(X, \mathcal{O}_X((de+1)H)) \sim
\frac{(de+1)^r}{r!} (H^r).$
\end{itemize}
Since $n> d^r$, there are more variables than equations, and since there is a
trivial solution, there are also nontrivial solutions.
\end{proof}

\begin{lemma}
\label{lemma-curve-brauer-zero}
Let $C$ be a curve over an algebraically closed field $k$. Then
the Brauer group of the function field of $C$ is zero:
$\text{Br}(k(C)) = 0$.
\end{lemma}

\begin{proof}
This is clear from Tsen's theorem,
Theorem \ref{theorem-tsen}.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-Gm-function-field-curve}
Let $k$ be an algebraically closed field and $k \subset K$ a field extension
of transcendence degree 1. Then for all $q \geq 1$,
$H_\etale^q(\Spec(K), \mathbf{G}_m) = 0$.
\end{lemma}

\begin{proof}
Recall that
$H_\etale^q(\Spec(K), \mathbf{G}_m) = H^q(\text{Gal}(K^{sep}/K), (K^{sep})^*)$
by Lemma \ref{lemma-compare-cohomology-point}.
Thus by Proposition \ref{proposition-serre-galois}
it suffices to show that if $K \subset K'$ is a finite field extension, then
$\text{Br}(K') = 0$. Now observe that $K' = \colim K''$, where $K''$ runs
over the finitely generated subextensions of $k$ contained in $K'$ of
transcendence degree $1$.
Note that $\text{Br}(K') = \colim \text{Br}(K'')$ which reduces us
to a finitely generated field extension $K''/k$ of transcendence
degree $1$. Such a field is the function field of a curve over $k$,
hence has trivial Brauer group by
Lemma \ref{lemma-curve-brauer-zero}.
\end{proof}






\section{Higher vanishing for the multiplicative group}
\label{section-higher-Gm}

\noindent
In this section, we fix an algebraically closed field $k$ and a smooth curve
$X$ over $k$. We denote $i_x : x \hookrightarrow X$ the inclusion of a closed
point of $X$ and $j : \eta \hookrightarrow X$ the inclusion of the generic
point. We also denote $X^0$ the set of closed points of $X$.

\begin{theorem}[The Fundamental Exact Sequence]
\label{theorem-fundamental-exact-sequence}
There is a short exact sequence of \'etale sheaves on $X$
$$
0 \longrightarrow
\mathbf{G}_{m, X} \longrightarrow
j_* \mathbf{G}_{m, \eta} \longrightarrow
\bigoplus\nolimits_{x \in X^0} {i_x}_* \underline{\mathbf{Z}}
\longrightarrow 0.
$$
\end{theorem}

\begin{proof}
Let $\varphi : U \to X$ be an \'etale morphism. Then by properties of
\'etale morphisms (Proposition \ref{proposition-etale-morphisms}),
$U = \coprod_i U_i$ where each $U_i$ is a smooth curve mapping to $X$.
The above sequence for $X$ is a product of the corresponding sequences
for each $U_i$, so it suffices to treat the case where $U$ is connected,
hence irreducible. In this case, there is a well known exact sequence
$$
1 \longrightarrow
\Gamma(U, \mathcal{O}_U^*) \longrightarrow
k(U)^* \longrightarrow \bigoplus\nolimits_{y \in U^0} \mathbf{Z}_y.
$$
This amounts to a sequence
$$
0 \longrightarrow \Gamma(U, \mathcal{O}_U^*) \longrightarrow
\Gamma(\eta \times_X U, \mathcal{O}_{\eta \times_X U}^*) \longrightarrow
\bigoplus\nolimits_{x \in X^0}
\Gamma(x \times_X U, \underline{\mathbf{Z}})
$$
which, unfolding definitions, is nothing but a sequence
$$
0 \longrightarrow \mathbf{G}_m(U) \longrightarrow
j_* \mathbf{G}_{m, \eta}(U) \longrightarrow
\left(\bigoplus\nolimits_{x \in X^0} {i_x}_* \underline{\mathbf{Z}}\right)(U).
$$
This defines the maps in the Fundamental Exact Sequence and shows it is exact
except possibly at the last step. To see surjectivity, let us recall that if
$U$ is a nonsingular curve and $D$ is a divisor on $U$,
then there exists a Zariski open covering $\{U_j \to U\}$ of $U$
such that $D|_{U_j} = \text{div}(f_j)$ for some $f_j \in k(U)^*$.
\end{proof}

\begin{lemma}
\label{lemma-higher-direct-jstar-Gm}
For any $q \geq 1$, $R^q j_*\mathbf{G}_{m, \eta} = 0$.
\end{lemma}

\begin{proof}
We need to show that $(R^q j_*\mathbf{G}_{m, \eta})_{\bar x} = 0$ for every
geometric point $\bar x$ of $X$.

\medskip\noindent
Assume that $\bar x$ lies over a closed point $x$ of $X$. Let $\Spec(A)$
be an affine open neighbourhood of $x$ in $X$, and $K$ the fraction field
of $A$. Then
$$
\Spec(\mathcal{O}^{sh}_{X, \bar x}) \times_X \eta =
\Spec(\mathcal{O}^{sh}_{X, \bar x} \otimes_A K).
$$
The ring $\mathcal{O}^{sh}_{X, \bar x} \otimes_A K$ is a localization of
the discrete valuation ring $\mathcal{O}^{sh}_{X, \bar x}$, so it is either
$\mathcal{O}^{sh}_{X, \bar x}$ again, or its fraction field
$K^{sh}_{\bar x}$. But since some local uniformizer gets inverted, it must
be the latter. Hence
$$
(R^q j_*\mathbf{G}_{m, \eta})_{(X, \bar x)} = H_\etale^q(\Spec
K^{sh}_{\bar x}, \mathbf{G}_m).
$$
Now recall that $\mathcal{O}^{sh}_{X, \bar x} =
\colim_{(U, \bar u) \to \bar x} \mathcal{O}(U) = \colim_{A \subset B} B$
where $A \to B$ is \'etale, hence $K^{sh}_{\bar x}$ is an algebraic
extension of $K = k(X)$, and we may apply
Lemma \ref{lemma-cohomology-Gm-function-field-curve}
to get the vanishing.

\medskip\noindent
Assume that $\bar x = \bar \eta$ lies over the generic point $\eta$ of $X$ (in
fact, this case is superfluous). Then $\mathcal{O}_{X, \bar \eta} =
\kappa(\eta)^{sep}$ and thus
\begin{eqnarray*}
(R^q j_*\mathbf{G}_{m, \eta})_{\bar \eta}
& = &
H_\etale^q(\Spec(\kappa(\eta)^{sep}) \times_X \eta, \mathbf{G}_m) \\
& = & H_\etale^q (\Spec(\kappa(\eta)^{sep}), \mathbf{G}_m) \\
& = & 0 \ \ \text{ for } q \geq 1
\end{eqnarray*}
since the corresponding Galois group is trivial.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-jstar-Gm}
For all $p \geq 1$, $H_\etale^p(X, j_*\mathbf{G}_{m, \eta}) = 0$.
\end{lemma}

\begin{proof}
The Leray spectral sequence reads
$$
E_2^{p, q} = H_\etale^p(X, R^qj_*\mathbf{G}_{m, \eta}) \Rightarrow
H_\etale^{p+q}(\eta, \mathbf{G}_{m, \eta}),
$$
which vanishes for $p+q \geq 1$ by
Lemma \ref{lemma-cohomology-Gm-function-field-curve}. Taking
$q = 0$, we get the desired vanishing.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-istar-Z}
For all $q \geq 1$, $H_\etale^q(X, \bigoplus_{x \in X^0} {i_x}_*
\underline{\mathbf{Z}}) = 0$.
\end{lemma}

\begin{proof}
For $X$ quasi-compact and quasi-separated, cohomology commutes with colimits,
so it suffices to show the vanishing of $H_\etale^q(X, {i_x}_*
\underline{\mathbf{Z}})$. But then the inclusion $i_x$ of a closed point is
finite so $R^p {i_x}_* \underline{\mathbf{Z}} = 0$ for all $p \geq 1$ by
Proposition \ref{proposition-finite-higher-direct-image-zero}.
Applying the Leray spectral sequence, we see that
$H_\etale^q(X, {i_x}_* \underline{\mathbf{Z}}) =
H_\etale^q(x, \underline{\mathbf{Z}})$.
Finally, since $x$ is the spectrum of an
algebraically closed field, all higher cohomology on $x$ vanishes.
\end{proof}

\noindent
Concluding this series of lemmata, we get the following result.

\begin{theorem}
\label{theorem-vanishing-cohomology-Gm-curve}
Let $X$ be a smooth curve over an algebraically closed field. Then
$$
H_\etale^q(X, \mathbf{G}_m) = 0 \ \ \text{ for all } q \geq 2.
$$
\end{theorem}

\begin{proof}
See discussion above.
\end{proof}

\noindent
We also get the cohomology long exact sequence
$$
0 \to
H_\etale^0(X, \mathbf{G}_m) \to
H_\etale^0(X, j_*\mathbf{G}_{m\eta}) \to
H_\etale^0(X, \bigoplus {i_x}_*\underline{\mathbf{Z}}) \to
H_\etale^1(X, \mathbf{G}_m) \to 0
$$
although this is the familiar
$$
0 \to H_{Zar}^0(X, \mathcal{O}_X^*) \to k(X)^* \to \text{Div}(X)
\to \text{Pic}(X) \to 0.
$$




\section{The Artin-Schreier sequence}
\label{section-artin-schreier}

\noindent
Let $p$ be a prime number. Let $S$ be a scheme in characteristic $p$.
The {\it Artin-Schreier} sequence is the short exact sequence
$$
0 \longrightarrow \underline{\mathbf{Z}/p\mathbf{Z}}_S \longrightarrow
\mathbf{G}_{a, S} \xrightarrow{F-1} \mathbf{G}_{a, S} \longrightarrow 0
$$
where $F - 1$ is the map $x \mapsto x^p - x$.

\begin{lemma}
\label{lemma-vanishing-affine-char-p-p}
Let $p$ be a prime. Let $S$ be a scheme of characteristic $p$.
\begin{enumerate}
\item If $S$ is affine, then
$H_\etale^q(S, \underline{\mathbf{Z}/p\mathbf{Z}}) = 0$ for all
$q \geq 2$.
\item If $S$ is a quasi-compact and quasi-separated scheme of
dimension $d$, then $H_\etale^q(S, \underline{\mathbf{Z}/p\mathbf{Z}}) = 0$
for all $q \geq 2 + d$.
\end{enumerate}
\end{lemma}

\begin{proof}
Recall that the \'etale cohomology of the structure sheaf is equal
to its cohomology on the underlying topological space
(Theorem \ref{theorem-zariski-fpqc-quasi-coherent}).
The first statement follows from the Artin-Schreier exact sequence
and the vanishing of cohomology of the structure sheaf on an affine
scheme (Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherent-affine-cohomology-zero}).
The second statement follows by the same argument from
the vanishing of Cohomology, Proposition
\ref{cohomology-proposition-cohomological-dimension-spectral}
and the fact that $S$ is a spectral space
(Properties, Lemma
\ref{properties-lemma-quasi-compact-quasi-separated-spectral}).
\end{proof}

\begin{lemma}
\label{lemma-F-1}
Let $k$ be an algebraically closed field of characteristic $p > 0$.
Let $V$ be a finite dimensional $k$-vector space. Let $F : V \to V$
be a frobenius linear map, i.e., an additive map such that
$F(\lambda v) = \lambda^p F(v)$ for all $\lambda \in k$ and $v \in V$.
Then $F - 1 : V \to V$ is surjective with kernel a finite dimensional
$\mathbf{F}_p$-vector space of dimension $\leq \dim_k(V)$.
\end{lemma}

\begin{proof}
If $F = 0$, then the statement holds. If we have a filtration of $V$ by
$F$-stable subvector spaces such that the statement holds for each
graded piece, then it holds for $(V, F)$. Combining these two remarks
we may assume the kernel of $F$ is zero.

\medskip\noindent
Choose a basis $v_1, \ldots, v_n$ of $V$ and write
$F(v_i) = \sum a_{ij} v_j$. Observe that $v = \sum \lambda_i v_i$
is in the kernel if and only if $\sum \lambda_i^p a_{ij} v_j = 0$.
Since $k$ is algebraically closed this implies the matrix $(a_{ij})$
is invertible. Let $(b_{ij})$ be its inverse. Then to see that $F - 1$
is surjective we pick $w = \sum \mu_i v_i \in V$ and we try to solve
$$
(F - 1)(\sum \lambda_iv_i) =
\sum \lambda_i^p a_{ij} v_j - \sum \lambda_j v_j = \sum \mu_j v_j
$$
This is equivalent to
$$
\sum \lambda_j^p v_j - \sum b_{ij} \lambda_i v_j = \sum b_{ij} \mu_i v_j
$$
in other words
$$
\lambda_j^p - \sum b_{ij} \lambda_i = \sum b_{ij} \mu_i,
\quad j = 1, \ldots, \dim(V).
$$
The algebra
$$
A = k[x_1, \ldots, x_n]/
(x_j^p - \sum b_{ij} x_i - \sum b_{ij} \mu_i)
$$
is standard smooth over $k$
(Algebra, Definition \ref{algebra-definition-standard-smooth})
because the matrix $(b_{ij})$ is invertible and the partial derivatives
of $x_j^p$ are zero. A basis of $A$ over $k$ is the set of monomials
$x_1^{e_1} \ldots x_n^{e_n}$ with $e_i < p$, hence $\dim_k(A) = p^n$.
Since $k$ is algebraically closed we see that $\Spec(A)$ has exactly
$p^n$ points. It follows that $F - 1$ is surjective and every fibre
has $p^n$ points, i.e., the kernel of $F - 1$ is a group with $p^n$ elements.
\end{proof}

\begin{lemma}
\label{lemma-top-cohomology-coherent}
Let $X$ be a separated scheme of finite type over a field $k$.
Let $\mathcal{F}$ be a coherent sheaf of $\mathcal{O}_X$-modules.
Then $\dim_k H^d(X, \mathcal{F}) < \infty$ where $d = \dim(X)$.
\end{lemma}

\begin{proof}
We will prove this by induction on $d$. The case $d = 0$ holds because
in that case $X$ is the spectrum of a finite dimensinal $k$-algebra $A$
(Varieties, Lemma \ref{varieties-lemma-algebraic-scheme-dim-0})
and every coherent sheaf $\mathcal{F}$ corresponds to a finite $A$-module
$M = H^0(X, \mathcal{F})$ which has $\dim_k M < \infty$.

\medskip\noindent
Assume $d > 0$ and the result has been shown for separated shemes
of finite type of dimension $< d$. The scheme $X$ is Noetherian. Consider
the property $\mathcal{P}$ of coherent sheaves on $X$ defined by the rule
$$
\mathcal{P}(\mathcal{F}) \Leftrightarrow
\dim_k H^d(X, \mathcal{F}) < \infty
$$
We are going to use the result of
Cohomology of Schemes, Lemma \ref{coherent-lemma-property-initial}
to prove that $\mathcal{P}$ holds for every coherent sheaf on $X$.

\medskip\noindent
Let
$$
0 \to \mathcal{F}_1 \to \mathcal{F} \to \mathcal{F}_2 \to 0
$$
be a short exact sequence of coherent sheaves on $X$.
Consider the long exact sequence of cohomology
$$
H^d(X, \mathcal{F}_1) \to
H^d(X, \mathcal{F}) \to
H^d(X, \mathcal{F}_2)
$$
Thus if $\mathcal{P}$ holds for $\mathcal{F}_1$ and $\mathcal{F}_2$,
then it hods for $\mathcal{F}$.

\medskip\noindent
Let $Z \subset X$ be an integral closed subscheme. Let $\mathcal{I}$
be a coherent sheaf of ideals on $Z$. To finish the proof have to show
that $H^d(X, i_*\mathcal{I}) = H^d(Z, \mathcal{I})$ is finite dimensional.
If $\dim(Z) < d$, then the result holds because the cohomology group
will be zero (Cohomology, Proposition
\ref{cohomology-proposition-vanishing-Noetherian}).
In this way we reduce to the situation discussed in the following paragraph.

\medskip\noindent
Assume $X$ is a variety of dimension $d$ and 
$\mathcal{F} = \mathcal{I}$ is a coherent ideal sheaf. In this
case we have a short exact sequence
$$
0 \to \mathcal{I} \to \mathcal{O}_X \to i_*\mathcal{O}_Z \to 0
$$
where $i : Z \to X$ is the closed subscheme defined by $\mathcal{I}$.
By induction hypothesis we see that
$H^{d - 1}(Z, \mathcal{O}_Z) = H^{d - 1}(X, i_*\mathcal{O}_Z)$ is
finite dimensional. Thus we see that it suffices to prove the result
for the structure sheaf.

\medskip\noindent
We can apply Chow's lemma
(Cohomology of Schemes, Lemma \ref{coherent-lemma-chow-Noetherian})
to the morphism $X \to \Spec(k)$. Thus we get a diagram
$$
\xymatrix{
X \ar[rd]_g & X' \ar[d]^-{g'} \ar[l]^\pi \ar[r]_i & \mathbf{P}^n_k \ar[dl] \\
& \Spec(k) &
}
$$
as in the statement of Chow's lemma. Also, let $U \subset X$ be
the dense open subscheme such that $\pi^{-1}(U) \to U$ is an isomorphism.
We may assume $X'$ is a variety as well, see
Cohomology of Schemes, Remark \ref{coherent-remark-chow-Noetherian}.
The morphism $i' = (i, \pi) : X' \to \mathbf{P}^n_X$ is
a closed immersion (loc. cit.). Hence
$$
\mathcal{L} = i^*\mathcal{O}_{\mathbf{P}^n_k}(1) \cong
(i')^*\mathcal{O}_{\mathbf{P}^n_X}(1)
$$
is $\pi$-relatively ample (for example by
Morphisms, Lemma \ref{morphisms-lemma-characterize-ample-on-finite-type}).
Hence by Cohomology of Schemes, Lemma \ref{coherent-lemma-kill-by-twisting}
there exists an $n \geq 0$ such that
$R^p\pi_*\mathcal{L}^{\otimes n} = 0$ for all $p > 0$.
Set $\mathcal{G} = \pi_*\mathcal{L}^{\otimes n}$.
Choose any nonzero global section $s$ of $\mathcal{L}^{\otimes n}$.
Since $\mathcal{G} = \pi_*\mathcal{L}^{\otimes n}$, the section $s$
corresponds to section of $\mathcal{G}$, i.e., a map
$\mathcal{O}_X \to \mathcal{G}$.
Since $s|_U \not = 0$ as $X'$ is a variety and $\mathcal{L}$
invertible, we see that $\mathcal{O}_X|_U \to \mathcal{G}|_U$
is nonzero. As $\mathcal{G}|_U = \mathcal{KL}^{\otimes n}|_{\pi^{-1}(U)}$
is invertible we conclude that we have a short exact sequence
$$
0 \to \mathcal{O}_X \to \mathcal{G} \to \mathcal{Q} \to 0
$$
where $\mathcal{Q}$ is coherent and supported on a proper
closed subscheme of $X$. Arguing as before using our induction
hypothesis, we see that it
suffices to prove $\dim H^d(X, \mathcal{G}) < \infty$.

\medskip\noindent
By the Leray spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-apply-Leray})
we see that $H^d(X, \mathcal{G}) = H^d(X', \mathcal{L}^{\otimes n})$.
Let $\overline{X}' \subset \mathbf{P}^n_k$ be the closure
of $X'$. Then $\overline{X}'$ is a projective variety of dimension $d$
over $k$ and $X' \subset \overline{X}'$ is a dense open.
The invertible sheaf $\mathcal{L}$ is the restriction of
$\mathcal{O}_{\overline{X}'}(n)$ to $X$. By
Cohomology, Proposition
\ref{cohomology-proposition-cohomological-dimension-spectral}
the map
$$
H^d(\overline{X}', \mathcal{O}_{\overline{X}'}(n))
\longrightarrow
H^d(X', \mathcal{L}^{\otimes n})
$$
is surjective. Since the cohomology group on the left has
finite dimension by
Cohomology of Schemes, Lemma \ref{coherent-lemma-coherent-projective}
the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-vanishing-variety-char-p-p}
Let $X$ be separated of finite type over an algebraically closed
field $k$ of characteristic $p > 0$. Then
$H_\etale^q(X, \underline{\mathbf{Z}/p\mathbf{Z}}) = 0$ for
$q \geq dim(X) + 1$.
\end{lemma}

\begin{proof}
Let $d = \dim(X)$. By the vanishing established in
Lemma \ref{lemma-vanishing-affine-char-p-p}
it suffices to show that
$H_\etale^{d + 1}(X, \underline{\mathbf{Z}/p\mathbf{Z}}) = 0$.
By Lemma \ref{lemma-top-cohomology-coherent} we see that
$H^d(X, \mathcal{O}_X)$ is a finite dimensional $k$-vector space.
Hence the long exact cohomology sequence associated to the
Artin-Schreier sequence ends with
$$
H^d(X, \mathcal{O}_X) \xrightarrow{F - 1}
H^d(X, \mathcal{O}_X) \to H^{d + 1}_\etale(X, \mathbf{Z}/p\mathbf{Z}) \to 0
$$
By Lemma \ref{lemma-F-1} the map $F - 1$ in this sequence is surjective.
This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-finiteness-proper-variety-char-p-p}
Let $X$ be a proper scheme over an algebraically closed
field $k$ of characteristic $p > 0$. Then
\begin{enumerate}
\item $H_\etale^q(X, \underline{\mathbf{Z}/p\mathbf{Z}})$
is a finite $\mathbf{Z}/p\mathbf{Z}$-module for all $q$, and
\item $H^q_\etale(X, \underline{\mathbf{Z}/p\mathbf{Z}}) \to
H^q_\etale(X_{k'}, \underline{\mathbf{Z}/p\mathbf{Z}}))$
is an isomorphism if $k \subset k'$ is an extension of algebraically
closed fields.
\end{enumerate}
\end{lemma}

\begin{proof}
By Cohomology of Schemes, Lemma
\ref{coherent-lemma-proper-over-affine-cohomology-finite})
and the comparison of cohomology of
Theorem \ref{theorem-zariski-fpqc-quasi-coherent} the cohomology groups
$H^q_\etale(X, \mathbf{G}_a) = H^q(X, \mathcal{O}_X)$ are
finite dimensional $k$-vector spaces. Hence by
Lemma \ref{lemma-F-1} the long exact cohomology sequence
associated to the Artin-Schreier sequence, splits into
short exact sequences
$$
0 \to H_\etale^q(X, \underline{\mathbf{Z}/p\mathbf{Z}}) \to
H^q(X, \mathcal{O}_X) \xrightarrow{F - 1} H^q(X, \mathcal{O}_X) \to 0
$$
and moreover the $\mathbf{F}_p$-dimension of the cohomology groups
$H_\etale^q(X, \underline{\mathbf{Z}/p\mathbf{Z}})$ is equal to the
$k$-dimension of the vector space $H^q(X, \mathcal{O}_X)$.
This proves the first statement. The second statement follows
as $H^q(X, \mathcal{O}_X) \otimes_k k' \to H^q(X_{k'}, \mathcal{O}_{X_{k'}})$
is an isomorphism by flat base change
(Cohomology of Schemes,
Lemma \ref{coherent-lemma-flat-base-change-cohomology}).
\end{proof}





\section{Picard groups of curves}
\label{section-pic-curves}

\noindent
Our next step is to use the Kummer sequence to deduce some information
about the cohomology group of a curve with finite coefficients. In order
to get vanishing in the long exact sequence, we review some facts about
Picard groups.

\medskip\noindent
Let $X$ be a smooth projective curve over an algebraically closed field $k$.
There exists a short exact sequence
$$
0\to \text{Pic}^0(X) \to \text{Pic}(X)\xrightarrow{\deg} \mathbf{Z} \to 0.
$$
The abelian group $\text{Pic}^0(X)$ can be identified with $\text{Pic}^0(X) =
\underline{\text{Pic}}^0_{X/k}(k)$, i.e., the $k$-valued points of an
abelian variety $\underline{\text{Pic}}^0_{X/k}$ of dimension $g=g(X)$ over
$k$.

\begin{definition}
\label{definition-abelian-variety}
Let $k$ be a field. An {\it abelian variety} is a group scheme over
$k$ which is also a proper variety over $k$.
\end{definition}

\begin{proposition}
\label{proposition-review-abelian-varieties}
Let $A$ be an abelian variety over an algebraically closed field $k$. Then
\begin{enumerate}
\item
$A$ is projective over $k$;
\item
$A$ is a commutative group scheme;
\item
the morphism $[n]: A\to A$ is surjective for all $n\geq 1$, in other words
$A(k)$ is a divisible abelian group;
\item
$A[n] = \Ker(A\xrightarrow{[n]} A)$ is a finite flat group scheme of rank
$n^{2\dim A}$ over $k$. It is reduced if and only if $n\in k^*$;
\item
if $n\in k^*$ then $A(k)[n] = A[n](k)\cong(\mathbf{Z}/n\mathbf{Z})^{2\dim(A)}$.
\end{enumerate}
\end{proposition}

\begin{proof}
See Mumford's book on abelian varieties, \cite{AVar}.
\end{proof}

\noindent
Consequently, if $n\in k^*$ then $\text{Pic}^0(X)[n] \cong
\left(\mathbf{Z}/n\mathbf{Z}\right)^{2g}$ as abelian groups.

\begin{lemma}
\label{lemma-cohomology-smooth-projective-curve}
Let $X$ be a smooth projective curve of genus $g$ over an
algebraically closed field $k$ and let $n \geq 1$ be invertible in $k$.
Then there are canonical identifications
$$
H_\etale^q(X, \mu_n) =
\left\{
\begin{matrix}
\mu_n(k) & \text{ if $q=0$ ;} \\
\text{Pic}^0(X)[n] & \text{ if $q=1$ ;} \\
\mathbf{Z}/n\mathbf{Z} & \text{ if $q=2$ ;}\\
0 & \text{ if $q \geq 3$.}
\end{matrix}
\right.
$$
Since $\mu_n \cong \underline{\mathbf{Z}/n\mathbf{Z}}$, this gives
(noncanonical) identifications
$$
H_\etale^q(X, \underline{\mathbf{Z}/n\mathbf{Z}}) \cong
\left\{
\begin{matrix}
\mathbf{Z}/n\mathbf{Z} & \text{ if $q=0$ ;} \\
(\mathbf{Z}/n\mathbf{Z})^{2g} & \text{ if $q=1$ ;} \\
\mathbf{Z}/n\mathbf{Z} & \text{ if $q=2$ ;}\\
0 & \text{ if $q \geq 3$.}
\end{matrix}
\right.
$$
\end{lemma}

\begin{proof}
The Kummer sequence $0\to \mu_{n, X} \to \mathbf{G}_{m, X}
\xrightarrow{(\cdot)^n} \mathbf{G}_{m, X}\to 0$ give the long exact cohomology
sequence
$$
\xymatrix{
0 \ar[r] & \mu_n(k) \ar[r] &
k^* \ar^{(\cdot)^n}[r] &
k^* \ar@(rd, ul)[rdllllr] \\
& H_\etale^1(X, \mu_n) \ar[r] &
\text{Pic}(X) \ar^{(\cdot)^n}[r] &
\text{Pic} (X) \ar@(rd, ul)[rdllllr] \\
& H_\etale^2(X, \mu_n) \ar[r] & 0 \ar[r] & 0 \cdots
}
$$
The $n$ power map $k^* \to k^*$ is surjective since $k$ is algebraically
closed. So we need to compute the kernel and cokernel of the map $\text{Pic}(X)
\xrightarrow{(\cdot)^n} \text{Pic}(X)$. Consider the commutative diagram with
exact rows
$$
\xymatrix{
0 \ar[r] & {\text{Pic}^0(X)} \ar[r] \ar^{(\cdot)^n}@{>>}[d] & {\text{Pic}(X)}
\ar^{\ \ \deg}[r] \ar^{(\cdot)^n}[d] & {\mathbf{Z}} \ar[r] \ar^{n}@{^{(}->}[d]
& 0\\
0 \ar[r] & {\text{Pic}^0(X)} \ar[r] & {\text{Pic}(X)} \ar^{\ \ \deg}[r] &
{\mathbf{Z}} \ar[r] & 0
}
$$
where the left vertical map is surjective by
Proposition \ref{proposition-review-abelian-varieties} (3).
Applying the snake lemma gives the desired identifications.
\end{proof}

\begin{lemma}
\label{lemma-vanishing-cohomology-mu-smooth-curve}
Let $X$ be an affine smooth curve over an algebraically closed field $k$ and
$n\in k^*$. Then
\begin{enumerate}
\item
$H_\etale^0(X, \mu_n) = \mu_n(k)$;
\item
$H_\etale^1(X, \mu_n) \cong
\left(\mathbf{Z}/n\mathbf{Z}\right)^{2g+r-1}$, where
$r$ is the number of points in $\bar X - X$ for some smooth projective
compactification $\bar X$ of $X$ ; and
\item
for all $q\geq 2$, $H_\etale^q(X, \mu_n) = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
Write $X = \bar X - \{ x_1, \dots, x_r\}$. Then $\text{Pic}(X) =
\text{Pic}(\bar X)/ R$, where $R$ is the subgroup generated by
$\mathcal{O}_{\bar X}(x_i)$, $1 \leq i \leq r$. Since $r \geq 1$, we see that
$\text{Pic}^0(X) \to \text{Pic}(X)$ is surjective, hence $\text{Pic}(X)$ is
divisible. Applying the Kummer sequence, we get (1) and (3). For (2), recall
that
\begin{eqnarray*}
H_\etale^1(X, \mu_n) & = &
\left\{
(\mathcal L, \alpha) | \mathcal L \in \text{Pic}(X),
\alpha: \mathcal{L}^{\otimes n} \cong \mathcal{O}_X
\right\}
{\bigg /} {\cong} \\
& = &
\left\{(\bar{\mathcal L}, \ D, \ \bar \alpha) \right\} {\big /} \tilde{R}
\end{eqnarray*}
where $\bar{\mathcal L} \in \text{Pic}^0(\bar X)$, $D$ is a divisor on $\bar X$
supported on $\left\{x_1, \cdots, x_r\right\}$ and $ \bar{\alpha}:
\bar{\mathcal L}^{\otimes n} \cong \mathcal{O}_{\bar{X}}(D)$ is an isomorphism.
Note that $D$ must have degree 0. Further $\tilde{R}$ is the subgroup of
triples of the form $(\mathcal{O}_{\bar X}(D'), n D', 1^{\otimes n})$ where
$D'$ is supported on $\left\{x_1, \cdots, x_r\right\}$ and has degree 0. Thus,
we get an exact sequence
$$
0 \longrightarrow
H_\etale^1(\bar X, \mu_n) \longrightarrow
H_\etale^1(X, \mu_n) \longrightarrow
\bigoplus_{i=1}^r \mathbf{Z}/n\mathbf{Z}
\xrightarrow{\ \sum\ }
\mathbf{Z}/n\mathbf{Z} \longrightarrow 0
$$
where the middle map sends the class of a triple $(\bar{ \mathcal L}, D, \bar
\alpha)$ with $D = \sum_{i=1}^r a_i (x_i)$ to the $r$-tuple $(a_i)_{i=1}^r$. It
now suffices to use
Lemma \ref{lemma-cohomology-smooth-projective-curve}
to count ranks.
\end{proof}

\begin{remark}
\label{remark-natural-proof}
The ``natural'' way to prove the previous corollary is to excise $X$ from $\bar
X$. This is possible, we just haven't developed that theory.
\end{remark}

\begin{remark}
\label{remark-normalize-H1-Gm}
Let $k$ be an algebraically closed field. Let $n$ be an integer prime to
the characteristic of $k$. Recall that
$$
\mathbf{G}_{m, k} = \mathbf{A}^1_k \setminus \{0\} =
\mathbf{P}^1_k \setminus \{0, \infty\}
$$
We claim there is a canonical isomorphism
$$
H^1_\etale(\mathbf{G}_{m, k}, \mu_n) = \mathbf{Z}/n\mathbf{Z}
$$
What does this mean? This means there is an element $1_k$ in
$H^1_\etale(\mathbf{G}_{m, k}, \mu_n)$ such that for
every morphism $\Spec(k') \to \Spec(k)$ the pullback map on
\'etale cohomology for the map $\mathbf{G}_{m, k'} \to \mathbf{G}_{m, k}$
maps $1_k$ to $1_{k'}$. (In particular this element is
fixed under all automorphisms of $k$.) To see this, consider the
$\mu_{n, \mathbf{Z}}$-torsor
$\mathbf{G}_{m, \mathbf{Z}} \to \mathbf{G}_{m, \mathbf{Z}}$,
$x \mapsto x^n$. By the indentification of torsors with
first cohomology, this pulls back to give our canonical elements $1_k$.
Twisting back we see that there are canonical identifications
$$
H^1_\etale(\mathbf{G}_{m, k}, \mathbf{Z}/n\mathbf{Z}) =
\Hom(\mu_n(k), \mathbf{Z}/n\mathbf{Z}),
$$
i.e., these isomorphisms are compatible with respect to maps of
algebraically closed fields, in particular with respect to
automorphisms of $k$.
\end{remark}










\section{Extension by zero}
\label{section-extension-by-zero}

\noindent
The general material in
Modules on Sites, Section \ref{sites-modules-section-localize}
allows us to make the following definition.

\begin{definition}
\label{definition-extension-zero}
Let $j : U \to X$ be an \'etale morphism of schemes.
\begin{enumerate}
\item The restriction functor
$j^{-1} : \Sh(X_\etale) \to \Sh(U_\etale)$
has a left adjoint
$j_!^{Sh} : \Sh(X_\etale) \to \Sh(U_\etale)$.
\item The restriction functor
$j^{-1} : \textit{Ab}(X_\etale) \to \textit{Ab}(U_\etale)$
has a left adjoint which is denoted
$j_! : \textit{Ab}(U_\etale) \to \textit{Ab}(X_\etale)$
and called {\it extension by zero}.
\item Let $\Lambda$ be a ring. The restriction functor
$j^{-1} : \textit{Mod}(X_\etale, \Lambda) \to
\textit{Mod}(U_\etale, \Lambda)$
has a left adjoint which is denoted
$j_! : \textit{Mod}(U_\etale, \Lambda) \to
\textit{Mod}(X_\etale, \Lambda)$
and called {\it extension by zero}.
\end{enumerate}
\end{definition}

\noindent
If $\mathcal{F}$ is an abelian sheaf on $X_\etale$, then
$j_!\mathcal{F} \not = j_!^{Sh}\mathcal{F}$ in general. On the other hand
$j_!$ for sheaves of $\Lambda$-modules agrees with $j_!$ on underlying
abelian sheaves
(Modules on Sites, Remark \ref{sites-modules-remark-localize-shriek-equal}).
The functor $j_!$ is characterized by the functorial isomorphism
$$
\Hom_X(j_!\mathcal{F}, \mathcal{G}) = \Hom_U(\mathcal{F}, j^{-1}\mathcal{G})
$$
for all $\mathcal{F} \in \textit{Ab}(U_\etale)$ and
$\mathcal{G} \in \textit{Ab}(X_\etale)$. Similarly for
sheaves of $\Lambda$-modules.

\medskip\noindent
To describe it more explicitly, recall that $j^{-1}$ is just the restriction
via the functor $U_\etale \to X_\etale$. In other words,
$j^{-1}\mathcal{G}(U') = \mathcal{G}(U')$ for $U'$ \'etale over $U$.
For $\mathcal{F} \in \textit{Ab}(U_\etale)$
we consider the presheaf
$$
j_!^{PSh}\mathcal{F} : X_\etale \longrightarrow \textit{Ab},
\quad
V \longmapsto \bigoplus\nolimits_{V \to U} \mathcal{F}(V)
$$
Then $j_!\mathcal{F}$ is the sheafification of $j_!^{PSh}\mathcal{F}$.

\begin{exercise}
\label{exercise-jshriek-direct}
Prove directly that $j_!$ is left adjoint to $j^{-1}$ and that $j_*$ is right
adjoint to $j^{-1}$.
\end{exercise}

\begin{proposition}
\label{proposition-describe-jshriek}
Let $j : U \to X$ be an \'etale morphism of schemes.
Let $\mathcal{F}$ in $\textit{Ab}(U_\etale)$.
If $\overline{x} : \Spec(k) \to X$ is a geometric point of $X$, then 
$$
(j_!\mathcal{F})_{\overline{x}} =
\bigoplus\nolimits_{\overline{u} : \Spec(k) \to U,\ f(\overline{u}) =
\overline{x}} \mathcal{F}_{\bar{u}}.
$$
In particular, $j_!$ is an exact functor.
\end{proposition}

\begin{proof}
Exactness of $j_!$ is very general, see Modules on Sites, 
Lemma \ref{sites-modules-lemma-extension-by-zero-exact}.
Of course it does also follow from the description of stalks.
The formula for the stalk of $j_!\mathcal{F}$ can be deduced
directly from the explicit description of $j_!$ given above.
On the other hand, we can deduce it from the very general
Modules on Sites, Lemma \ref{sites-modules-lemma-stalk-j-shriek}
and the description of points of the small \'etale site
in terms of geometric points, see
Lemma \ref{lemma-points-small-etale-site}.
\end{proof}

\begin{lemma}[Extension by zero commutes with base change]
\label{lemma-shriek-base-change}
Let $f: Y \to X$ be a morphism of schemes. Let $j: V \to X$ be an \'etale
morphism. Consider the fibre product
$$
\xymatrix{
V' = Y \times_X V \ar[d]_{f'} \ar[r]_-{j'} & Y \ar[d]^f \\
V \ar[r]^j & X
}
$$
Then we have $j'_! f'^{-1} = f^{-1} j_!$ on abelian sheaves and on
sheaves of modules.
\end{lemma}

\begin{proof}
This is true because $j'_! f'^{-1}$ is left adjoint to
$f'_* (j')^{-1}$ and $f^{-1} j_!$ is left adjoint to $j^{-1}f_*$.
Further $f'_* (j')^{-1} = j^{-1}f_*$ because $f_*$ commutes with
\'etale localization (by construction). In fact, the lemma holds very generally
in the setting of a morphism of sites, see
Modules on Sites, Lemma
\ref{sites-modules-lemma-localize-morphism-ringed-sites}.
\end{proof}

\begin{lemma}
\label{lemma-shriek-equals-star-finite-etale}
Let $j : U \to X$ be finite and \'etale. Then $j_! = j_*$
on abelian sheaves and sheaves of $\Lambda$-modules.
\end{lemma}

\begin{proof}
We prove this in the case of abelian sheaves.
By Modules on Sites, Remark \ref{sites-modules-remark-from-shriek-to-star}
there is a natural transformation $j_! \to j_*$.
It suffices to check this is an isomorphism \'etale locally
on $X$. Thus we may assume $U \to X$ is a finite disjoint union
of isomorphisms, see
\'Etale Morphisms, Lemma \ref{etale-lemma-finite-etale-etale-local}.
We omit the proof in this case.
\end{proof}

\begin{lemma}
\label{lemma-ses-associated-to-open}
Let $X$ be a scheme. Let $Z \subset X$ be a closed subscheme and let
$U \subset X$ be the complement. Denote $i : Z \to X$ and $j : U \to X$
the inclusion morphisms. For every abelian sheaf on $X_\etale$
there is a canonical short exact sequence
$$
0 \to j_!j^{-1}\mathcal{F} \to \mathcal{F} \to i_*i^{-1}\mathcal{F} \to 0
$$
on $X_\etale$.
\end{lemma}

\begin{proof}
We obtain the maps by the adjointness properties of the functors
involved. For a geometric point $\overline{x}$ in $X$ we have either
$\overline{x} \in U$ in which case the map on the left hand side
is an isomorphism on stalks and the stalk of $i_*i^{-1}\mathcal{F}$
is zero or $\overline{x} \in Z$ in which case the map on the right hand side
is an isomorphism on stalks and the stalk of $j_!j^{-1}\mathcal{F}$
is zero. Here we have used the description of stalks of
Lemma \ref{lemma-stalk-pushforward-closed-immersion} and
Proposition \ref{proposition-describe-jshriek}.
\end{proof}








\section{Locally constant sheaves}
\label{section-locally-constant}

\noindent
This section is the analogue of
Modules on Sites, Section \ref{sites-modules-section-locally-constant}
for the \'etale site.

\begin{definition}
\label{definition-finite-locally-constant}
Let $X$ be a scheme.
Let $\mathcal{F}$ be a sheaf of sets on $X_\etale$.
\begin{enumerate}
\item Let $E$ be a set. We say $\mathcal{F}$ is the
{\it constant sheaf with value $E$} if $\mathcal{F}$ is the
sheafification of the presheaf $U \mapsto E$.
Notation: $\underline{E}_X$ or $\underline{E}$.
\item We say $\mathcal{F}$ is a {\it constant sheaf} if it is
isomorphic to a sheaf as in (1).
\item We say $\mathcal{F}$ is {\it locally constant} if there exists a
covering $\{U_i \to X\}$ such that $\mathcal{F}|_{U_i}$ is a constant sheaf.
\item We say that $\mathcal{F}$ is {\it finite locally constant} if it
is locally constant and the values are finite sets.
\end{enumerate}
Let $\mathcal{F}$ be a sheaf of abelian groups on $X_\etale$.
\begin{enumerate}
\item Let $A$ be an abelian group.
We say $\mathcal{F}$ is the {\it constant sheaf with value $A$} if
$\mathcal{F}$ is the sheafification of the presheaf $U \mapsto A$.
Notation: $\underline{A}_X$ or $\underline{A}$.
\item We say $\mathcal{F}$ is a {\it constant sheaf} if it is isomorphic
as an abelian sheaf to a sheaf as in (1).
\item We say $\mathcal{F}$ is {\it locally constant} if there exists a
covering $\{U_i \to X\}$ such that $\mathcal{F}|_{U_i}$ is a constant sheaf.
\item We say that $\mathcal{F}$ is {\it finite locally constant} if it
is locally constant and the values are finite abelian groups.
\end{enumerate}
Let $\Lambda$ be a ring. Let $\mathcal{F}$ be a sheaf of $\Lambda$-modules
on $X_\etale$.
\begin{enumerate}
\item Let $M$ be a $\Lambda$-module.
We say $\mathcal{F}$ is the {\it constant sheaf with value $M$} if
$\mathcal{F}$ is the sheafification of the presheaf $U \mapsto M$.
Notation: $\underline{M}_X$ or $\underline{M}$.
\item We say $\mathcal{F}$ is a {\it constant sheaf} if it is isomorphic
as a sheaf of $\Lambda$-modules to a sheaf as in (1).
\item We say $\mathcal{F}$ is {\it locally constant} if there exists a
covering $\{U_i \to X\}$ such that $\mathcal{F}|_{U_i}$ is a constant sheaf.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-pullback-locally-constant}
Let $f : X \to Y$ be a morphism of schemes. If $\mathcal{G}$ is a
locally constant sheaf of sets, abelian groups, or $\Lambda$-modules
on $Y_\etale$, the same is true for $f^{-1}\mathcal{G}$
on $X_\etale$.
\end{lemma}

\begin{proof}
Holds for any morphism of topoi, see
Modules on Sites, Lemma \ref{sites-modules-lemma-pullback-locally-constant}.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-locally-constant}
Let $f : X \to Y$ be a finite \'etale morphism of schemes.
If $\mathcal{F}$ is a (finite) locally constant sheaf of sets,
(finite) locally constant sheaf of abelian groups, or
(finite type) locally constant sheaf of $\Lambda$-modules
on $X_\etale$, the same is true for $f_*\mathcal{F}$
on $Y_\etale$.
\end{lemma}

\begin{proof}
The construction of $f_*$ commutes with \'etale localization.
A finite \'etale morphism is locally isomorphic to a disjoint union
of isomorphisms, see
\'Etale Morphisms, Lemma \ref{etale-lemma-finite-etale-etale-local}.
Thus the lemma says that if $\mathcal{F}_i$, $i = 1, \ldots, n$
are (finite) locally constant sheaves of sets, then
$\prod_{i = 1, \ldots, n} \mathcal{F}_i$ is too.
This is clear. Similarly for sheaves of abelian groups and modules.
\end{proof}

\begin{lemma}
\label{lemma-characterize-finite-locally-constant}
Let $X$ be a scheme and $\mathcal{F}$ a sheaf of sets on $X_\etale$.
Then the following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is finite locally constant, and
\item $\mathcal{F} = h_U$ for some finite \'etale morphism $U \to X$.
\end{enumerate}
\end{lemma}

\begin{proof}
A finite \'etale morphism is locally isomorphic to a disjoint union
of isomorphisms, see
\'Etale Morphisms, Lemma \ref{etale-lemma-finite-etale-etale-local}.
Thus (2) implies (1). Conversely, if $\mathcal{F}$ is finite locally
constant, then there exists an \'etale covering $\{X_i \to X\}$ such that
$\mathcal{F}|_{X_i}$ is representable by $U_i \to X_i$ finite \'etale.
Arguing exactly as in the proof of
Descent, Lemma \ref{descent-lemma-descent-data-sheaves}
we obtain a descent datum for schemes $(U_i, \varphi_{ij})$ relative to
$\{X_i \to X\}$ (details omitted). This descent datum is effective for
example by Descent, Lemma \ref{descent-lemma-affine}
and the resulting morphism of schemes $U \to X$ is finite \'etale
by Descent, Lemmas \ref{descent-lemma-descending-property-finite} and
\ref{descent-lemma-descending-property-etale}.
\end{proof}

\begin{lemma}
\label{lemma-morphism-locally-constant}
Let $X$ be a scheme.
\begin{enumerate}
\item Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a map
of locally constant sheaves of sets on $X_\etale$.
If $\mathcal{F}$ is finite locally constant, there exists an
\'etale covering $\{U_i \to X\}$ such that
$\varphi|_{U_i}$ is the map of constant sheaves associated to
a map of sets.
\item Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a map
of locally constant sheaves of abelian groups on $X_\etale$.
If $\mathcal{F}$ is finite locally constant, there exists an \'etale
covering $\{U_i \to X\}$ such that $\varphi|_{U_i}$ is the map of
constant abelian sheaves associated to a map of abelian groups.
\item Let $\Lambda$ be a ring.
Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a map
of locally constant sheaves of $\Lambda$-modules on $X_\etale$.
If $\mathcal{F}$ is of finite type, then there exists an \'etale covering
$\{U_i \to X\}$ such that $\varphi|_{U_i}$ is the map of constant
sheaves of $\Lambda$-modules associated to a map of $\Lambda$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
This holds on any site, see
Modules on Sites, Lemma \ref{sites-modules-lemma-morphism-locally-constant}.
\end{proof}

\begin{lemma}
\label{lemma-kernel-finite-locally-constant}
Let $X$ be a scheme.
\begin{enumerate}
\item The category of finite locally constant sheaves of sets
is closed under finite limits and colimits inside $\Sh(X_\etale)$.
\item The category of finite locally constant abelian sheaves is a
weak Serre subcategory of $\textit{Ab}(X_\etale)$.
\item Let $\Lambda$ be a Noetherian ring. The category of
finite type, locally constant sheaves of $\Lambda$-modules on
$X_\etale$ is a weak Serre subcategory of
$\textit{Mod}(X_\etale, \Lambda)$.
\end{enumerate}
\end{lemma}

\begin{proof}
This holds on any site, see
Modules on Sites, Lemma
\ref{sites-modules-lemma-kernel-finite-locally-constant}.
\end{proof}

\begin{lemma}
\label{lemma-tensor-product-locally-constant}
Let $X$ be a scheme. Let $\Lambda$ be a ring.
The tensor product of two locally constant sheaves of $\Lambda$-modules
on $X_\etale$ is a locally constant sheaf of $\Lambda$-modules.
\end{lemma}

\begin{proof}
This holds on any site, see
Modules on Sites, Lemma
\ref{sites-modules-lemma-tensor-product-locally-constant}.
\end{proof}

\begin{lemma}
\label{lemma-connected-locally-constant}
Let $X$ be a connected scheme. Let $\Lambda$ be a ring and let
$\mathcal{F}$ be a locally constant sheaf of $\Lambda$-modules.
Then there exists a $\Lambda$-module $M$ and an \'etale covering
$\{U_i \to X\}$ such that $\mathcal{F}|_{U_i} \cong \underline{M}|_{U_i}$.
\end{lemma}

\begin{proof}
Choose an \'etale covering
$\{U_i \to X\}$ such that $\mathcal{F}|_{U_i}$ is constant, say
$\mathcal{F}|_{U_i} \cong \underline{M_i}_{U_i}$.
Observe that $U_i \times_X U_j$ is empty if $M_i$ is not isomorphic
to $M_j$.
For each $\Lambda$-module $M$ let $I_M = \{i \in I \mid M_i \cong M\}$.
As \'etale morphisms are open we see that
$U_M = \bigcup_{i \in I_M} \Im(U_i \to X)$
is an open subset of $X$. Then $X = \coprod U_M$ is a disjoint
open covering of $X$. As $X$ is connected only one $U_M$ is nonempty
and the lemma follows.
\end{proof}




\section{Constructible sheaves}
\label{section-constructible}

\noindent
Let $X$ be a scheme. A {\it constructible locally closed subscheme} of $X$
is a locally closed subscheme $T \subset X$ such that the underlying
topological space of $T$ is a constructible subset of $X$.
If $T, T' \subset X$ are locally
closed subschemes with the same underlying topological space, then
$T_\etale \cong T'_\etale$ by the topological
invariance of the \'etale site (Theorem \ref{theorem-topological-invariance}).
Thus in the following definition we may assume are locally closed
subschemes are reduced.

\begin{definition}
\label{definition-constructible}
Let $X$ be a scheme.
\begin{enumerate}
\item A sheaf of sets on $X_\etale$ is {\it constructible}
if for every affine open $U \subset X$ there exists a finite decomposition
of $U$ into constructible locally closed subschemes $U = \coprod_i U_i$
such that $\mathcal{F}|_{U_i}$ is finite locally constant for all $i$.
\item A sheaf of abelian groups on $X_\etale$ is {\it constructible}
if for every affine open $U \subset X$ there exists a finite decomposition
of $U$ into constructible locally closed subschemes $U = \coprod_i U_i$
such that $\mathcal{F}|_{U_i}$ is finite locally constant for all $i$.
\item Let $\Lambda$ be a Noetherian ring. A sheaf of $\Lambda$-modules
on $X_\etale$ is {\it constructible} if for every affine open
$U \subset X$ there exists a finite decomposition
of $U$ into constructible locally closed subschemes
$U = \coprod_i U_i$ such that
$\mathcal{F}|_{U_i}$ is of finite type and locally constant for all $i$.
\end{enumerate}
\end{definition}

\noindent
It seems that this is the accepted definition. An alternative, which lends
itself more readily to generalizations beyond the \'etale site of a scheme,
would have been to define constructible sheaves by starting with
$h_U$, $j_{U!}\mathbf{Z}/n\mathbf{Z}$, and $j_{U!}\underline{\Lambda}$
where $U$ runs over all quasi-compact and quasi-separated objects
of $X_\etale$, and then take the smallest full subcategory of
$\Sh(X_\etale)$, $\textit{Ab}(X_\etale)$, and
$\textit{Mod}(X_\etale, \underline{\Lambda})$ containing these
and closed under finite limits and colimits. It follows from
Lemma \ref{lemma-constructible-abelian}
and
Lemmas \ref{lemma-category-constructible-sets},
\ref{lemma-category-constructible-abelian}, and
\ref{lemma-category-constructible-modules}
that this produces the same category if $X$ is quasi-compact and
quasi-separated. In general this does not produce the same
category however.

\medskip\noindent
A disjoint union decomposition $U = \coprod U_i$ of a scheme by
locally closed subschemes will be called a {\it partition} of $U$
(compare with Topology, Section \ref{topology-section-stratifications}).

\begin{lemma}
\label{lemma-constructible-quasi-compact-quasi-separated}
Let $X$ be a quasi-compact and quasi-separated scheme. Let $\mathcal{F}$
be a sheaf of sets on $X_\etale$. The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is constructible,
\item there exists an open covering $X = \bigcup U_i$ such that
$\mathcal{F}|_{U_i}$ is constructible, and
\item there exists a partition $X = \bigcup X_i$ by constructible
locally closed subschemes such that $\mathcal{F}|_{X_i}$ is finite
locally constant.
\end{enumerate}
A similar statement holds for abelian sheaves and sheaves of
$\Lambda$-modules if $\Lambda$ is Noetherian.
\end{lemma}

\begin{proof}
It is clear that (1) implies (2).

\medskip\noindent
Assume (2). For every $x \in X$ we can find an $i$ and an affine open
neighbourhood $V_x \subset U_i$ of $x$. Hence we can find a finite
affine open covering $X = \bigcup V_j$ such that for each $j$ there
exists a finite decomposition $V_j = \coprod V_{j, k}$ by locally closed
constructible subsets such that $\mathcal{F}|_{V_{j, k}}$ is finite
locally constant. By Topology, Lemma
\ref{topology-lemma-quasi-compact-open-immersion-constructible-image}
each $V_{j, k}$ is constructible as a subset of $X$.
By Topology, Lemma
\ref{topology-lemma-constructible-partition-refined-by-stratification}
we can find a finite stratification $X = \coprod X_l$ with constructible
locally closed strata such that each
$V_{j, k}$ is a union of $X_l$. Thus (3) holds.

\medskip\noindent
Assume (3) holds. Let $U \subset X$ be an affine open.
Then $U \cap X_i$ is a constructible locally closed subset of $U$
(for example by Properties, Lemma \ref{properties-lemma-locally-constructible})
and $U = \coprod U \cap X_i$ is a partition of $U$ as in
Definition \ref{definition-constructible}. Thus (1) holds.
\end{proof}

\begin{lemma}
\label{lemma-constructible-constructible}
Let $X$ be a quasi-compact and quasi-separated scheme.
Let $\mathcal{F}$ be a sheaf of sets, abelian groups,
$\Lambda$-modules (with $\Lambda$ Noetherian) on $X_\etale$.
If there exist constructible locally closed subschemes $T_i \subset X$
such that (a) $X = \bigcup T_j$ and (b) $\mathcal{F}|_{T_j}$ is
constructible, then $\mathcal{F}$ is constructible.
\end{lemma}

\begin{proof}
First, we can assume the covering is finite as $X$ is quasi-compact
in the spectral topology
(Topology, Lemma \ref{topology-lemma-constructible-hausdorff-quasi-compact}
and
Properties, Lemma
\ref{properties-lemma-quasi-compact-quasi-separated-spectral}).
Observe that each $T_i$ is a quasi-compact and quasi-separated
scheme in its own right (because it is constructible in $X$; details omitted).
Thus we can find a finite partition $T_i = \coprod T_{i, j}$ into
locally closed constructible parts of $T_i$ such that
$\mathcal{F}|_{T_{i, j}}$ is finite locally constant
(Lemma \ref{lemma-constructible-quasi-compact-quasi-separated}).
By Topology, Lemma \ref{topology-lemma-constructible-in-constructible}
we see that $T_{i, j}$ is a constructible locally closed subscheme of $X$.
Then we can apply Topology, Lemma
\ref{topology-lemma-constructible-partition-refined-by-stratification}
to $X = \bigcup T_{i, j}$ to find the desired partition of $X$.
\end{proof}

\begin{lemma}
\label{lemma-constructible-local}
Let $X$ be a scheme. Checking constructibility of a sheaf
of sets, abelian groups, $\Lambda$-modules (with $\Lambda$ Noetherian)
can be done Zariski locally on $X$.
\end{lemma}

\begin{proof}
The statement means if $X = \bigcup U_i$ is an open covering
such that $\mathcal{F}|_{U_i}$ is constructible, then $\mathcal{F}$
is constructible. If $U \subset X$ is affine open, then
$U = \bigcup U \cap U_i$ and $\mathcal{F}|_{U \cap U_i}$ is constructible
(it is trivial that the restriction of a constructible sheaf to
an open is constructible). It follows from
Lemma \ref{lemma-constructible-quasi-compact-quasi-separated}
that $\mathcal{F}|_U$ is constructible, i.e., a suitable partition
of $U$ exists.
\end{proof}

\begin{lemma}
\label{lemma-pullback-constructible}
Let $f : X \to Y$ be a morphism of schemes. If $\mathcal{F}$ is a
constructible sheaf of sets, abelian groups, or $\Lambda$-modules
(with $\Lambda$ Noetherian) on $Y_\etale$, the same
is true for $f^{-1}\mathcal{F}$ on $X_\etale$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-constructible-local} this reduces to the case
where $X$ and $Y$ are affine. By
Lemma \ref{lemma-constructible-quasi-compact-quasi-separated}
it suffices to find a finite partition of $X$ by constructible
locally closed subschemes such that $f^{-1}\mathcal{F}$ is finite locally
constant on each of them.
To find it we just pull back the partition of $Y$ adapted to
$\mathcal{F}$ and use
Lemma \ref{lemma-pullback-locally-constant}.
\end{proof}

\begin{lemma}
\label{lemma-constructible-abelian}
Let $X$ be a scheme.
\begin{enumerate}
\item The category of constructible sheaves of sets
is closed under finite limits and colimits inside $\Sh(X_\etale)$.
\item The category of constructible abelian sheaves is a
weak Serre subcategory of $\textit{Ab}(X_\etale)$.
\item Let $\Lambda$ be a Noetherian ring. The category of
constructible sheaves of $\Lambda$-modules on
$X_\etale$ is a weak Serre subcategory of
$\textit{Mod}(X_\etale, \Lambda)$.
\end{enumerate}
\end{lemma}

\begin{proof}
We prove (3). We will use the criterion of
Homology, Lemma \ref{homology-lemma-characterize-weak-serre-subcategory}.
Suppose that $\varphi : \mathcal{F} \to \mathcal{G}$
is a map of constructible sheaves of $\Lambda$-modules.
We have to show that $\mathcal{K} = \Ker(\varphi)$ and
$\mathcal{Q} = \Coker(\varphi)$ are constructible. 
Similarly, suppose that
$0 \to \mathcal{F} \to \mathcal{E} \to \mathcal{G} \to 0$
is a short exact sequence of sheaves of $\Lambda$-modules
with $\mathcal{F}$, $\mathcal{G}$ constructible. We have to show
that $\mathcal{E}$ is constructible.
In both cases we can replace $X$ with the members of an
affine open covering. Hence we may assume $X$ is affine.
The we may further replace $X$ by the members of a finite
partition of $X$ by constructible locally closed subschemes
on which $\mathcal{F}$ and $\mathcal{G}$ are of finite type and
locally constant. Thus we may apply
Lemma \ref{lemma-kernel-finite-locally-constant} to conclude.

\medskip\noindent
The proofs of (1) and (2) are very similar and are omitted.
\end{proof}

\begin{lemma}
\label{lemma-tensor-product-constructible}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
The tensor product of two constructible sheaves of $\Lambda$-modules
on $X_\etale$ is a constructible sheaf of $\Lambda$-modules.
\end{lemma}

\begin{proof}
The question immediately reduces to the case where $X$ is affine.
Since any two partitions of $X$ with constructible locally
closed strata have a common refinement of the same type and
since pullbacks commute with tensor product we reduce to
Lemma \ref{lemma-tensor-product-locally-constant}.
\end{proof}

\begin{lemma}
\label{lemma-support-constructible}
Let $X$ be a quasi-compact and quasi-separated scheme.
\begin{enumerate}
\item Let $\mathcal{F} \to \mathcal{G}$ be a map of constructible
sheaves of sets on $X_\etale$. Then the set of points $x \in X$
where $\mathcal{F}_{\overline{x}} \to \mathcal{F}_{\overline{x}}$
is surjective, resp.\ injective, resp.\ is isomorphic to a given map
of sets, is constructible in $X$.
\item Let $\mathcal{F}$ be a constructible abelian sheaf on $X_\etale$.
The support of $\mathcal{F}$ is constructible.
\item Let $\Lambda$ be a Noetherian ring.
Let $\mathcal{F}$ be a constructible sheaf of $\Lambda$-modules on $X_\etale$.
The support of $\mathcal{F}$ is constructible.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1).
Let $X = \coprod X_i$ be a partion of $X$ by locally closed constructible
subschemes such that both $\mathcal{F}$ and $\mathcal{G}$ are
finite locally constant over the parts (use
Lemma \ref{lemma-constructible-quasi-compact-quasi-separated}
for both $\mathcal{F}$ and $\mathcal{G}$ and choose a common
refinement). Then apply Lemma \ref{lemma-morphism-locally-constant}
to the restriction of the map to each part.

\medskip\noindent
The proof of (2) and (3) is omitted.
\end{proof}

\noindent
The following lemma will turn out to be very useful later on.
It roughly says that the category of constructible sheaves
has a kind of weak ``Noetherian'' property.

\begin{lemma}
\label{lemma-colimit-constructible}
Let $X$ be a quasi-compact and quasi-separated scheme. Let
$\mathcal{F} = \colim_{i \in I} \mathcal{F}_i$ be a filtered
colimit of sheaves of sets, abelian sheaves, or sheaves of modules.
\begin{enumerate}
\item If $\mathcal{F}$ and $\mathcal{F}_i$ are constructible sheaves of
sets, then the ind-object $\mathcal{F}_i$ is essentially constant with
value $\mathcal{F}$.
\item If $\mathcal{F}$ and $\mathcal{F}_i$ are constructible sheaves of
abelian groups, then the ind-object $\mathcal{F}_i$ is essentially constant
with value $\mathcal{F}$.
\item Let $\Lambda$ be a Noetherian ring.
If $\mathcal{F}$ and $\mathcal{F}_i$ are constructible sheaves of
$\Lambda$-modules, then the ind-object $\mathcal{F}_i$ is essentially constant
with value $\mathcal{F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). We will use without further mention that finite limits
and colimits of constructible sheaves are constructible
(Lemma \ref{lemma-kernel-finite-locally-constant}).
For each $i$ let $T_i \subset X$ be the set of points $x \in X$
where $\mathcal{F}_{i, \overline{x}} \to \mathcal{F}_{\overline{x}}$
is not surjective. Because $\mathcal{F}_i$ and $\mathcal{F}$ are
constructible $T_i$ is a constructible subset of $X$
(Lemma \ref{lemma-support-constructible}).
Since the stalks of $\mathcal{F}$ are finite
and since $\mathcal{F} = \colim_{i \in I} \mathcal{F}_i$ we see
that for all $x \in X$ we have $x \not \in T_i$ for $i$ large enough.
Since $X$ is a spectral space by Properties, Lemma
\ref{properties-lemma-quasi-compact-quasi-separated-spectral}
the constructible topology on $X$ is quasi-compact by
Topology, Lemma \ref{topology-lemma-constructible-hausdorff-quasi-compact}.
Thus $T_i = \emptyset$ for $i$ large enough. Thus
$\mathcal{F}_i \to \mathcal{F}$ is surjective for $i$ large enough.
Assume now that $\mathcal{F}_i \to \mathcal{F}$ is surjective for all $i$.
Choose $i \in I$. For $i' \geq i$ denote $S_{i'} \subset X$ the set of
points $x$ such that the number of elements in
$\Im(\mathcal{F}_{i, \overline{x}} \to \mathcal{F}_{\overline{x}})$
is equal to the number of elements in
$\Im(\mathcal{F}_{i, \overline{x}} \to \mathcal{F}_{i', \overline{x}})$.
Because $\mathcal{F}_i$, $\mathcal{F}_{i'}$ and $\mathcal{F}$ are
constructible $S_{i'}$ is a constructible subset of $X$
(details omitted; hint: use Lemma \ref{lemma-support-constructible}).
Since the stalks of $\mathcal{F}_i$ and $\mathcal{F}$
are finite and since $\mathcal{F} = \colim_{i' \geq i} \mathcal{F}_{i'}$
we see that for all $x \in X$ we have $x \not \in S_{i'}$ for $i'$
large enough. By the same argument as above we can find a large $i'$ such
that $S_{i'} = \emptyset$. Thus $\mathcal{F}_i \to \mathcal{F}_{i'}$
factors through $\mathcal{F}$ as desired.

\medskip\noindent
Proof of (2). Observe that a constructible abelian sheaf is a constructible
sheaf of sets. Thus case (2) follows from (1).

\medskip\noindent
Proof of (3). We will use without further mention that the category of
constructible sheaves of $\Lambda$-modules is abelian
(Lemma \ref{lemma-kernel-finite-locally-constant}).
For each $i$ let $\mathcal{Q}_i$ be the cokernel of the map
$\mathcal{F}_i \to \mathcal{F}$. The support $T_i$ of $\mathcal{Q}_i$
is a constructible subset of $X$ as $\mathcal{Q}_i$ is constructible
(Lemma \ref{lemma-support-constructible}).
Since the stalks of $\mathcal{F}$ are finite $\Lambda$-modules
and since $\mathcal{F} = \colim_{i \in I} \mathcal{F}_i$ we see
that for all $x \in X$ we have $x \not \in T_i$ for $i$ large enough.
Since $X$ is a spectral space by Properties, Lemma
\ref{properties-lemma-quasi-compact-quasi-separated-spectral}
the constructible topology on $X$ is quasi-compact by
Topology, Lemma \ref{topology-lemma-constructible-hausdorff-quasi-compact}.
Thus $T_i = \emptyset$ for $i$ large enough. This proves the first
assertion. For the second, assume now that
$\mathcal{F}_i \to \mathcal{F}$ is surjective for all $i$.
Choose $i \in I$. For $i' \geq i$ denote $\mathcal{K}_{i'}$ the
image of $\Ker(\mathcal{F}_i \to \mathcal{F})$ in $\mathcal{F}_{i'}$.
The support $S_{i'}$ of $\mathcal{K}_{i'}$
is a constructible subset of $X$ as $\mathcal{K}_{i'}$ is constructible.
Since the stalks of $\Ker(\mathcal{F}_i \to \mathcal{F})$
are finite $\Lambda$-modules and since
$\mathcal{F} = \colim_{i' \geq i} \mathcal{F}_{i'}$ we see
that for all $x \in X$ we have $x \not \in S_{i'}$ for $i'$ large enough.
By the same argument as above we can find a large $i'$ such
that $S_{i'} = \emptyset$. Thus $\mathcal{F}_i \to \mathcal{F}_{i'}$
factors through $\mathcal{F}$ as desired.
\end{proof}




\section{Auxiliary lemmas on morphisms}
\label{section-stratify-morphisms}

\noindent
Some lemmas that are useful for proving functioriality properties
of constructible sheaves.

\begin{lemma}
\label{lemma-etale-stratified-finite}
Let $U \to X$ be an \'etale morphism of quasi-compact and quasi-separated
schemes (for example an \'etale morphism of Noetherian schemes). Then there
exists a partition $X = \coprod_i X_i$ by constructible locally closed
subschemes such that $X_i \times_X U \to X_i$ is finite \'etale for all $i$.
\end{lemma}

\begin{proof}
If $U \to X$ is separated, then this is
More on Morphisms, Lemma \ref{more-morphisms-lemma-stratify-flat-fp-qf}.
In general, we may assume $X$ is affine. Choose a finite affine open
covering $U = \bigcup U_j$. Apply the previous case to all the morphisms
$U_j \to X$ and $U_j \cap U_{j'} \to X$ and choose a common
refinement $X = \coprod X_i$ of the resulting partitions.
After refining the partition further we may assume $X_i$ affine as well.
Fix $i$ and set $V = U \times_X X_i$. The morphisms
$V_j = U_j \times_X X_i \to X_i$ and
$V_{jj'} = (U_j \cap U_{j'}) \times_X X_i \to X_i$ are finite \'etale.
Hence $V_j$ and $V_{jj'}$ are affine schemes and $V_{jj'} \subset V_j$
is closed as well as open (since $V_{jj'} \to X_i$ is proper, so
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}
applies). Then $V = \bigcup V_j$ is separated because
$\mathcal{O}(V_j) \to \mathcal{O}(V_{jj'})$ is surjective, see
Schemes, Lemma \ref{schemes-lemma-characterize-separated}.
Thus the previous case applies to $V \to X_i$ and we can further
refine the partition if needed (it actually isn't but we don't
need this).
\end{proof}

\noindent
In the Noetherian case one can prove the preceding lemma by
Noetherian induction and the following amusing lemma.

\begin{lemma}
\label{lemma-generically-finite}
Let $f: X \to Y$ be a morphism of schemes which is quasi-compact,
quasi-separated, and locally of finite type. If $\eta$ is a generic point
of on irreducible component of $Y$ such that $f^{-1}(\eta)$ is finite, then
there exists an open $V \subset Y$ containing $\eta$ such that
$f^{-1}(V) \to V$ is finite.
\end{lemma}

\begin{proof}
This is Morphisms, Lemma \ref{morphisms-lemma-generically-finite}.
\end{proof}

\noindent
The statement of the following lemma can be strengthened a bit.

\begin{lemma}
\label{lemma-decompose-quasi-finite-morphism}
Let $f : Y \to X$ be a quasi-finite and finitely presented
morphism of affine schemes.
\begin{enumerate}
\item There exists a surjective morphism of affine schemes $X' \to X$ and a
closed subscheme $Z' \subset Y' = X' \times_X Y$ such that
\begin{enumerate}
\item $Z' \subset Y'$ is a thickening, and
\item $Z' \to X'$ is a finite \'etale morphism.
\end{enumerate}
\item There exists a finite partition $X = \coprod X_i$ by
locally closed, constructible, affine strata, and surjective finite locally
free morphisms $X'_i \to X_i$ such that the reduction of
$Y'_i = X'_i \times_X Y \to X'_i$ is isomorphic to
$\coprod_{j = 1}^{n_i} (X'_i)_{red} \to (X'_i)_{red}$ for some $n_i$.
\end{enumerate}
\end{lemma}

\begin{proof}
Setting $X' = \coprod X'_i$ we see that (2) implies (1).
Write $X = \Spec(A)$ and $Y = \Spec(B)$. Write $A$ as a filtered colimit
of finite type $\mathbf{Z}$-algebras $A_i$. Since $B$ is an $A$-algebra of
finite presentation, we see that there exists $0 \in I$ and a
finite type ring map $A_0 \to B_0$ such that $B = \colim B_i$ with
$B_i = A_i \otimes_{A_0} B_0$, see
Algebra, Lemma \ref{algebra-lemma-colimit-category-fp-algebras}.
For $i$ sufficiently large we see that $A_i \to B_i$ is
quasi-finite, see Limits, Lemma \ref{limits-lemma-descend-quasi-finite}.
Thus we reduce to the case of finite type algebras over $\mathbf{Z}$,
in particular we reduce to the Noetherian case. (Details omitted.)

\medskip\noindent
Assume $X$ and $Y$ Noetherian. In this case any locally closed
subset of $X$ is constructible. By Lemma \ref{lemma-generically-finite}
and Noetherian induction we see that
there is a finite partition $X = \coprod X_i$ of $X$
by locally closed strata such that $Y \times_X X_i \to X_i$ is finite.
We can refine this partition to get affine strata.
Thus after replacing $X$ by $X' = \coprod X_i$ we may assume
$Y \to X$ is finite.

\medskip\noindent
Assume $X$ and $Y$ Noetherian and $Y \to X$ finite.
Suppose that we can prove (2) after base change by a surjective,
flat, quasi-finite morphism $U \to X$. Thus we have a partition
$U = \coprod U_i$ and finite locally free morphisms $U'_i \to U_i$
such that $U'_i \times_X Y \to U'_i$ is isomorphic to
$\coprod_{j = 1}^{n_i} (U'_i)_{red} \to (U'_i)_{red}$ for some $n_i$.
Then, by the argument in the previous paragraph, we can find a
partition $X = \coprod X_j$ with locally closed affine strata such that
$X_j \times_X U_i \to X_j$ is finite for all $i, j$. By
Morphisms, Lemma \ref{morphisms-lemma-finite-flat}
each $X_j \times_X U_i \to X_j$ is finite locally free.
Hence $X_j \times_X U'_i \to X_j$ is finite locally free
(Morphisms, Lemma \ref{morphisms-lemma-composition-finite-locally-free}).
It follows that $X = \coprod X_j$ and $X_j' = \coprod_i X_j \times_X U'_i$
is a solution for $Y \to X$. Thus it suffices to prove
the result (in the Noetherian case) after a surjective flat quasi-finite
base change.

\medskip\noindent
Applying Morphisms, Lemma \ref{morphisms-lemma-massage-finite}
we see we may assume that $Y$ is a closed subscheme of an
affine scheme $Z$ which is (set theoretically) a finite union
$Z = \bigcup_{i \in I} Z_i$ of closed subschemes mapping isomorphically
to $X$. In this case we will find a finite partition of $X = \coprod X_j$
with affine locally closed strata that works (in other words $X'_j = X_j$).
Set $T_i = Y \cap Z_i$. This is a closed subscheme of $X$.
As $X$ is Noetherian we can find a finite partition of $X = \coprod X_j$
by affine locally closed subschemes, such that each
$X_j \times_X T_i$ is (set theoretically) a union of strata $X_j \times_X Z_i$.
Replacing $X$ by $X_j$ we see that we may assume $I = I_1 \amalg I_2$
with $Z_i \subset Y$ for $i \in I_1$ and $Z_i \cap Y = \emptyset$ for
$i \in I_2$. Replacing $Z$ by $\bigcup_{i \in I_1} Z_i$ we see that we
may assume $Y = Z$.
Finally, we can replace $X$ again by the members of a partition
as above such that for every $i, i' \subset I$ the intersection
$Z_i \cap Z_{i'}$ is either empty or (set theoretically) equal
to $Z_i$ and $Z_{i'}$. This clearly means that $Y$ is (set theoretically)
equal to a disjoint union of the $Z_i$ which is what we wanted to show.
\end{proof}








\section{More on constructible sheaves}
\label{section-more-constructible}

\noindent
Let $\Lambda$ be a Noetherian ring. Let $X$ be a scheme.
We often consider $X_\etale$ as a ringed site with
sheaf of rings $\underline{\Lambda}$. In case of abelian sheaves
we often take $\Lambda = \mathbf{Z}/n\mathbf{Z}$ for a suitable
integer $n$.

\begin{lemma}
\label{lemma-jshriek-constructible}
Let $j : U \to X$ be an \'etale morphism of quasi-compact and
quasi-separated schemes.
\begin{enumerate}
\item The sheaf $h_U$ is a constructible sheaf of sets.
\item The sheaf $j_!\underline{M}$ is a constructible abelian sheaf
for a finite abelian group $M$.
\item If $\Lambda$ is a Noetherian ring and $M$ is a finite $\Lambda$-module,
then $j_!\underline{M}$ is a constructible sheaf of $\Lambda$-modules
on $X_\etale$.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-etale-stratified-finite} there is a partition
$\coprod_i X_i$ such that $\pi_i: j^{-1}(X_i) \to X_i$ is finite \'etale.
The restriction of $h_U$ to $X_i$ is $h_{j^{-1}(X_i)}$ which is finite
locally constant by Lemma \ref{lemma-characterize-finite-locally-constant}.
For cases (2) and (3) we note that
$$
j_!(\underline{M})|_{X_i} =
\pi_{i!}(\underline{M}) =
\pi_{i*}(\underline{M})
$$
by Lemmas \ref{lemma-shriek-base-change} and
\ref{lemma-shriek-equals-star-finite-etale}.
Thus it suffices to show the lemma for $\pi : Y \to X$ finite \'etale.
This is Lemma \ref{lemma-pushforward-locally-constant}.
\end{proof}

\begin{lemma}
\label{lemma-torsion-colimit-constructible}
Let $X$ be a quasi-compact and quasi-separated scheme.
\begin{enumerate}
\item Let $\mathcal{F}$ be a sheaf of sets on $X_\etale$.
Then $\mathcal{F}$ is a filtered colimit of constructible
sheaves of sets.
\item Let $\mathcal{F}$ be a torsion abelian sheaf on $X_\etale$.
Then $\mathcal{F}$ is a filtered colimit of constructible abelian sheaves.
\item Let $\Lambda$ be a Noetherian ring and $\mathcal{F}$ a sheaf
of $\Lambda$-modules on $X_\etale$. Then
$\mathcal{F}$ is a filtered colimit of constructible sheaves of
$\Lambda$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\mathcal{B}$ be the collection of quasi-compact and quasi-separated
objects of $X_\etale$. By Modules on Sites,
Lemma \ref{sites-modules-lemma-module-filtered-colimit-constructibles}
any sheaf of sets is a filtered colimit of sheaves of the form
$$
\text{Coequalizer}\left(
\xymatrix{
\coprod\nolimits_{j = 1, \ldots, m} h_{V_j}
\ar@<1ex>[r] \ar@<-1ex>[r] &
\coprod\nolimits_{i = 1, \ldots, n} j_{U_i}
}
\right)
$$
with $V_j$ and $U_i$ quasi-compact and quasi-separated objects
of $X_\etale$. By
Lemmas \ref{lemma-jshriek-constructible} and \ref{lemma-constructible-abelian}
these coequalizers are constructible. This proves (1).

\medskip\noindent
Let $\Lambda$ be a Noetherian ring.
By Modules on Sites,
Lemma \ref{sites-modules-lemma-module-filtered-colimit-constructibles}
$\Lambda$-modules $\mathcal{F}$ is a filtered colimit
of modules of the form
$$
\Coker\left(
\bigoplus\nolimits_{j = 1, \ldots, m} j_{V_j!}\underline{\Lambda}_{V_j}
\longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n} j_{U_i!}\underline{\Lambda}_{U_i}
\right)
$$
with $V_j$ and $U_i$ quasi-compact and quasi-separated objects
of $X_\etale$. By
Lemmas \ref{lemma-jshriek-constructible} and \ref{lemma-constructible-abelian}
these cokernels are constructible. This proves (3).

\medskip\noindent
Proof of (2). First write $\mathcal{F} = \bigcup \mathcal{F}[n]$ where
$\mathcal{F}[n]$ is the $n$-torsion subsheaf. Then we can view
$\mathcal{F}[n]$ as a sheaf of $\mathbf{Z}/n\mathbf{Z}$-modules
and apply (3).
\end{proof}

\begin{lemma}
\label{lemma-check-constructible}
Let $f : X \to Y$ be a surjective morphism of quasi-compact and
quasi-separated schemes.
\begin{enumerate}
\item Let $\mathcal{F}$ be a sheaf of sets on $Y_\etale$. Then $\mathcal{F}$
is constructible if and only if $f^{-1}\mathcal{F}$ is constructible.
\item Let $\mathcal{F}$ be an abelian sheaf on $Y_\etale$. Then $\mathcal{F}$
is constructible if and only if $f^{-1}\mathcal{F}$ is constructible.
\item Let $\Lambda$ be a Noetherian ring.
Let $\mathcal{F}$ be sheaf of $\Lambda$-modules on $Y_\etale$.
Then $\mathcal{F}$ is constructible if and only if $f^{-1}\mathcal{F}$
is constructible.
\end{enumerate}
\end{lemma}

\begin{proof}
One implication follows from Lemma \ref{lemma-pullback-constructible}.
For the converse, assume $f^{-1}\mathcal{F}$ is constructible.
Write $\mathcal{F} = \colim \mathcal{F}_i$ as a
filtered colimit of constructible sheaves (of sets, abelian groups, or modules)
using Lemma \ref{lemma-torsion-colimit-constructible}.
Since $f^{-1}$ is a left adjoint it commutes with colimits
(Categories, Lemma \ref{categories-lemma-adjoint-exact}) and we see that
$f^{-1}\mathcal{F} = \colim f^{-1}\mathcal{F}_i$.
By Lemma \ref{lemma-colimit-constructible} we see that
$f^{-1}\mathcal{F}_i \to f^{-1}\mathcal{F}$
is surjective for all $i$ large enough.
Since $f$ is surjective we conclude (by looking at stalks using
Lemma \ref{lemma-stalk-pullback} and
Theorem \ref{theorem-exactness-stalks})
that $\mathcal{F}_i \to \mathcal{F}$ is surjective for all $i$ large enough.
Thus $\mathcal{F}$ is the quotient of a constructible sheaf $\mathcal{G}$.
Applying the argument once more to
$\mathcal{G} \times_\mathcal{F} \mathcal{G}$ or
the kernel of $\mathcal{G} \to \mathcal{F}$
we conclude using that $f^{-1}$ is exact and that the category of
constructible sheaves (of sets, abelian groups, or modules) is
preserved under finite (co)limits or (co)kernels inside
$\Sh(Y_\etale)$, $\Sh(X_\etale)$, $\textit{Ab}(Y_\etale)$,
$\textit{Ab}(X_\etale)$, $\textit{Mod}(Y_\etale, \Lambda)$, and
$\textit{Mod}(X_\etale, \Lambda)$, see
Lemma \ref{lemma-constructible-abelian}.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-constructible}
Let $f : X \to Y$ be a finite \'etale morphism of schemes. Let $\Lambda$ be a
Noetherian ring. If $\mathcal{F}$ is a constructible sheaf of sets,
constructible sheaf of abelian groups, or constructible sheaf of
$\Lambda$-modules on $X_\etale$, the same is true for
$f_*\mathcal{F}$ on $Y_\etale$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-constructible-local} it suffices to check this
Zariski locally on $Y$ and by Lemma \ref{lemma-check-constructible}
we may replace $Y$ by an \'etale cover (the construction of $f_*$
commutes with \'etale localization). A finite \'etale morphism is
\'etale locally isomorphic to a disjoint union of isomorphisms, see
\'Etale Morphisms, Lemma \ref{etale-lemma-finite-etale-etale-local}.
Thus, in the case of sheaves of sets, the lemma says that if
$\mathcal{F}_i$, $i = 1, \ldots, n$ are constructible sheaves of sets, then
$\prod_{i = 1, \ldots, n} \mathcal{F}_i$ is too.
This is clear. Similarly for sheaves of abelian groups and modules.
\end{proof}

\begin{lemma}
\label{lemma-category-constructible-sets}
Let $X$ be a quasi-compact and quasi-separated scheme. The category of
constructible sheaves of sets is the full subcategory of $\Sh(X_\etale)$
consisting of sheaves $\mathcal{F}$ which are coequalizers
$$
\xymatrix{
\mathcal{F}_1
\ar@<1ex>[r] \ar@<-1ex>[r]
&
\mathcal{F}_0 \ar[r]
&
\mathcal{F}}
$$
such that $\mathcal{F}_i$, $i = 0, 1$ is a finite coproduct of sheaves of
the form $h_U$ with $U$ a quasi-compact and quasi-separated
object of $X_\etale$.
\end{lemma}

\begin{proof}
In the proof of Lemma \ref{lemma-torsion-colimit-constructible}
we have seen that sheaves of this form are constructible.
For the converse, suppose that for every constructible sheaf of
sets $\mathcal{F}$ we can find a surjection $\mathcal{F}_0 \to \mathcal{F}$
with $\mathcal{F}_0$ as in the lemma. Then we find our surjection
$\mathcal{F}_1 \to \mathcal{F}_0 \times_\mathcal{F} \mathcal{F}_0$
because the latter is constructible by Lemma \ref{lemma-constructible-abelian}.

\medskip\noindent
By Topology, Lemma
\ref{topology-lemma-constructible-partition-refined-by-stratification}
we may choose a finite stratification
$X = \coprod_{i \in I} X_i$ such that $\mathcal{F}$ is finite locally
constant on each stratum. We will prove the result by induction on
the cardinality of $I$. Let $i \in I$ be a minimal element in the
partial ordering of $I$. Then $X_i \subset X$ is closed.
By induction, there exist finitely many quasi-compact and quasi-separated
objects $U_\alpha$ of $(X \setminus X_i)_\etale$ and a surjective
map $\coprod h_{U_\alpha} \to \mathcal{F}|_{X \setminus X_i}$.
These determine a map
$$
\coprod h_{U_\alpha} \to \mathcal{F}
$$
which is surjective after restricting to $X \setminus X_i$. By
Lemma \ref{lemma-characterize-finite-locally-constant}
we see that $\mathcal{F}|_{X_i} = h_V$ for some scheme $V$ finite \'etale
over $X_i$. Let $\overline{v}$ be a geometric point of $V$ lying
over $\overline{x} \in X_i$. We may think of $\overline{v}$ as an
element of the stalk $\mathcal{F}_{\overline{x}} = V_{\overline{x}}$.
Thus we can find an \'etale neighbourhood $(U, \overline{u})$
of $\overline{x}$ and a section $s \in \mathcal{F}(U)$ whose stalk at
$\overline{x}$ gives $\overline{v}$. Thinking of $s$ as a map
$s : h_U \to \mathcal{F}$, restricting to $X_i$ we obtain a morphism
$s|_{X_i} : U \times_X X_i \to V$ over $X_i$ which maps $\overline{u}$
to $\overline{v}$. Since $V$ is quasi-compact (finite over the closed
subscheme $X_i$ of the quasi-compact scheme $X$) a finite number
$s^{(1)}, \ldots, s^{(m)}$ of these sections of $\mathcal{F}$ over
$U^{(1)}, \ldots, U^{(m)}$ will determine a jointly
surjective map
$$
\coprod s^{(j)}|_{X_i} : \coprod U^{(j)} \times_X X_i \longrightarrow V
$$
Then we obtain the surjection
$$
\coprod h_{U_\alpha} \amalg \coprod h_{U^{(j)}} \to \mathcal{F}
$$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-category-constructible-modules}
Let $X$ be a quasi-compact and quasi-separated scheme. Let $\Lambda$
be a Noetherian ring. The category of constructible sheaves of
$\Lambda$-modules is exactly the category of modules of the form
$$
\Coker\left(
\bigoplus\nolimits_{j = 1, \ldots, m} j_{V_j!}\underline{\Lambda}_{V_j}
\longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n} j_{U_i!}\underline{\Lambda}_{U_i}
\right)
$$
with $V_j$ and $U_i$ quasi-compact and quasi-separated objects of
$X_\etale$. In fact, we can even assume $U_i$ and $V_j$ affine.
\end{lemma}

\begin{proof}
In the proof of Lemma \ref{lemma-torsion-colimit-constructible}
we have seen modules of this form are constructible. Since the
category of constructible modules is abelian
(Lemma \ref{lemma-constructible-abelian})
it suffices to prove that given a constructible module $\mathcal{F}$
there is a surjection
$$
\bigoplus\nolimits_{i = 1, \ldots, n} j_{U_i!}\underline{\Lambda}_{U_i}
\longrightarrow \mathcal{F}
$$
for some affine objects $U_i$ in $X_\etale$. By
Modules on Sites, Lemma
\ref{sites-modules-lemma-module-filtered-colimit-constructibles}
there is a surjection
$$
\Psi :
\bigoplus\nolimits_{i \in I} j_{U_i!}\underline{\Lambda}_{U_i}
\longrightarrow
\mathcal{F}
$$
with $U_i$ affine and the direct sum over a possibly infinite
index set $I$. For every finite subset $I' \subset I$ set
$$
T_{I'} = \text{Supp}(\Coker(
\bigoplus\nolimits_{i \in I'} j_{U_i!}\underline{\Lambda}_{U_i}
\longrightarrow \mathcal{F}))
$$
By the very definition of constructible sheaves, the set $T_{I'}$
is a constructible subset of $X$. We want to show that $T_{I'} = \emptyset$
for some $I'$. Since every stalk $\mathcal{F}_{\overline{x}}$ is
a finite type $\Lambda$-module and since $\Psi$ is surjective, for
every $x \in X$ there is an $I'$ such that $x \not \in T_{I'}$.
In other words we have
$\emptyset = \bigcap_{I' \subset I\text{ finite}} T_{I'}$. Since
$X$ is a spectral space by Properties, Lemma
\ref{properties-lemma-quasi-compact-quasi-separated-spectral}
the constructible topology on $X$ is quasi-compact by
Topology, Lemma \ref{topology-lemma-constructible-hausdorff-quasi-compact}.
Thus $T_{I'} = \emptyset$ for some $I' \subset I$ finite
as desired.
\end{proof}

\begin{lemma}
\label{lemma-category-constructible-abelian}
Let $X$ be a quasi-compact and quasi-separated scheme. The category of
constructible abelian sheaves is exactly the category of abelian
sheaves of the form
$$
\Coker\left(
\bigoplus\nolimits_{j = 1, \ldots, m}
j_{V_j!}\underline{\mathbf{Z}/m_j\mathbf{Z}}_{V_j}
\longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n}
j_{U_i!}\underline{\mathbf{Z}/n_i\mathbf{Z}}_{U_i}
\right)
$$
with $V_j$ and $U_i$ quasi-compact and quasi-separated objects of
$X_\etale$ and $m_j$, $n_i$ positive integers.
In fact, we can even assume $U_i$ and $V_j$ affine.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-category-constructible-modules}
applied with $\Lambda = \mathbf{Z}/n\mathbf{Z}$
and the fact that, since $X$ is quasi-compact, every constructible
abelian sheaf is annihilated by some positive integer $n$ (details omitted).
\end{proof}

\begin{lemma}
\label{lemma-constructible-is-compact}
Let $X$ be a quasi-compact and quasi-separated scheme. Let $\Lambda$ be a
Noetherian ring. Let $\mathcal{F}$ be a constructible sheaf of sets, abelian
groups, or $\Lambda$-modules on $X_\etale$. Let
$\mathcal{G} = \colim \mathcal{G}_i$ be a filtered colimit of sheaves of
sets, abelian groups, or $\Lambda$-modules. Then
$$
\Mor(\mathcal{F}, \mathcal{G}) = \colim \Mor(\mathcal{F}, \mathcal{G}_i)
$$
in the category of sheaves of sets, abelian groups, or $\Lambda$-modules on
$X_\etale$.
\end{lemma}

\begin{proof}
The case of sheaves of sets. By Lemma \ref{lemma-category-constructible-sets}
it suffices to prove the lemma for $h_U$ where $U$ is a quasi-compact
and quasi-separated object of $X_\etale$. Recall that
$\Mor(h_U, \mathcal{G}) = \mathcal{G}(U)$. Hence the result
follows from Sites, Lemma \ref{sites-lemma-directed-colimits-sections}.

\medskip\noindent
In the case of abelian sheaves or sheaves of modules, the result follows
in the same way using
Lemmas \ref{lemma-category-constructible-abelian} and
\ref{lemma-category-constructible-modules}.
For the case of abelian sheaves, we add that
$\Mor(j_{U!}\underline{\mathbf{Z}/n\mathbf{Z}}, \mathcal{G})$
is equal to the $n$-torsion elements of $\mathcal{G}(U)$.
\end{proof}

\begin{lemma}
\label{lemma-finite-pushforward-constructible}
Let $f : X \to Y$ be a finite and finitely presented morphism of schemes.
Let $\Lambda$ be a Noetherian ring. If $\mathcal{F}$ is a constructible
sheaf of sets, abelian groups, or $\Lambda$-modules on $X_\etale$,
then $f_*\mathcal{F}$ is too.
\end{lemma}

\begin{proof}
It suffices to prove this when $X$ and $Y$ are affine by
Lemma \ref{lemma-constructible-local}.
By
Lemmas \ref{lemma-finite-pushforward-commutes-with-base-change} and
\ref{lemma-check-constructible} we may base change to any
affine scheme surjective over $X$. By
Lemma \ref{lemma-decompose-quasi-finite-morphism}
this reduces us to the case of a finite \'etale morphism
(because a thickening leads to an equivalence of \'etale topoi
and even small \'etale sites, see
Theorem \ref{theorem-topological-invariance}).
The finite \'etale case is
Lemma \ref{lemma-pushforward-constructible}.
\end{proof}

\begin{lemma}
\label{lemma-category-is-colimit}
Let $X = \lim_{i \in I} X_i$ be a limit of a directed
system of schemes with affine transition morphisms.
We assume that $X_i$ is quasi-compact and quasi-separated
for all $i \in I$.
\begin{enumerate}
\item The category of constructible sheaves of sets on $X_\etale$
is the colimit of the categories of constructible sheaves of sets
on $(X_i)_\etale$.
\item The category of constructible abelian sheaves on $X_\etale$
is the colimit of the categories of constructible abelian sheaves
on $(X_i)_\etale$.
\item Let $\Lambda$ be a Noetherian ring. The category of constructible
sheaves of $\Lambda$-modules on $X_\etale$ is the colimit of the
categories of constructible sheaves of $\Lambda$-modules on $(X_i)_\etale$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Denote $f_i : X \to X_i$ the projection maps.
There are 3 parts to the proof corresponding to ``faithful'',
``fully faithful'', and ``essentially surjective''.

\medskip\noindent
Faithful. Choose $0 \in I$ and let $\mathcal{F}_0$, $\mathcal{G}_0$ be
constructible sheaves on $X_0$. Suppose that
$a, b : \mathcal{F}_0 \to \mathcal{G}_0$ are maps such that
$f_0^{-1}a = f_0^{-1}b$. Let $E \subset X_0$ be the set
of points $x \in X_0$ such that $a_{\overline{x}} = b_{\overline{x}}$.
By Lemma \ref{lemma-support-constructible} the subset
$E \subset X_0$ is constructible. By assumption $X \to X_0$ maps into $E$.
By Limits, Lemma \ref{limits-lemma-limit-contained-in-constructible}
we find an $i \geq 0$ such that $X_i \to X_0$ maps into $E$.
Hence $f_{i0}^{-1}a = f_{i0}^{-1}b$.

\medskip\noindent
Fully faithful. Choose $0 \in I$ and let $\mathcal{F}_0$, $\mathcal{G}_0$ be
constructible sheaves on $X_0$. Suppose that
$a : f_0^{-1}\mathcal{F}_0 \to f_0^{-1}\mathcal{G}_0$ is a map.
We claim there is an $i$ and a map
$a_i : f_{i0}^{-1}\mathcal{F}_0 \to f_{i0}^{-1}\mathcal{G}_0$
which pulls back to $a$ on $X$.
By Lemma \ref{lemma-category-constructible-sets}
we can replace $\mathcal{F}_0$
by a finite coproduct of sheaves represented by quasi-compact
and quasi-separated objects of $(X_0)_\etale$.
Thus we have to show: If $U_0 \to X_0$ is such an object
of $(X_0)_\etale$, then
$$
f_0^{-1}\mathcal{G}(U) = \colim_{i \geq 0} f_{i0}^{-1}\mathcal{G}(U_i)
$$
where $U = X \times_{X_0} U_0$ and $U_i = X_i \times_{X_0} U_0$.
This is a special case of Theorem \ref{theorem-colimit}.

\medskip\noindent
Essentially surjective. We have to show every constructible $\mathcal{F}$
on $X$ is isomorphic to $f_i^{-1}\mathcal{F}$ for some constructible
$\mathcal{F}_i$ on $X_i$. Applying
Lemma \ref{lemma-category-constructible-sets}
and using the results of the previous two paragraphs, we see that
it suffices to prove this for $h_U$ for some quasi-compact
and quasi-separated object $U$ of $X_\etale$.
In this case we have to show that $U$ is the base change of
a quasi-compact and quasi-separated scheme \'etale over $X_i$ for some $i$.
This follows from
Limits, Lemmas \ref{limits-lemma-descend-finite-presentation} and
\ref{limits-lemma-descend-etale}.

\medskip\noindent
Proof of (3). The argument is very similar to the argument for
sheaves of sets, but using
Lemma \ref{lemma-category-constructible-modules}
instead of
Lemma \ref{lemma-category-constructible-sets}. Details omitted.
Part (2) follows from part (3) because every constructible abelian
sheaf over a quasi-compact scheme is a constructible sheaf of
$\mathbf{Z}/n\mathbf{Z}$-modules for some $n$.
\end{proof}

\begin{lemma}
\label{lemma-irreducible-subsheaf-constant-zero}
Let $X$ be an irreducible scheme with generic point $\eta$.
\begin{enumerate}
\item Let $S' \subset S$ be an inclusion of sets. If we have
$\underline{S'} \subset \mathcal{G} \subset \underline{S}$
in $\Sh(X_\etale)$ and $S' = \mathcal{G}_{\overline{\eta}}$, then
$\mathcal{G} = \underline{S'}$.
\item Let $A' \subset A$ be an inclusion of abelian groups. If we have
$\underline{A'} \subset \mathcal{G} \subset \underline{A}$
in $\textit{Ab}(X_\etale)$ and $A' = \mathcal{G}_{\overline{\eta}}$, then
$\mathcal{G} = \underline{A'}$.
\item Let $M' \subset M$ be an inclsuion of modules over a ring $\Lambda$.
If we have $\underline{M'} \subset \mathcal{G} \subset \underline{M}$
in $\textit{Mod}(X_\etale, \underline{\Lambda})$
and $M' = \mathcal{G}_{\overline{\eta}}$, then
$\mathcal{G} = \underline{M'}$.
\end{enumerate}
\end{lemma}

\begin{proof}
This is true because for every \'etale morphism $U \to X$
with $U \not = \emptyset$ the point $\eta$ is in the image.
\end{proof}

\begin{lemma}
\label{lemma-push-constant-sheaf-from-open}
Let $X$ be an integral normal scheme with function field $K$.
Let $E$ be a set.
\begin{enumerate}
\item Let $g : \Spec(K) \to X$ be the inclusion of the generic point.
Then $g_*\underline{E} = \underline{E}$.
\item Let $j : U \to X$ be the inclusion of a nonempty open. Then
$j_*\underline{E} = \underline{E}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $x \in X$ be a point. Let $\mathcal{O}_{X, \overline{x}}$
be a strict henselization of $\mathcal{O}_{X, x}$. 
By More on Algebra, Lemma \ref{more-algebra-lemma-henselization-normal}
we see that $\mathcal{O}_{X, \overline{x}}$ is a normal domain.
Hence $\Spec(K) \times_X \Spec(\mathcal{O}_{X, \overline{x}})$
is irreducible. It follows that
the stalk $(g_*\underline{E}_{\underline{x}}$ is equal to $E$,
see Theorem \ref{theorem-higher-direct-images}.

\medskip\noindent
Proof of (2). Since $g$ factors through $j$ there is a map
$j_*\underline{E} \to g_*\underline{E}$. This map is injective because
for every scheme $V$ \'etale over $X$ the set $\Spec(K) \times_X V$
is dense in $U \times_X V$. On the other hand, we have a map
$\underline{E} \to j_*\underline{E}$ and we conclude.
\end{proof}






\section{Constructible sheaves on Noetherian schemes}
\label{section-noetherian-constructible}

\noindent
If $X$ is a Noetherian scheme then any locally closed subset is a
constructible locally closed subset
(Topology, Lemma \ref{topology-lemma-constructible-Noetherian-space}).
Hence an abelian sheaf $\mathcal{F}$ on $X_\etale$ is constructible
if and only if there exists a finite partition $X = \coprod X_i$
such that $\mathcal{F}|_{X_i}$ is finite locally constant.
(By convention a partition of a topological space has locally
closed parts, see Topology, Section \ref{topology-section-stratifications}.)
In other words, we can omit the adjective ``constructible'' in
Definition \ref{definition-constructible}. Actually, the category
of constructible sheaves on
Noetherian schemes has some additional properties which we will
catalogue in this section.

\begin{proposition}
\label{proposition-constructible-over-noetherian}
Let $X$ be a Noetherian scheme. Let $\Lambda$ be a Noetherian ring.
\begin{enumerate}
\item Any sub or quotient sheaf of a constructible sheaf of sets
is constructible.
\item The category of constructible abelian sheaves on $X_\etale$ is a
(strong) Serre subcategory of $\textit{Ab}(X_\etale)$. In particular,
every sub and quotient sheaf of a constructible abelian sheaf
on $X_\etale$ is constructible.
\item The category of constructible sheaves of $\Lambda$-modules
on $X_\etale$ is a (strong) Serre subcategory of
$\textit{Mod}(X_\etale, \Lambda)$. In particular, every submodule
and quotient module of a constructible sheaf of $\Lambda$-modules
on $X_\etale$ is constructible.
\end{enumerate}
\end{proposition}

\begin{proof}
Proof of (1). Let $\mathcal{G} \subset \mathcal{F}$ with $\mathcal{F}$
a constructible sheaf of sets on $X_\etale$. Let $\eta \in X$ be a generic
point of an irreducible component of $X$. By Noetherian induction
it suffices to find an open neighbourhood $U$ of $\eta$ such that
$\mathcal{G}|_U$ is locally constant. To do this we may replace $X$
by an \'etale neighbourhood of $\eta$.
Hence we may assume $\mathcal{F}$ is constant and $X$ is irreducible.

\medskip\noindent
Say $\mathcal{F} = \underline{S}$ for some finite set $S$.
Then $S' = \mathcal{G}_{\overline{\eta}} \subset S$
say $S' = \{s_1, \ldots, s_t\}$.
Pick an \'etale neighbourhood $(U, \overline{u})$ of $\overline{\eta}$
and sections $\sigma_1, \ldots, \sigma_t \in \mathcal{G}(U)$ which map to
$s_i$ in $\mathcal{G}_{\overline{\eta}} \subset S$.
Since $\sigma_i$ maps to an element
$s_i \in S' \subset S = \Gamma(X, \mathcal{F})$
we see that the two pullbacks of $\sigma_i$ to $U \times_X U$
are the same as sections of $\mathcal{G}$. By the sheaf condition
for $\mathcal{G}$ we find that $\sigma_i$ comes from a section
of $\mathcal{G}$ over the open $\Im(U \to X)$ of $X$.
Shrinking $X$ we may assume
$\underline{S'} \subset \mathcal{G} \subset \underline{S}$.
Then we see that $\underline{S'} = \mathcal{G}$ by
Lemma \ref{lemma-irreducible-subsheaf-constant-zero}.

\medskip\noindent
Let $\mathcal{F} \to \mathcal{Q}$ be a surjection with $\mathcal{F}$
a constructible sheaf of sets on $X_\etale$. Then set
$\mathcal{G} = \mathcal{F} \times_\mathcal{Q} \mathcal{F}$.
By the first part of the proof we see that $\mathcal{G}$ is
constructible as a subsheaf of $\mathcal{F} \times \mathcal{F}$.
This in turn implies that $\mathcal{Q}$ is constructible, see
Lemma \ref{lemma-constructible-abelian}.

\medskip\noindent
Proof of (3). we already know that constructible sheaves of modules
form a weak Serre subcategory, see Lemma \ref{lemma-constructible-abelian}.
Thus it suffices to show the statement on submodules.

\medskip\noindent
Let $\mathcal{G} \subset \mathcal{F}$ be a submodule of a
constructible sheaf of $\Lambda$-modules on $X_\etale$. Let $\eta \in X$
be a generic point of an irreducible component of $X$. By Noetherian induction
it suffices to find an open neighbourhood $U$ of $\eta$ such that
$\mathcal{G}|_U$ is locally constant. To do this we may replace $X$
by an \'etale neighbourhood of $\eta$. Hence we may assume $\mathcal{F}$
is constant and $X$ is irreducible.

\medskip\noindent
Say $\mathcal{F} = \underline{M}$ for some finite $\Lambda$-module $M$.
Then $M' = \mathcal{G}_{\overline{\eta}} \subset M$. Pick finitely
many elements $s_1, \ldots, s_t$ generating $M'$ as a $\Lambda$-module.
(This is possible as $\Lambda$ is Noetherian and $M$ is finite.)
Pick an \'etale neighbourhood $(U, \overline{u})$ of $\overline{\eta}$
and sections $\sigma_1, \ldots, \sigma_t \in \mathcal{G}(U)$ which map to
$s_i$ in $\mathcal{G}_{\overline{\eta}} \subset M$.
Since $\sigma_i$ maps to an element
$s_i \in M' \subset M = \Gamma(X, \mathcal{F})$
we see that the two pullbacks of $\sigma_i$ to $U \times_X U$
are the same as sections of $\mathcal{G}$. By the sheaf condition
for $\mathcal{G}$ we find that $\sigma_i$ comes from a section
of $\mathcal{G}$ over the open $\Im(U \to X)$ of $X$.
Shrinking $X$ we may assume
$\underline{M'} \subset \mathcal{G} \subset \underline{M}$.
Then we see that $\underline{M'} = \mathcal{G}$ by
Lemma \ref{lemma-irreducible-subsheaf-constant-zero}.

\medskip\noindent
Proof of (2). This follows in the usual manner from (3). Details
omitted.
\end{proof}

\noindent
The following lemma tells us that every object of the abelian category of
constructible sheaves on $X$ is ``Noetherian'', i.e., satisfies
a.c.c.\ for subobjects.

\begin{lemma}
\label{lemma-constructible-over-noetherian-noetherian}
Let $X$ be a Noetherian scheme. Let $\Lambda$ be a Noetherian ring.
Consider inclusions
$$
\mathcal{F}_1 \subset \mathcal{F}_2 \subset \mathcal{F}_3 \subset \ldots
\subset \mathcal{F}
$$
in the category of sheaves of sets, abelian groups, or $\Lambda$-modules.
If $\mathcal{F}$ is constructible, then for some $n$
we have $\mathcal{F}_n = \mathcal{F}_{n + 1} = \mathcal{F}_{n + 2} = \ldots$.
\end{lemma}

\begin{proof}
By Proposition \ref{proposition-constructible-over-noetherian}
we see that $\mathcal{F}_i$ and $\colim \mathcal{F}_i$ are constructible.
Then the lemma follows from
Lemma \ref{lemma-colimit-constructible}.
\end{proof}

\begin{lemma}
\label{lemma-constructible-maps-into-constant}
Let $X$ be a Noetherian scheme.
\begin{enumerate}
\item Let $\mathcal{F}$ be a constructible sheaf of sets on $X_\etale$.
There exist an injective map of sheaves
$$
\mathcal{F} \longrightarrow
\coprod\nolimits_{i = 1, \ldots, n} f_{i, *}\underline{E_i}
$$
where $f_i : Y_i \to X$ is a finite morphism and $E_i$ is a finite set.
\item Let $\mathcal{F}$ be a constructible abelian sheaf on $X_\etale$.
There exist an injective map of abelian sheaves
$$
\mathcal{F} \longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n} f_{i, *}\underline{M_i}
$$
where $f_i : Y_i \to X$ is a finite morphism and
$M_i$ is a finite abelian group.
\item Let $\Lambda$ be a Noetherian ring.
Let $\mathcal{F}$ be a constructible sheaf of $\Lambda$-modules on $X_\etale$.
There exist an injective map of sheaves of modules
$$
\mathcal{F} \longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n} f_{i, *}\underline{M_i}
$$
where $f_i : Y_i \to X$ is a finite morphism and
$M_i$ is a finite $\Lambda$-module.
\end{enumerate}
Moreover, we may assume each $Y_i$ is irreducible, reduced, maps onto
an irreducible and reduced closed subscheme $Z_i \subset X$ such that
$Y_i \to Z_i$ is finite \'etale over a nonempty open of $Z_i$.
\end{lemma}

\begin{proof}
Proof of (1). Because we have the ascending chain condition for
subsheaves of $\mathcal{F}$
(Lemma \ref{lemma-constructible-over-noetherian-noetherian}), it
suffices to show that for every point $x \in X$ we
can find a map $\varphi : \mathcal{F} \to f_*\underline{E}$ where
$f : Y \to X$ is finite and $E$ is a finite set such that
$\varphi_{\overline{x}} : \mathcal{F}_{\overline{x}} \to
(f_*S)_{\overline{x}}$ is injective.
(This argument can be avoided by picking a partition of $X$ as in
Lemma \ref{lemma-constructible-quasi-compact-quasi-separated}
and constructing a $Y_i \to X$ for each irreducible component
of each part.)
Let $Z \subset X$ be the induced reduced scheme structure
(Schemes, Definition \ref{schemes-definition-reduced-induced-scheme})
on $\overline{\{x\}}$.
Since $\mathcal{F}$ is constructible, there is a finite separable
extension $\kappa(x) \subset \Spec(K)$ such that
$\mathcal{F}|_{\Spec(K)}$ is the constant sheaf with value $E$
for some finite set $E$. Let $Y \to Z$ be the normalization
of $Z$ in $\Spec(K)$.
By Morphisms, Lemma \ref{morphisms-lemma-normal-normalization}
we see that $Y$ is a normal integral scheme.
As $\kappa(x) \subset K$ is finite, it is clear that $K$ is the function
field of $Y$. Denote $g : \Spec(K) \to Y$ the inclusion.
The map $\mathcal{F}|_{\Spec(K)} \to \underline{E}$ is adjoint
to a map $\mathcal{F}|_Y \to g_*\underline{E} = \underline{E}$
(Lemma \ref{lemma-push-constant-sheaf-from-open}).
This in turn is adjoint to a map
$\varphi : \mathcal{F} \to f_*\underline{E}$.
Observe that the stalk of $\varphi$ at a geometric point
$\overline{x}$ is injective: we may take a lift $\overline{y} \in Y$
of $\overline{x}$ and the commutative diagram
$$
\xymatrix{
\mathcal{F}_{\overline{x}} \ar@{=}[r] \ar[d] &
(\mathcal{F}|_Y)_{\overline{y}} \ar@{=}[d] \\
(f_*\underline{E})_{\overline{x}} \ar[r] &
\underline{E}_{\overline{y}}
}
$$
proves the injectivity. We are not yet done, however, as the
morphism $f : Y \to Z$ is integral but in general not
finite\footnote{If $X$ is a Nagata scheme, for example of finite
type over a field, then $Y \to Z$ is finite.}.

\medskip\noindent
To fix the problem stated in the last sentence of the previous paragraph,
we write $Y = \lim_{i \in I} Y_i$ with $Y_i$ irreducible, integral, and
finite over $Z$. Namely, apply Properties, Lemma
\ref{properties-lemma-integral-algebra-directed-colimit-finite}
to $f_*\mathcal{O}_Y$ viewed as a sheaf of $\mathcal{O}_Z$-algebras
and apply the functor $\underline{\Spec}_Z$.
Then $f_*\underline{E} = \colim f_{i, *}\underline{E}$
by Lemma \ref{lemma-relative-colimit}.
By Lemma \ref{lemma-constructible-is-compact} the map
$\mathcal{F} \to f_*\underline{E}$
factors through $f_{i, *}\underline{E}$ for some $i$.
Since $Y_i \to Z$ is a finite morphism of integral schemes
and since the function field extension
induced by this morphism is finite separable, we see that the
morphism is finite \'etale over a nonempty open of $Z$ (use
Algebra, Lemma \ref{algebra-lemma-smooth-at-generic-point}; details omitted).
This finishes the proof of (1).

\medskip\noindent
The proofs of (2) and (3) are identical to the proof of (1).
\end{proof}

\noindent
In the following lemma we use a standard trick to reduce a very general
statement to the Noetherian case.

\begin{lemma}
\label{lemma-constructible-maps-into-constant-general}
Let $X$ be a quasi-compact and quasi-separated scheme.
\begin{enumerate}
\item Let $\mathcal{F}$ be a constructible sheaf of sets on $X_\etale$.
There exist an injective map of sheaves
$$
\mathcal{F} \longrightarrow
\coprod\nolimits_{i = 1, \ldots, n} f_{i, *}\underline{E_i}
$$
where $f_i : Y_i \to X$ is a finite and finitely presented morphism and
$E_i$ is a finite set.
\item Let $\mathcal{F}$ be a constructible abelian sheaf on $X_\etale$.
There exist an injective map of abelian sheaves
$$
\mathcal{F} \longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n} f_{i, *}\underline{M_i}
$$
where $f_i : Y_i \to X$ is a finite and finitely presented morphism and
$M_i$ is a finite abelian group.
\item Let $\Lambda$ be a Noetherian ring.
Let $\mathcal{F}$ be a constructible sheaf of $\Lambda$-modules on $X_\etale$.
There exist an injective map of sheaves of modules
$$
\mathcal{F} \longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n} f_{i, *}\underline{M_i}
$$
where $f_i : Y_i \to X$ is a finite and finitely presented morphism and
$M_i$ is a finite $\Lambda$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
We will reduce this lemma to the Noetherian case by absolute Noetherian
approximation. Namely, by
Limits, Proposition \ref{limits-proposition-approximate}
we can write $X = \lim_{t \in T} X_t$ with each $X_t$ of finite type over
$\Spec(\mathbf{Z})$ and with affine transition morphisms. By
Lemma \ref{lemma-category-is-colimit}
the category of constructible sheaves (of sets, abelian groups, or
$\Lambda$-modules) on $X_\etale$ is the colimit of the corresponding
categories for $X_t$. Thus our constructible sheaf $\mathcal{F}$
is the pullback of a similar constructible sheaf $\mathcal{F}_t$
over $X_t$ for some $t$. Then we apply the Noetherian case
(Lemma \ref{lemma-constructible-maps-into-constant})
to find an injection
$$
\mathcal{F}_t \longrightarrow
\coprod\nolimits_{i = 1, \ldots, n} f_{i, *}\underline{E_i}
\quad\text{or}\quad
\mathcal{F}_t \longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n} f_{i, *}\underline{M_i}
$$
over $X_t$ for some finite morphisms $f_i : Y_i \to X_t$.
Since $X_t$ is Noetherian the morphisms $f_i$ are of finite presentation.
Since pullback is exact and since formation of $f_{i, *}$ commutes
with base change
(Lemma \ref{lemma-finite-pushforward-commutes-with-base-change}), we conclude.
\end{proof}











\section{Cohomology with support in a closed subscheme}
\label{section-cohomology-support}

\noindent
Let $X$ be a scheme and let $Z \subset X$ be a closed subscheme.
Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. We let
$$
\Gamma_Z(X, \mathcal{F}) =
\{s \in \mathcal{F}(X) \mid \text{Supp}(s) \subset Z\}
$$
be the sections with support in $Z$ (Definition \ref{definition-support}).
This is a left exact functor which is not exact in general.
Hence we obtain a derived functor
$$
R\Gamma_Z(X, -) : D(X_\etale) \longrightarrow D(\textit{Ab})
$$
and cohomology groups with support in $Z$ defined by
$H^q_Z(X, \mathcal{F}) = R^q\Gamma_Z(X, \mathcal{F})$.

\medskip\noindent
Let $\mathcal{I}$ be an injective abelian sheaf on $X_\etale$.
Let $U = X \setminus Z$.
Then the restriction map $\mathcal{I}(X) \to \mathcal{I}(U)$ is surjective
(Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-restriction-along-monomorphism-surjective})
with kernel $\Gamma_Z(X, \mathcal{I})$. It immediately follows that
for $K \in D(X_\etale)$ there is a distinguished triangle
$$
R\Gamma_Z(X, K) \to R\Gamma(X, K) \to R\Gamma(U, K) \to R\Gamma_Z(X, K)[1]
$$
in $D(\textit{Ab})$. As a consequence we obtain a long exact cohomology
sequence
$$
\ldots \to H^i_Z(X, K) \to H^i(X, K) \to H^i(U, K) \to
H^{i + 1}_Z(X, K) \to \ldots
$$
for any $K$ in $D(X_\etale)$.

\medskip\noindent
For an abelian sheaf $\mathcal{F}$ on $X_\etale$ we can consider
the {\it subsheaf of sections with support in $Z$}, denoted
$\mathcal{H}_Z(\mathcal{F})$, defined by the rule
$$
\mathcal{H}_Z(\mathcal{F})(U) =
\{s \in \mathcal{F}(U) \mid \text{Supp}(s) \subset U \times_X Z\}
$$
Here we use the support of a section from Definition \ref{definition-support}.
Using the equivalence of
Proposition \ref{proposition-closed-immersion-pushforward}
we may view $\mathcal{H}_Z(\mathcal{F})$ as an abelian sheaf on
$Z_\etale$. Thus we obtain a functor
$$
\textit{Ab}(X_\etale) \longrightarrow \textit{Ab}(Z_\etale),\quad
\mathcal{F} \longmapsto \mathcal{H}_Z(\mathcal{F})
$$
which is left exact, but in general not exact.

\begin{lemma}
\label{lemma-sections-with-support-acyclic}
Let $i : Z \to X$ be a closed immersion of schemes.
Let $\mathcal{I}$ be an injective abelian sheaf on $X_\etale$.
Then $\mathcal{H}_Z(\mathcal{I})$ is an injective abelian sheaf
on $Z_\etale$.
\end{lemma}

\begin{proof}
Observe that for any abelian sheaf $\mathcal{G}$ on $Z_\etale$
we have
$$
\Hom_Z(\mathcal{G}, \mathcal{H}_Z(\mathcal{F})) =
\Hom_X(i_*\mathcal{G}, \mathcal{F})
$$
because after all any section of $i_*\mathcal{G}$ has support in $Z$.
Since $i_*$ is exact (Section \ref{section-closed-immersions}) and as
$\mathcal{I}$ is injective on $X_\etale$ we conclude that
$\mathcal{H}_Z(\mathcal{I})$ is injective on $Z_\etale$.
\end{proof}

\noindent
Denote
$$
R\mathcal{H}_Z : D(X_\etale) \longrightarrow D(Z_\etale)
$$
the derived functor. We set
$\mathcal{H}^q_Z(\mathcal{F}) = R^q\mathcal{H}_Z(\mathcal{F})$ so that
$\mathcal{H}^0_Z(\mathcal{F}) = \mathcal{H}_Z(\mathcal{F})$.
By the lemma above we have a Grothendieck spectral sequence
$$
E_2^{p, q} = H^p(Z, \mathcal{H}^q_Z(\mathcal{F}))
\Rightarrow H^{p + q}_Z(X, \mathcal{F})
$$

\begin{lemma}
\label{lemma-cohomology-with-support-sheaf-on-support}
Let $i : Z \to X$ be a closed immersion of schemes.
Let $\mathcal{G}$ be an injective abelian sheaf on $Z_\etale$.
Then $\mathcal{H}^p_Z(i_*\mathcal{G}) = 0$ for $p > 0$.
\end{lemma}

\begin{proof}
This is true because the functor $i_*$ is exact and transforms
injective abelian sheaves into injective abelian sheaves
(Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-pushforward-injective-flat}).
\end{proof}

\begin{lemma}
\label{lemma-cohomology-with-support-triangle}
Let $i : Z \to X$ be a closed immersion of schemes.
Let $j : U \to X$ be the inclusion of the complement of $Z$.
Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$.
There is a distinguished triangle
$$
i_*R\mathcal{H}_Z(\mathcal{F}) \to \mathcal{F} \to Rj_*(\mathcal{F}|_U) \to
i_*R\mathcal{H}_Z(\mathcal{F})[1]
$$
in $D(X_\etale)$. This produces an exact sequence
$$
0 \to i_*\mathcal{H}_Z(\mathcal{F}) \to \mathcal{F} \to
j_*(\mathcal{F}|_U) \to i_*\mathcal{H}^1_Z(\mathcal{F}) \to 0
$$
and isomorphisms
$R^pj_*(\mathcal{F}|_U) \cong i_*\mathcal{H}^{p + 1}_Z(\mathcal{F})$
for $p \geq 1$.
\end{lemma}

\begin{proof}
To get the distinguished triangle, choose an injective resolution
$\mathcal{F} \to \mathcal{I}^\bullet$. Then we obtain a short exact
sequence of complexes
$$
0 \to
i_*\mathcal{H}_Z(\mathcal{I}^\bullet) \to \mathcal{I}^\bullet
\to j_*(\mathcal{I}^\bullet|_U) \to 0
$$
by the discussion above. Thus the distinguished triangle by
Derived Categories, Section \ref{derived-section-canonical-delta-functor}.
\end{proof}

\noindent
Let $X$ be a scheme and let $Z \subset X$ be a closed subscheme.
We denote $D_Z(X_\etale)$ the strictly full saturated triangulated
subcategory of $D(X_\etale)$ consisting of complexes whose cohomology
sheaves are supported on $Z$. Note that $D_Z(X_\etale)$ only
depends on the underlying closed subset of $X$.

\begin{lemma}
\label{lemma-complexes-with-support-on-closed}
Let $i : Z \to X$ be a closed immersion of schemes.
The map $Ri_{small, *} = i_{small, *} : D(Z_\etale) \to D(X_\etale)$
induces an equivalence $D(Z_\etale) \to D_Z(X_\etale)$ with quasi-inverse
$$
i_{small}^{-1}|_{D_Z(X_\etale)} = R\mathcal{H}_Z|_{D_Z(X_\etale)}
$$
\end{lemma}

\begin{proof}
Recall that $i_{small}^{-1}$ and $i_{small, *}$ is an adjoint pair of
exact functors such that $i_{small}^{-1}i_{small, *}$ is isomorphic to
the identify functor on abelian sheaves. See
Proposition \ref{proposition-closed-immersion-pushforward} and
Lemma \ref{lemma-stalk-pullback}. Thus
$i_{small, *} : D(Z_\etale) \to D_Z(X_\etale)$ is fully faithfull and
$i_{small}^{-1}$ determines
a left inverse. On the other hand, suppose that $K$ is an object of
$D_Z(X_\etale)$ and consider the adjunction map
$K \to i_{small, *}i_{small}^{-1}K$.
Using exactness of $i_{small, *}$ and $i_{small}^{-1}$
this induces the adjunction maps
$H^n(K) \to i_{small, *}i_{small}^{-1}H^n(K)$ on cohomology sheaves.
Since these cohomology
sheaves are supported on $Z$ we see these adjunction maps are isomorphisms
and we conclude that $D(Z_\etale) \to D_Z(X_\etale)$ is an equivalence.

\medskip\noindent
To finish the proof we have to show that $R\mathcal{H}_Z(K) = i_{small}^{-1}K$
if $K$ is an object of $D_Z(X_\etale)$. To do this we can use that
$K = i_{small, *}i_{small}^{-1}K$
as we've just proved this is the case. Then we
can choose a K-injective representative $\mathcal{I}^\bullet$ for
$i_{small}^{-1}K$.
Since $i_{small, *}$ is the right adjoint to the exact functor
$i_{small}^{-1}$, the
complex $i_{small, *}\mathcal{I}^\bullet$ is K-injective
(Derived Categories, Lemma \ref{derived-lemma-adjoint-preserve-K-injectives}).
We see that $R\mathcal{H}_Z(K)$ is computed by
$\mathcal{H}_Z(i_{small, *}\mathcal{I}^\bullet) = \mathcal{I}^\bullet$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-with-support-quasi-coherent}
Let $X$ be a scheme. Let $Z \subset X$ be a closed subscheme.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module
and denote $\mathcal{F}^a$ the associated quasi-coherent sheaf
on the small \'etale site of $X$
(Proposition \ref{proposition-quasi-coherent-sheaf-fpqc}). Then
\begin{enumerate}
\item $H^q_Z(X, \mathcal{F})$ agrees with $H^q_Z(X_\etale, \mathcal{F}^a)$,
\item if the complement of $Z$ is retrocompact in $X$, then
$i_*\mathcal{H}^q_Z(\mathcal{F}^a)$ is a quasi-coherent sheaf of
$\mathcal{O}_X$-modules equal to $(i_*\mathcal{H}^q(\mathcal{F}))^a$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $j : U \to X$ be the inclusion of the complement of $Z$.
The statement (1) on cohomology groups follows from the long
exact sequences for cohomology with supports and the agreements
$H^q(X_\etale, \mathcal{F}^a) = H^q(X, \mathcal{F})$ and
$H^q(U_\etale, \mathcal{F}^a) = H^q(U, \mathcal{F})$, see
Theorem \ref{theorem-zariski-fpqc-quasi-coherent}.
If $j : U \to X$ is a quasi-compact morphism, i.e., if $U \subset X$
is restrocompact, then $R^qj_*$ transforms quasi-coherent sheaves
into quasi-coherent sheaves
(Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherence-higher-direct-images})
and commutes with taking associated
sheaf on \'etale sites
(Descent, Lemma \ref{descent-lemma-higher-direct-images-small-etale}).
We conclude by applying
Lemma \ref{lemma-cohomology-with-support-triangle}.
\end{proof}






\section{Affine analog of proper base change}
\label{section-gabber-affine-proper}

\noindent
In this section we discuss a result by Ofer Gabber, see
\cite{gabber-affine-proper}. This was also proved by Roland Huber, see
\cite{Huber-henselian}.

\begin{lemma}
\label{lemma-normal-scheme-with-alg-closed-function-field}
Let $X$ be an integral normal scheme with separably closed
function field.
\begin{enumerate}
\item A separated \'etale morphism $U \to X$ is a
disjoint union of open immersions.
\item All local rings of $X$ are strictly henselian.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $R$ be a normal domain whose fraction field is separably algebraically
closed. Let $R \to A$ be an \'etale ring map. Then
$A \otimes_R K$ is as a $K$-algebra a finite product
$\prod_{i = 1, \ldots, n} K$ of copies of $K$. Let $e_i$, $i = 1, \ldots, n$
be the corresponding idempotents of $A \otimes_R K$. Since $A$ is normal
(Algebra, Lemma \ref{algebra-lemma-normal-goes-up})
the idempotents $e_i$ are in $A$
(Algebra, Lemma \ref{algebra-lemma-normal-ring-integrally-closed}).
Hence $A = \prod Ae_i$ and we may assume $A \otimes_R K = K$.
Since $A \subset A \otimes_R K = K$ (by flatness of $R \to A$ and
since $R \subset K$) we conclude that $A$ is a domain.
By the same argument we conclude that
$A \otimes_R A \subset (A \otimes_R A) \otimes_R K = K$.
It follows that the map $A \otimes_R A \to A$ is
injective as well as surjective. Thus $R \to A$ defines an
open immersion by
Morphisms, Lemma \ref{morphisms-lemma-universally-injective}
and
\'Etale Morphisms, Theorem \ref{etale-theorem-etale-radicial-open}.

\medskip\noindent
Let $f : U \to X$ be a separated \'etale morphism. Let $\eta \in X$
be the generic point and let $f^{-1}(\{\eta\}) = \{\xi_i\}_{i \in I}$.
The result of the previous paragraph shows the following:
For any affine open $U' \subset U$ whose image in $X$ is contained in
an affine we have $U' = \coprod_{i \in I} U'_i$ where $U'_i$
is the set of point of $U'$ which are specializations of $\xi_i$.
Moreover, the morphism $U'_i \to X$ is an open immersion.
It follows that $U_i = \overline{\{\xi_i\}}$ is an open and closed
subscheme of $U$ and that $U_i \to X$ is locally on the source
an isomorphism. By Morphisms,
Lemma \ref{morphisms-lemma-distinct-local-rings}
the fact that $U_i \to X$ is separated, implies that
$U_i \to X$ is injective and we conclude that $U_i \to X$
is an open immersion, i.e., (1) holds.

\medskip\noindent
Part (2) follows from part (1) and the description of the strict
henselization of $\mathcal{O}_{X, x}$ as the local ring at $\overline{x}$
on the \'etale site of $X$ (Lemma \ref{lemma-describe-etale-local-ring}).
\end{proof}

\begin{lemma}
\label{lemma-closed-of-affine-normal-scheme-with-alg-closed-function-field}
Let $X$ be an affine integral normal scheme with separably closed
function field. Let $Z \subset X$ be a closed subscheme. Let
$V \to Z$ be an \'etale morphism with $V$ affine. Then $V$ is a finite
disjoint union of open subschemes of $Z$. If $V \to Z$ is
surjective and finite \'etale, then $V \to Z$ has a section.
\end{lemma}

\begin{proof}
By Algebra, Lemma \ref{algebra-lemma-lift-etale}
we can lift $V$ to an affine scheme $U$ \'etale over $X$.
Apply Lemma \ref{lemma-normal-scheme-with-alg-closed-function-field}
to $U \to X$ to get the first statement.

\medskip\noindent
The final statement is a consequence of the first.
Let $V = \coprod_{i = 1, \ldots, n} V_i$ be a finite
decomposition into open and
closed subschemes with $V_i \to Z$ an open immersion.
As $V \to Z$ is finite we see that $V_i \to Z$ is also closed.
Let $U_i \subset Z$ be the image. Then we have a decomposition
into open and closed subshemes
$$
Z =
\coprod\nolimits_{(A, B)}
\bigcap\nolimits_{i \in A} U_i \cap
\bigcap\nolimits_{i \in B} U_i^c
$$
where the disjoint union is over $\{1, \ldots, n\} = A \amalg B$
where $A$ has at least one element.
Each of the strata is contained in a single $U_i$ and
we find our section.
\end{proof}

\begin{lemma}
\label{lemma-gabber-for-h1-absolutely-algebraically-closed}
Let $X$ be a normal integral affine scheme with with separably closed
function field. Let $Z \subset X$ be a closed subscheme.
For any finite abelian group $M$ we have $H^1_\etale(Z, \underline{M}) = 0$.
\end{lemma}

\begin{proof}
By Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-torsors-h1}
an element of $H^1_\etale(Z, \underline{M})$ corresponds to a
$\underline{M}$-torsor $\mathcal{F}$ on $Z_\etale$.
Such a torsor is clearly a finite locally constant sheaf.
Hence $\mathcal{F}$ is representable by a scheme $V$ finite
\'etale over $Z$, Lemma \ref{lemma-characterize-finite-locally-constant}.
Of course $V \to Z$ is surjective as a torsor is locally trivial.
Since $V \to Z$ has a section by
Lemma \ref{lemma-closed-of-affine-normal-scheme-with-alg-closed-function-field}
we are done.
\end{proof}

\begin{lemma}
\label{lemma-gabber-for-absolutely-algebraically-closed}
Let $X$ be a normal integral affine scheme with separably closed
function field. Let $Z \subset X$ be a closed subscheme.
For any finite abelian group $M$ we have
$H^q_\etale(Z, \underline{M}) = 0$ for $q \geq 1$.
\end{lemma}

\begin{proof}
We have seen that the result is true for $H^1$ in
Lemma \ref{lemma-gabber-for-h1-absolutely-algebraically-closed}.
We will prove the result for $q \geq 2$ by induction on $q$.
Let $\xi \in H^q_\etale(Z, \underline{M})$.

\medskip\noindent
Let $X = \Spec(R)$. Let $I \subset R$ be the set of elements
$f \in R$ sch that $\xi|_{Z \cap D(f)} = 0$.
All local rings of $Z$ are strictly henselian
by Lemma \ref{lemma-normal-scheme-with-alg-closed-function-field}
and
Algebra, Lemma \ref{algebra-lemma-quotient-strict-henselization}.
Hence \'etale cohomology on $Z$ or open subschemes of $Z$
is equal to Zariski cohomology, see
Lemma \ref{lemma-local-rings-strictly-henselian}.
In particular $\xi$ is Zariski locally trivial.
It follows that for every prime $\mathfrak p$ of $R$ there
exists an $f \in I$ with $f \not \in \mathfrak p$.
Thus if we can show that $I$ is an ideal, then $1 \in I$ and
we're done. It is clear that $f \in I$, $r \in R$ implies
$rf \in I$. Thus we now assume that $f, g \in I$ and we show that
$f + g \in I$. Note that
$$
D(f + g) \cap Z = D(f(f + g)) \cap Z \cup D(g(f + g)) \cap Z
$$
By Mayer-Vietoris (Cohomology, Lemma \ref{cohomology-lemma-mayer-vietoris}
which applies as \'etale cohomology on open subschemes of $Z$ equals
Zariski cohomology) we have an exact sequence
$$
\xymatrix{
H^{q - 1}_\etale(D(fg(f + g)) \cap Z, \underline{M}) \ar[d] \\
H^q_\etale(D(f + g) \cap Z, \underline{M}) \ar[d] \\
H^q_\etale(D(f(f + g)) \cap Z, \underline{M}) \oplus
H^q_\etale(D(g(f + g)) \cap Z, \underline{M})
}
$$
and the result follows as the first group is zero by induction.
\end{proof}

\begin{lemma}
\label{lemma-integral-cover-trivial-cohomology}
Let $X$ be an affine scheme.
\begin{enumerate}
\item There exists an integral surjective morphism $X' \to X$ such that for
every closed subscheme $Z' \subset X'$, every finite abelian group $M$, and
every $q \geq 1$ we have $H^q_\etale(Z', \underline{M}) = 0$.
\item For any closed subscheme $Z \subset X$, finite abelian group $M$,
$q \geq 1$, and $\xi \in H^q_\etale(Z, \underline{M})$ there exists a
finite surjective morphism $X' \to X$ of finite presentation such that
$\xi$ pulls back to zero in $H^q_\etale(X' \times_X Z, \underline{M})$.
\end{enumerate}
\end{lemma}

\begin{proof}
Write $X = \Spec(A)$. Write $A = \mathbf{Z}[x_i]/J$ for some ideal $J$.
Let $R$ be the integral closure of $\mathbf{Z}[x_i]$ in an algebraic
closure of the fraction field of $\mathbf{Z}[x_i]$. Let
$A' = R/JR$ and set $X' = \Spec(A')$. This gives an example as in (1) by
Lemma \ref{lemma-gabber-for-absolutely-algebraically-closed}.

\medskip\noindent
Proof of (2). Let $X' \to X$ be the integral surjective morphism we found
above. Certainly, $\xi$ maps to zero in
$H^q_\etale(X' \times_X Z, \underline{M})$. We may write $X'$ as a
limit $X' = \lim X'_i$ of schemes finite and of finite presentation
over $X$; this is easy to do in our current affine case, but it
is a special case of the more general Limits, Lemma
\ref{limits-lemma-integral-limit-finite-and-finite-presentation}.
By Lemma \ref{lemma-directed-colimit-cohomology}
we see that $\xi$ maps to zero in $H^q_\etale(X'_i \times_X Z, \underline{M})$
for some $i$ large enough.
\end{proof}

\begin{lemma}
\label{lemma-efface-cohomology-on-closed-by-finite-cover}
Let $X$ be an affine scheme. Let $\mathcal{F}$ be a torsion abelian sheaf
on  $X_\etale$. Let $Z \subset X$ be a closed subscheme. Let
$\xi \in H^q_\etale(Z, \mathcal{F}|_Z)$ for some $q > 0$.
Then there exists an injective map $\mathcal{F} \to \mathcal{F}'$
of torsion abelian sheaves on $X_\etale$ such that
the image of $\xi$ in $H^q_\etale(Z, \mathcal{F}'|_Z)$ is zero.
\end{lemma}

\begin{proof}
By Lemmas \ref{lemma-torsion-colimit-constructible} and \ref{lemma-colimit}
we can find a map $\mathcal{G} \to \mathcal{F}$ with $\mathcal{G}$
a constructible abelian sheaf and $\xi$ coming from an element $\zeta$ of
$H^q_\etale(Z, \mathcal{G}|_Z)$. Suppose we can find an injective map
$\mathcal{G} \to \mathcal{G}'$ of torsion abelian sheaves on $X_\etale$
such that the image of $\zeta$ in $H^q_\etale(Z, \mathcal{G}'|_Z)$ is zero.
Then we can take $\mathcal{F}'$ to be the pushout
$$
\mathcal{F}' = \mathcal{G}' \amalg_{\mathcal{G}} \mathcal{F}
$$
and we conclude the result of the lemma holds. (Observe that restriction
to $Z$ is exact, so commutes with finite limits and colimits and moreover
it commutes with arbitrary colimits as a left adjoint to pushforward.)
Thus we may assume $\mathcal{F}$ is constructible.

\medskip\noindent
Assume $\mathcal{F}$ is constructible. By
Lemma \ref{lemma-constructible-maps-into-constant-general}
it suffices to prove the result when $\mathcal{F}$
is of the form $f_*\underline{M}$ where $M$ is a finite abelian group
and $f : Y \to X$ is a finite morphism of finite presentation
(such sheaves are still constructible by
Lemma \ref{lemma-finite-pushforward-constructible}
but we won't need this).
Since formation of $f_*$ commutes with any base change
(Lemma \ref{lemma-finite-pushforward-commutes-with-base-change})
we see that the restriction of $f_*\underline{M}$ to $Z$ is
equal to the pushforward of $\underline{M}$ via
$Y \times_X Z \to Z$. By the Leray spectral sequence
(Proposition \ref{proposition-leray})
and vanishing of higher direct images
(Proposition \ref{proposition-finite-higher-direct-image-zero}),
we find
$$
H^q_\etale(Z, f_*\underline{M}|_Z) = H^q_\etale(Y \times_X Z, \underline{M}).
$$
By Lemma \ref{lemma-integral-cover-trivial-cohomology}
we can find a finite surjective morphism $Y' \to Y$ of finite presentation
such that $\xi$ maps to zero in $H^q(Y' \times_X Z, \underline{M})$.
Denoting $f' : Y' \to X$ the compostion $Y' \to Y \to X$ we claim
the map
$$
f_*\underline{M} \longrightarrow f'_*\underline{M}
$$
is injective which finishes the proof by what was said above.
To see the desired injectivity we can look at stalks. Namely,
if $\overline{x} : \Spec(k) \to X$ is a geometric point, then
$$
(f_*\underline{M})_{\overline{x}} =
\bigoplus\nolimits_{f(\overline{y}) = \overline{x}} M
$$
by Proposition \ref{proposition-finite-higher-direct-image-zero}
and similarly for the other sheaf.
Since $Y' \to Y$ is surjective and finite we see that
the induced map on geometric points lifting $\overline{x}$ is
surjective too and we conclude.
\end{proof}

\noindent
The lemma above will take care of higher cohomology groups in
Gabber's result. The following lemma will be used to deal with
global sections.

\begin{lemma}
\label{lemma-gabber-h0}
Let $X$ be a quasi-compact and quasi-separated scheme.
Let $i : Z \to X$ be a closed immersion. Assume that
\begin{enumerate}
\item for any sheaf $\mathcal{F}$ on $X_{Zar}$ the map
$\Gamma(X, \mathcal{F}) \to \Gamma(Z, i^{-1}\mathcal{F})$
is bijective, and
\item for any finite morphism $X' \to X$ assumption (1) holds
for $Z \times_X X' \to X'$.
\end{enumerate}
Then for any sheaf $\mathcal{F}$ on $X_\etale$ we have
$\Gamma(X, \mathcal{F}) = \Gamma(Z, i^{-1}_{small}\mathcal{F})$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be a sheaf on $X_\etale$. There is a canonical
(base change) map
$$
i^{-1}(\mathcal{F}|_{X_{Zar}})
\longrightarrow
(i_{small}^{-1}\mathcal{F})|_{Z_{Zar}}
$$
of sheaves on $Z_{Zar}$. This map is injective as can be seen by looking
on stalks. The stalk on the left hand side at $z \in Z$
is the stalk of $\mathcal{F}|_{X_{Zar}}$ at $z$. The stalk on the right
hand side is the colimit over all elementary \'etale neighbourhoods
$(U, u) \to (X, z)$ such that $U \times_X Z \to Z$ has a section over
a neighbourhood of $z$. As \'etale morphisms are open, the image of
$U \to X$ is an open neighbourhood of $z$ in $X$ and injectivity follows.

\medskip\noindent
It follows from this and assumption (1) that the map
$\Gamma(X, \mathcal{F}) \to \Gamma(Z, i^{-1}_{small}\mathcal{F})$
is injective. By (2) the same thing is true on all $X'$ finite over $X$.

\medskip\noindent
Let $s \in \Gamma(Z, i^{-1}_{small}\mathcal{F})$. By construction of
$i^{-1}_{small}\mathcal{F}$ there exists an \'etale covering
$\{V_j \to Z\}$, \'etale morphisms $U_j \to X$, sections
$s_j \in \mathcal{F}(U_j)$ and morphisms $V_j \to U_j$ over $X$
such that $s|_{V_j}$ is the pullback of $s_j$.
Observe that every closed subscheme $T \subset X$ meets $Z$
by assumption (1) applied to the sheaf $(T \to X)_*\underline{\mathbf{Z}}$
for example. Thus we see that $\coprod U_j \to X$ is surjective.
By More on Morphisms, Lemma
\ref{more-morphisms-lemma-there-is-a-scheme-integral-over}
we can find a finite surjective morphism $X' \to X$
such that $X' \to X$ Zariski locally factors through $\coprod U_j \to X$.
It follows that $s|_{Z'}$ Zariski locally comes
from a section of $\mathcal{F}|_{X'}$. In other words,
$s|_{Z'}$ comes from $t' \in \Gamma(X', \mathcal{F}|_{X'})$
by assumption (2).
By injectivity we conclude that the two pullbacks of $t'$ to
$X' \times_X X'$ are the same (after all this is true for
the pullbacks of $s$ to $Z' \times_Z Z'$). Hence we conclude
$t'$ comes from a section of $\mathcal{F}$ over $X$ by
Remark \ref{remark-cohomological-descent-finite}.
\end{proof}

\begin{lemma}
\label{lemma-h0-topological}
Let $X$ be a topological space and let $Z \subset X$ be a closed subset.
Suppose that for every $x \in X$ the intersection $Z \cap \overline{\{x\}}$
is connected (in particular nonempty). Then for any sheaf $\mathcal{F}$
on $X$ we have $\Gamma(X, \mathcal{F}) = \Gamma(Z, \mathcal{F}|_Z)$.
\end{lemma}

\begin{proof}
Let's view a global section of $\mathcal{F}$ as an assignment
$x \mapsto s_x \in \mathcal{F}_x$ satisfying the continuity
property (*) introduced in
Sheaves, Section \ref{sheaves-section-sheafification}.
If $x \leadsto z$ is a specialization on $X$, then there is
a corresponding map on stalks $\mathcal{F}_z \to \mathcal{F}_x$.
Thus, given a global section $s = (s_z)_{z \in Z}$ of
$\mathcal{F}|_Z$ we can assign to every $x \in X$ a value
$s_x$ by chooseing a $z \in Z \cap \overline{\{x\}}$
and taking the image of $s_z$. The fact that $s_x$ is independent
of the choice of $z$ comes from the fact that we assumed
$Z \cap \overline{\{x\}}$ is connected (details omitted). It is clear that this
rule satisfies (*) and provides us with a section $\tilde s$ of
$\mathcal{F}$ over $X$ which restricts to $s$.
\end{proof}

\begin{lemma}
\label{lemma-h0-henselian-pair}
Let $(A, I)$ be a henselian pair. Set $X = \Spec(A)$ and
$Z = \Spec(A/I)$. For any sheaf $\mathcal{F}$ on $X_\etale$
we have $\Gamma(X, \mathcal{F}) = \Gamma(Z, \mathcal{F}|_Z)$.
\end{lemma}

\begin{proof}
Combine
Lemmas \ref{lemma-gabber-h0} and \ref{lemma-h0-topological}
and
More on Algebra, Lemmas
\ref{more-algebra-lemma-integral-over-henselian-pair} and
\ref{more-algebra-lemma-irreducible-henselian-pair-connected}.
\end{proof}

\noindent
Finally, we can state and prove Gabber's theorem.

\begin{theorem}[Gabber]
\label{theorem-gabber}
Let $(A, I)$ be a henselian pair. Set $X = \Spec(A)$ and
$Z = \Spec(A/I)$. For any torsion abelian sheaf $\mathcal{F}$ on $X_\etale$
we have $H^q_\etale(X, \mathcal{F}) = H^q_\etale(Z, \mathcal{F}|_Z)$.
\end{theorem}

\begin{proof}
The result holds for $q = 0$ by Lemma \ref{lemma-h0-henselian-pair}.
Let $q \geq 1$. Suppose the result has been shown in all degrees $< q$.
Let $\mathcal{F}$ be a torsion abelian sheaf. Let
$\mathcal{F} \to \mathcal{F}'$
be an injective map of torsion abelian sheaves (to be chosen later)
with cokernel $\mathcal{Q}$ so that we have the short exact sequence
$$
0 \to \mathcal{F} \to \mathcal{F}' \to \mathcal{Q} \to 0
$$
of torsion abelian sheaves on $X_\etale$. This gives a map of long exact
cohomology sequences over $X$ and $Z$ part of which looks like
$$
\xymatrix{
H^{q - 1}_\etale(X, \mathcal{F}') \ar[d] \ar[r] &
H^{q - 1}_\etale(X, \mathcal{Q}) \ar[d] \ar[r] &
H^q_\etale(X, \mathcal{F}) \ar[d] \ar[r] &
H^q_\etale(X, \mathcal{F}') \ar[d] \\
H^{q - 1}_\etale(Z, \mathcal{F}'|_Z) \ar[r] &
H^{q - 1}_\etale(Z, \mathcal{Q}|_Z) \ar[r] &
H^q_\etale(Z, \mathcal{F}|_Z) \ar[r] &
H^q_\etale(Z, \mathcal{F}'|_Z)
}
$$
Using this commutative diagram of abelian groups with exact rows
we will finish the proof.

\medskip\noindent
Injectivity for $\mathcal{F}$. Let $\xi$ be a nonzero element of
$H^q_\etale(X, \mathcal{F})$. By
Lemma \ref{lemma-efface-cohomology-on-closed-by-finite-cover} applied with
$Z = X$ (!) we can find $\mathcal{F} \subset \mathcal{F}'$ such that
$\xi$ maps to zero to the right. Then $\xi$ is the image of
an element of $H^{q - 1}_\etale(X, \mathcal{Q})$ and bijectivity
for $q - 1$ implies $\xi$ does not map to zero in
$H^q_\etale(Z, \mathcal{F}|_Z)$.

\medskip\noindent
Surjectivity for $\mathcal{F}$. Let $\xi$ be an element of
$H^q_\etale(Z, \mathcal{F}|_Z)$. By
Lemma \ref{lemma-efface-cohomology-on-closed-by-finite-cover} applied with
$Z = Z$ we can find $\mathcal{F} \subset \mathcal{F}'$ such that
$\xi$ maps to zero to the right. Then $\xi$ is the image of
an element of $H^{q - 1}_\etale(Z, \mathcal{Q}|_Z)$ and bijectivity
for $q - 1$ implies $\xi$ is in the image of the vertical map.
\end{proof}

\begin{lemma}
\label{lemma-gabber}
Let $(A, I)$ be a henselian pair. Set $X = \Spec(A)$ and $Z = \Spec(A/I)$.
The functor
$$
U \longmapsto U \times_X Z
$$
is an equivalence of categories between finite \'etale schemes over $X$
and finite \'etale schemes over $Z$.
\end{lemma}

\begin{proof}
This is a translation of
More on Algebra, Lemma \ref{more-algebra-lemma-finite-etale-equivalence}.
\end{proof}

\begin{lemma}
\label{lemma-vanishing-restriction-injective}
Let $X$ be a scheme with affine diagonal which can be covered by
$n + 1$ affine opens. Let $Z \subset X$ be a closed subscheme.
Let $\mathcal{A}$ be a torsion sheaf of rings on $X_\etale$
and let $\mathcal{I}$ be an injective sheaf of $\mathcal{A}$-modules
on $X_\etale$.
Then $H^q_\etale(Z, \mathcal{I}|_Z) = 0$ for $q > n$.
\end{lemma}

\begin{proof}
We will prove this by induction on $n$. If $n = 0$, then $X$ is affine.
Say $X = \Spec(A)$ and $Z = \Spec(A/I)$. Let $A^h$ be the filtered colimit
of \'etale $A$-algebras $B$ such that $A/I \to B/IB$ is an isomorphism.
Then $(A^h, IA^h)$ is a henselian pair and $A/I = A^h/IA^h$, see
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}
and its proof. Set $X^h = \Spec(A^h)$.
By Theorem \ref{theorem-gabber}
we see that
$$
H^q_\etale(Z, \mathcal{I}|_Z) = H^q_\etale(X^h, \mathcal{I}|_{X^h})
$$
By Theorem \ref{theorem-colimit} we have
$$
H^q_\etale(X^h, \mathcal{F}|_{X^h}) =
\colim_{A \to B} H^q_\etale(\Spec(B), \mathcal{I}|_{\Spec(B)})
$$
where the colimit is over the $A$-algebras $B$ as above.
Since the morphisms $\Spec(B) \to \Spec(A)$ are \'etale,
the restriction $\mathcal{I}|_{\Spec(B)}$ is an injective
sheaf of $\mathcal{A}|_{\Spec(B)}$-modules
(Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cohomology-of-open}).
Thus the cohomology groups on the right are zero and we get the
result in this case.

\medskip\noindent
Induction step. We can use Mayer-Vietoris to do the induction step.
Namely, suppose that $X = U \cup V$ where $U$ is a union of $n$ affine
opens and $V$ is affine. Then, using that the diagonal of $X$ is affine,
we see that $U \cap V$ is the union of $n$ affine opens. Mayer-Vietoris
gives an exact sequence
$$
H^{q - 1}_\etale(U \cap V \cap Z, \mathcal{F}|_Z) \to
H^q_\etale(Z, \mathcal{I}|_Z) \to
H^q_\etale(U \cap Z, \mathcal{F}|_Z) \oplus
H^q_\etale(V \cap Z, \mathcal{F}|_Z)
$$
and by our induction hypothesis we obtain vanishing for $q > n$ as desired.
\end{proof}





\section{Cohomology of torsion sheaves on curves}
\label{section-vanishing-torsion}

\noindent
The goal of this section is to prove
Theorem \ref{theorem-vanishing-affine-curves}.
The proof uses the ``m\'ethode de la trace''
as explained in \cite[Expos\'e IX, \S5]{SGA4}.

\medskip\noindent
Let $f : Y \to X$ be an \'etale morphism of schemes. There are pairs of
adjoint functors $(f_!, f^{-1})$ and $(f^{-1}, f_*)$ between
$\textit{Ab}(X_\etale)$ and $\textit{Ab}(Y_\etale)$. The
adjunction map $\text{id} \to f_* f^{-1}$ is called {\it restriction}.
The adjunction map $f_* f^{-1} = f_! f^{-1} \to \text{id}$ is often
called the {\it trace map}. If $f$ is finite, then $f_* = f_!$ and
we can view this as a map $f_*f^{-1} \to \text{id}$.

\begin{definition}
\label{definition-trace-map}
Let $f : Y \to X$ be a finite \'etale morphism of schemes.
The map $f_* f^{-1} \to \text{id}$ described above is called the {\it trace}.
\end{definition}

\noindent
Let $f : Y \to X$ be a finite \'etale morphism. The trace map is
characterized by the following two properties:
\begin{enumerate}
\item it commutes with \'etale localization and
\item if $Y = \coprod_{i=1}^d X$ then the trace map is
the sum map $f_*f^{-1} \mathcal{F} = \mathcal{F}^{\oplus d} \to \mathcal{F}$.
\end{enumerate}
It follows that if $f$ has constant degree $d$, then the composition
$$
\mathcal{F} \xrightarrow{res}
f_* f^{-1} \mathcal{F} \xrightarrow{trace}
\mathcal{F}
$$
is multiplication by $d$. An example of the ``m\'ethode de la trace''
is the following observation: if $\mathcal{F}$
is an abelian sheaf on $X_\etale$ such that multiplication by $d$ is an
isomorphism $\mathcal{F} \cong \mathcal{F}$, and if furthermore
$H_\etale^q(Y, f^{-1}\mathcal{F}) = 0$ then
$H_\etale^q(X, \mathcal{F}) = 0$ as well.
Indeed, multiplication by $d$ induces an
isomorphism on $H_\etale^q(X, \mathcal{F})$ which factors through
$H_\etale^q(Y, f^{-1}\mathcal{F})= 0$. This will be used in the proof
of Lemma \ref{lemma-vanishing-easier} below.

\begin{situation}
\label{situation-what-to-prove}
Here $k$ is an algebraically closed field, $X$ is a separated, finite type
scheme of dimension $\leq 1$ over $k$, and $\mathcal{F}$ is a torsion
abelian sheaf on $X_\etale$.
\end{situation}

\noindent
In Situation \ref{situation-what-to-prove}
we want to prove the following statements
\begin{list}{(\thesubsubsection)}{\usecounter{subsubsection}\setlength\labelwidth{1in}}
\item
\label{item-vanishing}
$H^q_\etale(X, \mathcal{F}) = 0$ for $q > 2$,
\item
\label{item-vanishing-affine}
$H^q_\etale(X, \mathcal{F}) = 0$ for $q > 1$ if $X$ is affine,
\item
\label{item-vanishing-p-p}
$H^q_\etale(X, \mathcal{F}) = 0$ for $q > 1$ if $p = \text{char}(k) > 0$
and $\mathcal{F}$ is $p$-power torsion,
\item
\label{item-finite-prime-to-p}
$H^q_\etale(X, \mathcal{F})$ is finite if $\mathcal{F}$ is
constructible and torsion prime to $\text{char}(k)$,
\item
\label{item-finite-proper}
$H^q_\etale(X, \mathcal{F})$ is finite if $X$ is proper and
$\mathcal{F}$ constructible,
\item
\label{item-base-change-prime-to-p}
$H^q_\etale(X, \mathcal{F}) \to
H^q_\etale(X_{k'}, \mathcal{F}|_{X_{k'}})$ is an isomorphism
for any extension $k \subset k'$ of algebraically closed fields
if $\mathcal{F}$ is torsion prime to $\text{char}(k)$,
\item
\label{item-base-change-proper}
$H^q_\etale(X, \mathcal{F}) \to
H^q_\etale(X_{k'}, \mathcal{F}|_{X_{k'}})$ is an isomorphism
for any extension $k \subset k'$ of algebraically closed fields
if $X$ is proper,
\item
\label{item-surjective}
$H^2_\etale(X, \mathcal{F}) \to H^2_\etale(U, \mathcal{F})$
is surjective for all $U \subset X$ open.
\end{list}
Given any Situation \ref{situation-what-to-prove}
we will say that
``statements (\ref{item-vanishing}) -- (\ref{item-surjective}) hold''
if those statements that apply to the given situation are true.
We start the proof with the following consequence of our computation
of cohomology with constant coefficients.

\begin{lemma}
\label{lemma-constant-smooth-statements}
In Situation \ref{situation-what-to-prove}
assume $X$ is smooth and $\mathcal{F} = \underline{\mathbf{Z}/\ell\mathbf{Z}}$
for some prime number $\ell$. Then statements
(\ref{item-vanishing}) -- (\ref{item-surjective}) hold
for $\mathcal{F}$.
\end{lemma}

\begin{proof}
Since $X$ is smooth, we see that $X$ is a finite disjoint union of
smooth curves. Hence we may assume $X$ is a smooth curve.

\medskip\noindent
Case I: $\ell$ different from the characteristic of $k$.
This case follows from
Lemma \ref{lemma-cohomology-smooth-projective-curve}
(projective case) and
Lemma \ref{lemma-vanishing-cohomology-mu-smooth-curve}
(affine case). Statement (\ref{item-base-change-prime-to-p})
on cohomology and extension of algebraically closed ground
field follows from the fact that the genus $g$ and the number
of ``punctures'' $r$ do not change when passing from $k$ to $k'$.
Statement (\ref{item-surjective}) follows as $H^2_\etale(U, \mathcal{F})$
is zero as soon as $U \not = X$, because then $U$ is affine
(Varieties, Lemmas \ref{varieties-lemma-proper-minus-point} and
\ref{varieties-lemma-curve-affine-projective}).

\medskip\noindent
Case II: $\ell$ is equal to the characteristic of $k$.
Vanishing by Lemma \ref{lemma-vanishing-variety-char-p-p}.
Statements (\ref{item-finite-proper}) and (\ref{item-base-change-proper})
follow from
Lemma \ref{lemma-finiteness-proper-variety-char-p-p}.
\end{proof}

\begin{remark}[Invariance under extension of algebraically closed ground field]
\label{remark-invariance}
Let $k$ be an algebraically closed field of characteristic $p > 0$.
In Section \ref{section-artin-schreier} we have seen that there is
an exact sequence
$$
k[x] \to k[x] \to
H^1_\etale(\mathbf{A}^1_k, \mathbf{Z}/p\mathbf{Z}) \to 0
$$
where the first arrow maps $f(x)$ to $f^p - f$. A set of representatives
for the cokernel is formed by the polynomials
$$
\sum\nolimits_{p \not | n} \lambda_n x^n
$$
with $\lambda_n \in k$. (If $k$ is not algebraically closed
you have to add some constants to this as well.) In particular
when $k' \supset k$ is an algebraically closed overfield, then
the map
$$
H^1_\etale(\mathbf{A}^1_k, \mathbf{Z}/p\mathbf{Z})
\to
H^1_\etale(\mathbf{A}^1_{k'}, \mathbf{Z}/p\mathbf{Z})
$$
is not an isomorphism in general. In particular, the map
$\pi_1(\mathbf{A}^1_{k'}) \to \pi_1(\mathbf{A}^1_k)$
between \'etale fundamental groups (insert future reference here)
is not an isomorphism either. Thus the \'etale homotopy type
of the affine line depends on the algebraically closed ground field.
From Lemma \ref{lemma-constant-smooth-statements} above we see that
this is a phenomenon which only happens in characteristic $p$
with $p$-power torsion coefficients.
\end{remark}

\begin{lemma}
\label{lemma-ses-statements}
Let $k$ be an algebraically closed field. Let $X$ be a separated finite
type scheme over $k$ of dimension $\leq 1$. Let
$0 \to \mathcal{F}_1 \to \mathcal{F} \to \mathcal{F}_2 \to 0$
be a short exact sequence of torsion abelian sheaves on $X$.
If statements (\ref{item-vanishing}) -- (\ref{item-surjective}) hold
for $\mathcal{F}_1$ and $\mathcal{F}_2$, then they hold
for $\mathcal{F}$.
\end{lemma}

\begin{proof}
This is mostly immediate from the definitions and the long exact sequence
of cohomology. Also observe that $\mathcal{F}$ is constructible
(resp.\ of torsion prime to the characteristic of $k$) if and only if
both $\mathcal{F}_1$ and $\mathcal{F}_2$ are constructible
(resp.\ of torsion prime to the characteristic of $k$). See
Proposition \ref{proposition-constructible-over-noetherian}.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-finite-pushforward-statements}
Let $k$ be an algebraically closed field. Let $f : X \to Y$ be a
finite morphism of separated finite type schemes over $k$ of
dimension $\leq 1$. Let $\mathcal{F}$ be a torsion abelian sheaf on $X$.
If statements (\ref{item-vanishing}) -- (\ref{item-surjective}) hold
for $\mathcal{F}$, then they hold for $f_*\mathcal{F}$.
\end{lemma}

\begin{proof}
Follows from the vanishing of the higher direct images $R^qf_*$
(Proposition \ref{proposition-finite-higher-direct-image-zero}),
the Leray spectral sequence  (Proposition \ref{proposition-leray}),
and the fact that formation of $f_*$ commutes with arbitrary base change
(Lemma \ref{lemma-finite-pushforward-commutes-with-base-change}).
\end{proof}

\begin{lemma}
\label{lemma-even-easier}
In Situation \ref{situation-what-to-prove} assume $X$ is smooth.
Let $j : U \to X$ an open immersion. Let $\ell$ be a prime number.
Let $\mathcal{F} = j_!\underline{\mathbf{Z}/\ell\mathbf{Z}}$.
Then statements (\ref{item-vanishing}) -- (\ref{item-surjective}) hold
for $\mathcal{F}$.
\end{lemma}

\begin{proof}
Consider the short exact sequence
$$
0 \longrightarrow j_!\underline{\mathbf{Z}/\ell\mathbf{Z}}_U
\longrightarrow \underline{\mathbf{Z}/\ell\mathbf{Z}}_X \longrightarrow
\bigoplus\nolimits_{x \in X \setminus U}
{i_x}_*(\underline{\mathbf{Z}/\ell\mathbf{Z}})
\longrightarrow 0.
$$
Statements (\ref{item-vanishing}) -- (\ref{item-surjective}) hold
for $\underline{\mathbf{Z}/\ell\mathbf{Z}}$ by
Lemma \ref{lemma-constant-smooth-statements}.
Since the inclusion morphisms $i_x : x \to X$ are finite
and since $x$ is the spectrum of an irreducible curve,
we see that $H^q_\etale(X, i_{x*}\underline{\mathbf{Z}/\ell\mathbf{Z}})$
is zero for $q > 0$ and equal to $\mathbf{Z}/\ell\mathbf{Z}$
for $q = 0$. Thus we get from the long exact cohomology sequence
$$
\xymatrix{
0 \ar[r] &
H^0_\etale(X, \mathcal{F}) \ar[r] &
H^0(X, \underline{\mathbf{Z}/\ell\mathbf{Z}}_X) \ar[r] &
\bigoplus\nolimits_{x \in X \setminus U} \mathbf{Z}/\ell\mathbf{Z}
\ar@(rd, ul)[rdllllr] \\
 & H^1_\etale(X, \mathcal{F}) \ar[r] &
H^1_\etale(X, \underline{\mathbf{Z}/\ell\mathbf{Z}}_X) \ar[r] & 0
}
$$
and $H^q_\etale(X, \mathcal{F}) =
H^q_\etale(X, \underline{\mathbf{Z}/\ell\mathbf{Z}}_X)$
for $q \geq 2$. Each of the statements 
(\ref{item-vanishing}) -- (\ref{item-surjective}) follows by inspection.
\end{proof}

\begin{lemma}
\label{lemma-somewhat-easier}
In Situation \ref{situation-what-to-prove} assume $X$ reduced.
Let $j : U \to X$ an open immersion. Let $\ell$ be a prime number
and $\mathcal{F} = j_! \underline{\mathbf{Z}/\ell\mathbf{Z}}$.
Then statements (\ref{item-vanishing}) -- (\ref{item-surjective}) hold
for $\mathcal{F}$.
\end{lemma}

\begin{proof}
The difference with Lemma \ref{lemma-even-easier} is that here we do not
assume $X$ is smooth. Let $\nu : X' \to X$ be the normalization
morphism which is finite as varieties are Nagata schemes.
Let $j' : U' \to X'$ be the inverse image of $U$.
By Lemma \ref{lemma-even-easier} the result holds for
$j'_!\underline{\mathbf{Z}/\ell\mathbf{Z}}$.
By Lemma \ref{lemma-finite-pushforward-statements}
the result holds for $\nu_*j'_!\underline{\mathbf{Z}/\ell\mathbf{Z}}$.
In general it won't be true that
$\nu_*j'_!\underline{\mathbf{Z}/\ell\mathbf{Z}}$ is equal to
$j_!\underline{\mathbf{Z}/\ell\mathbf{Z}}$, but there will be a canonical
injective map
$$
j_!\underline{\mathbf{Z}/\ell\mathbf{Z}} \longrightarrow
\nu_*j'_!\underline{\mathbf{Z}/\ell\mathbf{Z}}
$$
whose cokernel is of the form $\bigoplus_{x \in Z} i_{x *}M_x$
where $Z \subset X$ is a finite set of closed points and $M_x$
is a finite dimensional $\mathbf{F}_\ell$-vector space for each
$x \in Z$. We obtain a short exact sequence
$$
0 \to j_!\underline{\mathbf{Z}/\ell\mathbf{Z}} \to
\nu_*j'_!\underline{\mathbf{Z}/\ell\mathbf{Z}} \to
\bigoplus\nolimits_{x \in Z} i_{x *}M_x \to 0
$$
and we can argue exactly as in the proof of Lemma \ref{lemma-even-easier}
to finish the argument. Some details omitted.
\end{proof}

\begin{exercise}
\label{exercise-finite-etale-under-galois}
Let $f: X \to Y$ be a finite \'etale morphism with $X$ and $Y$
irreducible. Then there exists a finite \'etale Galois
morphism $X' \to Y$ which dominates $X$ over $Y$.
\end{exercise}

\begin{lemma}
\label{lemma-pullback-filtered}
Let $S$ be an irreducible scheme. Let $\ell$ be a prime number. Let
$\mathcal{F}$ a finite locally constant sheaf of $\mathbf{F}_\ell$-vector
spaces on $S_\etale$. There exists a finite \'etale morphism
$f : T \to S$ of degree prime to $\ell$ such that $f^{-1}\mathcal{F}$
has a finite filtration whose successive quotients are
$\underline{\mathbf{Z}/\ell\mathbf{Z}}_T$.
\end{lemma}

\begin{proof}
Since $\mathcal{F}$ is finite locally constant and $S$ irreducible, we
see that $\mathcal{F}$ has constant rank $r$. Let $T \to S$ be a finite
\'etale covering such that $f^{-1}\mathcal{F}$ is isomorphic to
$\underline{\mathbf{Z}/\ell \mathbf{Z}}^{\oplus r}$.
We may assume $T$ is irreducible and $T \to S$ is Galois with group $G$.
This means simply that we have $G \subset \text{Aut}(T/S)$ and that
$G$ maps isomorphically to the Galois group of the field extension
in the generic points. Observe that the action of $G$ on $T$ lifts to
an action of $G$ on
$f^{-1}\mathcal{F} \cong \underline{\mathbf{Z}/\ell \mathbf{Z}}^{\oplus r}$.
Looking at the stalk in the generic point we obtain a representation
$\rho : G \to \text{GL}_r(\mathbf{F}_\ell)$. Let $H \subset G$ be an
$\ell$-Sylow subgroup. We claim that $T/H \to S$ works. Namely, since
$H$ is a finite $\ell$-group, the irreducible constituents of the
representation $\rho|_H$ are each trivial of rank $1$. Moreover the
degree of $T/H \to S$ is prime to $\ell$. Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-vanishing-easier}
In Situation \ref{situation-what-to-prove} assume $X$ reduced.
Let $j : U \to X$ an open immersion with $U$ irreducible. Let
$\ell$ be a prime number. Let $\mathcal{G}$ a finite locally
constant sheaf of $\mathbf{F}_\ell$-vector spaces on $U$. Let
$\mathcal{F} = j_!\mathcal{G}$. Then statements
(\ref{item-vanishing}) -- (\ref{item-surjective}) hold for $\mathcal{F}$.
\end{lemma}

\begin{proof}
Let $f : V \to U$ be a finite \'etale morphism of degree prime to $\ell$
as in Lemma \ref{lemma-pullback-filtered}. The trace map gives
maps
$$
\mathcal{G} \to f_*f^{-1}\mathcal{G} \to \mathcal{G}
$$
whose composition is an isomorphism. Hence it suffices to prove the
lemma with $\mathcal{F} = j_!f_*f^{-1}\mathcal{G}$.
By Zariski's Main theorem
(More on Morphisms, Lemma
\ref{more-morphisms-lemma-quasi-finite-separated-pass-through-finite})
we can choose a diagram
$$
\xymatrix{
V \ar[r]_{j'} \ar[d]_f & Y \ar[d]^{\overline{f}} \\
U \ar[r]^j & X
}
$$
with $\overline{f} : Y \to X$ finite and $j'$ an open immersion
with dense image. Since $f$ is finite this implies that
$V = U \times_X Y$. Hence
$j_!f_*f^{-1}\mathcal{G} = \overline{f}_*j'_!f^{-1}\mathcal{G}$ by
Lemma \ref{lemma-finite-pushforward-commutes-with-base-change}.
By Lemma \ref{lemma-finite-pushforward-statements} it suffices to
prove the lemma for $j'_!f^{-1}\mathcal{G}$.
The existence of the filtration given by
Lemma \ref{lemma-pullback-filtered},
the fact that $j'_!$ is exact, and
Lemma \ref{lemma-ses-statements}
reduces us to the case
$\mathcal{F} = j'_!\underline{\mathbf{Z}/\ell\mathbf{Z}}$
which is Lemma \ref{lemma-somewhat-easier}.
\end{proof}


%10.20.09

\begin{theorem}
\label{theorem-vanishing-affine-curves}
If $k$ is an algebraically closed field, $X$ is a separated, finite type
scheme of dimension $\leq 1$ over $k$, and $\mathcal{F}$ is a torsion
abelian sheaf on $X_\etale$, then
\begin{enumerate}
\item
$H^q_\etale(X, \mathcal{F}) = 0$ for $q > 2$,
\item
$H^q_\etale(X, \mathcal{F}) = 0$ for $q > 1$ if $X$ is affine,
\item
$H^q_\etale(X, \mathcal{F}) = 0$ for $q > 1$ if $p = \text{char}(k) > 0$
and $\mathcal{F}$ is $p$-power torsion,
\item
$H^q_\etale(X, \mathcal{F})$ is finite if $\mathcal{F}$ is
constructible and torsion prime to $\text{char}(k)$,
\item
$H^q_\etale(X, \mathcal{F})$ is finite if $X$ is proper and
$\mathcal{F}$ constructible,
\item
$H^q_\etale(X, \mathcal{F}) \to
H^q_\etale(X_{k'}, \mathcal{F}|_{X_{k'}})$ is an isomorphism
for any extension $k \subset k'$ of algebraically closed fields
if $\mathcal{F}$ is torsion prime to $\text{char}(k)$,
\item
$H^q_\etale(X, \mathcal{F}) \to
H^q_\etale(X_{k'}, \mathcal{F}|_{X_{k'}})$ is an isomorphism
for any extension $k \subset k'$ of algebraically closed fields
if $X$ is proper,
\item
$H^2_\etale(X, \mathcal{F}) \to H^2_\etale(U, \mathcal{F})$
is surjective for all $U \subset X$ open.
\end{enumerate}
\end{theorem}

\begin{proof}
The theorem says that in Situation \ref{situation-what-to-prove}
statements (\ref{item-vanishing}) -- (\ref{item-surjective}) hold.
Our first step is to replace $X$ by its reduction, which is permissible
by Proposition \ref{proposition-topological-invariance}.
By Lemma \ref{lemma-torsion-colimit-constructible} we can write
$\mathcal{F}$ as a filtered colimit of constructible abelian sheaves.
Taking cohomology commutes with colimits, see Lemma \ref{lemma-colimit}.
Moreover, pullback via $X_{k'} \to X$ commutes with colimits as a left
adjoint. Thus it suffices to prove the statements for a constructible sheaf.

\medskip\noindent
In this paragraph we use Lemma \ref{lemma-ses-statements} without further
mention. Writing
$\mathcal{F} = \mathcal{F}_1 \oplus \cdots \oplus \mathcal{F}_r$
where $\mathcal{F}_i$ is $\ell_i$-primary for some prime $\ell_i$, we may
assume that $\ell^n$ kills $\mathcal{F}$ for some prime $\ell$. Now consider
the exact sequence
$$
0 \to \mathcal{F}[\ell] \to \mathcal{F} \to \mathcal{F}/\mathcal{F}[\ell] \to 0.
$$
Thus we see that it suffices to assume that $\mathcal{F}$ is $\ell$-torsion.
This means that $\mathcal{F}$ is a constructible sheaf of
$\mathbf{F}_\ell$-vector spaces for some prime number $\ell$.

\medskip\noindent
By definition this means there is a dense open $U \subset X$
such that $\mathcal{F}|_U$ is finite locally constant sheaf of
$\mathbf{F}_\ell$-vector spaces. Since $\dim(X) \leq 1$ we may
assume, after shrinking $U$, that $U = U_1 \amalg \ldots \amalg U_n$
is a disjoint union of irreducible schemes (just remove the closed
points which lie in the intersections of $\geq 2$ components of $U$).
Consider the short exact sequence
$$
0 \to j_!j^{-1}\mathcal{F} \to \mathcal{F} \to
\bigoplus\nolimits_{x \in Z} i_{x *}M_x \to 0
$$
where $Z = X \setminus U$ and $M_x$ is a finite dimensional $\mathbf{F}_\ell$
vector space, see
Lemma \ref{lemma-ses-associated-to-open}. Since the \'etale cohomology
of $i_{x *}M_x$ vanishes in degrees $\geq 1$ and is equal to
$M_x$ in degree $0$ it suffices to prove the theorem for
$j_!j^{-1}\mathcal{F}$ (argue exactly as in the proof of
Lemma \ref{lemma-even-easier}). Thus we reduce to the case
$\mathcal{F} = j_!\mathcal{G}$ where
$\mathcal{G}$ is a finite locally constant sheaf of $\mathbf{F}_\ell$-vector
spaces on $U$.

\medskip\noindent
Since we chose $U = U_1 \amalg \ldots \amalg U_n$ with $U_i$ irreducible
we have
$$
j_!\mathcal{G} =
j_{1!}(\mathcal{G}|_{U_1}) \oplus \ldots \oplus
j_{n!}(\mathcal{G}|_{U_n})
$$
where $j_i : U_i \to X$ is the inclusion morphism.
The case of $j_{i!}(\mathcal{G}|_{U_i})$ is handled in
Lemma \ref{lemma-vanishing-easier}.
\end{proof}

\begin{remarks}
\label{remarks-on-above}
The ``trace method'' is very general. For instance, it applies in Galois
cohomology, and this is essentially how
Proposition \ref{proposition-serre-galois} is proved.
\end{remarks}

\begin{theorem}
\label{theorem-vanishing-curves}
Let $X$ be a finite type, dimension $1$ scheme over an
algebraically closed field $k$. Let $\mathcal{F}$ be a torsion sheaf
on $X_\etale$. Then
$$
H_\etale^q(X, \mathcal{F}) = 0, \quad \forall q \geq 3.
$$
If $X$ affine then also $H_\etale^2(X, \mathcal{F}) = 0$.
\end{theorem}

\begin{proof}
If $X$ is separated, this follows immediately from the more precise
Theorem \ref{theorem-vanishing-affine-curves}.
If $X$ is nonseparated, choose an affine open covering
$X = X_1 \cup \ldots \cup X_n$. By induction on $n$ we may assume
the vanishing holds over $U = X_1 \cup \ldots \cup X_{n - 1}$.
Then Mayer-Vietoris (Lemma \ref{lemma-mayer-vietoris}) gives
$$
H^2_\etale(U, \mathcal{F}) \oplus H^2_\etale(X_n, \mathcal{F}) \to
H^2_\etale(U \cap X_n, \mathcal{F}) \to
H^3_\etale(X, \mathcal{F}) \to 0
$$
However, since $U \cap X_n$ is an open of an affine scheme
and hence affine by our dimension assumption, the group
$H^2_\etale(U \cap X_n, \mathcal{F})$ vanishes
by Theorem \ref{theorem-vanishing-affine-curves}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-dim-1-separably-closed}
Let $k \subset k'$ be an extension of separably closed fields.
Let $X$ be a proper scheme over $k$ of dimension $\leq 1$.
Let $\mathcal{F}$ be a torsion abelian sheaf on $X$.
Then the map $H^q_\etale(X, \mathcal{F}) \to
H^q_\etale(X_{k'}, \mathcal{F}|_{X_{k'}})$ is an isomorphism
for $q \geq 0$.
\end{lemma}

\begin{proof}
We have seen this for algebraically closed fields in
Theorem \ref{theorem-vanishing-affine-curves}.
Given $k \subset k'$ as in the statement of the lemma we can
choose a diagram
$$
\xymatrix{
k' \ar[r] & \overline{k}' \\
k \ar[u] \ar[r] & \overline{k} \ar[u]
}
$$
where $k \subset \overline{k}$ and $k' \subset \overline{k}'$ are
the algebraic closures. Since $k$ and $k'$ are separably closed
the field extensions
$k \subset \overline{k}$ and $k' \subset \overline{k}'$
are algebraic and purely inseparable. In this case the morphisms
$X_{\overline{k}} \to X$ and $X_{\overline{k}'} \to X_{k'}$
are universal homeomorphisms. Thus the cohomology of $\mathcal{F}$
may be computed on $X_{\overline{k}}$ and the cohomology
of $\mathcal{F}|_{X_{k'}}$ may be computed on $X_{\overline{k}'}$,
see Proposition \ref{proposition-topological-invariance}.
Hence we deduce the general case from the case of algebraically
closed fields.
\end{proof}



\section{Finite \'etale covers of proper schemes}
\label{section-finite-etale-over-proper}

\noindent
The results in this section in some sense say that taking
$R^1f_*\underline{G}$ commute with base change if $f : X \to Y$
is a proper morphism and $G$ is a finite group.

\begin{lemma}
\label{lemma-finite-etale-on-proper-over-henselian}
Let $A$ be a henselian local ring. Let $X$ be a proper scheme over $A$
with closed fibre $X_0$. Then the functor
$$
U \longmapsto U_0 = U \times_X X_0
$$
is an equivalence of categories between schemes finite \'etale over
$X$ and schemes finite \'etale over $X_0$.
\end{lemma}

\begin{proof}
The proof given here is an example of applying algebraization and
approximation. We proceed in a number of stages.

\medskip\noindent
Essential surjectivity when $A$ is a complete local Noetherian ring.
Let $X_n = X \times_{\Spec(A)} \Spec(A/\mathfrak m^{n + 1})$.
By Proposition \ref{proposition-topological-invariance}
the inclusions
$$
X_0 \to X_1 \to X_2 \to \ldots
$$
induce equivalence of categories between small \'etale sites.
Moreover, if $U_n \to X_n$ corresponds to a finite \'etale
morphism $U_0 \to X_0$, then $U_n \to X_n$ is finite too, for example
by More on Morphisms, Lemma
\ref{more-morphisms-lemma-thicken-property-morphisms-cartesian}.
In this case the morphism $U_0 \to \Spec(A/\mathfrak m)$
is proper as $X_0$ is proper over $A/\mathfrak m$. Thus we may apply
Grothendieck's algebraization theorem
(in the form of
Cohomology of Schemes, Lemma
\ref{coherent-lemma-algebraize-formal-scheme-finite-over-proper})
to see that there is a finite morphism $U \to X$ whose restriction
to $X_0$ recovers $U_0$. By More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}
we see that $U \to X$ is \'etale at every point of $U_0$.
However, since every point of $U$ specializes to a point of $U_0$
(as $U$ is proper over $A$), we conclude that $U \to X$ is \'etale.
In this way we conclude the functor is essentially surjective.

\medskip\noindent
Fully faithfulness when $A$ is a complete local Noetherian ring.
Let $U \to X$ and $V \to X$ be finite \'etale morphisms and
let $\varphi_0 : U_0 \to V_0$ be a morphism over $X_0$. Look at
the morphism
$$
\Gamma_{\varphi_0} : U_0 \longrightarrow U_0 \times_{X_0} V_0
$$
This morphism is both finite \'etale and a closed immersion.
By essential surjectivity aplied to $X = U \times_X V$ we find
a finite \'etale morphism $W \to U \times_X V$ whose special
fibre is isomorphic to $\Gamma_{\varphi_0}$. Consider the projection
$W \to U$. It is finite \'etale and an isomorphism over $U_0$ by
construction. By \'Etale Morphisms, Lemma
\ref{etale-lemma-finite-etale-one-point}
$W \to U$ is an isomorphism in an open neighbourhood of $U_0$.
Thus it is an isomorphism and the composition $\varphi : U \cong W \to V$
is the desired lift of $\varphi_0$.

\medskip\noindent
Essential surjectivity when $A$ is a henselian local Noetherian G-ring.
Let $U_0 \to X_0$ be a finite \'etale morphism.
Let $A^\wedge$ be the completion of $A$ with respect to the maximal ideal.
Let $X^\wedge$ be the base change of $X$ to $A^\wedge$.
By the result above there exists a finite \'etale morphism
$V \to X^\wedge$ whose special fibre is $U_0$.
Write $A^\wedge = \colim A_i$ with $A \to A_i$ of finite type.
By Limits, Lemma \ref{limits-lemma-descend-finite-presentation}
there exists an $i$ and a finitely presented morphism $U_i \to X_{A_i}$
whose base change to $X^\wedge$ is $V$. After increasing $i$
we may assume that $U_i \to X_{A_i}$ is finite and \'etale
(Limits, Lemmas \ref{limits-lemma-descend-finite-finite-presentation} and
\ref{limits-lemma-descend-etale}). Writing
$$
A_i = A[x_1, \ldots, x_n]/(f_1, \ldots, f_m)
$$
the ring map $A_i \to A^\wedge$ can be reinterpreted as a solution
$(a_1, \ldots, a_n)$ in $A^\wedge$ for the system of equations $f_j = 0$.
By Smoothing Ring Maps, Theorem \ref{smoothing-theorem-approximation-property}
we can approximate this solution (to order $11$ for example) by a solution
$(b_1, \ldots, b_n)$ in $A$. Translating back we find an $A$-algebra map
$A_i \to A$ which gives the same closed point as the original map
$A_i \to A^\wedge$ (as $11 > 1$). The base change $U \to X$ of $V \to X_{A_i}$
by this ring map will therefore be a finite \'etale morphsm whose
special fibre is isomorphic to $U_0$.

\medskip\noindent
Fully faithfulness when $A$ is a henselian local Noetherian G-ring.
This can be deduced from essential surjectivity in exactly the same
manner as was done in the case that $A$ is complete Noetherian.

\medskip\noindent
General case. Let $(A, \mathfrak m)$ be a henselian local ring.
Set $S = \Spec(A)$ and denote $s \in S$ the closed point. By Limits, Lemma
\ref{limits-lemma-proper-limit-of-proper-finite-presentation-noetherian}
we can write $X \to \Spec(A)$ as a cofiltered limit of
proper morphisms $X_i \to S_i$ with $S_i$ of finite type over $\mathbf{Z}$.
For each $i$ let $s_i \in S_i$ be the image of $s$.
Since $S = \lim S_i$ and $A = \mathcal{O}_{S, s}$ we have
$A = \colim \mathcal{O}_{S_i, s_i}$. The ring $A_i = \mathcal{O}_{S_i, s_i}$
is a Noetherian local G-ring (More on Algebra, Proposition
\ref{more-algebra-proposition-ubiquity-G-ring}).
By More on Algebra, Lemma \ref{more-algebra-lemma-henselization-colimit}
we see that $A = \colim A_i^h$. By
More on Algebra, Lemma \ref{more-algebra-lemma-henselization-G-ring}
the rings $A_i^h$ are G-rings. Thus we see that $A = \colim A_i^h$ and
$$
X = \lim (X_i \times_{S_i} \Spec(A_i^h))
$$
as schemes. The category of schemes finite \'etale over $X$ is the limit
of the category of schemes finite \'etale over
$X_i \times_{S_i} \Spec(A_i^h)$ (by
Limits, Lemmas
\ref{limits-lemma-descend-finite-presentation},
\ref{limits-lemma-descend-finite-finite-presentation}, and
\ref{limits-lemma-descend-etale})
The same thing is true for schemes finite \'etale over
$X_0 = \lim (X_i \times_{S_i} s_i)$.
Thus we formally deduce the result for $X / \Spec(A)$
from the result for the $(X_i \times_{S_i} \Spec(A_i^h)) / \Spec(A_i^h)$
which we dealt with above.
\end{proof}

\begin{lemma}
\label{lemma-finite-etale-invariant-over-proper}
Let $k \subset k'$ be an extension of algebraically closed fields.
Let $X$ be a proper scheme over $k$. Then the functor
$$
U \longmapsto U_{k'}
$$
is an equivalence of categories between schemes finite \'etale over
$X$ and schemes finite \'etale over $X_{k'}$.
\end{lemma}

\begin{proof}
Let us prove the functor is essentially surjective.
Let $U' \to X_{k'}$ be a finite \'etale morphism.
Write $k' = \colim A_i$ as a filtered colimit of finite type $k$-algebras.
By Limits, Lemma \ref{limits-lemma-descend-finite-presentation}
there exists an $i$ and a finitely presented morphism $U_i \to X_{A_i}$
whose base change to $X_{k'}$ is $U'$. After increasing $i$
we may assume that $U_i \to X_{A_i}$ is finite and \'etale
(Limits, Lemmas \ref{limits-lemma-descend-finite-finite-presentation} and
\ref{limits-lemma-descend-etale}).
Since $k$ is algebraically closed we can find a
$k$-valued point $t$ in $\Spec(A_i)$. Let $U = (U_i)_t$ be the
fibre of $U_i$ over $t$. Let $A_i^h$ be the
henselization of $(A_i)_{\mathfrak m}$ where $\mathfrak m$ is
the maximal ideal corresponding to the point $t$. By
Lemma \ref{lemma-finite-etale-on-proper-over-henselian}
we see that $(U_i)_{A_i^h} = U \times \Spec(A_i^h)$ as schemes
over $X_{A_i^h}$. Now since
$A_i^h$ is algebraic over $A_i$ (see for example discussion in
Smoothing Ring Maps, Example \ref{smoothing-example-describe-henselian})
and since $k'$ is algebraically closed
we can find a ring map $A_i^h \to k'$ extending the given
incusion $A_i \subset k'$. Hence we conclude that $U'$
is isomorphic to the base change of $U$.
The proof of fully faithfulness is exactly the same.
\end{proof}

\begin{lemma}
\label{lemma-proper-over-henselian-and-h1}
Let $A$ be a henselian local ring. Let $X$ be a proper scheme over $A$
with closed fibre $X_0$. Let $M$ be a finite abelian group.
Then $H^1_\etale(X, \underline{M}) = H^1_\etale(X_0, \underline{M})$.
\end{lemma}

\begin{proof}
By Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-torsors-h1}
an element of $H^1_\etale(X, \underline{M})$ corresponds to a
$\underline{M}$-torsor $\mathcal{F}$ on $X_\etale$.
Such a torsor is clearly a finite locally constant sheaf.
Hence $\mathcal{F}$ is representable by a scheme $V$ finite
\'etale over $X$, Lemma \ref{lemma-characterize-finite-locally-constant}.
Conversely, a scheme $V$ finite \'etale over $X$ with an $M$-action
which turns it into an $M$-torsor over $X$ gives rise to a cohomology
class. The same translation between cohomology classes over $X_0$ and
torsors finite \'etale over $X_0$ holds. Thus the lemma
is a consequence of the equivalence of categories of
Lemma \ref{lemma-finite-etale-on-proper-over-henselian}.
\end{proof}

\noindent
The following technical lemma is a key ingredient in the proof of
the proper base change theorem. The argument can be made to work
for any proper scheme over $A$ whose special fibre has dimension
$\leq 1$, but in fact the conclusion will be a consequence of the
proper base change theorem and we only need this particular version
in its proof.

\begin{lemma}
\label{lemma-efface-cohomology-on-fibre-by-finite-cover}
Let $A$ be a henselian local ring. Let $X = \mathbf{P}^1_A$.
Let $X_0 \subset X$ be the closed fibre. Let $\ell$ be a prime
number. Let $\mathcal{I}$ be an injective sheaf of
$\mathbf{Z}/\ell\mathbf{Z}$-modules on $X_\etale$. Then
$H^q_\etale(X_0, \mathcal{I}|_{X_0}) = 0$ for $q > 0$.
\end{lemma}

\begin{proof}
Observe that $X$ is a separated scheme which can be covered by $2$
affine opens. Hence for $q > 1$ this follows from Gabber's affine
variant of the proper base change theorem, see
Lemma \ref{lemma-vanishing-restriction-injective}.
Thus we may assume $q = 1$. Let
$\xi \in H^1_\etale(X_0, \mathcal{I}|_{X_0})$.
Goal: show that $\xi$ is $0$.
By Lemmas \ref{lemma-torsion-colimit-constructible} and
\ref{lemma-colimit} we can find a map $\mathcal{F} \to \mathcal{I}$
with $\mathcal{F}$ a constructible sheaf of
$\mathbf{Z}/\ell\mathbf{Z}$-modules
and $\xi$ coming from an element $\zeta$ of
$H^1_\etale(X_0, \mathcal{F}|_{X_0})$. Suppose we have an injective map
$\mathcal{F} \to \mathcal{F}'$ of sheaves of
$\mathbf{Z}/\ell\mathbf{Z}$-modules on $X_\etale$.
Since $\mathcal{I}$ is injective we can extend the given map
$\mathcal{F} \to \mathcal{I}$ to a map $\mathcal{F}' \to \mathcal{I}$.
In this situation we may replace $\mathcal{F}$ by $\mathcal{F}'$
and $\zeta$ by the image of $\zeta$ in $H^1_\etale(X_0, \mathcal{F}'|_{X_0})$.
Also, if $\mathcal{F} = \mathcal{F}_1 \oplus \mathcal{F}_2$ is a direct sum,
then we may replace $\mathcal{F}$ by $\mathcal{F}_i$
and $\zeta$ by the image of $\zeta$ in $H^1_\etale(X_0, \mathcal{F}_i|_{X_0})$.

\medskip\noindent
By Lemma \ref{lemma-constructible-maps-into-constant-general}
and the remarks above we may assume $\mathcal{F}$
is of the form $f_*\underline{M}$ where $M$ is a finite
$\mathbf{Z}/\ell\mathbf{Z}$-module
and $f : Y \to X$ is a finite morphism of finite presentation
(such sheaves are still constructible by
Lemma \ref{lemma-finite-pushforward-constructible}
but we won't need this).
Since formation of $f_*$ commutes with any base change
(Lemma \ref{lemma-finite-pushforward-commutes-with-base-change})
we see that the restriction of $f_*\underline{M}$ to $X_0$ is
equal to the pushforward of $\underline{M}$ via the induced morphism
$Y_0 \to X_0$ of special fibres. By the Leray spectral sequence
(Proposition \ref{proposition-leray})
and vanishing of higher direct images
(Proposition \ref{proposition-finite-higher-direct-image-zero}),
we find
$$
H^1_\etale(X_0, f_*\underline{M}|_{X_0}) = H^1_\etale(Y_0, \underline{M}).
$$
Since $Y \to \Spec(A)$ is proper we can use
Lemma \ref{lemma-proper-over-henselian-and-h1} to see that
the $H^1_\etale(Y_0, \underline{M})$ is equal to
$H^1_\etale(Y, \underline{M})$. Thus we see that our cohomology
class $\zeta$ lifts to a cohomology class
$$
\tilde\zeta \in H^1_\etale(Y, \underline{M}) = H^1_\etale(X, f_*\underline{M})
$$
However, $\tilde \zeta$ maps to zero in
$H^1_\etale(X, \mathcal{I})$ as $\mathcal{I}$ is injective
and by commutativity of
$$
\xymatrix{
H^1_\etale(X, f_*\underline{M}) \ar[r] \ar[d] &
H^1_\etale(X, \mathcal{I}) \ar[d] \\
H^1_\etale(X_0, (f_*\underline{M})|_{X_0}) \ar[r] &
H^1_\etale(X_0, \mathcal{I}|_{X_0})
}
$$
we conclude that the image $\xi$ of $\zeta$ is zero as well.
\end{proof}







\section{The proper base change theorem}
\label{section-proper-base-change}

\noindent
The proper base change theorem is stated and proved in this section.
Our approach follows roughly the proof in \cite[XII, Theorem 5.1]{SGA4}
using Gabber's ideas (from the affine case) to slightly simplify
the arguments.

\begin{lemma}
\label{lemma-zariski-h0-proper-over-henselian-pair}
Let $(A, I)$ be a henselian pair. Let $f : X \to \Spec(A)$ be a proper morphism
of schemes. Let $Z = X \times_{\Spec(A)} \Spec(A/I)$. For any
sheaf $\mathcal{F}$ on the topological space associated to $X$ we
have $\Gamma(X, \mathcal{F}) = \Gamma(Z, \mathcal{F}|_Z)$.
\end{lemma}

\begin{proof}
We will use Lemma \ref{lemma-h0-topological} to prove this. To do this
let $Y \subset X$ be an irreducible closed subscheme. We have to show
that $Y \cap Z = Y \times_{\Spec(A)} \Spec(A/I)$ is connected. Thus
we may assume that $X$ is irreducible and we have to show that $Z$
is connected. Let $X \to \Spec(B) \to \Spec(A)$ be the Stein factorization
of $f$ (More on Morphisms, Theorem
\ref{more-morphisms-theorem-stein-factorization-general}).
Then $A \to B$ is integral and $(B, IB)$ is a henselian pair
(More on Algebra, Lemma \ref{more-algebra-lemma-integral-over-henselian-pair}).
Thus we may assume the fibres of $X \to \Spec(A)$ are geometrically
connected. On the other hand, the image $T \subset \Spec(A)$ of $f$
is irreducible and closed as $X$ is proper over $A$. Hence $T \cap V(I)$
is connected by More on Algebra, Lemma
\ref{more-algebra-lemma-irreducible-henselian-pair-connected}.
Now $Y \times_{\Spec(A)} \Spec(A/I) \to T \cap V(I)$
is a surjective closed map with connected fibres.
The result now follows from Topology, Lemma
\ref{topology-lemma-connected-fibres-quotient-topology-connected-components}.
\end{proof}

\begin{lemma}
\label{lemma-h0-proper-over-henselian-pair}
Let $(A, I)$ be a henselian pair. Let $f : X \to \Spec(A)$ be a proper morphism
of schemes. Let $i: Z \to X$ be the closed immersion of
$X \times_{\Spec(A)} \Spec(A/I)$ into $X$. For any
sheaf $\mathcal{F}$ on $X_\etale$ we
have $\Gamma(X, \mathcal{F}) = \Gamma(Z, i_{small}^{-1}\mathcal{F})$.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-gabber-h0} and
\ref{lemma-zariski-h0-proper-over-henselian-pair}
and the fact that any scheme finite over $X$ is proper over $\Spec(A)$.
\end{proof}

\begin{lemma}
\label{lemma-h0-proper-over-henselian-local}
Let $A$ be a henselian local ring. Let $f : X \to \Spec(A)$
be a proper morphism of schemes. Let $X_0 \subset X$ be the fibre of
$f$ over the closed point. For any sheaf $\mathcal{F}$ on $X_\etale$ we
have $\Gamma(X, \mathcal{F}) = \Gamma(X_0, \mathcal{F}|_{X_0})$.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-h0-proper-over-henselian-pair}.
\end{proof}

\noindent
Let $f : X \to S$ be a morphism of schemes. Let
$\overline{s} : \Spec(k) \to S$ be a geometric point. The fibre
of $f$ at $\overline{s}$ is the scheme
$X_{\overline{s}} = \Spec(k) \times_{\overline{s}, S} X$ viewed
as a scheme over $\Spec(k)$. If $\mathcal{F}$ is a sheaf on
$X_\etale$, then denote
$\mathcal{F}_{\overline{s}} = p_{small}^{-1}\mathcal{F}$
the pullback of $\mathcal{F}$ to $(X_{\overline{s}})_\etale$.
In the following we will consider the set
$$
\Gamma(X_{\overline{s}}, \mathcal{F}_{\overline{s}})
$$
Let $s \in S$ be the image point of $\overline{s}$. Let $\kappa(s)^{sep}$
be the separable algebraic closure of $\kappa(s)$ in $k$ as in
Definition \ref{definition-algebraic-geometric-point}.
By Lemma \ref{lemma-sections-base-field-extension}.
pullback defines a bijection
$$
\Gamma(X_{\kappa(s)^{sep}},
p_{sep}^{-1} \mathcal{F})
\longrightarrow
\Gamma(X_{\overline{s}}, \mathcal{F}_{\overline{s}})
$$
where $p_{sep} : X_{\kappa(s)^{sep}} = \Spec(\kappa(s)^{sep}) \times_S X \to X$
is the projection.

\begin{lemma}
\label{lemma-proper-pushforward-stalk}
Let $f : X \to S$ be a proper morphism of schemes. Let
$\overline{s} \to S$ be a geometric point.
For any sheaf $\mathcal{F}$ on $X_\etale$
the canonical map
$$
(f_*\mathcal{F})_{\overline{s}} \longrightarrow
\Gamma(X_{\overline{s}}, \mathcal{F}_{\overline{s}})
$$
is bijective.
\end{lemma}

\begin{proof}
By Theorem \ref{theorem-higher-direct-images} (for sheaves of sets)
we have
$$
(f_*\mathcal{F})_{\overline{s}} =
\Gamma(X \times_S \Spec(\mathcal{O}_{S, \overline{s}}^{sh}),
p_{small}^{-1}\mathcal{F})
$$
where $p : X \times_S \Spec(\mathcal{O}_{S, \overline{s}}^{sh}) \to X$
is the projection. Since the residue field of the strictly henselian
local ring $\mathcal{O}_{S, \overline{s}}^{sh}$ is $\kappa(s)^{sep}$
we conclude from the discussion above the lemma and
Lemma \ref{lemma-h0-proper-over-henselian-local}.
\end{proof}

\begin{lemma}
\label{lemma-proper-base-change-f-star}
Let $f : X \to Y$ be a proper morphism of schemes. Let $g : Y' \subset Y$
be a morphism of schemes. Set $X' = Y' \times_Y X$ with projections
$f' : X' \to Y'$ and $g' : X' \to X$. Let $\mathcal{F}$ be any sheaf on
$X_\etale$. Then $g^{-1}f_*\mathcal{F} = f'_*(g')^{-1}\mathcal{F}$.
\end{lemma}

\begin{proof}
There is a canonical map $g^{-1}f_*\mathcal{F} \to f'_*(g')^{-1}\mathcal{F}$.
Namely, it is adjoint to the map
$$
f_*\mathcal{F} \longrightarrow
g_*f'_*(g')^{-1}\mathcal{F} = f_*g'_*(g')^{-1}\mathcal{F}
$$
which is $f_*$ applied to the canonical map
$\mathcal{F} \to g'_*(g')^{-1}\mathcal{F}$. To check this map is an
isomorphism we can compute what happens on stalks.
Let $y' : \Spec(k) \to Y'$ be a geometric point with image $y$ in $Y$.
By Lemma \ref{lemma-proper-pushforward-stalk} the stalks are
$\Gamma(X'_{y'}, \mathcal{F}_{y'})$ and $\Gamma(X_y, \mathcal{F}_y)$
respectively. Here the sheaves $\mathcal{F}_y$ and $\mathcal{F}_{y'}$
are the pullbacks of $\mathcal{F}$ by the projections $X_y \to X$
and $X'_{y'} \to X$. Thus we see that the groups agree by
Lemma \ref{lemma-sections-base-field-extension}. We omit the
verification that this isomorphism is compatible with our map.
\end{proof}


\noindent
At this point we start discussing the proper base change theorem.
To do so we introduce some notation. consider a commutative diagram
\begin{equation}
\label{equation-base-change-diagram}
\vcenter{
\xymatrix{
X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\
Y' \ar[r]^g & Y
}
}
\end{equation}
of morphisms of schemes. Then we obtain a commutative diagram of sites
$$
\xymatrix{
X'_\etale \ar[r]_{g'_{small}} \ar[d]_{f'_{small}} &
X_\etale \ar[d]^{f_{small}} \\
Y'_\etale \ar[r]^{g_{small}} &
Y_\etale
}
$$
For any object $E$ of $D(X_\etale)$ we obtain a canonical base change map
\begin{equation}
\label{equation-base-change}
g_{small}^{-1}Rf_{small, *}E \longrightarrow Rf'_{small, *}(g'_{small})^{-1}E
\end{equation}
in $D(Y'_\etale)$. See Cohomology on Sites, Remark
\ref{sites-cohomology-remark-base-change} where we use the constant
sheaf $\mathbf{Z}$ as our sheaf of rings.
We will usually omit the subscripts ${}_{small}$ in this formula.
For example, if $E = \mathcal{F}[0]$ where $\mathcal{F}$ is an abelian
sheaf on $X_\etale$, the base change map is a map
\begin{equation}
\label{equation-base-change-sheaf}
g^{-1}Rf_*\mathcal{F} \longrightarrow Rf'_*(g')^{-1}\mathcal{F}
\end{equation}
in $D(Y'_\etale)$.

\medskip\noindent
The map (\ref{equation-base-change}) has no chance of being an isomorphism
in the generality given above. The goal is to show
it is an isomorphism if the diagram (\ref{equation-base-change-diagram})
is cartesian, $f : X \to Y$ proper, and the cohomology sheaves of $E$
are torsion. To study this question we introduce the following terminology.
Let us say that {\it cohomology commutes with base change
for $f : X \to Y$} if (\ref{equation-base-change-sheaf})
is an isomorphism for every diagram (\ref{equation-base-change-diagram})
where $X' = Y' \times_Y X$ and every torsion abelian sheaf $\mathcal{F}$.

\begin{lemma}
\label{lemma-proper-base-change-in-terms-of-injectives}
Let $f : X \to Y$ be a proper morphism of schemes.
The following are equivalent
\begin{enumerate}
\item cohomology commutes with base change for $f$ (see above),
\item for every prime number $\ell$ and every injective
sheaf of $\mathbf{Z}/\ell\mathbf{Z}$-modules $\mathcal{I}$
on $X_\etale$ and every diagram (\ref{equation-base-change-diagram})
where $X' = Y' \times_Y X$ the sheaves
$R^qf'_*(g')^{-1}\mathcal{I}$ are zero for $q > 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (1) implies (2). Conversely, assume (2) and let
$\mathcal{F}$ be an abelian sheaf on $X_\etale$. Let $Y' \to Y$
be a morphism of schemes and let $X' = Y' \times_Y X$
with projections $g' : X' \to X$ and $f' : X' \to Y'$ as in
diagram (\ref{equation-base-change-diagram}).
We want to show the maps of sheaves
$$
g^{-1}R^qf_*\mathcal{F} \longrightarrow R^qf'_*(g')^{-1}\mathcal{F}
$$
are isomorphisms for all $q \geq 0$.

\medskip\noindent
For every $n \geq 1$, let $\mathcal{F}[n]$ be the subsheaf of sections
of $\mathcal{F}$ annihilated by $n$. Then
$\mathcal{F} = \colim \mathcal{F}[n]$.
The functors $g^{-1}$ and $(g')^{-1}$ commute with arbitrary colimits
(as left adjoints). Taking higher direct images along $f$ or $f'$
commutes with filtered colimits by Lemma \ref{lemma-relative-colimit}.
Hence we see that
$$
g^{-1}R^qf_*\mathcal{F} = \colim g^{-1}R^qf_*\mathcal{F}[n]
\quad\text{and}\quad
R^qf'_*(g')^{-1}\mathcal{F} =
\colim R^qf'_*(g')^{-1}\mathcal{F}[n]
$$
Thus it suffices to prove the result in case $\mathcal{F}$ is
annihilated by a positive integer $n$.

\medskip\noindent
If $n = \ell n'$ for some prime number $\ell$, then we obtain a short
exact sequence
$$
0 \to \mathcal{F}[\ell] \to \mathcal{F} \to
\mathcal{F}/\mathcal{F}[\ell] \to 0
$$
Observe that $\mathcal{F}/\mathcal{F}[\ell]$ is annihilated by $n'$.
Moreover, if the result holds for both $\mathcal{F}[\ell]$ and
$\mathcal{F}/\mathcal{F}[\ell]$, then the result holds by
the long exact sequence of higher direct images (and the $5$ lemma).
In this way we reduce to the case that $\mathcal{F}$ is annihilated
by a prime number $\ell$.

\medskip\noindent
Assume $\mathcal{F}$ is annihilated by a prime number $\ell$.
Choose an injective resolution $\mathcal{F} \to \mathcal{I}^\bullet$
in $D(X_\etale, \mathbf{Z}/\ell\mathbf{Z})$. Applying assumption
(2) and Leray's acyclicity lemma
(Derived Categories, Lemma \ref{derived-lemma-leray-acyclicity})
we see that
$$
f'_*(g')^{-1}\mathcal{I}^\bullet
$$
computes $Rf'_*(g')^{-1}\mathcal{F}$. We conclude by applying
Lemma \ref{lemma-proper-base-change-f-star}.
\end{proof}

\begin{lemma}
\label{lemma-sandwich}
Let $f : X \to Y$ and $g : Y \to Z$ be proper morphisms of schemes. Assume
\begin{enumerate}
\item cohomology commutes with base change for $f$,
\item cohomology commutes with base change for $g \circ f$, and
\item $f$ is surjective.
\end{enumerate}
Then cohomology commutes with base change for $g$.
\end{lemma}

\begin{proof}
We will use the equivalence of
Lemma \ref{lemma-proper-base-change-in-terms-of-injectives}
without further mention. Let $\ell$ be a prime number.
Let $\mathcal{I}$ be an injective sheaf of
$\mathbf{Z}/\ell\mathbf{Z}$-modules on $Y_\etale$.
Choose an injective map of sheaves $f^{-1}\mathcal{I} \to \mathcal{J}$
where $\mathcal{J}$ is an injective sheaf of
$\mathbf{Z}/\ell\mathbf{Z}$-modules on $Z_\etale$.
Since $f$ is surjective the map $\mathcal{I} \to f_*\mathcal{J}$
is injective (look at stalks in geometric points).
Since $\mathcal{I}$ is injective we see that $\mathcal{I}$
is a direct summand of $f_*\mathcal{J}$. Thus it suffices
to prove the desired vanishing for $f_*\mathcal{J}$.

\medskip\noindent
Let $Z' \to Z$ be a morphism of schemes and set
$Y' = Z' \times_Z Y$ and $X' = Z' \times_Z X = Y' \times_ Y X$.
Denote $a : X' \to X$, $b : Y' \to Y$, and $c : Z' \to Z$ the
projections. Similarly for $f' : X' \to Y'$ and $g' : Y' \to Z'$.
By Lemma \ref{lemma-proper-base-change-f-star} we have
$b^{-1}f_*\mathcal{J} = f'_*a^{-1}\mathcal{J}$.
On the other hand, we know that $R^qf'_*a^{-1}\mathcal{J}$ and
$R^q(g' \circ f')_*a^{-1}\mathcal{J}$ are zero for $q > 0$.
Using the spectral sequence
(Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-relative-Leray})
$$
R^pg'_* R^qf'_* a^{-1}\mathcal{J} \Rightarrow
R^{p + q}(g' \circ f')_* a^{-1}\mathcal{J}
$$
we conclude that
$ R^pg'_*(b^{-1}f_*\mathcal{J}) = R^pg'_*(f'_*a^{-1}\mathcal{J}) = 0$
for $p > 0$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-composition}
Let $f : X \to Y$ and $g : Y \to Z$ be proper morphisms of schemes. Assume
\begin{enumerate}
\item cohomology commutes with base change for $f$, and
\item cohomology commutes with base change for $g$.
\end{enumerate}
Then cohomology commutes with base change for $f \circ g$.
\end{lemma}

\begin{proof}
We will use the equivalence of
Lemma \ref{lemma-proper-base-change-in-terms-of-injectives}
without further mention. Let $\ell$ be a prime number.
Let $\mathcal{I}$ be an injective sheaf of
$\mathbf{Z}/\ell\mathbf{Z}$-modules on $X_\etale$.
Then $f_*\mathcal{I}$ is an injective sheaf of
$\mathbf{Z}/\ell\mathbf{Z}$-modules on $Y_\etale$
(Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-pushforward-injective-flat}).
The result follows formally from this, but we will also
spell it out.

\medskip\noindent
Let $Z' \to Z$ be a morphism of schemes and set
$Y' = Z' \times_Z Y$ and $X' = Z' \times_Z X = Y' \times_ Y X$.
Denote $a : X' \to X$, $b : Y' \to Y$, and $c : Z' \to Z$ the
projections. Similarly for $f' : X' \to Y'$ and $g' : Y' \to Z'$.
By Lemma \ref{lemma-proper-base-change-f-star} we have
$b^{-1}f_*\mathcal{I} = f'_*a^{-1}\mathcal{I}$.
On the other hand, we know that $R^qf'_*a^{-1}\mathcal{I}$ and
$R^q(g')_*b^{-1}f_*\mathcal{I}$ are zero for $q > 0$.
Using the spectral sequence
(Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-relative-Leray})
$$
R^pg'_* R^qf'_* a^{-1}\mathcal{I} \Rightarrow
R^{p + q}(g' \circ f')_* a^{-1}\mathcal{I}
$$
we conclude that $R^p(g' \circ f')_*a^{-1}\mathcal{I} = 0$ for
$p > 0$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-finite}
Let $f : X \to Y$ be a finite morphism of schemes.
Then cohomology commutes with base change for $f$.
\end{lemma}

\begin{proof}
Observe that a finite morphism is proper, see
Morphisms, Lemma \ref{morphisms-lemma-finite-proper}.
Moreover, the base change of a finite morphism is finite, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-finite}.
Thus the result follows from
Lemma \ref{lemma-proper-base-change-in-terms-of-injectives}
combined with
Proposition \ref{proposition-finite-higher-direct-image-zero}.
\end{proof}

\begin{lemma}
\label{lemma-reduce-to-P1}
To prove that cohomology commutes with base change for
every proper morphism of schemes it suffices to prove it
holds for the morphism $\mathbf{P}^1_S \to S$ for every scheme $S$.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ be a proper morphism of schemes.
Let $Y = \bigcup Y_i$ be an affine open covering
and set $X_i = f^{-1}(Y_i)$. If we can prove
cohomology commutes with base change for $X_i \to Y_i$,
then cohomology commutes with base change for $f$.
Namely, the formation of the higher direct images
commutes with Zariski (and even \'etale) localization
on the base, see
Lemma \ref{lemma-higher-direct-images}.
Thus we may assume $Y$ is affine.

\medskip\noindent
Let $Y$ be an affine scheme and let $X \to Y$ be a proper morphism.
By Chow's lemma there exists a commutative diagram
$$
\xymatrix{
X \ar[rd] & X' \ar[d] \ar[l]^\pi \ar[r] & \mathbf{P}^n_Y \ar[dl] \\
& Y &
}
$$
where $X' \to \mathbf{P}^n_Y$ is an immersion, and
$\pi : X' \to X$ is proper and surjective, see
Limits, Lemma \ref{limits-lemma-chow-finite-type}.
Since $X \to Y$ is proper, we find that $X' \to Y$ is proper
(Morphisms, Lemma \ref{morphisms-lemma-composition-proper}).
Hence $X' \to \mathbf{P}^n_Y$ is a closed immersion
(Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}).
It follows that $X' \to X \times_Y \mathbf{P}^n_Y = \mathbf{P}^n_X$
is a closed immersion (as an immersion with closed image).

\medskip\noindent
By Lemma \ref{lemma-sandwich}
it suffices to prove cohomology commutes with base change for
$\pi$ and $X' \to Y$. These morphisms both factor as a closed
immersion followed by a projection $\mathbf{P}^n_S \to S$ (for some $S$).
By Lemma \ref{lemma-finite} the result holds for closed
immersions (as closed immersions are finite).
By Lemma \ref{lemma-composition} it suffices to prove the
result for projections $\mathbf{P}^n_S \to S$.

\medskip\noindent
For every $n \geq 1$ there is a finite surjective morphism
$$
\mathbf{P}^1_S \times_S \ldots_S \times \mathbf{P}^1_S
\longrightarrow
\mathbf{P}^n_S
$$
given on coordinates by
$$
((x_1 : y_1), (x_2 : y_2), \ldots, (x_n : y_n))
\longmapsto
(F_0 : \ldots : F_n)
$$
where $F_0, \ldots, F_n$ in $x_1, \ldots, y_n$
are the polynomials with integer coefficients such that
$$
\prod (x_i t + y_i) = F_0 t^n + F_1 t^{n - 1} + \ldots + F_n
$$
Applying
Lemmas \ref{lemma-sandwich}, \ref{lemma-finite} and, \ref{lemma-composition}
one more time we conclude that the lemma is true.
\end{proof}

\begin{theorem}
\label{theorem-proper-base-change}
Let $f : X \to Y$ be a proper morphism of schemes. Let $g : Y' \to Y$ be
a morphism of schemes. Set $X' = Y' \times_Y X$
and consider the cartesian diagram
$$
\xymatrix{
X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\
Y' \ar[r]^g & Y
}
$$
Let $\mathcal{F}$ be an abelian torsion sheaf on $X_\etale$.
Then the base change map
$$
g^{-1}Rf_*\mathcal{F} \longrightarrow Rf'_*(g')^{-1}\mathcal{F}
$$
is an isomorphism.
\end{theorem}

\begin{proof}
In the terminology introduced above, this means that cohomology commutes
with base change for every proper morphism of schemes. By
Lemma \ref{lemma-reduce-to-P1}
it suffices to prove that cohomology commutes with base change
for the morphism $\mathbf{P}^1_S \to S$ for every scheme $S$.

\medskip\noindent
Let $S$ be the spectrum of a strictly henselian local ring with closed
point $s$. Set $X = \mathbf{P}^1_S$ and $X_0 = X_s = \mathbf{P}^1_s$.
Let $\mathcal{F}$ be a sheaf of $\mathbf{Z}/\ell\mathbf{Z}$-modules
on $X_\etale$. The key to our proof is that
$$
H^q_\etale(X, \mathcal{F}) = H^q_\etale(X_0, \mathcal{F}|_{X_0}).
$$
Namely, choose a resolution $\mathcal{F} \to \mathcal{I}^\bullet$
by injective sheaves of $\mathbf{Z}/\ell\mathbf{Z}$-modules.
Then $\mathcal{I}^\bullet|_{X_0}$ is a resolution of $\mathcal{F}|_{X_0}$
by right $H^0_\etale(X_0, -)$-acyclic objects, see
Lemma \ref{lemma-efface-cohomology-on-fibre-by-finite-cover}.
Leray's acyclicity lemma tells us the right hand side is computed by
the complex $H^0_\etale(X_0, \mathcal{I}^\bullet|_{X_0})$
which is equal to $H^0_\etale(X, \mathcal{I}^\bullet)$ by
Lemma \ref{lemma-h0-proper-over-henselian-local}. This complex
computes the left hand side.

\medskip\noindent
Assume $S$ is general and $\mathcal{F}$ is a sheaf of
$\mathbf{Z}/\ell\mathbf{Z}$-modules on $X_\etale$.
Let $\overline{s} : \Spec(k) \to S$ be a geometric point
of $S$ lying over $s \in S$. We have
$$
(R^qf_*\mathcal{F})_{\overline{s}} =
H^q_\etale(\mathbf{P}^1_{\mathcal{O}_{S, \overline{s}}^{sh}},
\mathcal{F}|_{\mathbf{P}^1_{\mathcal{O}_{S, \overline{s}}^{sh}}}) =
H^q_\etale(\mathbf{P}^1_{\kappa(s)^{sep}},
\mathcal{F}|_{\mathbf{P}^1_{\kappa(s)^{sep}}})
$$
where $\kappa(s)^{sep}$ is the residue field of
$\mathcal{O}_{S, \overline{s}}^{sh}$, i.e., the separable algebraic
closure of $\kappa(s)$ in $k$.
The first equality by Theorem \ref{theorem-higher-direct-images}
and the second equality by the displayed formula in the
previous paragraph.

\medskip\noindent
Finally, consider any morphism of schemes $g : T \to S$ where
$S$ and $\mathcal{F}$ are as above.
Set $f' : \mathbf{P}^1_T \to T$ the projection and let
$g' : \mathbf{P}^1_T \to \mathbf{P}^1_T$ the morphism induced
by $g$. Consider the base change map
$$
g^{-1}R^qf_*\mathcal{F}
\longrightarrow
R^qf'_*(g')^{-1}\mathcal{F}
$$
Let $\overline{t}$ be a geometric point of $T$ with image
$\overline{s} = g(\overline{t})$. By our discussion
above the map on stalks at $\overline{t}$ is the map
$$
H^q_\etale(\mathbf{P}^1_{\kappa(s)^{sep}},
\mathcal{F}|_{\mathbf{P}^1_{\kappa(s)^{sep}}})
\longrightarrow
H^q_\etale(\mathbf{P}^1_{\kappa(t)^{sep}},
\mathcal{F}|_{\mathbf{P}^1_{\kappa(t)^{sep}}})
$$
Since $\kappa(s)^{sep} \subset \kappa(t)^{sep}$ this map is an
isomorphism by Lemma \ref{lemma-base-change-dim-1-separably-closed}.

\medskip\noindent
This proves cohomology commutes with base change for
$\mathbf{P}^1_S \to S$ and sheaves of $\mathbf{Z}/\ell\mathbf{Z}$-modules.
In particular, for an injective sheaf of $\mathbf{Z}/\ell\mathbf{Z}$-modules
the higher direct images of any base change are zero.
In other words, condition (2) of
Lemma \ref{lemma-proper-base-change-in-terms-of-injectives}
holds and the proof is complete.
\end{proof}



\section{Applications of proper base change}
\label{section-applications-proper-base-change}

\noindent
As an application of the proper base change theorem we obtain the following.

\begin{lemma}
\label{lemma-cohomological-dimension-proper}
Let $f : X \to Y$ be a proper morphism of schemes
all of whose fibres have dimension $\leq n$.
Then for any abelian torsion sheaf $\mathcal{F}$ on $X_\etale$
we have $R^qf_*\mathcal{F} = 0$ for $q > 2n$.
\end{lemma}

\begin{proof}
Omitted. Hints: By the proper base change theorem it suffices to
prove that for a proper scheme $X$ over an algebraically closed
field, the \'etale cohomology of $\mathcal{F}$ vanishes
above $2\dim X$. By the proper base change theorem and d\'evissage
(using Chow's lemma for example)
one can reduce to the case where the dimension of $X$ is $1$.
The case of curves is Theorem \ref{theorem-vanishing-curves}.
See also Remarks \ref{remarks-on-above}.
\end{proof}

\begin{lemma}
\label{lemma-morphism-finite-type-bounded-dimension}
Let $f : X \to Y$ be a morphism of finite type with $Y$ quasi-compact.
Then the dimension of the fibres of $f$ is bounded.
\end{lemma}

\begin{proof}
By Morphisms, Lemma \ref{morphisms-lemma-openness-bounded-dimension-fibres}
the set $U_n \subset X$ of points where the dimension of the fibre
is $\leq n$ is open. Since $f$ is of finite type, every point is
contained in some $U_n$. Since $Y$ is quasi-compact and $f$ is of
finite type, we see that $X$ is quasi-compact. Hence $X = U_n$ for
some $n$.
\end{proof}








\section{The trace formula}
\label{section-trace-formula}

\noindent
A typical course in \'etale cohomology would normally state and prove the
proper and smooth base change theorems, purity and Poincar\'e duality. All of
these can be found in \cite[Arcata]{SGA4.5}. Instead, we are going to study the
trace formula for the frobenius, following the account of Deligne in
\cite[Rapport]{SGA4.5}. We will only look at dimension 1, but using proper base
change this is enough for the general case. Since all the cohomology groups
considered will be \'etale, we drop the subscript $_\etale$. Let us
now describe
the formula we are after. Let $X$ be a finite type scheme of dimension 1 over a
finite field $k$, $\ell$ a prime number and $\mathcal{F}$ a constructible, flat
$\mathbf{Z}/\ell^n\mathbf{Z}$ sheaf. Then
\begin{equation}
\label{equation-trace-formula-initial}
\sum\nolimits_{x \in X(k)}
\text{Tr}(\text{Frob} | \mathcal{F}_{\bar x}) =
\sum\nolimits_{i=0}^2
(-1)^i \text{Tr}(\pi_X^* | H^i_c(X \otimes_k \bar k, \mathcal{F}))
\end{equation}
as elements of $\mathbf{Z}/\ell^n\mathbf{Z}$. As we will see, this formulation
is slightly wrong as stated. Let us nevertheless describe the symbols that
occur therein.




\section{Frobenii}
\label{section-frobenii}

\noindent
In this section we will prove a ``baffling'' theorem.
A topological analogue of the baffling theorem is the following.

\begin{exercise}
\label{exercise-baffling}
Let $X$ be a topological space and $g : X \to X$ a continuous map such that
$g^{-1}(U) = U$ for all opens $U$ of $X$. Then $g$ induces the identity on
cohomology on $X$ (for any coefficients).
\end{exercise}

\noindent
We now turn to the statement for the \'etale site.

\begin{lemma}
\label{lemma-baffling}
Let $X$ be a scheme and $g : X \to X$ a morphism. Assume that for all $\varphi:
U \to X$ \'etale, there is an isomorphism
$$
\xymatrix{
U \ar_{\varphi}[rd] \ar^{\sim \quad}[rr] & & {U
\times_{\varphi, X, g} X} \ar^{\text{pr}_2}[ld]\\
& X
}
$$
functorial in $U$. Then $g$ induces the identity on cohomology (for any sheaf).
\end{lemma}

\begin{proof}
The proof is formal and without difficulty.
\end{proof}

\begin{definition}
\label{definition-absolute-frobenius}
Let $X$ be a scheme in characteristic $p$.
The {\it absolute frobenius} of $X$ is the morphism $F_X : X \to X$ which
is the identity on the induced topological space, and which takes a function
to its $p$th power. Thus $F_X^\sharp : \mathcal{O}_X \to \mathcal{O}_X$
is given by $g \mapsto g^p$.
\end{definition}

\begin{theorem}[The Baffling Theorem]
\label{theorem-baffling}
Let $X$ be a scheme in characteristic $p>0$. Then the absolute frobenius
induces (by pullback) the trivial map on cohomology, i.e., for all
integers $j\geq 0$,
$$
F_X^* : H^j (X, \underline{\mathbf{Z}/n\mathbf{Z}}) \longrightarrow H^j (X,
\underline{\mathbf{Z}/n\mathbf{Z}})
$$
is the identity.
\end{theorem}

\noindent
This theorem is purely formal. It is a good idea, however, to review how to
compute the pullback of a cohomology class. Let us simply say that in the case
where cohomology agrees with \u Cech cohomology, it suffices to pull back
(using the fiber products on a site) the \u Cech cocycles. The general case is
quite technical, see
Hypercoverings, Theorem \ref{hypercovering-theorem-cohomology-hypercoverings}.
To prove the theorem, we merely
verify that the assumption of Lemma \ref{lemma-baffling}
holds for the frobenius.

\begin{proof}[Proof of Theorem \ref{theorem-baffling}]
We need to verify the existence of a functorial isomorphism as above. For an
\'etale morphism $\varphi: U \to S$, consider the diagram
$$
\xymatrix{
U \ar@{-->}[rd] \ar^{F_U}@/^1pc/[rrd]
\ar_{\varphi}@/_1pc/[rdd] \\
& {U \times_{\varphi, X, F_X} X} \ar^{\qquad \text{pr}_1 \ \ }[r]
\ar^{\text{pr}_2}[d] & U \ar^{\varphi}[d] \\
& X \ar^{F_X}[r] & X.
}
$$
The dotted arrow is an \'etale morphism which induces an isomorphism on the
underlying topological spaces, so it is an isomorphism.
\end{proof}

%10.22.09

\begin{definition}
\label{definition-geometric-frobenius}
Let $k$ be a finite field with $q = p^f$ elements. Let $X$ be a scheme
over $k$. The {\it geometric frobenius} of $X$ is the morphism
$\pi_X : X \to X$ over $\Spec(k)$ which equals $F_X^f$.
\end{definition}

\noindent
Since $\pi_X$ is a morphism over $k$, we can base change it to any scheme over
$k$. In particular we can base chage it to the algebraic closure $\bar k$
and get a morphism $\pi_X : X_{\bar k} \to X_{\bar k}$. Using $\pi_X$ also
for this base change should not be
confusing as $X_{\bar k}$ does not have a geometric frobenius of its own.

\begin{lemma}
\label{lemma-sheaf-over-finite-field-has-frobenius-descent}
Let $\mathcal{F}$ be a sheaf on $X_\etale$.
Then there are canonical isomorphisms
$\pi_X^{-1} \mathcal{F} \cong \mathcal{F}$ and
$\mathcal{F} \cong {\pi_X}_*\mathcal{F}$.
\end{lemma}

\noindent
This is false for the fppf site.

\begin{proof}
Let $\varphi: U \to X$ be \'etale. Recall that
${\pi_X}_* \mathcal{F} (U) = \mathcal{F} (U \times_{\varphi, X, \pi_X} X)$.
Since $\pi_X = F_X^f$, it follows from the proof of
Theorem \ref{theorem-baffling} that there is a functorial isomorphism
$$
\xymatrix{
U \ar_{\varphi}[rd] \ar^{\sim \quad}_{\gamma_U \quad}[rr]
& & {U \times_{\varphi, X, \pi_X} X} \ar^{\text{pr}_2}[ld]\\
& X
}
$$
where $\gamma_U = (\varphi, F_U^f)$. Now we define an
isomorphism
$$
\mathcal{F} (U) \longrightarrow {\pi_X}_* \mathcal{F} (U) =
\mathcal{F} (U \times_{\varphi, X, \pi_X} X)
$$
by taking the restriction map of $\mathcal{F}$ along $\gamma_U^{-1}$.
The other isomorphism is analogous.
\end{proof}

\begin{remark}
\label{remark-may-be-confusing}
It may or may not be the case that $F^f_U$ equals $\pi_U$.
\end{remark}

\noindent
We continue discussion cohomology of sheaves on our scheme $X$ over
the finite field $k$ with $q = p^f$ elements.
Fix an algebraic clsoure $\bar k$ of $k$ and write $G_k =
\text{Gal}(\bar k/k)$ for the absolute Galois group of $k$.
Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. Consider the
We will define a left $G_k$-module structure
cohomology group $H^j (X_{\bar k}, \mathcal{F}|_{X_{\bar k}})$
as follows: if $\sigma \in G_k$, the diagram
$$
\xymatrix{
X_{\bar k} \ar[rd] \ar^{\Spec(\sigma) \times \text{id}_X}[rr] & &
X_{\bar k} \ar[ld] \\
& X
}
$$
commutes. Thus we can set, for $\xi \in H^j (X_{\bar k}, \mathcal{F}|_{X_{\bar
k}})$
$$
\sigma \cdot \xi := (\Spec(\sigma) \times \text{id}_X)^*\xi \in
H^j(X_{\bar k}, (\Spec(\sigma) \times \text{id}_X)^{-1}
\mathcal{F}|{X_{\bar k}})
= H^j (X_{\bar k}, \mathcal{F}|_{X_{\bar k}}),
$$
where the last equality follows from the commutativity of the previous diagram.
This endows the latter group with the structure of a $G_k$-module.

\begin{lemma}
\label{lemma-two-actions-agree}
In the situation above denote $\alpha : X \to \Spec(k)$ the structure morphism.
Consider the stalk $(R^j\alpha_*\mathcal{F})_{\Spec(\bar k)}$ endowed with its
natural Galois action as in Section \ref{section-galois-action-stalks}. Then
the identification
$$
(R^j\alpha_*\mathcal{F})_{\Spec(\bar k)} \cong H^j (X_{\bar k},
\mathcal{F}|_{X_{\bar k}})
$$
from Theorem \ref{theorem-higher-direct-images} is an isomorphism of
$G_k$-modules.
\end{lemma}

\noindent
A similar result holds comparing
$(R^j\alpha_!\mathcal{F})_{\Spec(\bar k)}$ with
$H^j_c (X_{\bar k}, \mathcal{F}|_{X_{\bar k}})$.

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-arithmetic-frobenius}
The {\it arithmetic frobenius} is the map
$\text{frob}_k : \bar k \to \bar k$, $x \mapsto x^q$ of $G_k$.
\end{definition}

\begin{theorem}
\label{theorem-geometric-arithmetic-inverse}
Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. Then for all
$j\geq 0$, $\text{frob}_k$ acts on the cohomology group $H^j(X_{\bar k},
\mathcal{F}|_{X_{\bar k}})$ as the inverse of the map $\pi_X^*$.
\end{theorem}

\noindent
The map $\pi_X^*$ is defined by the composition
$$
H^j(X_{\bar k}, \mathcal{F}|_{X_{\bar k}}) \xrightarrow{{\pi_X}_{\bar k}^*}
H^j(X_{\bar k}, (\pi_X^{-1} \mathcal{F})|_{X_{\bar k}}) \cong
H^j(X_{\bar k}, \mathcal{F}|_{X_{\bar k}}).
$$
where the last isomorphism comes from the canonical isomorphism
$\pi_X^{-1} \mathcal{F} \cong \mathcal{F}$ of
Lemma \ref{lemma-sheaf-over-finite-field-has-frobenius-descent}.

\begin{proof}
The composition $X_{\bar k} \xrightarrow{\Spec(\text{frob}_k)} X_{\bar k}
\xrightarrow{\pi_X} X_{\bar k}$ is equal to $F_{X_{\bar k}}^f$, hence the
result follows from the baffling theorem suitably generalized to nontrivial
coefficients. Note that the previous composition commutes in the sense that
$F_{X_{\bar k}}^f = \pi_X \circ \Spec(\text{frob}_k) =
\Spec(\text{frob}_k) \circ \pi_X$.
\end{proof}

\begin{definition}
\label{definition-geometric-frobenius-on-stalk}
If $x \in X(k)$ is a rational point and $\bar x : \Spec(\bar k) \to X$
the geometric point lying over $x$, we let $\pi_x : \mathcal{F}_{\bar x} \to
\mathcal{F}_{\bar x}$ denote the action by $\text{frob}_k^{-1}$ and call it the
{\it geometric frobenius}\footnote{This notation is not standard.
This operator is denoted $F_x$ in \cite{SGA4.5}. We will likely change
this notation in the future.}
\end{definition}

\noindent
We can now make a more precise statement (albeit a false one) of the trace
formula (\ref{equation-trace-formula-initial}). Let $X$ be a finite
type scheme of dimension 1
over a finite field $k$, $\ell$ a prime number and $\mathcal{F}$ a
constructible, flat $\mathbf{Z}/\ell^n\mathbf{Z}$ sheaf. Then
\begin{equation}
\label{equation-trace-formula-second}
\sum\nolimits_{x \in X(k)}
\text{Tr}(\pi_X | \mathcal{F}_{\bar x})
=
\sum\nolimits_{i=0}^2
(-1)^i \text{Tr}(\pi_X^* | H^i_c(X_{\bar k}, \mathcal{F}))
\end{equation}
as elements of $\mathbf{Z}/\ell^n\mathbf{Z}$. The reason this equation is wrong
is that the trace in the right-hand side does not make sense for the kind of
sheaves considered. Before addressing this issue, we try to motivate the
appearance of the geometric frobenius (apart from the fact that it is a natural
morphism!).

\medskip\noindent
Let us consider the case where $X = \mathbf{P}^1_k$ and $\mathcal{F} =
\underline{\mathbf{Z}/\ell\mathbf{Z}}$. For any point, the Galois module
$\mathcal{F}_{\bar x}$ is trivial, hence for any morphism $\varphi$ acting on
$\mathcal{F}_{\bar x}$, the left-hand side is
$$
\sum\nolimits_{x \in X(k)} \text{Tr}(\varphi | \mathcal{F}_{\bar x}) =
\#\mathbf{P}^1_k(k) = q+1.
$$
Now $\mathbf{P}^1_k$ is proper, so compactly supported cohomology equals
standard cohomology, and so for a morphism $\pi : \mathbf{P}^1_k \to
\mathbf{P}^1_k$, the right-hand side equals
$$
\text{Tr}(\pi^* | H^0 (\mathbf{P}^1_{\bar k},
\underline{\mathbf{Z}/\ell\mathbf{Z}})) + \text{Tr}(\pi^* | H^2
(\mathbf{P}^1_{\bar k}, \underline{\mathbf{Z}/\ell\mathbf{Z}})).
$$
The Galois module $H^0 (\mathbf{P}^1_{\bar k},
\underline{\mathbf{Z}/\ell\mathbf{Z}}) = \mathbf{Z}/\ell\mathbf{Z}$ is trivial,
since the pullback of the identity is the identity. Hence the first trace is 1,
regardless of $\pi$. For the second trace, we need to compute the pullback of a
map $\pi: \mathbf{P}^1_{\bar k} \to \mathbf{P}^1_{\bar k}$ on $H^2
(\mathbf{P}^1_{\bar k}, \underline{\mathbf{Z}/\ell\mathbf{Z}}))$. This is a
good exercise and the answer is multiplication by the degree of $\pi$. In other
words, this works as in the familiar situation of complex cohomology. In
particular, if $\pi$ is the geometric frobenius we get
$$
\text{Tr}(\pi_X^* | H^2 (\mathbf{P}^1_{\bar k},
\underline{\mathbf{Z}/\ell\mathbf{Z}})) = q
$$
and if $\pi$ is the arithmetic frobenius then we get
$$
\text{Tr}(\text{frob}_k^* | H^2 (\mathbf{P}^1_{\bar k},
\underline{\mathbf{Z}/\ell\mathbf{Z}})) = q^{-1}.
$$
The latter option is clearly wrong.

\begin{remark}
\label{remark-compute-degree-lifting}
The computation of the degrees can be done by lifting (in some obvious sense)
to characteristic 0 and considering the situation with complex coefficients.
This method almost never works, since lifting is in general impossible for
schemes which are not projective space.
\end{remark}

\noindent
The question remains as to why we have to consider compactly supported
cohomology. In fact, in view of Poincar\'e duality, it is not strictly
necessary for smooth varieties, but it involves adding in certain powers
of $q$. For example, let us consider the case where
$X = \mathbf{A}^1_k$ and
$\mathcal{F} = \underline{\mathbf{Z}/\ell\mathbf{Z}}$.
The action on stalks is again trivial, so we only need look at the action
on cohomology. But then $\pi_X^*$ acts as the identity on
$H^0(\mathbf{A}^1_{\bar k}, \underline{\mathbf{Z}/\ell\mathbf{Z}})$
and as multiplication by $q$ on
$H^2_c(\mathbf{A}^1_{\bar k}, \underline{\mathbf{Z}/\ell\mathbf{Z}})$.




\section{Traces}
\label{section-traces}

\noindent
We now explain how to take the trace of an endomorphism of a module over a
noncommutative ring. Fix a finite ring $\Lambda$ with cardinality prime to $p$.
Typically, $\Lambda$ is the group ring $(\mathbf{Z}/\ell^n\mathbf{Z})[G]$ for
some finite group $G$. By convention, all the $\Lambda$-modules considered will
be left $\Lambda$-modules.

\medskip\noindent
We introduce the following notation:
We set $\Lambda^\natural$ to be the quotient of $\Lambda$ by its additive
subgroup generated by the commutators (i.e., the elements of the form
$ab-ba$, $a, b \in \Lambda$). Note that $\Lambda^\natural$ is not a ring.

\medskip\noindent
For instance, the module $(\mathbf{Z}/\ell^n\mathbf{Z})[G]^\natural$ is the
dual of the class functions, so
$$
(\mathbf{Z}/\ell^n\mathbf{Z})[G]^\natural
=
\bigoplus\nolimits_{\text{conjugacy classes of }G}
\mathbf{Z}/\ell^n\mathbf{Z}.
$$
For a free $\Lambda$-module, we have $\text{End}_\Lambda(\Lambda^{\oplus m}) =
\text{Mat}_n(\Lambda)$. Note that since the modules are left modules,
representation of endomorphism by matrices is a right action: if $a \in
\text{End}(\Lambda^{\oplus m})$ has matrix $A$ and $v \in \Lambda$, then $a(v)
= v A$.

\begin{definition}
\label{definition-trace}
The {\it trace} of the endomorphism $a$ is the sum of the diagonal entries of
a matrix representing it. This defines an additive map $\text{Tr} :
\text{End}_\Lambda(\Lambda^{\oplus m}) \to \Lambda^\natural$.
\end{definition}

\begin{exercise}
\label{exercise-trace-is-trace}
Given maps
$$
\Lambda^{\oplus n} \xrightarrow{a}
\Lambda^{\oplus n} \xrightarrow{b}
\Lambda^{\oplus m}
$$
show that $\text{Tr}(ab) = \text{Tr}(ba)$.
\end{exercise}

\noindent
We extend the definition of the trace to a finite projective $\Lambda$-module
$P$ and an endomorphism $\varphi$ of $P$ as follows. Write $P$ as the summand
of a free $\Lambda$-module, i.e., consider maps $P \xrightarrow{a}
\Lambda^{\oplus n} \xrightarrow{b} P$ with
\begin{enumerate}
\item
$\Lambda^{\oplus n} = \Im(a) \oplus \ker(b)$; and
\item
$b\circ a = \text{id}_P$.
\end{enumerate}
Then we set $\text{Tr}(\varphi) = \text{Tr}(a\varphi b)$. It is easy to check
that this is well-defined, using the previous exercise.








\section{Why derived categories?}
\label{section-derived-categories-why}

\noindent
With this definition of the trace, let us now discuss another issue with the
formula as stated. Let $C$ be a smooth projective curve over $k$. Then there is
a correspondence between finite locally constant sheaves $\mathcal{F}$ on
$C_\etale$ which stalks are isomorphic to
${(\mathbf{Z}/\ell^n\mathbf{Z})}^{\oplus m}$ on the one hand, and continuous
representations $\rho : \pi_1 (C, \bar c) \to
\text{GL}_m(\mathbf{Z}/\ell^n\mathbf{Z}))$ (for some fixed choice of $\bar c$)
on the other hand. We denote $\mathcal{F}_\rho$ the sheaf corresponding to
$\rho$. Then $H^2 (C_{\bar k}, \mathcal{F}_\rho)$ is the group of coinvariants
for the action of $\rho(\pi_1 (C, \bar c))$ on
${(\mathbf{Z}/\ell^n\mathbf{Z})}^{\oplus m}$, and there is a short exact
sequence
$$
0 \longrightarrow \pi_1 (C_{\bar k}, \bar c) \longrightarrow \pi_1 (C, \bar c)
\longrightarrow G_k \longrightarrow 0.
$$
For instance, let $\mathbf{Z} = \mathbf{Z} \sigma$ act on
$\mathbf{Z}/\ell^2\mathbf{Z}$ via $\sigma(x) = (1+\ell) x$. The coinvariants
are $(\mathbf{Z}/\ell^2\mathbf{Z})_{\sigma} = \mathbf{Z}/\ell\mathbf{Z}$, which
is not a flat $\mathbf{Z}/\ell\mathbf{Z}$-module. Hence we cannot take the
trace of some action on $H^2(C_{\bar k}, \mathcal{F}_\rho)$, at least not in
the sense of the previous section.

\medskip\noindent
In fact, our goal is to consider a trace formula for $\ell$-adic coefficients.
But $\mathbf{Q}_\ell = \mathbf{Z}_\ell[1/\ell]$ and $\mathbf{Z}_\ell =
\lim \mathbf{Z}/\ell^n\mathbf{Z}$, and even for a flat
$\mathbf{Z}/\ell^n\mathbf{Z}$ sheaf, the individual cohomology groups may not
be flat, so we cannot compute traces. One possible remedy is consider the total
derived complex $R\Gamma(C_{\bar k}, \mathcal{F}_\rho)$ in the derived category
$D(\mathbf{Z}/\ell^n\mathbf{Z})$ and show that it is a perfect object, which
means that it is quasi-isomorphic to a finite complex of finite free module.
For such complexes, we can define the trace, but this will require an account
of derived categories.






\section{Derived categories}
\label{section-derived-categories}

\noindent
To set up notation, let $\mathcal{A}$ be an abelian category. Let
$\text{Comp}(\mathcal{A})$ be the abelian category of complexes in
$\mathcal{A}$. Let $K(\mathcal{A})$ be the category of complexes up to
homotopy, with objects equal to complexes in $\mathcal{A}$ and objects equal to
homotopy classes of morphisms of complexes. This is not an abelian category.
Loosely speaking, $D(A)$ is defined to be the category obtained by inverting
all quasi-isomorphisms in $\text{Comp}(\mathcal{A})$ or, equivalently, in
$K(\mathcal{A})$. Moreover, we can define $\text{Comp}^+(\mathcal{A}),
K^+(\mathcal{A}), D^+(\mathcal{A})$ analogously using only bounded below
complexes. Similarly, we can define $\text{Comp}^-(\mathcal{A}),
K^-(\mathcal{A}), D^-(\mathcal{A})$ using bounded above complexes, and we can
define $\text{Comp}^b(\mathcal{A}), K^b(\mathcal{A}), D^b(\mathcal{A})$ using
bounded complexes.

\begin{remark}
\label{remarks-derived-categories}
Notes on derived categories.
\begin{enumerate}
\item
There are some set-theoretical problems when $\mathcal{A}$ is somewhat
arbitrary, which we will happily disregard.
\item
The categories $K(A)$ and $D(A)$ may be endowed with the structure of
triangulated category, but we will not need these structures in the following
discussion.
\item
The categories $\text{Comp}(\mathcal{A})$ and $K(\mathcal{A})$ can also be
defined when $\mathcal{A}$ is an additive category.
\end{enumerate}
\end{remark}

\noindent
The homology functor $H^i: \text{Comp}(\mathcal{A}) \to \mathcal{A}$ taking a
complex $K^\bullet \mapsto H^i(K^\bullet)$ extends to functors $H^i:
K(\mathcal{A}) \to \mathcal{A}$ and $H^i: D(\mathcal{A}) \to \mathcal{A}$.

\begin{lemma}
\label{lemma-when-in-bounded}
An object $E$ of $D(\mathcal{A})$ is contained in $D^+(\mathcal{A})$ if and
only if $H^i(E) =0 $ for all $i \ll 0$. Similar statements hold for $D^-$ and
$D^+$.
\end{lemma}

\begin{proof}
Hint: use truncation functors. See
Derived Categories, Lemma \ref{derived-lemma-bounded-derived}.
\end{proof}

\begin{lemma}
\label{lemma-derived-categories}
Morphisms between objects in the derived category.
\begin{enumerate}
\item
Let $I^\bullet \in \text{Comp}^+(\mathcal{A})$ with $I^n$ injective for all
$n \in \mathbf{Z}$. Then
$$
\Hom_{D(\mathcal{A})}(K^\bullet, I^\bullet)
=
\Hom_{K(\mathcal{A})}(K^\bullet, I^\bullet).
$$
\item
Let $P^\bullet \in \text{Comp}^-(\mathcal{A})$ with $P^n$ is projective for all
$n \in \mathbf{Z}$. Then
$$
\Hom_{D(\mathcal{A})}(P^\bullet, K^\bullet)
=
\Hom_{K(\mathcal{A})}(P^\bullet, K^\bullet).
$$
\item
If $\mathcal{A}$ has enough injectives and $\mathcal{I} \subset \mathcal{A}$
is the additive subcategory of injectives, then
$
D^+(\mathcal{A})\cong K^+(\mathcal{I})
$
(as triangulated categories).
\item
If $\mathcal{A}$ has enough projectives and $\mathcal{P} \subset \mathcal{A}$
is the additive subcategory of projectives, then
$
D^-(\mathcal{A}) \cong K^-(\mathcal{P}).
$
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-derived-functor}
Let $F: \mathcal{A} \to \mathcal{B}$ be a left exact functor and assume that
$\mathcal{A}$ has enough injectives. We define the {\it total right derived
functor of $F$} as the functor $RF: D^+(\mathcal{A}) \to D^+(\mathcal{B})$
fitting into the diagram
$$
\xymatrix{
D^+(\mathcal{A}) \ar[r]^{RF} & D^+(\mathcal{B}) \\
K^+(\mathcal I) \ar[u] \ar[r]^F & K^+(\mathcal{B}). \ar[u]
}
$$
This is possible since the left vertical arrow is invertible by the previous
lemma. Similarly, let $G: \mathcal{A} \to \mathcal{B}$ be a right exact
functor and assume that $\mathcal{A}$ has enough projectives. We define the
{\it total right derived functor of $G$} as the functor $LG: D^-(\mathcal{A})
\to D^-(\mathcal{B})$ fitting into the diagram
$$
\xymatrix{
D^-(\mathcal{A}) \ar[r]^{LG} & D^-(\mathcal{B}) \\
K^-(\mathcal{P}) \ar[u] \ar[r]^G & K^-(\mathcal{B}). \ar[u]
}
$$
This is possible since the left vertical arrow is invertible by the previous
lemma.
\end{definition}

\begin{remark}
\label{remark-cohomology-of-derived-functor}
In these cases, it is true that $R^iF(K^\bullet) = H^i(RF(K^\bullet))$, where
the left hand side is defined to be $i$th homology of the complex
$F(K^\bullet)$.
\end{remark}




\section{Filtered derived category}
\label{section-filtered-derived-category}

\noindent
It turns out we have to do it all again and build the filtered derived
category also.

\begin{definition}
\label{definition-filtered}
Let $\mathcal{A}$ be an abelian category. Let $\text{Fil}(\mathcal{A})$ be the
category of filtered objects $(A, F)$ of $\mathcal{A}$, where $F$ is a
filtration of the form
$$
A \supseteq \cdots \supseteq F^n A \supseteq F^{n+1}A \supseteq \cdots
\supseteq 0.
$$
This is an additive category. We denote $\text{Fil}^f(\mathcal{A})$ the full
subcategory of $\text{Fil}(\mathcal{A})$ whose objects $(A, F)$ have finite
filtration. This is also an additive category. An object $I \in
\text{Fil}^f(\mathcal{A})$ is called {\it filtered injective} (respectively
{\it projective}) provided that $\text{gr}^p(I) = \text{gr}_F^p(I) =
F^pI/F^{p+1}I$ is injective (resp. projective) in $\mathcal{A}$ for all $p$.
The categories $\text{Comp}(\text{Fil}^f(\mathcal{A})) \supseteq
\text{Comp}^+(\text{Fil}^f(\mathcal{A}))$ and $K(\text{Fil}^f(\mathcal{A}))
\supseteq K^+(\text{Fil}^f(\mathcal A))$ are defined as before.
\\
A morphism $\alpha : K^\bullet \to L^\bullet$ of complexes in
$\text{Comp}(\text{Fil}^f(\mathcal{A}))$ is called a {\it filtered
quasi-isomorphism} provided that
$$
\mathrm{gr}^p(\alpha): \mathrm{gr}^p(K^\bullet) \to \mathrm{gr}^p(L^\bullet)
$$
is a quasi-isomorphism for all $p \in \mathbf{Z}$. Finally, we define $D
F(\mathcal{A})$ (resp. $D F^+(\mathcal{A})$) by inverting the filtered
quasi-isomorphisms in $K(\text{Fil}^f(\mathcal{A}))$ (resp.
$K^+(\text{Fil}^f(\mathcal{A}))$).
\end{definition}

\begin{lemma}
\label{lemma-filtered-derived-category}
If $\mathcal{A}$ has enough injectives, then $D F^+(\mathcal{A}) \cong
K^+(\mathcal{I})$, where $\mathcal{I}$ is the full additive subcategory of
$\text{Fil}^f(\mathcal{A})$ consisting of filtered injective objects.
Similarly, if $\mathcal{A}$ has enough projectives, then $D F^-(\mathcal{A})
\cong K^+(\mathcal{P})$, where $\mathcal P$ is the full additive subcategory of
$\text{Fil}^f(\mathcal{A})$ consisting of filtered projective objects.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}





\section{Filtered derived functors}
\label{section-filtered-derived-functors}

\noindent
And then there are the filtered derived functors.

\begin{definition}
\label{definition-filtered-derived-functors}
Let $T: \mathcal{A} \to \mathcal{B}$ be a left exact functor and assume that
$\mathcal{A}$ has enough injectives. Define $RT: D F^+(\mathcal{A}) \to D
F^+(\mathcal{B})$ to fit in the diagram
$$
\xymatrix{
D F^+(\mathcal{A}) \ar^{RT}[r] & D F^+(\mathcal{B}) \\
K^+(\mathcal{I}) \ar[u] \ar[r]^{T \quad} & K^+(\text{Fil}^f(\mathcal{B})).
\ar[u]}
$$
This is well-defined by the previous lemma. Let $G: \mathcal{A} \to
\mathcal{B}$ be a right exact functor and assume that $\mathcal{A}$ has enough
projectives. Define $LG: D F^+(\mathcal{A}) \to D F^+(\mathcal{B})$ to fit in
the diagram
$$
\xymatrix{
D F^-(\mathcal{A}) \ar^{LG}[r] & D F^-(\mathcal{B}) \\
K^-(\mathcal{P}) \ar[u] \ar[r]^{G \quad} & K^-(\text{Fil}^f(\mathcal{B})).
\ar[u]}
$$
Again, this is well-defined by the previous lemma.
The functors $RT$, resp.\ $LG$, are called the {\it filtered derived
functor} of $T$, resp.\ $G$.
\end{definition}

\begin{proposition}
\label{proposition-compare-filtered-graded}
In the situation above, we have
$$
\mathrm{gr}^p \circ RT = RT \circ \mathrm{gr}^p
$$
where the $RT$ on the left is the filtered derived functor while the one on the
right is the total derived functor. That is, there is a commuting diagram
$$
\xymatrix{
D F^+(\mathcal{A}) \ar[r]^{RT} \ar[d]_{\text{gr}^p} & D F^+(\mathcal{B})
\ar[d]^{\text{gr}^p}\\
D^+(\mathcal{A}) \ar[r]^{RT} & D^+(\mathcal{B}).}
$$
\end{proposition}

\begin{proof}
Omitted.
\end{proof}

\noindent
Given $K^\bullet \in D F^+(\mathcal{B})$, we get a spectral sequence
$$
E_1^{p, q} = H^{p+q}(\text{gr}^p K^\bullet) \Rightarrow H^{p+q}(\text{forget
filt}(K^\bullet)).
$$






\section{Application of filtered complexes}
\label{section-applications-filtered}

\noindent
Let $\mathcal{A}$ be an abelian category with enough injectives, and
$0 \to L \to M \to N \to 0$ a short exact sequence in $\mathcal{A}$.
Consider $\widetilde M \in \text{Fil}^f(\mathcal{A})$ to be $M$ along with the
filtration defined by
$$
F^1M = L, \ F^nM = M
\text{ for $n \leq 0$, and $F^nM = 0$ for $n \geq 2$.}
$$
By definition, we have
$$
\text{forget filt}(\widetilde M) = M, \quad
\text{gr}^0(\widetilde M) = N, \quad
\text{gr}^1(\widetilde M) = L
$$
and $\text{gr}^n(\widetilde M) = 0$ for all other $n \neq 0, 1$. Let $T:
\mathcal{A} \to \mathcal{B}$ be a left exact functor. Assume that $\mathcal{A}$
has enough injectives. Then $RT(\widetilde M) \in D F^+(\mathcal{B})$ is a
filtered complex with
$$
\text{gr}^p(RT(\widetilde M)) \stackrel {\mathrm{qis}}{=} \left \{
\begin{matrix}
0 & \text{if} & p \neq 0, 1, \\
RT(N) & \text{if} & p = 0, \\
RT(L) & \text{if} & p = 1.
\end{matrix}
\right .
$$
and $\text{forget filt}(RT(\widetilde M))\stackrel{\text{qis}}{ = } RT(M)$. The
spectral sequence applied to $RT(\widetilde M)$ gives
$$
E_1^{p, q} = R^{p+q}T(\mathrm{gr}^p(\widetilde M)) \Rightarrow
R^{p+q}T(\text{forget filt}(\widetilde M)).
$$
Unwinding the spectral sequence gives us the long exact sequence
$$
\xymatrix{
0 \ar[r] & T(L) \ar[r] & T(M) \ar[r] & T(N) \ar@(rd, ul)[rdllllr] \\
& R^1T(L) \ar[r] & R^1T(M) \ar[r] & \cdots
}
$$
This will be used as follows. Let $X/k$ be a scheme of finite type. Let
$\mathcal{F}$ be a flat constructible $\mathbf{Z}/\ell^n \mathbf{Z}$-module.
Then we want to show that the trace
$$
\text{Tr}( \pi_X^\ast | R\Gamma_c(X_{\bar k}, \mathcal{F})) \in
\mathbf{Z}/\ell^n \mathbf{Z}
$$
is additive on short exact sequences. To see this, it will not be enough to
work with $R\Gamma_c(X_{\bar k}, -) \in D^+(\mathbf{Z}/\ell^n \mathbf{Z})$, but
we will have to use the filtered derived category.







%10.29.09
\section{Perfectness}
\label{section-perfect}

\noindent
Let $\Lambda$ be a (possibly noncommutative) ring, $\text{Mod}_{\Lambda}$ the
category of left $\Lambda$-modules, $K(\Lambda) = K(\text{Mod}_\Lambda)$ its
homotopy category, and $D(\Lambda)= D(\text{Mod}_\Lambda)$ the derived
category.

\begin{definition}
\label{definition-perfect}
We denote by $K_{perf}(\Lambda)$ the category whose objects are bounded
complexes of finite projective $\Lambda$-modules, and whose morphisms are
morphisms of complexes up to homotopy. The functor $K_{perf}(\Lambda)\to
D(\Lambda)$ is fully faithful (Derived Categories, Lemma
\ref{derived-lemma-morphisms-from-projective-complex}).
Denote $D_{perf}(\Lambda)$ its essential image.
An object of $D(\Lambda)$ is called {\it perfect} if it is in
$D_{perf}(\Lambda)$.
\end{definition}

\begin{proposition}
\label{proposition-trace-well-defined}
Let $K\in D_{perf}(\Lambda)$ and $f\in \text{End}_{D(\Lambda)}(K)$. Then the
trace $\text{Tr}(f)\in \Lambda^\natural$ is well defined.
\end{proposition}

\begin{proof}
We will use Derived Categories, Lemma
\ref{derived-lemma-morphisms-from-projective-complex}
without further mention in this proof.
Let $P^\bullet$ be a bounded complex of finite projective $\Lambda$-modules
and let $\alpha: P^\bullet \to K$ be an isomorphism in $D(\Lambda)$. Then
$\alpha^{-1}\circ f\circ \alpha$ corresponds to a morphism of complexes
$f^\bullet: P^\bullet \to P^\bullet$ well defined up to homotopy.
Set
$$
\text{Tr}(f) = \sum_i (-1)^i \text{Tr}(f^i: P^i \to P^i) \in \Lambda^\natural.
$$
Given $P^\bullet$ and $\alpha$, this is independent of the choice of
$f^\bullet$. Namely, any other choice is of the form
$\tilde{f}^\bullet = f^\bullet + dh +hd$ for some
$h^i: P^i \to P^{i-1}(i\in \mathbf{Z})$. But
\begin{eqnarray*}
\text{Tr}(dh) & = & \sum_i (-1)^i \text{Tr}(P^i\xrightarrow{dh} P^i) \\
& = & \sum_i (-1)^i \text{Tr}(P^{i-1}\xrightarrow{hd} P^{i-1}) \\
& = & -\sum_i (-1)^{i-1}\text{Tr}(P^{i-1}\xrightarrow{hd} P^{i-1}) \\
& = & - \text{Tr}(hd)
\end{eqnarray*}
and so $\sum_i (-1)^i \text{Tr} ((dh+hd)|_{P^i})=0$.
Furthermore, this is independent of the choice of $(P^\bullet , \alpha)$:
suppose $(Q^\bullet, \beta)$ is another choice. The compositions
$$
Q^\bullet \xrightarrow{\beta} K \xrightarrow{\alpha^{-1}} P^\bullet
\quad\text{and}\quad
P^\bullet \xrightarrow{\alpha} K \xrightarrow{\beta^{-1}} Q^\bullet
$$
are representable by morphisms of complexes $\gamma_1^\bullet$ and
$\gamma_2^\bullet$ respectively, such that $\gamma_1^\bullet \circ
\gamma_2^\bullet$ is homotopic to the identity. Thus, the morphism of complexes
$\gamma_2^\bullet\circ f^\bullet\circ \gamma_1^\bullet: Q^\bullet\to Q^\bullet$
represents the morphism $\beta^{-1}\circ f\circ\beta$ in $D(\Lambda)$. Now
\begin{eqnarray*}
\text{Tr}(\gamma_2^\bullet\circ f^\bullet\circ\gamma_1^\bullet|_{Q^\bullet}) &
= & \text{Tr}(\gamma_1^\bullet \circ\gamma_2^\bullet \circ
f^\bullet|_{P^\bullet})\\
& = & \text{Tr}(f^\bullet|_{P^\bullet})
\end{eqnarray*}
by the fact that $\gamma_1^\bullet \circ \gamma_2^\bullet$ is homotopic to the
identity and the independence of the choice of $f^\bullet$ we saw above.
\end{proof}




\section{Filtrations and perfect complexes}
\label{section-filtrations-perfect}

\noindent
We now present a filtered version of the category of perfect complexes. An
object $(M, F)$ of $\text{Fil}^f(\text{Mod}_\Lambda)$ is called {\it filtered
finite projective} if for all $p$, $\text{gr}^p_F (M)$ is finite and
projective. We then consider the homotopy category
$K\mathrm{F}_{\text{perf}}(\Lambda)$ of bounded complexes of filtered finite
projective objects of $\text{Fil}^f(\text{Mod}_\Lambda)$. We have a diagram of
categories
$$
\begin{matrix}
K\mathrm{F}(\Lambda) & \supseteq & K\mathrm{F}_{\text{perf}}(\Lambda)\\
\downarrow & & \downarrow\\
D\mathrm{F}(\Lambda) & \supseteq & D\mathrm{F}_{\text{perf}}(\Lambda)
\end{matrix}
$$
where the vertical functor on the right is fully faithful and the category
$D\mathrm{F}_{\text{perf}}(\Lambda)$ is its essential image, as before.

\begin{lemma}[Additivity]
\label{lemma-additivity}
Let $K\in D\mathrm{F}_{\text{perf}}(\Lambda)$ and $f\in
\text{End}_{D\mathrm{F}}(K)$. Then
$$
\text{Tr}(f|_K) =
\sum\nolimits_{p\in \mathbf{Z}} \text{Tr}(f|_{\text{gr}^p K}).
$$
\end{lemma}

\begin{proof}
By Proposition \ref{proposition-trace-well-defined}, we may assume we have
a bounded
complex $P^\bullet$ of filtered finite projectives of
$\text{Fil}^f(\text{Mod}_\Lambda)$ and a map $f^\bullet: P^\bullet\to
P^\bullet$ in $\text{Comp}(\text{Fil}^f(\text{Mod}_\Lambda))$. So the lemma
follows from the following result, which proof is left to the reader.
\end{proof}

\begin{lemma}
\label{lemma-additive-filtered-finite-projective}
Let $P \in \text{Fil}^f(\text{Mod}_\Lambda)$ be filtered finite projective, and
$f: P \to P$ an endomorphism in $\text{Fil}^f(\text{Mod}_\Lambda)$. Then
$$
\text{Tr}(f|_P) =
\sum\nolimits_p \text{Tr}(f|_{\text{gr}^p(P)}).
$$
\end{lemma}

\begin{proof}
Omitted.
\end{proof}







\section{Characterizing perfect objects}
\label{section-characterizing-perfect}

\noindent
For the commutative case see
More on Algebra, Sections
\ref{more-algebra-section-pseudo-coherent},
\ref{more-algebra-section-tor}, and
\ref{more-algebra-section-perfect}.

\begin{definition}
\label{definition-finite-tor-dimension}
Let $\Lambda$ be a (possibly noncommutative) ring.
An object $K\in D(\Lambda)$ has {\it finite $\text{Tor}$-dimension}
if there exist $a, b \in \mathbf{Z}$ such that for any
right $\Lambda$-module $N$, we have
$H^i(N \otimes_{\Lambda}^\mathbf{L} K) = 0$ for all
$i \not \in [a, b]$.
\end{definition}

\noindent
This in particular means that $K \in D^b(\Lambda)$ as we see by taking
$N = \Lambda$.

\begin{lemma}
\label{lemma-characterize-perfect}
Let $\Lambda$ be a left noetherian ring and $K\in D(\Lambda)$. Then $K$ is
perfect if and only if the two following conditions hold:
\begin{enumerate}
\item
$K$ has finite $\text{Tor}$-dimension ; and
\item
for all $i \in \mathbf{Z}$, $H^i(K)$ is a finite $\Lambda$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
See More on Algebra, Lemma \ref{more-algebra-lemma-perfect}
for the proof in the commutative case.
\end{proof}

\noindent
The reader is strongly urged to try and prove this. The proof relies on the
fact that a finite module on a finitely left-presented ring is flat if and only
if it is projective.

\begin{remark}
\label{remark-variant}
A variant of this lemma is to consider a Noetherian scheme $X$
and the category $D_{perf}(\mathcal{O}_X)$ of complexes which are locally
quasi-isomorphic to a finite complex of finite locally free
$\mathcal{O}_X$-modules. Objects $K$ of $D_{perf}(\mathcal{O}_X)$
can be characterized by having coherent cohomology sheaves and
bounded tor dimension.
\end{remark}









\section{Complexes with constructible cohomology}
\label{section-Dc}

\noindent
Let $\Lambda$ be a ring. Let $X$ a scheme. Let $K(X, \Lambda)$ the
homotopy category of sheaves of $\Lambda$-modules on $X_\etale$.
Denote $D(X, \Lambda)$ the corresponding derived category.
We denote by $D^b(X, \Lambda)$ (respectively $D^+$, $D^-$)
the full subcategory of bounded (resp. above, below) complexes in
$D(X, \Lambda)$.

\begin{definition}
\label{definition-c}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
We denote {\it $D_c(X, \Lambda)$} the full subcategory
of $D(X, \Lambda)$ of complexes whose cohomology sheaves
are constructible sheaves of $\Lambda$-modules.
\end{definition}

\noindent
This definition makes sense by Lemma \ref{lemma-constructible-abelian} and
Derived Categories, Section \ref{derived-section-triangulated-sub}.
Thus we see that $D_c(X, \Lambda)$ is a strictly full, saturated
triangulated subcategory of $D_c(X, \Lambda)$.

\begin{lemma}
\label{lemma-restrict-and-shriek-from-etale-c}
Let $\Lambda$ be a Noetherian ring.
If $j : U \to X$ is an \'etale morphism of schemes, then
\begin{enumerate}
\item $K|_U \in D_c(U, \Lambda)$ if $K \in D_c(X, \Lambda)$, and
\item $j_!M \in D_c(X, \Lambda)$ if $M \in D_c(U, \Lambda)$ and
the morphism $j$ is quasi-compact and quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
The first assertion is clear. The second follows from the fact
that $j_!$ is exact and 
Lemma \ref{lemma-jshriek-constructible}.
\end{proof}

\begin{lemma}
\label{lemma-pullback-c}
Let $\Lambda$ be a Noetherian ring.
Let $f : X \to Y$ be a morphism of schemes. If $K \in D_c(Y, \Lambda)$
then $Lf^*K \in D_c(X, \Lambda)$.
\end{lemma}

\begin{proof}
This follows as $f^{-1} = f^*$ is exact and
Lemma \ref{lemma-pullback-constructible}.
\end{proof}

\begin{lemma}
\label{lemma-one-constructible}
Let $X$ be a quasi-compact and quasi-separated scheme.
Let $\Lambda$ be a Noetherian ring. Let $K \in D(X, \Lambda)$
and $b \in \mathbf{Z}$ such that $H^b(K)$ is constructible.
Then there exist a sheaf $\mathcal{F}$ which is a finite direct sum
of $j_{U!}\underline{\Lambda}$ with $U \in \Ob(X_\etale)$ affine and
a map $\mathcal{F}[-b] \to K$ in $D(X, \Lambda)$
inducing a surjection $\mathcal{F} \to H^b(K)$.
\end{lemma}

\begin{proof}
Represent $K$ by a complex $\mathcal{K}^\bullet$ of sheaves of
$\Lambda$-modules. Consider the surjection
$$
\Ker(\mathcal{K}^b \to \mathcal{K}^{b + 1})
\longrightarrow
H^b(K)
$$
By Modules on Sites, Lemma
\ref{sites-modules-lemma-module-quotient-direct-sum}
we may choose a surjection
$\bigoplus_{i \in I} j_{U_i!} \underline{\Lambda} \to
\Ker(\mathcal{K}^b \to \mathcal{K}^{b + 1})$
with $U_i$ affine. For $I' \subset I$ finite, denote
$\mathcal{H}_{I'} \subset H^b(K)$ the image of
$\bigoplus_{i \in I'} j_{U_i!} \underline{\Lambda}$.
By Lemma \ref{lemma-colimit-constructible} we see that
$\mathcal{H}_{I'} = H^b(K)$ for some $I' \subset I$ finite.
The lemma follows taking
$\mathcal{F} = \bigoplus_{i \in I'} j_{U_i!} \underline{\Lambda}$.
\end{proof}

\begin{lemma}
\label{lemma-bounded-above-c}
Let $X$ be a quasi-compact and quasi-separated scheme.
Let $\Lambda$ be a Noetherian ring. Let $K \in D^-(X, \Lambda)$. Then
the following are equivalent
\begin{enumerate}
\item $K$ is in $D_c(X, \Lambda)$,
\item $K$ can be represented by a bounded above complex
whose terms are finite direct sums of $j_{U!}\underline{\Lambda}$
with $U \in \Ob(X_\etale)$ affine,
\item $K$ can be represented by a bounded above complex
of flat constructible sheaves of $\Lambda$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (2) implies (3) and that (3) implies (1).
Assume $K$ is in $D_c^-(X, \Lambda)$.
Say $H^i(K) = 0$ for $i > b$. By induction on $a$
we will construct a complex $\mathcal{F}^a \to \ldots \to \mathcal{F}^b$
such that each $\mathcal{F}^i$ is a finite direct sum of
of $j_{U!}\underline{\Lambda}$ with $U \in \Ob(X_\etale)$ affine
and a map $\mathcal{F}^\bullet \to K$ which induces an isomorphism
$H^i(\mathcal{F}^\bullet) \to H^i(K)$ for $i > a$ and a surjection
$H^a(\mathcal{F}^\bullet) \to H^a(K)$.
For $a = b$ this can be done by Lemma \ref{lemma-one-constructible}.
Given such a datum choose a distinguished triangle
$$
\mathcal{F}^\bullet \to K \to L \to \mathcal{F}^\bullet[1]
$$
Then we see that $H^i(L) = 0$ for $i \geq a$. Choose
$\mathcal{F}^{a - 1}[-a +1] \to L$ as in
Lemma \ref{lemma-one-constructible}. The composition
$\mathcal{F}^{a - 1}[-a +1] \to L \to \mathcal{F}^\bullet$
corresponds to a map $\mathcal{F}^{a - 1} \to \mathcal{F}^a$
such that the composition with $\mathcal{F}^a \to \mathcal{F}^{a + 1}$
is zero. By TR4 we obtain a map
$$
(\mathcal{F}^{a - 1} \to \ldots \to \mathcal{F}^b) \to K
$$
in $D(X, \Lambda)$. This finishes the induction step and the
proof of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-tensor-c}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
Let $K, L \in D_c^-(X, \Lambda)$. Then
$K \otimes_\Lambda^\mathbf{L} L$ is in $D_c^-(X, \Lambda)$.
\end{lemma}

\begin{proof}
This follows from Lemmas \ref{lemma-bounded-above-c} and
\ref{lemma-tensor-product-constructible}.
\end{proof}

\begin{definition}
\label{definition-ctf}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring. We denote
{\it $D_{ctf}(X, \Lambda)$} the full subcategory of $D_c(X, \Lambda)$
consisting of objects having locally finite tor dimension.
\end{definition}

\noindent
This is a strictly full, saturated triangulated subcategory of
$D_c(X, \Lambda)$ and $D(X, \Lambda)$. By our conventions, see
Cohomology on Sites, Definition \ref{sites-cohomology-definition-tor-amplitude},
we see that
$$
D_{ctf}(X, \Lambda) \subset D^b(X, \Lambda)
$$
if $X$ is quasi-compact. A good way to think about objects of
$D_{ctf}(X, \Lambda)$ is given in Lemma \ref{lemma-when-ctf}.

\begin{remark}
\label{remark-different}
The situation with objects of $D_{ctf}(X, \Lambda)$
is different from $D_{perf}(\mathcal{O}_X)$ in
Remark \ref{remark-variant}. Namely, it can
happen that a complex of $\mathcal{O}_X$-modules is locally quasi-isomorphic to
a finite complex of finite locally free $\mathcal{O}_X$-modules, without being
globally quasi-isomorphic to a bounded complex of locally free
$\mathcal{O}_X$-modules. The following lemma shows this does not
happen for $D_{ctf}$ on a Noetherian scheme.
\end{remark}

\begin{lemma}
\label{lemma-when-ctf}
Let $\Lambda$ be a Noetherian ring. Let $X$ be a quasi-compact
and quasi-separated scheme. Let $K \in D(X, \Lambda)$. The following
are equivalent
\begin{enumerate}
\item $K \in D_{ctf}(X, \Lambda)$, and
\item $K$ can be represented by a finite complex of constructible
flat sheaves of $\Lambda$-modules.
\end{enumerate}
In fact, if $K$ has tor amplitude in $[a, b]$ then we can represent
$K$ by a complex $\mathcal{F}^a \to \ldots \to \mathcal{F}^b$ with
$\mathcal{F}^p$ a constructible flat sheaf of $\Lambda$-modules.
\end{lemma}

\begin{proof}
It is clear that a finite complex of constructible
flat sheaves of $\Lambda$-modules has finite tor dimension.
It is also clear that it is an object of $D_c(X, \Lambda)$.
Thus we see that (2) implies (1).

\medskip\noindent
Assume (1). Choose $a, b \in \mathbf{Z}$ such that
$H^i(K \otimes_\Lambda^\mathbf{L} \mathcal{G}) = 0$ if
$i \not \in [a, b]$ for all sheaves of $\Lambda$-modules $\mathcal{G}$.
We will prove the final assertion holds by induction on $b - a$. If
$a = b$, then $K = H^a(K)[-a]$ is a flat constructible sheaf
and the result holds. Next, assume $b > a$. Represent $K$
by a complex $\mathcal{K}^\bullet$ of sheaves of $\Lambda$-modules.
Consider the surjection
$$
\Ker(\mathcal{K}^b \to \mathcal{K}^{b + 1})
\longrightarrow
H^b(K)
$$
By Lemma \ref{lemma-category-constructible-modules}
we can find finitely many affine schemes $U_i$ \'etale over $X$ and a
surjection $\bigoplus j_{U_i!}\underline{\Lambda}_{U_i} \to H^b(K)$.
After replacing $U_i$ by standard \'etale coverings $\{U_{ij} \to U_i\}$
we may assume this surjection lifts to a map
$\mathcal{F} = \bigoplus j_{U_i!}\underline{\Lambda}_{U_i} \to
\Ker(\mathcal{K}^b \to \mathcal{K}^{b + 1})$.
This map determines a distinguished triangle
$$
\mathcal{F}[-b] \to K \to L \to \mathcal{F}[-b + 1]
$$
in $D(X, \Lambda)$. Since $D_{ctf}(X, \Lambda)$ is a triangulated
subcategory we see that $L$ is in it too. In fact $L$ has
tor amplitude in $[a, b - 1]$ as $\mathcal{F}$ surjects onto
$H^b(K)$ (details omitted). By induction hypothesis we can find
a finite complex $\mathcal{F}^a \to \ldots \to \mathcal{F}^{b - 1}$
of flat constructible sheaves of $\Lambda$-modules representing $L$.
The map $L \to \mathcal{F}[-b + 1]$ corresponds to a map
$\mathcal{F}^b \to \mathcal{F}$ annihilating the image
of $\mathcal{F}^{b - 1} \to \mathcal{F}^b$. Then it follows
from axiom TR3 that $K$ is represented by the complex
$$
\mathcal{F}^a \to \ldots \to \mathcal{F}^{b - 1} \to \mathcal{F}^b
$$
which finishes the proof.
\end{proof}

\begin{remark}
\label{remark-projective-each-degree}
Let $\Lambda$ be a Noetherian ring. Let $X$ be a scheme.
For a bounded complex $K^\bullet$ of constructible flat $\Lambda$-modules
on $X_\etale$
each stalk $K^p_{\overline{x}}$ is a finite projective $\Lambda$-module.
Hence the stalks of the complex are perfect complexes of $\Lambda$-modules.
\end{remark}

\begin{remark}
\label{remark-how-used}
Lemma \ref{lemma-when-ctf}
can be used to prove that if $f: X \to Y$ is a separated, finite type
morphism of schemes and $Y$ is noetherian, then $Rf_!$ induces a functor
$D_{ctf}(X, \Lambda) \to D_{ctf}(Y, \Lambda)$. We only need this fact in
the case where $Y$ is the spectrum of a field and $X$ is a curve.
\end{remark}

\begin{lemma}
\label{lemma-restrict-and-shriek-from-etale-ctf}
Let $\Lambda$ be a Noetherian ring.
If $j : U \to X$ is an \'etale morphism of schemes, then
\begin{enumerate}
\item $K|_U \in D_{ctf}(U, \Lambda)$ if $K \in D_{ctf}(X, \Lambda)$, and
\item $j_!M \in D_{ctf}(X, \Lambda)$ if $M \in D_{ctf}(U, \Lambda)$ and
the morphism $j$ is quasi-compact and quasi-separated.
\end{enumerate}
\end{lemma}

\begin{proof}
Perhaps the easiest way to prove this lemma is to reduce to the
case where $X$ is affine and then apply Lemma \ref{lemma-when-ctf}
to translate it into a statement about finite complexes
of flat constructible sheaves of $\Lambda$-modules
where the result follows from
Lemma \ref{lemma-jshriek-constructible}.
\end{proof}

\begin{lemma}
\label{lemma-pullback-ctf}
Let $\Lambda$ be a Noetherian ring.
Let $f : X \to Y$ be a morphism of schemes. If $K \in D_{ctf}(Y, \Lambda)$
then $Lf^*K \in D_{ctf}(X, \Lambda)$.
\end{lemma}

\begin{proof}
Apply Lemma \ref{lemma-when-ctf} to reduce this to a question
about finite complexes of flat constructible sheaves of $\Lambda$-modules.
Then the statement follows as $f^{-1} = f^*$ is exact and
Lemma \ref{lemma-pullback-constructible}.
\end{proof}

\begin{lemma}
\label{lemma-connected-ctf-locally-constant}
Let $X$ be a connected scheme. Let $\Lambda$ be a Noetherian ring.
Let $K \in D_{ctf}(X, \Lambda)$ have locally constant cohomology sheaves.
Then there exists a finite complex of finite projective $\Lambda$-modules
$M^\bullet$ and an \'etale covering $\{U_i \to X\}$ such that
$K|_{U_i} \cong \underline{M^\bullet}|_{U_i}$ in $D(U_i, \Lambda)$.
\end{lemma}

\begin{proof}
Choose an \'etale covering $\{U_i \to X\}$ such that $K|_{U_i}$
is constant, say $K|_{U_i} \cong \underline{M_i^\bullet}_{U_i}$
for some finite complex of finite $\Lambda$-modules $M_i^\bullet$.
See Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-locally-constant}.
Observe that $U_i \times_X U_j$ is empty if $M_i^\bullet$
is not isomorphic to $M_j^\bullet$ in $D(\Lambda)$.
For each complex of $\Lambda$-modules $M^\bullet$ let
$I_{M^\bullet} =
\{i \in I \mid M_i^\bullet \cong M^\bullet\text{ in }D(\Lambda)\}$.
As \'etale morphisms are open we see that
$U_{M^\bullet} = \bigcup_{i \in I_{M^\bullet}} \Im(U_i \to X)$
is an open subset of $X$. Then $X = \coprod U_{M^\bullet}$ is a disjoint
open covering of $X$. As $X$ is connected only one $U_{M^\bullet}$
is nonempty. As $K$ is in $D_{ctf}(X, \Lambda)$ we see that $M^\bullet$
is a perfect complex of $\Lambda$-modules, see
More on Algebra, Lemma \ref{more-algebra-lemma-perfect}.
Hence we may assume $M^\bullet$ is a finite complex of finite projective
$\Lambda$-modules.
\end{proof}








\section{Cohomology of nice complexes}
\label{section-cohomology-ctf}

\noindent
The following is a special case of a more general result about
compactly supported cohomology of objects of $D_{ctf}(X, \Lambda)$.

\begin{proposition}
\label{proposition-projective-curve-constructible-cohomology}
Let $X$ be a projective curve over a field $k$, $\Lambda$ a finite ring and
$K\in D_{ctf}(X, \Lambda)$. Then $R\Gamma(X_{\bar k}, K)\in
D_{perf}(\Lambda)$.
\end{proposition}

\begin{proof}[Sketch of proof.]
The first step is to show:
\begin{enumerate}
\item[(1)]
{\it The cohomology of $R\Gamma(X_{\bar k}, K)$ is bounded.}
\end{enumerate}
Consider the spectral sequence
$$
H^i(X_{\bar k}, \underline H^j(K))
\Rightarrow
H^{i+j} (R\Gamma(X_{\bar k}, K)).
$$
Since $K$ is bounded and $\Lambda$ is finite, the sheaves $\underline H^j(K)$
are torsion. Moreover, $X_{\bar k}$ has finite cohomological dimension, so the
left-hand side is nonzero for finitely many $i$ and $j$ only. Therefore, so is
the right-hand side.
\begin{enumerate}
\item[(2)]
{\it The cohomology groups $H^{i+j} (R\Gamma(X_{\bar k}, K))$ are finite.}
\end{enumerate}
Since the sheaves $\underline H^j(K)$ are constructible, the groups
$H^i(X_{\bar k}, \underline H^j(K))$ are finite
(Section \ref{section-vanishing-torsion}) so
it follows by the spectral sequence again.
\begin{enumerate}
\item[(3)]
{\it $R\Gamma(X_{\bar k}, K)$ has finite $\text{Tor}$-dimension.}
\end{enumerate}
Let $N$ be a right $\Lambda$-module (in fact, since $\Lambda$ is finite, it
suffices to assume that $N$ is finite). By the projection formula (change of
module),
$$
N \otimes^\mathbf{L}_\Lambda R \Gamma(X_{\bar k}, K) = R\Gamma(X_{\bar k},
N \otimes^\mathbf{L}_\Lambda K).
$$
Therefore,
$$
H^i (N \otimes^\mathbf{L}_\Lambda R\Gamma(X_{\bar k}, K)) = H^i(R\Gamma(X_{\bar
k}, N \otimes_{\Lambda}^\mathbf{L} K)).
$$
Now consider the spectral sequence
$$
H^i (X_{\bar k}, \underline H^j (N \otimes_{\Lambda}^\mathbf{L} K))
\Rightarrow
H^{i+j}(R\Gamma(X_{\bar k}, N \otimes_{\Lambda}^\mathbf{L} K)).
$$
Since $K$ has finite $\text{Tor}$-dimension, $\underline H^j
(N \otimes_{\Lambda}^\mathbf{L} K)$ vanishes universally for $j$ small enough,
and the left-hand side vanishes whenever $i < 0$. Therefore $R\Gamma(X_{\bar
k}, K)$ has finite $\text{Tor}$-dimension, as claimed. So it is a perfect
complex by Lemma \ref{lemma-characterize-perfect}.
\end{proof}





\section{Lefschetz numbers}
\label{section-lefschetz-numbers}

\noindent
The fact that the total cohomology of a constructible complex of finite tor
dimension is a perfect complex is the key technical reason why cohomology
behaves well, and allows us to define rigorously the traces occurring in the
trace formula.

\begin{definition}
\label{definition-global-lefschetz-number}
Let $\Lambda$ be a finite ring, $X$ a projective curve over a finite field $k$
and $K \in D_{ctf}(X, \Lambda)$ (for instance $K = \underline\Lambda$).
There is a canonical map $c_K : \pi_X^{-1}K \to K$, and its base change
$c_K|_{X_{\bar k}}$ induces an action denoted $\pi_X^*$ on the perfect
complex $R\Gamma(X_{\bar k}, K|_{X_{\bar k}})$. The
{\it global Lefschetz number} of $K$ is the trace $
\text{Tr}(\pi_X^*\left|_{R\Gamma(X_{\bar k}, K)}\right.)$ of that action.
It is an element of $\Lambda^\natural$.
\end{definition}

\begin{definition}
\label{definition-local-lefschetz-number}
With $\Lambda, X, k, K$ as in
Definition \ref{definition-global-lefschetz-number}.
Since $K\in D_{ctf}(X, \Lambda)$, for any geometric point $\bar x$ of $X$,
the complex $K_{\bar x}$ is a perfect complex (in $D_{perf}(\Lambda)$). As we
have seen in Section \ref{section-frobenii}, the Frobenius $\pi_X$ acts on
$K_{\bar x}$. The {\it local Lefschetz number} of $K$ is the sum
$$
\sum_{x\in X(k)} \text{Tr}(\pi_X \left|_{K_{\overline x}}\right.)
$$
which is again an element of $\Lambda^\natural$.
\end{definition}

\noindent
At last, we can formulate precisely the trace formula.

\begin{theorem}[Lefschetz Trace Formula]
\label{theorem-trace}
Let $X$ be a projective curve over a finite field $k$, $\Lambda$ a finite ring
and $K \in D_{ctf}(X, \Lambda)$. Then the global and local Lefschetz numbers
of $K$ are equal, i.e.,
\begin{equation}
\label{equation-trace-formula}
\text{Tr}(\pi^*_X\left|_{R\Gamma(X_{\bar k}, K)}\right.)
=
\sum\nolimits_{x\in X(k)} \text{Tr}(\pi_X\left|_{K_{\bar x}}\right.)
\end{equation}
in $\Lambda^\natural$.
\end{theorem}

\begin{proof}
See discussion below.
\end{proof}

%11.5.09
\noindent
We will use, rather than prove, the trace formula. Nevertheless, we will
give quite a few details of the proof of the theorem as given in
\cite{SGA4.5} (some of the things that are not adequately explained
are listed in Section \ref{section-list-skipped}).

\medskip\noindent
We only stated the formula for curves, and in some weak
sense it is a consequence of the following result.

\begin{theorem}[Weil]
\label{theorem-weil-trace-formula}
Let $C$ be a nonsingular projective curve over an algebraically closed field
$k$, and $\varphi : C \to C$ a $k$-endomorphism of $C$ distinct from the
identity. Let $V(\varphi) = \Delta_C \cdot \Gamma_\varphi$, where $\Delta_C$ is
the diagonal, $\Gamma_\varphi$ is the graph of $\varphi$, and the intersection
number is taken on $C \times C$. Let $J = \underline{\text{Pic}}^0_{C/k}$ be the
jacobian of $C$ and denote $\varphi^* : J \to J$ the action induced by
$\varphi$ by taking pullbacks. Then
$$
V(\varphi) = 1 - \text{Tr}_J(\varphi^*) + \deg \varphi.
$$
\end{theorem}

\begin{proof}
The number $V(\varphi)$ is the number of fixed points of $\varphi$, it is equal
to
$$
V(\varphi) = \sum_{c \in |C| : \varphi(c) = c} m_\text{Fix$(\varphi)$} (c)
$$
where $m_\text{Fix$(\varphi)$} (c)$ is the multiplicity of $c$ as a fixed point
of $\varphi$, namely the order or vanishing of the image of a local uniformizer
under $\varphi - \text{id}_C$. Proofs of this theorem can be found in
\cite{Lang, Weil}.
\end{proof}

\begin{example}
\label{example-elliptic-curve}
Let $C = E$ be an elliptic curve and $\varphi = [n]$ be multiplication by $n$.
Then $\varphi^* = \varphi^t$ is multiplication by $n$ on the jacobian, so it
has trace $2n$ and degree $n^2$. On the other hand, the fixed points of
$\varphi$ are the points $p \in E$ such that $n p = p$, which is the
$(n-1)$-torsion, which has cardinality $(n-1)^2$. So the theorem reads
$$
(n-1)^2 = 1 - 2n + n^2.
$$
\end{example}

\noindent
{\bf Jacobians.}
We now discuss without proofs the correspondence between a curve and its
jacobian which is used in Weil's proof. Let $C$ be a nonsingular projective
curve over an algebraically closed field $k$ and choose a base point $c_0 \in
C(k)$. Denote by $A^1(C \times C)$ (or $\text{Pic} (C \times C)$, or
$\text{CaCl}(C \times C)$) the abelian group of codimension 1 divisors of
$C \times C$. Then
$$
A^1(C \times C) = \text{pr}_1^* (A^1(C)) \oplus \text{pr}_2^* (A^1(C)) \oplus R
$$
where
$$
R = \{ Z \in A^1(C \times C) \ |
\ Z|_{C \times \{c_0\}} \sim_\text{rat} 0
\text{ and }
Z|_{\{c_0\} \times C} \sim_\text{rat} 0 \}.
$$
In other words,
$R$ is the subgroup of line bundles which pull back to the trivial one under
either projection. Then there is a canonical isomorphism of abelian groups $R
\cong \text{End}(J)$ which maps a divisor $Z$ in $R$ to the endomorphism
$$
\begin{matrix}
J & \to & J \\
\left[ \mathcal{O}_C(D) \right] & \mapsto & (\text{pr}_1 |_Z)_* (\text{pr}_2
|_Z)^* (D).
\end{matrix}
$$
The aforementioned correspondence is the following. We denote by $\sigma$ the
automorphism of $C \times C$ that switches the factors.
$$
\begin{matrix}
\hline & \\
\text{End}(J) & R \\
& \\
\hline & \\
\text{composition of $\alpha, \beta$} &
{\text{pr}_{13}}_* ({\text{pr}_{12}}^*(\alpha) \circ {\text{pr}_{23}}^*(\beta))
\\
& \\
\text{id}_J &
\Delta_C - \{c_0\} \times C - C \times \{c_0\} \\
& \\
\varphi^* &
\Gamma_\varphi - C \times \{\varphi(c_0)\}
- \sum_{\varphi(c) = c_0} \{c\} \times C \\
& \\
{
\begin{matrix}
\text{the trace form} \\
\alpha, \beta \mapsto \text{Tr}(\alpha \beta)
\end{matrix}
}
&
\alpha, \beta \mapsto - \int_{C \times C} \alpha . \sigma^*\beta
\\
& \\
{
\begin{matrix}
\text{the Rosati involution} \\
\alpha \mapsto \alpha^\dagger
\end{matrix}
}
&
\alpha \mapsto \sigma^*\alpha
\\
& \\
{
\begin{matrix}
\text{positivity of Rosati} \\
\text{Tr}(\alpha\alpha^\dagger) > 0
\end{matrix}
}
&
{
\begin{matrix}
\text{Hodge index theorem on $C \times C$} \\
- \int_{C \times C} \alpha \sigma^*\alpha > 0.
\end{matrix}
}
\\
& \\
\hline
\end{matrix}
$$
In fact, in light of the Kunneth formula, the subgroup $R$ corresponds to the
$1, 1$ hodge classes in $H^1(C)\otimes H^1(C)$.

\medskip\noindent
{\bf Weil's proof.} Using this correspondence, we can prove the trace
formula. We have
\begin{eqnarray*}
V(\varphi) & = & \int_{C \times C} \Gamma_\varphi.\Delta \\
& = & \int_{C \times C} \Gamma_\varphi. \left(\Delta_C - \{c_0\} \times C - C
\times \{c_0\}\right) + \int_{C \times C} \Gamma_\varphi. \left(\{c_0\} \times C
+ C \times \{c_0\}\right).
\end{eqnarray*}
Now, on the one hand
$$
\int_{C \times C} \Gamma_\varphi. \left(\{c_0\} \times C + C \times
\{c_0\}\right)
=
1 + \deg \varphi
$$
and on the other hand, since $R$ is the orthogonal of the ample divisor
$\{c_0\} \times C + C \times \{c_0\}$,
\begin{eqnarray*}
& &
\int_{C \times C} \Gamma_\varphi. \left(\Delta_C - \{c_0\} \times C - C \times
\{c_0\}\right) \\
& = &
\int_{C \times C} \left(\Gamma_\varphi - C \times \{\varphi(c_0)\} -
\sum_{\varphi(c) = c_0} \{c\} \times C \right). \left(\Delta_C - \{c_0\} \times
C - C \times \{c_0\}\right) \\
& = & - \text{Tr}_J (\varphi^* \circ \text{id}_J).
\end{eqnarray*}
Recapitulating, we have
$$
V(\varphi) = 1 - \text{Tr}_J (\varphi^*) + \deg \varphi
$$
which is the trace formula.

\begin{lemma}
\label{lemma-weil-mod}
Consider the situation of
Theorem \ref{theorem-weil-trace-formula}
and let $\ell$ be a prime number invertible in $k$. Then
$$
\sum\nolimits_{i=0}^2
(-1)^i
\text{Tr}(\varphi^* |_{H^i (C, \underline{\mathbf{Z}/\ell^n \mathbf{Z}})})
=
V(\varphi) \mod \ell^n.
$$
\end{lemma}

\begin{proof}[Sketch of proof]
Observe first that the assumption makes sense because $H^i(C,
\underline{\mathbf{Z}/\ell^n \mathbf{Z}})$ is a free $\mathbf{Z}/\ell^n
\mathbf{Z}$-module for all $i$. The trace of $\varphi^*$ on the 0th degree
cohomology is 1. The choice of a primitive $\ell^n$th root of unity in $k$
gives an isomorphism
$$
H^i(C, \underline{\mathbf{Z}/\ell^n \mathbf{Z}}) \cong H^i(C, \mu_{\ell^n})
$$
compatibly with the action of the geometric Frobenius. On the other hand,
$H^1(C, \mu_{\ell^n}) = J[\ell^n]$. Therefore,
\begin{eqnarray*}
\text{Tr}(\varphi^* |_{H^1 (C, \underline{\mathbf{Z}/\ell^n \mathbf{Z}})})) & =
& \text{Tr}_J (\varphi^*) \mod \ell^n \\
& = & \text{Tr}_{\mathbf{Z}/\ell^n \mathbf{Z}} (\varphi^* : J[\ell^n] \to
J[\ell^n]).
\end{eqnarray*}
Moreover, $H^2(C, \mu_{\ell^n}) = \text{Pic}(C)/\ell^n\text{Pic}(C) \cong
\mathbf{Z}/\ell^n \mathbf{Z}$ where $\varphi^*$ is multiplication by $\deg
\varphi$. Hence
$$
\text{Tr} (\varphi^*|_{H^2 (C, \underline{\mathbf{Z}/\ell^n \mathbf{Z}})}) =
\deg \varphi.
$$
Thus we have
$$
\sum_{i=0}^2 (-1)^i \text{Tr}(\varphi^* |_{H^i (C, \underline{\mathbf{Z}/\ell^n
\mathbf{Z}})}) = 1 - \text{Tr}_J(\varphi^*) + \deg \varphi \mod \ell^n
$$
and the corollary follows from Theorem \ref{theorem-weil-trace-formula}.
\end{proof}

\noindent
An alternative way to prove this corollary is to show that
$$
X \mapsto H^* (X, \mathbf{Q}_\ell) =
\mathbf{Q}_\ell \otimes
\lim_n H^*(X, \mathbf{Z}/\ell^n\mathbf{Z})
$$
defines a Weil cohomology theory on smooth projective varieties over $k$. Then
the trace formula
$$
V(\varphi) = \sum_{i=0}^2 (-1)^i \text{Tr}(\varphi^* |_{H^i
(C, \mathbf{Q}_\ell)})
$$
is a formal consequence of the axioms (it's an exercise in linear algebra, the
proof is the same as in the topological case).




%11.10.09
\section{Preliminaries and sorites}
\label{section-preliminaries}

\noindent
Notation:
We fix the notation for this section. We denote by $A$ a commutative ring,
$\Lambda$ a (possibly noncommutative) ring with a ring map $A\to \Lambda$ which
image lies in the center of $\Lambda$. We let $G$ be a finite group, $\Gamma$ a
{\it monoid extension of $G$ by $\mathbf{N}$}, meaning that there is an exact
sequence
$$
1\to G\to \tilde\Gamma\to \mathbf{Z}\to 1
$$
and $\Gamma$ consists of those elements of $\tilde\Gamma$ which image is
nonnegative. Finally, we let $P$ be an $A[\Gamma]$-module which is finite and
projective as an $A[G]$-module, and $M$ a $\Lambda[\Gamma]$-module which is
finite and projective as a $\Lambda$-module.

\medskip\noindent
Our goal is to compute the trace of $1 \in \mathbf{N}$ acting over $\Lambda$
on the coinvariants of $G$ on $P \otimes_A M$, that is, the number
$$
\text{Tr}_{\Lambda}\left(1; \left(P \otimes_A M\right)_G\right) \in
\Lambda^\natural.
$$
The element $1\in \mathbf{N}$ will correspond to the Frobenius.

\begin{lemma}
\label{lemma-epsilon}
Let $e\in G$ denote the neutral element. The map
$$
\begin{matrix}
\Lambda[G] & \longrightarrow & \Lambda^{\natural}\\
\sum \lambda_g\cdot g & \longmapsto& \lambda_e
\end{matrix}
$$
factors through $\Lambda[G]^\natural$. We denote $\varepsilon:
\Lambda[G]^\natural\to \Lambda^\natural$ the induced map.
\end{lemma}

\begin{proof}
We have to show the map annihilates commutators. One has
$$
\left(\sum\lambda_g g\right)\left(\sum\mu_g g\right)-\left(\sum \mu_g
g\right)\left(\sum\lambda_g g\right)
= \sum_g\left(\sum_{g_1g_2=g}
\lambda_{g_1}\mu_{g_2}-\mu_{g_1}\lambda_{g_2}\right)g
$$
The coefficient of $e$ is
$$
\sum_g\left(\lambda_g\mu_{g^{-1}}-\mu_g\lambda_{g^{-1}}\right) =
\sum_g\left(\lambda_g\mu_{g^{-1}}-\mu_{g^{-1}}\lambda_g\right)
$$
which is a sum of commutators, hence it it zero in $\Lambda^\natural$.
\end{proof}

\begin{definition}
\label{definition-trace-G}
Let $f: P\to P$ be an
endomorphism of a finite projective $\Lambda[G]$-module
$P$. We define
$$
\text{Tr}_{\Lambda}^G(f; P) := \varepsilon\left(\text{Tr}_{\Lambda[G]}(f;
P)\right)
$$
to be the {\it $G$-trace of $f$ on $P$}.
\end{definition}

\begin{lemma}
\label{lemma-lambda-trace}
Let $f: P\to P$ be an endomorphism of the finite projective
$\Lambda[G]$-module $P$. Then
$$
\text{Tr}_{\Lambda}(f; P) = \# G \cdot \text{Tr}_\Lambda^G(f; P).
$$
\end{lemma}

\begin{proof}
By additivity, reduce to the case $P = \Lambda[G]$.
In that case, $f$ is given by
right multiplication by some element $\sum\lambda_g\cdot g$ of $\Lambda[G]$. In
the basis $(g)_{g \in G}$, the matrix of $f$ has coefficient
$\lambda_{g_2^{-1}g_1}$ in the $(g_1, g_2)$ position. In particular, all
diagonal coefficients are $\lambda_e$, and there are $\#G$ such coefficients.
\end{proof}

\begin{lemma}
\label{lemma-A-module-structure}
The map $A\to \Lambda$ defines an $A$-module structure on $\Lambda^\natural$.
\end{lemma}

\begin{proof}
This is clear.
\end{proof}

\begin{lemma}
\label{lemma-diagonal-action-projective-module}
Let $P$ be a finite projective $A[G]$-module and $M$ a $\Lambda[G]$-module,
finite projective as a $\Lambda$-module. Then $P \otimes_A M$ is a finite
projective $\Lambda[G]$-module, for the structure induced by the diagonal
action of $G$.
\end{lemma}

\noindent
Note that $P \otimes_A M$ is naturally a $\Lambda$-module since $M$ is.
Explicitly, together with the diagonal action this reads
$$
\left(\sum\lambda_g g\right)\left(p \otimes m\right)
=
\sum g p \otimes \lambda_g g m.
$$

\begin{proof}
For any $\Lambda[G]$-module $N$ one has
$$
\Hom_{\Lambda[G]}\left(P \otimes_A M, N\right)= \Hom_{A[G]}\left(P,
\Hom_{\Lambda}(M, N)\right)
$$
where the $G$-action on $\Hom_{\Lambda}(M, N)$ is given by $(g\cdot
\varphi)(m) = g \varphi (g^{-1} m) $. Now it suffices to observe that the
right-hand side is a composition of exact functors, because of the projectivity
of $P$ and $M$.
\end{proof}

\begin{lemma}
\label{lemma-multiplicative-trace}
With assumptions as in
Lemma \ref{lemma-diagonal-action-projective-module},
let
$u\in \text{End}_{A[G]}(P)$ and $v\in \text{End}_{\Lambda[G]}(M)$. Then
$$
\text{Tr}_\Lambda^G \left(u \otimes v; P \otimes_A M\right) = \text{Tr}_A^G(u;
P)\cdot \text{Tr}_\Lambda(v;M).
$$
\end{lemma}

\begin{proof}[Sketch of proof]
Reduce to the case $P=A[G]$. In that case, $u$ is right multiplication by some
element $a = \sum a_gg$ of $A[G]$, which we write $u = R_a$. There is an
isomorphism of $\Lambda[G]$-modules
$$
\begin{matrix}
\varphi: & A[G]\otimes_A M & \cong & \left(A[G]\otimes_A M\right)'\\
& g \otimes m & \longmapsto & g \otimes g^{-1}m
\end{matrix}
$$
where $\left(A[G]\otimes_A M\right)'$ has the module structure given by the
left $G$-action, together with the $\Lambda$-linearity on $M$. This transport
of structure changes $u \otimes v$ into $\sum_ga_gR_g \otimes g^{-1}v$. In other
words,
$$
\varphi \circ (u \otimes v) \circ \varphi^{-1}
=
\sum_ga_gR_g \otimes g^{-1}v.
$$
Working out explicitly both sides of the equation, we have to show
$$
\text{Tr}_\Lambda^G\left(\sum_g a_gR_g \otimes g^{-1}v\right) = a_e\cdot
\text{Tr}_\Lambda(v; M).
$$
This is done by showing that
$$
\text{Tr}_\Lambda^G\left(a_gR_g \otimes g^{-1}v\right) =
\left\{
\begin{matrix}
0 & \text{ if } g\neq e\\
a_e\text{Tr}_\Lambda\left(v; M\right) & \text{ if }g=e
\end{matrix}
\right.
$$
by reducing to $M=\Lambda$.
\end{proof}

\noindent
Notation:
Consider the monoid extension $1 \to G\to \Gamma\to \mathbf{N} \to 1$ and let
$\gamma\in \Gamma$.
Then we write $Z_\gamma = \{g\in G\ | \ g\gamma=\gamma g\}$.

\begin{lemma}
\label{lemma-gamma-z-gamma-trace}
Let $P$ be a $\Lambda[\Gamma]$-module, finite and projective as a
$\Lambda[G]$-module, and $\gamma \in \Gamma$. Then
$$
\text{Tr}_{\Lambda}(\gamma; P) =
\# Z_\gamma \cdot \text{Tr}_\Lambda^{Z_\gamma}\left(\gamma; P\right).
$$
\end{lemma}

\begin{proof}
This follows readily from Lemma \ref{lemma-lambda-trace}.
\end{proof}

\begin{lemma}
\label{lemma-weak-trace}
Let $P$ be an $A[\Gamma]$-module, finite projective as $A[G]$-module. Let $M$
be a $\Lambda[\Gamma]$-module, finite projective as a $\Lambda$-module. Then
$$
\text{Tr}_{\Lambda}^{Z_\gamma}(\gamma; P \otimes_A M) = \text{Tr}_A^{Z_\gamma}
(\gamma;P)\cdot \text{Tr}_\Lambda(\gamma; M).
$$
\end{lemma}

\begin{proof}
This follows directly from Lemma \ref{lemma-multiplicative-trace}.
\end{proof}

\begin{lemma}
\label{lemma-trivial-trace}
Let $P$ be a $\Lambda[\Gamma]$-module, finite projective as
$\Lambda[G]$-module. Then the coinvariants
$P_G = \Lambda \otimes_{\Lambda[G]} P$
form a finite projective $\Lambda$-module, endowed with an action of
$\Gamma/G = \mathbf{N}$. Moreover, we have
$$
\text{Tr}_\Lambda(1; P_G) =
\sum\nolimits'_{\gamma \mapsto 1} \text{Tr}_\Lambda^{Z_\gamma}(\gamma; P)
$$
where $\sum_{\gamma\mapsto 1}'$ means taking the sum over the $G$-conjugacy
classes in $\Gamma$.
\end{lemma}

\begin{proof}[Sketch of proof]
We first prove this after multiplying by $\#G$.
$$
\# G\cdot \text{Tr}_\Lambda(1; P_G)
= \text{Tr}_\Lambda\bigg(\sum_{\gamma\mapsto 1} \gamma; P_G\bigg)
= \text{Tr}_\Lambda\bigg(\sum_{\gamma\mapsto 1} \gamma; P\bigg)
$$
where the second equality follows by considering the commutative triangle
$$
\xymatrix{
{P^G \ } \ar^a@{^(->}[r] & P \ar^b@{->>}[r] & P_G \ar^c@/^1pc/[ll]
}
$$
where $a$ is the canonical inclusion, $b$ the canonical surjection and $c =
\sum_{\gamma \mapsto 1} \gamma$. Then we have
$$
\bigg(\sum_{\gamma \mapsto 1} \gamma\bigg) \bigg|_P = a \circ c \circ b
\qquad \text{and} \qquad
\bigg(\sum_{\gamma \mapsto 1} \gamma\bigg) \bigg|_{P_G} = b \circ a \circ c
$$
hence they have the same trace. We then have
$$
\# G\cdot \text{Tr}_\Lambda(1; P_G)
=
{\sum_{\gamma\mapsto 1}}' \frac{\# G}{\# Z_\gamma}\text{Tr}_\Lambda(\gamma;P)
= \# G{\sum_{\gamma\mapsto 1}}' \text{Tr}_\Lambda^{Z_\gamma}(\gamma; P).
$$
To finish the proof, reduce to case $\Lambda$ torsion-free by some universality
argument. See \cite{SGA4.5} for details.
\end{proof}

\begin{remark}
\label{remark-content-trivial-trace}
Let us try to illustrate the content of the formula of
Lemma \ref{lemma-weak-trace}.
Suppose that $\Lambda$, viewed as a trivial $\Gamma$-module, admits a finite
resolution
$
0\to P_r\to \ldots \to P_1 \to P_0\to \Lambda\to 0
$
by some $\Lambda[\Gamma]$-modules $P_i$ which are finite and projective as
$\Lambda[G]$-modules. In that case
$$
H_*\left(\left(P_\bullet\right)_G\right) =
\text{Tor}_*^{\Lambda[G]}\left(\Lambda, \Lambda\right) = H_*(G, \Lambda) ;
$$
and
$$
\text{Tr}_\Lambda^{Z_\gamma}\left(\gamma; P_\bullet\right) =\frac{1}{\#
Z_\gamma}\text{Tr}_\Lambda(\gamma; P_\bullet)=\frac{1}{\#
Z_\gamma}\text{Tr}(\gamma;\Lambda) = \frac{1}{\# Z_\gamma}.
$$
Therefore, Lemma \ref{lemma-weak-trace} says
$$
\text{Tr}_\Lambda (1 ; P_G)
= \text{Tr}\left(1\left|_{H_*(G, \Lambda)}\right.\right)
= {\sum_{\gamma\mapsto1}}'\frac{1}{\# Z_\gamma}.
$$
This can be interpreted as a point count on the stack $BG$. If
$\Lambda = \mathbf{F}_\ell$ with $\ell$ prime to $\#G$, then
$H_*(G, \Lambda)$ is $\mathbf{F}_\ell$ in degree 0 (and $0$ in
other degrees) and the formula reads
$$
1 =
\sum\nolimits_{
\frac{\sigma\text{-conjugacy}}{\text{classes}\left<\gamma\right>}
}
\frac{1}{\# Z_\gamma} \mod{\ell}.
$$
This is in some sense a ``trivial'' trace formula for $G$.
Later we will see that (\ref{equation-trace-formula}) can in
some cases be viewed as a highly nontrivial trace formula for a
certain type of group, see
Section \ref{section-abstract-trace-formula}.
\end{remark}





%11.12.09
\section{Proof of the trace formula}
\label{section-proof-trace-formula}

\begin{theorem}
\label{theorem-trace-formula-again}
Let $k$ be a finite field and $X$ a finite type, separated scheme of dimension
at most 1 over $k$. Let $\Lambda$ be a finite ring whose cardinality is prime
to that of $k$, and $K\in D_{ctf}(X, \Lambda)$. Then
\begin{equation}
\label{equation-trace-formula-again}
\text{Tr} \left(\pi_X^*\big|_{R\Gamma_c(X_{\bar k}, K)}\right)
=
\sum\nolimits_{x\in X(k)}
\text{Tr}\left(\pi_x\big|_{K_{\bar x}}\right)
\end{equation}
in $\Lambda^{\natural}$.
\end{theorem}

\noindent
Please see Remark \ref{remark-on-trace-formula-again} for some remarks
on the statement. Notation: For short, we write
$$
T'(X, K) =
\sum\nolimits_{x\in X(k)}
\text{Tr}\big(\pi_x\big|_{K_{\bar x}}\big)
$$
for the right-hand side of (\ref{equation-trace-formula-again}) and
$$
T''(X, K)
=\text{Tr}\big(\pi_x^*\big|_{R\Gamma_c(X_{\bar k}, K)}\big)
$$
for the left-hand side.

\begin{proof}[Proof of Theorem \ref{theorem-trace-formula-again}]
The proof proceeds in a number of steps.

\medskip\noindent
Step 1. {\it Let $j: \mathcal{U}\hookrightarrow X$ be an open immersion with
complement $Y = X - \mathcal{U}$ and $i: Y \hookrightarrow X$. Then
$T''(X, K) = T''(\mathcal{U}, j^{-1} K)+ T''(Y, i^{-1}K)$ and
$T'(X, K) = T'(\mathcal{U}, j^{-1} K)+ T'(Y, i^{-1}K)$.}

\medskip\noindent
This is clear for $T'$. For $T''$ use the exact sequence
$$
0\to j_!j^{-1} K \to K \to i_* i^{-1} K \to 0
$$
to get a filtration on $K$. This gives rise to an object
$\widetilde K \in D\mathrm{F}(X, \Lambda)$
whose graded pieces are $j_!j^{-1}K$ and $i_*i^{-1}K$,
both of which lie in $D_{ctf}(X, \Lambda)$. Then, by filtered derived
abstract nonsense (INSERT REFERENCE),
$R\Gamma_c(X_{\bar k}, K)\in D\mathrm{F}_{perf}(\Lambda)$,
and it comes equipped with $\pi_x^*$ in
$D\mathrm{F}_{perf}(\Lambda)$.
By the discussion of traces on filtered complexes (INSERT REFERENCE) we get
\begin{eqnarray*}
\text{Tr}\left(\pi_X^*\big|_{R\Gamma_c(X_{\bar k}, K)}\right)
& = & \text{Tr}\left(\pi_X^*\big|_{R\Gamma_c(X_{\bar k}, j_!j^{-1}K)}\right)+
\text{Tr}\left(\pi_X^*\big|_{R\Gamma_c(X_{\bar k}, i_*i^{-1}K)}\right)
\\
& = & T''(U, i^{-1}K) + T''(Y, i^{-1}K).
\end{eqnarray*}

\medskip\noindent
Step 2. {\it The theorem holds if $\dim X\leq 0$. }

\medskip\noindent
Indeed, in that case
$$
R\Gamma_c(X_{\bar k}, K) = R\Gamma(X_{\bar k}, K) = \Gamma(X_{\bar k}, K) =
\bigoplus\nolimits_{\bar x\in X_{\bar k}} K_{\bar x} \leftarrow \pi_X*.
$$
Since the fixed points of $\pi_X: X_{\bar k}\to X_{\bar k}$ are exactly the
points $\bar x\in X_{\bar k}$ which lie over a $k$-rational point $x\in X(k)$
we get
$$
\text{Tr}\big(\pi_X^*|_{R\Gamma_c(X_{\bar k}, K)}\big) =
\sum\nolimits_{x\in X(k)}\text{Tr}(\pi_{\bar x}|_{K_{\bar x}}).
$$

\medskip\noindent
Step 3. {\it It suffices to prove the equality
$T'(\mathcal{U}, \mathcal{F}) = T''(\mathcal{U}, \mathcal{F})$
in the case where
\begin{itemize}
\item $\mathcal{U}$ is a smooth irreducible affine curve over $k$ ;
\item $\mathcal{U}(k) = \emptyset$ ;
\item $K=\mathcal{F}$ is a finite locally constant sheaf of $\Lambda$-modules
on $\mathcal{U}$ whose stalk(s) are finite projective $\Lambda$-modules ; and
\item $\Lambda$ is killed by a power of a prime $\ell$ and $\ell \in k^*$.
\end{itemize}
}

\medskip\noindent
Indeed, because of Step 2, we can throw out any finite set of points. But we
have only finitely many rational points, so we may assume there are
none\footnote{At this point, there should be an evil laugh in the background.}.
We may assume that $\mathcal{U}$ is smooth irreducible and affine by passing to
irreducible components and throwing away the bad points if necessary. The
assumptions of $\mathcal{F}$ come from unwinding the definition of
$D_{ctf}(X, \Lambda)$ and those on $\Lambda$ from considering its primary
decomposition.

\medskip\noindent
For the remainder of the proof, we consider the situation
$$
\xymatrix{
\mathcal{V} \ar[d]_f \ar[r] & Y \ar[d]^{\bar f} \\	
\mathcal{U} \ar[r] & X
}
$$
where $\mathcal{U}$ is as above, $f$ is a finite \'etale Galois covering,
$\mathcal{V}$ is connected and the horizontal arrows are projective
completions. Denoting $G=\text{Aut}(\mathcal{V}|\mathcal{U})$, we also assume
(as we may) that $f^{-1}\mathcal{F} =\underline M$ is constant, where the
module $M = \Gamma(\mathcal{V}, f^{-1}\mathcal{F})$ is a $\Lambda[G]$-module
which is finite and projective over $\Lambda$. This corresponds to the trivial
monoid extension
$$
1\to G\to \Gamma=G \times \mathbf{N}\to \mathbf{N}\to 1.
$$
In that context, using the reductions above, we need to show that
$T''(\mathcal{U}, \mathcal{F}) = 0$.

\medskip\noindent
Step 4. {\it There is a natural action of $G$ on $f_*f^{-1}\mathcal{F}$ and
the trace map $f_*f^{-1}\mathcal{F}\to \mathcal{F}$ defines an isomorphism}
$$
(f_*f^{-1}\mathcal{F})\otimes_{\Lambda[G]} \Lambda=(f_*f^{-1}\mathcal{F})_G
\cong \mathcal{F}.
$$

\medskip\noindent
To prove this, simply unwind everything at a geometric point.

\medskip\noindent
Step 5. {\it
Let $A = \mathbf{Z}/\ell^n \mathbf{Z}$ with $n\gg 0$. Then
$f_*f^{-1}\mathcal{F} \cong (f_*\underline A)
\otimes_{\underline A} \underline M$ with diagonal $G$-action.}

\medskip\noindent
Step 6. {\it There is a canonical isomorphism
$(f_*\underline A \otimes_{\underline A} \underline M)
\otimes_{\Lambda[G]} \underline \Lambda \cong \mathcal{F}$.
}

\medskip\noindent
In fact, this is a derived tensor product, because of the projectivity
assumption on $\mathcal{F}$.

\medskip\noindent
Step 7. {\it There is a canonical isomorphism
$$
R\Gamma_c(\mathcal{U}_{\bar k}, \mathcal{F})
= (R\Gamma_c(\mathcal{U}_{\bar k}, f_*A)\otimes_A^\mathbf{L}
M)\otimes_{\Lambda[G]}^\mathbf{L} \Lambda,
$$
compatible with the action of $\pi^*_\mathcal{U}$.
}

\medskip\noindent
This comes from the universal coefficient theorem, i.e., the fact that
$R\Gamma_c$ commutes with $\otimes^\mathbf{L}$, and the flatness of
$\mathcal{F}$ as a $\Lambda$-module.

\medskip\noindent
We have
\begin{eqnarray*}
\text{Tr}(
\pi_\mathcal{U}^*\big|_{R\Gamma_c(\mathcal{U}_{\bar k}, \mathcal{F})})
& = &
{\sum_{g \in G}}'
\text{Tr}_{\Lambda}^{Z_g}
\left(
(g, \pi_\mathcal{U}^*)
\big|_{R\Gamma_c(\mathcal{U}_{\bar k}, f_*A)\otimes_A^\mathbf{L} M}
\right) \\
& = &
{\sum_{g\in G}}'
\text{Tr}_A^{Z_g}
(
(g, \pi_\mathcal{U}^*)\big|_{R\Gamma_c(\mathcal{U}_{\bar k}, f_*A)}
)
\cdot
\text{Tr}_\Lambda(g|_M)
\end{eqnarray*}
where $\Gamma$ acts on $R\Gamma_c(\mathcal{U}_{\bar k}, \mathcal{F})$ by $G$
and $(e, 1)$ acts via $\pi_\mathcal{U}^*$. So the monoidal extension is given
by $\Gamma = G \times \mathbf{N} \to \mathbf{N}$, $\gamma \mapsto 1$. The first
equality follows from Lemma \ref{lemma-trivial-trace} and the second from
Lemma \ref{lemma-weak-trace}.

\medskip\noindent
Step 8. {\it It suffices to show that $\text{Tr}_A^{Z_g}\left((g,
\pi_\mathcal{U}^*)\big|_{R\Gamma_c(\mathcal{U}_{\bar k}, f_*A)}\right) \in A$
maps to zero in $\Lambda$.
}

\medskip\noindent
Recall that
\begin{eqnarray*}
\# Z_g \cdot \text{Tr}_A^{Z_g}\left((g,
\pi_\mathcal{U}^*)\big|_{R\Gamma_c(\mathcal{U}_{\bar k}, f_*A)}\right)
& = & \text{Tr}_A\left((g, \pi_\mathcal{U}^*)\big|_{R\Gamma_c(\mathcal{U}_{\bar
k}, f_*A)}\right)\\
& = &
\text{Tr}_A\left((g^{-1}\pi_\mathcal{V})^*\big|_{R\Gamma_c(\mathcal{V}_{\bar
k}, A)}\right).
\end{eqnarray*}
The first equality is
Lemma \ref{lemma-gamma-z-gamma-trace},
the second is the Leray
spectral sequence, using the finiteness of $f$ and the fact that we are only
taking traces over $A$. Now since $A=\mathbf{Z}/\ell^n\mathbf{Z}$ with
$n \gg 0$ and $\# Z_g = \ell^a$ for some (fixed) $a$,
it suffices to show the following result.

\medskip\noindent
Step 9. {\it
$\text{Tr}_A\left((g^{-1}\pi_\mathcal{V})^*\big|_{R\Gamma_c(\mathcal{V},
A)}\right) = 0$ in $A$.}

\medskip\noindent
By additivity again, we have
\begin{eqnarray*}
&
\text{Tr}_A
\left(
(g^{-1}\pi_\mathcal{V})^*\big|_{R\Gamma_c(\mathcal{V}_{\bar k} A)}
\right)
+
\text{Tr}_A
\left(
(g^{-1}\pi_\mathcal{V})^*\big|_{R\Gamma_c(Y-\mathcal {V})_{\bar k}, A)}
\right) \\
&
=
\text{Tr}_A
\left(
(g^{-1}\pi_Y)^*\big|_{R\Gamma(Y_{\bar k}, A)}
\right)
\end{eqnarray*}
The latter trace is the number of fixed points of $g^{-1}\pi_Y$ on $Y$, by
Weil's trace formula
Theorem \ref{theorem-weil-trace-formula}.
Moreover, by the 0-dimensional case already proven in step 2,
$$
\text{Tr}_A\left((g^{-1}\pi_\mathcal{V})^*\big|_{R\Gamma_c(Y-\mathcal{V})_{\bar
k}, A)}\right)
$$
is the number of fixed points of $g^{-1}\pi_Y$ on $(Y-\mathcal{V})_{\bar k}$.
Therefore,
$$
\text{Tr}_A\left((g^{-1}\pi_\mathcal{V})^*\big|_{R\Gamma_c(\mathcal{V}_{\bar
k}, A)}\right)
$$
is the number of fixed points of $g^{-1}\pi_Y$ on $\mathcal{V}_{\bar k}$. But
there are no such points: if $\bar y\in Y_{\bar k}$ is fixed under
$g^{-1}\pi_Y$, then $\bar f(\bar y) \in X_{\bar k}$ is fixed under $\pi_X$. But
$\mathcal{U}$ has no $k$-rational point, so we must have $\bar f(\bar y)\in
(X-\mathcal{U})_{\bar k}$ and so $\bar y\notin \mathcal{V}_{\bar k}$, a
contradiction.
This finishes the proof.
\end{proof}

\begin{remark}
\label{remark-on-trace-formula-again}
Remarks on Theorem \ref{theorem-trace-formula-again}.
\begin{enumerate}
\item
This formula holds in any dimension. By a d\'evissage lemma (which uses proper
base change etc.) it reduces to the current statement -- in that generality.
\item
The complex $R\Gamma_c(X_{\bar k}, K)$ is defined by choosing an open immersion
$j: X \hookrightarrow \bar X$ with $\bar X$ projective over $k$ of dimension at
most 1 and setting
$$
R\Gamma_c(X_{\bar k}, K) := R\Gamma(\bar X_{\bar k}, j_!K).
$$
This is independent of the choice of $\bar X$ follows from
(insert reference here). We define $H^i_c(X_{\bar k}, K)$
to be the $i$th cohomology group of $R\Gamma_c(X_{\bar k}, K)$.
\end{enumerate}
\end{remark}

\begin{remark}
\label{remark-stronger}
Even though all we did are reductions and mostly algebra, the trace formula
Theorem \ref{theorem-trace-formula-again} is much stronger than
Weil's geometric trace formula (Theorem \ref{theorem-weil-trace-formula})
because it applies to coefficient
systems (sheaves), not merely constant coefficients.
\end{remark}


%11.17.09
\section{Applications}
\label{section-applications}

\noindent
OK, having indicated the proof of the trace formula, let's try to use it
for something.





\section{On l-adic sheaves}
\label{section-l-adic-sheaves}

\begin{definition}
\label{definition-l-adic-sheaf}
Let $X$ be a noetherian scheme. A
{\it $\mathbf{Z}_\ell$-sheaf} on $X$, or simply a
{$\ell$-adic sheaf} is an
inverse system $\left\{\mathcal{F}_n\right\}_{n\geq 1}$ where
\begin{enumerate}
\item
$\mathcal{F}_n$ is a constructible $\mathbf{Z}/\ell^n\mathbf{Z}$-module on
$X_\etale$, and
\item
the transition maps $\mathcal{F}_{n+1}\to \mathcal{F}_n$ induce isomorphisms
$\mathcal{F}_{n+1} \otimes_{\mathbf{Z}/\ell^{n+1}\mathbf{Z}}
\mathbf{Z}/\ell^n\mathbf{Z} \cong \mathcal{F}_n$.
\end{enumerate}
We say that $\mathcal{F}$ is {\it lisse} if each $\mathcal{F}_n$ is locally
constant. A {\it morphism} of such is merely a morphism of inverse systems.
\end{definition}

\begin{lemma}
\label{lemma-eventually-constant}
Let $\{\mathcal{G}_n\}_{n\geq 1}$ be an inverse system of constructible
$\mathbf{Z}/\ell^n\mathbf{Z}$-modules.
Suppose that for all $k\geq 1$, the maps
$$
\mathcal{G}_{n+1}/\ell^k \mathcal{G}_{n+1}\to \mathcal{G}_n /\ell^k
\mathcal{G}_n
$$
are isomorphisms for all $n\gg 0$ (where the bound possibly depends on $k$).
In other words, assume that the system
$\{\mathcal{G}_n/\ell^k\mathcal{G}_n\}_{n\geq 1}$
is eventually constant, and call $\mathcal{F}_k$ the corresponding sheaf.
Then the system $\left\{\mathcal{F}_k\right\}_{k\geq 1}$ forms a
$\mathbf{Z}_\ell$-sheaf on $X$.
\end{lemma}

\begin{proof}
The proof is obvious.
\end{proof}

\begin{lemma}
\label{lemma-l-adic-abelian}
The category of $\mathbf{Z}_\ell$-sheaves on $X$ is abelian.
\end{lemma}

\begin{proof}
Let $\Phi=\left\{\varphi_n\right\}_{n\geq 1}: \left\{\mathcal{F}_n\right\}\to
\left\{\mathcal{G}_n\right\}$ be a morphism of $\mathbf{Z}_\ell$-sheaves. Set
$$
\Coker(\Phi) =
\left\{
\Coker\left(\mathcal{F}_n \xrightarrow{\varphi_n} \mathcal{G}_n\right)
\right\}_{n\geq 1}
$$
and $\Ker(\Phi)$ is the result of
Lemma \ref{lemma-eventually-constant}
applied to the inverse system
$$
\left\{
\bigcap_{m\geq n}
\Im\left(\Ker(\varphi_m) \to \Ker(\varphi_n)\right)
\right\}_{n \geq 1}.
$$
That this defines an abelian category is left to the reader.
\end{proof}

\begin{example}
\label{example-kernel}
Let $X=\Spec(\mathbf{C})$ and $\Phi : \mathbf{Z}_\ell\to \mathbf{Z}_\ell$
be multiplication by $\ell$. More precisely,
$$
\Phi = \left\{ \mathbf{Z}/\ell^n\mathbf{Z} \xrightarrow{\ell}
\mathbf{Z}/\ell^n\mathbf{Z}\right\}_{n \geq 1}.
$$
To compute the kernel, we consider the inverse system
$$
\cdots\to \mathbf{Z}/\ell\mathbf{Z}\xrightarrow{0}
\mathbf{Z}/\ell\mathbf{Z}\xrightarrow{0}\mathbf{Z}/\ell\mathbf{Z}.
$$
Since the images are always zero, $\Ker(\Phi)$ is zero as a system.
\end{example}

\begin{remark}
\label{remark-stalk-l-adic-sheaf}
If $\mathcal{F} = \left\{\mathcal{F}_n\right\}_{n\geq 1}$ is a
$\mathbf{Z}_\ell$-sheaf on $X$ and $\bar x$ is a geometric point then
$M_n=\left\{\mathcal{F}_{n, \bar x}\right\}$ is an inverse system of finite
$\mathbf{Z}/\ell^n\mathbf{Z}$-modules such that $M_{n+1}\to M_n$ is surjective
and $M_n = M_{n+1}/\ell^n M_{n+1}$. It follows that
$$
M = \lim_n M_n = \lim \mathcal{F}_{n, \bar x}
$$
is a finite $\mathbf{Z}_\ell$-module. Indeed, $M/\ell M= M_1$ is finite over
$\mathbf{F}_\ell$, so by Nakayama $M$ is finite over $\mathbf{Z}_\ell$.
Therefore, $M\cong \mathbf{Z}_\ell^{\oplus r} \oplus \oplus_{i=1}^t
\mathbf{Z}_\ell/\ell^{e_i}\mathbf{Z}_\ell$ for some $r, t\geq 0$, $e_i\geq 1$.
The module $M = \mathcal{F}_{\bar x}$ is called the {\it stalk} of
$\mathcal{F}$ at $\bar x$.
\end{remark}

\begin{definition}
\label{definition-torsion-l-adic-sheaf}
A $\mathbf{Z}_\ell$-sheaf $\mathcal{F}$ is {\it torsion} if $\ell^n:
\mathcal{F} \to \mathcal{F}$ is the zero map for some $n$. The abelian category
of $\mathbf{Q}_\ell$-sheaves on $X$ is the quotient of the abelian category of
$\mathbf{Z}_\ell$-sheaves by the Serre subcategory of torsion sheaves. In
other words, its objects are $\mathbf{Z}_\ell$-sheaves on $X$, and if
$\mathcal{F}, \mathcal{G}$ are two such, then
$$
\Hom_{\mathbf{Q}_\ell} \left(\mathcal{F}, \mathcal{G} \right) =
\Hom_{\mathbf{Z}_\ell} \left(\mathcal{F}, \mathcal{G}\right)
\otimes_{\mathbf{Z}_\ell} \mathbf{Q}_\ell.
$$
We denote by $\mathcal{F} \mapsto \mathcal{F} \otimes \mathbf{Q}_\ell$ the
quotient functor (right adjoint to the inclusion). If $\mathcal{F} =
\mathcal{F}' \otimes \mathbf{Q}_\ell$ where $\mathcal{F}'$ is a
$\mathbf{Z}_\ell$-sheaf and $\bar x$ is a geometric point, then the
{\it stalk} of $\mathcal{F}$ at $\bar x$ is $\mathcal{F}_{\bar x} =
\mathcal{F}'_{\bar x} \otimes \mathbf{Q}_\ell$.
\end{definition}

\begin{remark}
\label{remark-torsion-stalks}
Since a $\mathbf{Z}_\ell$-sheaf is only defined on a noetherian scheme, it is
torsion if and only if its stalks are torsion.
\end{remark}

\begin{definition}
\label{definition-cohomology-l-adic}
If $X$ is a separated scheme of finite type over an algebraically closed field
$k$ and $\mathcal{F} = \left\{\mathcal{F}_n\right\}_{n\geq 1}$ is a
$\mathbf{Z}_\ell$-sheaf on $X$, then we define
$$
H^i(X, \mathcal{F}) := \lim_n H^i(X, \mathcal{F}_n)
\qquad\text{ and }\qquad
H_c^i(X, \mathcal{F}) := \lim_n H_c^i(X, \mathcal{F}_n).
$$
If $\mathcal{F} = \mathcal{F}'\otimes \mathbf{Q}_\ell$ for a
$\mathbf{Z}_\ell$-sheaf $\mathcal{F}'$ then we set
$$
H_c^i(X , \mathcal{F}) := H_c^i(X,
\mathcal{F}')\otimes_{\mathbf{Z}_\ell}\mathbf{Q}_\ell.
$$
We call these the {\it $\ell$-adic cohomology} of $X$ with coefficients
$\mathcal{F}$.
\end{definition}





\section{L-functions}
\label{section-L-function}

\begin{definition}
\label{definition-L-function-finite-ring}
Let $X$ be a scheme of finite type over a finite field $k$. Let $\Lambda$ be a
finite ring of order prime to the characteristic of $k$ and $\mathcal{F}$ a
constructible flat $\Lambda$-module on $X_\etale$. Then we set
$$
L(X, \mathcal{F}) := \prod_{x\in |X|}\det\left(1-\pi_x^*\ T^{\deg
x}\Big|_{\mathcal{F}_{\bar x}}\right)^{-1}\in \Lambda [[ T ]]
$$
where $|X|$ is the set of closed points of $X$, $\deg x = [\kappa(x): k]$ and
$\bar x$ is a geometric point lying over $x$. This definition clearly
generalizes to the case where $\mathcal{F}$ is replace by a
$K \in D_{ctf}(X, \Lambda)$. We call this the {\it $L$-function of
$\mathcal{F}$}.
\end{definition}

\begin{remark}
\label{remark-T}
Intuitively, $T$ should be thought of as $T = t^f$ where $p^f = \# k$. The
definitions are then independent of the size of the ground field.
\end{remark}

\begin{definition}
\label{definition-L-function-l-adic}
Now assume that $\mathcal{F}$ is a $\mathbf{Q}_\ell$-sheaf on $X$.
In this case we define
$$
L(X, \mathcal{F}) := \prod_{x\in |X|}\det\left(1-\pi_x^*\ T^{\deg
x}\Big|_{\mathcal{F}_{\bar x}}\right)^{-1}\in \mathbf{Q}_\ell [[ T ]].
$$
Note that this product converges since there are finitely many points of a
given degree. We call this the {\it $L$-function of
$\mathcal{F}$}.
\end{definition}




\section{Cohomological interpretation}
\label{section-L-cohomological}

\noindent
This is how Grothendieck interpreted the $L$-function.

\begin{theorem}[Finite Coefficients]
\label{theorem-A}
Let $X$ be a scheme of finite type over a finite field $k$. Let $\Lambda$ be a
finite ring of order prime to the characteristic of $k$ and $\mathcal{F}$ a
constructible flat $\Lambda$-module on $X_\etale$. Then
$$
L(X, \mathcal{F}) = \det\left(1-\pi_X^*\ T\Big|_{R\Gamma_c(X_{\bar k},
\mathcal{F})}\right)^{-1}\in \Lambda[[ T]].
$$
\end{theorem}

\begin{proof}
Omitted.
\end{proof}

\noindent
Thus far, we don't even know whether each cohomology group
$H^i_c(X_{\bar k}, \mathcal{F})$ is free.

\begin{theorem}[Adic sheaves]
\label{theorem-B}
Let $X$ be a scheme of finite type over a finite field $k$, and $\mathcal{F}$ a
$\mathbf{Q}_\ell$-sheaf on $X$. Then
$$
L(X, \mathcal{F}) = \prod_i \det\left(1-\pi_X^*\
T\Big|_{H_c^i\left(X_{\bar k} , \mathcal{F}\right)}\right)^{(-1)^{i+1}}
\in \mathbf{Q}_\ell[[ T]].
$$
\end{theorem}

\begin{proof}
This is sketched below.
\end{proof}

\begin{remark}
\label{remark-which-is-harder}
Since we have only developed some theory of traces and not of determinants,
Theorem \ref{theorem-A}
is harder to prove than
Theorem \ref{theorem-B}.
We will only prove the latter, for the former see \cite{SGA4.5}.
Observe also that there is no version of this theorem more general for
$\mathbf{Z}_\ell$ coefficients since there is no $\ell$-torsion.
\end{remark}

\noindent
We reduce the proof of Theorem \ref{theorem-B} to a trace formula. Since
$\mathbf{Q}_\ell$ has characteristic 0, it suffices to prove the equality after
taking logarithmic derivatives. More precisely, we apply $T\frac{d}{dT} \log $
to both sides. We have on the one hand
\begin{eqnarray*}
T\frac{d}{dT}\log L(X, \mathcal{F}) & = &
T\frac{d}{dT} \log \prod_{x\in |X|} \det\left(1-\pi_x^*\ T^{\deg
x}\Big|_{\mathcal{F}_{\bar x}}\right)^{-1}\\
& = & \sum_{x\in |X|} T\frac{d}{dT} \log \left( \det\left(1-\pi_x^*\ T^{\deg
x}\Big|_{\mathcal{F}_{\bar x}}\right)^{-1}\right) \\
& = & \sum_{x \in |X|} \deg x\sum_{n \geq 1}
\text{Tr}\left({\left(\pi_x^n\right)}^*\big|_{\mathcal{F}_{\bar x}}\right)
T^{n\deg x}
\end{eqnarray*}
where the last equality results from the formula
$$
T\frac{d}{dT}\log\left(\det\left(1-fT|_M\right)^{-1}\right) = \sum_{n\geq 1}
\text{Tr}(f^n|_M)T^n
$$
which holds for any commutative ring $\Lambda$ and any endomorphism $f$ of a
finite projective $\Lambda$-module $M$. On the other hand, we have
\begin{align*}
& T\frac{d}{dT} \log\left(\prod_i \det\left(1-\pi_X^*\
T\Big|_{H_c^i\left(X_{\bar k} , \mathcal{F}\right)}\right)^{(-1)^{i+1}}\right)
\\
& \qquad\qquad\qquad \qquad = \qquad
\sum_i (-1)^i \sum_{n\geq 1}
\text{Tr}\left({\left(\pi_X^n\right)}^*\big|_{H_c^i(X_{\bar k},
\mathcal{F})}\right) T^n
\end{align*}
by the same formula again. Now, comparing powers of $T$ and using the Mobius
inversion formula, we see that Theorem \ref{theorem-B} is a consequence of the
following equality
$$
\sum_{d | n} d \sum_{x\in |X| \atop \deg x = d} \text{Tr} \left( {\left(
\pi_X^{n/d} \right)}^* \Big|_{\mathcal{F}_{\bar x}} \right)
=
\sum_i (-1)^i \text{Tr}\left(\left(\pi^n_X\right)^*\big|_{H^i_c(X_{\bar k},
\mathcal{F})} \right).
$$
Writing $k_n$ for the degree $n$ extension of $k$, $X_n = X \times_{\Spec
k} \Spec(k_n)$ and $_n \mathcal{F} = \mathcal{F}|_{X_n}$, this boils down
to
$$
\sum_{x \in X_n(k_n)} \text{Tr}\left( \pi_X^*\big|_{_n\mathcal{F}_{\bar x}}
\right)
=
\sum_i (-1)^i \text{Tr}\left(\left(\pi^n_X\right)^*\big|_{H^i_c({(X_n)}_{\bar
k}, _n\mathcal{F})} \right)
$$
which is a consequence of Theorem \ref{theorem-C}.

%11.19.09


\begin{theorem}
\label{theorem-D}
Let $X/k$ be as above, let $\Lambda$ be a finite ring with $\#\Lambda \in k^*$
and $K\in D_{ctf}(X, \Lambda)$. Then $R\Gamma_c(X_{\bar k}, K)\in
D_{perf}(\Lambda)$ and
$$
\sum_{x\in X(k)}\text{Tr}\left(\pi_x\left|_{K_{\bar x}}\right.\right) =
\text{Tr}\left(\pi_X^*\left|_{R\Gamma_c(X_{\bar k}, K )}\right.\right).
$$
\end{theorem}

\begin{proof}
Note that we have already proved this (REFERENCE) when $\dim X \leq 1$. The
general case follows easily from that case together with the proper base change
theorem.
\end{proof}

\begin{theorem}
\label{theorem-C}
Let $X$ be a separated scheme of finite type over a finite field $k$ and
$\mathcal{F}$ be a $\mathbf{Q}_\ell$-sheaf on $X$. Then
$\dim_{\mathbf{Q}_\ell}H_c^i(X_{\bar k}, \mathcal{F})$ is finite for all $i$,
and is nonzero for $0\leq i \leq 2 \dim X$ only. Furthermore, we have
$$
\sum_{x\in X(k)} \text{Tr}\left(\pi_x\left|_{\mathcal{F}_{\bar
x}}\right.\right) = \sum_i (-1)^i\text{Tr}\left(\pi_X^*\big|_{H_c^i(X_{\bar k},
\mathcal{F})}\right).
$$
\end{theorem}

\begin{proof}
We explain how to deduce this from Theorem \ref{theorem-D}.
We first use some \'etale cohomology arguments to reduce the proof
to an algebraic statement which we subsequently prove.

\medskip\noindent
Let $\mathcal{F}$ be as in the theorem. We can write
$\mathcal{F}$ as
$\mathcal{F}'\otimes \mathbf{Q}_\ell$ where $\mathcal{F}' =
\left\{\mathcal{F}'_n\right\}$ is a $\mathbf{Z}_\ell$-sheaf without torsion,
i.e., $\ell : \mathcal{F}'\to \mathcal{F}'$ has trivial kernel in the
category of $\mathbf{Z}_\ell$-sheaves. Then each $\mathcal{F}_n'$ is a flat
constructible $\mathbf{Z}/\ell^n\mathbf{Z}$-module on $X_\etale$, so
$\mathcal{F}'_n \in D_{ctf}(X, \mathbf{Z}/\ell^n\mathbf{Z})$ and
$\mathcal{F}_{n+1}'
\otimes^{\mathbf{L}}_{\mathbf{Z}/\ell^{n+1}\mathbf{Z}}
\mathbf{Z}/\ell^n\mathbf{Z} = \mathcal{F}_n'$.
Note that the last equality holds also
for standard (non-derived) tensor product, since $\mathcal{F}'_n$ is flat
(it is the same equality). Therefore,
\begin{enumerate}
\item
the complex $K_n= R\Gamma_c\left(X_{\bar k}, \mathcal{F}_n'\right)$ is perfect,
and it is endowed with an endomorphism $\pi_n: K_n\to K_n$ in
$D(\mathbf{Z}/\ell^n\mathbf{Z})$ ;
\item
there are identifications
$$
K_{n+1}
\otimes^{\mathbf{L}}_{\mathbf{Z}/\ell^{n+1}\mathbf{Z}}
\mathbf{Z}/\ell^n\mathbf{Z}
=
K_n
$$
in $D_{perf}(\mathbf{Z}/\ell^n\mathbf{Z})$, compatible with the endomorphisms
$\pi_{n+1}$ and $\pi_n$ (see \cite[Rapport 4.12]{SGA4.5}) ;
\item
the equality $\text{Tr}\left(\pi_X^*\left|_{K_n}\right.\right) = \sum_{x\in
X(k)}\text{Tr}\left(\pi_x\left|_{(\mathcal{F}'_n)_{\bar x}}\right.\right)$
holds ; and
\item
for each $x\in X(k)$, the elements
$\text{Tr}\left(\pi_x\big|_{\mathcal{F}'_{n, \bar x}}\right)
\in \mathbf{Z}/\ell^n\mathbf{Z}$
form an element of
$\mathbf{Z}_\ell$ which is equal to
$\text{Tr}\left(
\pi_x\left|_{\mathcal{F}_{\bar x}}\right.
\right) \in \mathbf{Q}_\ell$.
\end{enumerate}
It thus suffices to prove the following algebra lemma.
\end{proof}

\begin{lemma}
\label{lemma-piece-together}
Suppose we have
$K_n\in D_{perf}(\mathbf{Z}/\ell^n\mathbf{Z})$, $\pi_n: K_n\to K_n$
and isomorphisms
$ \varphi_n:
K_{n+1}
\otimes^{\mathbf{L}}_{\mathbf{Z}/\ell^{n+1}\mathbf{Z}}
\mathbf{Z}/\ell^n\mathbf{Z}
\cong K_n$
compatible with $\pi_{n+1}$ and $\pi_n$. Then
\begin{enumerate}
\item
the elements $t_n=\text{Tr}(\pi_n\left|_{K_n}\right.)\in
\mathbf{Z}/\ell^n\mathbf{Z}$ form an element $t_\infty=\{t_n\}$ of
$\mathbf{Z}_\ell$ ;
\item
the $\mathbf{Z}_\ell$-module $H_\infty^i=\lim_n H^i(k_n)$ is finite and
is nonzero for finitely many $i$ only ; and
\item
the operators $H^i(\pi_n): H^i(K_n)\to H^i(K_n)$ are compatible and define
$\pi_\infty^i: H_\infty^i\to H_\infty^i$ satisfying
$$
\sum(-1)^i
\text{Tr}
\left(
\pi_\infty^i \big|_{H_\infty^i \otimes_{\mathbf{Z}_\ell}\mathbf{Q}_\ell}
\right) = t_\infty.
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Since $\mathbf{Z}/\ell^n\mathbf{Z}$ is a local ring and $K_n$ is perfect, each
$K_n$ can be represented by a finite complex $K_n^\bullet$ of finite free
$\mathbf{Z}/\ell^n \mathbf{Z}$-modules such that the map $K_n^p \to K_n^{p+1}$
has image contained in $\ell K_n^{p+1}$. It is a fact that such a complex is
unique up to isomorphism. Moreover $\pi_n$ can be represented by a morphism of
complexes $\pi_n^\bullet: K_n^\bullet\to K_n^\bullet$ (which is unique up to
homotopy). By the same token the isomorphism
$\varphi_n:K_{n+1} \otimes_{\mathbf{Z}/\ell^{n+1}\mathbf{Z}}^{\mathbf{L}}
\mathbf{Z}/\ell^n\mathbf{Z}\to K_n$ is represented by a map of complexes
$$
\varphi_n^\bullet :
K_{n+1}^\bullet
\otimes_{\mathbf{Z}/\ell^{n+1}\mathbf{Z}}
\mathbf{Z}/\ell^n\mathbf{Z} \to K_n^\bullet.
$$
In fact, $\varphi_n^\bullet$ is an isomorphism of complexes, thus we see that
\begin{itemize}
\item
there exist $a, b\in \mathbf{Z}$ independent of $n$ such that $K_n^i = 0$ for
all $i\notin[a, b]$ ; and
\item
the rank of $K_n^i$ is independent of $n$.
\end{itemize}
Therefore, the module $K_\infty^i = \lim_n \{K_n^i, \varphi_n^i\}$ is a
finite free $\mathbf{Z}_\ell$-module and $K_\infty^\bullet$ is a finite complex
of finite free $\mathbf{Z}_\ell$-modules. By induction on the number of nonzero
terms, one can prove that $H^i\left(K_\infty^\bullet\right) = \lim_n
H^i\left(K_n^\bullet\right)$ (this is not true for unbounded complexes). We
conclude that $H_\infty^i = H^i\left(K_\infty^\bullet\right)$ is a finite
$\mathbf{Z}_\ell$-module. This proves {\it ii}. To prove the remainder of the
lemma, we need to overcome the possible noncommutativity of the diagrams
$$
\xymatrix{
{K_{n+1}^\bullet} \ar_{\pi_{n+1}^\bullet}[d] \ar^{\varphi_n^\bullet}[r] &
{K_n^\bullet} \ar^{\pi_n^\bullet}[d] \\
{K_{n+1}^\bullet} \ar_{\varphi_n^\bullet}[r] & {K_n^\bullet.}
}
$$
However, this diagram does commute in the derived category, hence it commutes
up to homotopy. We inductively replace $\pi_n^\bullet$ for $n\geq 2$ by
homotopic maps of complexes making these diagrams commute. Namely, if $h^i:
K_{n+1}^i \to K_n^{i-1}$ is a homotopy, i.e.,
$$
\pi_n^\bullet\circ\varphi_n^\bullet-\varphi_n^\bullet\circ\pi_{n+1}^\bullet =
dh+hd,
$$
then we choose $\tilde h^i: K_{n+1}^i\to K_{n+1}^{i-1}$ lifting $h^i$. This is
possible because $K_{n+1}^i$ free and $K_{n+1}^{i-1}\to K_n^{i-1}$ is
surjective. Then replace $\pi_n^\bullet$ by $\tilde\pi_n^\bullet$ defined by
$$
\tilde\pi_{n+1}^\bullet = \pi_{n+1}^\bullet + d\tilde h+\tilde hd.
$$
With this choice of $\{\pi_n^\bullet\}$, the above diagrams commute, and the
maps fit together to define an endomorphism $\pi_\infty^\bullet =
\lim_n\pi_n^\bullet$ of $K_\infty^\bullet$. Then part {\it i} is clear:
the elements $t_n = \sum(-1)^i
\text{Tr}\left(\pi_n^i\left|_{K_n^i}\right.\right)$ fit into an element
$t_\infty$ of $\mathbf{Z}_\ell$. Moreover
\begin{eqnarray*}
t_\infty & = & \sum(-1)^i
\text{Tr}_{\mathbf{Z}_\ell}\left(\pi_\infty^i\big|_{K_\infty^i}\right) \\
& = & \sum(-1)^i
\text{Tr}_{\mathbf{Q}_\ell}\left(
\pi_\infty^i\big|_{K_\infty^i \otimes_{\mathbf{Z}_\ell}\mathbf{Q}_\ell}
\right) \\
& =
& \sum(-1)^i\text{Tr}\left(
\pi_\infty\big|_{H^i(K_\infty^\bullet \otimes \mathbf{Q}_\ell)}
\right)
\end{eqnarray*}
where the last equality follows from the fact that $\mathbf{Q}_\ell$ is a
field, so the complex $K_\infty^\bullet \otimes \mathbf{Q}_\ell$ is
quasi-isomorphic to its cohomology
$H^i(K_\infty^\bullet \otimes \mathbf{Q}_\ell)$. The latter is also equal to
$H^i(K_\infty^\bullet)\otimes_{\mathbf{Z}}\mathbf{Q}_\ell = H_\infty^i \otimes
\mathbf{Q}_\ell$, which finishes the proof of the lemma, and also that of
Theorem \ref{theorem-C}.
\end{proof}




\section{List of things which we should add above}
\label{section-list-skipped}

\noindent
What did we skip the proof of in the lectures so far:
\begin{enumerate}
\item curves and their Jacobians,
\item proper base change theorem,
\item inadequate discussion of $R\Gamma_c$,
\item more generally, given $f : X \to S$ finite type,
separated $S$ quasi-projective, discussion of $Rf_!$ on \'etale sheaves.
\item discussion of $\otimes^{\mathbf{L}}$
\item discussion of why $R\Gamma_c$ commutes with $\otimes^{\mathbf{L}}$
\end{enumerate}






%11.24.09
\section{Examples of L-functions}
\label{section-examples-L-functions}

\noindent
We use Theorem \ref{theorem-B} for curves to give examples of $L$-functions





\section{Constant sheaves}
\label{section-L-function-constant-sheaf}

\noindent
Let $k$ be a finite field, $X$ a smooth, geometrically irreducible curve over
$k$ and $\mathcal{F} = \underline{\mathbf{Q}_\ell}$ the constant sheaf. If
$\bar x$ is a geometric point of $X$, the Galois module
$\mathcal{F}_{\bar x} = \mathbf{Q}_\ell$ is trivial, so
$$
\det\left(1-\pi_x^*\ T^{\deg x}\Big|_{\mathcal{F}_{\bar x}}\right)^{-1} =
\frac{1}{1-T^{\deg x}}.
$$
Applying Theorem \ref{theorem-B}, we get
\begin{eqnarray*}
L(X, \mathcal{F}) & = & \prod_{i=0}^2 \det\left(1-\pi_X^*\
T\big|_{H_c^i(X_{\bar k}, \mathbf{Q}_\ell)}\right)^{(-1)^{i+1}} \\
& = &
\frac{\det\left(1-\pi_X^*\ T\big|_{H_c^1(X_{\bar k},
\mathbf{Q}_\ell)}\right)}{\det\left(1-\pi_X^*\ T\big|_{H_c^0(X_{\bar k},
\mathbf{Q}_\ell)}\right)\cdot\det\left(1-\pi_X^*\ T\big|_{H_c^2(X_{\bar k},
\mathbf{Q}_\ell)}\right)}.
\end{eqnarray*}
To compute the latter, we distinguish two cases.


\medskip\noindent
{\bf Projective case.}
Assume that $X$ is projective, so $H_c^i(X_{\bar k}, \mathbf{Q}_\ell) =
H^i(X_{\bar k}, \mathbf{Q}_\ell)$, and we have
$$
H^i(X_{\bar k}, \mathbf{Q}_\ell) =
\left\{
\begin{matrix}
\mathbf{Q}_\ell & \text{if $i = 0$, and $\pi_X^*$ acts as 1 ;} \\
\mathbf{Q}_\ell^{2g} & \text{if $i = 1$ ;} \\
\mathbf{Q}_\ell & \text{if $i = 2$, and $\pi_X^*$ acts as multiplication by
$q=\deg \pi_X$.}
\end{matrix}
\right.
$$
We do not know much about the action of $\pi_X^*$ on the degree 1 cohomology.
Let us call $\alpha_1, \ldots, \alpha_{2g}$ its eigenvalues in
$\bar{\mathbf{Q}}_\ell$. Putting everything together,
Theorem \ref{theorem-B}
yields the equality
$$
\prod_{x\in |X|} \frac{1}{1-T^{\deg x}} = \frac{\det\left(1- \pi_X^*\
T\big|_{H^1(X_{\bar k}, \mathbf{Q}_\ell)}\right)}{(1-T)(1-qT)}
$$
from which we deduce the following result.

\begin{lemma}
\label{lemma-count-points-projective}
Let $X$ be a smooth, projective, geometrically irreducible
curve over a finite field $k$. Then
\begin{enumerate}
\item the $L$-function $L(X, \mathbf{Q}_\ell)$ is a rational function ;
\item the eigenvalues $\alpha_1, \ldots, \alpha_{2g}$ of $\pi_X^*$ on
$H^1(X_{\bar k}, \mathbf{Q}_\ell)$ are algebraic integers
independent of $\ell$,
\item the number of rational points of $X$ on $k_n$, where $[k_n: k] = n$, is
$$
\# X(k_n) = 1 - \sum\nolimits_{i=1}^{2g}\alpha_i^n + q^n,
$$
\item for each $i$, $|\alpha_i| < q$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (3) is Theorem \ref{theorem-C} applied to $\mathcal{F} =
\underline{\mathbf{Q}_\ell}$ on $X \otimes k_n$. For part (4), use the
following result.
\end{proof}

\begin{exercise}
\label{exercise-powers}
Let $\alpha_1, \dots, \alpha_n \in \mathbf{C}$. Then for any conic sector
containing the positive real axis of the form $C_\varepsilon = \{ z \in
\mathbf{C} \ | \ |\arg z| < \varepsilon \}$ with $\varepsilon >0$, there exists
an integer $k \geq 1$ such that $\alpha_1^k, \dots, \alpha_n^k \in
C_\varepsilon$.
\end{exercise}

\noindent
Then prove that $|\alpha_i| \leq q$ for all $i$. Then, use elementary
considerations on complex numbers to prove (as in the proof of the prime number
theorem) that $|\alpha_i| < q$. In fact, the Riemann hypothesis says that for
all $|\alpha_i| = \sqrt q$ for all $i$. We will come back to this later.

\medskip\noindent
{\bf Affine case.}
Assume now that $X$ is affine, say $X= \bar X-\left\{x_1, \ldots, x_n\right\}$
where $j: X \hookrightarrow \bar X$ is a projective nonsingular completion.
Then $H_c^0(X_{\bar k}, \mathbf{Q}_\ell) = 0$ and $H_c^2(X_{\bar k},
\mathbf{Q}_\ell) = H^2(\bar X_{\bar k}, \mathbf{Q}_\ell)$ so
Theorem \ref{theorem-B}
reads
$$
L(X, \mathbf{Q}_\ell) = \prod_{x\in |X|}\frac{1}{1-T^{\deg x}} =
\frac{\det\left(1-\pi_X^*\ T\big|_{H_c^1(X_{\bar k},
\mathbf{Q}_\ell)}\right)}{1-qT}.
$$
On the other hand, the previous case gives
\begin{eqnarray*}
L(X, \mathbf{Q}_\ell) & = & L(\bar X,
\mathbf{Q}_\ell)\prod_{i=1}^n\left(1-T^{\deg x_i}\right) \\
& = & \frac{\prod_{i=1}^n(1-T^{\deg
x_i})\prod_{j=1}^{2g}(1-\alpha_jT)}{(1-T)(1-qT)}.
\end{eqnarray*}
Therefore, we see that $\dim H_c^1(X_{\bar k}, \mathbf{Q}_\ell) =
2g+\sum_{i=1}^n \deg(x_i)-1$, and the eigenvalues $\alpha_1, \ldots,
\alpha_{2g}$ of $\pi_{\bar X}^*$ acting on the degree 1 cohomology are roots of
unity. More precisely, each $x_i$ gives a complete set of $\deg(x_i)$th roots
of unity, and one occurrence of 1 is omitted. To see this directly using
coherent sheaves, consider the short exact sequence on $\bar X$
$$
0\to j_!\mathbf{Q}_\ell\to \mathbf{Q}_\ell\to\bigoplus_{i=1}^n
\mathbf{Q}_{\ell, x_i}\to 0.
$$
The long exact cohomology sequence reads
$$
0\to \mathbf{Q}_\ell \to \bigoplus_{i=1}^n \mathbf{Q}_\ell^{\oplus \deg x_i}
\to H_c^1(X_{\bar k}, \mathbf{Q}_\ell) \to H_c^1(\bar X_{\bar k},
\mathbf{Q}_\ell)\to 0
$$
where the action of Frobenius on $\bigoplus_{i=1}^n \mathbf{Q}_\ell^{\oplus
\deg x_i}$ is by cyclic permutation of each term; and $H_c^2(X_{\bar k},
\mathbf{Q}_\ell) = H_c^2(\bar X_{\bar k}, \mathbf{Q}_\ell)$.






\section{The Legendre family}
\label{section-legendre-family}

\noindent
Let $k$ be a finite field of odd characteristic,
$X=\Spec(k[\lambda, \frac{1}{\lambda(\lambda-1)}])$, and
consider the family of elliptic
curves $f: E\to X$ on $\mathbf{P}^2_X$ whose affine equation is $y^2 =
x(x-1)(x-\lambda)$. We set $\mathcal{F} = Rf_*^1\mathbf{Q}_\ell =
\left\{R^1f_*\mathbf{Z}/\ell^n\mathbf{Z}\right\}_{n\geq 1} \otimes
\mathbf{Q}_\ell$. In this situation, the following is true
\begin{itemize}
\item for each $n \geq 1$, the sheaf $R^1f_*(\mathbf{Z}/\ell^n\mathbf{Z})$ is
finite locally constant -- in fact, it is free of rank 2 over
$\mathbf{Z}/\ell^n\mathbf{Z}$ ;
\item the system $\{R^1f_*\mathbf{Z}/\ell^n\mathbf{Z}\}_{n\geq 1}$ is a lisse
$\ell$-adic sheaf ; and
\item for all $x\in |X|$, $\det\left(1-\pi_x\ T^{\deg
x}\big|_{\mathcal{F}_{\bar x}}\right) = (1-\alpha_x T^{\deg x})(1-\beta_x
T^{\deg x })$ where $\alpha_x, \beta_x$ are the eigenvalues of the geometric
frobenius of $E_x$ acting on $H^1(E_{\bar x}, \mathbf{Q}_\ell)$.
\end{itemize}
Note that $E_x$ is only defined over $\kappa(x)$ and not over $k$. The proof of
these facts uses the proper base change theorem and the local acyclicity of
smooth morphisms. For details, see \cite{SGA4.5}. It follows that
$$
L(E/X) := L(X, \mathcal{F}) = \prod_{x\in |X|}
\frac{1}{(1-\alpha_xT^{\deg x})(1-\beta_xT^{\deg x })} .
$$
Applying Theorem \ref{theorem-B} we get
$$
L(E/X) = \prod_{i=0}^2\det\left(1-\pi_X^*\ T\left|_{H_c^i(X_{\bar k},
\mathcal{F})}\right.\right)^{(-1)^{i+1}},
$$
and we see in particular that this is a rational function. Furthermore, it is
relatively easy to show that $H_c^0(X_{\bar k}, \mathcal{F}) = H_c^2(X_{\bar
k}, \mathcal{F}) = 0$, so we merely have
$$
L(E/X) = \det\left(1-\pi_X^*T\big|_{H_c^1(X, \mathcal{F})}\right).
$$
To compute this determinant explicitly, consider the Leray spectral sequence
for the proper morphism $f:E \to X$ over $\mathbf{Q}_\ell$, namely
$$
H_c^i(X_{\bar k}, R^jf_*\mathbf{Q}_\ell) \Rightarrow H_c^{i+j}(E_{\bar
k}, \mathbf{Q}_\ell)
$$
which degenerates. We have $f_*\mathbf{Q}_\ell=\mathbf{Q}_\ell$ and
$R^1f_*\mathbf{Q}_\ell = \mathcal{F}$. The sheaf $R^2f_*\mathbf{Q}_\ell =
\mathbf{Q}_\ell(-1)$ is the {\it Tate twist} of $\mathbf{Q}_\ell$, i.e.,
it is the sheaf $\mathbf{Q}_\ell$ where the Galois action is given by
multiplication by $\#\kappa(x)$ on the stalk at $\bar x$. It follows that,
for all $n\geq 1$,
\begin{eqnarray*}
\# E(k_n) & = & \sum(-1)^i\text{Tr}\left({\pi_E^n}^*\big|_{H_c^i(E_{\bar k},
\mathbf{Q}_\ell)}\right)\\
& = & \sum_{i, j}(-1)^{i+j}\text{Tr}\left({\pi^n_X}^*\big|_{H_c^i(X_{\bar k},
R^jf_*\mathbf{Q}_\ell)}\right)\\
& = & (q^n-2) + \text{Tr}\left( {\pi_X^n}^*\big|_{H_c^1(X_{\bar k},
\mathcal{F})}\right)+ q^n (q^n-2)\\
& = & q^{2n} - q^n-2 +\text{Tr}\left( {\pi_X^n}^*\big|_{H_c^1(X_{\bar k},
\mathcal{F})}\right)
\end{eqnarray*}
where the first equality follows from
Theorem \ref{theorem-C},
the second one from
the Leray spectral sequence and the third one by writing down the higher direct
images of $\mathbf{Q}_\ell$ under $f$. Alternatively, we could write
$$
\#E(k_n) = \sum_{x \in X(k_n)} \#E_x(k_n)
$$
and use the trace formula for each curve. We can also find the number of
$k_n$-rational points simply by counting. The zero section contributes $q^n -2$
points (we omit the points where $\lambda = 0, 1$) hence
$$
\# E(k_n) =
q^n-2 + \#\left\{y^2 = x(x-1)(x-\lambda), \lambda\neq 0, 1\right\}.
$$
Now we have
$$
\begin{matrix}
\#\left\{y^2 = x(x-1)(x-\lambda), \; \lambda\neq 0, 1\right\}\\
\\
\quad = \#\left\{y^2 = x(x-1)(x-\lambda)\text{ in }\mathbf{A}^3\right\}
-\#\left\{y^2 = x^2(x-1)\right\}-\#\left\{y^2 = x(x-1)^2\right\}\\
\\
\quad = \#\left\{\lambda=\frac{-y^2}{x(x-1)}+x, \; x\neq 0, 1\right\} +
\#\left\{y^2 = x(x-1)(x-\lambda), x=0, 1\right\}-2(q^n-\varepsilon_n) \\
\\
\quad = q^n(q^n-2)+2q^n-2(q^n-\varepsilon_n)\\
\\
\quad = q^{2n}-2q^n+2\varepsilon_n
\end{matrix}
$$
where $\varepsilon_n = 1$ if $-1$ is a square in $k_n$, 0 otherwise,
i.e.,
$$
\varepsilon_n = \frac{1}{2}\left(1+\left(\frac{-1}{k_n}\right)\right) =
\frac{1}{2}\left(1+(-1)^{\frac{q^n-1}{2}}\right).
$$
Thus $ \# E(k_n) = q^{2n}-q^n-2+ 2\varepsilon_n$. Comparing with the previous
formula, we find
$$
\text{Tr}\left({\pi_X^n}^*\big|_{H_c^1(X_{\bar k}, \mathcal{F})}\right) = 2
\varepsilon_n = 1+(-1)^{\frac{q^n-1}{2}},
$$
which implies, by elementary algebra of complex numbers, that if $-1$ is a
square in $k_n^*$, then $\dim H_c^1(X_{\bar k}, \mathcal{F}) = 2$ and the
eigenvalues are $1$ and $1$. Therefore, in that case we have
$$
L(E/X) = (1-T)^2.
$$




\section{Exponential sums}
\label{section-exponential-sums}

\noindent
A standard problem in number theory is to evaluate sums of the form
$$
S_{a, b}(p) = \sum_{x\in \mathbf{F}_p-\left\{0, 1\right\}} e^{\frac{2\pi
ix^a(x-1)^b}{p}}.
$$
In our context, this can be interpreted as a cohomological sum as follows.
Consider the base scheme
$S = \Spec(\mathbf{F}_p[x, \frac{1}{x(x-1)}])$ and the affine curve
$f: X \to \mathbf{P}^1-\{0, 1, \infty\}$ over $S$ given by the equation
$y^{p-1} = x^a(x-1)^b$. This is a finite \'etale Galois cover with group
$\mathbf{F}_p^*$ and there is a splitting
$$
f_*(\bar{\mathbf{Q}}_\ell^*) =
\bigoplus_{\chi : \mathbf{F}_p^*\to \bar{\mathbf{Q}}_\ell^*} \mathcal{F}_\chi
$$
where $\chi$ varies over the characters of $\mathbf{F}_p^*$ and
$\mathcal{F}_\chi$ is a rank 1 lisse $\mathbf{Q}_\ell$-sheaf on which
$\mathbf{F}_p^*$ acts via $\chi$ on stalks. We get a corresponding decomposition
$$
H_c^1(X_{\bar k}, \mathbf{Q}_\ell) = \bigoplus_\chi H^1(\mathbf{P}_{\bar
k}^1-\{0, 1, \infty\}, \mathcal{F}_\chi)
$$
and the cohomological interpretation of the exponential sum is given by the
trace formula applied to $\mathcal{F}_\chi$ over $\mathbf{P}^1 - \{0, 1,
\infty\}$ for some suitable $\chi$. It reads
$$
S_{a, b}(p) = -\text{Tr}\left(\pi_X^*\big|_{H^1(\mathbf{P}_{\bar k}^1-\{0, 1,
\infty\}, \mathcal{F}_\chi)}\right).
$$
The general yoga of Weil suggests that there should be some cancellation in the
sum. Applying (roughly) the Riemann-Hurwitz formula, we see that
$$
2g_X-2 \approx -2 (p-1) + 3(p-2) \approx p
$$
so $g_X\approx p/2$, which also suggests that the $\chi$-pieces are small.



%12.01.09
\section{Trace formula in terms of fundamental groups}
\label{section-trace-formula-fundamental-group}

\noindent
In the following sections we reformulate the trace formula completely
in terms of the fundamental group of a curve, except if the curve
happens to be $\mathbf{P}^1$.




\section{Fundamental groups}
\label{section-fundamental-groups}

\noindent
$X$ connected scheme $\overline x\to X$ geometric
point consider the functor
$$
\begin{matrix}
F_{\overline x}: &
\text{ finite \'etale }\atop \text{ schemes over } X &
\longrightarrow & \text{ finite sets} \\
&
Y/X &
\longmapsto &
F_{\overline x}(Y) =
\left\{\text{ geom points }\overline y\atop \text{ of } Y
\text{ lying over }\overline x\right\} = Y_{\overline x}
\end{matrix}
$$
Set
$$
\pi_1(X, \overline x)
=
Aut(F_{\overline x})
=
\text{ set of automorphisms of the functor }F_{\overline x}
$$
Note that for every finite \'etale $Y \to X$ there is an action
$$
\pi_1(X, \overline x) \times F_{\overline x}(Y) \to F_{\overline x}(Y)
$$

\begin{definition}
\label{definition-open}
A subgroup of the form
$\text{Stab}(\overline y\in F_{\overline x}(Y))\subset \pi_1(X, \overline x)$
is called {\it open}.
\end{definition}

\begin{theorem}[Grothendieck]
\label{theorem-fundamental-group}
Let $X$ be a connected scheme.
\begin{enumerate}
\item There is a topology on $\pi_1(X, \overline x)$ such that the open
subgroups form a fundamental system of open nbhds of $e\in \pi_1(X, \overline
x)$.
\item With topology of (1) the group
$\pi_1(X, \overline x)$ is a profinite group.
\item The functor
$$
\begin{matrix}
\text{ schemes finite }\atop \text{ \'etale over }X & \to &
\text{ finite discrete continuous }\atop \pi_1(X, \overline x)\text{-sets}\\
Y / X& \mapsto & F_{\overline x}(Y) \text{ with its natural action}
\end{matrix}
$$
is an equivalence of categories.
\end{enumerate}
\end{theorem}

\begin{proof}
See \cite{SGA1}.
\end{proof}

\begin{proposition}
\label{proposition-integral-normal-fundamental-group}
Let $X$ be an integral normal Noetherian scheme. Let
$\overline y\to X$ be an algebraic geometric point lying
over the generic point $\eta\in X$. Then
$$
\pi_x(X, \overline \eta) = Gal(M/\kappa(\eta))
$$
($\kappa(\eta)$, function field of $X$) where
$$
\kappa(\overline \eta)\supset M\supset \kappa(\eta) = k(X)
$$
is the max sub-extension such that for every finite sub extension
$M\supset L\supset \kappa(\eta)$ the normalization of $X$ in $L$ is finite
\'etale over $X$.
\end{proposition}

\begin{proof}
Omitted.
\end{proof}

\noindent
{\bf Change of base point.} For any $\overline x_1, \; \overline x_2$
geom. points of $X$ there exists an isom. of fibre functions
$$
\mathcal{F}_{\overline x_1} \cong \mathcal{F}_{\overline x_2}
$$
(This is a path from $\overline x_1$ to $\overline x_2$.) Conjugation
by this path gives isom
$$
\pi_1(X, \overline x_1) \cong \pi_1(X, \overline x_2)
$$
well defined up to inner actions.

\medskip\noindent
{\bf Functoriality.} For any morphism $X_1\to X_2$ of connected schemes
any $\overline x\in X_1$ there is a canonical map
$$
\pi_1(X_1, \overline x) \to \pi_1(X_2, \overline x)
$$
(Why? because the fibre functor ...)

\medskip\noindent
{\bf Base field.} Let $X$ be a variety over a field $k$. Then we get 	
$$
\pi_1(X, \overline x) \to
\pi_1(Spec(k), \overline x) =^{\text{prop}} Gal(k^{\text{sep}}/k)
$$
This map is surjective if and only if $X$ is geometrically connected over $k$.
So in the geometrically connected case we get s.e.s. of profinite
groups
$$
1 \to \pi_1(X_{\overline k}, \overline x) \to
\pi_1(X, \overline x) \to
Gal(k^{\text{sep}}/k) \to 1
$$
($\pi_1(X_{\overline k}, \overline x)$: geometric fundamental group of
$X$, $\pi_1(X, \overline x)$: arithmetic fundamental group of $X$)

\medskip\noindent
{\bf Comparison.} If $X$ is a variety over $\mathbf{C}$ then
$$
\pi_1(X, \overline x) =
\text{ profinite completion of }
\pi_1(X(\mathbf{C})(\text{ usual topology}), x)
$$
(have $x\in X(\mathbf{C})$)

\medskip\noindent
{\bf Frobenii.} $X$ variety over $k$, $\# k < \infty$. For any $x \in X$
closed point, let
$$
F_x\in \pi_1(x, \overline x) =
\text{Gal}(\kappa(x)^{\text{sep}}/\kappa(x))
$$
be the geometric frobenius.
Let $\overline\eta$ be an alg. geom. gen. pt. Then
$$
\pi_1(X, \overline\eta) \leftarrow^{\cong}
\pi_1(X, \overline x)
{\text{\small functoriality}\atop\leftarrow}
\pi_1(x, \overline x)
$$

\noindent
Easy fact:
$$
\begin{matrix}
\pi_1(X, \overline \eta) & \to^{\deg} \pi_1(\Spec(k), \overline \eta) * &
= Gal(k^{sep}/k) \\
& & || \\
& & \widehat{\mathbf{Z}}\cdot F_{\Spec(k)} \\
F_x & \mapsto & \deg(x)\cdot F_{\Spec(k)}
\end{matrix}
$$
Recall: $\deg(x) = [\kappa(x):k]$

\medskip\noindent
{\bf Fundamental groups and lisse sheaves.}
Let $X$ be a connected scheme, $\overline x$ geom. pt. There are
equivalences of categories
$$
\begin{matrix}
\text{($\Lambda$ finite ring)}& \text{fin. loc. const. sheaves
of }
\atop \Lambda\text{-modules of }X_\etale & \leftrightarrow &
\text{ finite(discrete) }\Lambda\text{-modules}\atop\text{ with continuous
}\pi_1(X, \overline x)\text{-action}\\
\\
(l\text{ a prime}) & \text{ lisse }l\text{-adic}\atop\text{
sheaves} & \leftrightarrow & \text{ finitely generated
}\mathbf{Z}_l\text{-modules } M \text{ with continuous }\atop \pi_1(X,
\overline x)\text{ action where we use $l$-adic topology on } M
\end{matrix}
$$
In particular lisse $\mathbf{Q}_l$-sheaves correspond to continuous
homomorphisms
$$
\pi_1(X, \overline x) \to \text{GL}_r(\mathbf{Q}_l), \quad r\geq 0
$$

\noindent
Notation: A module with action $(M, \rho)$ corresponds to the sheaf
$\mathcal{F}_\rho$.

\medskip\noindent
{\bf Trace formulas.} $X$ variety over $k$, $\# k < \infty$.
\begin{enumerate}
\item $\Lambda$ finite ring $(\# \Lambda, \# k)=1$
$$
\rho: \pi_1(X, \overline x)\to \text{GL}_r(\Lambda)
$$
continuous. For every $n\geq 1$ we have
$$
\sum_{d|n}d\left(\sum_{x\in |X|,
\atop\deg(x)=d}\text{Tr}(\rho(F_x^{n/d}))\right) =
\text{Tr}\left((\pi_x^n)^*\left|_{R\Gamma_c(X_{\overline k},
\mathcal{F}_\rho)}\right.\right)
$$
\item $l\neq char(k)$ prime, $\rho: \pi_1(X, \overline x)\to
\text{GL}_r(\mathbf{Q}_l)$. For any $n\geq 1$
$$
\sum_{d|n} d\left(
\sum_{x\in |X|\atop \deg(x)=d}
\text{Tr}
\left(
\rho(F_x^{n/d})
\right)
\right) =
\sum_{i=0}^{2\dim X}
(-1)^i
\text{Tr}\left(
\pi_X^*\left|_{H_c^i(X_{\overline k}, \mathcal{F}_\rho)}\right.
\right)
$$
\end{enumerate}

\medskip\noindent
{\bf Weil conjectures.} (Deligne-Weil I, 1974) $X$ smooth proj. over $k$,
$\# k = q$, then the eigenvalues of $\pi_X^*$ on $H^i(X_{\overline k},
\mathbf{Q}_l)$ are algebraic integers $\alpha$ with $|\alpha|=q^{1/2}$.

\medskip\noindent
{\bf Deligne's conjectures.} (almost completely proved by
Lafforgue + $\cdots$) Let $X$ be a normal variety over $k$ finite
$$
\rho: \pi_1(X, \overline x) \longrightarrow \text{GL}_r(\mathbf{Q}_l)
$$
continuous. Assume: $\rho$ irreducible $\det(\rho)$ of finite order. Then
\begin{enumerate}
\item there exists a number field $E$ such that for all $x\in
|X|$(closed points) the char. poly of $\rho(F_x)$ has coefficients in $E$.
\item for any $x\in |X|$ the eigenvalues $\alpha_{x, i}$, $i=1, \ldots,
r$ of $\rho(F_x)$ have complex absolute value $1$.
(these are algebraic numbers not necessary integers)
\item for every finite place $\lambda$( not dividing $p$), of $E$
(maybe after enlarging $E$ a bit) there exists
$$
\rho\lambda: \pi_1(X, \overline x) \to \text{GL}_r(E_\lambda)
$$
compatible with $\rho$. (some char. polys of $F_x$'s)
\end{enumerate}

\begin{theorem}[Deligne, Weil II]
\label{theorem-weil-II}
For a sheaf
$\mathcal{F}_\rho$ with $\rho$ satisfying the conclusions of the conjecture
above then the eigenvalues of $\pi_X^*$ on $H_c^i(X_{\overline k},
\mathcal{F}_{\rho})$ are algebraic numbers $\alpha$ with absolute values
$$
|\alpha|=q^{w/2}, \text{ for }w\in \mathbf{Z}, \; w\leq i
$$
Moreover, if $X$ smooth and proj. then $w=i$.
\end{theorem}

\begin{proof}
See \cite{WeilII}.
\end{proof}




%12.03.09
\section{Profinite groups, cohomology and homology}
\label{section-profinite-cohomology}

\noindent
Let $G$ be a profinite group.

\medskip\noindent
{\bf Cohomology.}
Consider the category of discrete modules with continuous $G$-action.
This category has enough injectives and we can define
$$
H^i(G, M) = R^iH^0(G, M) = R^i(M\mapsto M^G)
$$
Also there is a derived version $RH^0(G, -)$.

\medskip\noindent
{\bf Homology.}
Consider the category of compact abelian groups with continuous $G$-action.
This category has enough projectives and we can define
$$
H_i(G, M) = L_iH_0(G, M)=L_i(M\mapsto M_G)
$$
and there is also a derived version.

\medskip\noindent
{\bf Trivial duality.}
The functor $M\mapsto M^\wedge = \Hom_{cont}(M, S^1)$
exchanges the categories above and
$$
H^i(G, M)^\wedge = H_i(G, M^\wedge)
$$
Moreover, this functor maps torsion discrete $G$-modules to profinite
continuous $G$-modules and vice versa, and if $M$ is either a discrete or
profinite continuous $G$-module, then
$M^\wedge = \Hom(M, \mathbf{Q}/\mathbf{Z})$.

\medskip\noindent
{\bf Notes on Homology.}
\begin{enumerate}
\item If we look at $\Lambda$-modules for a finite ring $\Lambda$
then we can identify
$$
H_i(G, M)=Tor_i^{\Lambda[[G]]}(M, \Lambda)
$$
where $\Lambda[[G]]$ is the limit of the group algebras of the finite
quotients of $G$.
\item If $G \vartriangleleft \Gamma$, and $\Gamma$ is also profinite
then
\begin{itemize}
\item $H^0(G, -)$: discrete $\Gamma$-module$\to$ discrete
$\Gamma/G$-modules
\item $H_0(G, -)$: compact $\Gamma$-modules $\to$ compact
$\Gamma/G$-modules
\end{itemize}
and hence the profinite group $\Gamma/G$ acts on the cohomology groups
of $G$ with values in a $\Gamma$-module. In other words, there are derived
functors
$$
RH^0(G, -) :
D^{+}(\text{discrete }\Gamma\text{-modules})
\longrightarrow
D^{+}(\text{discrete }\Gamma/G\text{-modules})
$$
and similarly for $LH_0(G, -)$.
\end{enumerate}








\section{Cohomology of curves, revisited}
\label{section-cohomology-curves-revisited}

\noindent
Let $k$ be a field, $X$ be geometrically connected, smooth curve over $k$.
We have the fundamental short exact sequence
$$
1 \to
\pi_1(X_{\overline k}, \overline \eta) \to
\pi_1(X, \overline\eta) \to
\text{Gal}(k^{^{sep}}/k) \to 1
$$
If $\Lambda$ is a finite ring with $\#\Lambda\in k^*$ and $M$ a finite
$\Lambda$-module, and we are given
$$
\rho:\pi_1(X, \overline\eta) \to \text{Aut}_{\Lambda}(M)
$$
continuous, then $\mathcal{F}_\rho$ denotes the associated sheaf on
$X_\etale$.

\begin{lemma}
\label{lemma-identify-h2c}
There is a canonical isomorphism
$$
H_c^2(X_{\overline k}, \mathcal{F}_\rho)=(M)_{\pi_1(X_{\overline k},
\overline\eta)}(-1)
$$
as $\text{Gal}(k^{^{sep}}/k)$-modules.
\end{lemma}

\noindent
Here the subscript ${}_{\pi_1(X_{\overline k}, \overline\eta)}$
indicates co-invariants, and $(-1)$ indicates the Tate twist i.e.,
$\sigma\in \text{Gal}(k^{^{sep}}/k)$ acts via
$$
\chi_{cycl}(\sigma)^{-1}.\sigma\text{ on RHS}
$$
where
$$
\chi_{cycl} :
\text{Gal}(k^{^{sep}}/k)
\to
\prod\nolimits_{l\neq char(k)}\mathbf{Z}_l^*
$$
is the cyclotomic character.

\medskip\noindent
Reformulation (Deligne, Weil II, page 338). For any finite locally
constant sheaf $\mathcal{F}$ on $X$ there is a maximal quotient $\mathcal{F}\to
\mathcal{F}''$ with $\mathcal{F}''/X_{\overline k}$ a constant sheaf, hence
$$
\mathcal{F}'' = (X\to \Spec(k))^{-1}F''
$$
where $F''$ is a sheaf $\Spec(k)$, i.e., a
$\text{Gal}(k^{^{sep}}/k)$-module. Then
$$
H_c^2(X_{\overline k}, \mathcal{F})\to H_c^2(X_{\overline k},
\mathcal{F}'')\to F''(-1)
$$
is an isomorphism.

\begin{proof}[Proof of Lemma \ref{lemma-identify-h2c}]
Let $Y\to^{\varphi}X$ be the finite \'etale Galois covering
corresponding to $\Ker(\rho) \subset \pi_1(X, \overline\eta)$. So
$$
\text{Aut}(Y/X)=Ind(\rho)
$$
is Galois group. Then $\varphi^*\mathcal{F}_\rho =\underline M_Y$ and
$$
\varphi_*\varphi^*\mathcal{F}_\rho\to \mathcal{F}_\rho
$$
which gives
\begin{align*}
& H_c^2(X_{\overline k}, \varphi_*\varphi^*\mathcal{F}_\rho) \to
H_c^2(X_{\overline k}, \mathcal{F}_\rho)\\
& =H_c^2(Y_{\overline k}, \varphi^*\mathcal{F}_\rho)\\
& =H_c^2(Y_{\overline k}, \underline M) = \oplus_{\text{irred.
comp. of }\atop Y_{\overline k}}M
\end{align*}
$$
\Im(\rho) \to H_c^2(Y_{\overline k}, \underline M) =
\oplus_{\text{irred. comp. of } \atop Y_{\overline k}}
M \to_{\Im(\rho) \text{equivalent}} H_c^2(X_{\overline k},
\mathcal{F}_{\rho}) \to^{\text{trivial }
\Im(\rho) \atop \text{action}}
$$
irreducible curve $C/\overline k$, $H_c^2(C, \underline M)=M$.
\\
Since
$$
{\text{set of irreducible }\atop\text{components of }Y_k} =
\frac{Im(\rho)}{Im(\rho|_{\pi_1(X_{\overline k}, \overline \eta)})}
$$
We conclude that $H_c^2(X_{\overline k}, \mathcal{F}_\rho)$ is a
quotient of $M_{\pi_1(X_{\overline k}, \overline \eta)}$. On the other hand,
there is a surjection
$$
\mathcal{F}_\rho\to \mathcal{F}'' = {\text{ sheaf on }
X\text{ associated to }\atop (M)_{\pi_1(X_{\overline k}, \overline
\eta)}\leftarrow\pi_1(X, \overline \eta)}
$$
$$
H_c^2(X_{\overline k}, \mathcal{F}_\rho)\to
M_{\pi_1(X_{\overline k}, \overline\eta)}
$$
The twist in Galois action comes from the fact that
$H_c^2(X_{\overline k}, \mu_n)=^{\text{can}} \mathbf{Z}/n\mathbf{Z}$.
\end{proof}

\begin{remark}
\label{remark-projective}
Thus we conclude that if $X$ is also projective then
we have functorially in the representation $\rho$
the identifications
$$
H^0(X_{\overline k}, \mathcal{F}_\rho) =
M^{\pi_1(X_{\overline k}, \overline\eta)}
$$
and
$$
H_c^2(X_{\overline k}, \mathcal{F}_\rho) =
M_{\pi_1(X_{\overline k}, \overline \eta)}(-1)
$$
Of course if $X$ is not projective, then
$H^0_c(X_{\overline{k}}, \mathcal{F}_\rho) = 0$.
\end{remark}


\begin{proposition}
\label{proposition-curve-kpi1}
Let $X/k$ as before but $X_{\overline k}\neq \mathbf{P}^1_{\overline k}$
The functors
$
(M, \rho)\mapsto H_c^{2-i}(X_{\overline k}, \mathcal{F}_\rho)
$
are the left derived functor of
$(M, \rho)\mapsto H_c^2(X_{\overline k}, \mathcal{F}_\rho)$
so
$$
H_c^{2-i}(X_{\overline k}, \mathcal{F}_\rho) =
H_i(\pi_1(X_{\overline k}, \overline \eta), M)(-1)
$$
Moreover, there is a derived version, namely
$$
R\Gamma_c(X_{\overline k}, \mathcal{F}_\rho)
=
LH_0(\pi_1(X_{\overline k}, \overline \eta), M(-1))
=
M(-1)
\otimes_{\Lambda[[\pi_1(X_{\overline k}, \overline \eta)]]}^\mathbf{L}
\Lambda
$$
in $D(\Lambda[[\widehat{\mathbf{Z}}]])$.
Similarly, the functors
$(M, \rho)\mapsto H^i(X_{\overline k}, \mathcal{F}_\rho)$
are the right derived functor of
$(M, \rho)\mapsto M^{\pi_1(X_{\overline k}, \overline \eta)}$
so
$$
H^i(X_{\overline k}, \mathcal{F}_\rho) =
H^i(\pi_1(X_{\overline k}, \overline \eta), M)
$$
Moreover, in this case there is a derived version too.
\end{proposition}

\begin{proof}
(Idea) Show both sides are universal $\delta$-functors.
\end{proof}

\begin{remark}
\label{remark-poincare-groups}
By the proposition and Trivial duality then you get
$$
H^{2-i}_c(X_{\overline k}, \mathcal{F}_\rho)
\times
H^i(X_{\overline k}, \mathcal{F}_\rho^\wedge(1))
\to
\mathbf{Q}/\mathbf{Z}
$$
a perfect pairing. If $X$ is projective then this is Poincare duality.
\end{remark}





\section{Abstract trace formula}
\label{section-abstract-trace-formula}

\noindent
Suppose given an extension of profinite groups,
$$
1 \to G \to \Gamma \xrightarrow{\deg} \widehat{\mathbf{Z}} \to 1
$$
We say $\Gamma$ {\it has an abstract trace formula} if and only if
there exist
\begin{enumerate}
\item an integer $q\geq 1$, and
\item for every $d\geq 1$ a finite set $S_d$ and for each $x\in S_d$ a
conjugacy class $F_x \in \Gamma$ with $\deg(F_x) = d$
\end{enumerate}
such that the following hold
\begin{enumerate}
\item for all $\ell$ not dividing $q$ have $\text{cd}_\ell(G)<\infty$, and
\item for all finite rings $\Lambda$ with $q\in \Lambda^*$,
for all finite projective $\Lambda$-modules $M$ with continuous
$\Gamma$-action, for all $n>0$ we have
$$
\sum\nolimits_{d|n}d \left(
\sum\nolimits_{x \in S_d}
\text{Tr}( F_x^{n/d} \left|_M\right.)
\right)
=
q^n \text{Tr}( F^n\left|_{M \otimes_{\Lambda[[G]]}^{\mathbf{L}}\Lambda}\right.)
$$
in $\Lambda^\natural$.
\end{enumerate}
Here $M \otimes_{\Lambda[[G]]}^{\mathbf{L}}\Lambda = LH_0(G, M)$ denotes
derived homology, and $F=1$ in $\Gamma/G = \widehat{\mathbf{Z}}$.

\begin{remark}
\label{remark-abstract-trace-formula}
Here are some observations concerning this notion.
\begin{enumerate}
\item If modeling projective curves then we can use cohomology and we
don't need factor $q^n$.
\item The only examples I know are $\Gamma=\pi_1(X, \overline \eta)$
where $X$ is smooth, geometrically irreducible and $K(\pi, 1)$ over finite
field. In this case $q=(\# k)^{\dim X}$. Modulo the proposition, we proved
this for curves in this course.
\item Given the integer $q$ then the sets $S_d$ are uniquely
determined. (You can multiple $q$ by an integer $m$ and then replace $S_d$ by
$m^d$ copies of $S_d$ without changing the formula.)
\end{enumerate}
\end{remark}

\begin{example}
\label{example-commutative}
Fix an integer $q\geq 1$
$$
\begin{matrix}
1 &
\to &
G = \widehat{\mathbf{Z}}^{(q)} &
\to &
\Gamma &
\to &
\widehat{\mathbf{Z}} &
\to &
1 \\
&
&
= \prod_{l\not \mid q} \mathbf{Z}_l &
&
F &
\mapsto &
1
\end{matrix}
$$
with $FxF^{-1} = ux$, $u \in (\widehat{\mathbf{Z}}^{(q)})^*$.
Just using the trivial modules
$\mathbf{Z}/m\mathbf{Z}$ we see
$$
q^n - (qu)^n \equiv \sum\nolimits_{d|n} d\# S_d
$$
in $\mathbf{Z}/m\mathbf{Z}$ for all $(m, q)=1$ (up to
$u \to u^{-1}$) this implies $qu = a\in \mathbf{Z}$
and $|a| < q$. The special case $a = 1$ does occur with
$$
\Gamma = \pi_1^t(\mathbf{G}_{m, \mathbf{F}_p}, \overline \eta),
\quad
\# S_1 = q - 1,
\quad\text{and}\quad
\# S_2 = \frac{(q^2-1)-(q-1)}{2}
$$
\end{example}



%12.08.09
\section{Automorphic forms and sheaves}
\label{section-automorphic}

\noindent
References: See especially the amazing papers
\cite{D1}, \cite{D2} and \cite{D0} by Drinfeld.

\medskip\noindent
{\bf Unramified cusp forms.}
Let $k$ be a finite field of characteristic $p$.
Let $X$ geometrically irreducible projective smooth curve over $k$.
Set $K = k(X)$ equal to the function field of $X$.
Let $v$ be a place of $K$ which is the same thing as a
closed point $x\in X$. Let $K_v$ be the completion of $K$ at $v$, which
is the same thing as the fraction field of the completion of
the local ring of $X$ at $x$, i.e., $K_v = f.f.(\widehat{O_{X, x}})$.
Denote $O_v\subset K_v$ the ring of integers. We further set
$$
O = \prod\nolimits_v O_v \subset \mathbf{A} = \prod_v' K_v
$$
and we let $\Lambda$ be any ring with $p$ invertible in $\Lambda$.

\begin{definition}
\label{definition-unramified}
An {\it unramified cusp form on $\text{GL}_2(\mathbf{A})$ with values in
$\Lambda$}\footnote{This is likely nonstandard notation.}
is a function
$$
f: \text{GL}_2(\mathbf{A}) \to \Lambda
$$
such that
\begin{enumerate}
\item $f(x\gamma) = f(x)$ for all $x\in \text{GL}_2(\mathbf{A})$ and all
$\gamma\in \text{GL}_2(K)$
\item $f(ux) = f(x)$ for all $x\in \text{GL}_2(\mathbf{A})$ and all
$u\in \text{GL}_2(O)$
\item for all $x\in \text{GL}_2(\mathbf{A})$,
$$
\int_{\mathbf{A} \mod K} f
\left(x
\left(
\begin{matrix}
1 & z \\
0 & 1
\end{matrix}
\right)
\right) dz = 0
$$
see \cite[Section 4.1]{dJ-conjecture}
for an explanation of how to make sense out
of this for a general ring $\Lambda$ in which $p$ is invertible.
\end{enumerate}
\end{definition}

\medskip\noindent
{\bf Hecke Operators.}
For $v$ a place of $K$ and $f$ an unramified cusp form we set
$$
T_v(f)(x) =
\int_{g\in M_v}f(g^{-1}x)dg,
$$
and
$$
U_v(f)(x) =
f\left(
\left(
\begin{matrix}
\pi_v^{-1} & 0 \\ 0 & \pi_v^{-1}
\end{matrix}
\right)x\right)
$$
Notations used: here $\pi_v \in O_v$ is a uniformizer
$$
M_v =
\left\{
h\in Mat(2\times 2, \; O_v)
\left| \det h = \pi_vO_v^*\right.
\right\}
$$
and $dg=$ is the Haar measure on $\text{GL}_2(K_v)$ with
$\int_{\text{GL}_2(O_v)} dg = 1$. Explicitly we have
$$
T_v(f)(x) =
f\left(
\left(
\begin{matrix}
\pi_v^{-1}& 0 \\ 0 & 1
\end{matrix}
\right)
x\right) +
\sum_{i=1}^{q_v}
f\left(\left(
\begin{matrix}
1 & 0 \\ -\pi_v^{-1}\lambda_i
& \pi_v^{-1}
\end{matrix}
\right) x\right)
$$
with $\lambda_i\in O_v$ a set of representatives of
$O_v/(\pi_v)=\kappa_v$, $q_v = \#\kappa_v$.

\medskip\noindent
{\bf Eigenforms.} An {\it eigenform} $f$ is an unramified cusp form
such that some value of $f$ is a unit and $T_vf = t_vf$ and
$U_vf = u_vf$ for some (uniquely determined) $t_v, \; u_v \in \Lambda$.

\begin{theorem}
\label{theorem-drinfeld-make-rho}
Given an eigenform $f$ with values in
$\overline{\mathbf{Q}}_l$ and eigenvalues
$u_v\in \overline{\mathbf{Z}}_l^*$ then there exists
$$
\rho: \pi_1(X)\to \text{GL}_2(E)
$$
continuous, absolutely irreducible where
$E$ is a finite extension of $\mathbf{Q}_\ell$ contained in
$\overline{\mathbf{Q}}_l$ such that
$t_v = \text{Tr}(\rho(F_v))$, and
$u_v = q_v^{-1}\det\left(\rho(F_v)\right)$ for all places $v$.
\end{theorem}

\begin{proof}
See \cite{D0}.
\end{proof}

\begin{theorem}
\label{theorem-drinfeld-make-f}
Suppose $\mathbf{Q}_l \subset E$ finite, and
$$
\rho: \pi_1(X)\to \text{GL}_2(E)
$$
absolutely irreducible, continuous. Then there exists an eigenform $f$ with
values in $\overline{\mathbf{Q}}_l$ whose eigenvalues $t_v$, $u_v$
satisfy the equalities
$t_v = \text{Tr}(\rho(F_v))$ and $u_v=q_v^{-1}\det(\rho(F_v))$.
\end{theorem}

\begin{proof}
See \cite{D1}.
\end{proof}

\begin{remark}
\label{remark-lafforgue}
We now have, thanks to Lafforgue and many other mathematicians,
complete theorems like this two above for $\text{GL}_n$
and allowing ramification!
In other words, the full global Langlands correspondence for $\text{GL}_n$
is known for function fields of curves over finite fields. At the same
time this does not mean there aren't a lot of interesting questions left
to answer about the fundamental groups of curves over finite fields, as
we shall see below.
\end{remark}

\noindent
{\bf Central character.} If $f$ is an eigenform then
$$
\begin{matrix}
\chi_f : &
O^*\backslash \mathbf{A}^*/K^* &
\to &
\Lambda^* \\
&
(1, \ldots, \pi_v, 1, \ldots, 1) &
\mapsto &
u_v^{-1}
\end{matrix}
$$
is called the {\it central character}. If corresponds to the
determinant of $\rho$ via normalizations as above. Set
$$
C(\Lambda)=\left\{{\text{unr. cusp forms } f \text{ with coefficients
in }\Lambda}\atop {\text{ such that } U_v f = \varphi_v^{-1}f\forall
v}\right\}
$$

\begin{proposition}
\label{proposition-cusp-forms-finite}
If $\Lambda$ is Noetherian then $C(\Lambda)$ is a
finitely generated $\Lambda$-module. Moreover, if $\Lambda$ is a field with
prime subfield $\mathbf{F} \subset \Lambda$ then
$$
C(\Lambda)=(C(\mathbf{F}))\otimes_{\mathbf{F}}\Lambda
$$
compatibly with $T_v$ acting.
\end{proposition}

\begin{proof}
See \cite[Proposition 4.7]{dJ-conjecture}.
\end{proof}

\noindent
This proposition trivially implies the following lemma.

\begin{lemma}
\label{lemma-eigenvalues-algebraic}
Algebraicity of eigenvalues.
If $\Lambda$ is a field then the eigenvalues $t_v$ for $f\in
C(\Lambda)$ are algebraic over the prime subfield
$\mathbf{F} \subset \Lambda$.
\end{lemma}

\begin{proof}
Follows from Proposition \ref{proposition-cusp-forms-finite}.
\end{proof}

\noindent
Combining all of the above we can do the following very useful trick.

\begin{lemma}
\label{lemma-switch-l}
Switching $l$. Let $E$ be a number field.
Start with
$$
\rho: \pi_1(X)\to SL_2(E_\lambda)
$$
absolutely irreducible continuous, where $\lambda$ is a place of $E$
not lying above $p$. Then for any second place $\lambda'$ of $E$
not lying above $p$ there exists a finite extension $E'_{\lambda'}$
and a absolutely irreducible continuous representation
$$
\rho': \pi_1(X)\to SL_2(E'_{\lambda'})
$$
which is compatible with $\rho$ in the sense that the characteristic
polynomials of all Frobenii are the same.
\end{lemma}

\noindent
Note how this is an instance of Deligne's conjecture!

\begin{proof}
To prove the switching lemma use
Theorem \ref{theorem-drinfeld-make-f}
to obtain $f\in C(\overline{\mathbf{Q}}_l)$ eigenform ass. to $\rho$.
Next, use
Proposition \ref{proposition-cusp-forms-finite}
to see that we may choose $f\in C(E')$ with $E \subset E'$ finite.
Next we may complete $E'$ to see that we get
$f\in C(E'_{\lambda'})$ eigenform with
$E'_{\lambda'}$ a finite extension of $E_{\lambda'}$.
And finally we use
Theorem \ref{theorem-drinfeld-make-rho}
to obtain
$\rho': \pi_1(X) \to SL_2(E_{\lambda'}')$ abs. irred. and continuous
after perhaps enlarging $E'_{\lambda'}$ a bit again.
\end{proof}

\noindent
Speculation: If for a (topological) ring $\Lambda$ we have
$$
\left(
{\rho: \pi_1(X)\to SL_2(\Lambda)\atop \text{ abs irred}}
\right)
\leftrightarrow
\text{ eigen forms in } C(\Lambda)
$$
then all eigenvalues of $\rho(F_v)$ algebraic (won't work in an easy
way if $\Lambda$ is a finite ring. Based on the speculation that the
Langlands correspondence works more generally than just over fields
one arrives at the following conjecture.

\medskip\noindent
{\bf Conjecture.}
(See \cite{dJ-conjecture})
For any continuous
$$
\rho: \pi_1(X)\to \text{GL}_n(\mathbf{F}_l[[t]])
$$
we have $\# \rho(\pi_1(X_{\overline k}))<\infty$.

\medskip\noindent
A rephrasing in the language of sheaves:
"For any lisse sheaf of $\overline{\mathbf{F}_l((t))}$-modules the geom
monodromy is finite."

\begin{theorem}
\label{theorem-conjecture-n-2}
The Conjecture holds if $n\leq 2$.
\end{theorem}

\begin{proof}
See \cite{dJ-conjecture}.
\end{proof}

\begin{theorem}
\label{theorem-conjecture-l-bigger-2n}
Conjecture holds if $l>2n$ modulo some unproven things.
\end{theorem}

\begin{proof}
See \cite{Gaitsgory}.
\end{proof}

\noindent
It turns out the conjecture is useful for something.
See work of Drinfeld on Kashiwara's conjectures. But there is also
the much more down to earth application as follows.

\begin{theorem}
\label{theorem-deformation-rings}
(See \cite[Theorem 3.5]{dJ-conjecture})
Suppose
$$
\rho_0: \pi_1(X)\to \text{GL}_n(\mathbf{F}_l)
$$
is a continuous, $l\neq p$. Assume
\begin{enumerate}
\item Conj. holds for $X$,
\item $\rho_0\left|_{\pi_1(X_{\overline k})}\right.$ abs. irred., and
\item $l$ does not divide $n$.
\end{enumerate}
Then the universal determination ring $R_{\text{univ}}$ of $\rho_0$ is
finite flat over $\mathbf{Z}_l$.
\end{theorem}

\noindent
Explanation: There is a representation $\rho_{\text{univ}}:
\pi_1(X)\to \text{GL}_n(R_{\text{univ}})$ (Univ. Defo ring)
$R_{\text{univ}}$ loc.
complete, residue field $\mathbf{F}_l$ and $(R_{\text{univ}}\to
\mathbf{F}_l)\circ\rho_{\text{univ}}\cong\rho_0$.
And given any $R\to \mathbf{F}_l$, $R$ local complete and $\rho: \pi_1(X)\to
\text{GL}_n(R)$ then there exists $\psi: R_{\text{univ}}\to R$ such that
$\psi\circ\rho_{\text{univ}}\cong \rho$. The theorem says that the morphism
$$
\Spec(R_{\text{univ}})
\longrightarrow
\Spec(\mathbf{Z}_l)
$$
is finite and flat. In particular, such a $\rho_0$
lifts to a $\rho : \pi_1(X) \to \text{GL}_n(\overline{\mathbf{Q}}_l)$.

\medskip\noindent
Notes:
\begin{enumerate}
\item The theorem on deformations is easy.
\item Any result towards the conjecture seems hard.
\item It would be interesting to have more conjectures on $\pi_1(X)$!
\end{enumerate}




%12.10.09
\section{Counting points}
\label{section-counting}

\noindent
Let $X$ be a smooth, geometrically irreducible,
projective curve over $k$ and $q = \# k$. Trace formula gives:\\
there exists algebraic integers $w_1, \ldots, w_{2g}$ such that
$$
\# X(k_n) = q^n - \sum\nolimits_{i = 1}^{2g_X} w_i^n + 1.
$$
If $\sigma\in \text{Aut}(X)$ then for all $i$, there exists $j$ such that
$\sigma(w_i)=w_j$.

\medskip\noindent
{\bf Riemann-Hypothesis.} For all $i$ we have $|\omega_i| = \sqrt{q}$.

\medskip\noindent
This was formulated by Emil Artin, in 1924, for
hyperelliptic curves. Proved by Weil 1940. Weil gave two proofs
\begin{itemize}
\item using intersection theory on $X \times X$, using the
Hodge index theorem, and
\item using the Jacobian of $X$.
\end{itemize}
There is another proof whose initial idea is due to Stephanov, and
which was given by Bombieri: it uses the function field $k(X)$ and
its Frobenius operator (1969). The starting point is that given
$f\in k(X)$ one observes that $f^q - f$ is a rational function which
vanishes in all the $\mathbf{F}_q$-rational points of $X$, and that one
can try to use this idea to give an upper bound for the number of points.


\section{Precise form of Chebotarev}
\label{section-chebotarev}

\noindent
As a first application let us prove a precise form of Chebotarev
for a finite \'etale Galois covering of curves.
Let $\varphi : Y \to X$ be a finite \'etale Galois covering with
group $G$. This corresponds to a homomorphism
$$
\pi_1(X) \longrightarrow G = \text{Aut}(Y/X)
$$
Assume $Y_{\overline k} = $ irreducible. If $C\subset G$ is a conjugacy
class then for all $n>0$, we have
$$
\left|
\#\left\{x \in X(k_n) \mid F_x \in C \right\} -
\frac{\# C}{\# G} \cdot \# X(k_n)
\right|
\leq
(\# C)(2g - 2) \sqrt{q^n}
$$
(Warning: Please check the coefficient $\# C$ on the right hand side
carefuly before using.)

\begin{proof}[Sketch]
Write
$$
\varphi_*(\overline{\mathbf{Q}_l}) =
\oplus_{\pi \in \widehat G} \mathcal{F}_{\pi}
$$
where $\widehat G$ is the set of isomorphism
classes of irred representations of
$G$ over $\overline{\mathbf{Q}}_l$. For $\pi \in \widehat G$
let $\chi_{\pi}: G \to \overline{\mathbf{Q}}_l$
be the character of $\pi$. Then
$$
H^*(Y_{\overline k}, \overline{\mathbf{Q}}_l) =
\oplus_{\pi\in \widehat G}
H^*(Y_{\overline k}, \overline{\mathbf{Q}}_l)_\pi
=_{(\varphi\text{ finite })}
\oplus_{\pi\in \widehat G}
H^*(X_{\overline k}, \mathcal{F}_\pi)
$$
If $\pi\neq 1$ then we have
$$
H^0(X_{\overline k}, \mathcal{F}_\pi) = H^2(X_{\overline k},
\mathcal{F}_\pi)=0, \; \dim H^1(X_{\overline k}, \mathcal{F}_\pi) =
(2g_X-2)d_\pi^2
$$
(can get this from trace formula for acting on ...) and we see that
$$
\left|\sum_{x \in X(k_n)} \chi_\pi(\mathcal{F}_x)\right|
\leq
(2g_X - 2) d_\pi^2\sqrt{q^n}
$$
Write $1_C = \sum_\pi a_\pi \chi_\pi$, then
$a_\pi = \left<1_C, \chi_\pi\right>$, and
$a_1 = \left<1_C, \chi_1\right> = \frac{\# C}{\# G}$ where
$$
\left<f, h\right> = \frac{1}{\# G}\sum_{g \in G} f(g)\overline{h(g)}
$$
Thus we have the relation
$$
\frac{\# C}{\# G} = ||1_C||^2 = \sum|a_\pi|^2
$$
Final step:
\begin{align*}
\#\left\{x \in X(k_n) \mid F_x \in C\right\}
& =
\sum_{x \in X(k_n)} 1_C(x) \\
& =
\sum_{x \in X(k_n)} \sum_\pi a_\pi \chi_\pi(F_x) \\
& =
\underbrace{\frac{\# C}{\# G} \# X(k_n)}_{
\text{term for }\pi = 1}
+
\underbrace{\sum_{\pi\neq 1}a_\pi\sum_{x\in X(k_n)}\chi_\pi(F_x)}_{
\text{ error term (to be bounded by $E$)}}
\end{align*}
We can bound the error term by
\begin{align*}
|E|
& \leq
\sum_{\pi \in \widehat G, \atop \pi \neq 1}
|a_\pi| (2g - 2) d_\pi^2 \sqrt{q^n} \\
& \leq
\sum_{\pi \neq 1} \frac{\# C}{\# G} (2g_X - 2) d_\pi^3 \sqrt{q^n}
\end{align*}
By Weil's conjecture, $\# X(k_n)\sim q^n$.
\end{proof}



\section{How many primes decompose completely?}
\label{section-how-many}

\noindent
This section gives a second application of the Riemann Hypothesis for
curves over a finite field. For number theorists it may be nice
to look at the paper by Ihara, entitled
``How many primes decompose completely in an infinite unramified Galois
extension of a global field?'', see \cite{Ihara}.
Consider the fundamental exact sequence
$$
1 \to
\pi_1(X_{\overline k}) \to
\pi_1(X) \xrightarrow{\deg}
\widehat{\mathbf{Z}} \to 1
$$

\begin{proposition}
\label{proposition-finite-set-frobenii-generate-topologically}
There exists a finite set $x_1, \ldots, x_n$ of closed points of $X$
such that that set of \underline{all} frobenius elements corresponding to these
points topologically generate $\pi_1(X)$.
\end{proposition}

\noindent
Another way to state this is:
There exist $x_1, \ldots, x_n\in |X|$ such that
the smallest normal closed subgroup $\Gamma$ of $\pi_1(X)$
containing $1$ frobenius element for each $x_i$ is all of $\pi_1(X)$. i.e.,
$\Gamma = \pi_1(X)$.

\begin{proof}
Pick $N\gg 0$ and let
$$
\left\{x_1, \ldots, x_n\right\}={\text{ set of all closed points of
}\atop X\text{ of degree} \leq N\text{ over } k}
$$
Let $\Gamma\subset \pi_1(X)$ be as in variant statement for these
points. Assume $\Gamma\neq \pi_1(X)$. We can pick $\Gamma\lhd \pi_1(X)$ with
$U\neq \pi_1(X)$. By R.H. for $X$ this set I will have some $x_{i_1}$ of degree
$N$, some $x_{i_2}$ of degree $N-1$. This shows
$\Gamma\to^{\deg}\widehat{\mathbf{Z}}$ and $z_0$ and so also $U$. This exactly
means if $Y\to X$ is the finite \'etale Galois covering as to $U$, then
$Y_{\overline k}$ irreducible.
$$
Y\to^G X, \; G = \pi_1(X)/U
$$
By construction all points of $X$ of degree $\leq N$, split
completely in $Y$. So, in particular
$$
\# Y(k_N)\geq (\# G)\# X(k_N)
$$
Use R.H. on both sides. So you get
$$
q^N+1+2g_Yq^{N/2}\geq \# G\# X(k_N)\geq \#
G(q^N+1-2g_Xq^{N/2})
$$
Since $2g_Y-2 = (\# G)(2g_X-2)$,
$$
q^N+1+(\# G)(2g_X-1)+1)q^{N/2}\geq \#
G(q^N+1-2g_Xq^{N/2})
$$
\end{proof}

\noindent
{\bf Weird Question.}
Set $W_X = \deg^{-1}(\mathbf{Z})\subset \pi_1(X)$.
Is it true that for some finite set of closed points $x_1, \ldots, x_n$ of $X$
the set of all frobenii corresponding to these points
{\it algebraically} generate $W_X$?

\medskip\noindent
By a Baire category argument this translates into the same question
for all Frobenii.





\section{How many points are there really?}
\label{section-really}

\noindent
If the genus of the curve is large relative to $q$, then the main
term in the formula $\#X(k) = q - \sum \omega_i + 1$ is not $q$
but the second term $\sum \omega_i$ which can (a priori) have
size about $2g_X\sqrt{q}$. In the paper \cite{Drinfeld-number}
the authors Drinfeld and Vladut show that this maximum is (as predicted
by Ihara earlier) actually at most about $g\sqrt{q}$.

\medskip\noindent
Fix $q$ and let $k$ be a field with $k$ elements. Set
$$
A(q) = \limsup_{g_X \to \infty} \frac{\# X(k)}{g_X}
$$
where $X$ runs over geometrically irreducible smooth projective
curves over $k$. With this definition we have the following results:
\begin{itemize}
\item RH $\Rightarrow\; A(q)\leq 2\sqrt q$
\item Ihara $\Rightarrow\; A(q)\leq \sqrt{2q}$
\item DV $A(q)\leq \sqrt q-1$ (actually this is sharp if $q$ is a square)
\end{itemize}

\begin{proof}
Given $X$ let $w_1, \ldots, w_{2g}$ and $g = g_X$ be as before. Set
$\alpha_i = \frac{w_i}{\sqrt q}$, so $|\alpha_i| = 1$. If $\alpha_i$
occurs then $\overline{\alpha}_i = \alpha_i^{-1}$ also occurs. Then
$$
N = \# X(k) \leq X(k_r) = q^r + 1 - (\sum_i \alpha_i^r) q^{r/2}
$$
Rewriting we see that for every $r \geq 1$
$$
-\sum_i \alpha_i^r \geq Nq^{-r/2} - q^{r/2} - q^{-r/2}
$$
Observe that
$$
0 \leq |\alpha_i^n +\alpha_i^{n-1} +\cdots +\alpha_i +1|^2
= (n + 1) + \sum_{j = 1}^n (n + 1 - j) (\alpha_i^j + \alpha_i^{-j})
$$
So
\begin{align*}
2g(n+1) & \geq - \sum_i \left(\sum_{j=1}^n (n+1-j)(\alpha_i^j
+\alpha_i^{-j})\right)\\
& =-\sum_{j=1}^n (n+1-j)\left(\sum_i\alpha_i^j
+\sum_i\alpha_i^{-j}\right)
\end{align*}
Take half of this to get
\begin{align*}
g(n+1)& \geq -\sum_{j=1}^n (n+1-j)(\sum_i\alpha_i^j)\\
& \geq N\sum_{j=1}^n (n+1-j)q^{-j/2}-\sum_{j=1}^n
(n+1-j)(q^{j/2}+q^{-j/2})
\end{align*}
This gives
$$
\frac{N}{g}\leq \left(\sum_{j=1}^n \frac{n+1-j}{n+1}q^{-j/2}
\right)^{-1}\cdot\left(1+\frac{1}{g}\sum_{j=1}^n\frac{n+1-j}{n+1}(q^{j/2}+q^{-j/
2})\right)
$$
Fix $n$ let $g\to \infty$
$$
A(q)\leq \left(\sum_{j=1}^n \frac{n+1-j}{n+1}q^{-j/2}\right)^{-1}
$$
So
$$
A(q)\leq \lim_{n\to\infty}(\cdots) = \left(\sum_{j=1}^\infty
q^{-j/2}\right)^{-1}=\sqrt q-1
$$
\end{proof}





\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
