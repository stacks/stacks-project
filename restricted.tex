\input{preamble}

% OK, start here.
%
\begin{document}

\title{Restricted Power Series}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
The title of this chapter is a bit misleading because the most
basic material on restricted power series is in the chapter on
formal algebraic spaces. For example
Formal Spaces, Section \ref{formal-spaces-section-restricted-power-series}
defines the restricted power series ring $A\{x_1, \ldots, x_n\}$
given a linearly topologized ring $A$. In
Formal Spaces, Section \ref{formal-spaces-section-tft}
we discuss the relationship between these restricted power
series rings and morphisms of finite type between
locally countably indexed formal algebraic spaces.

\medskip\noindent
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. In the
first part of this chapter
(Sections \ref{section-two-categories} -- \ref{section-over-G-ring})
we discuss the category of $I$-adically complete algebras $B$
topologically of finite type over a Noetherian ring $A$.
It is shown that $B = A\{x_1, \ldots, x_n\}/J$ for some
(closed) ideal $J$ in the restricted power series ring
(where $A$ is endowed with the $I$-adic topology).
We show there is a good notion of a naive cotangent complex
$\NL_{B/A}^\wedge$. If some power of $I$ annihilates
$\NL_{B/A}^\wedge$, then we think of $\text{Spf}(B)$ as
a rig-\'etale formal algebraic space over $A$. This leads to
a definition of rig-\'etale morphisms of Noetherian
formal algebraic spaces. After a certain amount of work
we are able to prove the main result of the first part:
if $\text{Spf}(B)$ is rig-\'etale over $A$ as above,
then there exists a finite type $A$-algebra $C$
such that $B$ is isomorphic to the $I$-adic completion of $C$, see
Lemma \ref{lemma-approximate-by-etale-over-complement}.
One thing to note here is that we prove this without assuming
the ring $A$ is excellent or even a G-ring. In the last section
of the first part we show that under the assumption that
$A$ is a G-ring there is a straightforward
proof of the lemma based on Popescu's theorem.

\medskip\noindent
Many of the results discussed in the first part can be found in the paper
\cite{Elkik}. Other general references for this part are
\cite{EGA}, \cite{Abbes}, and \cite{Fujiwara-Kato}.

\medskip\noindent
In the second part of this chapter we use the main result of
the first part to prove Artin's result on dilatations from \cite{ArtinII}.
The result on contractions will be the subject of a later chapter
(insert future reference here).
The main existence theorem is the equivalence of categories in
Theorem \ref{theorem-dilatations-general}.
It is more general than Artin's result in that it shows that any
rig-\'etale morphism $f : W \to \Spec(A)_{/V(I)}$
is the completion of a morphism $Y \to \Spec(A)$
of algebraic spaces $X$ which is locally of finite type
and isomorphism away from $V(I)$. In Artin's work
the morphism $f$ is assumed proper and rig-surjective.
A special case of this is the main lemma mentioned
above and the general case follows from this by
a straightforward (somewhat lengthy) glueing procedure.
There are several lemmas modifying the main theorem
the final one of which is (almost) exactly the statement in
Artin's paper.
In the last section we apply the results to modifications
of $\Spec(A)$ before and after completion.









\section{Two categories}
\label{section-two-categories}

\noindent
Let $A$ be a ring and let $I \subset A$ be an ideal.
In this section ${}^\wedge$ will mean $I$-adic completion.
Set $A_n = A/I^n$ so that the $I$-adic completion of $A$ is
$A^\wedge = \lim A_n$. Let $\mathcal{C}$ be the
category
\begin{equation}
\label{equation-C}
\mathcal{C} =
\left\{
\begin{matrix}
\text{inverse systems }\ldots \to B_3 \to B_2 \to B_1 \\
\text{where }B_n\text{ is a finite type }A_n\text{-algebra,}\\
B_{n + 1} \to B_n\text{ is an }A_{n + 1}\text{-algebra map}\\
\text{which induces }B_{n + 1}/I^nB_{n + 1} \cong B_n
\end{matrix}
\right\}
\end{equation}
Morphisms in $\mathcal{C}$ are given by systems of homomorphisms.
Let $\mathcal{C}'$ be the category
\begin{equation}
\label{equation-C-prime}
\mathcal{C}' =
\left\{
\begin{matrix}
A\text{-algebras }B\text{ which are }I\text{-adically complete}\\
\text{such that }B/IB\text{ is of finite type over }A/I
\end{matrix}
\right\}
\end{equation}
Morphisms in $\mathcal{C}'$ are $A$-algebra maps. There is a functor
\begin{equation}
\label{equation-from-complete-to-systems}
\mathcal{C}' \longrightarrow \mathcal{C},\quad
B \longmapsto (B/I^nB)
\end{equation}
Indeed, since $B/IB$ is of finite type over $A/I$ the ring maps
$A_n = A/I^n \to B/I^nB$ are of finite type by
Algebra, Lemma \ref{algebra-lemma-finite-type-mod-nilpotent}.

\begin{lemma}
\label{lemma-topologically-finite-type}
Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal.
The functor
$$
\mathcal{C} \longrightarrow \mathcal{C}',\quad
(B_n) \longmapsto B = \lim B_n
$$
is a quasi-inverse to (\ref{equation-from-complete-to-systems}).
The completions $A[x_1, \ldots, x_r]^\wedge$ are in $\mathcal{C}'$ and
any object of $\mathcal{C}'$ is of the form
$$
B = A[x_1, \ldots, x_r]^\wedge / J
$$
for some ideal $J \subset A[x_1, \ldots, x_r]^\wedge$.
\end{lemma}

\begin{proof}
Let $(B_n)$ be an object of $\mathcal{C}$. By
Algebra, Lemma \ref{algebra-lemma-limit-complete}
we see that $B = \lim B_n$ is $I$-adically complete
and $B/I^nB = B_n$. Hence we see that $B$ is an object of
$\mathcal{C}'$ and that we can recover the object $(B_n)$ 
by taking the quotients.
Conversely, if $B$ is an object of $\mathcal{C}'$, then
$B = \lim B/I^nB$ by assumption. Thus $B \mapsto (B/I^nB)$ is a quasi-inverse
to the functor of the lemma.

\medskip\noindent
Since $A[x_1, \ldots, x_r]^\wedge = \lim A_n[x_1, \ldots, x_r]$
it is an object of $\mathcal{C}'$ by the first statement of the lemma.
Finally, let $B$ be an object of $\mathcal{C}'$. Choose
$b_1, \ldots, b_r \in B$ whose images in $B/IB$ generate
$B/IB$ as an algebra over $A/I$. Since $B$ is $I$-adically
complete, the $A$-algebra map $A[x_1, \ldots, x_r] \to B$, $x_i \mapsto b_i$
extends to an $A$-algebra map $A[x_1, \ldots, x_r]^\wedge \to B$.
To finish the proof we have to show this map is surjective
which follows from Algebra, Lemma \ref{algebra-lemma-completion-generalities}
as our map $A[x_1, \ldots, x_r] \to B$ is surjective modulo $I$
and as $B = B^\wedge$.
\end{proof}

\noindent
We warn the reader that, in case $A$ is not Noetherian, the
quotient of an object of $\mathcal{C}'$ may not be an object
of $\mathcal{C}'$. See Examples, Lemma
\ref{examples-lemma-noncomplete-quotient}.
Next we show this does not happen when $A$ is Noetherian.

\begin{lemma}
\label{lemma-topologically-finite-type-Noetherian}
\begin{reference}
\cite[Proposition 7.5.5]{EGA1}
\end{reference}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. Then
\begin{enumerate}
\item every object of the category $\mathcal{C}'$
(\ref{equation-C-prime}) is Noetherian,
\item if $B \in \Ob(\mathcal{C}')$ and $J \subset B$ is an ideal,
then $B/J$ is an object of $\mathcal{C}'$,
\item for a finite type $A$-algebra $C$ the $I$-adic completion
$C^\wedge$ is in $\mathcal{C}'$,
\item in particular the completion $A[x_1, \ldots, x_r]^\wedge$
is in $\mathcal{C}'$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (4) follows from
Algebra, Lemma \ref{algebra-lemma-completion-Noetherian-Noetherian}
as $A[x_1, \ldots, x_r]$ is Noetherian
(Algebra, Lemma \ref{algebra-lemma-Noetherian-permanence}).
To see (1) by Lemma \ref{lemma-topologically-finite-type}
we reduce to the case of the completion of the polynomial ring
which we just proved.
Part (2) follows from Algebra, Lemma \ref{algebra-lemma-completion-tensor}
which tells us that ever finite $B$-module is $IB$-adically complete.
Part (3) follows in the same manner as part (4).
\end{proof}

\begin{remark}[Base change]
\label{remark-base-change}
Let $\varphi : A_1 \to A_2$ be a ring map and let
$I_i \subset A_i$ be ideals such that $\varphi(I_1^c) \subset I_2$
for some $c \geq 1$. This induces ring maps
$A_{1, cn} = A_1/I_1^{cn} \to A_2/I_2^n = A_{2, n}$ for all $n \geq 1$.
Let $\mathcal{C}_i$ be the category (\ref{equation-C}) for $(A_i, I_i)$.
There is a base change functor
\begin{equation}
\label{equation-base-change-systems}
\mathcal{C}_1 \longrightarrow \mathcal{C}_2,\quad
(B_n) \longmapsto (B_{cn} \otimes_{A_{1, cn}} A_{2, n})
\end{equation}
Let $\mathcal{C}_i'$ be the category (\ref{equation-C-prime}) for $(A_i, I_i)$.
If $I_2$ is finitely generated, then there is a base change functor
\begin{equation}
\label{equation-base-change-complete}
\mathcal{C}_1' \longrightarrow \mathcal{C}_2',\quad
B \longmapsto (B \otimes_{A_1} A_2)^\wedge
\end{equation}
because in this case the completion is complete
(Algebra, Lemma \ref{algebra-lemma-hathat-finitely-generated}).
If both $I_1$ and $I_2$ are finitely generated, then
the two base change functors agree via the functors
(\ref{equation-from-complete-to-systems})
which are equivalences by Lemma \ref{lemma-topologically-finite-type}.
\end{remark}

\begin{remark}[Base change by closed immersion]
\label{remark-take-bar}
Let $A$ be a Noetherian ring and $I \subset A$ an ideal.
Let $\mathfrak a \subset A$ be an ideal. Denote $\bar A = A/\mathfrak a$.
Let $\bar I \subset \bar A$ be an ideal such that
$I^c \bar A \subset \bar I$ and $\bar I^d \subset I\bar A$
for some $c, d \geq 1$. In this case the base change functor
(\ref{equation-base-change-complete}) for $(A, I)$ to $(\bar A, \bar I)$
is given by $B \mapsto \bar B = B/\mathfrak aB$. Namely, we have
\begin{equation}
\label{equation-base-change-to-closed}
\bar B = (B \otimes_A \bar A)^\wedge = (B/\mathfrak a B)^\wedge =
B/\mathfrak a B
\end{equation}
the last equality because any finite $B$-module is $I$-adically complete by
Algebra, Lemma \ref{algebra-lemma-completion-tensor}
and if annihilated by $\mathfrak a$ also $\bar I$-adically complete by
Algebra, Lemma \ref{algebra-lemma-change-ideal-completion}.
\end{remark}







\section{A naive cotangent complex}
\label{section-naive-cotangent-complex}

\noindent
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B$ be an $A$-algebra which is $I$-adically complete such
that $A/I \to B/IB$ is of finite type, i.e., an object of
(\ref{equation-C-prime}).
By Lemma \ref{lemma-topologically-finite-type-Noetherian} we can write
$$
B = A[x_1, \ldots, x_r]^\wedge / J
$$
for some finitely generated ideal $J$. For a choice of presentation as
above we define the {\it naive cotangent complex}
in this setting by the formula
\begin{equation}
\label{equation-NL}
\NL_{B/A}^\wedge = (J/J^2 \longrightarrow \bigoplus B\text{d}x_i)
\end{equation}
with terms sitting in degrees $-1$ and $0$
where the map sends the residue class of $g \in J$ to the differential
$\text{d}g = \sum (\partial g/\partial x_i) \text{d}x_i$. Here
the partial derivative is taken by thinking of $g$ as a power series.
The following lemma shows that $\NL_{B/A}^\wedge$ is well defined
up to homotopy.

\begin{lemma}
\label{lemma-NL-up-to-homotopy}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B$ be an object of (\ref{equation-C-prime}). The naive
cotangent complex $\NL_{B/A}^\wedge$ is well defined in $K(B)$.
\end{lemma}

\begin{proof}
The lemma signifies that given a second presentation
$B = A[y_1, \ldots, y_s]^\wedge / K$ the complexes of $B$-modules
$$
(J/J^2 \to B\text{d}x_i)
\quad\text{and}\quad
(K/K^2 \to \bigoplus B\text{d}y_j)
$$
are homotopy equivalent. To see this, we can argue exactly as in
the proof of Algebra, Lemma \ref{algebra-lemma-NL-homotopy}.

\medskip\noindent
Step 1. If we choose $g_i(y_1, \ldots, y_s) \in A[y_1, \ldots, y_s]^\wedge$
mapping to the image of $x_i$ in $B$, then we obtain a (unique) continuous
$A$-algebra homomorphism
$$
A[x_1, \ldots, x_r]^\wedge \to A[y_1, \ldots, y_s]^\wedge,\quad
x_i \mapsto g_i(y_1, \ldots, y_s)
$$
compatible with the given surjections to $B$. Such a map is called
a morphism of presentations. It induces a map from $J$ into $K$
and hence induces a $B$-module map $J/J^2 \to K/K^2$. Sending
$\text{d}x_i$ to $\sum (\partial g_i/\partial y_j)\text{d}y_j$
we obtain a map of complexes
$$
(J/J^2 \to \bigoplus B\text{d}x_i)
\longrightarrow
(K/K^2 \to \bigoplus B\text{d}y_j)
$$
Of course we can do the same thing with the roles of the two presentations
exchanged to get a map of complexes in the other direction.

\medskip\noindent
Step 2. The construction above is compatible with compositions of morphsms
of presentations. Hence to finish the proof it suffices to show: given
$g_i(x_1, \ldots, x_r) \in A[x_1, \ldots, x_n]^\wedge$
mapping to the image of $x_i$ in $B$, the induced map of complexes
$$
(J/J^2 \to \bigoplus B\text{d}x_i)
\longrightarrow
(J/J^2 \to \bigoplus B\text{d}x_i)
$$
is homotopic to the identity map. To see this consider the map
$h : \bigoplus B \text{d}x_i \to J/J^2$ given by the rule
$\text{d}x_i \mapsto g_i(x_1, \ldots, x_n) - x_i$ and compute.
\end{proof}

\begin{lemma}
\label{lemma-NL-is-completion}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $A \to B$ be a finite type ring map. Choose a presentation
$\alpha : A[x_1, \ldots, x_n] \to B$. Then
$\NL_{B^\wedge/A}^\wedge = \lim \NL(\alpha) \otimes_B B^\wedge$
as complexes and
$\NL_{B^\wedge/A}^\wedge = \NL_{B/A} \otimes_B^\mathbf{L} B^\wedge$
in $D(B^\wedge)$.
\end{lemma}

\begin{proof}
The statement makes sense as $B^\wedge$ is an object of
(\ref{equation-C-prime}) by
Lemma \ref{lemma-topologically-finite-type-Noetherian}.
Let $J = \Ker(\alpha)$. The functor of taking
$I$-adic completion is exact on finite modules over
$A[x_1, \ldots, x_n]$ and agrees with the functor
$M \mapsto M \otimes_{A[x_1, \ldots, x_n]} A[x_1, \ldots, x_n]^\wedge$, see
Algebra, Lemmas \ref{algebra-lemma-completion-tensor} and
\ref{algebra-lemma-completion-flat}. Moreover, the ring maps
$A[x_1, \ldots, x_n] \to A[x_1, \ldots, x_n]^\wedge$
and $B \to B^\wedge$ are flat. Hence
$B^\wedge = A[x_1, \ldots, x_n]^\wedge / J^\wedge$ and
$$
(J/J^2) \otimes_B B^\wedge = (J/J^2)^\wedge = J^\wedge/(J^\wedge)^2
$$
Since $\NL(\alpha) = (J/J^2 \to \bigoplus B\text{d}x_i)$,
see Algebra, Section \ref{algebra-section-netherlander},
we conclude the complex $\NL_{B^\wedge/A}^\wedge$ is equal
to $\NL(\alpha) \otimes_B B^\wedge$. The final statement
follows as $\NL_{B/A}$ is homotopy equivalent to $\NL(\alpha)$
and because the ring map $B \to B^\wedge$ is flat (so derived
base change along $B \to B^\wedge$ is just base change).
\end{proof}

\begin{lemma}
\label{lemma-NL-is-limit}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B$ be an object of (\ref{equation-C-prime}). Then
\begin{enumerate}
\item the pro-objects
$\{\NL_{B/A}^\wedge \otimes_B B/I^nB\}$ and $\{\NL_{B_n/A_n}\}$
of $D(B)$ are strictly isomorphic (see proof for elucidation),
\item $\NL_{B/A}^\wedge = R\lim \NL_{B_n/A_n}$ in $D(B)$.
\end{enumerate}
Here $B_n$ and $A_n$ are as in Section \ref{section-two-categories}.
\end{lemma}

\begin{proof}
The statement means the following: for every $n$ we have a well
defined complex $\NL_{B_n/A_n}$ of $B_n$-modules and we have
transition maps $\NL_{B_{n + 1}/A_{n + 1}} \to \NL_{B_n/A_n}$.
See Algebra, Section \ref{algebra-section-netherlander}.
Thus we can consider
$$
\ldots \to \NL_{B_3/A_3} \to \NL_{B_2/A_2} \to \NL_{B_1/A_1}
$$
as an inverse system of complexes of $B$-modules and a fortiori as
an inverse system in $D(B)$. Furthermore $R\lim \NL_{B_n/A_n}$
is a homotopy limit of this inverse system, see
Derived Categories, Section \ref{derived-section-derived-limit}.

\medskip\noindent
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge / J$. This
defines presentations
$$
B_n = B/I^nB = A_n[x_1, \ldots, x_r]/J_n
$$
where
$$
J_n = JA_n[x_1, \ldots, x_r] =
J/(J \cap I^nA[x_1, \ldots, x_r]^\wedge)
$$
The two term complex $J_n/J_n^2 \longrightarrow \bigoplus B_n \text{d}x_i$
represents $\NL_{B_n/A_n}$, see
Algebra, Section \ref{algebra-section-netherlander}.
By Artin-Rees (Algebra, Lemma \ref{algebra-lemma-Artin-Rees})
in the Noetherian ring $A[x_1, \ldots, x_r]^\wedge$
(Lemma \ref{lemma-topologically-finite-type-Noetherian})
we find a $c \geq 0$ such that we have canonical surjections
$$
J/I^nJ \to J_n \to J/I^{n - c}J \to J_{n - c},\quad n \geq c
$$
for all $n \geq c$. A moment's thought shows that these maps are
compatible with differentials and we obtain maps of complexes
$$
\NL_{B/A}^\wedge \otimes_B B/I^nB \to
\NL_{B_n/A_n} \to
\NL_{B/A}^\wedge \otimes_B B/I^{n - c}B \to
\NL_{B_{n - c}/A_{n - c}}
$$
compatible with the transition maps of the inverse systems
$\{\NL_{B/A}^\wedge \otimes_B B/I^nB\}$ and $\{\NL_{B_n/A_n}\}$.
This proves part (1) of the lemma.

\medskip\noindent
By part (1) and since pro-isomorphic
systems have the same $R\lim$ in order to prove (2)
it suffices to show that $\NL_{B/A}^\wedge$ is
equal to $R\lim \NL_{B/A}^\wedge \otimes_B B/I^nB$.
However, $\NL_{B/A}^\wedge$ is a two term complex $M^\bullet$
of finite $B$-modules which are $I$-adically complete for example by
Algebra, Lemma \ref{algebra-lemma-completion-tensor}. Hence
$M^\bullet = \lim M^\bullet/I^nM^\bullet = R\lim M^\bullet/I^n M^\bullet$, see
More on Algebra, Lemma \ref{more-algebra-lemma-compute-Rlim-modules} and
Remark \ref{more-algebra-remark-how-unique}.
\end{proof}

\begin{lemma}
\label{lemma-NL-base-change}
Let $(A_1, I_1) \to (A_2, I_2)$ be as in
Remark \ref{remark-base-change} with $A_1$ and $A_2$ Noetherian.
Let $B_1$ be in (\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$. Then there is a canonical map
$$
\NL_{B_1/A_1} \otimes_{B_2} B_1 \to \NL_{B_2/A_2}
$$
which induces and isomorphism on $H^0$ and a surjection on $H^{-1}$.
\end{lemma}

\begin{proof}
Choose a presentation $B_1 = A_1[x_1, \ldots, x_r]^\wedge/J_1$.
Since
$A_2/I_2^n[x_1, \ldots, x_r] =
A_1/I_1^{cn}[x_1, \ldots, x_r] \otimes_{A_1/I_1^{cn}} A_2/I_2^n$
we have
$$
A_2[x_1, \ldots, x_r]^\wedge =
(A_1[x_1, \ldots, x_r]^\wedge \otimes_{A_1} A_2)^\wedge
$$
where we use $I_2$-adic completion on both sides (but of course
$I_1$-adic completion for $A_1[x_1, \ldots, x_r]^\wedge$).
Set $J_2 = J_1 A_2[x_1, \ldots, x_r]^\wedge$. Arguing similarly
we get the presentation
\begin{align*}
B_2
& =
(B_1 \otimes_{A_1} A_2)^\wedge \\
& =
\lim \frac{A_1/I_1^{cn}[x_1, \ldots, x_r]}{J_1(A_1/I_1^{cn}[x_1, \ldots, x_r])}
\otimes_{A_1/I_1^{cn}} A_2/I_2^n \\
& =
\lim \frac{A_2/I_2^n[x_1, \ldots, x_r]}{J_2(A_2/I_2^n[x_1, \ldots, x_r])} \\
& =
A_2[x_1, \ldots, x_r]^\wedge/J_2
\end{align*}
for $B_2$ over $A_2$. As a consequence obtain a commutative diagram
$$
\xymatrix{
\NL^\wedge_{B_1/A_1} : \ar[d] &
J_1/J_1^2 \ar[r]_-{\text{d}} \ar[d] & \bigoplus B_1\text{d}x_i \ar[d] \\
\NL^\wedge_{B_2/A_2} : &
J_2/J_2^2 \ar[r]^-{\text{d}} & \bigoplus B_2\text{d}x_i
}
$$
The induced arrow $J_1/J_1^2 \otimes_{B_1} B_2 \to J_2/J_2^2$
is surjective because $J_2$ is generated by the image of $J_1$.
This determines the arrow displayed in the lemma. We omit the proof
that this arrow is well defined up to homotopy (i.e., indepedent
of the choice of the presentations up to homotopy). The statement
about the induced map on cohomology modules follows easily
from the discussion (details omitted).
\end{proof}

\begin{lemma}
\label{lemma-exact-sequence-NL}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B \to C$ be morphism of (\ref{equation-C-prime}). Then
there is an exact sequence
$$
\xymatrix{
C \otimes_B H^0(\NL_{B/A}^\wedge) \ar[r] &
H^0(\NL_{C/A}^\wedge) \ar[r] &
H^0(\NL_{C/B}^\wedge) \ar[r] & 0 \\
H^{-1}(\NL_{B/A}^\wedge \otimes_B C) \ar[r] &
H^{-1}(\NL_{C/A}^\wedge) \ar[r] &
H^{-1}(\NL_{C/B}^\wedge) \ar[llu]
}
$$
See proof for elucidation.
\end{lemma}

\begin{proof}
Observe that taking the tensor product $\NL_{B/A}^\wedge \otimes_B C$
makes sense as $\NL_{B/A}^\wedge$ is well defined up to homotopy by
Lemma \ref{lemma-NL-up-to-homotopy}.
Also, $(B, IB)$ is pair where $B$ is a Noetherian ring
(Lemma \ref{lemma-topologically-finite-type-Noetherian})
and $C$ is in the corresponding category (\ref{equation-C-prime}).
Thus all the terms in the $6$-term sequence are (well) defined.

\medskip\noindent
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$.
Choose a presentation $C = B[y_1, \ldots, y_s]^\wedge/J'$.
Combinging these presentations gives a presentation
$$
C = A[x_1, \ldots, x_r, y_1, \ldots, y_s]^\wedge/K
$$
Then the reader verifies that we obtain a commutative diagram
$$
\xymatrix{
0 \ar[r] &
\bigoplus C \text{d}x_i \ar[r] &
\bigoplus C \text{d}x_i \oplus \bigoplus C \text{d}y_j \ar[r] &
\bigoplus C \text{d}y_j \ar[r] &
0 \\
&
J/J^2 \otimes_B C \ar[r] \ar[u] &
K/K^2 \ar[r] \ar[u] &
J'/(J')^2 \ar[r] \ar[u] &
0
}
$$
with exact rows. Note that the vertical arrow on the left hand side
is the tensor product of the arrow defining $\NL_{B/A}^\wedge$ with
$\text{id}_C$. The lemma follows by applying the snake lemma
(Algebra, Lemma \ref{algebra-lemma-snake}).
\end{proof}

\begin{lemma}
\label{lemma-transitive-lci-at-end}
With assumptions as in Lemma \ref{lemma-exact-sequence-NL}
assume that $B/I^nB \to C/I^nC$ is a local complete intersection
homomorphism for all $n$. Then
$H^{-1}(\NL_{B/A}^\wedge \otimes_B C) \to H^{-1}(\NL_{C/A}^\wedge)$
is injective.
\end{lemma}

\begin{proof}
For each $n \geq 1$ we set $A_n = A/I^n$, $B_n = B/I^nB$, and
$C_n = C/I^nC$. We have
\begin{align*}
H^{-1}(\NL_{B/A}^\wedge \otimes_B C)
& =
\lim H^{-1}(\NL_{B/A}^\wedge \otimes_B C_n) \\
& =
\lim H^{-1}(\NL_{B/A}^\wedge \otimes_B B_n \otimes_{B_n} C_n) \\
& =
\lim H^{-1}(\NL_{B_n/A_n} \otimes_{B_n} C_n)
\end{align*}
The first equality follows from
More on Algebra, Lemma \ref{more-algebra-lemma-consequence-Artin-Rees}
and the fact that $H^{-1}(\NL_{B/A}^\wedge \otimes_B C)$ is a finite
$C$-module and hence $I$-adically complete for example by
Algebra, Lemma \ref{algebra-lemma-completion-tensor}.
The second equality is trivial.
The third holds by Lemma \ref{lemma-NL-is-limit}.
The maps $H^{-1}(\NL_{B_n/A_n} \otimes_{B_n} C_n) \to
H^{-1}(\NL_{C_n/A_n})$ are injective by
More on Algebra, Lemma \ref{more-algebra-lemma-transitive-lci-at-end}.
The proof is finished because we also have
$H^{-1}(\NL_{C/A}^\wedge) = \lim H^{-1}(\NL_{C_n/A_n})$
similarly to the above.
\end{proof}









\section{Rig-smooth homomorphisms}
\label{section-rig-smooth}

\noindent
As motivation for the following definition, please take a look at
More on Algebra, Remark \ref{more-algebra-remark-smoothness-ext-1-zero}.

\begin{definition}
\label{definition-rig-smooth-homomorphism}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}). We say
$B$ is {\it rig-smooth over $(A, I)$} if there exists an integer $c \geq 0$
such that $I^c$ annihilates $\Ext^1_B(\NL_{B/A}^\wedge, N)$ for every
$B$-module $N$.
\end{definition}

\noindent
Let us work out what this means.

\begin{lemma}
\label{lemma-equivalent-with-artin-smooth}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}). Write
$B = A[x_1, \ldots, x_r]^\wedge/J$
(Lemma \ref{lemma-topologically-finite-type-Noetherian})
and let $\NL_{B/A}^\wedge = (J/J^2 \to \bigoplus B\text{d}x_i)$
be its naive cotangent complex (\ref{equation-NL}).
The following are equivalent
\begin{enumerate}
\item $B$ is rig-smooth over $(A, I)$,
\item the object $\NL_{B/A}^\wedge$ of $D(B)$ satisfies the equivalent
conditions (1) -- (4) of More on Algebra, Lemma
\ref{more-algebra-lemma-ext-1-annihilated} with respect to the ideal $IB$,
\item there exists a $c \geq 0$ such that for all $a \in I^c$
there is a map $h : \bigoplus B\text{d}x_i \to J/J^2$ such that
$a : J/J^2 \to J/J^2$ is equal to $h \circ \text{d}$,
\item there exist $b_1, \ldots, b_s \in B$ such that
$V(b_1, \ldots, b_s) \subset V(IB)$ and such that for every
$l = 1, \ldots, s$ there exist $m \geq 0$, $f_1, \ldots, f_m \in J$,
and subset $T \subset \{1, \ldots, n\}$ with $|T| = m$ such that
\begin{enumerate}
\item $\det_{i \in T, j \leq m}(\partial f_j/ \partial x_i)$
divides $b_l$ in $B$, and
\item $b_l J \subset (f_1, \ldots, f_m) + J^2$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1), (2), and (3) is immediate from
More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated}.

\medskip\noindent
Assume $b_1, \ldots, b_s$ are as in (4). Since $B$ is Noetherian the inclusion
$V(b_1, \ldots, b_s) \subset V(IB)$ implies $I^cB \subset (b_1, \ldots, b_s)$
for some $c \geq 0$ (for example by
Algebra, Lemma \ref{algebra-lemma-Noetherian-power-ideal-kills-module}).
Pick $1 \leq l \leq s$ and $m \geq 0$ and $f_1, \ldots, f_m \in J$
and $T \subset \{1, \ldots, n\}$ with $|T| = m$ satisfying (4)(a) and (b).
Then if we invert $b_l$ we see that
$$
\NL_{B/A}^\wedge \otimes_B B_{b_l} =
\left(
\bigoplus\nolimits_{j \leq m} B_{b_l} f_j
\longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n} B_{b_l} \text{d}x_i
\right)
$$
and moreover the arrow is isomorphic to the inclusion of the direct
summand $\bigoplus_{i \in T} B_{b_l} \text{d}x_i$. We conclude that
$H^{-1}(\NL_{B/A}^\wedge)$ is $b_l$-power torsion and that
$H^0(\NL_{B/A}^\wedge)$ becomes finite free after inverting $b_l$.
Combined with the inclusion $I^cB \subset (b_1, \ldots, b_s)$
we see that $H^{-1}(\NL_{B/A}^\wedge)$ is $IB$-power torsion.
Hence we see that condition (4) of
More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated}
holds. In this way we see that (4) implies (2).

\medskip\noindent
Assume the equivalent conditions (1), (2), and (3) hold. We will prove
that (4) holds, but we strongly urge the reader to convince themselves
of this. The complex $\NL_{B/A}^\wedge$ determines an object of
$D^b_{\textit{Coh}}(\Spec(B))$ whose restriction to the Zariski open
$U = \Spec(B) \setminus V(IB)$ is a finite locally free module
$\mathcal{E}$ placed in degree $0$ (this follows for example from the
the fourth equivalent condition in
More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated}).
Choose generators $f_1, \ldots, f_M$ for $J$.
This determines an exact sequence
$$
\bigoplus\nolimits_{j = 1, \ldots, M} \mathcal{O}_U \cdot f_j \to
\bigoplus\nolimits_{i = 1, \ldots, n} \mathcal{O}_U \cdot \text{d}x_i \to
\mathcal{E} \to 0
$$
Let $U = \bigcup_{l = 1, \ldots, s} U_l$
be a finite affine open covering such that
$\mathcal{E}|_{U_l}$ is free of rank $r_l = n - m_l$ for some integer
$n \geq m_l \geq 0$. After replacing
each $U_l$ by an affine open covering we may assume there exists
a subset $T_l \subset \{1, \ldots, n\}$ such that the elements
$\text{d}x_i$, $i \in \{1, \ldots, n\} \setminus T_l$ map to a
basis for $\mathcal{E}|_{U_l}$. Repeating the argument, we may
assume there exists a subset $T'_l \subset \{1, \ldots, M\}$
of cardinality $m_l$ such that $f_j$, $j \in T'_l$ map to a basis
of the kernel of $\mathcal{O}_{U_l} \cdot \text{d}x_i \to
\mathcal{E}|_{U_l}$. Finally, since the open covering
$U = \bigcup U_l$ may be refined by a open covering by standard opens
(Algebra, Lemma \ref{algebra-lemma-Zariski-topology})
we may assume $U_l = D(g_l)$ for some $g_l \in B$.
In particular we have $V(g_1, \ldots, g_s) = V(IB)$.
A linear algebra argument using our choices above shows that
$\det_{i \in T_l, j \in T'_l}(\partial f_j/ \partial x_i)$
maps to an invertible element of $B_{b_l}$. Similarly, the vanishing
of cohomology of $\NL_{B/A}^\wedge$ in degree $-1$ over $U_l$ shows that
$J/J^2 + (f_j; j \in T')$ is annihilated by a power of $b_l$.
After replacing each $g_l$ by a suitable power we obtain
conditions (4)(a) and (4)(b) of the lemma. Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-rig-smooth}
Let $A$ be a Noetherian ring and let $I$ be an ideal.
Let $B$ be a finite type $A$-algebra.
\begin{enumerate}
\item If $\Spec(B) \to \Spec(A)$ is smooth over $\Spec(A) \setminus V(I)$,
then $B^\wedge$ is rig-smooth over $(A, I)$.
\item If $B^\wedge$ is rig-smooth over $(A, I)$,
then there exists $g \in 1 + IB$ such that $\Spec(B_g)$ is smooth
over $\Spec(A) \setminus V(I)$.
\end{enumerate}
\end{lemma}

\begin{proof}
We will use Lemma \ref{lemma-equivalent-with-artin-smooth}
without further mention.

\medskip\noindent
Assume (1). Recall that formation of $\NL_{B/A}$ commutes with
localization, see Algebra, Lemma \ref{algebra-lemma-localize-NL}.
Hence by the very definition of smooth ring maps (in terms of
the naive cotangent complex being quasi-isomorphic to a finite
projective module placed in degree $0$), we see that
$\NL_{B/A}$ satisfies the fourth equivalent condition
of More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated}
with respect to the ideal $IB$ (small detail omitted).
Since $\NL_{B^\wedge/A}^\wedge = \NL_{B/A} \otimes_B B^\wedge$
by Lemma \ref{lemma-NL-is-completion} we conclude (2) holds by
More on Algebra, Lemma
\ref{more-algebra-lemma-base-change-property-ext-1-annihilated}.

\medskip\noindent
Assume (2). Choose a presentation
$B = A[x_1, \ldots, x_n]/J$, set $N = J/J^2$, and
consider the element $\xi \in \Ext^1_B(\NL_{B/A}, J/J^2)$
determined by the identity map on $J/J^2$.
Using again that $\NL_{B^\wedge/A}^\wedge = \NL_{B/A} \otimes_B B^\wedge$
we find that our assumption implies the image
$$
\xi \otimes 1 \in
\Ext^1_{B^\wedge}(\NL_{B/A} \otimes_B B^\wedge, N \otimes_B B^\wedge) =
\Ext^1_{B^\wedge}(\NL_{B/A}, N) \otimes_B B^\wedge
$$
is annihilated by $I^c$ for some integer $c \geq 0$.
The equality holds for example by
More on Algebra, Lemma \ref{more-algebra-lemma-base-change-RHom}
(but can also easily be deduced from the much simpler
More on Algebra, Lemma
\ref{more-algebra-lemma-pseudo-coherence-and-base-change-ext}).
Thus $M = I^cB\xi \subset \Ext^1_B(\NL_{B/A}, N)$ is a finite submodule
which maps to zero in $\Ext^1_B(\NL_{B/A}, N) \otimes_B B^\wedge$.
Since $B \to B^\wedge$ is flat this means that
$M \otimes_B B^\wedge$ is zero. By 
Nakayama's lemma (Algebra, Lemma \ref{algebra-lemma-NAK})
this means that $M = I^cB\xi$ is annihilated by an element
of the form $g = 1 + x$ with $x \in IB$.
This implies that for every $b \in I^cB$ there is a
$B$-linear dotted arrow making the diagram commute
$$
\xymatrix{
J/J^2 \ar[r] \ar[d]^b & \bigoplus B\text{d}x_i \ar@{..>}[d]^h \\
J/J^2 \ar[r] & (J/J^2)_g
}
$$
Thus $(\NL_{B/A})_{gb}$ is quasi-isomorphic
to a finite projective module; small detail omitted.
Since $(\NL_{B/A})_{gb} = \NL_{B_{gb}/A}$ in $D(B_{gb})$
this shows that $B_{gb}$ is smooth over $\Spec(A)$.
As this holds for all $b \in I^cB$ we conclude
that $\Spec(B_g) \to \Spec(A)$ is smooth over $\Spec(A) \setminus V(I)$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-zero-ext-1-after-modding-out}
Let $(A_1, I_1) \to (A_2, I_2)$ be as in
Remark \ref{remark-base-change} with $A_1$ and $A_2$ Noetherian.
Let $B_1$ be in (\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$. Let $f_1 \in B_1$
with image $f_2 \in B_2$.
If $\Ext^1_{B_1}(\NL_{B_1/A_1}^\wedge, N_1)$ is annihilated
by $f_1$ for every $B_1$-module $N_1$, then
$\Ext^1_{B_2}(\NL_{B_2/A_2}^\wedge, N_2)$ is annihilated
by $f_2$ for every $B_2$-module $N_2$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-NL-base-change} there is a map
$$
\NL_{B_1/A_1} \otimes_{B_2} B_1 \to \NL_{B_2/A_2}
$$
which induces and isomorphism on $H^0$ and a surjection on $H^{-1}$.
Thus the result by More on Algebra, Lemmas
\ref{more-algebra-lemma-two-term-base-change},
\ref{more-algebra-lemma-base-change-property-ext-1-annihilated}, and
\ref{more-algebra-lemma-surjection-property-ext-1-annihilated}
the last two applied with the principal ideals $(f_1) \subset B_1$ and
$(f_2) \subset B_2$.
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-smooth-homomorphism}
Let $A_1 \to A_2$ be a map of Noetherian rings. Let $I_i \subset A_i$
be an ideal such that $V(I_1A_2) = V(I_2)$. Let $B_1$ be in
(\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$ as in
Remark \ref{remark-base-change}.
If $B_1$ is rig-smooth over $(A_1, I_1)$,
then $B_2$ is rig-smooth over $(A_2, I_2)$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-zero-ext-1-after-modding-out} and
Definition \ref{definition-rig-smooth-homomorphism}
and the fact that $I_2^c$ is contained in $I_1A_2$ for some $c \geq 0$
as $A_2$ is Noetherian.
\end{proof}













\section{Deformations of ring homomorphisms}
\label{section-defos-ring-maps}

\noindent
Some work on lifting ring homomorphisms from rig-smooth algebras.

\begin{remark}[Linear approximation]
\label{remark-linear-approximation}
Let $A$ be a ring and $I \subset A$ be a finitely generated ideal.
Let $C$ be an $I$-adically complete $A$-algebra.
Let $\psi : A[x_1, \ldots, x_r]^\wedge \to C$ be a continuous
$A$-algebra map. Suppose given $\delta_i \in C$, $i = 1, \ldots, r$.
Then we can consider
$$
\psi' : A[x_1, \ldots, x_r]^\wedge \to C,\quad
x_i \longmapsto \psi(x_i) + \delta_i
$$
see Formal Spaces, Remark \ref{formal-spaces-remark-universal-property}.
Then we have
$$
\psi'(g) = \psi(g) + \sum \psi(\partial g/\partial x_i)\delta_i + \xi
$$
with error term $\xi \in (\delta_i\delta_j)$. This follows by
writing $g$ as a power series and working term by term. Convergence
is automatic as the coefficients of $g$ tend to zero.
Details omitted.
\end{remark}

\begin{remark}[Lifting maps]
\label{remark-improve-homomorphism}
Let $A$ be a Noetherian ring and $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}).
Let $C$ be an $I$-adically complete $A$-algebra.
Let $\psi_n : B \to C/I^nC$ be an $A$-algebra homomorphism.
The obstruction to lifting $\psi_n$ to an $A$-algebra
homomorphism into $C/I^{2n}C$ is an element
$$
o(\psi_n) \in \Ext^1_B(\NL_{B/A}^\wedge, I^nC/I^{2n}C)
$$
as we will explain. Namely, choose a presentation
$B = A[x_1, \ldots, x_r]^\wedge/J$.
Choose a lift $\psi : A[x_1, \ldots, x_r]^\wedge \to C$ of $\psi_n$.
Since $\psi(J) \subset I^nC$ we get $\psi(J^2) \subset I^{2n}C$
and hence we get a $B$-linear homomorphism
$$
o(\psi) :
J/J^2 \longrightarrow I^nC/I^{2n}C, \quad g \longmapsto \psi(g)
$$
which of course extends to a $C$-linear map
$J/J^2 \otimes_B C \to I^nC/I^{2n}C$.
Since $\NL_{B/A}^\wedge = (J/J^2 \to \bigoplus B \text{d}x_i)$
we get $o(\psi_n)$ as the image of $o(\psi)$ by the identification
\begin{align*}
& \Ext^1_B(\NL_{B/A}^\wedge, I^nC/I^{2n}C) \\
& =
\Coker\left(\Hom_B(\bigoplus B\text{d}x_i, I^nC/I^{2n}C) \to
\Hom_B(J/J^2, I^nC/I^{2n}C)\right)
\end{align*}
See More on Algebra, Lemma
\ref{more-algebra-lemma-map-out-of-almost-free} part (1) for the equality.

\medskip\noindent
Suppose that $o(\psi_n)$ maps to zero in
$\Ext^1_B(\NL_{B/A}^\wedge, I^{n'}C/I^{2n'}C)$
for some integer $n'$ with $n > n' > n/2$. We claim that this means we can
find an $A$-algebra homomorphism $\psi'_{2n'} : B \to C/I^{2n'}C$
which agrees with $\psi_n$ as maps into $C/I^{n'}C$.
The extreme case $n' = n$ explains why we previously said
$o(\psi_n)$ is the obstruction to lifting $\psi_n$ to $C/I^{2n}C$.
Proof of the claim: the hypothesis that $o(\psi_n)$ maps to zero tells us
we can find a $B$-module map
$$
h : \bigoplus B\text{d}x_i \longrightarrow I^{n'}C/I^{2n'}C
$$
such that $o(\psi)$ and $h \circ \text{d}$ agree as maps
into $I^{n'}C/I^{2n'}C$. Say $h(\text{d}x_i) = \delta_i \bmod I^{2n'}C$
for some $\delta_i \in I^{n'}C$. Then we look at the map
$$
\psi' : A[x_1, \ldots, x_r]^\wedge \to C,\quad
x_i \longmapsto \psi(x_i) - \delta_i
$$
A computation with power series
shows that $\psi'(J) \subset I^{2n'}C$. Namely, for $g \in J$ we get
$$
\psi'(g) \equiv
\psi(g) - \sum \psi(\partial g/\partial x_i)\delta_i \equiv
o(\psi)(g) - (h \circ \text{d})(g) \equiv
0 \bmod I^{2n'}C
$$
See Remark \ref{remark-linear-approximation} for the first equality.
Hence $\psi'$ induces an $A$-algebra homomorphism
$\psi'_{2n'} : B \to C/I^{2n'}C$ as desired.
\end{remark}

\begin{lemma}
\label{lemma-get-morphism-general-better}
Assume given the following data
\begin{enumerate}
\item an integer $c \geq 0$,
\item an ideal $I$ of a Noetherian ring $A$,
\item $B$ in (\ref{equation-C-prime}) for $(A, I)$ such that
$I^c$ annihilates $\Ext^1_B(\NL_{B/A}^\wedge, N)$
for any $B$-module $N$,
\item a Noetherian $I$-adically complete $A$-algebra $C$; denote
$d = d(\text{Gr}_I(C))$ and $q_0 = q(\text{Gr}_I(C))$ the integers found in
Local Cohomology, Section \ref{local-cohomology-section-uniform},
\item an integer $n \geq \max(q_0 + (d + 1)c, 2(d + 1)c + 1)$, and
\item an $A$-algebra homomorphism $\psi_n : B \to C/I^nC$.
\end{enumerate}
Then there exists a map $\varphi : B \to C$ of $A$-algebras such
that $\psi_n \bmod I^{n - (d + 1)c} = \varphi \bmod I^{n - (d + 1)c}$.
\end{lemma}

\begin{proof}
Consider the obstruction class
$$
o(\psi_n) \in \Ext^1_B(\NL_{B/A}^\wedge, I^nC/I^{2n}C)
$$
of Remark \ref{remark-improve-homomorphism}. For any $C/I^nC$-module
$N$ we have
\begin{align*}
\Ext^1_B(\NL_{B/A}^\wedge, N)
& =
\Ext^1_{C/I^nC}(\NL_{B/A}^\wedge \otimes_B^\mathbf{L} C/I^nC, N) \\
& =
\Ext^1_{C/I^nC}(\NL_{B/A}^\wedge \otimes_B C/I^nC, N)
\end{align*}
The first equality by
More on Algebra, Lemma \ref{more-algebra-lemma-upgrade-adjoint-tensor-RHom}
and the second one by
More on Algebra, Lemma \ref{more-algebra-lemma-two-term-base-change}.
In particular, we see that
$\Ext^1_{C/I^nC}(\NL_{B/A}^\wedge \otimes_B C/I^nC, N)$ is annihilated by
$I^cC$ for all $C/I^nC$-modules $N$.
It follows that we may apply
Local Cohomology, Lemma \ref{local-cohomology-lemma-bound-two-term-complex}
to see that $o(\psi_n)$ maps to zero in
$$
\Ext^1_{C/I^nC}(\NL_{B/A}^\wedge \otimes_B C/I^nC, I^{n'}C/I^{2n'}C) =
\Ext^1_B(\NL_{B/A}^\wedge, I^{n'}C/I^{2n'}C) =
$$
where $n' = n - (d + 1)c$. By the discussion in
Remark \ref{remark-improve-homomorphism} we obtain a map
$$
\psi'_{2n'} : B \to C/I^{2n'}C
$$
which agrees with $\psi_n$ modulo $I^{n'}$.
Observe that $2n' > n$ because $n \geq 2(d + 1)c + 1$.

\medskip\noindent
We may repeat this procedure. Starting with $n_0 = n$ and
$\psi^0 = \psi_n$ we end up getting a strictly increasing
sequence of integers
$$
n_0 < n_1 < n_2 < \ldots
$$
and $A$-algebra homorphisms $\psi^i : B \to C/I^{n_i}C$
such that $\psi^{i + 1}$ and $\psi^i$ agree modulo $I^{n_i - tc}$.
Since $C$ is $I$-adically complete we can take $\varphi$
to be the limit of the maps
$\psi^i \bmod I^{n_i - (d + 1)c} : B \to C/I^{n_i - (d + 1)c}C$
and the lemma follows.
\end{proof}

\noindent
We suggest the reader skip ahead to the next section. Namely, the following
two lemmas are consequences of the result above if the algebra $C$ in them
is assumed Noetherian.

\begin{lemma}
\label{lemma-get-morphism-nonzerodivisor}
Let $I = (a)$ be a principal ideal of a Noetherian ring $A$.
Let $B$ be an object of (\ref{equation-C-prime}).
Assume given an integer $c \geq 0$ such that $\Ext^1_B(\NL_{B/A}^\wedge, N)$
is annihilated by $a^c$ for all $B$-modules $N$.
Let $C$ be an $I$-adically complete $A$-algebra such that
$a$ is a nonzerodivisor on $C$. Let $n > 2c$. For any $A$-algebra
map $\psi_n : B \to C/a^nC$ there exists an $A$-algebra
map $\varphi : B \to C$ such that
$\psi_n \bmod a^{n - c}C = \varphi \bmod a^{n - c}C$.
\end{lemma}

\begin{proof}
Consider the obstruction class
$$
o(\psi_n) \in \Ext^1_B(\NL_{B/A}^\wedge, a^nC/a^{2n}C)
$$
of Remark \ref{remark-improve-homomorphism}. Since $a$ is a nonzerodivisor
on $C$ the map $a^c : a^nC/a^{2n}C \to a^nC/a^{2n}C$ is isomorphic to the
map $a^nC/a^{2n}C \to a^{n - c}C/a^{2n - c}C$ in the category of $C$-modules.
Hence by our assumption on $\NL_{B/A}^\wedge$
we conclude that the class $o(\psi_n)$ maps to zero in
$$
\Ext^1_B(\NL_{B/A}^\wedge, a^{n - c}C/a^{2n - c}C)
$$
and a fortiori in
$$
\Ext^1_B(\NL_{B/A}^\wedge, a^{n - c}C/a^{2n - 2c}C)
$$
By the discussion in Remark \ref{remark-improve-homomorphism} we obtain a map
$$
\psi_{2n - 2c} : B \to C/a^{2n - 2c}C
$$
which agrees with $\psi_n$ modulo $a^{n - c}C$.
Observe that $2n - 2c > n$ because $n > 2c$.

\medskip\noindent
We may repeat this procedure. Starting with $n_0 = n$ and
$\psi^0 = \psi_n$ we end up getting a strictly increasing
sequence of integers
$$
n_0 < n_1 < n_2 < \ldots
$$
and $A$-algebra homorphisms $\psi^i : B \to C/a^{n_i}C$
such that $\psi^{i + 1}$ and $\psi^i$ agree modulo $a^{n_i - c}C$.
Since $C$ is $I$-adically complete we can take $\varphi$
to be the limit of the maps
$\psi^i \bmod a^{n_i - c}C : B \to C/a^{n_i - c}C$
and the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-get-morphism-principal}
Let $I = (a)$ be a principal ideal of a Noetherian ring $A$.
Let $B$ be an object of (\ref{equation-C-prime}).
Assume given an integer $c \geq 0$ such that $\Ext^1_B(\NL_{B/A}^\wedge, N)$
is annihilated by $a^c$ for all $B$-modules $N$.
Let $C$ be an $I$-adically complete $A$-algebra.
Assume given an integer $d \geq 0$ such that $C[a^\infty] \cap a^dC = 0$.
Let $n > \max(2c, c + d)$. For any $A$-algebra map
$\psi_n : B \to C/a^nC$ there exists an $A$-algebra map
$\varphi : B \to C$ such
that $\psi_n \bmod a^{n - c} = \varphi \bmod a^{n - c}$.
\end{lemma}

\noindent
If $C$ is Noetherian we have $C[a^\infty] = C[a^e]$ for some
$e \geq 0$. By Artin-Rees (Algebra, Lemma \ref{algebra-lemma-Artin-Rees})
there exists an integer $f$ such that
$a^nC \cap C[a^\infty] \subset a^{n - f}C[a^\infty]$ for all $n \geq f$.
Then $d = e + f$ is an integer as in the lemma. This argument
works in particular if $C$ is an object of (\ref{equation-C-prime})
by Lemma \ref{lemma-topologically-finite-type-Noetherian}.

\begin{proof}
Let $C \to C'$ be the quotient of $C$ by $C[a^\infty]$. The $A$-algebra
$C'$ is $I$-adically complete by
Algebra, Lemma \ref{algebra-lemma-quotient-complete}
and the fact that $\bigcap (C[a^\infty] + a^nC) = C[a^\infty]$
because for $n \geq d$ the sum $C[a^\infty] + a^nC$ is direct.
For $m \geq d$ the diagram
$$
\xymatrix{
0 \ar[r] &
C[a^\infty] \ar[r] \ar[d] &
C \ar[r] \ar[d] & C' \ar[r] \ar[d] & 0 \\
0 \ar[r] &
C[a^\infty] \ar[r] &
C/a^m C \ar[r] & C'/a^m C' \ar[r] & 0
}
$$
has exact rows. Thus $C$ is the fibre product of $C'$ and
$C/a^mC$ over $C'/a^mC'$ for all $m \geq d$. By
Lemma \ref{lemma-get-morphism-nonzerodivisor}
we can choose a homomorphism $\varphi' : B \to C'$
such that $\varphi'$ and $\psi_n$ agree as maps into $C'/a^{n - c}C'$.
We obtain a homomorphism $(\varphi', \psi_n \bmod a^{n - c}C) : B \to
C' \times_{C'/a^{n - c}C'} C/a^{n - c}C$.
Since $n - c \geq d$ this is the same thing as a homomorphism
$\varphi : B \to C$. This finishes the proof.
\end{proof}










\section{Algebraization of rig-smooth algebras over G-rings}
\label{section-over-G-ring}

\noindent
If the base ring $A$ is a Noetherian G-ring, then we can
prove \cite[III Theorem 7]{Elkik} for arbitrary rig-smooth
algebras with respect to any ideal $I \subset A$ (not necessarily
principal).

\begin{lemma}
\label{lemma-close-enough}
Let $I$ be an ideal of a Noetherian ring $A$. Let $r \geq 0$
and write $P = A[x_1, \ldots, x_r]$ the $I$-adic completion.
Consider a resolution
$$
P^{\oplus t} \xrightarrow{K} P^{\oplus m}
\xrightarrow{g_1, \ldots, g_m} P \to B \to 0
$$
of a quotient of $P$. Assume $B$ is rig-smooth over $(A, I)$.
Then there exists an integer $n$ such that for any complex
$$
P^{\oplus t} \xrightarrow{K'} P^{\oplus m}
\xrightarrow{g'_1, \ldots, g'_m} P
$$
with $g_i - g'_i \in I^nP$ and $K - K' \in I^n\text{Mat}(m \times t, P)$
there exists an isomorphism $B \to B'$ of $A$-algebras where
$B' = P/(g'_1, \ldots, g'_m)$.
\end{lemma}

\begin{proof}
(A) By Definition \ref{definition-rig-smooth-homomorphism}
we can choose a $c \geq 0$ such that $I^c$ annihilates
$\Ext^1_B(\NL_{B/A}^\wedge, N)$ for all $B$-modules $N$.

\medskip\noindent
(B) By More on Algebra, Lemmas \ref{more-algebra-lemma-approximate-complex} and
\ref{more-algebra-lemma-approximate-complex-graded}
there exists a constant $c_1 = c(g_1, \ldots, g_m, K)$
such that for $n \geq c_1 + 1$ the complex
$$
P^{\oplus t} \xrightarrow{K'} P^{\oplus m}
\xrightarrow{g'_1, \ldots, g'_m} P \to B' \to 0
$$
is exact and $\text{Gr}_I(B) \cong \text{Gr}_I(B')$.

\medskip\noindent
(C) Let $d_0 = d(\text{Gr}_I(B))$ and $q_0 = q(\text{Gr}_I(B))$
be the integers found in
Local Cohomology, Section \ref{local-cohomology-section-uniform}.

\medskip\noindent
We claim that $n = \max(c_1 + 1, q_0 + (d_0 + 1)c, 2(d_0 + 1)c + 1)$
works where $c$ is as in (A), $c_1$ is as in (B), and $q_0, d_0$ are as
in (C).

\medskip\noindent
Let $g'_1, \ldots, g'_m$ and $K'$ be as in the lemma.
Since $g_i = g'_i \in I^nP$ we obtain a canonical
$A$-algebra homomorphism
$$
\psi_n : B \longrightarrow B'/I^nB'
$$
which induces an isomorphism $B/I^nB \to B'/I^nB'$. Since
$\text{Gr}_I(B) \cong \text{Gr}_I(B')$ we have
$d_0 = d(\text{Gr}_I(B'))$ and $q_0 = q(\text{Gr}_I(B'))$
and since $n \geq \max(q_0 + (1 + d_0)c, 2(d_0 + 1)c + 1)$
we may apply Lemma \ref{lemma-get-morphism-general-better}
to find an $A$-algebra homomorphism
$$
\varphi : B \longrightarrow B'
$$
such that
$\varphi \bmod I^{n - (d_0 + 1)c}B' = \psi_n \bmod I^{n - (d_0 + 1)c}B'$.
Since $n - (d_0 + 1)c > 0$ we see that $\varphi$ is an $A$-algebra
homomorphism which modulo $I$ induces the isomorphism $B/IB \to B'/IB'$
we found above.
The rest of the proof shows that these facts force $\varphi$
to be an isomorphism; we suggest the reader find their own proof of this.

\medskip\noindent
Namely, it follows that $\varphi$ is surjective for example by applying
Algebra, Lemma \ref{algebra-lemma-completion-generalities} part (1)
using the fact that $B$ and $B'$ are complete.
Thus $\varphi$ induces a surjection $\text{Gr}_I(B) \to \text{Gr}_I(B')$
which has to be an isomorphism because the source and target are
isomorphic Noetherian rings, see
Algebra, Lemma \ref{algebra-lemma-surjective-endo-noetherian-ring-is-iso}
(of course you can show $\varphi$ induces the isomorphism we found above
but that would need a tiny argument).
Thus $\varphi$ induces injective maps
$I^eB/I^{e + 1}B \to I^eB'/I^{e + 1}B'$ for all $e \geq 0$.
This implies $\varphi$ is injective since for any $b \in B$ there
exists an $e \geq 0$ such that $b \in I^eB$, $b \not \in I^{e + 1}B$
by Krull's intersection theorem (Algebra, Lemma
\ref{algebra-lemma-intersect-powers-ideal-module-zero}).
This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-algebraize-easy}
Let $I$ be an ideal of a Noetherian ring $A$. Let $C^h$ be the henselization
of a finite type $A$-algebra $C$ with respect to the ideal $IC$. Let
$J \subset C^h$ be an ideal. Then there exists a finite type $A$-algebra
$B$ such that $B^\wedge \cong (C^h/J)^\wedge$.
\end{lemma}

\begin{proof}
By More on Algebra, Lemma
\ref{more-algebra-lemma-henselization-Noetherian-pair}
the ring $C^h$ is Noetherian. Say $J = (g_1, \ldots, g_m)$.
The ring $C^h$ is a filtered colimit of \'etale $C$ algebras $C'$
such that $C/IC \to C'/IC'$ is an isomorphism
(see proof of More on Algebra, Lemma \ref{more-algebra-lemma-henselization}).
Pick an $C'$ such that $g_1, \ldots, g_m$ are the
images of $g'_1, \ldots, g'_m \in C'$.
Setting $B = C'/(g'_1, \ldots, g'_m)$ we get a finite
type $A$-algebra. Of course $(C, IC)$ and $C', IC')$ have
the same henselizations and the same completions.
It follows easily from this that $B^\wedge = (C^h/J)^\wedge$.
\end{proof}

\begin{proposition}
\label{proposition-approximate}
Let $I$ be an ideal of a Noetherian G-ring $A$. Let $B$ be an
object of (\ref{equation-C-prime}). If $B$ is rig-smooth
over $(A, I)$, then there exists a finite type $A$-algebra
$C$ and an isomorphism $B \cong C^\wedge$ of $A$-algebras.
\end{proposition}

\begin{proof}
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$. Write
$P = A[x_1, \ldots, x_r]^\wedge$. Choose generators $g_1, \ldots, g_m \in J$.
Choose generators $k_1, \ldots, k_t$ of the module
of relations between $g_1, \ldots, g_m$, i.e., such that
$$
P^{\oplus t} \xrightarrow{k_1, \ldots, k_t}
P^{\oplus m} \xrightarrow{g_1, \ldots, g_m}
P \to B \to 0
$$
is a resolution. Write $k_i = (k_{i1}, \ldots, k_{im})$ so that we have
\begin{equation}
\label{equation-relations-straight-up}
\sum\nolimits_j k_{ij}g_j = 0
\end{equation}
for $i = 1, \ldots, t$. Denote $K = (k_{ij})$ the $m \times t$-matrix
with entries $k_{ij}$.

\medskip\noindent
Let $A[x_1, \ldots, x_r]^h$ be the henselization of the
pair $(A[x_1, \ldots, x_r], IA[x_1, \ldots, x_r])$, see
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
We may and do think of $A[x_1, \ldots, x_r]^h$ as a subring
of $P = A[x_1, \ldots, x_r]^\wedge$, see
More on Algebra, Lemma
\ref{more-algebra-lemma-henselization-Noetherian-pair}.
Since $A$ is a Noetherian G-ring, so is $A[x_1, \ldots, x_r]$, see
More on Algebra, Proposition
\ref{more-algebra-proposition-finite-type-over-G-ring}.
Hence we have approximation for the map
$A[x_1, \ldots, x_r]^h \to A[x_1, \ldots, x_r]^\wedge = P$
with respect to the ideal generated by $I$, see
Smoothing Ring Maps, Lemma \ref{smoothing-lemma-henselian-pair}.
Choose a large enough integer $n$ as in Lemma \ref{lemma-close-enough}.
By the approximation property we may choose
$g'_1, \ldots, g'_m \in A[x_1, \ldots, x_r]^h$
and a matrix
$K' = (k'_{ij}) \in \text{Mat}(m \times t, A[x_1, \ldots, x_r]^h)$
such that $\sum\nolimits_j k'_{ij}g'_j = 0$ in
$A[x_1, \ldots, x_r]^h$ and such that
$g_i - g'_i \in I^nP$ and $K - K' \in I^n\text{Mat}(m \times t, P)$.
By our choice of $n$ we conclude that there is an isomorphism
$$
B \to P/(g'_1, \ldots, g'_m) =
\left(A[x_1, \ldots, x_r]^h/(g'_1, \ldots, g'_m)\right)^\wedge
$$
This finishes the proof by Lemma \ref{lemma-algebraize-easy}.
\end{proof}


\noindent
The following lemma isn't true in general if $A$ is not a G-ring
but just Noetherian. Namely, if $(A, \mathfrak m)$ is local
and $I = \mathfrak m$, then the lemma is equivalent to 
Artin approximation for $A^h$ (as in
Smoothing Ring Maps, Theorem \ref{smoothing-theorem-approximation-property})
which does not hold for every Noetherian local ring.

\begin{lemma}
\label{lemma-fully-faithfulness}
Let $A$ be a Noetherian G-ring. Let $I \subset A$ be an ideal.
Let $B, C$ be finite type $A$-algebras. For any $A$-algebra map
$\varphi : B^\wedge \to C^\wedge$ of $I$-adic completions and any
$N \geq 1$ there exist
\begin{enumerate}
\item an \'etale ring map $C \to C'$ which induces
an isomorphism $C/IC \to C'/IC'$,
\item an $A$-algebra map $\varphi : B \to C'$
\end{enumerate}
such that $\varphi$ and $\psi$ agree modulo $I^N$
into $C^\wedge = (C')^\wedge$.
\end{lemma}

\begin{proof}
The statement of the lemma makes sense as $C \to C'$ is flat
(Algebra, Lemma \ref{algebra-lemma-etale}) hence induces an isomorphism
$C/I^nC \to C'/I^nC'$ for all $n$
(More on Algebra, Lemma \ref{more-algebra-lemma-neighbourhood-isomorphism})
and hence an isomorphism on completions.
Let $C^h$ be the henselization of the pair $(C, IC)$, see
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Then $C^h$ is the filtered colimit of the algebras $C'$
and the maps
$C \to C' \to C^h$ induce isomorphism on completions (More on Algebra,
Lemma \ref{more-algebra-lemma-henselization-Noetherian-pair}).
Thus it suffices to prove there exists an $A$-algebra map
$B \to C^h$ which is congruent to $\psi$ modulo $I^N$.
Write $B = A[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$.
The ring map $\psi$ corresponds to elements
$\hat c_1, \ldots, \hat c_n \in C^\wedge$ with
$f_j(\hat c_1, \ldots, \hat c_n) = 0$ for $j = 1, \ldots, m$.
Namely, as $A$ is a Noetherian G-ring, so is $C$, see
More on Algebra, Proposition
\ref{more-algebra-proposition-finite-type-over-G-ring}.
Thus Smoothing Ring Maps,
Lemma \ref{smoothing-lemma-henselian-pair}
applies to give elements $c_1, \ldots, c_n \in C^h$ such
that $f_j(c_1, \ldots, c_n) = 0$ for $j = 1, \ldots, m$
and such that $\hat c_i - c_i \in I^NC^h$.
This determines the map $B \to C^h$ as desired.
\end{proof}












\section{Rig-\'etale homomorphisms}
\label{section-rig-etale}

\noindent
In view of our definition of rig-smooth algebras
(Definition \ref{definition-rig-smooth-homomorphism}),
the following definition should not come as a surprise.

\begin{definition}
\label{definition-rig-etale-homomorphism}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}). We say
$B$ is {\it rig-\'etale over $(A, I)$} if there exists an integer
$c \geq 0$ such that for all $a \in I^c$
multiplication by $a$ on $\NL_{B/A}^\wedge$
is zero in $D(B)$.
\end{definition}

\noindent
Condition (\ref{item-condition-artin}) in the next lemma is
one of the conditions used in \cite{ArtinII} to define formal modifications.
We have added it to the list of conditions to facilitate comparison
with our conditions later on.

\begin{lemma}
\label{lemma-equivalent-with-artin}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}). Write
$B = A[x_1, \ldots, x_r]^\wedge/J$
(Lemma \ref{lemma-topologically-finite-type-Noetherian})
and let $\NL_{B/A}^\wedge = (J/J^2 \to \bigoplus B\text{d}x_i)$
be its naive cotangent complex (\ref{equation-NL}).
The following are equivalent
\begin{enumerate}
\item $B$ is rig-\'etale over $(A, I)$,
\item
\label{item-zero-on-NL}
there exists a $c \geq 0$ such that for all $a \in I^c$ multiplication by $a$
on $\NL_{B/A}^\wedge$ is zero in $D(B)$,
\item
\label{item-zero-on-cohomology-NL}
there exits a $c \geq 0$ such that $H^i(\NL_{B/A}^\wedge)$, $i = -1, 0$ is
annihilated by $I^c$,
\item
\label{item-zero-on-cohomology-NL-truncations}
there exists a $c \geq 0$ such that $H^i(\NL_{B_n/A_n})$, $i = -1, 0$ is
annihilated by $I^c$ for all $n \geq 1$ where $A_n = A/I^n$ and $B_n = B/I^nB$,
\item
\label{item-condition-artin-pre-pre}
for every $a \in I$ there exists a $c \geq 0$ such that
\begin{enumerate}
\item $a^c$ annihilates $H^0(\NL_{B/A}^\wedge)$, and
\item there exist $f_1, \ldots, f_r \in J$ such that
$a^c J \subset (f_1, \ldots, f_r) + J^2$.
\end{enumerate}
\item
\label{item-condition-artin-pre}
for every $a \in I$ there exist $f_1, \ldots, f_r \in J$ and $c \geq 0$
such that
\begin{enumerate}
\item $\det_{1 \leq i, j \leq r}(\partial f_j/\partial x_i)$ divides
$a^c$ in $B$, and
\item $a^c J \subset (f_1, \ldots, f_r) + J^2$.
\end{enumerate}
\item
\label{item-condition-artin}
choosing generaters $f_1, \ldots, f_t$ for $J$ we have
\begin{enumerate}
\item the Jacobian ideal of $B$ over $A$, namely the ideal in $B$
generated by the $r \times r$ minors of the matrx
$(\partial f_j/\partial x_i)_{1 \leq i \leq r, 1 \leq j \leq t}$,
contains the ideal $I^cB$ for some $c$, and
\item the Cramer ideal of $B$ over $A$, namely the ideal in $B$
generated by the image in $B$ of the $r$th Fitting ideal of $J$
as an $A[x_1, \ldots, x_r]^\wedge$-module, contains $I^cB$ for some $c$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (\ref{item-zero-on-NL}) is a restatement of
Definition \ref{definition-rig-etale-homomorphism}.

\medskip\noindent
The equivalence of (\ref{item-zero-on-NL}) and
(\ref{item-zero-on-cohomology-NL}) follows from
More on Algebra, Lemma \ref{more-algebra-lemma-zero-in-derived}.

\medskip\noindent
The equivalence of (\ref{item-zero-on-cohomology-NL})
and (\ref{item-zero-on-cohomology-NL-truncations}) follows from the fact that
the systems $\{\NL_{B_n/A_n}\}$ and $\NL_{B/A}^\wedge \otimes_B B_n$
are strictly isomorphic, see Lemma \ref{lemma-NL-is-limit}.
Some details omitted.

\medskip\noindent
Assume (\ref{item-zero-on-NL}). Let $a \in I$.
Let $c$ be such that multiplication by $a^c$ is zero on $\NL_{B/A}^\wedge$. By
More on Algebra, Lemma \ref{more-algebra-lemma-map-out-of-almost-free}
part (1) there exists a map $\alpha : \bigoplus B\text{d}x_i \to J/J^2$
such that $\text{d} \circ \alpha$ and $\alpha \circ \text{d}$ are both
multiplication by $a^c$. Let $f_i \in J$ be an element whose
class modulo $J^2$ is equal to $\alpha(\text{d}x_i)$.
A simple calculation gives that (\ref{item-condition-artin-pre})(a), (b) hold.

\medskip\noindent
We omit the verification that (\ref{item-condition-artin-pre})
implies (\ref{item-condition-artin-pre-pre}); it is just a statement
on two term complexes over $B$ of the form $M \to B^{\oplus r}$.

\medskip\noindent
Assume (\ref{item-condition-artin-pre-pre}) holds.
Say $I = (a_1, \ldots, a_t)$. Let $c_i \geq 0$ be the integer such that
(\ref{item-condition-artin-pre-pre})(a), (b)
hold for $a_i^{c_i}$. Then we see that $I^{\sum c_i}$ annihilates
$H^0(\NL_{B/A}^\wedge)$. Let $f_{i, 1}, \ldots, f_{i, r} \in J$
be as in (\ref{item-condition-artin-pre-pre})(b) for $a_i$.
Consider the composition
$$
B^{\oplus r} \to J/J^2 \to \bigoplus B\text{d}x_i
$$
where the $j$th basis vector is mapped to the class of $f_{i, j}$ in $J/J^2$.
By (\ref{item-condition-artin-pre-pre})(a) and (b) the cokernel of the
composition is annihilated by $a_i^{2c_i}$. Thus this map is surjective
after inverting $a_i^{c_i}$, and hence an isomorphism
(Algebra, Lemma \ref{algebra-lemma-fun}).
Thus the kernel of $B^{\oplus r} \to \bigoplus B\text{d}x_i$ is
$a_i$-power torsion, and hence
$H^{-1}(\NL_{B/A}^\wedge) = \Ker(J/J^2 \to \bigoplus B\text{d}x_i)$
is $a_i$-power torsion. Since $B$ is Noetherian
(Lemma \ref{lemma-topologically-finite-type-Noetherian}),
all modules including $H^{-1}(\NL_{B/A}^\wedge)$ are finite.
Thus $a_i^{d_i}$ annihilates $H^{-1}(\NL_{B/A}^\wedge)$ for some $d_i \geq 0$.
It follows that $I^{\sum d_i}$ annihilates $H^{-1}(\NL_{B/A}^\wedge)$
and we see that (\ref{item-zero-on-cohomology-NL}) holds.

\medskip\noindent
Thus conditions
(\ref{item-zero-on-NL}),
(\ref{item-zero-on-cohomology-NL}),
(\ref{item-zero-on-cohomology-NL-truncations}),
(\ref{item-condition-artin-pre-pre}), and
(\ref{item-condition-artin-pre}) are equivalent.
Thus it remains to show that these conditions are
equivalent with (\ref{item-condition-artin}).
Observe that the Cramer ideal $\text{Fit}_r(J) B$ is
equal to $\text{Fit}_r(J/J^2)$ as
$J/J^2 = J \otimes_{A[x_1, \ldots, x_r]^\wedge} B$, see
More on Algebra, Lemma \ref{more-algebra-lemma-fitting-ideal-basics} part (3).
Also, observe that the Jacobian ideal is just
$\text{Fit}_0(H^0(\NL_{B/A}^\wedge))$.
Thus we see that the equivalence of
(\ref{item-zero-on-cohomology-NL}) and (\ref{item-condition-artin})
is a purely algebraic question which we discuss in the next paragraph.

\medskip\noindent
Let $R$ be a Noetherian ring and let $I \subset R$ be an ideal.
Let $M \xrightarrow{d} R^{\oplus r}$ be a two term complex.
We have to show that the following are equivalent
\begin{enumerate}
\item[(A)] the cohomology of $M \to R^{\oplus r}$ is annihilated by a power
of $I$, and
\item[(B)] the ideals $\text{Fit}_r(M)$ and $\text{Fit}_0(\text{Coker}(d))$
contain a power of $I$.
\end{enumerate}
Since $R$ is Noetherian, we can reformulate part (2) as an inclusion
of the corresponding closed subschemes, see Algebra, Lemmas
\ref{algebra-lemma-Zariski-topology} and \ref{algebra-lemma-Noetherian-power}.
On the other hand, over the complement of $V(\text{Fit}_0(\Coker(d)))$
the cokernel of $d$ vanishes and over the complement of
$V(\text{Fit}_r(M))$ the module $M$ is locally generated by $r$
elements, see
More on Algebra, Lemma \ref{more-algebra-lemma-fitting-ideal-generate-locally}.
Thus (B) is equivalent to
\begin{enumerate}
\item[(C)] away from $V(I)$ the cokernel of $d$ vanishes and
the module $M$ is locally generated by $\leq r$ elements.
\end{enumerate}
Of course this is equivalent to the condition that $M \to R^{\oplus r}$
has vanishing cohomology over $\Spec(R) \setminus V(I)$ which in turn
is equivalent to (A). This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-rig-etale-rig-smooth}
Let $A$ be a Noetherian ring and let $I$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}).
If $B$ is rig-\'etale over $(A, I)$, then $B$ is rig-smooth over $(A, I)$.
\end{lemma}

\begin{proof}
Immediate from Definitions \ref{definition-rig-smooth-homomorphism} and
\ref{definition-rig-etale-homomorphism}.
\end{proof}

\begin{lemma}
\label{lemma-rig-etale}
Let $A$ be a Noetherian ring and let $I$ be an ideal.
Let $B$ be a finite type $A$-algebra.
\begin{enumerate}
\item If $\Spec(B) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$,
then $B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
\item If $B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin},
then there exists $g \in 1 + IB$ such that $\Spec(B_g)$ is \'etale
over $\Spec(A) \setminus V(I)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
The naive cotangent complex $\NL_{B/A}$ is a complex of finite type
$B$-modules and hence $H^{-1}$ and $H^0$ are finite $B$-modules.
Completion is an exact functor on finite $B$-modules (Algebra,
Lemma \ref{algebra-lemma-completion-flat}) and $\NL_{B^\wedge/A}^\wedge$
is the completion of the complex $\NL_{B/A}$ (this is easy to see
by choosing presentations).
Hence the assumption implies there exists a $c \geq 0$ such that
$H^{-1}/I^nH^{-1}$ and $H^0/I^nH^0$ are annihilated by $I^c$
for all $n$. By Nakayama's lemma (Algebra, Lemma \ref{algebra-lemma-NAK})
this means that $I^cH^{-1}$ and $I^cH^0$ are annihilated by an element
of the form $g = 1 + x$ with $x \in IB$. After inverting $g$
(which does not change the quotients $B/I^nB$)
we see that $\NL_{B/A}$ has cohomology annihilated by $I^c$. Thus
$A \to B$ is \'etale at any prime of $B$ not lying over $V(I)$
by the definition of \'etale ring maps, see
Algebra, Definition \ref{algebra-definition-etale}.

\medskip\noindent
Conversely, assume that $\Spec(B) \to \Spec(A)$ is \'etale over
$\Spec(A) \setminus V(I)$. Then for every $a \in I$ there exists
a $c \geq 0$ such that multiplication by $a^c$ is zero $\NL_{B/A}$.
Since $\NL_{B^\wedge/A}^\wedge$ is the derived completion of
$\NL_{B/A}$ (see Lemma \ref{lemma-NL-is-limit}) it follows that
$B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
\end{proof}

\begin{lemma}
\label{lemma-zero-after-modding-out}
Let $(A_1, I_1) \to (A_2, I_2)$ be as in
Remark \ref{remark-base-change} with $A_1$ and $A_2$ Noetherian.
Let $B_1$ be in (\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$.
If multiplication by $f_1 \in B_1$ on $\NL^\wedge_{B_1/A_1}$
is zero in $D(B_1)$, then multiplication by
the image $f_2 \in B_2$ on $\NL^\wedge_{B_2/A_2}$ is zero
in $D(B_2)$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-NL-base-change} there is a map
$$
\NL_{B_1/A_1} \otimes_{B_2} B_1 \to \NL_{B_2/A_2}
$$
which induces and isomorphism on $H^0$ and a surjection on $H^{-1}$.
Thus the result by
More on Algebra, Lemma \ref{more-algebra-lemma-two-term-surjection-map-zero}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-etale-homomorphism}
Let $A_1 \to A_2$ be a map of Noetherian rings. Let $I_i \subset A_i$
be an ideal such that $V(I_1A_2) = V(I_2)$. Let $B_1$ be in
(\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$ as in
Remark \ref{remark-base-change}.
If $B_1$ is rig-\'etale over $(A_1, I_1)$,
then $B_2$ is rig-\'etale over $(A_2, I_2)$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-zero-after-modding-out} and
Definition \ref{definition-rig-etale-homomorphism} and the fact
that $I_2^c \subset I_1A_2$ for some $c \geq 0$ as $A_2$ is Noetherian.
\end{proof}

\begin{lemma}
\label{lemma-fully-faithful-etale-over-complement}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $B$ be a finite type $A$-algebra such that
$\Spec(B) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$.
Let $C$ be a Noetherian $A$-algebra. Then any $A$-algebra
map $B^\wedge \to C^\wedge$ of $I$-adic completions
comes from a unique $A$-algebra map
$$
B \longrightarrow C^h
$$
where $C^h$ is the henselization of the pair $(C, IC)$ as
in More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Moreover, any $A$-algebra homomorphism $B \to C^h$ factors through
some \'etale $C$-algebra $C'$ such that $C/IC \to C'/IC'$ is an isomorphism.
\end{lemma}

\begin{proof}
Uniqueness follows from the fact that $C^h$ is a subring of
$C^\wedge$, see for example
More on Algebra, Lemma \ref{more-algebra-lemma-henselization-Noetherian-pair}.
The final assertion follows from the fact that $C^h$ is the filtered colimit
of these $C$-algebras $C'$, see proof of
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Having said this we now turn to the proof of existence.

\medskip\noindent
Let $\varphi : B^\wedge \to C^\wedge$ be the given map.
This defines a section
$$
\sigma : (B \otimes_A C)^\wedge \longrightarrow C^\wedge
$$
of the completion of the map $C \to B \otimes_A C$. We may
replace $(A, I, B, C, \varphi)$ by $(C, IC, B \otimes_A C, C, \sigma)$.
In this way we see that we may assume that $A = C$.

\medskip\noindent
Proof of existence in the case $A = C$. In this case the map
$\varphi : B^\wedge \to A^\wedge$ is necessarily surjective.
By Lemmas \ref{lemma-rig-etale} and \ref{lemma-exact-sequence-NL}
we see that the cohomology groups of
$\NL_{A^\wedge/\!_\varphi B^\wedge}^\wedge$
are annihilated by a power of $I$. Since $\varphi$ is surjective,
this implies that $\Ker(\varphi)/\Ker(\varphi)^2$ is annihilated
by a power of $I$. Hence $\varphi : B^\wedge \to A^\wedge$
is the completion of a finite type $B$-algebra $B \to D$, see
More on Algebra, Lemma \ref{more-algebra-lemma-quotient-by-idempotent}.
Hence $A \to D$ is a finite type algebra map which induces an isomorphism
$A^\wedge \to D^\wedge$. By
Lemma \ref{lemma-rig-etale} we may replace $D$ by a localization
and assume that $A \to D$ is \'etale away from $V(I)$.
Since $A^\wedge \to D^\wedge$ is an isomorphism, we see that
$\Spec(D) \to \Spec(A)$ is also \'etale in a neighbourhood of $V(ID)$
(for example by
More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}).
Thus $\Spec(D) \to \Spec(A)$ is \'etale. Therefore $D$ maps to
$A^h$ and the lemma is proved.
\end{proof}
















\section{A pushout argument}
\label{section-approximation}

\noindent
The only goal in this section is to prove the following lemma which
will play a key role in algebraization of rig-\'etale algebras.
We will use a bit of the theory of algebraic spaces to prove this lemma;
an earlier version of this chapter gave a (much longer) proof using algebra
and a bit of deformation theory that the interested reader can find in
the history of the Stacks project.

\begin{lemma}
\label{lemma-lift-approximation}
Let $A$ be a Noetherian ring and $I \subset A$ an ideal.
Let $J \subset A$ be a nilpotent ideal. Consider a commutative diagram
$$
\xymatrix{
C \ar[r] & C_0 \ar@{=}[r] & C/JC \\
& B_0 \ar[u] \\
A \ar[r] \ar[uu] & A_0 \ar[u] \ar@{=}[r] & A/J
}
$$
whose vertical arrows are of finite type such that
\begin{enumerate}
\item $\Spec(C) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$,
\item $\Spec(B_0) \to \Spec(A_0)$ is \'etale over
$\Spec(A_0) \setminus V(IA_0)$, and
\item $B_0 \to C_0$ is \'etale and induces an isomorphism
$B_0/IB_0 = C_0/IC_0$.
\end{enumerate}
Then we can fill in the diagram above to a commutative diagram
$$
\xymatrix{
C \ar[r] & C/JC \\
B \ar[u] \ar[r] & B_0 \ar[u] \\
A \ar[r] \ar[u] & A/J \ar[u]
}
$$
with $A \to B$ of finite type, $B/JB = B_0$, $B \to C$ \'etale, and
$\Spec(B) \to \Spec(A)$ \'etale over $\Spec(A) \setminus V(I)$.
\end{lemma}

\begin{proof}
Set $X = \Spec(A)$, $X_0 = \Spec(A_0)$, $Y_0 = \Spec(B_0)$,
$Z = \Spec(C)$, $Z_0 = \Spec(C_0)$. Furthermore, denote
$U \subset X$, $U_0 \subset X_0$, $V_0 \subset Y_0$,
$W \subset Z$, $W_0 \subset Z_0$ the complement of the
vanishing set of $I$. Here is a picture to help visualize the
situation:
$$
\xymatrix{
Z \ar[dd] & Z_0 \ar[l] \ar[d] \\
& Y_0 \ar[d] \\
X & X_0 \ar[l]
}
\quad\quad\quad
\xymatrix{
W \ar[dd] & W_0 \ar[l] \ar[d] \\
& V_0 \ar[d] \\
U & U_0 \ar[l]
}
$$
The conditions in the lemma guarantee that
$$
\xymatrix{
W_0 \ar[r] \ar[d] & Z_0 \ar[d] \\
V_0 \ar[r] & Y_0
}
$$
is an elementary distinguished square, see
Derived Categories of Spaces, Definition
\ref{spaces-perfect-definition-elementary-distinguished-square}.
In addition we know that
$W_0 \to U_0$ and $V_0 \to U_0$ are \'etale. The morphism
$X_0 \subset X$ is a finite order thickening as $J$ is assumed nilpotent.
By the topological invariance of the \'etale site
we can find a unique \'etale morphism $V \to X$ of schemes
with $V_0 = V \times_X X_0$ and we can lift the given morphism
$W_0 \to V_0$ to a unique morphism $W \to V$ over $X$.
See \'Etale Morphisms of Schemes, Theorem
\ref{etale-theorem-remarkable-equivalence}.
Since $W_0 \to V_0$ is separated, the morphism $W \to V$ is separated too,
see for example
More on Morphisms, Lemma \ref{more-morphisms-lemma-deform-property}.
By Pushouts of Spaces, Lemma
\ref{spaces-pushouts-lemma-construct-elementary-distinguished-square}
we can construct an elementary distinguished square
$$
\xymatrix{
W \ar[r] \ar[d] & Z \ar[d] \\
V \ar[r] & Y
}
$$
in the category of algebraic spaces over $X$. Since the base change
of an elementary distinguished square is an elementary distinguished
square (Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-make-more-elementary-distinguished-squares})
we see that
$$
\xymatrix{
W_0 \ar[r] \ar[d] & Z_0 \ar[d] \\
V_0 \ar[r] & Y \times_X X_0
}
$$
is an elementary distinguished square. It follows that there is a
unique isomorphism $Y \times_X X_0 = Y_0$ compatible with the two
squares involving these spaces because
elementary distinguished squares are pushouts (Pushouts of Spaces, Lemma
\ref{spaces-pushouts-lemma-elementary-distinguished-square-pushout}).
It follows that $Y$ is affine by
Limits of Spaces, Proposition \ref{spaces-limits-proposition-affine}.
Write $Y = \Spec(B)$. It is clear that $B$ fits into the desired diagram
and satisfies all the properties required of it.
\end{proof}

















\section{Algebraization of rig-\'etale algebras}
\label{section-approximation-principal}

\noindent
The main goal is to prove algebraization for rig-\'etale algebras
when the underlying Noetherian ring $A$ is not assumed to be a G-ring
and when the ideal $I \subset A$ is arbitrary -- not necessarily principal.
We first prove the principal ideal case and then use the result
of Section \ref{section-approximation} to finish the proof.

\begin{lemma}
\label{lemma-approximate-principal}
\begin{reference}
The rig-\'etale case of \cite[III Theorem 7]{Elkik}
\end{reference}
Let $A$ be a Noetherian ring and $I = (a)$ a principal ideal.
Let $B$ be an object of (\ref{equation-C-prime}) which is
rig-\'etale over $(A, I)$.
Then there exists a finite type $A$-algebra $C$ and an
isomorphism $B \cong C^\wedge$.
\end{lemma}

\begin{proof}
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$. By
Definition \ref{definition-rig-etale-homomorphism} the complex
$\NL_{B/A}^\wedge$ is annihilated by $a^c$ for some $c \geq 0$. By
More on Algebra, Lemma \ref{more-algebra-lemma-map-out-of-almost-free} part (1)
this means we can find a map $\alpha : \bigoplus B\text{d}x_i \to J/J^2$
such that $\text{d} \circ \alpha$ and $\alpha \circ \text{d}$ are both
multiplication by $a^c$. Pick an element $f_i \in J$ whose
class modulo $J^2$ is equal to $\alpha(\text{d}x_i)$.
Then we see that $\text{d}f_i = a^c \text{d}x_i$ in $\bigoplus B\text{d}x_i$.
In particular we have a ring map
$$
A[x_1, \ldots, x_r]^\wedge/
(f_1, \ldots, f_r, \Delta(f_1, \ldots, f_r) - a^{rc})
\longrightarrow B
$$
where $\Delta(f_1, \ldots, f_r) \in A[x_1, \ldots, x_r]^\wedge$
is the determinant of the matrix of partial derivatives of the $f_i$.

\medskip\noindent
Pick a large integer $n$ (we will see later how large).
Pick $F_1, \ldots, F_r \in A[x_1, \ldots, x_r]$ such that
$F_i - f_i \in I^n A[x_1, \ldots, x_r]^\wedge$. Set
$$
C = A[x_1, \ldots, x_r, z]/
(F_1, \ldots, F_r, z\Delta(F_1, \ldots, F_r) - a^{rc})
$$
We claim that multiplication by $a^{2rc}$ is zero on $\NL_{C/A}$ in $D(C)$.
Namely, the determinant of the matrix of the partial derivatives
of the $r + 1$ generators of the ideal of $C$ with respect to the variables
$x_1, \ldots, x_{r + 1}, z$ is $\Delta(F_1, \ldots, F_r)^2$.
Hence multiplication by $\Delta(F_1, \ldots, F_r)^2$ on
$\NL_{C/A}$ is zero in $D(C)$ as follows upon combining
More on Algebra, Lemmas \ref{more-algebra-lemma-silly} and
\ref{more-algebra-lemma-two-term-surjection-map-zero}. Since
$\Delta(F_1, \ldots, F_r)$ divides $a^{rc}$ in $C$, the claim is true.
Let $C^\wedge$ be the $I$-adic completion of $C$. Since
$\NL_{C^\wedge/A}^\wedge = \NL_{C/A} \otimes_C C^\wedge$ by
Lemma \ref{lemma-NL-is-completion} we conclude that multiplication
by $a^{2rc}$ is zero on $\NL_{C^\wedge/A}^\wedge$ as well.

\medskip\noindent
By construction there is a surjective map $\psi_n : C \to B/I^nB$
sending $x_i$ to $x_i$ and $z$ to $1$. By
Lemma \ref{lemma-get-morphism-principal} (with the roles of $B$ and $C$
reversed) for $N$ large enough we get a map $\varphi : C^\wedge \to B$ which
agrees with $\psi_n$ modulo $I^{n - 2rc}B$.

\medskip\noindent
Since $\varphi : C^\wedge \to B$ is surjective modulo $I$ we see that it is
surjective (for example use
Algebra, Lemma \ref{algebra-lemma-completion-generalities}).
By construction and assumption the naive cotangent complexes
$\NL_{C^\wedge/A}^\wedge$ and $\NL_{B/A}^\wedge$
have cohomology annihilated by a fixed power of $a$. Thus the same thing
is true for $\NL_{B/C^\wedge}^\wedge$ by Lemma \ref{lemma-exact-sequence-NL}.
Since $\varphi$ is surjective we conclude that
$\Ker(\varphi)/\Ker(\varphi)^2$ is annihilated by a power of $a$.
The result of the lemma now follows from
More on Algebra, Lemma \ref{more-algebra-lemma-quotient-by-idempotent}.
\end{proof}

\begin{lemma}
\label{lemma-approximate}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}).
Assume there is an integer $c \geq 0$ such that for $a \in I^c$
multiplication by $a$ on $\NL_{B/A}^\wedge$ is zero in $D(B)$.
Then there exists a finite type $A$-algebra $C$ and an
isomorphism $B \cong C^\wedge$.
\end{lemma}

\begin{proof}
We prove this lemma by induction on the number of generators of $I$.
Say $I = (a_1, \ldots, a_t)$. If $t = 0$, then $I = 0$ and there
is nothing to prove. If $t = 1$, then the lemma follows from
Lemma \ref{lemma-approximate-principal}. Assume $t > 1$.

\medskip\noindent
For any $m \geq 1$ set $\bar A_m = A/(a_t^m)$. Consider the ideal
$\bar I_m = (\bar a_1, \ldots, \bar a_{t - 1})$ in $\bar A_m$.
Let $B_m = B/(a_t^m)$ be the base change of $B$ for the
map $(A, I) \to (\bar A_m, \bar I_m)$, see
(\ref{equation-base-change-to-closed}).
By Lemma \ref{lemma-zero-after-modding-out}
the assumption of the lemma holds for
$\bar I_m \subset \bar A_m \to B_m$.

\medskip\noindent
By induction hypothesis (on $t$) we can find a finite type
$\bar A_m$-algebra $C_m$ and a map $C_m \to B_m$ which induces an
isomorphism $C_m^\wedge \cong B_m$
where the completion is with respect to $\bar I_m$.
By Lemma \ref{lemma-rig-etale} we may assume that
$\Spec(C_m) \to \Spec(\bar A_m)$ is \'etale
over $\Spec(\bar A_m) \setminus V(\bar I_m)$.

\medskip\noindent
We claim that we may choose $A_m \to C_m \to B_m$ as in the previous
paragraph such that moreover there are isomorphisms
$C_m/(a_t^{m - 1}) \to C_{m - 1}$ compatible with the given
$A$-algebra structure and the maps to $B_{m - 1} = B_m/(a_t^{m - 1})$.
Namely, first fix a choice of $A_1 \to C_1 \to B_1$.
Suppose we have found $C_{m - 1} \to C_{m - 2} \to \ldots \to C_1$
with the desired properties.
Note that $C_m/(a_t^{m - 1})$ is \'etale over
$\Spec(\bar A_{m - 1}) \setminus V(\bar I_{m - 1})$.
Hence by Lemma \ref{lemma-fully-faithful-etale-over-complement}
there exists an \'etale extension $C_{m - 1} \to C'_{m - 1}$
which induces an isomorphism modulo $\bar I_{m - 1}$ and an
$\bar A_{m - 1}$-algebra map $C_m/(a_t^{m - 1}) \to C'_{m - 1}$
inducing the isomorphism $B_m/(a_t^{m - 1}) \to B_{m - 1}$ on completions.
Note that $C_m/(a_t^{m - 1}) \to C'_{m - 1}$ is \'etale over the complement
of $V(\bar I_{m - 1})$ by
Morphisms, Lemma \ref{morphisms-lemma-etale-permanence}
and over $V(\bar I_{m - 1})$ induces an isomorphism on completions
hence is \'etale there too (for example by More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}).
Thus $C_m/(a_t^{m - 1}) \to C'_{m - 1}$ is \'etale. By the
topological invariance of \'etale morphisms
(\'Etale Morphisms, Theorem \ref{etale-theorem-remarkable-equivalence})
there exists an \'etale ring map $C_m \to C'_m$ such that
$C_m/(a_t^{m - 1}) \to C'_{m - 1}$ is isomorphic to
$C_m/(a_t^{m - 1}) \to C'_m/(a_t^{m - 1})$. Observe that the
$\bar I_m$-adic completion of $C'_m$ is equal to the $\bar I_m$-adic
completion of $C_m$, i.e., to $B_m$ (details omitted).
We apply Lemma \ref{lemma-lift-approximation} to the diagram
$$
\xymatrix{
 & C'_m \ar[r] & C'_m/(a_t^{m - 1}) \\
C''_m \ar@{..>}[ru] \ar@{..>}[rr] & & C_{m - 1} \ar[u] \\
 & \bar A_m \ar[r] \ar[uu] \ar@{..>}[lu] & \bar A_{m - 1} \ar[u]
}
$$
to see that there exists a ``lift'' of $C''_m$ of $C_{m - 1}$
to an algebra over $\bar A_m$ with all the desired properties.

\medskip\noindent
By construction $(C_m)$ is an object of the category
(\ref{equation-C}) for the principal ideal $(a_t)$.
Thus the inverse limit $B' = \lim C_m$ is an $(a_t)$-adically
complete $A$-algebra such that $B'/a_t B'$ is of finite type
over $A/(a_t)$, see Lemma \ref{lemma-topologically-finite-type}.
By construction the $I$-adic completion of $B'$ is isomorphic to $B$
(details omitted). Consider the complex $\NL_{B'/A}^\wedge$ constructed
using the $(a_t)$-adic topology. Choosing a presentation for $B'$
(which induces a similar presentation for $B$) the reader immediately
sees that $\NL_{B'/A}^\wedge \otimes_{B'} B = \NL_{B/A}^\wedge$.
Since $a_t \in I$ and since the cohomology modules of
$\NL_{B'/A}^\wedge$ are finite $B'$-modules (hence complete for the
$a_t$-adic topology), we conclude that $a_t^c$ acts as zero on
these cohomologies as the same thing is true by assumption for
$\NL_{B/A}^\wedge$. Thus multiplication by $a_t^{2c}$ is zero
on $\NL_{B'/A}^\wedge$ by Lemma \ref{lemma-zero-in-derived}.
Hence finally, we may apply Lemma \ref{lemma-approximate-principal}
to $(a_t) \subset A \to B'$ to finish the proof.
\end{proof}

\begin{lemma}
\label{lemma-approximate-by-etale-over-complement}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $B$ be an $I$-adically complete $A$-algebra with $A/I \to B/IB$
of finite type. The equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin} are also equivalent to
\begin{enumerate}
\item[(5)]
\label{item-algebraize}
there exists a finite type $A$-algebra $C$ with
$\Spec(C) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$
such that $B \cong C^\wedge$.
\end{enumerate}
\end{lemma}

\begin{proof}
First, assume conditions (1) -- (4) hold. Then there exists
a finite type $A$-algebra $C$ with such that $B \cong C^\wedge$
by Lemma \ref{lemma-approximate}. In other words, $B_n = C/I^nC$.
The naive cotangent complex $\NL_{C/A}$ is a complex of finite type
$C$-modules and hence $H^{-1}$ and $H^0$ are finite $C$-modules.
By assumption there exists a $c \geq 0$ such that
$H^{-1}/I^nH^{-1}$ and $H^0/I^nH^0$ are annihilated by $I^c$
for some $n$. By Nakayama's lemma this means that
$I^cH^{-1}$ and $I^cH^0$ are annihilated by an element of the
form $f = 1 + x$ with $x \in IC$. After inverting $f$
(which does not change the quotients $B_n = C/I^nC$)
we see that $\NL_{C/A}$ has cohomology annihilated by $I^c$. Thus
$A \to C$ is \'etale at any prime of $C$ not lying over $V(I)$
by the definition of \'etale ring maps, see
Algebra, Definition \ref{algebra-definition-etale}.

\medskip\noindent
Conversely, assume that $A \to C$ of finite type is given such that
$\Spec(C) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$.
Then for every $a \in I$ there exists an $c \geq 0$ such that
multiplication by $a^c$ is zero $\NL_{C/A}$.
Since $\NL_{C^\wedge/A}^\wedge$ is the derived completion of
$\NL_{C/A}$ (see Lemma \ref{lemma-NL-is-limit}) it follows that
$B = C^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
\end{proof}












\section{Rig-\'etale morphisms}
\label{section-rig-etale-morphisms}

\noindent
We can use the notion introduced in the previous section to define
a new type of morphism of locally Noetherian formal algebraic spaces.
Before we do so, we have to check it is a local property.

\begin{lemma}
\label{lemma-rig-etale-axioms}
For morphisms $A \to B$ of the category $\textit{WAdm}^{Noeth}$
(Formal Spaces, Section \ref{formal-spaces-section-morphisms-rings})
consider the condition $P=$``for some ideal of definition $I$ of $A$
the topology on $B$ is the $I$-adic topology, the ring map $A/I \to B/IB$
is of finite type and $A \to B$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}''. Then $P$ is a local property, see
Formal Spaces, Remark \ref{formal-spaces-remark-variant-Noetherian}.
\end{lemma}

\begin{proof}
We have to show that Formal Spaces, Axioms (\ref{formal-spaces-item-axiom-1}),
(\ref{formal-spaces-item-axiom-2}), and (\ref{formal-spaces-item-axiom-3})
hold for maps between Noetherian adic rings. For a Noetherian adic ring
$A$ with ideal of definition $I$ we have
$A\{x_1, \ldots, x_r\} = A[x_1, \ldots, x_r]^\wedge$ as topological
$A$-algebras (see Formal Spaces, Remark
\ref{formal-spaces-remark-I-adic-completion-and-restricted-power-series}).
We will use without further mention that we know the axioms hold
for the property ``$B$ is a quotient of $A[x_1, \ldots, x_r]^\wedge$'', see
Formal Spaces, Lemma
\ref{formal-spaces-lemma-quotient-restricted-power-series}.

\medskip\noindent
Let a diagram as in
Formal Spaces, Diagram (\ref{formal-spaces-equation-localize})
be given with $A$ and $B$ in the category $\textit{WAdm}^{Noeth}$.
Pick an ideal of definition $I \subset A$. By the remarks above
the topology on each ring in the diagram is the $I$-adic topology.
Since $A \to A'$ and $B \to B'$ are \'etale we see that
$\NL_{(A')^\wedge/A}^\wedge$ and $\NL_{(B')^\wedge/B}^\wedge$
are zero. By Lemmas \ref{lemma-exact-sequence-NL} and
\ref{lemma-transitive-lci-at-end} we get
$$
H^i(\NL_{(B')^\wedge/(A')^\wedge}^\wedge)
\cong
H^i(\NL_{(B')^\wedge/A}^\wedge)
\quad\text{and}\quad
H^i(\NL_{B/A}^\wedge \otimes_B (B')^\wedge) \cong
H^i(\NL_{(B')^\wedge/A}^\wedge)
$$
for $i = -1, 0$. Since $B$ is Noetherian the ring map
$B \to B' \to (B')^\wedge$ is flat
(Algebra, Lemma \ref{algebra-lemma-completion-flat})
hence the tensor product comes out. Moreover, as $B$ is
$I$-adically complete, then if $B \to B'$ is faithfully flat,
so is $B \to (B')^\wedge$. From these observations
Formal Spaces, Axioms (\ref{formal-spaces-item-axiom-1})
and (\ref{formal-spaces-item-axiom-2}) follow immediately.

\medskip\noindent
We omit the proof of Formal Spaces, Axiom (\ref{formal-spaces-item-axiom-3}).
\end{proof}

\begin{definition}
\label{definition-rig-etale}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of locally
Noetherian formal algebraic spaces over $S$. We say $f$ is
{\it rig-\'etale} if $f$ satisfies the equivalent conditions of
Formal Spaces, Lemma
\ref{formal-spaces-lemma-property-defines-property-morphisms}
(in the setting of locally Noetherian formal algebraic spaces, see
Formal Spaces, Remark \ref{formal-spaces-remark-variant-adic-star})
for the property $P$ of Lemma \ref{lemma-rig-etale-axioms}.
\end{definition}

\noindent
To be sure, a rig-\'etale morphism is locally of finite type.

\begin{lemma}
\label{lemma-rig-etale-finite-type}
A rig-\'etale morphism of locally Noetherian formal algebraic spaces
is locally of finite type.
\end{lemma}

\begin{proof}
The property $P$ in Lemma \ref{lemma-rig-etale-axioms}
implies the equivalent conditions (a), (b), (c), and (d) in
Formal Spaces, Lemma
\ref{formal-spaces-lemma-quotient-restricted-power-series}.
Hence this follows from
Formal Spaces, Lemma \ref{formal-spaces-lemma-finite-type-local-property}.
\end{proof}
















\section{Rig-surjective morphisms}
\label{section-rig-surjective}

\noindent
For morphisms locally of finite type between locally Noetherian formal
algebraic spaces a definition borrowed from \cite{ArtinII} can be used. See
Remark \ref{remark-rig-surjective-more-general} for a discussion
of what to do in more general cases.

\begin{definition}
\label{definition-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of formal
algebraic spaces over $S$. Assume that $X$ and $Y$ are locally
Noetherian and that $f$ is locally of finite type. We say
$f$ is {\it rig-surjective} if for every solid diagram
$$
\xymatrix{
\text{Spf}(R') \ar@{..>}[r] \ar@{..>}[d] & X \ar[d]^f \\
\text{Spf}(R) \ar[r]^-p & Y
}
$$
where $R$ is a complete discrete valuation ring and where
$p$ is an adic morphism there exists an
extension of complete discrete valuation rings $R \subset R'$
and a morphism $\text{Spf}(R') \to X$ making the displayed diagram commute.
\end{definition}

\noindent
We prove a few lemmas to explain what this means.

\begin{lemma}
\label{lemma-composition-rig-surjective}
\begin{slogan}
Rig-surjectivity of locally finite type morphisms is preserved under
composition
\end{slogan}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of formal
algebraic spaces over $S$. Assume $X$, $Y$, $Z$ are locally Noetherian and
$f$ and $g$ locally of finite type. Then if $f$ and $g$ are rig-surjective,
so is $g \circ f$.
\end{lemma}

\begin{proof}
Follows in a straightforward manner from the definitions
(and Formal Spaces, Lemma \ref{formal-spaces-lemma-composition-finite-type}).
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ and $Z \to Y$ be morphisms
of formal algebraic spaces over $S$. Assume $X$, $Y$, $Z$ are locally
Noetherian and $f$ and $g$ locally of finite type. If $f$ is
rig-surjective, then the base change $Z \times_Y X \to Z$ is too.
\end{lemma}

\begin{proof}
Follows in a straightforward manner from the definitions (and
Formal Spaces, Lemmas \ref{formal-spaces-lemma-fibre-product-Noetherian} and
\ref{formal-spaces-lemma-base-change-finite-type}).
\end{proof}

\begin{lemma}
\label{lemma-permanence-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of
formal algebraic spaces over $S$. Assume $X$, $Y$, $Z$ locally Noetherian
and $f$ and $g$ locally of finite type. If $g \circ f : X \to Z$
is rig-surjective, so is $g : Y \to Z$.
\end{lemma}

\begin{proof}
Immediate from the definition.
\end{proof}

\begin{lemma}
\label{lemma-etale-covering-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of formal algebraic
spaces which is representable by algebraic spaces, \'etale, and surjective.
Assume $X$ and $Y$ locally Noetherian. Then $f$ is rig-surjective.
\end{lemma}

\begin{proof}
Let $p : \text{Spf}(R) \to Y$ be an adic morphism where $R$ is a complete
discrete valuation ring. Let $Z = \text{Spf}(R) \times_Y X$. Then
$Z \to \text{Spf}(R)$ is representable by algebraic spaces, \'etale, and
surjective. Hence $Z$ is nonempty. Pick a nonempty affine formal algebraic
space $V$ and an \'etale morphism $V \to Z$ (possible by our definitions).
Then $V \to \text{Spf}(R)$ corresponds to $R \to A^\wedge$ where
$R \to A$ is an \'etale ring map, see Formal Spaces, Lemma
\ref{formal-spaces-lemma-etale}. Since $A^\wedge \not = 0$
(as $V \not = \emptyset$) we can find a maximal ideal $\mathfrak m$
of $A$ lying over $\mathfrak m_R$. Then $A_\mathfrak m$ is a discrete
valuation ring (More on Algebra, Lemma
\ref{more-algebra-lemma-Dedekind-etale-extension}).
Then $R' = A_\mathfrak m^\wedge$ is a complete discrete valuation ring
(More on Algebra, Lemma \ref{more-algebra-lemma-completion-dvr}).
Applying Formal Spaces, Lemma
\ref{formal-spaces-lemma-morphism-between-formal-spectra}.
we find the desired morphism $\text{Spf}(R') \to V \to Z \to X$.
\end{proof}

\begin{remark}
\label{remark-upshot}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of
locally Noetherian formal algebraic spaces which is locally of finite type.
The upshot of the lemmas above is that we may check whether
$f : X \to Y$ is rig-surjective, \'etale locally on $Y$. For example,
suppose that $\{Y_i \to Y\}$ is a covering as in
Formal Spaces, Definition \ref{formal-spaces-definition-formal-algebraic-space}.
Then $f$ is rig-surjective if and only if $f_i : X \times_Y Y_i \to Y_i$ is
rig-surjective. Namely, if $f$ is rig-surjective, so is any base change
(Lemma \ref{lemma-base-change-rig-surjective}).
Conversely, if all $f_i$ are rig-surjective, so is
$\coprod f_i : \coprod X \times_Y Y_i \to \coprod Y_i$.
By Lemma \ref{lemma-etale-covering-rig-surjective}
the morphism $\coprod Y_i \to Y$ is rig-surjective.
Hence $\coprod X \times_Y Y_i \to Y$ is rig-surjective
(Lemma \ref{lemma-composition-rig-surjective}).
Since this morphism factors through $X \to Y$ we see that $X \to Y$
is rig-surjective by Lemma \ref{lemma-permanence-rig-surjective}.
\end{remark}

\begin{lemma}
\label{lemma-completion-proper-surjective-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a proper surjective morphism
of locally Noetherian algebraic spaces over $S$. Let $T \subset |Y|$
be a closed subset and let $T' = |f|^{-1}(T) \subset |X|$.
Then $X_{/T'} \to Y_{/T}$ is rig-surjective.
\end{lemma}

\begin{proof}
The statement makes sense by
Formal Spaces, Lemmas \ref{formal-spaces-lemma-formal-completion-types} and
\ref{formal-spaces-lemma-map-completions-finite-type}.
Let $Y_j \to Y$ be a jointly surjective family of \'etale morphism
where $Y_j$ is an affine scheme for each $j$.
Denote $T_j \subset Y_j$ the inverse image of $T$.
Then $\{(Y_j)_{/T_j} \to Y_{/T}\}$ is a covering as in
Formal Spaces, Definition \ref{formal-spaces-definition-formal-algebraic-space}.
Moreover, setting $X_j = Y_j \times_Y X$ and $T'_j \subset |X_j|$
the inverse image of $T$, we have
$$
(X_j)_{/T'_j} = (Y_j)_{/T_j} \times_{(Y_{/T})} X_{/T'}
$$
By the discussion in Remark \ref{remark-upshot} we reduce to the case where
$Y$ is an affine Noetherian scheme treated in the next paragraph.

\medskip\noindent
Assume $Y = \Spec(A)$ where $A$ is a Noetherian ring. This implies that
$Y_{/T} = \text{Spf}(A^\wedge)$ where $A^\wedge$ is the $I$-adic completion
of $A$ for some ideal $I \subset A$. Let
$p : \text{Spf}(R) \to \text{Spf}(A^\wedge)$
be an adic morphism where $R$ is a complete discrete valuation ring.
Let $K$ be the field of fractions of $R$.
Consider the composition $A \to A^\wedge \to R$.
Since $X \to Y$ is surjective, the fibre $X_K = \Spec(K) \times_Y X$
is nonempty. Thus we may choose an affine scheme $U$ and an \'etale
morphism $U \to X$ such that $U_K$ is nonempty.
Let $u \in U_K$ be a closed point (possible as $U_K$ is affine). By
Morphisms, Lemma \ref{morphisms-lemma-closed-point-fibre-locally-finite-type}
the residue field $L = \kappa(u)$ is a finite extension of $K$. Let
$R' \subset L$ be the integral closure of $R$ in $L$. By
More on Algebra, Remark \ref{more-algebra-remark-finite-separable-extension}
we see that $R'$ is a discrete valuation ring.
Because $X \to Y$ is proper we see that the given morphism
$\Spec(L) = u \to U_K \to X_K \to X$ extends to a morphism
$\Spec(R') \to X$ over the given morphism $\Spec(R) \to Y$
(Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-characterize-proper}).
By commutativity of the diagram the induced morphisms
$\Spec(R'/\mathfrak m_{R'}^n) \to X$ are points of $X_{/T'}$
and we find
$$
\text{Spf}((R')^\wedge) = \colim \Spec(R'/\mathfrak m_{R'}^n)
\longrightarrow X_{/T'}
$$
as desired (note that $(R')^\wedge$ is a complete discrete valuation ring
by More on Algebra, Lemma \ref{more-algebra-lemma-completion-dvr};
in fact in the current situation $R' = (R')^\wedge$ but we do not
need this).
\end{proof}

\begin{lemma}
\label{lemma-faithfully-flat-rig-surjective}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Let $B$ be an $I$-adically complete $A$-algebra.
If $A/I^n \to B/I^nB$ is of finite type and flat for all $n$ and
faithfully flat for $n = 1$, then $\text{Spf}(B) \to \text{Spf}(A)$
is rig-surjective.
\end{lemma}

\begin{proof}
We will use without further mention that morphisms between formal spectra
are given by continuous maps between the corresponding topological rings, see
Formal Spaces, Lemma \ref{formal-spaces-lemma-morphism-between-formal-spectra}.
Let $\varphi : A \to R$ be a continuous map into a complete discrete
valuation ring $A$. This implies that $\varphi(I) \subset \mathfrak m_R$.
On the other hand, since we only need to produce the lift
$\varphi' : B' \to R'$ in the case that $\varphi$ corresponds to an adic
morphism, we may assume that $\varphi(I) \not = 0$. Thus we may consider
the base change $C = B \widehat{\otimes}_A R$, see
Remark \ref{remark-base-change} for example.
Then $C$ is an $\mathfrak m_R$-adically complete $R$-algebra
such that $C/\mathfrak m_R^n C$ is of finite type and flat over
$R/\mathfrak m_R^n$ and such that $C/\mathfrak m_R C$ is nonzero.
Pick any maximal ideal $\mathfrak m \subset C$ lying over
$\mathfrak m_R$. By flatness (which implies going down) we see that
$\Spec(C_\mathfrak m) \setminus V(\mathfrak m_R C_\mathfrak m)$
is a nonempty open. Hence
We can pick a prime $\mathfrak q \subset \mathfrak m$
such that $\mathfrak q$ defines a closed point of
$\Spec(C_\mathfrak m) \setminus \{\mathfrak m\}$ and such that
$\mathfrak q \not \in V(IC_\mathfrak m)$, see
Properties, Lemma \ref{properties-lemma-complement-closed-point-Jacobson}.
Then $C/\mathfrak q$ is a dimension $1$-local domain and we can find
$C/\mathfrak q \subset R'$ with $R'$ a discrete valuation ring
(Algebra, Lemma \ref{algebra-lemma-exists-dvr}).
By construction $\mathfrak m_R R' \subset \mathfrak m_{R'}$
and we see that $C \to R'$ extends to a continuous map
$C \to (R')^\wedge$ (in fact we can pick $R'$ such that
$R' = (R')^\wedge$ in our current situation but we do not need this).
Since the completion of a discrete valuation ring is a discrete
valuation ring, we see that the assumption gives a commutative
diagram of rings
$$
\xymatrix{
(R')^\wedge & C \ar[l] & B \ar[l] \\
R \ar[u] & R \ar[l] \ar[u] & A \ar[l] \ar[u]
}
$$
which gives the desired lift.
\end{proof}

\begin{lemma}
\label{lemma-flat-rig-surjective}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Let $B$ be an $I$-adically complete $A$-algebra. Assume that
\begin{enumerate}
\item the $I$-torsion in $A$ is $0$,
\item $A/I^n \to B/I^nB$ is flat and of finite type for all $n$.
\end{enumerate}
Then $\text{Spf}(B) \to \text{Spf}(A)$ is rig-surjective if and only
if $A/I \to B/IB$ is faithfully flat.
\end{lemma}

\begin{proof}
Faithful flatness implies rig-surjectivity by
Lemma \ref{lemma-faithfully-flat-rig-surjective}.
To prove the converse we will use without further mention that the
vanishing of $I$-torsion is equivalent to the vanishing of $I$-power torsion
(More on Algebra, Lemma \ref{more-algebra-lemma-torsion-free}).
We will also use without further mention that morphisms between
formal spectra are given by continuous maps between the corresponding
topological rings, see
Formal Spaces, Lemma \ref{formal-spaces-lemma-morphism-between-formal-spectra}.

\medskip\noindent
Assume $\text{Spf}(B) \to \text{Spf}(A)$ is rig-surjective.
Choose a maximal ideal $I \subset \mathfrak m \subset A$.
The open $U = \Spec(A_\mathfrak m) \setminus V(I_\mathfrak m)$
of $\Spec(A_\mathfrak m)$ is nonempty as the $I_\mathfrak m$-torsion of
$A_\mathfrak m$ is zero
(use Algebra, Lemma \ref{algebra-lemma-Noetherian-power-ideal-kills-module}).
Thus we can find a prime $\mathfrak q \subset A_\mathfrak m$ which defines
a point of $U$ (i.e., $IA_\mathfrak m \not \subset \mathfrak q$)
and which corresponds to a closed point
of $\Spec(A_\mathfrak m) \setminus \{\mathfrak m\}$, see
Properties, Lemma \ref{properties-lemma-complement-closed-point-Jacobson}.
Then $A_\mathfrak m/\mathfrak q$ is a dimension $1$ local domain.
Thus we can find an injective local homomorphism of local rings
$A_\mathfrak m/\mathfrak q \subset R$ where $R$ is a discrete valuation ring
(Algebra, Lemma \ref{algebra-lemma-exists-dvr}).
By construction $IR \subset \mathfrak m_R$ and we see that
$A \to R$ extends to a continuous map $A \to R^\wedge$.
Since the completion of a discrete valuation ring is a discrete
valuation ring, we see that the assumption gives a commutative
diagram of rings
$$
\xymatrix{
R' & B \ar[l] \\
R^\wedge \ar[u] & A \ar[l] \ar[u]
}
$$
Thus we find a prime ideal of $B$ lying over $\mathfrak m$. It follows
that $\Spec(B/IB) \to \Spec(A/I)$ is surjective, whence $A/I \to B/IB$
is faithfully flat
(Algebra, Lemma \ref{algebra-lemma-ff-rings}).
\end{proof}

\begin{remark}
\label{remark-rig-surjective-more-general}
The condition as formulated in Definition \ref{definition-rig-surjective}
is not right for morphisms of locally adic* formal algebraic spaces.
For example, if $A = (\bigcup_{n \geq 1} k[t^{1/n}])^\wedge$
where the completion is the $t$-adic completion, then
there are no adic morphisms $\text{Spf}(R) \to \text{Spf}(A)$
where $R$ is a complete discrete valuation ring.
Thus any morphism $X \to \text{Spf}(A)$ would be rig-surjective,
but since $A$ is a domain and $t \in A$ is not zero, we want to
think of $A$ as having at least one ``rig-point'', and we do not
want to allow $X = \emptyset$. To cover this
particular case, one can consider adic morphisms
$$
\text{Spf}(R) \longrightarrow Y
$$
where $R$ is a valuation ring complete with respect to a principal
ideal $J$ whose radical is $\mathfrak m_R = \sqrt{J}$.
In this case the value group of $R$ can be embedded into
$(\mathbf{R}, +)$ and one obtains the point of view used by
Berkovich in defining an analytic space associated to $Y$, see
\cite{Berkovich}. Another approach is championed by Huber. In his theory,
one drops the hypothesis that $\Spec(R/J)$ is a singleton, see
\cite{Huber-continuous-valuations}.
\end{remark}

\begin{lemma}
\label{lemma-monomorphism-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of formal algebraic
spaces. Assume $X$ and $Y$ are locally Noetherian, $f$ locally of finite
type, and $f$ a monomorphism. Then $f$ is rig surjective if and only if
every adic morphism $\text{Spf}(R) \to Y$ where $R$ is a complete discrete
valuation ring factors through $X$.
\end{lemma}

\begin{proof}
One direction is trivial. For the other, suppose that $\text{Spf}(R) \to Y$
is an adic morphism such that there exists an extension of complete
discrete valuation rings $R \subset R'$ with
$\text{Spf}(R') \to \text{Spf}(R) \to X$ factoring through $Y$. Then
$\Spec(R'/\mathfrak m_R^n R') \to \Spec(R/\mathfrak m_R^n)$ is surjective
and flat, hence the morphisms $\Spec(R/\mathfrak m_R^n) \to X$ factor
through $X$ as $X$ satisfies the sheaf condition for fpqc coverings, see
Formal Spaces, Lemma \ref{formal-spaces-lemma-sheaf-fpqc}.
In other words, $\text{Spf}(R) \to Y$ factors through $X$.
\end{proof}





\section{Algebraization}
\label{section-algebraization}

\noindent
In this section we prove a generalization of the result on dilatations
from the paper of Artin \cite{ArtinII}. We first reformulate the algebra
results proved above into the language of formal algebraic spaces.

\medskip\noindent
Let $S$ be a scheme. Let $V$ be a locally Noetherian formal algebraic space
over $S$. We denote $\mathcal{C}_V$ the category of formal algebraic
spaces $W$ over $V$ such that the structure morphism $W \to V$ is rig-\'etale.

\medskip\noindent
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. Recall that $X_{/T}$ denotes
the formal completion of $X$ along $T$, see 
Formal Spaces, Section \ref{formal-spaces-section-completion}.
More generally, for any algebraic space $Y$ over $X$ we
denote $Y_{/T}$ the completion of $Y$ along the inverse
image of $T$ in $|Y|$, so that $Y_{/T}$ is a formal algebraic space
over $X_{/T}$.

\begin{lemma}
\label{lemma-etale-gives-rig-etale}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. If $Y \to X$ is morphism of
algebraic spaces which is locally of finite type and \'etale over
$X \setminus T$, then $Y_{/T} \to X_{/T}$ is rig-\'etale, i.e., $Y_{/T}$
is an object of $\mathcal{C}_{X_{/T}}$ defined above.
\end{lemma}

\begin{proof}
Choose a surjective \'etale morphism $U \to X$ with $U = \coprod U_i$
a disjoint union of affine schemes, see Properties of Spaces, Lemma
\ref{spaces-properties-lemma-cover-by-union-affines}.
For each $i$ choose a surjective \'etale morphism $V_i \to Y \times_X U_i$
where $V_i = \coprod V_{ij}$ is a disjoint union of affines.
Write $U_i = \Spec(A_i)$ and $V_{ij} = \Spec(B_{ij})$.
Let $I_i \subset A_i$ be an ideal cutting out the inverse image
of $T$ in $U_i$. Then we may apply
Lemma \ref{lemma-rig-etale}
to see that the map of $I_i$-adic completions
$A_i^\wedge \to B_{ij}^\wedge$ has the property
$P$ of Lemma \ref{lemma-rig-etale-axioms}.
Since $\{\text{Spf}(A_i^\wedge) \to X_{/T}\}$ and
$\{\text{Spf}(B_{ij}) \to Y_{/T}\}$ are coverings as in
Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}
we see that $Y_{/T} \to X_{/T}$ is rig-\'etale by definition.
\end{proof}

\begin{lemma}
\label{lemma-algebraize-morphism-rig-etale}
Let $X$ be a Noetherian affine scheme. Let $T \subset X$ be a closed subset.
Let $U$ be an affine scheme and let $U \to X$ a finite type morphism
\'etale over $X \setminus T$. Let $V$ be a Noetherian affine scheme over $X$.
For any morphism $c' : V_{/T} \to U_{/T}$ over $X_{/T}$ there exists
an \'etale morphism $b : V' \to V$ of affine schemes which induces an
isomorphism $b_{/T} : V'_{/T} \to V_{/T}$ and a morphism $a : V' \to U$
such that $c' = a_{/T} \circ b_{/T}^{-1}$.
\end{lemma}

\begin{proof}
This is a reformulation of
Lemma \ref{lemma-fully-faithful-etale-over-complement}.
\end{proof}

\begin{lemma}
\label{lemma-algebraize-rig-etale-affine}
Let $X$ be a Noetherian affine scheme. Let $T \subset X$ be a closed subset.
Let $W \to X_{/T}$ be a rig-\'etale morphism of formal algebraic
spaces with $W$ an affine formal algebraic space. Then there exists
an affine scheme $U$, a finite type morphism $U \to X$ \'etale over
$X \setminus T$ such that $W \cong U_{/T}$.
Moreover, if $W \to X_{/T}$ is \'etale, then $U \to X$ is \'etale.
\end{lemma}

\begin{proof}
The existence of $U$ is a restatement of
Lemma \ref{lemma-approximate-by-etale-over-complement}.
The final statement follows from
More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}.
\end{proof}

\noindent
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$
and let $T \subset |X|$ be a closed subset. Let us denote
$\mathcal{C}_{X, T}$ the category of algebraic spaces $Y$ over $X$
such that the structure morphism $f : Y \to X$
is locally of finite type and an isomorphism over the complement of
$T$. Formal completion defines a functor
\begin{equation}
\label{equation-completion-functor}
F_{X, T} : \mathcal{C}_{X, T} \longrightarrow \mathcal{C}_{X_{/T}},\quad
(f : Y \to X) \longmapsto (f_{/T} : Y_{/T} \to X_{/T})
\end{equation}
see Lemma \ref{lemma-etale-gives-rig-etale}.

\begin{lemma}
\label{lemma-factor}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Z \to Y$ be morphisms
of algebraic spaces. Let $T \subset |X|$ be closed.
Assume that
\begin{enumerate}
\item $X$ is locally Noetherian,
\item $g$ is a monomorphism and locally of finite type,
\item $f|_{X \setminus T} : X \setminus T \to Y$ factors through $g$, and
\item $f_{/T} : X_{/T} \to Y$ factors through $g$,
\end{enumerate}
then $f$ factors through $g$.
\end{lemma}

\begin{proof}
Consider the fibre product $E = X \times_Y Z \to X$.
By assumption the open immersion $X \setminus T \to X$
factors through $E$ and any morphism $\varphi : X' \to X$ with
$|\varphi|(|X'|) \subset T$ factors through $E$ as well, see
Formal Spaces, Section \ref{formal-spaces-section-completion}.
By More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}
this implies that $E \to X$ is \'etale at every point of $E$
mapping to a point of $T$. Hence $E \to X$ is an \'etale
monomorphism, hence an open immersion
(Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-etale-universally-injective-open}).
Then it follows that $E = X$ since our assumptions imply that $|X| = |E|$.
\end{proof}

\begin{lemma}
\label{lemma-faithful}
Let $S$ be a scheme. Let $X$, $Y$ be locally Noetherian algebraic spaces
over $S$. Let $T \subset |X|$ and $T' \subset |Y|$ be closed subsets.
Let $a, b : X \to Y$ be morphisms of algebraic spaces over $S$ such
that $a|_{X \setminus T} = b|_{X \setminus T}$, such that
$|a|(T) \subset T'$ and $|b|(T) \subset T'$, and such that
$a_{/T} = b_{/T}$ as morphisms $X_{/T} \to Y_{/T'}$.
Then $a = b$.
\end{lemma}

\begin{proof}
Let $E$ be the equalizer of $a$ and $b$. Then $E$ is an algebraic space
and $E \to X$ is locally of finite type and a monomorphism, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-properties-diagonal}.
Our assumptions imply we can apply Lemma \ref{lemma-factor} to the two
morphisms $f = \text{id} : X \to X$ and $g : E \to X$ and the closed
subset $T$ of $|X|$.
\end{proof}

\begin{lemma}
\label{lemma-equivalence-relation}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space
over $S$. Let $T \subset |X|$ be a closed subset.
Let $s, t : R \to U$ be two morphisms of algebraic spaces over $X$.
Assume
\begin{enumerate}
\item $R$, $U$ are locally of finite type over $X$,
\item the base change of $s$ and $t$ to $X \setminus T$
is an \'etale equivalence relation, and
\item the formal completion
$(t_{/T}, s_{/T}) : R_{/T} \to U_{/T} \times_{X_{/T}} U_{/T}$
is an equivalence relation too.
\end{enumerate}
Then $(t, s) : R \to U \times_X U$ is an \'etale equivalence relation.
\end{lemma}

\begin{proof}
The morphisms $s, t : R \to U$ are \'etale over $X \setminus T$
by assumption. Since the formal completions of the maps
$s, t : R \to U$ are \'etale, we see that $s$ and $t$ are \'etale
for example by More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}.
Applying Lemma \ref{lemma-factor} to the morphisms
$\text{id} : R \times_{U \times_X U} R \to R \times_{U \times_X U} R$
and $\Delta : R \to R \times_{U \times_X U} R$ we conclude that
$(t, s)$ is a monomorphism. Applying it again to
$(t \circ \text{pr}_0, s \circ \text{pr}_1) :
R \times_{s, U, t} R \to U \times_X U$ and $(t, s) : R \to U \times_X U$
we find that ``transitivity'' holds. We omit the proof of
the other two axioms of an equivalence relation.
\end{proof}

\begin{remark}
\label{remark-smash-away-from-T}
Let $S$, $X$, and $T \subset |X|$ be as in (\ref{equation-completion-functor}).
Let $U \to X$ be an algebraic space over $X$ such that $U \to X$ is
locally of finite type and \'etale outside of $T$. We will construct a
factorization
$$
U \longrightarrow Y \longrightarrow X
$$
with $Y$ in $\mathcal{C}_{X, T}$ such that $U_{/T} \to Y_{/T}$ is an
isomorphism. We may assume the image of $U \to X$ contains
$X \setminus T$, otherwise we replace $U$ by $U \amalg (X \setminus T)$.
For an algebraic space $Z$ over $X$, let us denote $Z^\circ$
the open subspace which is the inverse image of $X \setminus T$.
Let
$$
R = U \amalg_{U^\circ} (U \times_X U)^\circ
$$
be the pushout of $U^\circ \to U$ and the diagonal morphism
$U^\circ \to U^\circ \times_X U^\circ = (U \times_X U)^\circ$.
Since $U^\circ \to X$ is \'etale, the diagonal is an open immersion
and we see that $R$ is an algebraic space (this follows for example
from Spaces, Lemma \ref{spaces-lemma-glueing-algebraic-spaces}).
The two projections $(U \times_X U)^\circ \to U$ extend to $R$
and we obtain two \'etale morphisms $s, t : R \to U$. Checking on each
piece separatedly we find that $R$ is an \'etale equivalence
relation on $U$. Set $Y = U/R$ which is an algebraic space by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}.
Since $U^\circ \to X \setminus T$ is a surjective \'etale morphism
and since $R^\circ = U^\circ \times_{X \setminus T} U^\circ$
we see that $Y^\circ \to X \setminus T$ is an isomorphism.
In other words, $Y \to X$ is an object of $\mathcal{C}_{X, T}$.
On the other hand, the morphism $U \to Y$ induces an isomorphism
$U_{/T} \to Y_{/T}$. Namely, the formal completion of $R$
along the inverse image of $T$ is equal to the formal completion of
$U$ along the inverse image of $T$ by our choice of $R$. By
our construction of the formal completion in
Formal Spaces, Section \ref{formal-spaces-section-completion}
we conclude that $U_{/T} = Y_{/T}$.
\end{remark}

\begin{lemma}
\label{lemma-dilatations-affine}
Let $S$ be a scheme. Let $X$ be a Noetherian affine algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. Then the functor $F_{X, T}$ is an
equivalence.
\end{lemma}

\noindent
Before we prove this lemma let us discuss an example. Suppose that
$S = \Spec(k)$, $X = \mathbf{A}^1_k$, and $T = \{0\}$. Then
$X_{/T} = \text{Spf}(k[[x]])$. Let $W = \text{Spf}(k[[x]] \times k[[x]])$.
Then the corresponding $Y$ is the affine line with zero doubled
(Schemes, Example \ref{schemes-example-affine-space-zero-doubled}).
Moreover, this is the output of the construction in
Remark \ref{remark-smash-away-from-T}
starting with $U = X \amalg X$.

\begin{proof}
For any scheme or algebraic space $Z$ over $X$, let us denote
$Z_0 \subset Z$ the inverse image of $T$ with the induced reduced
closed subscheme or subspace structure. Note that $Z_0 = (Z_{/T})_{red}$
is the reduction of the formal completion.

\medskip\noindent
The functor $F_{X, T}$ is faithful by Lemma \ref{lemma-faithful}.

\medskip\noindent
Let $Y, Y'$ be objects of $\mathcal{C}_{X, T}$ and let
$a' : Y_{/T} \to Y'_{/T}$ be a morphism in $\mathcal{C}_{X_{/T}}$.
To prove $F_{X, T}$ is fully faithful, we will construct a morphism
$a : Y \to Y'$ in $\mathcal{C}_{X, T}$ such that $a' = a_{/T}$.

\medskip\noindent
Let $U$ be an affine scheme and let $U \to Y$ be an \'etale morphism.
Because $U$ is affine, $U_0$ is affine and the image of
$U_0 \to Y_0 \to Y'_0$ is a quasi-compact subspace of $|Y'_0|$.
Thus we can choose an affine scheme $V$ and an \'etale morphism
$V \to Y'$ such that the image of $|V_0| \to |Y'_0|$
contains this quasi-compact subset. Consider the formal algebraic space
$$
W = U_{/T} \times_{Y'_{/T}} V_{/T}
$$
By our choice of $V$ the above, the map $W \to U_{/T}$ is surjective.
Thus there exists an affine formal algebraic space $W'$ and an \'etale
morphism $W' \to W$ such that $W' \to W \to U_{/T}$ is surjective.
Then $W' \to U_{/T}$ is \'etale.
By Lemma \ref{lemma-algebraize-rig-etale-affine} $W' = U'_{/T}$
for $U' \to U$ \'etale and $U'$ affine. Write $V = \Spec(C)$. By
Lemma \ref{lemma-algebraize-morphism-rig-etale} there exists an
\'etale morphism $U'' \to U'$ of affines which is an isomorphism on
completions and a morphism $U'' \to V$ whose completion is
the composition $U''_{/T} \to U'_{/T} \to W \to V_{/T}$.
Thus we get
$$
Y \longleftarrow U'' \longrightarrow Y'
$$
over $X$ agreeing with the given map on formal completions such that
the image of $U''_0 \to Y_0$ is the same as the image of $U_0 \to Y_0$.

\medskip\noindent
Taking a disjoint union of $U''$ as constructed in the previous
paragraph, we find a scheme $U$, an \'etale morphism $U \to Y$,
and a morphism $b : U \to Y'$ over $X$, such that the diagram
$$
\xymatrix{
U_{/T} \ar[d] \ar[rd]^{b_{/T}} \\
Y_{/T} \ar[r]^{a'} & Y'_{/T}
}
$$
is commutative and such that $U_0 \to Y_0$ is surjective.
Taking a disjoint union with the open $X \setminus T$ (which is also
open in $Y$ and $Y'$), we find that we may even assume that $U \to Y$
is a surjective \'etale morphism. Let $R = U \times_Y U$.
Then the two compositions $R \to U \to Y'$ agree both over $X \setminus T$
and after formal completion along $T$, whence are equal by
Lemma \ref{lemma-faithful}. This means exactly that $b$ factors as
$U \to Y \to Y'$ to give us our desired morphism $a : Y \to Y'$.

\medskip\noindent
Essential surjectivity. Let $W$ be an object of $\mathcal{C}_{X_{/T}}$.
We prove $W$ is in the essential image in a number of steps.

\medskip\noindent
Step 1: $W$ is an affine formal algebraic space. Then we can find
$U \to X$ of finite type and \'etale over $X \setminus T$ such that
$U_{/T}$ is isomorphic to $W$, see
Lemma \ref{lemma-algebraize-rig-etale-affine}.
Thus we see that $W$ is in the essential image by the construction
in Remark \ref{remark-smash-away-from-T}.

\medskip\noindent
Step 2: $W$ is separated. Choose $\{W_i \to W\}$ as in
Formal Spaces, Definition \ref{formal-spaces-definition-formal-algebraic-space}.
By Step 1 the formal algebraic spaces $W_i$ and $W_i \times_W W_j$
are in the essential image.
Say $W_i = (Y_i)_{/T}$ and $W_i \times_W W_j = (Y_{ij})_{/T}$.
By fully faithfulness we obtain morphisms $t_{ij} : Y_{ij} \to Y_i$
and $s_{ij} : Y_{ij} \to Y_j$ matching the projections
$W_i \times_W W_j \to W_i$ and $W_i \times_W W_j \to W_j$.
Set $R = \coprod Y_{ij}$ and $U = \coprod Y_i$ and denote
$s = \coprod s_{ij} : R \to U$ and $t = \coprod t_{ij} : R \to U$.
Applying Lemma \ref{lemma-equivalence-relation}
we find that $(t, s) : R \to U \times_X U$ is an \'etale equivalence relation.
Thus we can take the quotient $Y = U/R$ and it is an algebraic
space, see 
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}.
Since completion commutes with fibre products and taking
quotient sheaves, we find that $Y_{/T} \cong W$ in $\mathcal{C}_{X_{/T}}$.

\medskip\noindent
Step 3: $W$ is general. Choose $\{W_i \to W\}$ as in
Formal Spaces, Definition \ref{formal-spaces-definition-formal-algebraic-space}.
The formal algebraic spaces $W_i$ and $W_i \times_W W_j$ are separated.
Hence by Step 2  the formal algebraic spaces $W_i$ and $W_i \times_W W_j$
are in the essential image. Then we argue exactly as in the previous
paragraph to see that $W$ is in the essential image as well.
This concludes the proof.
\end{proof}

\begin{theorem}
\label{theorem-dilatations-general}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. The functor $F_{X, T}$
(\ref{equation-completion-functor})
$$
\left\{
\begin{matrix}
\text{algebraic spaces }Y\text{ locally of finite}\\
\text{type over }X\text{ such that }Y \to X\\
\text{is an isomorphism over }X \setminus T
\end{matrix}
\right\}
\longrightarrow
\left\{
\begin{matrix}
\text{formal algebraic spaces }W\text{ endowed} \\
\text{with a rig-\'etale morphism }W \to X_{/T}
\end{matrix}
\right\}
$$
given by formal completion is an equivalence.
\end{theorem}

\begin{proof}
The theorem is essentially a formal consequence of
Lemma \ref{lemma-dilatations-affine}. We give the details but
we encourage the reader to think it through for themselves.
Let $g : U \to X$ be a surjective \'etale morphism with $U = \coprod U_i$
and each $U_i$ affine. Denote $F_{U, T}$ the functor for $U$ and the
inverse image of $T$ in $|U|$.

\medskip\noindent
Since $U = \coprod U_i$ both the category $\mathcal{C}_{U, T}$ and
the category $\mathcal{C}_{U_{/T}}$ decompose as a product of categories,
one for each $i$. Since the functors $F_{U_i, T}$ are equivalences
for all $i$ by the lemma we find that the same is true for $F_{U, T}$.

\medskip\noindent
Since $F_{U, T}$ is faithful, it follows that $F_{X, T}$
is faithful too. Namely, if $a, b : Y \to Y'$ are morphisms
in $\mathcal{C}_{X, T}$ such that $a_{/T} = b_{/T}$, then we find
on pulling back that the base changes
$a_U, b_U : U \times_X Y \to U \times_X Y'$ are equal.
Since $U \times_X Y \to Y$ is surjective \'etale, this implies that $a = b$.

\medskip\noindent
At this point we know that $F_{X, T}$ is faithful for every situation
as in the theorem. Let $R = U \times_X U$ where $U$ is as above.
Let $t, s : R \to U$ be the projections.
Since $X$ is Noetherian, so is $R$. Thus the functor $F_{R, T}$
(defined in the obvious manner) is
faithful. Let $Y \to X$ and $Y' \to X$ be objects of $\mathcal{C}_{X, T}$.
Let $a' : Y_{/T} \to Y'_{/T}$ be a morphism in the category
$\mathcal{C}_{X_{/T}}$. Taking the base change to $U$ we obtain a
morphism $a'_U : (U \times_X Y)_{/T} \to (U \times_X Y')_{/T}$
in the category $\mathcal{C}_{U_{/T}}$. Since the functor $F_{U, T}$
is fully faithful we obtain a morphism $a_U : U \times_X Y \to U \times_X Y'$
with $F_{U, T}(a_U) = a'_U$. Since $s^*(a'_U) = t^*(a'_U)$ and since
$F_{R, T}$ is faithful, we find that $s^*(a_U) = t^*(a_U)$.
Since
$$
\xymatrix{
R \times_X Y \ar@<1ex>[r] \ar@<-1ex>[r] &
U \times_X Y \ar[r] & Y
}
$$
is an equalizer diagram of sheaves, we find that $a_U$ descends to
a morphism $a : Y \to Y'$. We omit the proof that $F_{X, T}(a) = a'$.

\medskip\noindent
At this point we know that $F_{X, T}$ is faithful for every situation
as in the theorem. To finish the proof we show that $F_{X, T}$ is
essentially surjective. Let $W \to X_{/T}$ be an object of
$\mathcal{C}_{X_{/T}}$. Then $U \times_X W$ is an object of
$\mathcal{C}_{U_{/T}}$. By the affine case we find an object
$V \to U$ of $\mathcal{C}_{U, T}$ and an isomorphism
$\alpha : F_{U, T}(V) \to U \times_X W$ in $\mathcal{C}_{U_{/T}}$.
By fully faithfulness of $F_{R, T}$ we find a unique morphism
$h : s^*V \to t^*V$ in the category $\mathcal{C}_{R, T}$ such that
$F_{R, T}(h)$ corresponds, via the isomorphism $\alpha$, to the
canonical descent datum on $U \times_X W$ in the category
$\mathcal{C}_{R_{/T}}$. Using faithfulness of our functor on
$R \times_{s, U, t} R$ we see that $h$ satisfies the cocycle
condition. We conclude, for example by the much more general
Bootstrap, Lemma \ref{bootstrap-lemma-descend-algebraic-space},
that there exists an object $Y \to X$ of $\mathcal{C}_{X, T}$
and an isomorphism $\beta : U \times_X Y \to V$ such that the
descent datum $h$ corresponds, via $\beta$, to the canonical descent
datum on $U \times_X Y$. We omit the verification that
$F_{X, T}(Y)$ is isomorphic to $W$; hint: in the category of formal
algebraic spaces there is descent for morphisms along \'etale coverings.
\end{proof}

\noindent
We are often interested as to whether the output of the construction
of Theorem \ref{theorem-dilatations-general} is a separated algebraic space.
In the next few lemmas we match properties of $Y \to X$ and the corresponding
completion $Y_{/T} \to X_{/T}$.

\begin{lemma}
\label{lemma-output-quasi-compact}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. Let $W \to X_{/T}$ be an object
of the category $\mathcal{C}_{X_{/T}}$ and let $Y \to X$ be the object
corresponding to $W$ via Theorem \ref{theorem-dilatations-general}.
Then $Y \to X$ is quasi-compact if and only if $W \to X_{/T}$ is so.
\end{lemma}

\begin{proof}
These conditions may be checked after base change to an affine
scheme \'etale over $X$, resp.\ a formal affine algebraic space
\'etale over $X_{/T}$, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-quasi-compact-local}
as well as Formal Spaces, Lemma
\ref{formal-spaces-lemma-characterize-quasi-compact-morphism}.
If $U \to X$ ranges over \'etale morphisms with $U$ affine, then
the formal completions $U_{/T} \to X_{/T}$ give a family
of formal affine coverings as in Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}.
Thus we may and do assume $X$ is affine.

\medskip\noindent
Let $V \to Y$ be a surjective \'etale morphism
where $V = \coprod_{j \in J} V_j$ is a disjoint union of affines. Then
$V_{/T} \to Y_{/T} = W$ is a surjective \'etale morphism.
Thus if $Y$ is quasi-compact, we can choose $J$ is finite, and
we conclude that $W$ is quasi-compact. Conversely, if $W$ is
quasi-compact, then we can find a finite subset $J' \subset J$
such that $\coprod_{j \in J'} (V_j)_{/T} \to W$ is surjective.
Then it follows that
$$
(X \setminus T) \amalg \coprod\nolimits_{j \in J'} V_j \longrightarrow Y
$$
is surjective. This either follows from the construction of
$Y$ in the proof of Lemma \ref{lemma-dilatations-affine}
or it follows since we have
$$
|Y| = |X \setminus T| \amalg |W_{red}|
$$
as $Y_{/T} = W$.
\end{proof}

\begin{lemma}
\label{lemma-output-quasi-separated}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. Let $W \to X_{/T}$ be an object
of the category $\mathcal{C}_{X_{/T}}$ and let $Y \to X$ be the object
corresponding to $W$ via Theorem \ref{theorem-dilatations-general}.
Then $Y \to X$ is quasi-separated if and only if $W \to X_{/T}$ is so.
\end{lemma}

\begin{proof}
These conditions may be checked after base change to an affine
scheme \'etale over $X$, resp.\ a formal affine algebraic space
\'etale over $X_{/T}$, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-separated-local}
as well as
Formal Spaces, Lemma
\ref{formal-spaces-lemma-separated-local},
If $U \to X$ ranges over \'etale morphisms with $U$ affine, then
the formal completions $U_{/T} \to X_{/T}$ give a family
of formal affine coverings as in Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}.
Thus we may and do assume $X$ is affine.

\medskip\noindent
Let $V \to Y$ be a surjective \'etale morphism
where $V = \coprod_{j \in J} V_j$ is a disjoint union of affines.
Then $Y$ is quasi-separated if and only if $V_j \times_Y V_{j'}$ is
quasi-compact for all $j, j' \in J$. Similarly, $W$ is quasi-separated
if and only if
$(V_j \times_Y V_{j'})_{/T} = (V_j)_{/T} \times_{Y_{/T}} (V_{j'})_{/T}$
is quasi-compact for all $j, j' \in J$. Since $X$ is Noetherian affine,
we see that
$$
(V_j \times_Y V_{j'}) \times_X (X \setminus T)
$$
is quasi-compact. Hence we conclude the equivalence holds by the equality
$$
|V_j \times_Y V_{j'}| =
|(V_j \times_Y V_{j'}) \times_X (X \setminus T)| \amalg
|(V_j \times_Y V_{j'})_{/T}|
$$
and the fact that the second summand is closed in the left hand side.
\end{proof}

\begin{lemma}
\label{lemma-output-separated}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. Let $W \to X_{/T}$ be an object
of the category $\mathcal{C}_{X_{/T}}$ and let $Y \to X$ be the object
corresponding to $W$ via Theorem \ref{theorem-dilatations-general}.
Then $Y \to X$ is separated if and only if $W \to X_{/T}$ is
separated and $\Delta : W \to W \times_{X_{/T}} W$ is rig-surjective.
\end{lemma}

\begin{proof}
These conditions may be checked after base change to an affine
scheme \'etale over $X$, resp.\ a formal affine algebraic space
\'etale over $X_{/T}$, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-separated-local}
as well as
Formal Spaces, Lemma \ref{formal-spaces-lemma-separated-local}.
If $U \to X$ ranges over \'etale morphisms with $U$ affine, then
the formal completions $U_{/T} \to X_{/T}$ give a family
of formal affine coverings as in Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}.
Thus we may and do assume $X$ is affine.
In the proof of both directions we may assume that $Y \to X$ and
$W \to X_{/T}$ are quasi-separated by
Lemma \ref{lemma-output-quasi-separated}.

\medskip\noindent
Proof of easy direction. Assume $Y \to X$ is separated.
Then $Y \to Y \times_X Y$ is a closed immersion and it follows that
$W \to W \times_{X_{/T}} W$ is a closed immersion too, i.e., we see
that $W \to X_{/T}$ is separated. Let
$$
p : \text{Spf}(R) \longrightarrow W \times_{X_{/T}} W = (Y \times_X Y)_{/T}
$$
be an adic morphism where $R$ is a complete discrete valuation ring with
fraction field $K$. The composition into $Y \times_X Y$ corresponds to
a morphism $g : \Spec(R) \to Y \times_X Y$, see
Formal Spaces, Lemma \ref{formal-spaces-lemma-map-into-algebraic-space}.
Since $p$ is an adic morphism, so is the composition $\text{Spf}(R) \to X$.
Thus we see that $g(\Spec(K))$ is a point of
$$
(Y \times_X Y) \times_X (X \setminus T) \cong
X \setminus T \cong
Y \times_X (X \setminus T)
$$
(small detail omitted). Hence this lifts to a $K$-point of $Y$ and
we obtain a commutative diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & Y \ar[d] \\
\Spec(R) \ar[r] \ar@{-->}[ru] & Y \times_X Y
}
$$
Since $Y \to X$ was assumed separated we find the dotted arrow exists
(Cohomology of Spaces, Lemma
\ref{spaces-cohomology-lemma-check-separated-dvr}).
Applying the functor completion along $T$ we find that $p$ can be
lifted to a morphism into $W$, i.e., $W \to W \times_{X_{/T}} W$ is
rig-surjective.

\medskip\noindent
Proof of hard direction. Assume $W \to X_{/T}$ separated and
$W \to W \times_{X_{/T}} W$ rig-surjective. By
Cohomology of Spaces, Lemma
\ref{spaces-cohomology-lemma-check-separated-dvr} and
Remark \ref{spaces-cohomology-remark-variant}
it suffices to show that given any commutative diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & Y \ar[d] \\
\Spec(R) \ar[r]^g \ar@{-->}[ru] & Y \times_X Y
}
$$
where $R$ is a complete discrete valuation ring with fraction field $K$,
there is at most one dotted arrow making the diagram commute. Let
$h : \Spec(R) \to X$ be the composition of $g$ with the morphism
$Y \times_X Y \to X$. There are three cases:
Case I: $h(\Spec(R)) \subset (X \setminus T)$. This case is trivial
because $Y \times_X (X \setminus T) = X \setminus T$.
Case II: $h$ maps $\Spec(R)$ into $T$. This case follows
from our assumption that $W \to X_{/T}$ is separated. Namely,
if $T$ denotes the reduced induced closed subspace structure
on $T$, then $h$ factors through $T$ and
$$
W \times_{X_{/T}} T = Y \times_X T \longrightarrow T
$$
is separated by assumption (and for example
Formal Spaces, Lemma \ref{formal-spaces-lemma-separated-local})
which implies we get the lifting property by
Cohomology of Spaces, Lemma \ref{spaces-cohomology-lemma-check-separated-dvr}
applied to the displayed arrow. Case III: $h(\Spec(K))$ is not in $T$
but $h$ maps the closed point of $\Spec(R)$ into $T$. In this case
the corresponding morphism
$$
g_{/T} :
\text{Spf}(R)
\longrightarrow
(Y \times_X Y)_{/T} =
W \times_{X_{/T}} W
$$
is an adic morphism (detail omitted). Hence our assumption that
$W \to W \times_{X_{/T}} W$ be rig-surjective implies we can lift
$g_{/T}$ to a morphism $e : \text{Spf}(R) \to W = Y_{/T}$ (see
Lemma \ref{lemma-monomorphism-rig-surjective}
for why we do not need to extend $R$).
Algebraizing the composition $\text{Spf}(R) \to Y$ using
Formal Spaces, Lemma \ref{formal-spaces-lemma-map-into-algebraic-space}
we find a morphism $\Spec(R) \to Y$ lifting $g$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-output-proper}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. Let $W \to X_{/T}$ be an object
of the category $\mathcal{C}_{X_{/T}}$ and let $Y \to X$ be the object
corresponding to $W$ via Theorem \ref{theorem-dilatations-general}.
Then $Y \to X$ is proper if and only if the following conditions hold
\begin{enumerate}
\item $W \to X_{/T}$ is proper,
\item $W \to X_{/T}$ is rig-surjective, and
\item $\Delta : W \to W \times_{X_{/T}} W$ is rig-surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
These conditions may be checked after base change to an affine
scheme \'etale over $X$, resp.\ a formal affine algebraic space
\'etale over $X_{/T}$, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-proper-local}
as well as
Formal Spaces, Lemma \ref{formal-spaces-lemma-proper-local}.
If $U \to X$ ranges over \'etale morphisms with $U$ affine, then
the formal completions $U_{/T} \to X_{/T}$ give a family
of formal affine coverings as in Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}.
Thus we may and do assume $X$ is affine.
In the proof of both directions we may assume that $Y \to X$
and $W \to X_{/T}$ are separated and quasi-compact and that
$W \to W \times_{X_{/T}} W$ is rig-surjective by
Lemmas \ref{lemma-output-quasi-compact} and \ref{lemma-output-separated}.

\medskip\noindent
Proof of the easy direction. Assume $Y \to X$ is proper.
Then $Y_{/T} = Y \times_X X_{/T} \to X_{/T}$ is proper too.
Let
$$
p : \text{Spf}(R) \longrightarrow X_{/T}
$$
be an adic morphism where $R$ is a complete discrete valuation ring with
fraction field $K$. Then $p$ corresponds to a morphism $g : \Spec(R) \to X$,
see
Formal Spaces, Lemma \ref{formal-spaces-lemma-map-into-algebraic-space}.
Since $p$ is an adic morphism, we have $p(\Spec(K)) \not \in T$.
Since $Y \to X$ is an isomorphism over $X \setminus T$ we can lift
to $X$ and obtain a commutative diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & Y \ar[d] \\
\Spec(R) \ar[r] \ar@{-->}[ru] & X
}
$$
Since $Y \to X$ was assumed proper we find the dotted arrow exists.
(Cohomology of Spaces, Lemma
\ref{spaces-cohomology-lemma-check-proper-dvr}).
Applying the functor completion along $T$ we find that $p$ can be
lifted to a morphism into $W$, i.e., $W \to X_{/T}$ is
rig-surjective.

\medskip\noindent
Proof of hard direction. Assume $W \to X_{/T}$ proper,
$W \to W \times_{X_{/T}} W$ rig-surjective, and $W \to X_{/T}$
rig-surjective. By
Cohomology of Spaces, Lemma \ref{spaces-cohomology-lemma-check-proper-dvr} and
Remark \ref{spaces-cohomology-remark-variant}
it suffices to show that given any commutative diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & Y \ar[d] \\
\Spec(R) \ar[r]^g \ar@{-->}[ru] & X
}
$$
where $R$ is a complete discrete valuation ring with fraction field $K$,
there is a dotted arrow making the diagram commute. Let
$h : \Spec(R) \to X$ be the composition of $g$ with the morphism
$Y \times_X Y \to X$. There are three cases:
Case I: $h(\Spec(R)) \subset (X \setminus T)$. This case is trivial
because $Y \times_X (X \setminus T) = X \setminus T$.
Case II: $h$ maps $\Spec(R)$ into $T$. This case follows
from our assumption that $W \to X_{/T}$ is proper. Namely,
if $T$ denotes the reduced induced closed subspace structure
on $T$, then $h$ factors through $T$ and
$$
W \times_{X_{/T}} T = Y \times_X T \longrightarrow T
$$
is proper by assumption which implies we get the lifting property by
Cohomology of Spaces, Lemma \ref{spaces-cohomology-lemma-check-proper-dvr}
applied to the displayed arrow. Case III: $h(\Spec(K))$ is not in $T$
but $h$ maps the closed point of $\Spec(R)$ into $T$. In this case
the corresponding morphism
$$
g_{/T} : \text{Spf}(R) \longrightarrow Y_{/T} = W
$$
is an adic morphism (detail omitted). Hence our assumption that
$W \to X_{/T}$ be rig-surjective implies we can lift
$g_{/T}$ to a morphism $e : \text{Spf}(R') \to W = Y_{/T}$
for some extension of complete discrete valuation rings $R \subset R'$.
Algebraizing the composition $\text{Spf}(R') \to Y$ using
Formal Spaces, Lemma \ref{formal-spaces-lemma-map-into-algebraic-space}
we find a morphism $\Spec(R') \to Y$ lifting $g$. By the discussion
in Cohomology of Spaces, Remark \ref{spaces-cohomology-remark-variant}
this is sufficient to conclude that $Y \to X$ is proper.
\end{proof}





\section{Application to modifications}
\label{section-modifications}

\noindent
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. We set
$S = \Spec(A)$ and $U = S \setminus V(I)$. In this section
we will consider the category
\begin{equation}
\label{equation-modification}
\left\{
f : X \longrightarrow S
\quad \middle| \quad
\begin{matrix}
X\text{ is an algebraic space}\\
f\text{ is locally of finite type}\\
f^{-1}(U) \to U\text{ is an isomorphism}
\end{matrix}
\right\}
\end{equation}
A morphism from $X/S$ to $X'/S$ will be a morphism of algebraic spaces
$X \to X'$ compatible with the structure morphisms over $S$.

\medskip\noindent
Let $A \to B$ be a homomorphism of Noetherian rings and let $J \subset B$
be an ideal such that $J = \sqrt{I B}$. Then base
change along the morphism $\Spec(B) \to \Spec(A)$ gives a functor
from the category (\ref{equation-modification}) for $A$
to the category (\ref{equation-modification}) for $B$.

\begin{lemma}
\label{lemma-Noetherian-local-ring}
Let $(A, I)$ be a pair consisting of a Noetherian ring and an ideal $I$.
Let $A^\wedge$ be the $I$-adic completion of $A$. Then base change defines
an equivalence of categories between the category (\ref{equation-modification})
for $A$ with the category (\ref{equation-modification}) for the completion
$A^\wedge$.
\end{lemma}

\begin{proof}
Set $S = \Spec(A)$ as in (\ref{equation-modification}) and $T = V(I)$.
Similarly, write $S' = \Spec(A^\wedge)$ and $T' = V(IA^\wedge)$.
The morphism $S' \to S$ defines an isomorphism $S'_{/T'} \to S_{/T}$
of formal completions. Let $\mathcal{C}_{S, T}$, $\mathcal{C}_{S_{/T}}$,
$\mathcal{C}_{S'_{/T'}}$, and $\mathcal{C}_{S', T'}$ be the corresponding
categories as used in (\ref{equation-completion-functor}).
By Theorem \ref{theorem-dilatations-general} (in fact we only need
the affine case treated in Lemma \ref{lemma-dilatations-affine})
we see that
$$
\mathcal{C}_{S, T} = \mathcal{C}_{S_{/T}} =
\mathcal{C}_{S_{/T'}'} = \mathcal{C}_{S', T'}
$$
Since $\mathcal{C}_{S, T}$ is the category (\ref{equation-modification})
for $A$ and $\mathcal{C}_{S', T'}$ the category (\ref{equation-modification})
for $A^\wedge$ this proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-Noetherian-local-ring-properties}
Notation and assumptions as in Lemma \ref{lemma-Noetherian-local-ring}.
Let $f : X \to \Spec(A)$ correspond to $g : Y \to \Spec(A^\wedge)$
via the equivalence. Then $f$ is quasi-compact, quasi-separated, separated,
proper, finite, and add more here if and only if $g$ is so.
\end{lemma}

\begin{proof}
You can deduce this for the statements
quasi-compact, quasi-separated, separated, and proper
by using Lemmas \ref{lemma-output-quasi-compact}
\ref{lemma-output-quasi-separated},
\ref{lemma-output-separated},
\ref{lemma-output-quasi-separated}, and
\ref{lemma-output-proper}
to translate the corresponding property into a property
of the formal completion and using the argument of the proof
of Lemma \ref{lemma-Noetherian-local-ring}.
However, there is a direct argument using fpqc descent as follows.
First, note that $\{U \to \Spec(A), \Spec(A^\wedge) \to \Spec(A)\}$ is an
fpqc covering with $U = \Spec(A) \setminus V(I)$ as before.
The base change of $f$ by $U \to \Spec(A)$ is $\text{id}_U$
by definition of our category (\ref{equation-modification}).
Let $P$ be a property of morphisms of algebraic spaces which
is fpqc local on the base (Descent on Spaces, Definition
\ref{spaces-descent-definition-property-morphisms-local})
such that $P$ holds for identity morphisms.
Then we see that $P$ holds for $f$ if and only if $P$ holds for $g$.
This applies to $P$ equal to
quasi-compact, quasi-separated, separated, proper, and finite
by
Descent on Spaces, Lemmas
\ref{spaces-descent-lemma-descending-property-quasi-compact},
\ref{spaces-descent-lemma-descending-property-quasi-separated},
\ref{spaces-descent-lemma-descending-property-separated},
\ref{spaces-descent-lemma-descending-property-proper}, and
\ref{spaces-descent-lemma-descending-property-finite}.
\end{proof}

\begin{lemma}
\label{lemma-equivalence-to-completion}
Let $A \to B$ be a local map of local Noetherian rings such that
\begin{enumerate}
\item $A \to B$ is flat,
\item $\mathfrak m_B = \mathfrak m_A B$, and
\item $\kappa(\mathfrak m_A) = \kappa(\mathfrak m_B)$
\end{enumerate}
(equivalently, $A \to B$ induces an isomorphism on completions, see
More on Algebra, Lemma \ref{more-algebra-lemma-flat-unramified}).
Then the base change functor from the category
(\ref{equation-modification}) for $(A, \mathfrak m_A)$ to the category
(\ref{equation-modification}) for $(B, \mathfrak m_B)$
is an equivalence.
\end{lemma}

\begin{proof}
This follows immediately from Lemma \ref{lemma-Noetherian-local-ring}.
\end{proof}

\begin{lemma}
\label{lemma-dominate-by-admissible-blowup}
Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring.
Let $f : X \to S$ be an object of (\ref{equation-modification}).
Then there exists a $U$-admissible blowup $S' \to S$
which dominates $X$.
\end{lemma}

\begin{proof}
Special case of More on Morphisms of Spaces,
Lemma \ref{spaces-more-morphisms-lemma-dominate-modification-by-blowup}.
\end{proof}




\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}

