\input{preamble}

% OK, start here.
%
\begin{document}

\title{Algebraization of Formal Spaces}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
The main goal of this chapter is to prove Artin's theorem on dilatations,
see Theorem \ref{theorem-dilatations}; the result on contractions will be
discussed in Artin's Axioms, Section \ref{artin-section-contractions}.
Both results use some material on formal algebraic spaces, hence
in the middle part of this chapter, we
continue the discussion of formal algebraic spaces from the previous
chapter, see Formal Spaces, Section \ref{formal-spaces-section-introduction}.
The first part of this chapter is dedicated to algebraic preliminaries,
mostly dealing with algebraization of rig-\'etale algebras.

\medskip\noindent
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. In the
first part of this chapter (Sections \ref{section-two-categories}
-- \ref{section-approximation-principal})
we discuss the category of $I$-adically complete algebras $B$
topologically of finite type over a Noetherian ring $A$.
It is shown that $B = A\{x_1, \ldots, x_n\}/J$ for some
(closed) ideal $J$ in the restricted power series ring
(where $A$ is endowed with the $I$-adic topology).
We show there is a good notion of a naive cotangent complex
$\NL_{B/A}^\wedge$. If some power of $I$ annihilates
$\NL_{B/A}^\wedge$, then we say $B$ is a rig-\'etale algebra
over $(A, I)$; there is a similar notion of rig-smooth algebras.
If $A$ is a G-ring, then we can show, using Popescu's theorem,
that any rig-smooth algebra $B$ over $(A, I)$ is the completion
of a finite type $A$-algebra; informally we say that we can ``algebraize'' $B$.
However, the main result of the first part is that any rig-\'etale
algebra $B$ over $(A, I)$ can be algebraized, see
Lemma \ref{lemma-approximate}.
One thing to note here is that we prove this without assuming
the ring $A$ is a G-ring.

\medskip\noindent
Many of the results discussed in the first part can be found in the paper
\cite{Elkik}. Other general references for this part are
\cite{EGA}, \cite{Abbes}, and \cite{Fujiwara-Kato}.

\medskip\noindent
In the second part of this chapter
(Sections \ref{section-finite-type-red} -- \ref{section-formal-modifications})
we talk about types of morphisms of formal algebraic spaces
in a reasonable level of generality (mostly for locally Noetherian
formal algebraic spaces). The most interesting of these is
the notion of a ``formal modification'' in the last section.
We carefully check that our definition agrees with
Artin's definition in \cite{ArtinII}.

\medskip\noindent
Finally, in the third and last part of this chapter
(Sections \ref{section-completion-and-morphisms} --
\ref{section-modifications}) we prove the main theorem and
we give a few applications.
In fact, we deduce Artin's theorem from a stronger
result, namely, Theorem \ref{theorem-dilatations-general}.
This theorem says very roughly: if $f : \mathfrak X \to \mathfrak X'$
is a rig-\'etale morphism and $\mathfrak X'$ is the formal
completion of a locally Noetherian algebraic space, then so
is $\mathfrak X$. In Artin's work the morphism $f$ is assumed proper
and rig-surjective.









\section{Two categories}
\label{section-two-categories}

\noindent
Let $A$ be a ring and let $I \subset A$ be an ideal.
In this section ${}^\wedge$ will mean $I$-adic completion.
Set $A_n = A/I^n$ so that the $I$-adic completion of $A$ is
$A^\wedge = \lim A_n$. Let $\mathcal{C}$ be the
category
\begin{equation}
\label{equation-C}
\mathcal{C} =
\left\{
\begin{matrix}
\text{inverse systems }\ldots \to B_3 \to B_2 \to B_1 \\
\text{where }B_n\text{ is a finite type }A_n\text{-algebra,}\\
B_{n + 1} \to B_n\text{ is an }A_{n + 1}\text{-algebra map}\\
\text{which induces }B_{n + 1}/I^nB_{n + 1} \cong B_n
\end{matrix}
\right\}
\end{equation}
Morphisms in $\mathcal{C}$ are given by systems of homomorphisms.
Let $\mathcal{C}'$ be the category
\begin{equation}
\label{equation-C-prime}
\mathcal{C}' =
\left\{
\begin{matrix}
A\text{-algebras }B\text{ which are }I\text{-adically complete}\\
\text{such that }B/IB\text{ is of finite type over }A/I
\end{matrix}
\right\}
\end{equation}
Morphisms in $\mathcal{C}'$ are $A$-algebra maps. There is a functor
\begin{equation}
\label{equation-from-complete-to-systems}
\mathcal{C}' \longrightarrow \mathcal{C},\quad
B \longmapsto (B/I^nB)
\end{equation}
Indeed, since $B/IB$ is of finite type over $A/I$ the ring maps
$A_n = A/I^n \to B/I^nB$ are of finite type by
Algebra, Lemma \ref{algebra-lemma-finite-type-mod-nilpotent}.

\begin{lemma}
\label{lemma-topologically-finite-type}
Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal.
The functor
$$
\mathcal{C} \longrightarrow \mathcal{C}',\quad
(B_n) \longmapsto B = \lim B_n
$$
is a quasi-inverse to (\ref{equation-from-complete-to-systems}).
The completions $A[x_1, \ldots, x_r]^\wedge$ are in $\mathcal{C}'$ and
any object of $\mathcal{C}'$ is of the form
$$
B = A[x_1, \ldots, x_r]^\wedge / J
$$
for some ideal $J \subset A[x_1, \ldots, x_r]^\wedge$.
\end{lemma}

\begin{proof}
Let $(B_n)$ be an object of $\mathcal{C}$. By
Algebra, Lemma \ref{algebra-lemma-limit-complete}
we see that $B = \lim B_n$ is $I$-adically complete
and $B/I^nB = B_n$. Hence we see that $B$ is an object of
$\mathcal{C}'$ and that we can recover the object $(B_n)$ 
by taking the quotients.
Conversely, if $B$ is an object of $\mathcal{C}'$, then
$B = \lim B/I^nB$ by assumption. Thus $B \mapsto (B/I^nB)$ is a quasi-inverse
to the functor of the lemma.

\medskip\noindent
Since $A[x_1, \ldots, x_r]^\wedge = \lim A_n[x_1, \ldots, x_r]$
it is an object of $\mathcal{C}'$ by the first statement of the lemma.
Finally, let $B$ be an object of $\mathcal{C}'$. Choose
$b_1, \ldots, b_r \in B$ whose images in $B/IB$ generate
$B/IB$ as an algebra over $A/I$. Since $B$ is $I$-adically
complete, the $A$-algebra map $A[x_1, \ldots, x_r] \to B$, $x_i \mapsto b_i$
extends to an $A$-algebra map $A[x_1, \ldots, x_r]^\wedge \to B$.
To finish the proof we have to show this map is surjective
which follows from Algebra, Lemma \ref{algebra-lemma-completion-generalities}
as our map $A[x_1, \ldots, x_r] \to B$ is surjective modulo $I$
and as $B = B^\wedge$.
\end{proof}

\noindent
We warn the reader that, in case $A$ is not Noetherian, the
quotient of an object of $\mathcal{C}'$ may not be an object
of $\mathcal{C}'$. See Examples, Lemma
\ref{examples-lemma-noncomplete-quotient}.
Next we show this does not happen when $A$ is Noetherian.

\begin{lemma}
\label{lemma-topologically-finite-type-Noetherian}
\begin{reference}
\cite[Proposition 7.5.5]{EGA1}
\end{reference}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. Then
\begin{enumerate}
\item every object of the category $\mathcal{C}'$
(\ref{equation-C-prime}) is Noetherian,
\item if $B \in \Ob(\mathcal{C}')$ and $J \subset B$ is an ideal,
then $B/J$ is an object of $\mathcal{C}'$,
\item for a finite type $A$-algebra $C$ the $I$-adic completion
$C^\wedge$ is in $\mathcal{C}'$,
\item in particular the completion $A[x_1, \ldots, x_r]^\wedge$
is in $\mathcal{C}'$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (4) follows from
Algebra, Lemma \ref{algebra-lemma-completion-Noetherian-Noetherian}
as $A[x_1, \ldots, x_r]$ is Noetherian
(Algebra, Lemma \ref{algebra-lemma-Noetherian-permanence}).
To see (1) by Lemma \ref{lemma-topologically-finite-type}
we reduce to the case of the completion of the polynomial ring
which we just proved.
Part (2) follows from Algebra, Lemma \ref{algebra-lemma-completion-tensor}
which tells us that ever finite $B$-module is $IB$-adically complete.
Part (3) follows in the same manner as part (4).
\end{proof}

\begin{remark}[Base change]
\label{remark-base-change}
Let $\varphi : A_1 \to A_2$ be a ring map and let
$I_i \subset A_i$ be ideals such that $\varphi(I_1^c) \subset I_2$
for some $c \geq 1$. This induces ring maps
$A_{1, cn} = A_1/I_1^{cn} \to A_2/I_2^n = A_{2, n}$ for all $n \geq 1$.
Let $\mathcal{C}_i$ be the category (\ref{equation-C}) for $(A_i, I_i)$.
There is a base change functor
\begin{equation}
\label{equation-base-change-systems}
\mathcal{C}_1 \longrightarrow \mathcal{C}_2,\quad
(B_n) \longmapsto (B_{cn} \otimes_{A_{1, cn}} A_{2, n})
\end{equation}
Let $\mathcal{C}_i'$ be the category (\ref{equation-C-prime}) for $(A_i, I_i)$.
If $I_2$ is finitely generated, then there is a base change functor
\begin{equation}
\label{equation-base-change-complete}
\mathcal{C}_1' \longrightarrow \mathcal{C}_2',\quad
B \longmapsto (B \otimes_{A_1} A_2)^\wedge
\end{equation}
because in this case the completion is complete
(Algebra, Lemma \ref{algebra-lemma-hathat-finitely-generated}).
If both $I_1$ and $I_2$ are finitely generated, then
the two base change functors agree via the functors
(\ref{equation-from-complete-to-systems})
which are equivalences by Lemma \ref{lemma-topologically-finite-type}.
\end{remark}

\begin{remark}[Base change by closed immersion]
\label{remark-take-bar}
Let $A$ be a Noetherian ring and $I \subset A$ an ideal.
Let $\mathfrak a \subset A$ be an ideal. Denote $\bar A = A/\mathfrak a$.
Let $\bar I \subset \bar A$ be an ideal such that
$I^c \bar A \subset \bar I$ and $\bar I^d \subset I\bar A$
for some $c, d \geq 1$. In this case the base change functor
(\ref{equation-base-change-complete}) for $(A, I)$ to $(\bar A, \bar I)$
is given by $B \mapsto \bar B = B/\mathfrak aB$. Namely, we have
\begin{equation}
\label{equation-base-change-to-closed}
\bar B = (B \otimes_A \bar A)^\wedge = (B/\mathfrak a B)^\wedge =
B/\mathfrak a B
\end{equation}
the last equality because any finite $B$-module is $I$-adically complete by
Algebra, Lemma \ref{algebra-lemma-completion-tensor}
and if annihilated by $\mathfrak a$ also $\bar I$-adically complete by
Algebra, Lemma \ref{algebra-lemma-change-ideal-completion}.
\end{remark}







\section{A naive cotangent complex}
\label{section-naive-cotangent-complex}

\noindent
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B$ be an $A$-algebra which is $I$-adically complete such
that $A/I \to B/IB$ is of finite type, i.e., an object of
(\ref{equation-C-prime}).
By Lemma \ref{lemma-topologically-finite-type-Noetherian} we can write
$$
B = A[x_1, \ldots, x_r]^\wedge / J
$$
for some finitely generated ideal $J$. For a choice of presentation as
above we define the {\it naive cotangent complex}
in this setting by the formula
\begin{equation}
\label{equation-NL}
\NL_{B/A}^\wedge = (J/J^2 \longrightarrow \bigoplus B\text{d}x_i)
\end{equation}
with terms sitting in degrees $-1$ and $0$
where the map sends the residue class of $g \in J$ to the differential
$\text{d}g = \sum (\partial g/\partial x_i) \text{d}x_i$. Here
the partial derivative is taken by thinking of $g$ as a power series.
The following lemma shows that $\NL_{B/A}^\wedge$ is well defined
up to homotopy.

\begin{lemma}
\label{lemma-NL-up-to-homotopy}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B$ be an object of (\ref{equation-C-prime}). The naive
cotangent complex $\NL_{B/A}^\wedge$ is well defined in $K(B)$.
\end{lemma}

\begin{proof}
The lemma signifies that given a second presentation
$B = A[y_1, \ldots, y_s]^\wedge / K$ the complexes of $B$-modules
$$
(J/J^2 \to B\text{d}x_i)
\quad\text{and}\quad
(K/K^2 \to \bigoplus B\text{d}y_j)
$$
are homotopy equivalent. To see this, we can argue exactly as in
the proof of Algebra, Lemma \ref{algebra-lemma-NL-homotopy}.

\medskip\noindent
Step 1. If we choose $g_i(y_1, \ldots, y_s) \in A[y_1, \ldots, y_s]^\wedge$
mapping to the image of $x_i$ in $B$, then we obtain a (unique) continuous
$A$-algebra homomorphism
$$
A[x_1, \ldots, x_r]^\wedge \to A[y_1, \ldots, y_s]^\wedge,\quad
x_i \mapsto g_i(y_1, \ldots, y_s)
$$
compatible with the given surjections to $B$. Such a map is called
a morphism of presentations. It induces a map from $J$ into $K$
and hence induces a $B$-module map $J/J^2 \to K/K^2$. Sending
$\text{d}x_i$ to $\sum (\partial g_i/\partial y_j)\text{d}y_j$
we obtain a map of complexes
$$
(J/J^2 \to \bigoplus B\text{d}x_i)
\longrightarrow
(K/K^2 \to \bigoplus B\text{d}y_j)
$$
Of course we can do the same thing with the roles of the two presentations
exchanged to get a map of complexes in the other direction.

\medskip\noindent
Step 2. The construction above is compatible with compositions of morphsms
of presentations. Hence to finish the proof it suffices to show: given
$g_i(x_1, \ldots, x_r) \in A[x_1, \ldots, x_n]^\wedge$
mapping to the image of $x_i$ in $B$, the induced map of complexes
$$
(J/J^2 \to \bigoplus B\text{d}x_i)
\longrightarrow
(J/J^2 \to \bigoplus B\text{d}x_i)
$$
is homotopic to the identity map. To see this consider the map
$h : \bigoplus B \text{d}x_i \to J/J^2$ given by the rule
$\text{d}x_i \mapsto g_i(x_1, \ldots, x_n) - x_i$ and compute.
\end{proof}

\begin{lemma}
\label{lemma-NL-is-completion}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $A \to B$ be a finite type ring map. Choose a presentation
$\alpha : A[x_1, \ldots, x_n] \to B$. Then
$\NL_{B^\wedge/A}^\wedge = \lim \NL(\alpha) \otimes_B B^\wedge$
as complexes and
$\NL_{B^\wedge/A}^\wedge = \NL_{B/A} \otimes_B^\mathbf{L} B^\wedge$
in $D(B^\wedge)$.
\end{lemma}

\begin{proof}
The statement makes sense as $B^\wedge$ is an object of
(\ref{equation-C-prime}) by
Lemma \ref{lemma-topologically-finite-type-Noetherian}.
Let $J = \Ker(\alpha)$. The functor of taking
$I$-adic completion is exact on finite modules over
$A[x_1, \ldots, x_n]$ and agrees with the functor
$M \mapsto M \otimes_{A[x_1, \ldots, x_n]} A[x_1, \ldots, x_n]^\wedge$, see
Algebra, Lemmas \ref{algebra-lemma-completion-tensor} and
\ref{algebra-lemma-completion-flat}. Moreover, the ring maps
$A[x_1, \ldots, x_n] \to A[x_1, \ldots, x_n]^\wedge$
and $B \to B^\wedge$ are flat. Hence
$B^\wedge = A[x_1, \ldots, x_n]^\wedge / J^\wedge$ and
$$
(J/J^2) \otimes_B B^\wedge = (J/J^2)^\wedge = J^\wedge/(J^\wedge)^2
$$
Since $\NL(\alpha) = (J/J^2 \to \bigoplus B\text{d}x_i)$,
see Algebra, Section \ref{algebra-section-netherlander},
we conclude the complex $\NL_{B^\wedge/A}^\wedge$ is equal
to $\NL(\alpha) \otimes_B B^\wedge$. The final statement
follows as $\NL_{B/A}$ is homotopy equivalent to $\NL(\alpha)$
and because the ring map $B \to B^\wedge$ is flat (so derived
base change along $B \to B^\wedge$ is just base change).
\end{proof}

\begin{lemma}
\label{lemma-NL-is-limit}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B$ be an object of (\ref{equation-C-prime}). Then
\begin{enumerate}
\item the pro-objects
$\{\NL_{B/A}^\wedge \otimes_B B/I^nB\}$ and $\{\NL_{B_n/A_n}\}$
of $D(B)$ are strictly isomorphic (see proof for elucidation),
\item $\NL_{B/A}^\wedge = R\lim \NL_{B_n/A_n}$ in $D(B)$.
\end{enumerate}
Here $B_n$ and $A_n$ are as in Section \ref{section-two-categories}.
\end{lemma}

\begin{proof}
The statement means the following: for every $n$ we have a well
defined complex $\NL_{B_n/A_n}$ of $B_n$-modules and we have
transition maps $\NL_{B_{n + 1}/A_{n + 1}} \to \NL_{B_n/A_n}$.
See Algebra, Section \ref{algebra-section-netherlander}.
Thus we can consider
$$
\ldots \to \NL_{B_3/A_3} \to \NL_{B_2/A_2} \to \NL_{B_1/A_1}
$$
as an inverse system of complexes of $B$-modules and a fortiori as
an inverse system in $D(B)$. Furthermore $R\lim \NL_{B_n/A_n}$
is a homotopy limit of this inverse system, see
Derived Categories, Section \ref{derived-section-derived-limit}.

\medskip\noindent
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge / J$. This
defines presentations
$$
B_n = B/I^nB = A_n[x_1, \ldots, x_r]/J_n
$$
where
$$
J_n = JA_n[x_1, \ldots, x_r] =
J/(J \cap I^nA[x_1, \ldots, x_r]^\wedge)
$$
The two term complex $J_n/J_n^2 \longrightarrow \bigoplus B_n \text{d}x_i$
represents $\NL_{B_n/A_n}$, see
Algebra, Section \ref{algebra-section-netherlander}.
By Artin-Rees (Algebra, Lemma \ref{algebra-lemma-Artin-Rees})
in the Noetherian ring $A[x_1, \ldots, x_r]^\wedge$
(Lemma \ref{lemma-topologically-finite-type-Noetherian})
we find a $c \geq 0$ such that we have canonical surjections
$$
J/I^nJ \to J_n \to J/I^{n - c}J \to J_{n - c},\quad n \geq c
$$
for all $n \geq c$. A moment's thought shows that these maps are
compatible with differentials and we obtain maps of complexes
$$
\NL_{B/A}^\wedge \otimes_B B/I^nB \to
\NL_{B_n/A_n} \to
\NL_{B/A}^\wedge \otimes_B B/I^{n - c}B \to
\NL_{B_{n - c}/A_{n - c}}
$$
compatible with the transition maps of the inverse systems
$\{\NL_{B/A}^\wedge \otimes_B B/I^nB\}$ and $\{\NL_{B_n/A_n}\}$.
This proves part (1) of the lemma.

\medskip\noindent
By part (1) and since pro-isomorphic
systems have the same $R\lim$ in order to prove (2)
it suffices to show that $\NL_{B/A}^\wedge$ is
equal to $R\lim \NL_{B/A}^\wedge \otimes_B B/I^nB$.
However, $\NL_{B/A}^\wedge$ is a two term complex $M^\bullet$
of finite $B$-modules which are $I$-adically complete for example by
Algebra, Lemma \ref{algebra-lemma-completion-tensor}. Hence
$M^\bullet = \lim M^\bullet/I^nM^\bullet = R\lim M^\bullet/I^n M^\bullet$, see
More on Algebra, Lemma \ref{more-algebra-lemma-compute-Rlim-modules} and
Remark \ref{more-algebra-remark-how-unique}.
\end{proof}

\begin{lemma}
\label{lemma-NL-base-change}
Let $(A_1, I_1) \to (A_2, I_2)$ be as in
Remark \ref{remark-base-change} with $A_1$ and $A_2$ Noetherian.
Let $B_1$ be in (\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$. Then there is a canonical map
$$
\NL_{B_1/A_1} \otimes_{B_2} B_1 \to \NL_{B_2/A_2}
$$
which induces and isomorphism on $H^0$ and a surjection on $H^{-1}$.
\end{lemma}

\begin{proof}
Choose a presentation $B_1 = A_1[x_1, \ldots, x_r]^\wedge/J_1$.
Since
$A_2/I_2^n[x_1, \ldots, x_r] =
A_1/I_1^{cn}[x_1, \ldots, x_r] \otimes_{A_1/I_1^{cn}} A_2/I_2^n$
we have
$$
A_2[x_1, \ldots, x_r]^\wedge =
(A_1[x_1, \ldots, x_r]^\wedge \otimes_{A_1} A_2)^\wedge
$$
where we use $I_2$-adic completion on both sides (but of course
$I_1$-adic completion for $A_1[x_1, \ldots, x_r]^\wedge$).
Set $J_2 = J_1 A_2[x_1, \ldots, x_r]^\wedge$. Arguing similarly
we get the presentation
\begin{align*}
B_2
& =
(B_1 \otimes_{A_1} A_2)^\wedge \\
& =
\lim \frac{A_1/I_1^{cn}[x_1, \ldots, x_r]}{J_1(A_1/I_1^{cn}[x_1, \ldots, x_r])}
\otimes_{A_1/I_1^{cn}} A_2/I_2^n \\
& =
\lim \frac{A_2/I_2^n[x_1, \ldots, x_r]}{J_2(A_2/I_2^n[x_1, \ldots, x_r])} \\
& =
A_2[x_1, \ldots, x_r]^\wedge/J_2
\end{align*}
for $B_2$ over $A_2$. As a consequence obtain a commutative diagram
$$
\xymatrix{
\NL^\wedge_{B_1/A_1} : \ar[d] &
J_1/J_1^2 \ar[r]_-{\text{d}} \ar[d] & \bigoplus B_1\text{d}x_i \ar[d] \\
\NL^\wedge_{B_2/A_2} : &
J_2/J_2^2 \ar[r]^-{\text{d}} & \bigoplus B_2\text{d}x_i
}
$$
The induced arrow $J_1/J_1^2 \otimes_{B_1} B_2 \to J_2/J_2^2$
is surjective because $J_2$ is generated by the image of $J_1$.
This determines the arrow displayed in the lemma. We omit the proof
that this arrow is well defined up to homotopy (i.e., indepedent
of the choice of the presentations up to homotopy). The statement
about the induced map on cohomology modules follows easily
from the discussion (details omitted).
\end{proof}

\begin{lemma}
\label{lemma-exact-sequence-NL}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B \to C$ be morphism of (\ref{equation-C-prime}). Then
there is an exact sequence
$$
\xymatrix{
C \otimes_B H^0(\NL_{B/A}^\wedge) \ar[r] &
H^0(\NL_{C/A}^\wedge) \ar[r] &
H^0(\NL_{C/B}^\wedge) \ar[r] & 0 \\
H^{-1}(\NL_{B/A}^\wedge \otimes_B C) \ar[r] &
H^{-1}(\NL_{C/A}^\wedge) \ar[r] &
H^{-1}(\NL_{C/B}^\wedge) \ar[llu]
}
$$
See proof for elucidation.
\end{lemma}

\begin{proof}
Observe that taking the tensor product $\NL_{B/A}^\wedge \otimes_B C$
makes sense as $\NL_{B/A}^\wedge$ is well defined up to homotopy by
Lemma \ref{lemma-NL-up-to-homotopy}.
Also, $(B, IB)$ is pair where $B$ is a Noetherian ring
(Lemma \ref{lemma-topologically-finite-type-Noetherian})
and $C$ is in the corresponding category (\ref{equation-C-prime}).
Thus all the terms in the $6$-term sequence are (well) defined.

\medskip\noindent
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$.
Choose a presentation $C = B[y_1, \ldots, y_s]^\wedge/J'$.
Combinging these presentations gives a presentation
$$
C = A[x_1, \ldots, x_r, y_1, \ldots, y_s]^\wedge/K
$$
Then the reader verifies that we obtain a commutative diagram
$$
\xymatrix{
0 \ar[r] &
\bigoplus C \text{d}x_i \ar[r] &
\bigoplus C \text{d}x_i \oplus \bigoplus C \text{d}y_j \ar[r] &
\bigoplus C \text{d}y_j \ar[r] &
0 \\
&
J/J^2 \otimes_B C \ar[r] \ar[u] &
K/K^2 \ar[r] \ar[u] &
J'/(J')^2 \ar[r] \ar[u] &
0
}
$$
with exact rows. Note that the vertical arrow on the left hand side
is the tensor product of the arrow defining $\NL_{B/A}^\wedge$ with
$\text{id}_C$. The lemma follows by applying the snake lemma
(Algebra, Lemma \ref{algebra-lemma-snake}).
\end{proof}

\begin{lemma}
\label{lemma-transitive-lci-at-end}
With assumptions as in Lemma \ref{lemma-exact-sequence-NL}
assume that $B/I^nB \to C/I^nC$ is a local complete intersection
homomorphism for all $n$. Then
$H^{-1}(\NL_{B/A}^\wedge \otimes_B C) \to H^{-1}(\NL_{C/A}^\wedge)$
is injective.
\end{lemma}

\begin{proof}
For each $n \geq 1$ we set $A_n = A/I^n$, $B_n = B/I^nB$, and
$C_n = C/I^nC$. We have
\begin{align*}
H^{-1}(\NL_{B/A}^\wedge \otimes_B C)
& =
\lim H^{-1}(\NL_{B/A}^\wedge \otimes_B C_n) \\
& =
\lim H^{-1}(\NL_{B/A}^\wedge \otimes_B B_n \otimes_{B_n} C_n) \\
& =
\lim H^{-1}(\NL_{B_n/A_n} \otimes_{B_n} C_n)
\end{align*}
The first equality follows from
More on Algebra, Lemma \ref{more-algebra-lemma-consequence-Artin-Rees}
and the fact that $H^{-1}(\NL_{B/A}^\wedge \otimes_B C)$ is a finite
$C$-module and hence $I$-adically complete for example by
Algebra, Lemma \ref{algebra-lemma-completion-tensor}.
The second equality is trivial.
The third holds by Lemma \ref{lemma-NL-is-limit}.
The maps $H^{-1}(\NL_{B_n/A_n} \otimes_{B_n} C_n) \to
H^{-1}(\NL_{C_n/A_n})$ are injective by
More on Algebra, Lemma \ref{more-algebra-lemma-transitive-lci-at-end}.
The proof is finished because we also have
$H^{-1}(\NL_{C/A}^\wedge) = \lim H^{-1}(\NL_{C_n/A_n})$
similarly to the above.
\end{proof}









\section{Rig-smooth algebras}
\label{section-rig-smooth}

\noindent
As motivation for the following definition, please take a look at
More on Algebra, Remark \ref{more-algebra-remark-smoothness-ext-1-zero}.

\begin{definition}
\label{definition-rig-smooth-homomorphism}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}). We say
$B$ is {\it rig-smooth over $(A, I)$} if there exists an integer $c \geq 0$
such that $I^c$ annihilates $\Ext^1_B(\NL_{B/A}^\wedge, N)$ for every
$B$-module $N$.
\end{definition}

\noindent
Let us work out what this means.

\begin{lemma}
\label{lemma-equivalent-with-artin-smooth}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}). Write
$B = A[x_1, \ldots, x_r]^\wedge/J$
(Lemma \ref{lemma-topologically-finite-type-Noetherian})
and let $\NL_{B/A}^\wedge = (J/J^2 \to \bigoplus B\text{d}x_i)$
be its naive cotangent complex (\ref{equation-NL}).
The following are equivalent
\begin{enumerate}
\item $B$ is rig-smooth over $(A, I)$,
\item the object $\NL_{B/A}^\wedge$ of $D(B)$ satisfies the equivalent
conditions (1) -- (4) of More on Algebra, Lemma
\ref{more-algebra-lemma-ext-1-annihilated} with respect to the ideal $IB$,
\item there exists a $c \geq 0$ such that for all $a \in I^c$
there is a map $h : \bigoplus B\text{d}x_i \to J/J^2$ such that
$a : J/J^2 \to J/J^2$ is equal to $h \circ \text{d}$,
\item there exist $b_1, \ldots, b_s \in B$ such that
$V(b_1, \ldots, b_s) \subset V(IB)$ and such that for every
$l = 1, \ldots, s$ there exist $m \geq 0$, $f_1, \ldots, f_m \in J$,
and subset $T \subset \{1, \ldots, n\}$ with $|T| = m$ such that
\begin{enumerate}
\item $\det_{i \in T, j \leq m}(\partial f_j/ \partial x_i)$
divides $b_l$ in $B$, and
\item $b_l J \subset (f_1, \ldots, f_m) + J^2$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1), (2), and (3) is immediate from
More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated}.

\medskip\noindent
Assume $b_1, \ldots, b_s$ are as in (4). Since $B$ is Noetherian the inclusion
$V(b_1, \ldots, b_s) \subset V(IB)$ implies $I^cB \subset (b_1, \ldots, b_s)$
for some $c \geq 0$ (for example by
Algebra, Lemma \ref{algebra-lemma-Noetherian-power-ideal-kills-module}).
Pick $1 \leq l \leq s$ and $m \geq 0$ and $f_1, \ldots, f_m \in J$
and $T \subset \{1, \ldots, n\}$ with $|T| = m$ satisfying (4)(a) and (b).
Then if we invert $b_l$ we see that
$$
\NL_{B/A}^\wedge \otimes_B B_{b_l} =
\left(
\bigoplus\nolimits_{j \leq m} B_{b_l} f_j
\longrightarrow
\bigoplus\nolimits_{i = 1, \ldots, n} B_{b_l} \text{d}x_i
\right)
$$
and moreover the arrow is isomorphic to the inclusion of the direct
summand $\bigoplus_{i \in T} B_{b_l} \text{d}x_i$. We conclude that
$H^{-1}(\NL_{B/A}^\wedge)$ is $b_l$-power torsion and that
$H^0(\NL_{B/A}^\wedge)$ becomes finite free after inverting $b_l$.
Combined with the inclusion $I^cB \subset (b_1, \ldots, b_s)$
we see that $H^{-1}(\NL_{B/A}^\wedge)$ is $IB$-power torsion.
Hence we see that condition (4) of
More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated}
holds. In this way we see that (4) implies (2).

\medskip\noindent
Assume the equivalent conditions (1), (2), and (3) hold. We will prove
that (4) holds, but we strongly urge the reader to convince themselves
of this. The complex $\NL_{B/A}^\wedge$ determines an object of
$D^b_{\textit{Coh}}(\Spec(B))$ whose restriction to the Zariski open
$U = \Spec(B) \setminus V(IB)$ is a finite locally free module
$\mathcal{E}$ placed in degree $0$ (this follows for example from the
the fourth equivalent condition in
More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated}).
Choose generators $f_1, \ldots, f_M$ for $J$.
This determines an exact sequence
$$
\bigoplus\nolimits_{j = 1, \ldots, M} \mathcal{O}_U \cdot f_j \to
\bigoplus\nolimits_{i = 1, \ldots, n} \mathcal{O}_U \cdot \text{d}x_i \to
\mathcal{E} \to 0
$$
Let $U = \bigcup_{l = 1, \ldots, s} U_l$
be a finite affine open covering such that
$\mathcal{E}|_{U_l}$ is free of rank $r_l = n - m_l$ for some integer
$n \geq m_l \geq 0$. After replacing
each $U_l$ by an affine open covering we may assume there exists
a subset $T_l \subset \{1, \ldots, n\}$ such that the elements
$\text{d}x_i$, $i \in \{1, \ldots, n\} \setminus T_l$ map to a
basis for $\mathcal{E}|_{U_l}$. Repeating the argument, we may
assume there exists a subset $T'_l \subset \{1, \ldots, M\}$
of cardinality $m_l$ such that $f_j$, $j \in T'_l$ map to a basis
of the kernel of $\mathcal{O}_{U_l} \cdot \text{d}x_i \to
\mathcal{E}|_{U_l}$. Finally, since the open covering
$U = \bigcup U_l$ may be refined by a open covering by standard opens
(Algebra, Lemma \ref{algebra-lemma-Zariski-topology})
we may assume $U_l = D(g_l)$ for some $g_l \in B$.
In particular we have $V(g_1, \ldots, g_s) = V(IB)$.
A linear algebra argument using our choices above shows that
$\det_{i \in T_l, j \in T'_l}(\partial f_j/ \partial x_i)$
maps to an invertible element of $B_{b_l}$. Similarly, the vanishing
of cohomology of $\NL_{B/A}^\wedge$ in degree $-1$ over $U_l$ shows that
$J/J^2 + (f_j; j \in T')$ is annihilated by a power of $b_l$.
After replacing each $g_l$ by a suitable power we obtain
conditions (4)(a) and (4)(b) of the lemma. Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-rig-smooth}
Let $A$ be a Noetherian ring and let $I$ be an ideal.
Let $B$ be a finite type $A$-algebra.
\begin{enumerate}
\item If $\Spec(B) \to \Spec(A)$ is smooth over $\Spec(A) \setminus V(I)$,
then $B^\wedge$ is rig-smooth over $(A, I)$.
\item If $B^\wedge$ is rig-smooth over $(A, I)$,
then there exists $g \in 1 + IB$ such that $\Spec(B_g)$ is smooth
over $\Spec(A) \setminus V(I)$.
\end{enumerate}
\end{lemma}

\begin{proof}
We will use Lemma \ref{lemma-equivalent-with-artin-smooth}
without further mention.

\medskip\noindent
Assume (1). Recall that formation of $\NL_{B/A}$ commutes with
localization, see Algebra, Lemma \ref{algebra-lemma-localize-NL}.
Hence by the very definition of smooth ring maps (in terms of
the naive cotangent complex being quasi-isomorphic to a finite
projective module placed in degree $0$), we see that
$\NL_{B/A}$ satisfies the fourth equivalent condition
of More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated}
with respect to the ideal $IB$ (small detail omitted).
Since $\NL_{B^\wedge/A}^\wedge = \NL_{B/A} \otimes_B B^\wedge$
by Lemma \ref{lemma-NL-is-completion} we conclude (2) holds by
More on Algebra, Lemma
\ref{more-algebra-lemma-base-change-property-ext-1-annihilated}.

\medskip\noindent
Assume (2). Choose a presentation
$B = A[x_1, \ldots, x_n]/J$, set $N = J/J^2$, and
consider the element $\xi \in \Ext^1_B(\NL_{B/A}, J/J^2)$
determined by the identity map on $J/J^2$.
Using again that $\NL_{B^\wedge/A}^\wedge = \NL_{B/A} \otimes_B B^\wedge$
we find that our assumption implies the image
$$
\xi \otimes 1 \in
\Ext^1_{B^\wedge}(\NL_{B/A} \otimes_B B^\wedge, N \otimes_B B^\wedge) =
\Ext^1_{B^\wedge}(\NL_{B/A}, N) \otimes_B B^\wedge
$$
is annihilated by $I^c$ for some integer $c \geq 0$.
The equality holds for example by
More on Algebra, Lemma \ref{more-algebra-lemma-base-change-RHom}
(but can also easily be deduced from the much simpler
More on Algebra, Lemma
\ref{more-algebra-lemma-pseudo-coherence-and-base-change-ext}).
Thus $M = I^cB\xi \subset \Ext^1_B(\NL_{B/A}, N)$ is a finite submodule
which maps to zero in $\Ext^1_B(\NL_{B/A}, N) \otimes_B B^\wedge$.
Since $B \to B^\wedge$ is flat this means that
$M \otimes_B B^\wedge$ is zero. By 
Nakayama's lemma (Algebra, Lemma \ref{algebra-lemma-NAK})
this means that $M = I^cB\xi$ is annihilated by an element
of the form $g = 1 + x$ with $x \in IB$.
This implies that for every $b \in I^cB$ there is a
$B$-linear dotted arrow making the diagram commute
$$
\xymatrix{
J/J^2 \ar[r] \ar[d]^b & \bigoplus B\text{d}x_i \ar@{..>}[d]^h \\
J/J^2 \ar[r] & (J/J^2)_g
}
$$
Thus $(\NL_{B/A})_{gb}$ is quasi-isomorphic
to a finite projective module; small detail omitted.
Since $(\NL_{B/A})_{gb} = \NL_{B_{gb}/A}$ in $D(B_{gb})$
this shows that $B_{gb}$ is smooth over $\Spec(A)$.
As this holds for all $b \in I^cB$ we conclude
that $\Spec(B_g) \to \Spec(A)$ is smooth over $\Spec(A) \setminus V(I)$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-zero-ext-1-after-modding-out}
Let $(A_1, I_1) \to (A_2, I_2)$ be as in
Remark \ref{remark-base-change} with $A_1$ and $A_2$ Noetherian.
Let $B_1$ be in (\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$. Let $f_1 \in B_1$
with image $f_2 \in B_2$.
If $\Ext^1_{B_1}(\NL_{B_1/A_1}^\wedge, N_1)$ is annihilated
by $f_1$ for every $B_1$-module $N_1$, then
$\Ext^1_{B_2}(\NL_{B_2/A_2}^\wedge, N_2)$ is annihilated
by $f_2$ for every $B_2$-module $N_2$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-NL-base-change} there is a map
$$
\NL_{B_1/A_1} \otimes_{B_2} B_1 \to \NL_{B_2/A_2}
$$
which induces and isomorphism on $H^0$ and a surjection on $H^{-1}$.
Thus the result by More on Algebra, Lemmas
\ref{more-algebra-lemma-two-term-base-change},
\ref{more-algebra-lemma-base-change-property-ext-1-annihilated}, and
\ref{more-algebra-lemma-surjection-property-ext-1-annihilated}
the last two applied with the principal ideals $(f_1) \subset B_1$ and
$(f_2) \subset B_2$.
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-smooth-homomorphism}
Let $A_1 \to A_2$ be a map of Noetherian rings. Let $I_i \subset A_i$
be an ideal such that $V(I_1A_2) = V(I_2)$. Let $B_1$ be in
(\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$ as in
Remark \ref{remark-base-change}.
If $B_1$ is rig-smooth over $(A_1, I_1)$,
then $B_2$ is rig-smooth over $(A_2, I_2)$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-zero-ext-1-after-modding-out} and
Definition \ref{definition-rig-smooth-homomorphism}
and the fact that $I_2^c$ is contained in $I_1A_2$ for some $c \geq 0$
as $A_2$ is Noetherian.
\end{proof}













\section{Deformations of ring homomorphisms}
\label{section-defos-ring-maps}

\noindent
Some work on lifting ring homomorphisms from rig-smooth algebras.

\begin{remark}[Linear approximation]
\label{remark-linear-approximation}
Let $A$ be a ring and $I \subset A$ be a finitely generated ideal.
Let $C$ be an $I$-adically complete $A$-algebra.
Let $\psi : A[x_1, \ldots, x_r]^\wedge \to C$ be a continuous
$A$-algebra map. Suppose given $\delta_i \in C$, $i = 1, \ldots, r$.
Then we can consider
$$
\psi' : A[x_1, \ldots, x_r]^\wedge \to C,\quad
x_i \longmapsto \psi(x_i) + \delta_i
$$
see Formal Spaces, Remark \ref{formal-spaces-remark-universal-property}.
Then we have
$$
\psi'(g) = \psi(g) + \sum \psi(\partial g/\partial x_i)\delta_i + \xi
$$
with error term $\xi \in (\delta_i\delta_j)$. This follows by
writing $g$ as a power series and working term by term. Convergence
is automatic as the coefficients of $g$ tend to zero.
Details omitted.
\end{remark}

\begin{remark}[Lifting maps]
\label{remark-improve-homomorphism}
Let $A$ be a Noetherian ring and $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}).
Let $C$ be an $I$-adically complete $A$-algebra.
Let $\psi_n : B \to C/I^nC$ be an $A$-algebra homomorphism.
The obstruction to lifting $\psi_n$ to an $A$-algebra
homomorphism into $C/I^{2n}C$ is an element
$$
o(\psi_n) \in \Ext^1_B(\NL_{B/A}^\wedge, I^nC/I^{2n}C)
$$
as we will explain. Namely, choose a presentation
$B = A[x_1, \ldots, x_r]^\wedge/J$.
Choose a lift $\psi : A[x_1, \ldots, x_r]^\wedge \to C$ of $\psi_n$.
Since $\psi(J) \subset I^nC$ we get $\psi(J^2) \subset I^{2n}C$
and hence we get a $B$-linear homomorphism
$$
o(\psi) :
J/J^2 \longrightarrow I^nC/I^{2n}C, \quad g \longmapsto \psi(g)
$$
which of course extends to a $C$-linear map
$J/J^2 \otimes_B C \to I^nC/I^{2n}C$.
Since $\NL_{B/A}^\wedge = (J/J^2 \to \bigoplus B \text{d}x_i)$
we get $o(\psi_n)$ as the image of $o(\psi)$ by the identification
\begin{align*}
& \Ext^1_B(\NL_{B/A}^\wedge, I^nC/I^{2n}C) \\
& =
\Coker\left(\Hom_B(\bigoplus B\text{d}x_i, I^nC/I^{2n}C) \to
\Hom_B(J/J^2, I^nC/I^{2n}C)\right)
\end{align*}
See More on Algebra, Lemma
\ref{more-algebra-lemma-map-out-of-almost-free} part (1) for the equality.

\medskip\noindent
Suppose that $o(\psi_n)$ maps to zero in
$\Ext^1_B(\NL_{B/A}^\wedge, I^{n'}C/I^{2n'}C)$
for some integer $n'$ with $n > n' > n/2$. We claim that this means we can
find an $A$-algebra homomorphism $\psi'_{2n'} : B \to C/I^{2n'}C$
which agrees with $\psi_n$ as maps into $C/I^{n'}C$.
The extreme case $n' = n$ explains why we previously said
$o(\psi_n)$ is the obstruction to lifting $\psi_n$ to $C/I^{2n}C$.
Proof of the claim: the hypothesis that $o(\psi_n)$ maps to zero tells us
we can find a $B$-module map
$$
h : \bigoplus B\text{d}x_i \longrightarrow I^{n'}C/I^{2n'}C
$$
such that $o(\psi)$ and $h \circ \text{d}$ agree as maps
into $I^{n'}C/I^{2n'}C$. Say $h(\text{d}x_i) = \delta_i \bmod I^{2n'}C$
for some $\delta_i \in I^{n'}C$. Then we look at the map
$$
\psi' : A[x_1, \ldots, x_r]^\wedge \to C,\quad
x_i \longmapsto \psi(x_i) - \delta_i
$$
A computation with power series
shows that $\psi'(J) \subset I^{2n'}C$. Namely, for $g \in J$ we get
$$
\psi'(g) \equiv
\psi(g) - \sum \psi(\partial g/\partial x_i)\delta_i \equiv
o(\psi)(g) - (h \circ \text{d})(g) \equiv
0 \bmod I^{2n'}C
$$
See Remark \ref{remark-linear-approximation} for the first equality.
Hence $\psi'$ induces an $A$-algebra homomorphism
$\psi'_{2n'} : B \to C/I^{2n'}C$ as desired.
\end{remark}

\begin{lemma}
\label{lemma-get-morphism-general-better}
Assume given the following data
\begin{enumerate}
\item an integer $c \geq 0$,
\item an ideal $I$ of a Noetherian ring $A$,
\item $B$ in (\ref{equation-C-prime}) for $(A, I)$ such that
$I^c$ annihilates $\Ext^1_B(\NL_{B/A}^\wedge, N)$
for any $B$-module $N$,
\item a Noetherian $I$-adically complete $A$-algebra $C$; denote
$d = d(\text{Gr}_I(C))$ and $q_0 = q(\text{Gr}_I(C))$ the integers found in
Local Cohomology, Section \ref{local-cohomology-section-uniform},
\item an integer $n \geq \max(q_0 + (d + 1)c, 2(d + 1)c + 1)$, and
\item an $A$-algebra homomorphism $\psi_n : B \to C/I^nC$.
\end{enumerate}
Then there exists a map $\varphi : B \to C$ of $A$-algebras such
that $\psi_n \bmod I^{n - (d + 1)c} = \varphi \bmod I^{n - (d + 1)c}$.
\end{lemma}

\begin{proof}
Consider the obstruction class
$$
o(\psi_n) \in \Ext^1_B(\NL_{B/A}^\wedge, I^nC/I^{2n}C)
$$
of Remark \ref{remark-improve-homomorphism}. For any $C/I^nC$-module
$N$ we have
\begin{align*}
\Ext^1_B(\NL_{B/A}^\wedge, N)
& =
\Ext^1_{C/I^nC}(\NL_{B/A}^\wedge \otimes_B^\mathbf{L} C/I^nC, N) \\
& =
\Ext^1_{C/I^nC}(\NL_{B/A}^\wedge \otimes_B C/I^nC, N)
\end{align*}
The first equality by
More on Algebra, Lemma \ref{more-algebra-lemma-upgrade-adjoint-tensor-RHom}
and the second one by
More on Algebra, Lemma \ref{more-algebra-lemma-two-term-base-change}.
In particular, we see that
$\Ext^1_{C/I^nC}(\NL_{B/A}^\wedge \otimes_B C/I^nC, N)$ is annihilated by
$I^cC$ for all $C/I^nC$-modules $N$.
It follows that we may apply
Local Cohomology, Lemma \ref{local-cohomology-lemma-bound-two-term-complex}
to see that $o(\psi_n)$ maps to zero in
$$
\Ext^1_{C/I^nC}(\NL_{B/A}^\wedge \otimes_B C/I^nC, I^{n'}C/I^{2n'}C) =
\Ext^1_B(\NL_{B/A}^\wedge, I^{n'}C/I^{2n'}C) =
$$
where $n' = n - (d + 1)c$. By the discussion in
Remark \ref{remark-improve-homomorphism} we obtain a map
$$
\psi'_{2n'} : B \to C/I^{2n'}C
$$
which agrees with $\psi_n$ modulo $I^{n'}$.
Observe that $2n' > n$ because $n \geq 2(d + 1)c + 1$.

\medskip\noindent
We may repeat this procedure. Starting with $n_0 = n$ and
$\psi^0 = \psi_n$ we end up getting a strictly increasing
sequence of integers
$$
n_0 < n_1 < n_2 < \ldots
$$
and $A$-algebra homorphisms $\psi^i : B \to C/I^{n_i}C$
such that $\psi^{i + 1}$ and $\psi^i$ agree modulo $I^{n_i - tc}$.
Since $C$ is $I$-adically complete we can take $\varphi$
to be the limit of the maps
$\psi^i \bmod I^{n_i - (d + 1)c} : B \to C/I^{n_i - (d + 1)c}C$
and the lemma follows.
\end{proof}

\noindent
We suggest the reader skip ahead to the next section. Namely, the following
two lemmas are consequences of the result above if the algebra $C$ in them
is assumed Noetherian.

\begin{lemma}
\label{lemma-get-morphism-nonzerodivisor}
Let $I = (a)$ be a principal ideal of a Noetherian ring $A$.
Let $B$ be an object of (\ref{equation-C-prime}).
Assume given an integer $c \geq 0$ such that $\Ext^1_B(\NL_{B/A}^\wedge, N)$
is annihilated by $a^c$ for all $B$-modules $N$.
Let $C$ be an $I$-adically complete $A$-algebra such that
$a$ is a nonzerodivisor on $C$. Let $n > 2c$. For any $A$-algebra
map $\psi_n : B \to C/a^nC$ there exists an $A$-algebra
map $\varphi : B \to C$ such that
$\psi_n \bmod a^{n - c}C = \varphi \bmod a^{n - c}C$.
\end{lemma}

\begin{proof}
Consider the obstruction class
$$
o(\psi_n) \in \Ext^1_B(\NL_{B/A}^\wedge, a^nC/a^{2n}C)
$$
of Remark \ref{remark-improve-homomorphism}. Since $a$ is a nonzerodivisor
on $C$ the map $a^c : a^nC/a^{2n}C \to a^nC/a^{2n}C$ is isomorphic to the
map $a^nC/a^{2n}C \to a^{n - c}C/a^{2n - c}C$ in the category of $C$-modules.
Hence by our assumption on $\NL_{B/A}^\wedge$
we conclude that the class $o(\psi_n)$ maps to zero in
$$
\Ext^1_B(\NL_{B/A}^\wedge, a^{n - c}C/a^{2n - c}C)
$$
and a fortiori in
$$
\Ext^1_B(\NL_{B/A}^\wedge, a^{n - c}C/a^{2n - 2c}C)
$$
By the discussion in Remark \ref{remark-improve-homomorphism} we obtain a map
$$
\psi_{2n - 2c} : B \to C/a^{2n - 2c}C
$$
which agrees with $\psi_n$ modulo $a^{n - c}C$.
Observe that $2n - 2c > n$ because $n > 2c$.

\medskip\noindent
We may repeat this procedure. Starting with $n_0 = n$ and
$\psi^0 = \psi_n$ we end up getting a strictly increasing
sequence of integers
$$
n_0 < n_1 < n_2 < \ldots
$$
and $A$-algebra homorphisms $\psi^i : B \to C/a^{n_i}C$
such that $\psi^{i + 1}$ and $\psi^i$ agree modulo $a^{n_i - c}C$.
Since $C$ is $I$-adically complete we can take $\varphi$
to be the limit of the maps
$\psi^i \bmod a^{n_i - c}C : B \to C/a^{n_i - c}C$
and the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-get-morphism-principal}
Let $I = (a)$ be a principal ideal of a Noetherian ring $A$.
Let $B$ be an object of (\ref{equation-C-prime}).
Assume given an integer $c \geq 0$ such that $\Ext^1_B(\NL_{B/A}^\wedge, N)$
is annihilated by $a^c$ for all $B$-modules $N$.
Let $C$ be an $I$-adically complete $A$-algebra.
Assume given an integer $d \geq 0$ such that $C[a^\infty] \cap a^dC = 0$.
Let $n > \max(2c, c + d)$. For any $A$-algebra map
$\psi_n : B \to C/a^nC$ there exists an $A$-algebra map
$\varphi : B \to C$ such
that $\psi_n \bmod a^{n - c} = \varphi \bmod a^{n - c}$.
\end{lemma}

\noindent
If $C$ is Noetherian we have $C[a^\infty] = C[a^e]$ for some
$e \geq 0$. By Artin-Rees (Algebra, Lemma \ref{algebra-lemma-Artin-Rees})
there exists an integer $f$ such that
$a^nC \cap C[a^\infty] \subset a^{n - f}C[a^\infty]$ for all $n \geq f$.
Then $d = e + f$ is an integer as in the lemma. This argument
works in particular if $C$ is an object of (\ref{equation-C-prime})
by Lemma \ref{lemma-topologically-finite-type-Noetherian}.

\begin{proof}
Let $C \to C'$ be the quotient of $C$ by $C[a^\infty]$. The $A$-algebra
$C'$ is $I$-adically complete by
Algebra, Lemma \ref{algebra-lemma-quotient-complete}
and the fact that $\bigcap (C[a^\infty] + a^nC) = C[a^\infty]$
because for $n \geq d$ the sum $C[a^\infty] + a^nC$ is direct.
For $m \geq d$ the diagram
$$
\xymatrix{
0 \ar[r] &
C[a^\infty] \ar[r] \ar[d] &
C \ar[r] \ar[d] & C' \ar[r] \ar[d] & 0 \\
0 \ar[r] &
C[a^\infty] \ar[r] &
C/a^m C \ar[r] & C'/a^m C' \ar[r] & 0
}
$$
has exact rows. Thus $C$ is the fibre product of $C'$ and
$C/a^mC$ over $C'/a^mC'$ for all $m \geq d$. By
Lemma \ref{lemma-get-morphism-nonzerodivisor}
we can choose a homomorphism $\varphi' : B \to C'$
such that $\varphi'$ and $\psi_n$ agree as maps into $C'/a^{n - c}C'$.
We obtain a homomorphism $(\varphi', \psi_n \bmod a^{n - c}C) : B \to
C' \times_{C'/a^{n - c}C'} C/a^{n - c}C$.
Since $n - c \geq d$ this is the same thing as a homomorphism
$\varphi : B \to C$. This finishes the proof.
\end{proof}










\section{Algebraization of rig-smooth algebras over G-rings}
\label{section-over-G-ring}

\noindent
If the base ring $A$ is a Noetherian G-ring, then we can
prove \cite[III Theorem 7]{Elkik} for arbitrary rig-smooth
algebras with respect to any ideal $I \subset A$ (not necessarily
principal).

\begin{lemma}
\label{lemma-close-enough}
Let $I$ be an ideal of a Noetherian ring $A$. Let $r \geq 0$
and write $P = A[x_1, \ldots, x_r]$ the $I$-adic completion.
Consider a resolution
$$
P^{\oplus t} \xrightarrow{K} P^{\oplus m}
\xrightarrow{g_1, \ldots, g_m} P \to B \to 0
$$
of a quotient of $P$. Assume $B$ is rig-smooth over $(A, I)$.
Then there exists an integer $n$ such that for any complex
$$
P^{\oplus t} \xrightarrow{K'} P^{\oplus m}
\xrightarrow{g'_1, \ldots, g'_m} P
$$
with $g_i - g'_i \in I^nP$ and $K - K' \in I^n\text{Mat}(m \times t, P)$
there exists an isomorphism $B \to B'$ of $A$-algebras where
$B' = P/(g'_1, \ldots, g'_m)$.
\end{lemma}

\begin{proof}
(A) By Definition \ref{definition-rig-smooth-homomorphism}
we can choose a $c \geq 0$ such that $I^c$ annihilates
$\Ext^1_B(\NL_{B/A}^\wedge, N)$ for all $B$-modules $N$.

\medskip\noindent
(B) By More on Algebra, Lemmas \ref{more-algebra-lemma-approximate-complex} and
\ref{more-algebra-lemma-approximate-complex-graded}
there exists a constant $c_1 = c(g_1, \ldots, g_m, K)$
such that for $n \geq c_1 + 1$ the complex
$$
P^{\oplus t} \xrightarrow{K'} P^{\oplus m}
\xrightarrow{g'_1, \ldots, g'_m} P \to B' \to 0
$$
is exact and $\text{Gr}_I(B) \cong \text{Gr}_I(B')$.

\medskip\noindent
(C) Let $d_0 = d(\text{Gr}_I(B))$ and $q_0 = q(\text{Gr}_I(B))$
be the integers found in
Local Cohomology, Section \ref{local-cohomology-section-uniform}.

\medskip\noindent
We claim that $n = \max(c_1 + 1, q_0 + (d_0 + 1)c, 2(d_0 + 1)c + 1)$
works where $c$ is as in (A), $c_1$ is as in (B), and $q_0, d_0$ are as
in (C).

\medskip\noindent
Let $g'_1, \ldots, g'_m$ and $K'$ be as in the lemma.
Since $g_i = g'_i \in I^nP$ we obtain a canonical
$A$-algebra homomorphism
$$
\psi_n : B \longrightarrow B'/I^nB'
$$
which induces an isomorphism $B/I^nB \to B'/I^nB'$. Since
$\text{Gr}_I(B) \cong \text{Gr}_I(B')$ we have
$d_0 = d(\text{Gr}_I(B'))$ and $q_0 = q(\text{Gr}_I(B'))$
and since $n \geq \max(q_0 + (1 + d_0)c, 2(d_0 + 1)c + 1)$
we may apply Lemma \ref{lemma-get-morphism-general-better}
to find an $A$-algebra homomorphism
$$
\varphi : B \longrightarrow B'
$$
such that
$\varphi \bmod I^{n - (d_0 + 1)c}B' = \psi_n \bmod I^{n - (d_0 + 1)c}B'$.
Since $n - (d_0 + 1)c > 0$ we see that $\varphi$ is an $A$-algebra
homomorphism which modulo $I$ induces the isomorphism $B/IB \to B'/IB'$
we found above.
The rest of the proof shows that these facts force $\varphi$
to be an isomorphism; we suggest the reader find their own proof of this.

\medskip\noindent
Namely, it follows that $\varphi$ is surjective for example by applying
Algebra, Lemma \ref{algebra-lemma-completion-generalities} part (1)
using the fact that $B$ and $B'$ are complete.
Thus $\varphi$ induces a surjection $\text{Gr}_I(B) \to \text{Gr}_I(B')$
which has to be an isomorphism because the source and target are
isomorphic Noetherian rings, see
Algebra, Lemma \ref{algebra-lemma-surjective-endo-noetherian-ring-is-iso}
(of course you can show $\varphi$ induces the isomorphism we found above
but that would need a tiny argument).
Thus $\varphi$ induces injective maps
$I^eB/I^{e + 1}B \to I^eB'/I^{e + 1}B'$ for all $e \geq 0$.
This implies $\varphi$ is injective since for any $b \in B$ there
exists an $e \geq 0$ such that $b \in I^eB$, $b \not \in I^{e + 1}B$
by Krull's intersection theorem (Algebra, Lemma
\ref{algebra-lemma-intersect-powers-ideal-module-zero}).
This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-algebraize-easy}
Let $I$ be an ideal of a Noetherian ring $A$. Let $C^h$ be the henselization
of a finite type $A$-algebra $C$ with respect to the ideal $IC$. Let
$J \subset C^h$ be an ideal. Then there exists a finite type $A$-algebra
$B$ such that $B^\wedge \cong (C^h/J)^\wedge$.
\end{lemma}

\begin{proof}
By More on Algebra, Lemma
\ref{more-algebra-lemma-henselization-Noetherian-pair}
the ring $C^h$ is Noetherian. Say $J = (g_1, \ldots, g_m)$.
The ring $C^h$ is a filtered colimit of \'etale $C$ algebras $C'$
such that $C/IC \to C'/IC'$ is an isomorphism
(see proof of More on Algebra, Lemma \ref{more-algebra-lemma-henselization}).
Pick an $C'$ such that $g_1, \ldots, g_m$ are the
images of $g'_1, \ldots, g'_m \in C'$.
Setting $B = C'/(g'_1, \ldots, g'_m)$ we get a finite
type $A$-algebra. Of course $(C, IC)$ and $C', IC')$ have
the same henselizations and the same completions.
It follows easily from this that $B^\wedge = (C^h/J)^\wedge$.
\end{proof}

\begin{proposition}
\label{proposition-approximate}
Let $I$ be an ideal of a Noetherian G-ring $A$. Let $B$ be an
object of (\ref{equation-C-prime}). If $B$ is rig-smooth
over $(A, I)$, then there exists a finite type $A$-algebra
$C$ and an isomorphism $B \cong C^\wedge$ of $A$-algebras.
\end{proposition}

\begin{proof}
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$. Write
$P = A[x_1, \ldots, x_r]^\wedge$. Choose generators $g_1, \ldots, g_m \in J$.
Choose generators $k_1, \ldots, k_t$ of the module
of relations between $g_1, \ldots, g_m$, i.e., such that
$$
P^{\oplus t} \xrightarrow{k_1, \ldots, k_t}
P^{\oplus m} \xrightarrow{g_1, \ldots, g_m}
P \to B \to 0
$$
is a resolution. Write $k_i = (k_{i1}, \ldots, k_{im})$ so that we have
\begin{equation}
\label{equation-relations-straight-up}
\sum\nolimits_j k_{ij}g_j = 0
\end{equation}
for $i = 1, \ldots, t$. Denote $K = (k_{ij})$ the $m \times t$-matrix
with entries $k_{ij}$.

\medskip\noindent
Let $A[x_1, \ldots, x_r]^h$ be the henselization of the
pair $(A[x_1, \ldots, x_r], IA[x_1, \ldots, x_r])$, see
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
We may and do think of $A[x_1, \ldots, x_r]^h$ as a subring
of $P = A[x_1, \ldots, x_r]^\wedge$, see
More on Algebra, Lemma
\ref{more-algebra-lemma-henselization-Noetherian-pair}.
Since $A$ is a Noetherian G-ring, so is $A[x_1, \ldots, x_r]$, see
More on Algebra, Proposition
\ref{more-algebra-proposition-finite-type-over-G-ring}.
Hence we have approximation for the map
$A[x_1, \ldots, x_r]^h \to A[x_1, \ldots, x_r]^\wedge = P$
with respect to the ideal generated by $I$, see
Smoothing Ring Maps, Lemma \ref{smoothing-lemma-henselian-pair}.
Choose a large enough integer $n$ as in Lemma \ref{lemma-close-enough}.
By the approximation property we may choose
$g'_1, \ldots, g'_m \in A[x_1, \ldots, x_r]^h$
and a matrix
$K' = (k'_{ij}) \in \text{Mat}(m \times t, A[x_1, \ldots, x_r]^h)$
such that $\sum\nolimits_j k'_{ij}g'_j = 0$ in
$A[x_1, \ldots, x_r]^h$ and such that
$g_i - g'_i \in I^nP$ and $K - K' \in I^n\text{Mat}(m \times t, P)$.
By our choice of $n$ we conclude that there is an isomorphism
$$
B \to P/(g'_1, \ldots, g'_m) =
\left(A[x_1, \ldots, x_r]^h/(g'_1, \ldots, g'_m)\right)^\wedge
$$
This finishes the proof by Lemma \ref{lemma-algebraize-easy}.
\end{proof}

\noindent
The following lemma isn't true in general if $A$ is not a G-ring
but just Noetherian. Namely, if $(A, \mathfrak m)$ is local
and $I = \mathfrak m$, then the lemma is equivalent to 
Artin approximation for $A^h$ (as in
Smoothing Ring Maps, Theorem \ref{smoothing-theorem-approximation-property})
which does not hold for every Noetherian local ring.

\begin{lemma}
\label{lemma-fully-faithfulness}
Let $A$ be a Noetherian G-ring. Let $I \subset A$ be an ideal.
Let $B, C$ be finite type $A$-algebras. For any $A$-algebra map
$\varphi : B^\wedge \to C^\wedge$ of $I$-adic completions and any
$N \geq 1$ there exist
\begin{enumerate}
\item an \'etale ring map $C \to C'$ which induces
an isomorphism $C/IC \to C'/IC'$,
\item an $A$-algebra map $\varphi : B \to C'$
\end{enumerate}
such that $\varphi$ and $\psi$ agree modulo $I^N$
into $C^\wedge = (C')^\wedge$.
\end{lemma}

\begin{proof}
The statement of the lemma makes sense as $C \to C'$ is flat
(Algebra, Lemma \ref{algebra-lemma-etale}) hence induces an isomorphism
$C/I^nC \to C'/I^nC'$ for all $n$
(More on Algebra, Lemma \ref{more-algebra-lemma-neighbourhood-isomorphism})
and hence an isomorphism on completions.
Let $C^h$ be the henselization of the pair $(C, IC)$, see
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Then $C^h$ is the filtered colimit of the algebras $C'$
and the maps
$C \to C' \to C^h$ induce isomorphism on completions (More on Algebra,
Lemma \ref{more-algebra-lemma-henselization-Noetherian-pair}).
Thus it suffices to prove there exists an $A$-algebra map
$B \to C^h$ which is congruent to $\psi$ modulo $I^N$.
Write $B = A[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$.
The ring map $\psi$ corresponds to elements
$\hat c_1, \ldots, \hat c_n \in C^\wedge$ with
$f_j(\hat c_1, \ldots, \hat c_n) = 0$ for $j = 1, \ldots, m$.
Namely, as $A$ is a Noetherian G-ring, so is $C$, see
More on Algebra, Proposition
\ref{more-algebra-proposition-finite-type-over-G-ring}.
Thus Smoothing Ring Maps,
Lemma \ref{smoothing-lemma-henselian-pair}
applies to give elements $c_1, \ldots, c_n \in C^h$ such
that $f_j(c_1, \ldots, c_n) = 0$ for $j = 1, \ldots, m$
and such that $\hat c_i - c_i \in I^NC^h$.
This determines the map $B \to C^h$ as desired.
\end{proof}







\section{Algebraization of rig-smooth algebras}
\label{section-algebraization-rig-smooth}

\noindent
It turns out that if the rig-smooth algebra has a specific presentation,
then it is straightforward to algebraize it. Please also see
Remark \ref{remark-discussion} for a discussion.

\begin{lemma}
\label{lemma-presentation-rig-smooth}
Let $A$ be a ring. Let $f_1, \ldots, f_m \in A[x_1, \ldots, x_n]$
and set $B = A[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$. Assume $m \leq n$
and set $g = \det_{1 \leq i, j \leq m}(\partial f_j/\partial x_i)$.
Then
\begin{enumerate}
\item $g$ annihilates $\Ext^1_B(\NL_{B/A}, N)$ for every $B$-module $N$,
\item if $n = m$, then multiplication by $g$ on $\NL_{B/A}$ is $0$ in $D(B)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $T$ be the $m \times m$ matrix with entries $\partial f_j/\partial x_i$
for $1 \leq i, j \leq n$. Let $K \in D(B)$ be represented by the complex
$T : B^{\oplus m} \to B^{\oplus m}$ with terms sitting in degrees $-1$ and $0$.
By More on Algebra, Lemmas \ref{more-algebra-lemma-silly}
we have $g : K \to K$ is zero in $D(B)$. Set $J = (f_1, \ldots, f_m)$.
Recall that $\NL_{B/A}$ is homotopy equivalent to
$J/J^2 \to \bigoplus_{i = 1, \ldots, n} B\text{d}x_i$, see
Algebra, Section \ref{algebra-section-netherlander}.
Denote $L$ the complex $J/J^2 \to \bigoplus_{i = 1, \ldots, m} B\text{d}x_i$
to that we have the quotient map $\NL_{B/A} \to L$.
We also have a surjective map of complexes $K \to L$
by sending the $j$th basis element in the term $B^{\oplus m}$
in degree $-1$ to the class of $f_j$ in $J/J^2$. Picture
$$
\NL_{B/A} \to L \leftarrow K
$$
From
More on Algebra, Lemma \ref{more-algebra-lemma-two-term-surjection-map-zero}
we conclude that multiplication by $g$ on $L$ is $0$ in $D(B)$.
On the other hand, the distinguished triangle
$B^{\oplus n - m}[0] \to \NL_{B/A} \to L$
shows that $\Ext^1_B(L, N) \to \Ext^1_B(\NL_{B/A}, N)$ is surjective
for every $B$-module $N$ and hence annihilated by $g$.
This proves part (1).
If $n = m$ then $\NL_{B/A} = L$ and we see that (2) holds.
\end{proof}

\begin{lemma}
\label{lemma-approximate-presentation-rig-smooth}
Let $I$ be an ideal of a Noetherian ring $A$. Let $B$ be an object
of (\ref{equation-C-prime}). Let $B = A[x_1, \ldots, x_r]^\wedge/J$
be a presentation. Assume there exists an element
$b \in B$, $0 \leq m \leq r$, and $f_1, \ldots, f_m \in J$
such that
\begin{enumerate}
\item $V(b) \subset V(IB)$ in $\Spec(B)$,
\item the image of
$\Delta = \det_{1 \leq i, j \leq m}(\partial f_j/\partial x_i)$
in $B$ divides $b$, and
\item $b J \subset (f_1, \ldots, f_m) + J^2$.
\end{enumerate}
Then there exists a finite type $A$-algebra $C$ and an $A$-algebra
isomorphism $B \cong C^\wedge$.
\end{lemma}

\begin{proof}
The conditions imply that $B$ is rig-smooth over $(A, I)$, see
Lemma \ref{lemma-equivalent-with-artin-smooth}.
Write $b' \Delta = b$ in $B$ for some $b' \in B$.
Say $I = (a_1, \ldots, a_t)$. Since $V(b) \subset V(IB)$ there
exists an integer $c \geq 0$ such that $I^cB \subset bB$.
Write $bb_i = a_i^c$ in $B$ for some $b_i \in B$.

\medskip\noindent
Choose an integer $n \gg 0$ (we will see later how large).
Choose polynomials $f'_1, \ldots, f'_m \in A[x_1, \ldots, x_r]$
such that $f_i - f'_i \in I^nA[x_1, \ldots, x_r]^\wedge$.
We set $\Delta' = \det_{1 \leq i, j \leq m}(\partial f'_j/\partial x_i)$
and we consider the finite type $A$-algebra
$$
C = A[x_1, \ldots, x_r, z_1, \ldots, z_t]/
(f'_1, \ldots, f'_m,
z_1\Delta' - a_1^c, \ldots, z_t\Delta' - a_t^c)
$$
We will apply Lemma \ref{lemma-presentation-rig-smooth} to $C$.
We compute
$$
\det\left(
\begin{matrix}
\text{matrix of partials of} \\
f'_1, \ldots, f'_m, z_1\Delta' - a_1^c, \ldots, z_t\Delta' - a_t^c \\
\text{with respect to the variables} \\
x_1, \ldots, x_m, z_1, \ldots, z_t
\end{matrix}
\right) =
(\Delta')^{t + 1}
$$
Hence we see that $\Ext^1_C(\NL_{C/A}, N)$ is annihilated by
$(\Delta')^{t + 1}$ for all $C$-modules $N$. Since $a_i^c$ is
divisible by $\Delta'$ in $C$ we see that $a_i^{(t + 1)c}$ annihilates
these $\Ext^1$'s also. Thus $I^{c_1}$ annihilates
$\Ext^1_C(\NL_{C/A}, N)$ for all $C$-modules $N$
where $c_1 = 1 + t((t + 1)c - 1)$. The exact value of $c_1$ doesn't matter for
the rest of the argument; what matters is that it is independent of $n$.

\medskip\noindent
Since $\NL_{C^\wedge/A}^\wedge = \NL_{C/A} \otimes_C C^\wedge$ by
Lemma \ref{lemma-NL-is-completion} we conclude that multiplication
by $I^{c_1}$ is zero on $\Ext^1_{C^\wedge}(\NL_{C^\wedge/A}^\wedge, N)$
for any $C^\wedge$-module $N$ as well, see
More on Algebra, Lemmas
\ref{more-algebra-lemma-base-change-property-ext-1-annihilated} and
\ref{more-algebra-lemma-two-term-base-change}.
In particular $C^\wedge$ is rig-smooth over $(A, I)$.

\medskip\noindent
Observe that we have a surjective $A$-algebra homomorphism
$$
\psi_n : C \longrightarrow B/I^nB
$$
sending the class of $x_i$ to the class of $x_i$ and sending the class of
$z_i$ to the class of $b_ib'$. This works because of our choices of $b'$
and $b_i$ in the first paragraph of the proof.

\medskip\noindent
Let $d = d(\text{Gr}_I(B))$ and $q_0 = q(\text{Gr}_I(B))$ be the integers
found in 
Local Cohomology, Section \ref{local-cohomology-section-uniform}.
By Lemma \ref{lemma-get-morphism-general-better} if we take
$n \geq \max(q_0 + (d + 1)c_1, 2(d + 1)c_1 + 1)$ we can find a homomorphism
$\varphi : C^\wedge \to B$ of $A$-algebras which is congruent to
$\psi_n$ modulo $I^{n - (d + 1)c_1}B$.

\medskip\noindent
Since $\varphi : C^\wedge \to B$ is surjective modulo $I$
we see that it is surjective (for example use
Algebra, Lemma \ref{algebra-lemma-completion-generalities}).
To finish the proof it suffices to show that
$\Ker(\varphi)/\Ker(\varphi)^2$ is annihilated by a power of $I$, see
More on Algebra, Lemma \ref{more-algebra-lemma-quotient-by-idempotent}.

\medskip\noindent
Since $\varphi$ is surjective we see that
$\NL_{B/C^{\wedge}}^\wedge$ has cohomology modules
$H^0(\NL_{B/C^{\wedge}}^\wedge) = 0$ and
$H^{-1}(\NL_{B/C^{\wedge}}^\wedge) = \Ker(\varphi)/\Ker(\varphi)^2$.
We have an exact sequence
$$
H^{-1}(\NL_{C^\wedge/A}^\wedge \otimes_{C^\wedge} B) \to
H^{-1}(\NL_{B/A}^\wedge) \to
H^{-1}(\NL_{B/C^{\wedge}}^\wedge) \to
H^0(\NL_{C^\wedge/A}^\wedge \otimes_{C^\wedge} B) \to
H^0(\NL_{B/A}^\wedge) \to 0
$$
by Lemma \ref{lemma-exact-sequence-NL}. The first two modules are
annihilated by a power of $I$ as $B$ and $C^\wedge$ are rig-smooth over
$(A, I)$. Hence it suffices
to show that the kernel of the surjective map
$H^0(\NL_{C^\wedge/A}^\wedge \otimes_{C^\wedge} B) \to
H^0(\NL_{B/A}^\wedge)$ is annihilated by a power of $I$.
For this it suffices to show that it is annihilated by
a power of $b$. In other words, it suffices to show that
$$
H^0(\NL_{C^\wedge/A}^\wedge) \otimes_{C^\wedge} B[1/b]
\longrightarrow
H^0(\NL_{B/A}^\wedge) \otimes_B B[1/b]
$$
is an isomorphism. However, both are free $B[1/b]$ modules
of rank $r - m$ with basis $\text{d}x_{m + 1}, \ldots, \text{d}x_r$
and we conclude the proof.
\end{proof}

\begin{remark}
\label{remark-discussion}
Let $I$ be an ideal of a Noetherian ring $A$. Let $B$ be an object
of (\ref{equation-C-prime}) which is rig-smooth over $(A, I)$.
As far as we know, it is an open question as to whether $B$
is isomorphic to the $I$-adic completion of a finite type $A$-algebra.
Here are some things we do know:
\begin{enumerate}
\item If $A$ is a G-ring, then the answer is yes by
Proposition \ref{proposition-approximate}.
\item If $B$ is rig-\'etale over $(A, I)$, then the answer is
yes by Lemma \ref{lemma-approximate}.
\item If $I$ is principal, then the answer is yes by
\cite[III Theorem 7]{Elkik}.
\item In general there exists an ideal $J = (b_1, \ldots, b_s) \subset B$
such that $V(J) \subset V(IB)$ and such that the $I$-adic completion of
each of the affine blowup algebras $B[\frac{J}{b_i}]$ are isomorphic
to the $I$-adic completion of a finite type $A$-algebra.
\end{enumerate}
To see the last statement, choose $b_1, \ldots, b_s$ as in
Lemma \ref{lemma-equivalent-with-artin-smooth} part (4)
and use the properties mentioned there to see that
Lemma \ref{lemma-approximate-presentation-rig-smooth}
applies to each completion $(B[\frac{J}{b_i}])^\wedge$.
Part (4) tells us that ``rig-locally a rig-smooth formal algebraic space is
the completion of a finite type scheme over $A$'' and it tells us that
``there is an admissible formal blowing up of $\text{Spf}(B)$
which is affine locally algebraizable''.
\end{remark}







\section{Rig-\'etale algebras}
\label{section-rig-etale}

\noindent
In view of our definition of rig-smooth algebras
(Definition \ref{definition-rig-smooth-homomorphism}),
the following definition should not come as a surprise.

\begin{definition}
\label{definition-rig-etale-homomorphism}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}). We say
$B$ is {\it rig-\'etale over $(A, I)$} if there exists an integer
$c \geq 0$ such that for all $a \in I^c$
multiplication by $a$ on $\NL_{B/A}^\wedge$
is zero in $D(B)$.
\end{definition}

\noindent
Condition (\ref{item-condition-artin}) in the next lemma is
one of the conditions used in \cite{ArtinII} to define formal modifications.
We have added it to the list of conditions to facilitate comparison
with our conditions later on.

\begin{lemma}
\label{lemma-equivalent-with-artin}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}). Write
$B = A[x_1, \ldots, x_r]^\wedge/J$
(Lemma \ref{lemma-topologically-finite-type-Noetherian})
and let $\NL_{B/A}^\wedge = (J/J^2 \to \bigoplus B\text{d}x_i)$
be its naive cotangent complex (\ref{equation-NL}).
The following are equivalent
\begin{enumerate}
\item $B$ is rig-\'etale over $(A, I)$,
\item
\label{item-zero-on-NL}
there exists a $c \geq 0$ such that for all $a \in I^c$ multiplication by $a$
on $\NL_{B/A}^\wedge$ is zero in $D(B)$,
\item
\label{item-zero-on-cohomology-NL}
there exits a $c \geq 0$ such that $H^i(\NL_{B/A}^\wedge)$, $i = -1, 0$ is
annihilated by $I^c$,
\item
\label{item-zero-on-cohomology-NL-truncations}
there exists a $c \geq 0$ such that $H^i(\NL_{B_n/A_n})$, $i = -1, 0$ is
annihilated by $I^c$ for all $n \geq 1$ where $A_n = A/I^n$ and $B_n = B/I^nB$,
\item
\label{item-condition-artin-pre-pre}
for every $a \in I$ there exists a $c \geq 0$ such that
\begin{enumerate}
\item $a^c$ annihilates $H^0(\NL_{B/A}^\wedge)$, and
\item there exist $f_1, \ldots, f_r \in J$ such that
$a^c J \subset (f_1, \ldots, f_r) + J^2$.
\end{enumerate}
\item
\label{item-condition-artin-pre}
for every $a \in I$ there exist $f_1, \ldots, f_r \in J$ and $c \geq 0$
such that
\begin{enumerate}
\item $\det_{1 \leq i, j \leq r}(\partial f_j/\partial x_i)$ divides
$a^c$ in $B$, and
\item $a^c J \subset (f_1, \ldots, f_r) + J^2$.
\end{enumerate}
\item
\label{item-condition-artin}
choosing generaters $f_1, \ldots, f_t$ for $J$ we have
\begin{enumerate}
\item the Jacobian ideal of $B$ over $A$, namely the ideal in $B$
generated by the $r \times r$ minors of the matrx
$(\partial f_j/\partial x_i)_{1 \leq i \leq r, 1 \leq j \leq t}$,
contains the ideal $I^cB$ for some $c$, and
\item the Cramer ideal of $B$ over $A$, namely the ideal in $B$
generated by the image in $B$ of the $r$th Fitting ideal of $J$
as an $A[x_1, \ldots, x_r]^\wedge$-module, contains $I^cB$ for some $c$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (\ref{item-zero-on-NL}) is a restatement of
Definition \ref{definition-rig-etale-homomorphism}.

\medskip\noindent
The equivalence of (\ref{item-zero-on-NL}) and
(\ref{item-zero-on-cohomology-NL}) follows from
More on Algebra, Lemma \ref{more-algebra-lemma-zero-in-derived}.

\medskip\noindent
The equivalence of (\ref{item-zero-on-cohomology-NL})
and (\ref{item-zero-on-cohomology-NL-truncations}) follows from the fact that
the systems $\{\NL_{B_n/A_n}\}$ and $\NL_{B/A}^\wedge \otimes_B B_n$
are strictly isomorphic, see Lemma \ref{lemma-NL-is-limit}.
Some details omitted.

\medskip\noindent
Assume (\ref{item-zero-on-NL}). Let $a \in I$.
Let $c$ be such that multiplication by $a^c$ is zero on $\NL_{B/A}^\wedge$. By
More on Algebra, Lemma \ref{more-algebra-lemma-map-out-of-almost-free}
part (1) there exists a map $\alpha : \bigoplus B\text{d}x_i \to J/J^2$
such that $\text{d} \circ \alpha$ and $\alpha \circ \text{d}$ are both
multiplication by $a^c$. Let $f_i \in J$ be an element whose
class modulo $J^2$ is equal to $\alpha(\text{d}x_i)$.
A simple calculation gives that (\ref{item-condition-artin-pre})(a), (b) hold.

\medskip\noindent
We omit the verification that (\ref{item-condition-artin-pre})
implies (\ref{item-condition-artin-pre-pre}); it is just a statement
on two term complexes over $B$ of the form $M \to B^{\oplus r}$.

\medskip\noindent
Assume (\ref{item-condition-artin-pre-pre}) holds.
Say $I = (a_1, \ldots, a_t)$. Let $c_i \geq 0$ be the integer such that
(\ref{item-condition-artin-pre-pre})(a), (b)
hold for $a_i^{c_i}$. Then we see that $I^{\sum c_i}$ annihilates
$H^0(\NL_{B/A}^\wedge)$. Let $f_{i, 1}, \ldots, f_{i, r} \in J$
be as in (\ref{item-condition-artin-pre-pre})(b) for $a_i$.
Consider the composition
$$
B^{\oplus r} \to J/J^2 \to \bigoplus B\text{d}x_i
$$
where the $j$th basis vector is mapped to the class of $f_{i, j}$ in $J/J^2$.
By (\ref{item-condition-artin-pre-pre})(a) and (b) the cokernel of the
composition is annihilated by $a_i^{2c_i}$. Thus this map is surjective
after inverting $a_i^{c_i}$, and hence an isomorphism
(Algebra, Lemma \ref{algebra-lemma-fun}).
Thus the kernel of $B^{\oplus r} \to \bigoplus B\text{d}x_i$ is
$a_i$-power torsion, and hence
$H^{-1}(\NL_{B/A}^\wedge) = \Ker(J/J^2 \to \bigoplus B\text{d}x_i)$
is $a_i$-power torsion. Since $B$ is Noetherian
(Lemma \ref{lemma-topologically-finite-type-Noetherian}),
all modules including $H^{-1}(\NL_{B/A}^\wedge)$ are finite.
Thus $a_i^{d_i}$ annihilates $H^{-1}(\NL_{B/A}^\wedge)$ for some $d_i \geq 0$.
It follows that $I^{\sum d_i}$ annihilates $H^{-1}(\NL_{B/A}^\wedge)$
and we see that (\ref{item-zero-on-cohomology-NL}) holds.

\medskip\noindent
Thus conditions
(\ref{item-zero-on-NL}),
(\ref{item-zero-on-cohomology-NL}),
(\ref{item-zero-on-cohomology-NL-truncations}),
(\ref{item-condition-artin-pre-pre}), and
(\ref{item-condition-artin-pre}) are equivalent.
Thus it remains to show that these conditions are
equivalent with (\ref{item-condition-artin}).
Observe that the Cramer ideal $\text{Fit}_r(J) B$ is
equal to $\text{Fit}_r(J/J^2)$ as
$J/J^2 = J \otimes_{A[x_1, \ldots, x_r]^\wedge} B$, see
More on Algebra, Lemma \ref{more-algebra-lemma-fitting-ideal-basics} part (3).
Also, observe that the Jacobian ideal is just
$\text{Fit}_0(H^0(\NL_{B/A}^\wedge))$.
Thus we see that the equivalence of
(\ref{item-zero-on-cohomology-NL}) and (\ref{item-condition-artin})
is a purely algebraic question which we discuss in the next paragraph.

\medskip\noindent
Let $R$ be a Noetherian ring and let $I \subset R$ be an ideal.
Let $M \xrightarrow{d} R^{\oplus r}$ be a two term complex.
We have to show that the following are equivalent
\begin{enumerate}
\item[(A)] the cohomology of $M \to R^{\oplus r}$ is annihilated by a power
of $I$, and
\item[(B)] the ideals $\text{Fit}_r(M)$ and $\text{Fit}_0(\text{Coker}(d))$
contain a power of $I$.
\end{enumerate}
Since $R$ is Noetherian, we can reformulate part (2) as an inclusion
of the corresponding closed subschemes, see Algebra, Lemmas
\ref{algebra-lemma-Zariski-topology} and \ref{algebra-lemma-Noetherian-power}.
On the other hand, over the complement of $V(\text{Fit}_0(\Coker(d)))$
the cokernel of $d$ vanishes and over the complement of
$V(\text{Fit}_r(M))$ the module $M$ is locally generated by $r$
elements, see
More on Algebra, Lemma \ref{more-algebra-lemma-fitting-ideal-generate-locally}.
Thus (B) is equivalent to
\begin{enumerate}
\item[(C)] away from $V(I)$ the cokernel of $d$ vanishes and
the module $M$ is locally generated by $\leq r$ elements.
\end{enumerate}
Of course this is equivalent to the condition that $M \to R^{\oplus r}$
has vanishing cohomology over $\Spec(R) \setminus V(I)$ which in turn
is equivalent to (A). This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-rig-etale-rig-smooth}
Let $A$ be a Noetherian ring and let $I$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}).
If $B$ is rig-\'etale over $(A, I)$, then $B$ is rig-smooth over $(A, I)$.
\end{lemma}

\begin{proof}
Immediate from Definitions \ref{definition-rig-smooth-homomorphism} and
\ref{definition-rig-etale-homomorphism}.
\end{proof}

\begin{lemma}
\label{lemma-rig-etale}
Let $A$ be a Noetherian ring and let $I$ be an ideal.
Let $B$ be a finite type $A$-algebra.
\begin{enumerate}
\item If $\Spec(B) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$,
then $B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
\item If $B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin},
then there exists $g \in 1 + IB$ such that $\Spec(B_g)$ is \'etale
over $\Spec(A) \setminus V(I)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
The naive cotangent complex $\NL_{B/A}$ is a complex of finite type
$B$-modules and hence $H^{-1}$ and $H^0$ are finite $B$-modules.
Completion is an exact functor on finite $B$-modules (Algebra,
Lemma \ref{algebra-lemma-completion-flat}) and $\NL_{B^\wedge/A}^\wedge$
is the completion of the complex $\NL_{B/A}$ (this is easy to see
by choosing presentations).
Hence the assumption implies there exists a $c \geq 0$ such that
$H^{-1}/I^nH^{-1}$ and $H^0/I^nH^0$ are annihilated by $I^c$
for all $n$. By Nakayama's lemma (Algebra, Lemma \ref{algebra-lemma-NAK})
this means that $I^cH^{-1}$ and $I^cH^0$ are annihilated by an element
of the form $g = 1 + x$ with $x \in IB$. After inverting $g$
(which does not change the quotients $B/I^nB$)
we see that $\NL_{B/A}$ has cohomology annihilated by $I^c$. Thus
$A \to B$ is \'etale at any prime of $B$ not lying over $V(I)$
by the definition of \'etale ring maps, see
Algebra, Definition \ref{algebra-definition-etale}.

\medskip\noindent
Conversely, assume that $\Spec(B) \to \Spec(A)$ is \'etale over
$\Spec(A) \setminus V(I)$. Then for every $a \in I$ there exists
a $c \geq 0$ such that multiplication by $a^c$ is zero $\NL_{B/A}$.
Since $\NL_{B^\wedge/A}^\wedge$ is the derived completion of
$\NL_{B/A}$ (see Lemma \ref{lemma-NL-is-limit}) it follows that
$B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
\end{proof}

\begin{lemma}
\label{lemma-zero-after-modding-out}
Let $(A_1, I_1) \to (A_2, I_2)$ be as in
Remark \ref{remark-base-change} with $A_1$ and $A_2$ Noetherian.
Let $B_1$ be in (\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$.
If multiplication by $f_1 \in B_1$ on $\NL^\wedge_{B_1/A_1}$
is zero in $D(B_1)$, then multiplication by
the image $f_2 \in B_2$ on $\NL^\wedge_{B_2/A_2}$ is zero
in $D(B_2)$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-NL-base-change} there is a map
$$
\NL_{B_1/A_1} \otimes_{B_2} B_1 \to \NL_{B_2/A_2}
$$
which induces and isomorphism on $H^0$ and a surjection on $H^{-1}$.
Thus the result by
More on Algebra, Lemma \ref{more-algebra-lemma-two-term-surjection-map-zero}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-etale-homomorphism}
Let $A_1 \to A_2$ be a map of Noetherian rings. Let $I_i \subset A_i$
be an ideal such that $V(I_1A_2) = V(I_2)$. Let $B_1$ be in
(\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$ as in
Remark \ref{remark-base-change}.
If $B_1$ is rig-\'etale over $(A_1, I_1)$,
then $B_2$ is rig-\'etale over $(A_2, I_2)$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-zero-after-modding-out} and
Definition \ref{definition-rig-etale-homomorphism} and the fact
that $I_2^c \subset I_1A_2$ for some $c \geq 0$ as $A_2$ is Noetherian.
\end{proof}

\begin{lemma}
\label{lemma-fully-faithful-etale-over-complement}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $B$ be a finite type $A$-algebra such that
$\Spec(B) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$.
Let $C$ be a Noetherian $A$-algebra. Then any $A$-algebra
map $B^\wedge \to C^\wedge$ of $I$-adic completions
comes from a unique $A$-algebra map
$$
B \longrightarrow C^h
$$
where $C^h$ is the henselization of the pair $(C, IC)$ as
in More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Moreover, any $A$-algebra homomorphism $B \to C^h$ factors through
some \'etale $C$-algebra $C'$ such that $C/IC \to C'/IC'$ is an isomorphism.
\end{lemma}

\begin{proof}
Uniqueness follows from the fact that $C^h$ is a subring of
$C^\wedge$, see for example
More on Algebra, Lemma \ref{more-algebra-lemma-henselization-Noetherian-pair}.
The final assertion follows from the fact that $C^h$ is the filtered colimit
of these $C$-algebras $C'$, see proof of
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Having said this we now turn to the proof of existence.

\medskip\noindent
Let $\varphi : B^\wedge \to C^\wedge$ be the given map.
This defines a section
$$
\sigma : (B \otimes_A C)^\wedge \longrightarrow C^\wedge
$$
of the completion of the map $C \to B \otimes_A C$. We may
replace $(A, I, B, C, \varphi)$ by $(C, IC, B \otimes_A C, C, \sigma)$.
In this way we see that we may assume that $A = C$.

\medskip\noindent
Proof of existence in the case $A = C$. In this case the map
$\varphi : B^\wedge \to A^\wedge$ is necessarily surjective.
By Lemmas \ref{lemma-rig-etale} and \ref{lemma-exact-sequence-NL}
we see that the cohomology groups of
$\NL_{A^\wedge/\!_\varphi B^\wedge}^\wedge$
are annihilated by a power of $I$. Since $\varphi$ is surjective,
this implies that $\Ker(\varphi)/\Ker(\varphi)^2$ is annihilated
by a power of $I$. Hence $\varphi : B^\wedge \to A^\wedge$
is the completion of a finite type $B$-algebra $B \to D$, see
More on Algebra, Lemma \ref{more-algebra-lemma-quotient-by-idempotent}.
Hence $A \to D$ is a finite type algebra map which induces an isomorphism
$A^\wedge \to D^\wedge$. By
Lemma \ref{lemma-rig-etale} we may replace $D$ by a localization
and assume that $A \to D$ is \'etale away from $V(I)$.
Since $A^\wedge \to D^\wedge$ is an isomorphism, we see that
$\Spec(D) \to \Spec(A)$ is also \'etale in a neighbourhood of $V(ID)$
(for example by
More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}).
Thus $\Spec(D) \to \Spec(A)$ is \'etale. Therefore $D$ maps to
$A^h$ and the lemma is proved.
\end{proof}
















\section{A pushout argument}
\label{section-approximation}

\noindent
The only goal in this section is to prove the following lemma which
will play a key role in algebraization of rig-\'etale algebras.
We will use a bit of the theory of algebraic spaces to prove this lemma;
an earlier version of this chapter gave a (much longer) proof using algebra
and a bit of deformation theory that the interested reader can find in
the history of the Stacks project.

\begin{lemma}
\label{lemma-lift-approximation}
Let $A$ be a Noetherian ring and $I \subset A$ an ideal.
Let $J \subset A$ be a nilpotent ideal. Consider a commutative diagram
$$
\xymatrix{
C \ar[r] & C_0 \ar@{=}[r] & C/JC \\
& B_0 \ar[u] \\
A \ar[r] \ar[uu] & A_0 \ar[u] \ar@{=}[r] & A/J
}
$$
whose vertical arrows are of finite type such that
\begin{enumerate}
\item $\Spec(C) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$,
\item $\Spec(B_0) \to \Spec(A_0)$ is \'etale over
$\Spec(A_0) \setminus V(IA_0)$, and
\item $B_0 \to C_0$ is \'etale and induces an isomorphism
$B_0/IB_0 = C_0/IC_0$.
\end{enumerate}
Then we can fill in the diagram above to a commutative diagram
$$
\xymatrix{
C \ar[r] & C/JC \\
B \ar[u] \ar[r] & B_0 \ar[u] \\
A \ar[r] \ar[u] & A/J \ar[u]
}
$$
with $A \to B$ of finite type, $B/JB = B_0$, $B \to C$ \'etale, and
$\Spec(B) \to \Spec(A)$ \'etale over $\Spec(A) \setminus V(I)$.
\end{lemma}

\begin{proof}
Set $X = \Spec(A)$, $X_0 = \Spec(A_0)$, $Y_0 = \Spec(B_0)$,
$Z = \Spec(C)$, $Z_0 = \Spec(C_0)$. Furthermore, denote
$U \subset X$, $U_0 \subset X_0$, $V_0 \subset Y_0$,
$W \subset Z$, $W_0 \subset Z_0$ the complement of the
vanishing set of $I$. Here is a picture to help visualize the
situation:
$$
\xymatrix{
Z \ar[dd] & Z_0 \ar[l] \ar[d] \\
& Y_0 \ar[d] \\
X & X_0 \ar[l]
}
\quad\quad\quad
\xymatrix{
W \ar[dd] & W_0 \ar[l] \ar[d] \\
& V_0 \ar[d] \\
U & U_0 \ar[l]
}
$$
The conditions in the lemma guarantee that
$$
\xymatrix{
W_0 \ar[r] \ar[d] & Z_0 \ar[d] \\
V_0 \ar[r] & Y_0
}
$$
is an elementary distinguished square, see
Derived Categories of Spaces, Definition
\ref{spaces-perfect-definition-elementary-distinguished-square}.
In addition we know that
$W_0 \to U_0$ and $V_0 \to U_0$ are \'etale. The morphism
$X_0 \subset X$ is a finite order thickening as $J$ is assumed nilpotent.
By the topological invariance of the \'etale site
we can find a unique \'etale morphism $V \to X$ of schemes
with $V_0 = V \times_X X_0$ and we can lift the given morphism
$W_0 \to V_0$ to a unique morphism $W \to V$ over $X$.
See \'Etale Morphisms, Theorem
\ref{etale-theorem-remarkable-equivalence}.
Since $W_0 \to V_0$ is separated, the morphism $W \to V$ is separated too,
see for example
More on Morphisms, Lemma \ref{more-morphisms-lemma-deform-property}.
By Pushouts of Spaces, Lemma
\ref{spaces-pushouts-lemma-construct-elementary-distinguished-square}
we can construct an elementary distinguished square
$$
\xymatrix{
W \ar[r] \ar[d] & Z \ar[d] \\
V \ar[r] & Y
}
$$
in the category of algebraic spaces over $X$. Since the base change
of an elementary distinguished square is an elementary distinguished
square (Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-make-more-elementary-distinguished-squares})
we see that
$$
\xymatrix{
W_0 \ar[r] \ar[d] & Z_0 \ar[d] \\
V_0 \ar[r] & Y \times_X X_0
}
$$
is an elementary distinguished square. It follows that there is a
unique isomorphism $Y \times_X X_0 = Y_0$ compatible with the two
squares involving these spaces because
elementary distinguished squares are pushouts (Pushouts of Spaces, Lemma
\ref{spaces-pushouts-lemma-elementary-distinguished-square-pushout}).
It follows that $Y$ is affine by
Limits of Spaces, Proposition \ref{spaces-limits-proposition-affine}.
Write $Y = \Spec(B)$. It is clear that $B$ fits into the desired diagram
and satisfies all the properties required of it.
\end{proof}

















\section{Algebraization of rig-\'etale algebras}
\label{section-approximation-principal}

\noindent
The main goal is to prove algebraization for rig-\'etale algebras
when the underlying Noetherian ring $A$ is not assumed to be a G-ring
and when the ideal $I \subset A$ is arbitrary -- not necessarily principal.
We first prove the principal ideal case and then use the result
of Section \ref{section-approximation} to finish the proof.

\begin{lemma}
\label{lemma-approximate-principal}
\begin{reference}
The rig-\'etale case of \cite[III Theorem 7]{Elkik}
\end{reference}
Let $A$ be a Noetherian ring and $I = (a)$ a principal ideal.
Let $B$ be an object of (\ref{equation-C-prime}) which is
rig-\'etale over $(A, I)$.
Then there exists a finite type $A$-algebra $C$ and an
isomorphism $B \cong C^\wedge$.
\end{lemma}

\begin{proof}
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$.
By Lemma \ref{lemma-equivalent-with-artin} part (6) we can find
$c \geq 0$ and $f_1, \ldots, f_r \in J$ such that
$\det_{1 \leq i, j \leq r}(\partial f_j/\partial x_i)$ divides
$a^c$ in $B$ and
$a^c J \subset (f_1, \ldots, f_r) + J^2$.
Hence Lemma \ref{lemma-approximate-presentation-rig-smooth} applies.
This finishes the proof, but we'd like to point out that in
this case the use of
Lemma \ref{lemma-get-morphism-general-better}
can be replaced by the much easier
Lemma \ref{lemma-get-morphism-principal}.
\end{proof}

\begin{lemma}
\label{lemma-approximate}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}) which is
rig-\'etale over $(A, I)$.
Then there exists a finite type $A$-algebra $C$ and an
isomorphism $B \cong C^\wedge$.
\end{lemma}

\begin{proof}
We prove this lemma by induction on the number of generators of $I$.
Say $I = (a_1, \ldots, a_t)$. If $t = 0$, then $I = 0$ and there
is nothing to prove. If $t = 1$, then the lemma follows from
Lemma \ref{lemma-approximate-principal}. Assume $t > 1$.

\medskip\noindent
For any $m \geq 1$ set $\bar A_m = A/(a_t^m)$. Consider the ideal
$\bar I_m = (\bar a_1, \ldots, \bar a_{t - 1})$ in $\bar A_m$.
Observe that $V(I \bar A_m) = V(\bar I_m)$.
Let $B_m = B/(a_t^m)$ be the base change of $B$ for the
map $(A, I) \to (\bar A_m, \bar I_m)$, see Remark \ref{remark-take-bar}.
By Lemma \ref{lemma-base-change-rig-etale-homomorphism}
we find that $B_m$ is rig-\'etale over $(\bar A_m, \bar I_m)$.

\medskip\noindent
By induction hypothesis (on $t$) we can find a finite type
$\bar A_m$-algebra $C_m$ and a map $C_m \to B_m$ which induces an
isomorphism $C_m^\wedge \cong B_m$
where the completion is with respect to $\bar I_m$.
By Lemma \ref{lemma-rig-etale} we may assume that
$\Spec(C_m) \to \Spec(\bar A_m)$ is \'etale
over $\Spec(\bar A_m) \setminus V(\bar I_m)$.

\medskip\noindent
We claim that we may choose $A_m \to C_m \to B_m$ as in the previous
paragraph such that moreover there are isomorphisms
$C_m/(a_t^{m - 1}) \to C_{m - 1}$ compatible with the given
$A$-algebra structure and the maps to $B_{m - 1} = B_m/(a_t^{m - 1})$.
Namely, first fix a choice of $A_1 \to C_1 \to B_1$.
Suppose we have found $C_{m - 1} \to C_{m - 2} \to \ldots \to C_1$
with the desired properties.
Note that $C_m/(a_t^{m - 1})$ is \'etale over
$\Spec(\bar A_{m - 1}) \setminus V(\bar I_{m - 1})$.
Hence by Lemma \ref{lemma-fully-faithful-etale-over-complement}
there exists an \'etale extension $C_{m - 1} \to C'_{m - 1}$
which induces an isomorphism modulo $\bar I_{m - 1}$ and an
$\bar A_{m - 1}$-algebra map $C_m/(a_t^{m - 1}) \to C'_{m - 1}$
inducing the isomorphism $B_m/(a_t^{m - 1}) \to B_{m - 1}$ on completions.
Note that $C_m/(a_t^{m - 1}) \to C'_{m - 1}$ is \'etale over the complement
of $V(\bar I_{m - 1})$ by
Morphisms, Lemma \ref{morphisms-lemma-etale-permanence}
and over $V(\bar I_{m - 1})$ induces an isomorphism on completions
hence is \'etale there too (for example by More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}).
Thus $C_m/(a_t^{m - 1}) \to C'_{m - 1}$ is \'etale. By the
topological invariance of \'etale morphisms
(\'Etale Morphisms, Theorem \ref{etale-theorem-remarkable-equivalence})
there exists an \'etale ring map $C_m \to C'_m$ such that
$C_m/(a_t^{m - 1}) \to C'_{m - 1}$ is isomorphic to
$C_m/(a_t^{m - 1}) \to C'_m/(a_t^{m - 1})$. Observe that the
$\bar I_m$-adic completion of $C'_m$ is equal to the $\bar I_m$-adic
completion of $C_m$, i.e., to $B_m$ (details omitted).
We apply Lemma \ref{lemma-lift-approximation} to the diagram
$$
\xymatrix{
 & C'_m \ar[r] & C'_m/(a_t^{m - 1}) \\
C''_m \ar@{..>}[ru] \ar@{..>}[rr] & & C_{m - 1} \ar[u] \\
 & \bar A_m \ar[r] \ar[uu] \ar@{..>}[lu] & \bar A_{m - 1} \ar[u]
}
$$
to see that there exists a ``lift'' of $C''_m$ of $C_{m - 1}$
to an algebra over $\bar A_m$ with all the desired properties.

\medskip\noindent
By construction $(C_m)$ is an object of the category
(\ref{equation-C}) for the principal ideal $(a_t)$.
Thus the inverse limit $B' = \lim C_m$ is an $(a_t)$-adically
complete $A$-algebra such that $B'/a_t B'$ is of finite type
over $A/(a_t)$, see Lemma \ref{lemma-topologically-finite-type}.
By construction the $I$-adic completion of $B'$ is isomorphic to $B$
(details omitted). Consider the complex $\NL_{B'/A}^\wedge$ constructed
using the $(a_t)$-adic topology. Choosing a presentation for $B'$
(which induces a similar presentation for $B$) the reader immediately
sees that $\NL_{B'/A}^\wedge \otimes_{B'} B = \NL_{B/A}^\wedge$.
Since $a_t \in I$ and since the cohomology modules of
$\NL_{B'/A}^\wedge$ are finite $B'$-modules (hence complete for the
$a_t$-adic topology), we conclude that $a_t^c$ acts as zero on
these cohomologies as the same thing is true by assumption for
$\NL_{B/A}^\wedge$. Thus $B'$ is rig-\'etale over $(A, (a_t))$
by Lemma \ref{lemma-equivalent-with-artin}.
Hence finally, we may apply Lemma \ref{lemma-approximate-principal}
to $B'$ over $(A, (a_t))$ to finish the proof.
\end{proof}

\begin{lemma}
\label{lemma-approximate-by-etale-over-complement}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $B$ be an $I$-adically complete $A$-algebra with $A/I \to B/IB$
of finite type. The equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin} are also equivalent to
\begin{enumerate}
\item[(8)]
\label{item-algebraize}
there exists a finite type $A$-algebra $C$ such that
$\Spec(C) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$
and such that $B \cong C^\wedge$.
\end{enumerate}
\end{lemma}

\begin{proof}
Combine Lemmas \ref{lemma-equivalent-with-artin}, \ref{lemma-approximate}, and
\ref{lemma-rig-etale}. Small detail omitted.
\end{proof}




\section{Finite type morphisms}
\label{section-finite-type}

\noindent
In Formal Spaces, Section \ref{formal-spaces-section-finite-type}
we have defined finite type morphisms of formal algebraic spaces.
In this section we study the corresponding types of continuous
ring maps of adic topological rings which have a finitely generated
ideal of definition. We strongly suggest the reader skip this section.

\begin{lemma}
\label{lemma-finite-type}
Let $A$ and $B$ be adic topological rings which have a finitely generated
ideal of definition. Let $\varphi : A \to B$ be a continuous ring homomorphism.
The following are equivalent:
\begin{enumerate}
\item $\varphi$ is adic and $B$ is topologically of finite type over $A$,
\item $\varphi$ is taut and $B$ is topologically of finite type over $A$,
\item there exists an ideal of definition $I \subset A$ such that
the topology on $B$ is the $I$-adic topology and there exist an ideal
of definition $I' \subset A$ such that $A/I' \to B/I'B$ is of finite type,
\item for all ideals of definition $I \subset A$ the topology on $B$
is the $I$-adic topology and $A/I \to B/IB$ is of finite type,
\item there exists an ideal of definition $I \subset A$ such that
the topology on $B$ is the $I$-adic topology and $B$ is in the category
(\ref{equation-C-prime}),
\item for all ideals of definition $I \subset A$ the topology on $B$
is the $I$-adic topology and $B$ is in the category (\ref{equation-C-prime}),
\item $B$ as a topological $A$-algebra is the quotient of
$A\{x_1, \ldots, x_r\}$ by a closed ideal,
\item $B$ as a topological $A$-algebra is the quotient of
$A[x_1, \ldots, x_r]^\wedge$ by a closed ideal where
$A[x_1, \ldots, x_r]^\wedge$ is the completion of $A[x_1, \ldots, x_r]$
with respect to some ideal of definition of $A$, and
\item add more here.
\end{enumerate}
Moreover, these equivalent conditions define
a local property of morphisms of $\text{WAdm}^{adic*}$ as defined in
Formal Spaces, Remark \ref{formal-spaces-remark-variant-adic-star}.
\end{lemma}

\begin{proof}
Taut ring homomorphisms are defined in
Formal Spaces, Definition \ref{formal-spaces-definition-taut}.
Adic ring homomorphisms are defined in
Formal Spaces, Definition
\ref{formal-spaces-definition-adic-homomorphism}.
The lemma follows from a combination of
Formal Spaces, Lemmas
\ref{formal-spaces-lemma-quotient-restricted-power-series},
\ref{formal-spaces-lemma-quotient-restricted-power-series-admissible}, and
\ref{formal-spaces-lemma-adic-homomorphism}. We omit the details.
To be sure, there is no difference between the topological rings
$A[x_1, \ldots, x_n]^\wedge$ and $A\{x_1, \ldots, x_r\}$, see
Formal Spaces, Remark
\ref{formal-spaces-remark-I-adic-completion-and-restricted-power-series}.
\end{proof}

\begin{remark}
\label{remark-NL-well-defined-topological}
Let $A \to B$ be an arrow of $\text{WAdm}^{adic*}$ which is adic and
topologically of finite type (see Lemma \ref{lemma-finite-type}). Write
$B = A\{x_1, \ldots, x_r\}/J$. Then we can set\footnote{In fact, this
construction works for arrows of $\text{WAdm}^{count}$ satisfying the
equivalent conditions of Formal Spaces, Lemma
\ref{formal-spaces-lemma-quotient-restricted-power-series}.}
$$
\NL_{B/A}^\wedge = \left(J/J^2 \longrightarrow \bigoplus B\text{d}x_i\right)
$$
Exactly as in the proof of Lemma \ref{lemma-NL-up-to-homotopy}
the reader can show that this complex of $B$-modules is
well defined up to (unique isomorphism) in the homotopy category $K(B)$.
Now, if $A$ is Noetherian and $I \subset A$ is an ideal of definition,
then this construction reproduces the naive cotangent complex
of $B$ over $(A, I)$ defined by Equation (\ref{equation-NL})
in Section \ref{section-naive-cotangent-complex} simply because
$A[x_1, \ldots, x_n]^\wedge$ agrees with $A\{x_1, \ldots, x_r\}$ by
Formal Spaces, Remark
\ref{formal-spaces-remark-I-adic-completion-and-restricted-power-series}.
In particular, we find that, still when $A$ is an adic Noetherian
topological ring, the object $\NL_{B/A}^\wedge$ is independent
of the choice of the ideal of definition $I \subset A$.
\end{remark}

\begin{lemma}
\label{lemma-base-change-finite-type}
Consider the property $P$ on arrows of $\textit{WAdm}^{adic*}$ defined in
Lemma \ref{lemma-finite-type}. Then $P$ is stable under base change as
defined in Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-adic-star}.
\end{lemma}

\begin{proof}
The statement makes sense by Lemma \ref{lemma-finite-type}.
To see that it is true assume we have morphisms
$B \to A$ and $B \to C$ in $\textit{WAdm}^{adic*}$
and that as a topological $B$-algebra we have
$A = B\{x_1, \ldots, x_r\}/J$ for some closed ideal $J$.
Then $A \widehat{\otimes}_B C$ is isomorphic to the
quotient of $C\{x_1, \ldots, x_r\}/J'$ where
$J'$ is the closure of $JC\{x_1, \ldots, x_r\}$.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-finite-type}
Consider the property $P$ on arrows of $\textit{WAdm}^{adic*}$ defined in
Lemma \ref{lemma-finite-type}. Then $P$ is stable under composition as
defined in Formal Spaces, Remark
\ref{formal-spaces-remark-composition-variant-adic-star}.
\end{lemma}

\begin{proof}
The statement makes sense by Lemma \ref{lemma-finite-type}.
The easiest way to prove it is true is to show that
(a) compositions of adic ring maps between adic topological rings
are adic and (b) that compositions of continuous ring maps
preserves the property of being topologically of finite type.
We omit the details.
\end{proof}

\noindent
The following lemma says that morphisms of adic* formal algebraic spaces
are locally of finite type if and only if they are \'etale locally given
by the types of maps of topological rings described in
Lemma \ref{lemma-finite-type}.

\begin{lemma}
\label{lemma-finite-type-morphisms}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of
locally adic* formal algebraic spaces over $S$.
The following are equivalent
\begin{enumerate}
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to an arrow of $\textit{WAdm}^{adic*}$ which is
adic and topologically of finite type,
\item there exists a covering $\{Y_j \to Y\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $j$
a covering $\{X_{ji} \to Y_j \times_Y X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
such that each $X_{ji} \to Y_j$  corresponds
to an arrow of $\textit{WAdm}^{adic*}$ which is adic and
topologically of finite type,
\item there exist a covering $\{X_i \to X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $i$ a factorization $X_i \to Y_i \to Y$ where $Y_i$
is an affine formal algebraic space, $Y_i \to Y$ is representable
by algebraic spaces and \'etale, and $X_i \to Y_i$ corresponds
to an arrow of $\textit{WAdm}^{adic*}$ which is adic and topologically
of finite type, and
\item $f$ is locally of finite type.
\end{enumerate}
\end{lemma}

\begin{proof}
Immediate consequence of the equivalence of (1) and (2) in
Lemma \ref{lemma-finite-type} and
Formal Spaces, Lemma
\ref{formal-spaces-lemma-finite-type-local-property}.
\end{proof}










\section{Finite type on reductions}
\label{section-finite-type-red}

\noindent
In this section we talk a little bit about morphisms $X \to Y$
of locally countably indexed formal algebraic spaces such that
$X_{red} \to Y_{red}$ is locally of finite type. We will translate
this into an algebraic condition. To understand this algebraic
condition it pays to keep in mind the following:
\begin{itemize}
\item If $A$ is a weakly admissible topological ring, then the
set $\mathfrak a \subset A$ of topological nilpotent elements
is an open, radical ideal and
$\text{Spf}(A)_{red} = \Spec(A/\mathfrak a)$.
\end{itemize}
See Formal Spaces, Definition
\ref{formal-spaces-definition-weakly-admissible},
Lemma \ref{formal-spaces-lemma-topologically-nilpotent}, and
Example \ref{formal-spaces-example-reduction-affine-formal-spectrum}.

\begin{lemma}
\label{lemma-finite-type-red}
For an arrow $\varphi : A \to B$ in $\text{WAdm}^{count}$ consider
the property $P(\varphi)=$``the induced ring homomorphism
$A/\mathfrak a \to B/\mathfrak b$ is of finite type''
where $\mathfrak a \subset A$ and $\mathfrak b \subset B$ are the ideals
of topologically nilpotent elements. Then $P$ is a local property
as defined in
Formal Spaces, Situation
\ref{formal-spaces-situation-local-property}.
\end{lemma}

\begin{proof}
Consider a commutative diagram
$$
\xymatrix{
B \ar[r] & (B')^\wedge \\
A \ar[r] \ar[u]^\varphi & (A')^\wedge \ar[u]_{\varphi'}
}
$$
as in Formal Spaces, Situation
\ref{formal-spaces-situation-local-property}.
Taking $\text{Spf}$ of this diagram we obtain
$$
\xymatrix{
\text{Spf}(B) \ar[d] &
\text{Spf}((B')^\wedge) \ar[l] \ar[d] \\
\text{Spf}(A) &
\text{Spf}((A')^\wedge) \ar[l]
}
$$
of affine formal algebraic spaces whose horizontal arrows are
representable by algebraic spaces and \'etale by
Formal Spaces, Lemma \ref{formal-spaces-lemma-etale}.
Hence we obtain a commutative diagram of affine schemes
$$
\xymatrix{
\text{Spf}(B)_{red} \ar[d]^f &
\text{Spf}((B')^\wedge)_{red} \ar[l]^g \ar[d]^{f'} \\
\text{Spf}(A)_{red} &
\text{Spf}((A')^\wedge)_{red} \ar[l]
}
$$
whose horizontal arrows are \'etale by
Formal Spaces, Lemma \ref{formal-spaces-lemma-reduction-smooth}.
By Formal Spaces, Example
\ref{formal-spaces-example-reduction-affine-formal-spectrum} and
Lemma \ref{formal-spaces-lemma-etale-surjective}
conditions (1), (2), and (3) of
Formal Spaces, Situation
\ref{formal-spaces-situation-local-property}
translate into the following statements
\begin{enumerate}
\item if $f$ is locally of finite type, then $f'$ is locally of finite type,
\item if $f'$ is locally of finite type and $g$ is surjective, then
$f$ is locally of finite type, and
\item if $T_i \to S$, $i = 1, \ldots, n$ are locally of finite type, then
$\coprod_{i = 1, \ldots, n} T_i \to S$ is locally of finite type.
\end{enumerate}
Properties (1) and (2) follow from the fact that being locally
of finite type is local on the source and target in the
\'etale topology, see discussion in
Morphisms of Spaces, Section \ref{spaces-morphisms-section-finite-type}.
Property (3) is a straightforward consequence of the definition.
\end{proof}

\begin{lemma}
\label{lemma-base-change-finite-type-red}
Consider the property $P$ on arrows of $\textit{WAdm}^{count}$ defined in
Lemma \ref{lemma-finite-type-red}. Then $P$ is stable under base change
(Formal Spaces, Situation
\ref{formal-spaces-situation-base-change-local-property}).
\end{lemma}

\begin{proof}
The statement makes sense by Lemma \ref{lemma-finite-type-red}.
To see that it is true assume we have morphisms $B \to A$ and $B \to C$
in $\textit{WAdm}^{count}$ such that $B/\mathfrak b \to A/\mathfrak a$
is of finite type where $\mathfrak b \subset B$ and $\mathfrak a \subset A$
are the ideals of topologically nilpotent elements.
Since $A$ and $B$ are weakly admissible, the ideals
$\mathfrak a$ and $\mathfrak b$ are open.
Let $\mathfrak c \subset C$ be the (open) ideal
of topologically nilpotent elements. Then we find a surjection
$A \widehat{\otimes}_B C \to
A/\mathfrak a \otimes_{B/\mathfrak b} C/\mathfrak c$
whose kernel is a weak ideal of definition and hence consists
of topologically nilpotent elements
(please compare with the proof of Formal Spaces,
Lemma \ref{formal-spaces-lemma-completed-tensor-product}). Since already
$C/\mathfrak c \to A/\mathfrak a \otimes_{B/\mathfrak b} C/\mathfrak c$
is of finite type as a base change of $B/\mathfrak b \to A/\mathfrak a$
we conclude.
\end{proof}

\begin{lemma}
\label{lemma-composition-finite-type-red}
Consider the property $P$ on arrows of $\textit{WAdm}^{count}$ defined in
Lemma \ref{lemma-finite-type-red}. Then $P$ is stable under composition
(Formal Spaces, Situation
\ref{formal-spaces-situation-composition-local-property}).
\end{lemma}

\begin{proof}
Omitted. Hint: compositions of finite type ring maps are of finite type.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-finite-type-red}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{count}$.
If $\varphi$ is taut and topologically of finite type, then $\varphi$
satisfies the condition defined in Lemma \ref{lemma-finite-type-red}.
\end{lemma}

\begin{proof}
This is an easy consequence of the definitions.
\end{proof}

\begin{lemma}
\label{lemma-Noetherian-finite-type-red}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{Noeth}$
satisfying the condition defined in Lemma \ref{lemma-finite-type-red}.
Then $A \to B$ is topologically of finite type.
\end{lemma}

\begin{proof}
Let $\mathfrak b \subset B$ be the
ideal of topologically nilpotent elements. Choose $b_1, \ldots, b_r \in B$
which map to generators of $B/\mathfrak b$ over $A$.
Choose generators $b_{r + 1}, \ldots, b_s$ of the ideal
$\mathfrak b$. We claim that the image of
$$
\varphi : A[x_1, \ldots, x_s] \longrightarrow B, \quad
x_i \longmapsto b_i
$$
has dense image. Namely, if $b \in \mathfrak b^n$ for some $n \geq 0$,
then we can write
$b = \sum b_E b_{r + 1}^{e_{r + 1}} \ldots b_s^{e_s}$ for multiindices
$E = (e_{r + 1}, \ldots, e_s)$ with $|E| = \sum e_i = n$ and $b_E \in B$.
Next, we can write $b_E = f_E(b_1, \ldots, b_r) + b'_E$
with $b'_E \in \mathfrak b$ and $f_E \in A[x_1, \ldots, x_r]$.
Combined we obtain $b \in \Im(\varphi) + \mathfrak b^{n + 1}$.
By induction we see that $B = \Im(\varphi) + \mathfrak b^n$ for all
$n \geq 0$ which mplies what we want as $\mathfrak b$ is an ideal
of definition of $B$.
\end{proof}

\begin{lemma}
\label{lemma-Noetherian-adic-finite-type-red}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{Noeth}$.
If $\varphi$ is adic the following are equivalent
\begin{enumerate}
\item $\varphi$ satisfies the condition defined in
Lemma \ref{lemma-finite-type-red} and
\item $\varphi$ satisfies the condition defined in
Lemma \ref{lemma-finite-type}.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: For the proof of (1) $\Rightarrow$ (2) use
Lemma \ref{lemma-Noetherian-finite-type-red}.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-red-morphisms}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of
locally countably indexed formal algebraic spaces over $S$.
The following are equivalent
\begin{enumerate}
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to an arrow of $\textit{WAdm}^{count}$ satisfying the
property defined in Lemma \ref{lemma-finite-type-red},
\item there exists a covering $\{Y_j \to Y\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $j$
a covering $\{X_{ji} \to Y_j \times_Y X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
such that each $X_{ji} \to Y_j$  corresponds
to an arrow of $\textit{WAdm}^{count}$ satisfying the
property defined in Lemma \ref{lemma-finite-type-red},
\item there exist a covering $\{X_i \to X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $i$ a factorization $X_i \to Y_i \to Y$ where $Y_i$
is an affine formal algebraic space, $Y_i \to Y$ is representable
by algebraic spaces and \'etale, and $X_i \to Y_i$ corresponds
to an arrow of $\textit{WAdm}^{count}$ satisfying the
property defined in Lemma \ref{lemma-finite-type-red}, and
\item the morphism $f_{red} : X_{red} \to Y_{red}$ is locally of finite type.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1), (2), and (3) follows from
Lemma \ref{lemma-finite-type-red} and an application of
Formal Spaces, Lemma
\ref{formal-spaces-lemma-property-defines-property-morphisms}.
Let $Y_j$ and $X_{ji}$ be as in (2). Then
\begin{itemize}
\item The families $\{Y_{j, red} \to Y_{red}\}$ and
$\{X_{ji, red} \to X_{red}\}$ are \'etale coverings by affine schemes.
This follows from the discussion in the proof of
Formal Spaces, Lemma
\ref{formal-spaces-lemma-reduction-formal-algebraic-space}
or directly from
Formal Spaces, Lemma \ref{formal-spaces-lemma-reduction-smooth}.
\item If $X_{ji} \to Y_j$ corresponds to the morphism
$B_j \to A_{ji}$ of $\textit{WAdm}^{count}$, then
$X_{ji, red} \to Y_{j, red}$ corresponds to the ring map
$B_j/\mathfrak b_j \to A_{ji}/\mathfrak a_{ji}$ where
$\mathfrak b_j$ and $\mathfrak a_{ji}$ are the ideals of
topologically nilpotent elements. This follows from
Formal Spaces, Example
\ref{formal-spaces-example-reduction-affine-formal-spectrum}.
Hence $X_{ji, red} \to Y_{j, red}$ is locally of finite type
if and only if $B_j \to A_{ji}$ satisfies the
property defined in Lemma \ref{lemma-finite-type-red}.
\end{itemize}
The equivalence of (2) and (4) follows from these remarks because
being locally of finite type is a property of morphisms of algebraic
spaces which is \'etale local on source and target, see discussion in
Morphisms of Spaces, Section \ref{spaces-morphisms-section-finite-type}.
\end{proof}


















\section{Flat morphisms}
\label{section-flat}

\noindent
In this section we define flat morphisms of locally Noetherian formal
algebraic spaces.

\begin{lemma}
\label{lemma-flat-axioms}
The property $P(\varphi)=$``$\varphi$ is flat'' on arrows
of $\textit{WAdm}^{Noeth}$ is a local property as defined in
Formal Spaces, Remark \ref{formal-spaces-remark-variant-Noetherian}.
\end{lemma}

\begin{proof}
Let us recall what the statement signifies. First, 
$\textit{WAdm}^{Noeth}$ is the category whose objects are
adic Noetherian topological rings and whose morphisms are
continuous ring homomorphisms. Consider a commutative diagram
$$
\xymatrix{
B \ar[r] & (B')^\wedge \\
A \ar[r] \ar[u]^\varphi & (A')^\wedge \ar[u]_{\varphi'}
}
$$
satisfying the following conditions:
$A$ and $B$ are adic Noetherian topological rings,
$A \to A'$ and $B \to B'$ are \'etale ring maps,
$(A')^\wedge = \lim A'/I^nA'$ for some ideal of definition $I \subset A$,
$(B')^\wedge = \lim B'/J^nB'$ for some ideal of definition $J \subset B$, and
$\varphi : A \to B$ and $\varphi' : (A')^\wedge \to (B')^\wedge$
are continuous. Note that $(A')^\wedge$ and $(B')^\wedge$ are
adic Noetherian topological rings by
Formal Spaces, Lemma \ref{formal-spaces-lemma-completion-in-sub}.
We have to show
\begin{enumerate}
\item $\varphi$ is flat $\Rightarrow \varphi'$ is flat,
\item if $B \to B'$ faithfully flat, then $\varphi'$ is flat
$\Rightarrow \varphi$ is flat, and
\item if $A \to B_i$ is flat for $i = 1, \ldots, n$, then
$A \to \prod_{i = 1, \ldots, n} B_i$ is flat.
\end{enumerate}
We will use without further mention that completions of Noetherian rings
are flat (Algebra, Lemma \ref{algebra-lemma-completion-flat}). Since
of course $A \to A'$ and $B \to B'$ are flat, we see in
particular that the horizontal arrows in the diagram are flat.

\medskip\noindent
Proof of (1). If $\varphi$ is flat, then the composition
$A \to (A')^\wedge \to (B')^\wedge$ is flat. Hence $A' \to (B')^\wedge$
is flat by More on Flatness, Lemma \ref{flat-lemma-etale-flat-up-down}.
Hence we see that $(A')^\wedge \to (B')^\wedge$ is flat by applying
More on Algebra, Lemma \ref{more-algebra-lemma-flat-after-completion}
with $R = A'$, with ideal $I(A')$, and with $M = (B')^\wedge = M^\wedge$.

\medskip\noindent
Proof of (2). Assume $\varphi'$ is flat and $B \to B'$ is faithfully flat.
Then the composition $A \to (A')^\wedge \to (B')^\wedge$ is flat.
Also we see that $B \to (B')^\wedge$ is faithfully flat by
Formal Spaces, Lemma
\ref{formal-spaces-lemma-etale-surjective}.
Hence by Algebra, Lemma \ref{algebra-lemma-flatness-descends-more-general}
we find that $\varphi : A \to B$ is flat.

\medskip\noindent
Proof of (3). Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-flat-continuous}
Denote $P$ the property of arrows of $\textit{WAdm}^{Noeth}$
defined in Lemma \ref{lemma-flat-axioms}.
Denote $Q$ the property defined in Lemma \ref{lemma-finite-type-red}
viewed as a property of arrows of $\textit{WAdm}^{Noeth}$.
Denote $R$ the property defined in Lemma \ref{lemma-finite-type}
viewed as a property of arrows of $\textit{WAdm}^{Noeth}$. Then
\begin{enumerate}
\item $P$ is stable under base change by $Q$
(Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-variant-Noetherian}), and
\item $P + R$ is stable under base change
(Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-Noetherian}).
\end{enumerate}
\end{lemma}

\begin{proof}
The statement makes sense as each of the properties $P$, $Q$, and $R$
is a local property of morphisms of $\textit{WAdm}^{Noeth}$.
Let $\varphi : B \to A$ and $\psi : B \to C$ be morphisms of
$\textit{WAdm}^{Noeth}$. If either $Q(\varphi)$ or $Q(\psi)$
then we see that $A \widehat{\otimes}_B C$ is Noetherian by
Formal Spaces, Lemma \ref{formal-spaces-lemma-completed-tensor-product}.
Since $R$ implies $Q$ (Lemma \ref{lemma-finite-type-finite-type-red}),
we find that this holds in both cases (1) and (2).
This is the first thing we have to check. It remains to show
that $C \to A \widehat{\otimes}_B C$ is flat.

\medskip\noindent
Proof of (1). Fix ideals of definition $I \subset A$ and $J \subset B$.
By Lemma \ref{lemma-Noetherian-finite-type-red} the ring map
$B \to C$ is topologically of finite type. Hence
$B \to C/J^n$ is of finite type for all $n \geq 1$.
Hence $A \otimes_B C/J^n$ is Noetherian as a ring
(because it is of finite type over $A$ and $A$ is Noetherian).
Thus the $I$-adic completion $A \widehat{\otimes}_B C/J^n$
of $A \otimes_B C/J^n$ is flat over $C/J^n$ because
$C/J^n \to A \otimes_B C/J^n$ is flat as a base change of
$B \to A$ and because
$A \otimes_B C/J^n \to A \widehat{\otimes}_B C/J^n$ is flat by
Algebra, Lemma \ref{algebra-lemma-completion-flat}
Observe that $A \widehat{\otimes}_B C/J^n =
(A \widehat{\otimes}_B C)/J^n(A \widehat{\otimes}_B C)$; details omitted.
We conclude that $M = A \widehat{\otimes}_B C$ is a $C$-module
which is complete with respect to the $J$-adic topology
such that $M/J^nM$ is flat over $C/J^n$ for all $n \geq 1$.
This implies that $M$ is flat over $C$ by
More on Algebra, Lemma \ref{more-algebra-lemma-limit-flat}.

\medskip\noindent
Proof of (2). In this case $B \to A$ is adic and hence we have just
$A \widehat{\otimes}_B C = \lim A \otimes_B C/J^n$.
The rings $A \otimes_B C/J^n$ are Noetherian by an application of 
Formal Spaces, Lemma \ref{formal-spaces-lemma-completed-tensor-product}
with $C$ replaced by $C/J^n$.
We conclude in the same manner as before.
\end{proof}

\begin{lemma}
\label{lemma-composition-flat-continuous}
Denote $P$ the property of arrows of $\textit{WAdm}^{Noeth}$
defined in Lemma \ref{lemma-flat-axioms}.
Then $P$ is stable under composition (Formal Spaces, Remark
\ref{formal-spaces-remark-composition-variant-Noetherian}).
\end{lemma}

\begin{proof}
This is true because compositions of flat ring maps are flat.
\end{proof}

\begin{definition}
\label{definition-flat}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of locally
Noetherian formal algebraic spaces over $S$. We say $f$ is
{\it flat} if for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to a flat map of adic Noetherian topological rings.
\end{definition}

\noindent
Let us prove that we can check this condition \'etale locally on the
source and target.

\begin{lemma}
\label{lemma-flat-morphisms}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of
locally Noetherian formal algebraic spaces over $S$.
The following are equivalent
\begin{enumerate}
\item $f$ is flat,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to a flat map in $\textit{WAdm}^{Noeth}$,
\item there exists a covering $\{Y_j \to Y\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $j$
a covering $\{X_{ji} \to Y_j \times_Y X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
such that each $X_{ji} \to Y_j$  corresponds
to a flat map in $\textit{WAdm}^{Noeth}$, and
\item there exist a covering $\{X_i \to X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $i$ a factorization $X_i \to Y_i \to Y$ where $Y_i$
is an affine formal algebraic space, $Y_i \to Y$ is representable
by algebraic spaces and \'etale, and $X_i \to Y_i$ corresponds
to a flat map in $\textit{WAdm}^{Noeth}$.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) is Definition \ref{definition-flat}.
The equivalence of (2), (3), and (4) follows from the fact that
being flat is a local property of arrows of
$\text{WAdm}^{Noeth}$ by Lemma \ref{lemma-flat-axioms}
and an application of the variant of
Formal Spaces, Lemma
\ref{formal-spaces-lemma-property-defines-property-morphisms}
for morphisms between locally Noetherian algebraic spaces
mentioned in
Formal Spaces, Remark
\ref{formal-spaces-remark-variant-Noetherian}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-flat}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Z \to Y$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
\begin{enumerate}
\item If $f$ is flat and $g_{red} : Z_{red} \to Y_{red}$ is
locally of finite type, then the base change
$X \times_Y Z \to Z$ is flat.
\item If $f$ is flat and locally of finite type, then
the base change $X \times_Y Z \to Z$ is flat and locally of finite type.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) follows from a combination of
Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-variant-Noetherian},
Lemma \ref{lemma-base-change-flat-continuous} part (1),
Lemma \ref{lemma-flat-morphisms}, and
Lemma \ref{lemma-finite-type-red-morphisms}.

\medskip\noindent
Part (2) follows from a combination of
Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-Noetherian},
Lemma \ref{lemma-base-change-flat-continuous} part (2),
Lemma \ref{lemma-flat-morphisms}, and
Lemma \ref{lemma-finite-type-morphisms}.
\end{proof}

\begin{lemma}
\label{lemma-composition-flat}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
If $f$ and $g$ are flat, then so is $g \circ f$.
\end{lemma}

\begin{proof}
Combine Formal Spaces, Remark
\ref{formal-spaces-remark-composition-variant-Noetherian}
and Lemma \ref{lemma-composition-flat-continuous}.
\end{proof}

\begin{lemma}
\label{lemma-representable-flat}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphisms of
locally Noetherian formal algebraic spaces over $S$.
If $f$ is representable by algebraic spaces and
flat in the sense of Bootstrap, Definition
\ref{bootstrap-definition-property-transformation},
then $f$ is flat in the sense of Definition \ref{definition-flat}.
\end{lemma}

\begin{proof}
This is a sanity check whose proof should be trivial but isn't quite.
We urge the reader to skip the proof.
Assume $f$ is representable by algebraic spaces and
flat in the sense of Bootstrap, Definition
\ref{bootstrap-definition-property-transformation}.
Consider a commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale.
Then the morphism $U \to V$
corresponds to a taut map $B \to A$ of $\textit{WAdm}^{Noeth}$ by
Formal Spaces, Lemma
\ref{formal-spaces-lemma-representable-local-property}.
Observe that this means $B \to A$ is adic (Formal Spaces, Lemma
\ref{formal-spaces-lemma-adic-homomorphism})
and in particular for any ideal of definition $J \subset B$
the topology on $A$ is the $J$-adic topology and the diagrams
$$
\xymatrix{
\Spec(A/J^nA) \ar[r] \ar[d] & \Spec(B/J^n) \ar[d] \\
U \ar[r] & V
}
$$
are cartesian.

\medskip\noindent
Let $T \to V$ is a morphism where $T$ is a scheme. Then
\begin{align*}
X \times_Y T \to T\text{ is flat}
& \Rightarrow
U \times_Y T \to T\text{ is flat} \\
& \Rightarrow
U \times_V V \times_Y T \to T\text{ is flat} \\
& \Rightarrow
U \times_V V \times_Y T \to V \times_Y T\text{ is flat} \\
& \Rightarrow
U \times_V T \to T\text{ is flat}
\end{align*}
The first statement is the assumption on $f$.
The first implication because $U \to X$ is \'etale and hence flat
and compositions of flat morphisms of algebraic spaces are flat.
The second impliciation because $U \times_Y T = U \times_V V \times_Y T$.
The third implication by
More on Flatness, Lemma \ref{flat-lemma-etale-flat-up-down}.
The fourth implication because we can pullback by the morphism
$T \to V \times_Y T$.
We conclude that $U \to V$ is flat in the sense of
Bootstrap, Definition
\ref{bootstrap-definition-property-transformation}.
In terms of the continuous ring map $B \to A$
this means the ring maps $B/J^n \to A/J^nA$ are flat (see diagram above).

\medskip\noindent
Finally, we can conclude that $B \to A$ is flat for example
by More on Algebra, Lemma \ref{more-algebra-lemma-limit-flat}.
\end{proof}





\section{Rig-closed points}
\label{section-rig-points}

\noindent
We develop just enough theory to be able to use this for testing
rig-flatness in a later section. The reader can find more theory
in \cite{BL-I} who discuss (among other things) the
case of locally Noetherian formal schemes.

\begin{lemma}
\label{lemma-rig-point}
Let $A$ be a Noetherian adic topological ring. Let
$\mathfrak q \subset A$ be a prime ideal. The following are
equivalent
\begin{enumerate}
\item for some ideal of definition $I \subset A$ we have
$I \not \subset \mathfrak q$ and $\mathfrak q$ is maximal
with respect to this property,
\item for some ideal of definition $I \subset A$ the prime
$\mathfrak q$ defines a closed point of $\Spec(A) \setminus V(I)$,
\item for any ideal of definition $I \subset A$ we have
$I \not \subset \mathfrak q$ and $\mathfrak q$ is maximal
with respect to this property,
\item for any ideal of definition $I \subset A$ the prime
$\mathfrak q$ defines a closed point of $\Spec(A) \setminus V(I)$,
\item $\dim(A/\mathfrak q) = 1$ and for some ideal of definition
$I \subset A$ we have $I \not \subset \mathfrak q$,
\item $\dim(A/\mathfrak q) = 1$ and for any ideal of definition
$I \subset A$ we have $I \not \subset \mathfrak q$,
\item $\dim(A/\mathfrak q) = 1$ and the induced topology
on $A/\mathfrak q$ is nontrivial,
\item $A/\mathfrak q$ is a $1$-dimensional Noetherian complete local domain
whose maximal ideal is the radical of the image of any ideal of
definition of $A$, and
\item add more here.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (1) and (2) are equivalent and for the same reason
that (3) and (4) are equivalent.
Since $V(I)$ is independent of the choice of the ideal of definition
$I$ of $A$, we see that (2) and (4) are equivalent.

\medskip\noindent
Assume the equivalent conditions (1) -- (4) hold.
If $\dim(A/\mathfrak q) > 1$ we can choose a maximal
ideal $\mathfrak q \subset \mathfrak m \subset A$
such that $\dim((A/\mathfrak q)_\mathfrak m) > 1$.
Then $\Spec((A/\mathfrak q)_\mathfrak m) - V(I(A/\mathfrak q)_\mathfrak m)$
would be infinite by Algebra, Lemma
\ref{algebra-lemma-Noetherian-local-domain-dim-2-infinite-opens}.
This contradicts the fact that $\mathfrak q$ is closed in
$\Spec(A) \setminus V(I)$.
Hence we see that (6) holds. Trivially (6) implies (5).

\medskip\noindent
Conversely, assume (5) holds. Let $I \subset A$ be an ideal of definition.
Since $A/\mathfrak q$ is complete
with respect to $I(A/\mathfrak q)$ (for example by
Algebra, Lemma \ref{algebra-lemma-completion-tensor})
we see that all closed points of $\Spec(A/\mathfrak q)$ are
contained in $V(IA/\mathfrak q)$ by
Algebra, Lemma \ref{algebra-lemma-radical-completion}.
Since $\dim(A/\mathfrak q) = 1$ and since $I \not \subset \mathfrak q$
we conclude two things: (a) $V(IA/\mathfrak q)$ must contain
all points distinct from the generic point of $\Spec(A/\mathfrak q)$, and
(b) $V(IA/\mathfrak q)$ must be a (finite) discrete set.
From (a) we see that $\mathfrak q$ is a closed point of
$\Spec(A) \setminus V(I)$ and we conclude that (2) holds.

\medskip\noindent
Continuing to assume (5) we see that the finite discrete space
$V(IA/\mathfrak q)$ must be a singleton by More on Algebra, Lemma
\ref{more-algebra-lemma-irreducible-henselian-pair-connected}
for example (and the fact that complete pairs are henselian pairs, see
More on Algebra, Lemma \ref{more-algebra-lemma-complete-henselian}).
Hence we see that (8) is true.
Conversely, it is clear that (8) implies (5).

\medskip\noindent
At this point we know that (1) -- (6) and (8) are equivalent.
We omit the verification that these are also equivalent to (7).
\end{proof}

\noindent
In order to comfortably talk about such primes we introduce
the following nonstandard notation.

\begin{definition}
\label{definition-rig-closed}
Let $A$ be a Noetherian adic topological ring. Let
$\mathfrak q \subset A$ be a prime ideal. We say
$\mathfrak q$ is {\it rig-closed} if the equivalent
conditions of Lemma \ref{lemma-rig-point} are satisfied.
\end{definition}

\noindent
We will need a few lemmas which essentially tell us there are
plenty of rig-closed primes even in a relative settting.

\begin{lemma}
\label{lemma-rig-closed-point-relative-residue-field}
Let $\varphi : A \to B$ in $\textit{WAdm}^{Noeth}$.
Denote $\mathfrak a \subset A$ and $\mathfrak b \subset B$
the ideals of topologically nilpotent elements. Assume
$A/\mathfrak a \to B/\mathfrak b$ is of finite type.
Let $\mathfrak q \subset B$ be rig-closed.
The residue field $\kappa$ of the local ring $B/\mathfrak q$
is a finite type $A/\mathfrak a$-algebra.
\end{lemma}

\begin{proof}
Let $\mathfrak q \subset \mathfrak m \subset B$ be the unique
maximal ideal containing $\mathfrak q$.
Then $\mathfrak b \subset \mathfrak m$. Hence
$A/\mathfrak a \to B/\mathfrak b \to B/\mathfrak m = \kappa$ is
of finite type.
\end{proof}

\begin{lemma}
\label{lemma-rig-closed-point-relative}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{Noeth}$
which is adic and topologically of finite type.
Let $\mathfrak q \subset B$ be rig-closed.
Let $\mathfrak p = \varphi^{-1}(\mathfrak q) \subset A$.
Let $\mathfrak a \subset A$ be the ideal of topologically nilpotent
elements.
The following are equivalent
\begin{enumerate}
\item the residue field $\kappa$ of $B/\mathfrak q$ is finite
over $A/\mathfrak a$,
\item $\mathfrak p \subset A$ is rig-closed,
\item $A/\mathfrak p \subset B/\mathfrak q$ is a finite extension
of rings.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1). Recall that $B/\mathfrak q$ is a Noetherian local ring
of dimension $1$ whose topology is the adic topology coming
from the maximal ideal. Since $\varphi$ is adic, we see that
$A \to B/\mathfrak q$ is adic. Hence $\varphi(\mathfrak a)$
is a nonzero ideal in $B/\mathfrak q$. Hence
$B/\mathfrak q + \varphi(\mathfrak a)$
has finite length. Hence $B/\mathfrak q + \varphi(\mathfrak a)$
is finite as an $A/\mathfrak a$-module by our assumption.
Thus $B/\mathfrak q$ is finite over $A$ by
Algebra, Lemma \ref{algebra-lemma-finite-over-complete-ring}.
Thus (3) holds.

\medskip\noindent
Assume (3). Then $\Spec(B/\mathfrak q) \to \Spec(A/\mathfrak p)$
is surjective by
Algebra, Lemma \ref{algebra-lemma-integral-overring-surjective}.
This implies (2).

\medskip\noindent
Assume (2). Denote $\kappa'$ the residue field of $A/\mathfrak p$.
By Lemma \ref{lemma-rig-closed-point-relative-residue-field}
(and Lemma \ref{lemma-finite-type-finite-type-red})
the extension $\kappa/\kappa'$ is finitely generated as an algebra.
By the Hilbert Nullstellensatz (Algebra, Lemma
\ref{algebra-lemma-field-finite-type-over-domain})
we see that $\kappa/\kappa'$ is a finite extension.
Hence we see that (1) holds.
\end{proof}

\begin{lemma}
\label{lemma-rig-closed-jacobson}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{Noeth}$
which is adic and topologically of finite type.
Let $\mathfrak q \subset B$ be rig-closed.
If $A/I$ is Jacobson for some ideal of definition $I \subset A$, then
$\mathfrak p = \varphi^{-1}(\mathfrak q) \subset A$
is rig-closed.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-rig-closed-point-relative-residue-field}
(combined with Lemma \ref{lemma-finite-type-finite-type-red})
the residue field $\kappa$ of $B/\mathfrak q$ is of finite type over
$A/\mathfrak a$. Since $A/\mathfrak a$ is Jacobson, we
see that $\kappa$ is finite over $A/\mathfrak a$ by
Algebra, Lemma \ref{algebra-lemma-silly-jacobson}.
We conclude by Lemma \ref{lemma-rig-closed-point-relative}.
\end{proof}

\begin{lemma}
\label{lemma-rig-closed-point-in-image}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{Noeth}$
which is adic and topologically of finite type.
Let $\mathfrak p \subset A$ be rig-closed.
Let $\mathfrak a \subset A$ and $\mathfrak b \subset B$
be the ideals of topologically nilpotent elements. If $\varphi$
is flat, then the following are equivalent
\begin{enumerate}
\item the maximal ideal of $A/\mathfrak p$ is in the image of
$\Spec(B/\mathfrak b) \to \Spec(A/\mathfrak a)$,
\item there exists a rig-closed prime ideal $\mathfrak q \subset B$
such that $\mathfrak p = \varphi^{-1}(\mathfrak q)$.
\end{enumerate}
and if so then $\varphi$, $\mathfrak p$, and $\mathfrak q$
satisfy the conclusions of Lemma \ref{lemma-rig-closed-point-relative}.
\end{lemma}

\begin{proof}
The implication (2) $\Rightarrow$ (1) is immediate. Assume (1).
To prove the existence of $\mathfrak q$
we may replace $A$ by $A/\mathfrak p$ and $B$ by $B/\mathfrak p B$
(some details omitted). Thus we may assume $(A, \mathfrak m, \kappa)$
is a local complete $1$-dimensional Noetherian ring,
$\mathfrak m = \mathfrak a$, and $\mathfrak p = (0)$. Condition (1)
just says that $B_0 = B \otimes_A \kappa = B/\mathfrak m B = B/\mathfrak a B$
is nonzero. Note that $B_0$ is of finite type over $\kappa$.
Hence we can use induction on $\dim(B_0)$.
If $\dim(B_0) = 0$, then any minimal prime $\mathfrak q \subset B$
will do (flatness of $A \to B$ insures that $\mathfrak q$ will
lie over $\mathfrak p = (0)$).
If $\dim(B_0) > 0$ then we can find an element $b \in B$
which maps to an element $b_0 \in B_0$ which is a nonzerodivisor
and a nonunit, see Algebra, Lemma
\ref{algebra-lemma-dim-not-zero-exists-nonzerodivisor-nonunit}.
By Algebra, Lemma \ref{algebra-lemma-grothendieck}
the ring $B' = B/bB$ is flat over $A$. Since
$B'_0 = B' \otimes_A \kappa = B_0/(b_0)$ is not zero,
we may apply the induction hypothesis to $B'$ and conclude.
The final statement of the lemma is clear from
Lemma \ref{lemma-rig-closed-point-relative}.
\end{proof}

\noindent
We introduce some notation.

\begin{definition}
\label{definition-completed-principal-localization}
Let $A$ be an adic topological ring which has a finitely generated ideal
of definition. Let $f \in A$. The {\it completed principal localization}
$A_{\{f\}}$ of $A$ is the completion of $A_f = A[1/f]$
of the principal localization of $A$ at $f$ with respect to any
ideal of definition of $A$.
\end{definition}

\noindent
To be sure, if $f$ is topologically nilpotent, then $A_{\{f\}}$
is the zero ring.

\begin{lemma}
\label{lemma-rig-closed-point-in-localization}
Let $A$ be an adic Noetherian topological ring.
Let $\mathfrak p \subset A$ be a prime ideal.
Let $f \in A$ be an element mapping to a unit in $A/\mathfrak p$.
Then
$$
\mathfrak p A_{\{f\}} =
\mathfrak p(A_f)^\wedge =
\mathfrak p \otimes_A (A_f)^\wedge =
(\mathfrak p_f)^\wedge
$$
is a prime ideal with quotient
$$
A/\mathfrak p = (A/\mathfrak p) \otimes_A (A_f)^\wedge =
(A_f)^\wedge / \mathfrak p (A_f)^\wedge = A_{\{f\}}/\mathfrak p A_{\{f\}}
$$
\end{lemma}

\begin{proof}
Since $A_f$ is Noetherian the ring map $A \to A_f \to (A_f)^\wedge$
is flat. For any finite $A$-module $M$ we see that
$M \otimes_A (A_f)^\wedge$ is the completion of $M_f$.
If $f$ is a unit on $M$, then $M_f = M$ is already complete.
See discussion in Algebra, Section \ref{algebra-section-completion-noetherian}.
From these observations the results follow easily.
\end{proof}

\begin{lemma}
\label{lemma-rig-closed-point-after-localization}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{Noeth}$
which is adic and topologically of finite type.
Let $\mathfrak q \subset B$ be rig-closed.
There exists an $f \in A$ which maps to a unit in
$B/\mathfrak q$ such that we obtain a diagram
$$
\vcenter{
\xymatrix{
B \ar[r] &
B_{\{f\}} \\
A \ar[r] \ar[u]_\varphi &
A_{\{f\}} \ar[u]_{\varphi_{\{f\}}}
}
}
\quad\text{with primes}\quad
\vcenter{
\xymatrix{
\mathfrak q \ar@{-}[r] \ar@{-}[d] &
\mathfrak q' \ar@{-}[d] \ar@{=}[r] &
\mathfrak q B_{\{f\}} \\
\mathfrak p \ar@{-}[r] &
\mathfrak p'
}
}
$$
such that $\mathfrak p'$ is rig-closed, i.e.,
the map $A_{\{f\}} \to B_{\{f\}}$ and the prime ideals
$\mathfrak q'$ and $\mathfrak p'$ satisfy
the equivalent conditions of Lemma \ref{lemma-rig-closed-point-relative}.
\end{lemma}

\begin{proof}
Please see Lemma \ref{lemma-rig-closed-point-in-localization}
for the description of $\mathfrak q'$. The only assertion the lemma makes
is that for a suitable choice of $f$ the prime ideal $\mathfrak p'$
has the property $\dim((A_f)^\wedge/\mathfrak p') = 1$.
By Lemma \ref{lemma-rig-closed-point-relative} this in turn
just means that the residue field $\kappa$ of
$B/\mathfrak q = (B_f)^\wedge/\mathfrak q'$ is finite over
$(A_f)^\wedge/\mathfrak a' = (A/\mathfrak a)_f$.
By Lemma \ref{lemma-rig-closed-point-relative-residue-field}
we know that $A/\mathfrak a \to \kappa$ is a finite type
algebra homomorphism. By the Hilbert Nullstellensatz in
the form of Algebra, Lemma \ref{algebra-lemma-field-finite-type-over-domain}
we can find an $f \in A$ which maps to a unit in $\kappa$
such that $\kappa$ is finite over $A_f$. This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-rig-closed-point-variables}
Let $A$ be a Noetherian adic topological ring. Denote $A\{x_1, \ldots, x_n\}$
the restricted power series over $A$. Let
$\mathfrak q \subset A\{x_1, \ldots, x_n\}$ be a prime ideal.
Set $\mathfrak q' = A[x_1, \ldots, x_n] \cap \mathfrak q$ and
$\mathfrak p = A \cap \mathfrak q$. If $\mathfrak q$ and $\mathfrak p$
are rig-closed, then the map
$$
A[x_1, \ldots, x_n]_{\mathfrak q'}
\to
A\{x_1, \ldots, x_n\}_\mathfrak q
$$
defines an isomorphism on completions with respect to their maximal ideals.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-rig-closed-point-relative} the ring map
$A/\mathfrak p \to A\{x_1, \ldots, x_n\}/\mathfrak q$ is finite.
For every $m \geq 1$ the module $\mathfrak q^m/\mathfrak q^{m + 1}$
is finite over $A$ as it is a finite
$A\{x_1, \ldots, x_n\}/\mathfrak q$-module.
Hence $A\{x_1, \ldots x_n\}/\mathfrak q^m$ is a finite $A$-module.
Hence $A[x_1, \ldots, x_n] \to A\{x_1, \ldots, x_n\}/\mathfrak q^m$
is surjective (as the image is dense and an $A$-submodule).
It follows in a straightforward manner that
$A[x_1, \ldots, x_n]/(\mathfrak q')^m \to A\{x_1, \ldots, x_n\}/\mathfrak q^m$
is an isomorphism for all $m$. From this the lemma easily follows.
Hint: Pick a topologically nilpotent $g \in A$ which is not contained
in $\mathfrak p$. Then the map of completions is the map
$$
\lim_m \left(A[x_1, \ldots, x_n]/(\mathfrak q')^m\right)_g
\longrightarrow
\left(A\{x_1, \ldots, x_n\}/\mathfrak q^m\right)_g
$$
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-rig-closed-point-etale}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{Noeth}$.
Assume $\varphi$ is adic, topologically of finite type, flat,
and $A/I \to B/IB$ is \'etale for some (resp.\ any)
ideal of definition $I \subset A$. Let $\mathfrak q \subset B$
be rig-closed such that $\mathfrak p = A \cap \mathfrak q$
is rig-closed as well. Then
$\mathfrak p B_\mathfrak q = \mathfrak q B_\mathfrak q$.
\end{lemma}

\begin{proof}
Let $\kappa$ be the residue field of the $1$-dimensional complete
local ring $A/\mathfrak p$. Since $A/I \to B/IB$ is \'etale, we see that
$B \otimes_A \kappa$ is a finite product of finite separable
extensions of $\kappa$, see
Algebra, Lemma \ref{algebra-lemma-etale-over-field}.
One of these is the residue field of $B/\mathfrak q$.
By Algebra, Lemma \ref{algebra-lemma-finite-over-complete-ring} we see that
$B/\mathfrak p B$ is a finite $A/\mathfrak p$-algebra.
It is also flat. Combining the above
we see that $A/\mathfrak p  \to B /\mathfrak p B$
is finite \'etale, see
Algebra, Lemma \ref{algebra-lemma-characterize-etale}.
Hence $B/\mathfrak p B$ is reduced, which implies the statement of
the lemma (details omitted).
\end{proof}

\begin{lemma}
\label{lemma-fibre-regular}
Let $A$ be an adic Noetherian topological ring.
Let $\mathfrak p \subset A$ be a rig-closed prime.
For any $n \geq 1$ the ring map
$$
A/\mathfrak p
\longrightarrow
A\{x_1, \ldots, x_n\} \otimes_A A/\mathfrak p =
A/\mathfrak p\{x_1, \ldots, x_n\}
$$
is regular. In particular, the algebra
$A\{x_1, \ldots, x_n\} \otimes_A \kappa(\mathfrak p)$
is geometrically regular over $\kappa(\mathfrak p)$.
\end{lemma}

\begin{proof}
We will use some fact on regular ring maps the reader can find
in More on Algebra, Section \ref{more-algebra-section-regular}.
Since $A/\mathfrak p$ is a complete local Noetherian ring it
is excellent (More on Algebra, Proposition
\ref{more-algebra-proposition-ubiquity-excellent}).
Hence $A/\mathfrak p[x_1, \ldots, x_n]$ is excellent
(by the same reference). Hence
$A/\mathfrak p[x_1, \ldots, x_n] \to A/\mathfrak p\{x_1, \ldots, x_n\}$
is a regular ring homomorphism by
More on Algebra, Lemma
\ref{more-algebra-lemma-map-G-ring-to-completion-regular}.
Of course $A/\mathfrak p \to A/\mathfrak p[x_1, \ldots, x_n]$
is smooth and hence regular. Since the composition of regular
ring maps is regular the proof is complete.
\end{proof}







\section{Rig-flat homomorphisms}
\label{section-rig-flat-homomorphisms}

\noindent
In this section we define rig-flat homomorphisms of adic Noetherian
topological rings.

\begin{lemma}
\label{lemma-naively-rig-flat-continuous}
Let $\varphi : A \to B$ be a morphism in $\textit{WAdm}^{adic*}$
(Formal Spaces, Section \ref{formal-spaces-section-morphisms-rings}).
Assume $\varphi$ is adic. The following are equivalent:
\begin{enumerate}
\item $B_f$ is flat over $A$ for all
topologically nilpotent $f \in A$,
\item $B_g$ is flat over $A$ for all
topologically nilpotent $g \in B$,
\item $B_\mathfrak q$ is flat over $A$
for all primes $\mathfrak q \subset B$ which do not contain
an ideal of definition,
\item $B_\mathfrak q$ is flat over $A$ for every rig-closed
prime $\mathfrak q \subset B$, and
\item add more here.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows from the definitions and
Algebra, Lemma \ref{algebra-lemma-flat-localization}.
\end{proof}

\begin{definition}
\label{definition-naively-rig-flat}
Let $\varphi : A \to B$ be a continuous ring homomorphism
between adic Noetherian topological rings, i.e., $\varphi$
is an arrow of $\textit{WAdm}^{Noeth}$. We say $\varphi$ is
{\it naively rig-flat} if $\varphi$ is adic, topologically
of finite type, and satisfies the equivalent conditions of
Lemma \ref{lemma-naively-rig-flat-continuous}.
\end{definition}

\noindent
The example below shows that this notion does not ``localize''.

\begin{example}
\label{example-recompletion-not-rig-flat}
By Examples, Lemma \ref{examples-lemma-nonreduced-recompletion}
there exists a local Noetherian $2$-dimensional domain $(A, \mathfrak m)$
complete with respect to a principal ideal $I = (a)$ and an
element $f \in \mathfrak m$, $f \not \in I$ with the following
property: the ring $A_{\{f\}}[1/a]$ is nonreduced.
Here $A_{\{f\}}$ is the $I$-adic completion $(A_f)^\wedge$ of the principal
localization $A_f$. To be sure the ring $A_{\{f\}}[1/a]$ is nonzero.
Let $B = A_{\{f\}}/ \text{nil}(A_{\{f\}})$ be the quotient
by its nilradical. Observe that $A \to B$ is adic and
topologically of finite type.
In fact, $B$ is a quotient of $A\{x\} = A[x]^\wedge$ by the
map sending $x$ to the image of $1/f$ in $B$.
Every prime $\mathfrak q$ of $B$ not containing $a$ must
lie over $(0) \subset A$\footnote{Namely, we can find
$\mathfrak q \subset \mathfrak q' \subset B$ with $a \in \mathfrak q'$
because $B$ is $a$-adically complete. Then $\mathfrak p' = A \cap \mathfrak q'$
contains $a$ but not $f$ hence is a height $1$ prime. Then
$\mathfrak p = A \cap \mathfrak q$ must be strictly
contained in $\mathfrak p'$ as $a \not \in \mathfrak p$. Since
$\dim(A) = 2$ we see that $\mathfrak p = (0)$.}. Hence $B_\mathfrak q$
is flat over $A$ as it is a module over the
fraction field of $A$. Thus $A \to B$ is naively rig-flat.
On the other hand, the map
$$
A_{\{f\}}
\longrightarrow
B_{\{f\}} = (B_f)^\wedge = B = A_{\{f\}} /\text{nil}(A_{\{f\}})
$$
is not flat after inverting $a$ because we get the nontrivial surjection
$A_{\{f\}}[1/a] \to A_{\{f\}}[1/a]/\text{nil}(A_{\{f\}}[1/a])$.
Hence $A_{\{f\}} \to B_{\{f\}}^\wedge$ is not naively rig-flat!
\end{example}

\noindent
It turns out that it is easy to work around this problem by
using the following definition.

\begin{definition}
\label{definition-rig-flat-continuous-homomorphism}
Let $\varphi : A \to B$ be a continuous ring homomorphism between
adic Noetherian topological rings, i.e., $\varphi$ is an arrow of
$\textit{WAdm}^{Noeth}$. We say $\varphi$ is {\it rig-flat} if $\varphi$
is adic, topologically of finite type, and for all $f \in A$ the induced map
$$
A_{\{f\}} \longrightarrow B_{\{f\}}
$$
is naively rig-flat (Definition \ref{definition-naively-rig-flat}).
\end{definition}

\noindent
Setting $f = 1$ in the definition above we see that rig-flatness
implies naive rig-flatness. The example shows the converse is false.
However, in many situations we don't need to worry about the difference
between rig-flatness and its naive version as the next lemma shows.

\begin{lemma}
\label{lemma-rig-flat-naive}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{Noeth}$.
If $A/I$ is Jacobson for some (equivalently any) ideal of definition
$I \subset A$ and $\varphi$ is naively rig-flat, then $\varphi$ is
rig-flat.
\end{lemma}

\begin{proof}
Assume $\varphi$ is naively rig-flat. We first state some obvious
consequences of the assumptions. Namely, let $f \in A$.
Then $A, B, A_{\{f\}}, B_{\{f\}}$
are Noetherian adic topological rings. The maps
$A \to A_{\{f\}} \to B_{\{f\}}$ and $A \to B \to B_{\{f\}}$
are adic and topologically of finite type.
The ring maps $A \to A_{\{f\}}$ and $B \to B_{\{f\}}$
are flat as compositions of $A \to A_f$ and $B \to B_f$
and the completion maps which are flat by
Algebra, Lemma \ref{algebra-lemma-completion-flat}.
The quotients of each of the rings
$A, B, A_{\{f\}}, B_{\{f\}}$ by $I$ is of finite type
over $A/I$ and hence Jacobson too
(Algebra, Proposition \ref{algebra-proposition-Jacobson-permanence}).

\medskip\noindent
Let $\mathfrak q' \subset B_{\{f\}}$ be rig-closed.
It suffices to prove that $(B_{\{f\}})_{\mathfrak q'}$
is flat over $A_{\{f\}}$, see Lemma \ref{lemma-naively-rig-flat-continuous}.
By Lemma \ref{lemma-rig-closed-jacobson} the primes
$\mathfrak q \subset B$ and $\mathfrak p' \subset A_{\{f\}}$
and $\mathfrak p \subset A$ lying under $\mathfrak q'$ are rig-closed.
We are going to apply
Algebra, Lemma \ref{algebra-lemma-yet-another-variant-local-criterion-flatness}
to the diagram
$$
\xymatrix{
B_\mathfrak q \ar[r] &
(B_{\{f\}})_{\mathfrak q'} \\
A_\mathfrak p \ar[u] \ar[r] &
(A_{\{f\}})_{\mathfrak p'} \ar[u]
}
$$
with $M = B_\mathfrak q$.
The only assumption that hasn't been checked yet is the fact
that $\mathfrak p$ generates the maximal ideal of
$(A_{\{f\}})_{\mathfrak p'}$. This follows from
Lemma \ref{lemma-rig-closed-point-in-localization};
here we use that $\mathfrak p$ and $\mathfrak p'$ are rig-closed
to see that $f$ maps to a unit of $A/\mathfrak p$
(this is the only step in the proof that fails without
the Jacobson assumption). Namely,
this tells us that $A/\mathfrak p \to A_{\{f\}}/\mathfrak p'$
is a finite inclusion of local rings
(Lemma \ref{lemma-rig-closed-point-relative})
and $f$ maps to a unit in the second one.
\end{proof}

\begin{lemma}
\label{lemma-rig-flat-base-change}
Let $\varphi : A \to B$ and $A \to C$ be arrows of $\textit{WAdm}^{Noeth}$.
Assume $\varphi$ is rig-flat and $A \to C$ adic and topologically
of finite type. Then $C \to B \widehat{\otimes}_A C$ is rig-flat.
\end{lemma}

\begin{proof}
Assume $\varphi$ is rig-flat. Let $f \in C$ be an element.
We have to show that
$C_{\{f\}} \to B \widehat{\otimes}_A C_{\{f\}}$
is naively rig-flat. Since we can replace $C$ by $C_{\{f\}}$
we it suffices to show that $C \to B \widehat{\otimes}_A C$
is naively rig-flat.

\medskip\noindent
If $A \to C$ is surjective or more generally if $C$ is finite as
an $A$-module, then $B \otimes_A C = B \widehat{\otimes}_A C$
as a finite module over a complete Noetherian ring is complete, see
Algebra, Lemma \ref{algebra-lemma-completion-tensor}.
By the usual base change for flatness
(Algebra, Lemma \ref{algebra-lemma-flat-base-change})
we see that naive rig-flatness of $\varphi$ implies naive rig-flatness
for $C \to B \times_A C$ in this case.

\medskip\noindent
In the general case, we can factor $A \to C$ as
$A \to A\{x_1, \ldots, x_n\} \to C$
where $A\{x_1, \ldots, x_n\}$ is the restricted power series ring
and $A\{x_1, \ldots, x_n\} \to C$ is surjective. Thus it
suffices to show $C \to B \widehat{\otimes}_A B$ is naively
rig-flat in case $C = A\{x_1, \ldots, x_n\}$.
Since $A\{x_1, \ldots, x_n\} = A\{x_1, \ldots, x_{n - 1}\}\{x_n\}$
by induction on $n$ we reduce to the case discussed in the next
paragraph.

\medskip\noindent
Here $C = A\{x\}$. Note that $B \widehat{\otimes}_A C = B\{x\}$.
We have to show that $A\{x\} \to B\{x\}$ is naively rig-flat.
Let $\mathfrak q \subset B\{x\}$ be a rig-closed prime ideal.
We have to show that $B\{x\}_{\mathfrak q}$ is flat over $A\{x\}$.
Set $\mathfrak p = A \cap \mathfrak q$.
By Lemma \ref{lemma-rig-closed-point-after-localization}
we can find an $f \in A$ such that
$f$ maps to a unit in $B\{x\}/\mathfrak q$ and such
that the prime ideal $\mathfrak p'$ in $A_{\{f\}}$ induced is rig-closed.
Below we will use that $A_{\{f\}}\{x\} = A\{x\}_{\{f\}}$ and similarly
for $B$; details omitted. Consider the diagram
$$
\xymatrix{
(B\{x\})_{\mathfrak q} \ar[r] &
(B_{\{f\}}\{x\})_{\mathfrak q'} \\
A\{x\} \ar[r] \ar[u] &
A_{\{f\}}\{x\} \ar[u]
}
$$
We want to show that the left vertical arrow is flat.
The top horizontal arrow is faithfully flat as it is a local
homomorphism of local rings and flat as $B_{\{f\}}\{x\}$
is the completion of a localization of the Noetherian ring
$B\{x\}$. Similarly the bottom horizontal arrow is flat.
Hence it suffices to prove that the right vertical arrow is flat.
This reduces us to the case discussed in the next paragraph.

\medskip\noindent
Here $C = A\{x\}$, we have a rig-closed prime ideal
$\mathfrak q \subset B\{x\}$ such that
$\mathfrak p = A \cap \mathfrak q$ is rig-closed as well.
This implies, via Lemma \ref{lemma-rig-closed-point-relative},
that the intermediate primes $B \cap \mathfrak q$ and
$A\{x\} \cap \mathfrak q$ are rig-closed as well.
Consider the diagram
$$
\xymatrix{
(B[x])_{B[x] \cap \mathfrak q} \ar[r] &
(B\{x\})_{\mathfrak q} \\
(A[x])_{A[x] \cap \mathfrak q} \ar[r] \ar[u] &
(A\{x\})_{A\{x\} \cap \mathfrak q} \ar[u]
}
$$
of local homomorphisms of Noetherian local rings.
By Lemma \ref{lemma-rig-closed-point-variables}
the horizontal arrows define isomorphisms
on completions. We already know that the left
vertical arrow is flat (as $A \to B$ is naively rig-flat
and hence $A[x] \to B[x]$ is flat away from the
closed locus defined by an ideal of definition).
Hence we finally conclude by
More on Algebra, Lemma \ref{more-algebra-lemma-flat-completion}.
\end{proof}

\begin{lemma}
\label{lemma-rig-flat-local-etale}
Consider a commutative diagram
$$
\xymatrix{
B \ar[r] & B' \\
A \ar[r] \ar[u]^\varphi & A' \ar[u]_{\varphi'}
}
$$
in $\textit{WAdm}^{Noeth}$ with all arrows adic and topologically
of finite type. Assume $A \to A'$ and $B \to B'$ are flat.
Let $I \subset A$ be an ideal of definition.
If $\varphi$ is rig-flat and $A/I \to A'/IA'$
is \'etale, then $\varphi'$ is rig-flat.
\end{lemma}

\begin{proof}
Given $f \in A'$ the assumptions of the lemma remain true for the digram
$$
\xymatrix{
B \ar[r] & (B')_{\{f\}} \\
A \ar[r] \ar[u]^\varphi & (A')_{\{f\}} \ar[u]
}
$$
Hence it suffices to prove that $\varphi'$ is naively rig-flat.

\medskip\noindent
Take a rig-closed prime ideal $\mathfrak q' \subset B'$.
We have to show that $(B')_{\mathfrak q'}$ is flat over $A'$.
We can choose an $f \in A$ which maps to a unit of $B'/\mathfrak q'$
such that the induced prime ideal $\mathfrak p''$ of $A_{\{f\}}$ 
is rig-closed, see Lemma \ref{lemma-rig-closed-point-after-localization}.
To be precise, here $\mathfrak q'' = \mathfrak q' B'_{\{f\}}$ and
$\mathfrak p'' = A_{\{f\}} \cap \mathfrak q''$.
Consider the diagram
$$
\xymatrix{
B'_{\mathfrak q'} \ar[r] &
(B'_{\{f\}})_{\mathfrak q''} \\
A \ar[r] \ar[u] &
A_{\{f\}} \ar[u]
}
$$
We want to show that the left vertical arrow is flat.
The top horizontal arrow is faithfully flat as it is a local
homomorphism of local rings and flat as $B'_{\{f\}}$
is the completion of a localization of the Noetherian ring
$B'_f$. Similarly the bottom horizontal arrow is flat.
Hence it suffices to prove that the right vertical arrow is flat.
Finally, all the assumptions of the lemma remain true for the diagram
$$
\xymatrix{
B_{\{f\}} \ar[r] &
B'_{\{f\}} \\
A_{\{f\}} \ar[r] \ar[u] &
A'_{\{f\}} \ar[u]
}
$$
This reduces us to the case discussed in the next paragraph.

\medskip\noindent
Take a rig-closed prime ideal $\mathfrak q' \subset B'$
and assume $\mathfrak p = A \cap \mathfrak q'$ is rig-closed as well.
This implies also the primes $\mathfrak q = B \cap \mathfrak q'$
and $\mathfrak p' = A' \cap \mathfrak q'$ are rig-closed, see
Lemma \ref{lemma-rig-closed-point-relative}.
We are going to apply
Algebra, Lemma \ref{algebra-lemma-yet-another-variant-local-criterion-flatness}
to the diagram
$$
\xymatrix{
B_\mathfrak q \ar[r] &
B'_{\mathfrak q'} \\
A_\mathfrak p \ar[u] \ar[r] &
A'_{\mathfrak p'} \ar[u]
}
$$
with $M = B_\mathfrak q$. The only assumption that hasn't been checked yet
is the fact that $\mathfrak p$ generates the maximal ideal of
$A'_{\mathfrak p'}$. This follows from
Lemma \ref{lemma-rig-closed-point-etale}.
\end{proof}

\begin{lemma}
\label{lemma-rig-flat-local-down}
Consider a commutative diagram
$$
\xymatrix{
B \ar[r] & B' \\
A \ar[r] \ar[u]^\varphi & A' \ar[u]_{\varphi'}
}
$$
in $\textit{WAdm}^{Noeth}$ with all arrows adic and topologically
of finite type. Assume $A \to A'$ flat and $B \to B'$ faithfully flat.
If $\varphi'$ is rig-flat, then $\varphi$ is rig-flat.
\end{lemma}

\begin{proof}
Given $f \in A$ the assumptions of the lemma remain true for the digram
$$
\xymatrix{
B_{\{f\}} \ar[r] & (B')_{\{f\}} \\
A_{\{f\}} \ar[r] \ar[u]^\varphi & (A')_{\{f\}} \ar[u]
}
$$
(To check the condition on faithful flatness: faithful flatness
of $B \to B'$ is equivalent to $B \to B'$ being flat and
$\Spec(B'/IB') \to \Spec(B/IB)$ being
surjective for some ideal of definition $I \subset A$.)
Hence it suffices to prove that $\varphi$ is naively rig-flat.
However, we know that $\varphi'$ is naively rig-flat and
that $\Spec(B') \to \Spec(B)$ is surjective. From this the
result follows immediately.
\end{proof}

\noindent
Finally, we can show that rig-flatness is a local property.

\begin{lemma}
\label{lemma-rig-flat-axioms}
The property $P(\varphi)=$``$\varphi$ is rig-flat'' on arrows
of $\textit{WAdm}^{Noeth}$ is a local property as defined in
Formal Spaces, Remark \ref{formal-spaces-remark-variant-adic-star}.
\end{lemma}

\begin{proof}
Let us recall what the statement signifies. First, 
$\textit{WAdm}^{Noeth}$ is the category whose objects are
adic Noetherian topological rings and whose morphisms are
continuous ring homomorphisms. Consider a commutative diagram
$$
\xymatrix{
B \ar[r] & (B')^\wedge \\
A \ar[r] \ar[u]^\varphi & (A')^\wedge \ar[u]_{\varphi'}
}
$$
satisfying the following conditions:
$A$ and $B$ are adic Noetherian topological rings,
$A \to A'$ and $B \to B'$ are \'etale ring maps,
$(A')^\wedge = \lim A'/I^nA'$ for some ideal of definition $I \subset A$,
$(B')^\wedge = \lim B'/J^nB'$ for some ideal of definition $J \subset B$, and
$\varphi : A \to B$ and $\varphi' : (A')^\wedge \to (B')^\wedge$
are continuous. Note that $(A')^\wedge$ and $(B')^\wedge$ are
adic Noetherian topological rings by
Formal Spaces, Lemma \ref{formal-spaces-lemma-completion-in-sub}.
We have to show
\begin{enumerate}
\item $\varphi$ is rig-flat $\Rightarrow \varphi'$ is rig-flat,
\item if $B \to B'$ faithfully flat, then $\varphi'$ is rig-flat
$\Rightarrow \varphi$ is rig-flat, and
\item if $A \to B_i$ is rig-flat for $i = 1, \ldots, n$, then
$A \to \prod_{i = 1, \ldots, n} B_i$ is rig-flat.
\end{enumerate}
Being adic and topologically of finite type satisfies
conditions (1), (2), and (3), see Lemma \ref{lemma-finite-type}.
Thus in verifying (1), (2), and (3) for the property
``rig-flat'' we may already assume our ring maps are all adic
and topologically of finite type. Then (1) and (2) follow
from Lemmas \ref{lemma-rig-flat-local-etale} and
\ref{lemma-rig-flat-local-down}.
We omit the trivial proof of (3).
\end{proof}

\begin{lemma}
\label{lemma-composition-rig-flat-continuous}
The property $P(\varphi)=$``$\varphi$ is rig-flat''
on arrows of $\textit{WAdm}^{Noeth}$ is stable under composition
as defined in Formal Spaces, Remark
\ref{formal-spaces-remark-composition-variant-Noetherian}.
\end{lemma}

\begin{proof}
The statement makes sense by Lemma \ref{lemma-rig-flat-axioms}.
To see that it is true assume we have rig-flat morphisms
$A \to B$ and $B \to C$ in $\textit{WAdm}^{Noeth}$.
Then $A \to C$ is adic and topologically of finite type
by Lemma \ref{lemma-composition-finite-type}.
To finish the proof we have to show that for all $f \in A$ the map
$A_{\{f\}} \to C_{\{f\}}$ is naively rig-flat.
Since $A_{\{f\}} \to B_{\{f\}}$ and $B_{\{f\}} \to C_{\{f\}}$
are naively rig-flat, it suffices to show that
compositions of naively rig-flat maps are naively rig-flat.
This is a consequence of Algebra, Lemma \ref{algebra-lemma-composition-flat}.
\end{proof}











\section{Rig-flat morphisms}
\label{section-rig-flat-morphisms}

\noindent
In this section we use the work done in
Section \ref{section-rig-flat-homomorphisms}
to define rig-flat morphisms of locally Noetherian algebraic spaces.

\begin{definition}
\label{definition-rig-flat}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of locally
Noetherian formal algebraic spaces over $S$. We say $f$ is
{\it rig-flat} if for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to a rig-flat map of adic Noetherian topological rings.
\end{definition}

\noindent
Let us prove that we can check this condition \'etale locally on
source and target.

\begin{lemma}
\label{lemma-rig-flat-morphisms}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of
locally Noetherian formal algebraic spaces over $S$.
The following are equivalent
\begin{enumerate}
\item $f$ is rig-flat,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to a rig-flat map in $\textit{WAdm}^{Noeth}$,
\item there exists a covering $\{Y_j \to Y\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $j$
a covering $\{X_{ji} \to Y_j \times_Y X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
such that each $X_{ji} \to Y_j$  corresponds
to a rig-flat map in $\textit{WAdm}^{Noeth}$, and
\item there exist a covering $\{X_i \to X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $i$ a factorization $X_i \to Y_i \to Y$ where $Y_i$
is an affine formal algebraic space, $Y_i \to Y$ is representable
by algebraic spaces and \'etale, and $X_i \to Y_i$ corresponds
to a rig-flat map in $\textit{WAdm}^{Noeth}$.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) is Definition \ref{definition-rig-flat}.
The equivalence of (2), (3), and (4) follows from the fact that
being rig-flat is a local property of arrows of
$\text{WAdm}^{Noeth}$ by Lemma \ref{lemma-rig-flat-axioms}
and an application of the variant of
Formal Spaces, Lemma
\ref{formal-spaces-lemma-property-defines-property-morphisms}
for morphisms between locally Noetherian algebraic spaces
mentioned in
Formal Spaces, Remark
\ref{formal-spaces-remark-variant-Noetherian}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-flat}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Z \to Y$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
If $f$ is rig-flat and $g$ is locally of finite type, then the base change
$X \times_Y Z \to Z$ is rig-flat.
\end{lemma}

\begin{proof}
By Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-variant-Noetherian}
and the discussion in Formal Spaces, Section
\ref{formal-spaces-section-adic},
this follows from
Lemma \ref{lemma-rig-flat-base-change}.
\end{proof}

\begin{lemma}
\label{lemma-composition-rig-flat}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
If $f$ and $g$ are rig-flat, then so is $g \circ f$.
\end{lemma}

\begin{proof}
By Formal Spaces, Remark
\ref{formal-spaces-remark-composition-variant-Noetherian}
this follows from Lemma \ref{lemma-composition-rig-flat-continuous}.
\end{proof}










\section{Rig-smooth homomorphisms}
\label{section-rig-smooth-homomorphisms}

\noindent
In this section we prove some properties of
rig-smooth homomorphisms of adic Noetherian
topological rings which are needed to introduce
rig-smooth morpisms of locally Noetherian
formal algebraic spaces.

\begin{lemma}
\label{lemma-rig-smooth-continuous}
Let $A \to B$ be a morphism in $\textit{WAdm}^{Noeth}$
(Formal Spaces, Section \ref{formal-spaces-section-morphisms-rings}).
The following are equivalent:
\begin{enumerate}
\item[(a)] $A \to B$ satisfies the equivalent conditions of
Lemma \ref{lemma-finite-type} and there exists an ideal of definition
$I \subset B$ such that $B$ is rig-smooth over $(A, I)$, and
\item[(b)] $A \to B$ satisfies the equivalent conditions of
Lemma \ref{lemma-finite-type} and for all ideals of definition
$I \subset A$ the algebra $B$ is rig-smooth over $(A, I)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $I$ and $I'$ be ideals of definitions of $A$. Then there exists an
integer $c \geq 0$ such that $I^c \subset I'$ and $(I')^c \subset I$. Hence
$B$ is rig-smooth over $(A, I)$ if and only if
$B$ is rig-smooth over $(A, I')$. This follows from
Definition \ref{definition-rig-smooth-homomorphism},
the inclusions $I^c \subset I'$ and $(I')^c \subset I$, and
the fact that the naive cotangent complex $\NL_{B/A}^\wedge$
is independent of the choice of ideal of definition of $A$ by
Remark \ref{remark-NL-well-defined-topological}.
\end{proof}

\begin{definition}
\label{definition-rig-smooth-continuous-homomorphism}
Let $\varphi : A \to B$ be a continuous ring homomorphism
between adic Noetherian topological rings, i.e., $\varphi$
is an arrow of $\textit{WAdm}^{Noeth}$. We say
$\varphi$ is {\it rig-smooth} if the equivalent conditions
of Lemma \ref{lemma-rig-smooth-continuous} hold.
\end{definition}

\noindent
This defines a local property.

\begin{lemma}
\label{lemma-rig-smooth-axioms}
The property $P(\varphi)=$``$\varphi$ is rig-smooth'' on arrows
of $\textit{WAdm}^{Noeth}$ is a local property as defined in
Formal Spaces, Remark \ref{formal-spaces-remark-variant-Noetherian}.
\end{lemma}

\begin{proof}
Let us recall what the statement signifies. First, 
$\textit{WAdm}^{Noeth}$ is the category whose objects are
adic Noetherian topological rings and whose morphisms are
continuous ring homomorphisms. Consider a commutative diagram
$$
\xymatrix{
B \ar[r] & (B')^\wedge \\
A \ar[r] \ar[u]^\varphi & (A')^\wedge \ar[u]_{\varphi'}
}
$$
satisfying the following conditions:
$A$ and $B$ are adic Noetherian topological rings,
$A \to A'$ and $B \to B'$ are \'etale ring maps,
$(A')^\wedge = \lim A'/I^nA'$ for some ideal of definition $I \subset A$,
$(B')^\wedge = \lim B'/J^nB'$ for some ideal of definition $J \subset B$, and
$\varphi : A \to B$ and $\varphi' : (A')^\wedge \to (B')^\wedge$
are continuous. Note that $(A')^\wedge$ and $(B')^\wedge$ are
adic Noetherian topological rings by
Formal Spaces, Lemma \ref{formal-spaces-lemma-completion-in-sub}.
We have to show
\begin{enumerate}
\item $\varphi$ is rig-smooth $\Rightarrow \varphi'$ is rig-smooth,
\item if $B \to B'$ faithfully flat, then $\varphi'$ is rig-smooth
$\Rightarrow \varphi$ is rig-smooth, and
\item if $A \to B_i$ is rig-smooth for $i = 1, \ldots, n$, then
$A \to \prod_{i = 1, \ldots, n} B_i$ is rig-smooth.
\end{enumerate}
The equivalent conditions of Lemma \ref{lemma-finite-type} satisfy
conditions (1), (2), and (3).
Thus in verifying (1), (2), and (3) for the property
``rig-smooth'' we may already assume our ring maps satisfy
the equivalent conditions of Lemma \ref{lemma-finite-type}
in each case.

\medskip\noindent
Pick an ideal of definition $I \subset A$. By the remarks above
the topology on each ring in the diagram is the $I$-adic topology
and $B$, $(A')^\wedge$, and $(B')^\wedge$ are in the category
(\ref{equation-C-prime}) for $(A, I)$.
Since $A \to A'$ and $B \to B'$ are \'etale the complexes
$\NL_{A'/A}$ and $\NL_{B'/B}$ are zero and hence
$\NL_{(A')^\wedge/A}^\wedge$ and $\NL_{(B')^\wedge/B}^\wedge$
are zero by Lemma \ref{lemma-NL-is-completion}.
Applying Lemma \ref{lemma-exact-sequence-NL} to
$A \to (A')^\wedge \to (B')^\wedge$ we get isomorphisms
$$
H^i(\NL_{(B')^\wedge/(A')^\wedge}^\wedge) \to H^i(\NL_{(B')^\wedge/A}^\wedge)
$$
Thus $\NL_{(B')^\wedge/A}^\wedge \to \NL_{(B')^\wedge/(A')^\wedge}$
is a quasi-isomorphism. The ring maps $B/I^nB \to B'/I^nB'$ are \'etale
and hence are local complete intersections
(Algebra, Lemma \ref{algebra-lemma-etale-standard-smooth}).
Hence we may apply
Lemmas \ref{lemma-exact-sequence-NL} and
\ref{lemma-transitive-lci-at-end} to
$A \to B \to (B')^\wedge$ and we get isomorphisms
$$
H^i(\NL_{B/A}^\wedge \otimes_B (B')^\wedge) \to
H^i(\NL_{(B')^\wedge/A}^\wedge)
$$
We conclude that
$\NL_{B/A}^\wedge \otimes_B (B')^\wedge \to \NL_{(B')^\wedge/A}^\wedge$
is a quasi-isomorphism. Combining these two observations we obtain that
$$
\NL_{(B')^\wedge/(A')^\wedge}^\wedge \cong
\NL_{B/A}^\wedge \otimes_B (B')^\wedge
$$
in $D((B')^\wedge)$.
With these preparations out of the way we can start the actual proof.

\medskip\noindent
Proof of (1). Assume $\varphi$ is rig-smooth. Then there exists a $c \geq 0$
such that $\Ext^1_B(\NL_{B/A}^\wedge, N)$ is annihilated by $I^c$
for every $B$-module $N$. By
More on Algebra, Lemmas \ref{more-algebra-lemma-two-term-base-change} and
\ref{more-algebra-lemma-base-change-property-ext-1-annihilated}
this property is preserved under base change by $B \to (B')^\wedge$.
Hence $\Ext^1_{(B')^\wedge}(\NL_{(B')^\wedge/(A')^\wedge}^\wedge, N)$
is annihilated by $I^c(A')^\wedge$ for all $(B')^\wedge$-modules $N$
which tells us that $\varphi'$ is rig-smooth.
This proves (1).

\medskip\noindent
To prove (2) assume $B \to B'$ is faithfully flat and that $\varphi'$
is rig-smooth. Then there exists a $c \geq 0$ such that
$\Ext^1_{(B')^\wedge}(\NL_{(B')^\wedge/(A')^\wedge}^\wedge, N')$
is annihilated by $I^c(B')^\wedge$ for every $(B')^\wedge$-module $N'$.
The composition $B \to B' \to (B')^\wedge$ is flat
(Algebra, Lemma \ref{algebra-lemma-completion-flat})
hence for any $B$-module $N$ we have
$$
\Ext^1_B(\NL_{B/A}^\wedge, N) \otimes_B (B')^\wedge =
\Ext^1_{(B')^\wedge}(\NL_{B/A}^\wedge \otimes_B (B')^\wedge,
N \otimes_B (B')^\wedge)
$$
by More on Algebra, Lemma \ref{more-algebra-lemma-base-change-RHom} part (3)
(minor details omitted). Thus we see that this module is annihilated
by $I^c$. However, $B \to (B')^\wedge$ is actually faithfully flat
by our assumption that $B \to B'$ is faithfully flat (Formal Spaces, Lemma
\ref{formal-spaces-lemma-etale-surjective}). Thus we conclude that
$\Ext^1_B(\NL_{B/A}^\wedge, N)$ is annihilated by $I^c$.
Hence $\varphi$ is rig-smooth. This proves (2).

\medskip\noindent
To prove (3), setting $B = \prod_{i = 1, \ldots, n} B_i$
we just observe that $\NL_{B/A}^\wedge$ is the direct
sum of the complexes $\NL_{B_i/A}^\wedge$ viewed as complexes
of $B$-modules.
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-smooth-continuous}
Consider the properties $P(\varphi)=$``$\varphi$ is rig-smooth''
and $Q(\varphi)$=``$\varphi$ is adic'' on arrows of $\textit{WAdm}^{Noeth}$.
Then $P$ is stable under base change by $Q$ as defined in
Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-variant-Noetherian}.
\end{lemma}

\begin{proof}
The statement makes sense by Lemma \ref{lemma-rig-smooth-continuous}.
To see that it is true assume we have morphisms
$B \to A$ and $B \to C$ in $\textit{WAdm}^{Noeth}$
and that $B \to A$ is rig-smooth and $B \to C$ is adic
(Formal Spaces, Definition
\ref{formal-spaces-definition-adic-homomorphism}).
Then we can choose an ideal of definition $I \subset B$
such that the topology on $A$ and $C$ is the $I$-adic topology.
In this situation it follows immediately that
$A \widehat{\otimes}_B C$ is rig-smooth over $(C, IC)$ by
Lemma \ref{lemma-base-change-rig-smooth-homomorphism}.
\end{proof}

\begin{lemma}
\label{lemma-composition-rig-smooth-continuous}
The property $P(\varphi)=$``$\varphi$ is rig-smooth''
on arrows of $\textit{WAdm}^{Noeth}$ is stable under composition
as defined in Formal Spaces, Remark
\ref{formal-spaces-remark-composition-variant-Noetherian}.
\end{lemma}

\begin{proof}
We strongly urge the reader to find their own proof and not read the proof
that follows. The statement makes sense by
Lemma \ref{lemma-rig-smooth-continuous}.
To see that it is true assume we have rig-smooth morphisms
$A \to B$ and $B \to C$ in $\textit{WAdm}^{Noeth}$.
Then we can choose an ideal of definition $I \subset A$
such that the topology on $C$ and $B$ is the $I$-adic topology.
By Lemma \ref{lemma-exact-sequence-NL} we obtain an exact sequence
$$
\xymatrix{
C \otimes_B H^0(\NL_{B/A}^\wedge) \ar[r] &
H^0(\NL_{C/A}^\wedge) \ar[r] &
H^0(\NL_{C/B}^\wedge) \ar[r] & 0 \\
H^{-1}(\NL_{B/A}^\wedge \otimes_B C) \ar[r] &
H^{-1}(\NL_{C/A}^\wedge) \ar[r] &
H^{-1}(\NL_{C/B}^\wedge) \ar[llu]
}
$$
Observe that $H^{-1}(\NL_{B/A}^\wedge \otimes_B C)$
and $H^{-1}(\NL_{C/B}^\wedge)$ are annihilated by
a power of $I$; this follows from
Lemma \ref{lemma-equivalent-with-artin-smooth} part (2)
combined with
More on Algebra, Lemmas \ref{more-algebra-lemma-two-term-base-change} and
\ref{more-algebra-lemma-base-change-property-ext-1-annihilated}
(to deal with the base change by $B \to C$).
Hence $H^{-1}(\NL_{C/A}^\wedge)$ is annihilated by a power of $I$.
Next, by the characterization of rig-smooth algebras in
Lemma \ref{lemma-equivalent-with-artin-smooth} part (2)
which in turn refers to
More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated} part (5)
we can choose $f_1, \ldots, f_s \in IB$ and $g_1, \ldots, g_t \in IC$
such that $V(f_1, \ldots, f_s) = V(IB)$ and
$V(g_1, \ldots, g_t) = V(IC)$ and such that
$H^0(\NL_{B/A}^\wedge)_{f_i}$ is a finite projective $B_{f_i}$-module and
$H^0(\NL_{C/B}^\wedge)_{g_j}$ is a finite projective $C_{g_j}$-module.
Since the cohomologies in degree $-1$ vanish upon localization at
$f_ig_j$ we get a short exact sequence
$$
0 \to
(C \otimes_B H^0(\NL_{B/A}^\wedge))_{f_ig_j} \to
H^0(\NL_{C/A}^\wedge)_{f_ig_j} \to
H^0(\NL_{C/B}^\wedge)_{f_ig_j} \to 0
$$
and we conclude that $H^0(\NL_{C/A}^\wedge)_{f_ig_j}$ is a finite
projective $C_{f_ig_j}$-module as an extension of same.
Thus by the criterion in
Lemma \ref{lemma-equivalent-with-artin-smooth} part (2)
and via that the criterion in
More on Algebra, Lemma \ref{more-algebra-lemma-ext-1-annihilated} part (4)
we conclude that $C$ is rig-smooth over $(A, I)$.
\end{proof}

\noindent
The following lemma can be interpreted as saying that a rig-smooth
homomorphism is ``rig-syntomic'' or ``rig-flat$+$rig-lci''.

\begin{lemma}
\label{lemma-rig-smooth-rig-flat}
Let $\varphi : A \to B$ be an arrow of $\textit{WAdm}^{Noeth}$.
If $\varphi$ is rig-smooth, then $\varphi$ is rig-flat, and
for any presentation $B = A\{x_1, \ldots, x_n\}/J$
and prime $J \subset \mathfrak q \subset A\{x_1, \ldots, x_n\}$
not containing an ideal of definition the ideal
$J_\mathfrak q \subset A\{x_1, \ldots, x_n\}_\mathfrak q$
is generated by a regular sequence.
\end{lemma}

\begin{proof}
Let $f \in A$. To prove that $\varphi$ is rig-flat we have to show
that $\varphi_{\{f\}} : A_{\{f\}} \to B_{\{f\}}$ is naively rig-flat.
Now either by viewing $\varphi_{\{f\}}$ as a base change of $\varphi$
and using Lemma \ref{lemma-base-change-rig-smooth-continuous}
or by using the fact that being rig-smooth
is a local property (Lemma \ref{lemma-rig-smooth-axioms}) we see that
$\varphi_{\{f\}}$ is rig-smooth. Hence it suffices to show
that $\varphi$ is naively rig-flat.

\medskip\noindent
Choose a presentation $B = A\{x_1, \ldots, x_n\}/J$.
In order to check the second part of the lemma it suffices
to check $J_\mathfrak q \subset A\{x_1, \ldots, x_n\}_\mathfrak q$
is generated by a regular sequence for $J \subset \mathfrak q$
for $\mathfrak q$ maximal with respect to not containing
an ideal of definition, see
Algebra, Lemma \ref{algebra-lemma-regular-sequence-in-neighbourhood}
(which shows that the set of primes in $V(J)$ where there is
a regular sequence generating $J$ is open).
In other words, we may assume $\mathfrak q$ is rig-closed
in $A\{x_1, \ldots, x_n\}$. And to check that
$B$ is naively rig-flat, it also suffices to
check that the corresponding localizations $B_\mathfrak q$
are flat over $A$.

\medskip\noindent
Let $\mathfrak q \subset A\{x_1, \ldots, x_n\}$ be rig-closed with
$J \subset \mathfrak q$. By
Lemma \ref{lemma-rig-closed-point-after-localization}
we may choose an $f \in A$ mapping to a unit in
$A\{x_1, \ldots, x_n\}/\mathfrak q$ and such
that the prime ideal $\mathfrak p'$ in $A_{\{f\}}$ induced is rig-closed.
Below we will use that
$A_{\{f\}}\{x_1, \ldots, x_n\} = A\{x_1, \ldots, x_n\}_{\{f\}}$;
details omitted. Consider the diagram
$$
\xymatrix{
A\{x_1, \ldots, x_n\}_{\mathfrak q} / J_\mathfrak q \ar[r] &
A_{\{f\}}\{x_1, \ldots, x_n\}_{\mathfrak q'}/
J A_{\{f\}}\{x_1, \ldots, x_n\}_{\mathfrak q'} \\
A\{x_1, \ldots, x_n\}_{\mathfrak q} \ar[r] \ar[u] &
A_{\{f\}}\{x_1, \ldots, x_n\}_{\mathfrak q'} \ar[u] \\
A \ar[r] \ar[u] &
A_{\{f\}} \ar[u]
}
$$
The middle horizontal arrow is faithfully flat as it is a local
homomorphism of local rings and flat as $A_{\{f\}}\{x_1, \ldots, x_n\}$
is the completion of a localization of the Noetherian ring
$A\{x_1, \ldots, x_n\}$. Similarly the bottom horizontal arrow is flat.
Hence to show that $J_\mathfrak q$ is generated by a regular sequence
and that $A \to A\{x_1, \ldots, x_n\}_{\mathfrak q} / J_\mathfrak q$
is flat, it suffices to prove the same things for
$J A_{\{f\}}\{x_1, \ldots, x_n\}_{\mathfrak q'}$ and
$A_{\{f\}} \to A_{\{f\}}\{x_1, \ldots, x_n\}_{\mathfrak q'}/
J A_{\{f\}}\{x_1, \ldots, x_n\}_{\mathfrak q'}$.
See Algebra, Lemma \ref{algebra-lemma-flat-increases-depth} or
More on Algebra, Lemma \ref{more-algebra-lemma-flat-descent-regular-ideal}
for the statement on regular sequences. Finally, we have already seen that
$A_{\{f\}} \to B_{\{f\}}$ is rig-smooth.
This reduces us to the case discussed in the next paragraph.

\medskip\noindent
Let $\mathfrak q \subset A\{x_1, \ldots, x_n\}$ be rig-closed with
$J \subset \mathfrak q$ such that moreover $\mathfrak p = A \cap \mathfrak q$
is rig-closed as well. By the characterization of rig-smooth algebras
given in Lemma \ref{lemma-equivalent-with-artin-smooth}
after reordering the variables $x_1, \ldots, x_n$
we can find $m \geq 0$ and $f_1, \ldots, f_m \in J$ such that
\begin{enumerate}
\item $J_\mathfrak q$ is generated by $f_1, \ldots, f_m$, and
\item $\det_{1 \leq i, j \leq m}(\partial f_j/ \partial x_i)$
maps to a unit in $A\{x_1, \ldots, x_n\}_\mathfrak q$.
\end{enumerate}
By Lemma \ref{lemma-fibre-regular} the fibre ring
$$
F = A\{x_1, \ldots, x_n\} \otimes_A \kappa(\mathfrak p)
$$
is regular. Observe that the $A$-derivations $\partial / \partial x_i$
extend (uniquely) to derivations $D_i : F \to F$. By
More on Algebra, Lemma \ref{more-algebra-lemma-quotient-sequence-regular}
we see that $f_1, \ldots, f_m$ map to a regular sequence in
$F_\mathfrak q$. By flatness of $A \to A\{x_1, \ldots, x_n\}$
and Algebra, Lemma \ref{algebra-lemma-grothendieck-regular-sequence}
this shows that $f_1, \ldots, f_m$ map to a regular sequence in
$A\{x_1, \ldots, x_m\}_\mathfrak q$ and the quotient by
these elements is flat over $A$. This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-exact-sequence-NL-rig-smooth}
Let $A \to B \to C$ be arrows in $\textit{WAdm}^{Noeth}$
which are adic and topologically of finite type. If $B \to C$
is rig-smooth, then the kernel of the map
$$
H^{-1}(\NL_{B/A}^\wedge \otimes_B C) \to H^{-1}(\NL_{C/A}^\wedge)
$$
(see Lemma \ref{lemma-exact-sequence-NL})
is annihilated by an ideal of definition.
\end{lemma}

\begin{proof}
Let $\overline{\mathfrak q} \subset C$ be a prime ideal which does not contain
an ideal of definition. Since the modules in question are finite
it suffices to show that
$$
H^{-1}(\NL_{B/A}^\wedge \otimes_B C)_{\overline{\mathfrak q}} \to
H^{-1}(\NL_{C/A}^\wedge)_{\overline{\mathfrak q}}
$$
is injective. As in the proof of Lemma \ref{lemma-exact-sequence-NL}
choose presentations $B = A\{x_1, \ldots, x_r\}/J$,
$C = B\{y_1, \ldots, y_s\}/J'$, and
$C = A\{x_1, \ldots, x_r, y_1, \ldots, y_s\}/K$.
Looking at the diagram in the proof of Lemma \ref{lemma-exact-sequence-NL}
we see that it suffices to show that $J/J^2 \otimes_B C \to K/K^2$
is injective after localization at the prime ideal
$\mathfrak q \subset A\{x_1, \ldots, x_r, y_1, \ldots, y_s\}$
corresponding to $\overline{\mathfrak q}$. Please compare with
More on Algebra, Lemma \ref{more-algebra-lemma-transitive-lci-at-end}
and its proof. This is the same as 
asking $J/KJ \to K/K^2$ to be injective after localization
at $\mathfrak q$. Equivalently, we have to show that
$J_\mathfrak q \cap K^2_\mathfrak q = (KJ)_\mathfrak q$.
By Lemma \ref{lemma-rig-smooth-rig-flat}
we know that $(K/J)_\mathfrak q = J'_\mathfrak q$
is generated by a regular sequence.
Hence the desired intersection property follows from
More on Algebra, Lemma
\ref{more-algebra-lemma-conormal-sequence-H1-regular-ideal}
(and the fact that an ideal generated by a regular sequence
is $H_1$-regular, see
More on Algebra, Section \ref{more-algebra-section-ideals}).
\end{proof}









\section{Rig-smooth morphisms}
\label{section-rig-smooth-morphisms}

\noindent
In this section we use the work done in
Section \ref{section-rig-smooth-homomorphisms}
to define rig-smooth morphisms of locally Noetherian algebraic spaces.

\begin{definition}
\label{definition-rig-smooth}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of locally
Noetherian formal algebraic spaces over $S$. We say $f$ is
{\it rig-smooth} if for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to a rig-smooth map of adic Noetherian topological rings.
\end{definition}

\noindent
Let us prove that we can check this condition \'etale locally on
source and target.

\begin{lemma}
\label{lemma-rig-smooth-morphisms}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of
locally Noetherian formal algebraic spaces over $S$.
The following are equivalent
\begin{enumerate}
\item $f$ is rig-smooth,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to a rig-smooth map in $\textit{WAdm}^{Noeth}$,
\item there exists a covering $\{Y_j \to Y\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $j$
a covering $\{X_{ji} \to Y_j \times_Y X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
such that each $X_{ji} \to Y_j$  corresponds
to a rig-smooth map in $\textit{WAdm}^{Noeth}$, and
\item there exist a covering $\{X_i \to X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $i$ a factorization $X_i \to Y_i \to Y$ where $Y_i$
is an affine formal algebraic space, $Y_i \to Y$ is representable
by algebraic spaces and \'etale, and $X_i \to Y_i$ corresponds
to a rig-smooth map in $\textit{WAdm}^{Noeth}$.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) is Definition \ref{definition-rig-smooth}.
The equivalence of (2), (3), and (4) follows from the fact that
being rig-smooth is a local property of arrows of
$\text{WAdm}^{Noeth}$ by Lemma \ref{lemma-rig-smooth-axioms}
and an application of the variant of
Formal Spaces, Lemma
\ref{formal-spaces-lemma-property-defines-property-morphisms}
for morphisms between locally Noetherian algebraic spaces
mentioned in
Formal Spaces, Remark
\ref{formal-spaces-remark-variant-Noetherian}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-smooth}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Z \to Y$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
If $f$ is rig-smooth and $g$ is adic, then the base change
$X \times_Y Z \to Z$ is rig-smooth.
\end{lemma}

\begin{proof}
By Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-variant-Noetherian}
and the discussion in Formal Spaces, Section
\ref{formal-spaces-section-adic},
this follows from Lemma \ref{lemma-base-change-rig-smooth-continuous}.
\end{proof}

\begin{lemma}
\label{lemma-composition-rig-smooth}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
If $f$ and $g$ are rig-smooth, then so is $g \circ f$.
\end{lemma}

\begin{proof}
By Formal Spaces, Remark
\ref{formal-spaces-remark-composition-variant-Noetherian}
this follows from Lemma \ref{lemma-composition-rig-smooth-continuous}.
\end{proof}

\begin{lemma}
\label{lemma-rig-smooth-rig-flat-morphism}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of
locally Noetherian formal algebraic spaces over $S$.
If $f$ is rig-smooth, then $f$ is rig-flat.
\end{lemma}

\begin{proof}
Follows immediately from Lemma \ref{lemma-rig-smooth-rig-flat}
and the definitions.
\end{proof}









\section{Rig-\'etale homomorphisms}
\label{section-rig-etale-homomorphisms}

\noindent
In this section we prove some properties of rig-\'etale homomorphisms
of adic Noetherian topological rings which are needed to introduce
rig-\'etale morphisms of locally Noetherian algebraic spaces.

\begin{lemma}
\label{lemma-rig-etale-continuous}
Let $A \to B$ be a morphism in $\textit{WAdm}^{Noeth}$
(Formal Spaces, Section \ref{formal-spaces-section-morphisms-rings}).
The following are equivalent:
\begin{enumerate}
\item[(a)] $A \to B$ satisfies the equivalent conditions of
Lemma \ref{lemma-finite-type} and there exists an ideal of definition
$I \subset B$ such that $B$ is rig-\'etale over $(A, I)$, and
\item[(b)] $A \to B$ satisfies the equivalent conditions of
Lemma \ref{lemma-finite-type} and for all ideals of definition
$I \subset A$ the algebra $B$ is rig-\'etale over $(A, I)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $I$ and $I'$ be ideals of definitions of $A$. Then there exists an
integer $c \geq 0$ such that $I^c \subset I'$ and $(I')^c \subset I$. Hence
$B$ is rig-\'etale over $(A, I)$ if and only if
$B$ is rig-\'etale over $(A, I')$. This follows from
Definition \ref{definition-rig-etale-homomorphism},
the inclusions $I^c \subset I'$ and $(I')^c \subset I$, and
the fact that the naive cotangent complex $\NL_{B/A}^\wedge$
is independent of the choice of ideal of definition of $A$ by
Remark \ref{remark-NL-well-defined-topological}.
\end{proof}

\begin{definition}
\label{definition-rig-etale-continuous-homomorphism}
Let $\varphi : A \to B$ be a continuous ring homomorphism
between adic Noetherian topological rings, i.e., $\varphi$
is an arrow of $\textit{WAdm}^{Noeth}$. We say
$\varphi$ is {\it rig-etale} if the equivalent conditions
of Lemma \ref{lemma-rig-etale-continuous} hold.
\end{definition}

\noindent
This defines a local property.

\begin{lemma}
\label{lemma-rig-etale-axioms}
The property $P(\varphi)=$``$\varphi$ is rig-\'etale'' on arrows
of $\textit{WAdm}^{Noeth}$ is a local property as defined in
Formal Spaces, Remark \ref{formal-spaces-remark-variant-Noetherian}.
\end{lemma}

\begin{proof}
This proof is exactly the same as the proof of
Lemma \ref{lemma-rig-smooth-axioms}.
Let us recall what the statement signifies. First, 
$\textit{WAdm}^{Noeth}$ is the category whose objects are
adic Noetherian topological rings and whose morphisms are
continuous ring homomorphisms. Consider a commutative diagram
$$
\xymatrix{
B \ar[r] & (B')^\wedge \\
A \ar[r] \ar[u]^\varphi & (A')^\wedge \ar[u]_{\varphi'}
}
$$
satisfying the following conditions:
$A$ and $B$ are adic Noetherian topological rings,
$A \to A'$ and $B \to B'$ are \'etale ring maps,
$(A')^\wedge = \lim A'/I^nA'$ for some ideal of definition $I \subset A$,
$(B')^\wedge = \lim B'/J^nB'$ for some ideal of definition $J \subset B$, and
$\varphi : A \to B$ and $\varphi' : (A')^\wedge \to (B')^\wedge$
are continuous. Note that $(A')^\wedge$ and $(B')^\wedge$ are
adic Noetherian topological rings by
Formal Spaces, Lemma \ref{formal-spaces-lemma-completion-in-sub}.
We have to show
\begin{enumerate}
\item $\varphi$ is rig-\'etale $\Rightarrow \varphi'$ is rig-\'etale,
\item if $B \to B'$ faithfully flat, then $\varphi'$ is rig-\'etale
$\Rightarrow \varphi$ is rig-\'etale, and
\item if $A \to B_i$ is rig-\'etale for $i = 1, \ldots, n$, then
$A \to \prod_{i = 1, \ldots, n} B_i$ is rig-\'etale.
\end{enumerate}
The equivalent conditions of Lemma \ref{lemma-finite-type} satisfy
conditions (1), (2), and (3).
Thus in verifying (1), (2), and (3) for the property
``rig-\'etale'' we may already assume our ring maps satisfy
the equivalent conditions of Lemma \ref{lemma-finite-type}
in each case.

\medskip\noindent
Pick an ideal of definition $I \subset A$. By the remarks above
the topology on each ring in the diagram is the $I$-adic topology
and $B$, $(A')^\wedge$, and $(B')^\wedge$ are in the category
(\ref{equation-C-prime}) for $(A, I)$.
Since $A \to A'$ and $B \to B'$ are \'etale the complexes
$\NL_{A'/A}$ and $\NL_{B'/B}$ are zero and hence
$\NL_{(A')^\wedge/A}^\wedge$ and $\NL_{(B')^\wedge/B}^\wedge$
are zero by Lemma \ref{lemma-NL-is-completion}.
Applying Lemma \ref{lemma-exact-sequence-NL} to
$A \to (A')^\wedge \to (B')^\wedge$ we get isomorphisms
$$
H^i(\NL_{(B')^\wedge/(A')^\wedge}^\wedge) \to H^i(\NL_{(B')^\wedge/A}^\wedge)
$$
Thus $\NL_{(B')^\wedge/A}^\wedge \to \NL_{(B')^\wedge/(A')^\wedge}$
is a quasi-isomorphism. The ring maps $B/I^nB \to B'/I^nB'$ are \'etale
and hence are local complete intersections
(Algebra, Lemma \ref{algebra-lemma-etale-standard-smooth}).
Hence we may apply
Lemmas \ref{lemma-exact-sequence-NL} and
\ref{lemma-transitive-lci-at-end} to
$A \to B \to (B')^\wedge$ and we get isomorphisms
$$
H^i(\NL_{B/A}^\wedge \otimes_B (B')^\wedge) \to
H^i(\NL_{(B')^\wedge/A}^\wedge)
$$
We conclude that
$\NL_{B/A}^\wedge \otimes_B (B')^\wedge \to \NL_{(B')^\wedge/A}^\wedge$
is a quasi-isomorphism. Combining these two observations we obtain that
$$
\NL_{(B')^\wedge/(A')^\wedge}^\wedge \cong
\NL_{B/A}^\wedge \otimes_B (B')^\wedge
$$
in $D((B')^\wedge)$.
With these preparations out of the way we can start the actual proof.

\medskip\noindent
Proof of (1). Assume $\varphi$ is rig-\'etale. Then there exists a $c \geq 0$
such that multiplication by $a \in I^c$ is zero on $\NL_{B/A}^\wedge$
in $D(B)$. This property is preserved under base change
by $B \to (B')^\wedge$, see
More on Algebra, Lemmas \ref{more-algebra-lemma-two-term-base-change}.
By the isomorphism above we find that $\varphi'$ is rig-\'etale.
This proves (1).

\medskip\noindent
To prove (2) assume $B \to B'$ is faithfully flat and that $\varphi'$
is rig-\'etale. Then there exists a $c \geq 0$ such that
multiplication by $a \in I^c$ is zero on
$\NL_{(B')^\wedge/(A')^\wedge}^\wedge$ in $D((B')^\wedge)$.
By the isomorphism above we see that $a^c$ annihilates the
cohomology modules of
$\NL_{B/A}^\wedge \otimes_B (B')^\wedge$.
The composition $B \to (B')^\wedge$ is faithfully flat
by our assumption that $B \to B'$ is faithfully flat, see
Formal Spaces, Lemma \ref{formal-spaces-lemma-etale-surjective}.
Hence the cohomology modules of $\NL_{B/A}^\wedge$ are annihilated
by $I^c$. It follows from Lemma \ref{lemma-equivalent-with-artin}
that $\varphi$ is rig-\'etale.
This proves (2).

\medskip\noindent
To prove (3), setting $B = \prod_{i = 1, \ldots, n} B_i$
we just observe that $\NL_{B/A}^\wedge$ is the direct
sum of the complexes $\NL_{B_i/A}^\wedge$ viewed as complexes
of $B$-modules.
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-etale-continuous}
Consider the properties $P(\varphi)=$``$\varphi$ is rig-\'etale''
and $Q(\varphi)$=``$\varphi$ is adic'' on arrows of $\textit{WAdm}^{Noeth}$.
Then $P$ is stable under base change by $Q$ as defined in
Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-variant-Noetherian}.
\end{lemma}

\begin{proof}
The statement makes sense by Lemma \ref{lemma-rig-etale-continuous}.
To see that it is true assume we have morphisms
$B \to A$ and $B \to C$ in $\textit{WAdm}^{Noeth}$
and that $B \to A$ is rig-\'etale and $B \to C$ is adic
(Formal Spaces, Definition
\ref{formal-spaces-definition-adic-homomorphism}).
Then we can choose an ideal of definition $I \subset B$
such that the topology on $A$ and $C$ is the $I$-adic topology.
In this situation it follows immediately that
$A \widehat{\otimes}_B C$ is rig-\'etale over $(C, IC)$ by
Lemma \ref{lemma-base-change-rig-etale-homomorphism}.
\end{proof}

\begin{lemma}
\label{lemma-composition-rig-etale-continuous}
The property $P(\varphi)=$``$\varphi$ is rig-\'etale''
on arrows of $\textit{WAdm}^{Noeth}$ is stable under composition
as defined in Formal Spaces, Remark
\ref{formal-spaces-remark-composition-variant-Noetherian}.
\end{lemma}

\begin{proof}
The statement makes sense by
Lemma \ref{lemma-rig-etale-continuous}.
To see that it is true assume we have rig-\'etale morphisms
$A \to B$ and $B \to C$ in $\textit{WAdm}^{Noeth}$.
Then we can choose an ideal of definition $I \subset A$
such that the topology on $C$ and $B$ is the $I$-adic topology.
By Lemma \ref{lemma-exact-sequence-NL} we obtain an exact sequence
$$
\xymatrix{
C \otimes_B H^0(\NL_{B/A}^\wedge) \ar[r] &
H^0(\NL_{C/A}^\wedge) \ar[r] &
H^0(\NL_{C/B}^\wedge) \ar[r] & 0 \\
H^{-1}(\NL_{B/A}^\wedge \otimes_B C) \ar[r] &
H^{-1}(\NL_{C/A}^\wedge) \ar[r] &
H^{-1}(\NL_{C/B}^\wedge) \ar[llu]
}
$$
There exists a $c \geq 0$ such that for all $a \in I$ 
multiplication by $a^c$ is zero on $\NL_{B/A}^\wedge$ in $D(B)$ and
$\NL_{C/B}^\wedge$ in $D(C)$. Then of course
multiplication by $a^c$ is zero on $\NL_{B/A}^\wedge \otimes_B C$
in $D(C)$ too. Hence
$H^0(\NL_{B/A}^\wedge) \otimes_A C$, 
$H^0(\NL_{C/B}^\wedge)$, 
$H^{-1}(\NL_{B/A}^\wedge \otimes_B C)$, and
$H^{-1}(\NL_{C/B}^\wedge)$
are annihilated by $a^c$. From the exact sequence
we obtain that multiplication by $a^{2c}$ is zero on
$H^0(\NL_{C/A}^\wedge)$ and $H^{-1}(\NL_{C/A}^\wedge)$.
It follows from Lemma \ref{lemma-equivalent-with-artin}
that $C$ is rig-\'etale over $(A, I)$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-permanence-rig-etale-continuous}
The property $P(\varphi)=$``$\varphi$ is rig-\'etale''
on arrows of $\textit{WAdm}^{Noeth}$ has the cancellation property
as defined in Formal Spaces, Remark
\ref{formal-spaces-remark-permanence-variant-Noetherian}.
\end{lemma}

\begin{proof}
The statement makes sense by
Lemma \ref{lemma-rig-etale-continuous}.
To see that it is true assume we have maps
$A \to B$ and $B \to C$ in $\textit{WAdm}^{Noeth}$
with $A \to C$ and $A \to B$ rig-\'etale.
We have to show that $B \to C$ is rig-\'etale.
Then we can choose an ideal of definition $I \subset A$
such that the topology on $C$ and $B$ is the $I$-adic topology.
By Lemma \ref{lemma-exact-sequence-NL} we obtain an exact sequence
$$
\xymatrix{
C \otimes_B H^0(\NL_{B/A}^\wedge) \ar[r] &
H^0(\NL_{C/A}^\wedge) \ar[r] &
H^0(\NL_{C/B}^\wedge) \ar[r] & 0 \\
H^{-1}(\NL_{B/A}^\wedge \otimes_B C) \ar[r] &
H^{-1}(\NL_{C/A}^\wedge) \ar[r] &
H^{-1}(\NL_{C/B}^\wedge) \ar[llu]
}
$$
There exists a $c \geq 0$ such that for all $a \in I$ 
multiplication by $a^c$ is zero on $\NL_{B/A}^\wedge$ in $D(B)$ and
$\NL_{C/A}^\wedge$ in $D(C)$. Hence
$H^0(\NL_{B/A}^\wedge) \otimes_A C$,
$H^0(\NL_{C/A}^\wedge)$, and
$H^{-1}(\NL_{C/A}^\wedge)$
are annihilated by $a^c$. From the exact sequence
we obtain that multiplication by $a^{2c}$ is zero on
$H^0(\NL_{C/B}^\wedge)$ and $H^{-1}(\NL_{C/B}^\wedge)$.
It follows from Lemma \ref{lemma-equivalent-with-artin}
that $C$ is rig-\'etale over $(B, IB)$ as desired.
\end{proof}














\section{Rig-\'etale morphisms}
\label{section-rig-etale-morphisms}

\noindent
In this section we use the work done in
Section \ref{section-rig-etale-homomorphisms}
to define rig-\'etale morphisms of locally Noetherian algebraic spaces.

\begin{definition}
\label{definition-rig-etale}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of locally
Noetherian formal algebraic spaces over $S$. We say $f$ is
{\it rig-\'etale} if for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to a rig-\'etale map of adic Noetherian topological rings.
\end{definition}

\noindent
Let us prove that we can check this condition \'etale locally on
source and target.

\begin{lemma}
\label{lemma-rig-etale-morphisms}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of
locally Noetherian formal algebraic spaces over $S$.
The following are equivalent
\begin{enumerate}
\item $f$ is rig-\'etale,
\item for every commutative diagram
$$
\xymatrix{
U \ar[d] \ar[r] & V \ar[d] \\
X \ar[r] & Y
}
$$
with $U$ and $V$ affine formal algebraic spaces, $U \to X$ and $V \to Y$
representable by algebraic spaces and \'etale, the morphism $U \to V$
corresponds to a rig-\'etale map in $\textit{WAdm}^{Noeth}$,
\item there exists a covering $\{Y_j \to Y\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $j$
a covering $\{X_{ji} \to Y_j \times_Y X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
such that each $X_{ji} \to Y_j$  corresponds
to a rig-\'etale map in $\textit{WAdm}^{Noeth}$, and
\item there exist a covering $\{X_i \to X\}$ as in
Formal Spaces,
Definition \ref{formal-spaces-definition-formal-algebraic-space}
and for each $i$ a factorization $X_i \to Y_i \to Y$ where $Y_i$
is an affine formal algebraic space, $Y_i \to Y$ is representable
by algebraic spaces and \'etale, and $X_i \to Y_i$ corresponds
to a rig-\'etale map in $\textit{WAdm}^{Noeth}$.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) is Definition \ref{definition-rig-etale}.
The equivalence of (2), (3), and (4) follows from the fact that
being rig-\'etale is a local property of arrows of
$\text{WAdm}^{Noeth}$ by Lemma \ref{lemma-rig-etale-axioms}
and an application of the variant of
Formal Spaces, Lemma
\ref{formal-spaces-lemma-property-defines-property-morphisms}
for morphisms between locally Noetherian algebraic spaces
mentioned in Formal Spaces, Remark
\ref{formal-spaces-remark-variant-Noetherian}.
\end{proof}

\noindent
To be sure, a rig-\'etale morphism is locally of finite type.

\begin{lemma}
\label{lemma-rig-etale-finite-type}
A rig-\'etale morphism of locally Noetherian formal algebraic spaces
is locally of finite type.
\end{lemma}

\begin{proof}
The property $P$ in Lemma \ref{lemma-rig-etale-axioms}
implies the equivalent conditions (a), (b), (c), and (d) in
Formal Spaces, Lemma
\ref{formal-spaces-lemma-quotient-restricted-power-series}.
Hence this follows from
Formal Spaces, Lemma \ref{formal-spaces-lemma-finite-type-local-property}.
\end{proof}

\begin{lemma}
\label{lemma-rig-etale-rig-smooth-morphism}
A rig-\'etale morphism of locally Noetherian formal algebraic spaces
is rig-smooth.
\end{lemma}

\begin{proof}
Follows from the definitions and
Lemma \ref{lemma-rig-etale-rig-smooth}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-etale}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Z \to Y$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
If $f$ is rig-\'etale and $g$ is adic, then the base change
$X \times_Y Z \to Z$ is rig-\'etale.
\end{lemma}

\begin{proof}
By Formal Spaces, Remark
\ref{formal-spaces-remark-base-change-variant-variant-Noetherian}
and the discussion in Formal Spaces, Section
\ref{formal-spaces-section-adic},
this follows from Lemma \ref{lemma-base-change-rig-etale-continuous}.
\end{proof}

\begin{lemma}
\label{lemma-composition-rig-etale}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
If $f$ and $g$ are rig-\'etale, then so is $g \circ f$.
\end{lemma}

\begin{proof}
By Formal Spaces, Remark
\ref{formal-spaces-remark-composition-variant-Noetherian}
this follows from Lemma \ref{lemma-composition-rig-etale-continuous}.
\end{proof}

\begin{lemma}
\label{lemma-rig-etale-permanence}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$
be a morphism of locally Noetherian formal algebraic spaces over $S$.
If $g \circ f$ and $g$ are rig-\'etale, then so is $f$.
\end{lemma}

\begin{proof}
By Formal Spaces, Remark
\ref{formal-spaces-remark-permanence-variant-Noetherian}
this follows from Lemma \ref{lemma-permanence-rig-etale-continuous}.
\end{proof}

\begin{lemma}
\label{lemma-rig-etale-alternative-permanence}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
If $g \circ f$ is rig-\'etale and $g$ is an adic monomorphism, then
$f$ is rig-\'etale.
\end{lemma}

\begin{proof}
Use Lemma \ref{lemma-base-change-rig-etale} and that
$f$ is the base change of $g \circ f$ by $g$.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-rig-smooth}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of formal algebraic
spaces. Assume that $X$ and $Y$ are locally Noetherian and $f$ is a
closed immersion. The following are equivalent
\begin{enumerate}
\item $f$ is rig-smooth,
\item $f$ is rig-\'etale,
\item for every affine formal algebraic space $V$ and every morphism
$V \to Y$ which is representable by algebraic spaces and \'etale
the morphism $X \times_Y V \to V$ corresponds to a surjective morphism
$B \to A$ in $\textit{WAdm}^{Noeth}$ whose kernel $J$ has the following
property: $I(J/J^2) = 0$ for some ideal of definition $I$ of $B$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let us observe that given $V$ and $V \to Y$ as in (2) without any
further assumption on $f$ we see that the morphism $X \times_Y V \to V$
corresponds to a surjective morphism $B \to A$ in $\textit{WAdm}^{Noeth}$
by Formal Spaces, Lemma
\ref{formal-spaces-lemma-closed-immersion-into-countably-indexed}.

\medskip\noindent
We have (2) $\Rightarrow$ (1) by
Lemma \ref{lemma-rig-etale-rig-smooth-morphism}.

\medskip\noindent
Proof of (3) $\Rightarrow$ (2). Assume (3). By
Lemma \ref{lemma-rig-etale-morphisms}
it suffices to show that the ring maps
$B \to A$ occuring in (3) are rig-\'etale in the
sense of Definition \ref{definition-rig-etale-continuous-homomorphism}.
Let $I$ be as in (3). The naive cotangent complex
$\NL_{A/B}^\wedge$ of $A$ over $(B, I)$ is the complex of $A$-modules
given by putting $J/J^2$ in degree $-1$. Hence $A$ is
rig-\'etale over $(B, I)$ by
Definition \ref{definition-rig-etale-homomorphism}.

\medskip\noindent
Assume (1) and let $V$ and $B \to A$ be as in (3).
By Definition \ref{definition-rig-smooth} we see that
$B \to A$ is rig-smooth. Choose any ideal of definition $I \subset B$.
Then $A$ is rig-smooth over $(B, I)$.
As above the complex $\NL_{A/B}^\wedge$ is 
given by putting $J/J^2$ in degree $-1$.
Hence by Lemma \ref{lemma-equivalent-with-artin-smooth}
we see that $J/J^2$ is annihilated by
a power $I^n$ for some $n \geq 1$. Since $B$ is adic, we see
that $I^n$ is an ideal of definition of $B$ and the
proof is complete.
\end{proof}














\section{Rig-surjective morphisms}
\label{section-rig-surjective}

\noindent
For morphisms locally of finite type between locally Noetherian formal
algebraic spaces a definition borrowed from \cite{ArtinII} can be used. See
Remark \ref{remark-rig-surjective-more-general} for a discussion
of what to do in more general cases.

\begin{definition}
\label{definition-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of formal
algebraic spaces over $S$. Assume that $X$ and $Y$ are locally
Noetherian and that $f$ is locally of finite type. We say
$f$ is {\it rig-surjective} if for every solid diagram
$$
\xymatrix{
\text{Spf}(R') \ar@{..>}[r] \ar@{..>}[d] & X \ar[d]^f \\
\text{Spf}(R) \ar[r]^-p & Y
}
$$
where $R$ is a complete discrete valuation ring and where
$p$ is an adic morphism there exists an
extension of complete discrete valuation rings $R \subset R'$
and a morphism $\text{Spf}(R') \to X$ making the displayed diagram commute.
\end{definition}

\noindent
We will see in the lemmas below that this notion behaves reasonably well
in the context of locally Noetherian formal algebraic spaces and morphisms
which are locally of finite type.
In the next remark we discuss options for modifying this definition
to a wider class of morphisms of formal algebraic spaces.

\begin{remark}
\label{remark-rig-surjective-more-general}
The condition as formulated in Definition \ref{definition-rig-surjective}
is not right even for morphisms of finite type
of locally adic* formal algebraic spaces.
For example, if $A = (\bigcup_{n \geq 1} k[t^{1/n}])^\wedge$
where the completion is the $t$-adic completion, then
there are no adic morphisms $\text{Spf}(R) \to \text{Spf}(A)$
where $R$ is a complete discrete valuation ring.
Thus any morphism $X \to \text{Spf}(A)$ would be rig-surjective,
but since $A$ is a domain and $t \in A$ is not zero, we want to
think of $A$ as having at least one ``rig-point'', and we do not
want to allow $X = \emptyset$. To cover this
particular case, one can consider adic morphisms
$$
\text{Spf}(R) \longrightarrow Y
$$
where $R$ is a valuation ring complete with respect to a principal
ideal $J$ whose radical is $\mathfrak m_R = \sqrt{J}$.
In this case the value group of $R$ can be embedded into
$(\mathbf{R}, +)$ and one obtains the point of view used by
Berkovich in defining an analytic space associated to $Y$, see
\cite{Berkovich}. Another approach is championed by Huber. In his theory,
one drops the hypothesis that $\Spec(R/J)$ is a singleton, see
\cite{Huber-continuous-valuations}.
\end{remark}

\begin{lemma}
\label{lemma-composition-rig-surjective}
\begin{slogan}
Rig-surjectivity of locally finite type morphisms is preserved under
composition
\end{slogan}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of formal
algebraic spaces over $S$. Assume $X$, $Y$, $Z$ are locally Noetherian and
$f$ and $g$ locally of finite type. Then if $f$ and $g$ are rig-surjective,
so is $g \circ f$.
\end{lemma}

\begin{proof}
Follows in a straightforward manner from the definitions
(and Formal Spaces, Lemma \ref{formal-spaces-lemma-composition-finite-type}).
\end{proof}

\begin{lemma}
\label{lemma-base-change-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ and $Z \to Y$ be morphisms
of formal algebraic spaces over $S$. Assume $X$, $Y$, $Z$ are locally
Noetherian and $f$ and $g$ locally of finite type. If $f$ is
rig-surjective, then the base change $Z \times_Y X \to Z$ is too.
\end{lemma}

\begin{proof}
Follows in a straightforward manner from the definitions (and
Formal Spaces, Lemmas \ref{formal-spaces-lemma-fibre-product-Noetherian} and
\ref{formal-spaces-lemma-base-change-finite-type}).
\end{proof}

\begin{lemma}
\label{lemma-rig-surjective-alternative-permanence}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$
be morphisms locally of finite type of locally Noetherian
formal algebraic spaces over $S$. If $g \circ f$ is rig-surjective
and $g$ is a monomorphism, then $f$ is rig-surjective.
\end{lemma}

\begin{proof}
Use Lemma \ref{lemma-base-change-rig-surjective} and that
$f$ is the base change of $g \circ f$ by $g$.
\end{proof}

\begin{lemma}
\label{lemma-permanence-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of
formal algebraic spaces over $S$. Assume $X$, $Y$, $Z$ locally Noetherian
and $f$ and $g$ locally of finite type. If $g \circ f : X \to Z$
is rig-surjective, so is $g : Y \to Z$.
\end{lemma}

\begin{proof}
Immediate from the definition.
\end{proof}

\begin{lemma}
\label{lemma-etale-covering-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of locally Noetherian
formal algebraic spaces which is representable by algebraic spaces, \'etale,
and surjective. Then $f$ is rig-surjective.
\end{lemma}

\begin{proof}
Let $p : \text{Spf}(R) \to Y$ be an adic morphism where $R$ is a complete
discrete valuation ring. Let $Z = \text{Spf}(R) \times_Y X$. Then
$Z \to \text{Spf}(R)$ is representable by algebraic spaces, \'etale, and
surjective. Hence $Z$ is nonempty. Pick a nonempty affine formal algebraic
space $V$ and an \'etale morphism $V \to Z$ (possible by our definitions).
Then $V \to \text{Spf}(R)$ corresponds to $R \to A^\wedge$ where
$R \to A$ is an \'etale ring map, see Formal Spaces, Lemma
\ref{formal-spaces-lemma-etale}. Since $A^\wedge \not = 0$
(as $V \not = \emptyset$) we can find a maximal ideal $\mathfrak m$
of $A$ lying over $\mathfrak m_R$. Then $A_\mathfrak m$ is a discrete
valuation ring (More on Algebra, Lemma
\ref{more-algebra-lemma-Dedekind-etale-extension}).
Then $R' = A_\mathfrak m^\wedge$ is a complete discrete valuation ring
(More on Algebra, Lemma \ref{more-algebra-lemma-completion-dvr}).
Applying Formal Spaces, Lemma
\ref{formal-spaces-lemma-morphism-between-formal-spectra}.
we find the desired morphism $\text{Spf}(R') \to V \to Z \to X$.
\end{proof}

\noindent
The upshot of the lemmas above is that we may check whether
$f : X \to Y$ is rig-surjective, \'etale locally on $Y$.

\begin{lemma}
\label{lemma-upshot}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of locally
Noetherian formal algebraic spaces which is locally of finite type.
Let $\{g_i : Y_i \to Y\}$ be a family of morphisms of formal
algebraic spaces which are representable by algebraic spaces and
\'etale such that $\coprod g_i$ is surjective.
Then $f$ is rig-surjective if and only if each
$f_i : X \times_Y Y_i \to Y_i$ is rig-surjective.
\end{lemma}

\begin{proof}
Namely, if $f$ is rig-surjective, so is any base change
(Lemma \ref{lemma-base-change-rig-surjective}).
Conversely, if all $f_i$ are rig-surjective, so is
$\coprod f_i : \coprod X \times_Y Y_i \to \coprod Y_i$.
By Lemma \ref{lemma-etale-covering-rig-surjective}
the morphism $\coprod g_i : \coprod Y_i \to Y$ is rig-surjective.
Hence $\coprod X \times_Y Y_i \to Y$ is rig-surjective
(Lemma \ref{lemma-composition-rig-surjective}).
Since this morphism factors through $X \to Y$ we see that $X \to Y$
is rig-surjective by Lemma \ref{lemma-permanence-rig-surjective}.
\end{proof}

\begin{lemma}
\label{lemma-faithfully-flat-rig-surjective}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Let $B$ be an $I$-adically complete $A$-algebra.
If $A/I^n \to B/I^nB$ is of finite type and flat for all $n$ and
faithfully flat for $n = 1$, then $\text{Spf}(B) \to \text{Spf}(A)$
is rig-surjective.
\end{lemma}

\begin{proof}
We will use without further mention that morphisms between formal spectra
are given by continuous maps between the corresponding topological rings, see
Formal Spaces, Lemma \ref{formal-spaces-lemma-morphism-between-formal-spectra}.
Let $\varphi : A \to R$ be a continuous map into a complete discrete
valuation ring $A$. This implies that $\varphi(I) \subset \mathfrak m_R$.
On the other hand, since we only need to produce the lift
$\varphi' : B' \to R'$ in the case that $\varphi$ corresponds to an adic
morphism, we may assume that $\varphi(I) \not = 0$. Thus we may consider
the base change $C = B \widehat{\otimes}_A R$, see
Remark \ref{remark-base-change} for example.
Then $C$ is an $\mathfrak m_R$-adically complete $R$-algebra
such that $C/\mathfrak m_R^n C$ is of finite type and flat over
$R/\mathfrak m_R^n$ and such that $C/\mathfrak m_R C$ is nonzero.
Pick any maximal ideal $\mathfrak m \subset C$ lying over
$\mathfrak m_R$. By flatness (which implies going down) we see that
$\Spec(C_\mathfrak m) \setminus V(\mathfrak m_R C_\mathfrak m)$
is a nonempty open. Hence
We can pick a prime $\mathfrak q \subset \mathfrak m$
such that $\mathfrak q$ defines a closed point of
$\Spec(C_\mathfrak m) \setminus \{\mathfrak m\}$ and such that
$\mathfrak q \not \in V(IC_\mathfrak m)$, see
Properties, Lemma \ref{properties-lemma-complement-closed-point-Jacobson}.
Then $C/\mathfrak q$ is a dimension $1$-local domain and we can find
$C/\mathfrak q \subset R'$ with $R'$ a discrete valuation ring
(Algebra, Lemma \ref{algebra-lemma-exists-dvr}).
By construction $\mathfrak m_R R' \subset \mathfrak m_{R'}$
and we see that $C \to R'$ extends to a continuous map
$C \to (R')^\wedge$ (in fact we can pick $R'$ such that
$R' = (R')^\wedge$ in our current situation but we do not need this).
Since the completion of a discrete valuation ring is a discrete
valuation ring, we see that the assumption gives a commutative
diagram of rings
$$
\xymatrix{
(R')^\wedge & C \ar[l] & B \ar[l] \\
R \ar[u] & R \ar[l] \ar[u] & A \ar[l] \ar[u]
}
$$
which gives the desired lift.
\end{proof}

\begin{lemma}
\label{lemma-flat-rig-surjective}
Let $A$ be a Noetherian ring complete with respect to an ideal $I$.
Let $B$ be an $I$-adically complete $A$-algebra. Assume that
\begin{enumerate}
\item the $I$-torsion in $A$ is $0$,
\item $A/I^n \to B/I^nB$ is flat and of finite type for all $n$.
\end{enumerate}
Then $\text{Spf}(B) \to \text{Spf}(A)$ is rig-surjective if and only
if $A/I \to B/IB$ is faithfully flat.
\end{lemma}

\begin{proof}
Faithful flatness implies rig-surjectivity by
Lemma \ref{lemma-faithfully-flat-rig-surjective}.
To prove the converse we will use without further mention that the
vanishing of $I$-torsion is equivalent to the vanishing of $I$-power torsion
(More on Algebra, Lemma \ref{more-algebra-lemma-torsion-free}).
We will also use without further mention that morphisms between
formal spectra are given by continuous maps between the corresponding
topological rings, see
Formal Spaces, Lemma \ref{formal-spaces-lemma-morphism-between-formal-spectra}.

\medskip\noindent
Assume $\text{Spf}(B) \to \text{Spf}(A)$ is rig-surjective.
Choose a maximal ideal $I \subset \mathfrak m \subset A$.
The open $U = \Spec(A_\mathfrak m) \setminus V(I_\mathfrak m)$
of $\Spec(A_\mathfrak m)$ is nonempty as the $I_\mathfrak m$-torsion of
$A_\mathfrak m$ is zero
(use Algebra, Lemma \ref{algebra-lemma-Noetherian-power-ideal-kills-module}).
Thus we can find a prime $\mathfrak q \subset A_\mathfrak m$ which defines
a point of $U$ (i.e., $IA_\mathfrak m \not \subset \mathfrak q$)
and which corresponds to a closed point
of $\Spec(A_\mathfrak m) \setminus \{\mathfrak m\}$, see
Properties, Lemma \ref{properties-lemma-complement-closed-point-Jacobson}.
Then $A_\mathfrak m/\mathfrak q$ is a dimension $1$ local domain.
Thus we can find an injective local homomorphism of local rings
$A_\mathfrak m/\mathfrak q \subset R$ where $R$ is a discrete valuation ring
(Algebra, Lemma \ref{algebra-lemma-exists-dvr}).
By construction $IR \subset \mathfrak m_R$ and we see that
$A \to R$ extends to a continuous map $A \to R^\wedge$.
Since the completion of a discrete valuation ring is a discrete
valuation ring, we see that the assumption gives a commutative
diagram of rings
$$
\xymatrix{
R' & B \ar[l] \\
R^\wedge \ar[u] & A \ar[l] \ar[u]
}
$$
Thus we find a prime ideal of $B$ lying over $\mathfrak m$. It follows
that $\Spec(B/IB) \to \Spec(A/I)$ is surjective, whence $A/I \to B/IB$
is faithfully flat
(Algebra, Lemma \ref{algebra-lemma-ff-rings}).
\end{proof}

\begin{lemma}
\label{lemma-monomorphism-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of formal algebraic
spaces. Assume $X$ and $Y$ are locally Noetherian, $f$ locally of finite
type, and $f$ a monomorphism. Then $f$ is rig surjective if and only if
every adic morphism $\text{Spf}(R) \to Y$ where $R$ is a complete discrete
valuation ring factors through $X$.
\end{lemma}

\begin{proof}
One direction is trivial. For the other, suppose that $\text{Spf}(R) \to Y$
is an adic morphism such that there exists an extension of complete
discrete valuation rings $R \subset R'$ with
$\text{Spf}(R') \to \text{Spf}(R) \to X$ factoring through $Y$. Then
$\Spec(R'/\mathfrak m_R^n R') \to \Spec(R/\mathfrak m_R^n)$ is surjective
and flat, hence the morphisms $\Spec(R/\mathfrak m_R^n) \to X$ factor
through $X$ as $X$ satisfies the sheaf condition for fpqc coverings, see
Formal Spaces, Lemma \ref{formal-spaces-lemma-sheaf-fpqc}.
In other words, $\text{Spf}(R) \to Y$ factors through $X$.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of formal algebraic
spaces. Assume that $X$ and $Y$ are locally Noetherian and $f$ is a
closed immersion. The following are equivalent
\begin{enumerate}
\item $f$ is rig-surjective, and
\item for every affine formal algebraic space $V$ and every morphism
$V \to Y$ which is representable by algebraic spaces and \'etale
the morphism $X \times_Y V \to V$ corresponds to a surjective morphism
$B \to A$ in $\textit{WAdm}^{Noeth}$ whose kernel $J$ has the following
property: $IJ^n = 0$ for some ideal of definition $I$ of $B$
and some $n \geq 1$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let us observe that given $V$ and $V \to Y$ as in (2) without any
further assumption on $f$ we see that the morphism $X \times_Y V \to V$
corresponds to a surjective morphism $B \to A$ in $\textit{WAdm}^{Noeth}$
by Formal Spaces, Lemma
\ref{formal-spaces-lemma-closed-immersion-into-countably-indexed}.

\medskip\noindent
Assume (1). By Lemma \ref{lemma-base-change-rig-surjective} we see that
$\text{Spf}(A) \to \text{Spf}(B)$ is rig-surjective.
Let $I \subset B$ be an ideal of definition. Since $B$ is adic,
$I^m \subset B$ is an ideal of definition for all $m \geq 1$.
If $I^m J^n \not = 0$ for all $n, m \geq 1$, then
$IJ$ is not nilpotent, hence $V(IJ) \not = \Spec(B)$.
Thus we can find a prime ideal $\mathfrak p \subset B$
with $\mathfrak p \not \in V(I) \cup V(J)$.
Observe that $I(B/\mathfrak p) \not = B/\mathfrak p$
hence we can find a maximal ideal
$\mathfrak p + I \subset \mathfrak m \subset B$.
By Algebra, Lemma \ref{algebra-lemma-exists-dvr}
we can find a discrete valuation ring $R$
and an injective local ring homomorphism $(B/\mathfrak p)_\mathfrak m \to R$.
Clearly, the ring map $B \to R$ cannot factor through $A = B/J$.
According to Lemma \ref{lemma-monomorphism-rig-surjective}
this contradicts the fact that $\text{Spf}(A) \to \text{Spf}(B)$
is rig-surjective. Hence for some $n, m$ we do have
$I^n J^m = 0$ which shows that (2) holds.

\medskip\noindent
Assume (2). By Lemma \ref{lemma-upshot} it suffices to show
that $\text{Spf}(A) \to \text{Spf}(B)$ is rig-surjective.
Pick an ideal of definition $I \subset B$ and an integer $n$
such that $I J^n = 0$.
Consider a ring map $B \to R$ where $R$ is a discrete valuation
ring and the image of $I$ is nonzero. Since $R$ is a domain, we
conclude the image of $J$ in $R$ is zero. Hence $B \to R$
factors through the surjection $B \to A$ and we are done by
definition of rig-surjective morphisms.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-rig-smooth-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of formal algebraic
spaces. Assume that $X$ and $Y$ are locally Noetherian and $f$ is a
closed immersion. The following are equivalent
\begin{enumerate}
\item $f$ is rig-smooth and rig-surjective,
\item $f$ is rig-\'etale and rig-surjective, and
\item for every affine formal algebraic space $V$ and every morphism
$V \to Y$ which is representable by algebraic spaces and \'etale
the morphism $X \times_Y V \to V$ corresponds to a surjective morphism
$B \to A$ in $\textit{WAdm}^{Noeth}$ whose kernel $J$ has the following
property: $IJ = 0$ for some ideal of definition $I$ of $B$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $I$ and $J$ be ideals of a ring $B$ such that $IJ^n = 0$ and
$I(J/J^2) = 0$. Then $I^nJ = 0$ (proof omitted).
Hence this lemma follows from a trivial combination of
Lemmas \ref{lemma-closed-immersion-rig-smooth} and
\ref{lemma-closed-immersion-rig-surjective}.
\end{proof}

\begin{lemma}
\label{lemma-rig-etale-descent}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Y \to Z$
be morphisms of locally Noetherian formal algebraic spaces over $S$.
Assume
\begin{enumerate}
\item $g$ is locally of finite type,
\item $f$ is rig-smooth (resp.\ rig-\'etale) and rig-surjective,
\item $g \circ f$ is rig-smooth (resp.\ rig-\'etale)
\end{enumerate}
then $g$ is rig-smooth (resp.\ rig-\'etale).
\end{lemma}

\begin{proof}
We will prove this in the rig-smooth case and indicate the necessary
changes to prove the rig-\'etale case at the end of the proof.
Consider a commutative diagram
$$
\xymatrix{
X \times_Y V \ar[r] \ar[d] &
V \ar[d] \ar[r] &
W \ar[d] \\
X \ar[r] &
Y \ar[r] &
Z
}
$$
with $V$ and $W$ affine formal algebraic spaces, $V \to Y$ and $W \to Z$
representable by algebraic spaces and \'etale. We have to show that
$V \to W$ corresponds to a rig-smooth map of adic Noetherian topological
rings, see Definition \ref{definition-rig-smooth}.
We may write $V = \text{Spf}(B)$ and $W = \text{Spf}(C)$ and that
$V \to W$ corresponds to an adic ring map $C \to B$ which is topologically
of finite type, see Lemma \ref{lemma-finite-type-morphisms}.

\medskip\noindent
We will use below without further mention that $X \times_Y V \to V$
is rig-smooth and rig-surjective, see
Lemmas \ref{lemma-base-change-rig-smooth} and
\ref{lemma-base-change-rig-surjective}.
Also, the composition $X \times_Y V \to V \to W$ is rig-smooth
since $g \circ f$ is rig-smooth.

\medskip\noindent
Let $I \subset C$ be an ideal of definition. The module
Assume $C \to B$ is not rig-smooth to get a contradiction.
This means that there exists a prime ideal $\mathfrak q \subset B$
not containing $IB$ such that either $H^{-1}(\NL_{B/C}^\wedge)_\mathfrak p$
is nonzero or $H^0(\NL_{B/C}^\wedge)_\mathfrak p$ is not a finite free
$B_\mathfrak q$-module. See
Lemma \ref{lemma-equivalent-with-artin-smooth}; some details
omitted. We may choose a maximal ideal
$IB + \mathfrak q \subset \mathfrak m$. By
Algebra, Lemma \ref{algebra-lemma-exists-dvr}
we can find a complete discrete valuation ring $R$ and an injective
local ring homomorphism $(B/\mathfrak q)_\mathfrak m \to R$.

\medskip\noindent
After replacing $R$ by an extension, we may assume given a lift
$\text{Spf}(R) \to X \times_Y V$ of the adic morphism
$\text{Spf}(R) \to V = \text{Spf}(B)$. Choose an \'etale
covering $\{\text{Spf}(A_i) \to X \times_Y V\}$ as in
Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}.
By Lemma \ref{lemma-etale-covering-rig-surjective}
we may assume $\text{Spf}(R) \to X \times_Y V$ lifts to a
morphism $\text{Spf}(R) \to \text{Spf}(A_i)$ for some $i$
(this might require replacing $R$ by another extension).
Set $A = A_i$. Consider the ring maps
$$
C \to B \to A \to R
$$
Let $\mathfrak p \subset A$ be the kernel of the map
$A \to R$ and note that $\mathfrak p$ lies over $\mathfrak q$.
We know that $C \to A$ and $B \to A$ are rig-smooth.
In particular the ring map $B_\mathfrak q \to A_\mathfrak p$
is flat by Lemma \ref{lemma-rig-smooth-rig-flat}.
Consider the associated exact sequence
$$
\xymatrix{
&
H^0(\NL_{B/C}^\wedge) \otimes_B A_\mathfrak p \ar[r] &
H^0(\NL_{A/C}^\wedge)_\mathfrak p \ar[r] &
H^0(\NL_{A/B}^\wedge)_\mathfrak p \ar[r] & 0 \\
0 \ar[r] &
H^{-1}(\NL_{B/C}^\wedge \otimes_B A)_\mathfrak p \ar[r] &
H^{-1}(\NL_{A/C}^\wedge)_\mathfrak p \ar[r] &
H^{-1}(\NL_{A/B}^\wedge)_\mathfrak p \ar[llu]
}
$$
of Lemmas \ref{lemma-exact-sequence-NL} and
\ref{lemma-exact-sequence-NL-rig-smooth}.
Given the rig-smoothness of $C \to A$ and $B \to A$
we conclude that $H^{-1}(\NL_{B/C}^\wedge \otimes_B A)_\mathfrak p = 0$
and that $H^0(\NL_{B/C}^\wedge) \otimes_B A_\mathfrak p$
is finite free as a kernel of a surjection of finite free
$A_\mathfrak p$-modules. Since $B_\mathfrak q \to A_\mathfrak p$
is flat and hence faithfully flat, this implies that
$H^{-1}(\NL_{B/C}^\wedge)_\mathfrak q = 0$
and that $H^0(\NL_{B/C}^\wedge)_\mathfrak q$
is finite free which is the contradiction we were looking for.

\medskip\noindent
In the rig-\'etale case one argues in exactly the same manner
but the conclusion obtained is that both
$H^{-1}(\NL_{B/C}^\wedge)_\mathfrak q$
and $H^0(\NL_{B/C}^\wedge)_\mathfrak q$ are zero.
\end{proof}







\section{Formal algebraic spaces over cdvrs}
\label{section-over-cdrv}

\noindent
In this section we will use the following terminology:
if $A$ is a weakly admissible topological ring, then we
say ``{\it $X$ is a formal algebraic space over $A$}'' to mean that $X$
is a formal algebraic space which comes equipped with
a morphism $p : X \to \text{Spf}(A)$ of formal algebraic spaces.
In this situation we will call $p$ the {\it structure morphism}.

\begin{lemma}
\label{lemma-flat-locus}
Let $X$ be a locally Noetherian formal algebraic space over
a complete discrete valuation ring $A$.
Then there exists a closed immersion $X' \to X$
of formal algebraic spaces such that $X'$ is flat over $A$
and such that any morphism $Y \to X$ of locally Noetherian formal algebraic
spaces with $Y$ flat over $A$ factors through $X'$.
\end{lemma}

\begin{proof}
Let $\pi \in A$ be the uniformizer. Recall that an $A$-module
is flat if and only if the $\pi$-power torsion is $0$.

\medskip\noindent
First assume that $X$ is an affine formal algebraic space.
Then $X = \text{Spf}(B)$ with $B$ an adic Noetherian $A$-algebra.
In this case we set $X' = \text{Spf}(B')$ where
$B' = B/\pi\text{-power torsion}$. It is clear that $X'$ is flat
over $A$ and that $X' \to X$ is a closed immersion.
Let $g : Y \to X$ be a morphism of locally Noetherian formal algebraic spaces
with $Y$ flat over $A$. Choose a covering $\{Y_j \to Y\}$ as in
Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}.
Then $Y_j = \text{Spf}(C_j)$ with $C_j$ flat over $A$.
Hence the morphism $Y_j \to X$, which correspond to a continuous
$R$-algebra map $B \to C_j$, factors through $X'$ as clearly
$B \to C_j$ kills the $\pi$-power torsion.
Since $\{Y_j \to Y\}$ is a covering and since $X' \to X$
is a monomorphism, we conclude that $g$ factors through $X'$.

\medskip\noindent
Let $X$ and $\{X_i \to X\}_{i \in I}$ be as in
Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}.
For each $i$ let $X'_i \to X_i$ be the flat part as
constructed above. For $i, j \in I$ the projection
$X'_i \times_X X_j \to X'_i$ is an \'etale (by assumption)
morphism of schemes (by Formal Spaces, Lemma
\ref{formal-spaces-lemma-presentation-representable}).
Hence $X'_i \times_X X_j$ is flat over $A$ as morphisms
representable by algebraic spaces and \'etale
are flat (Lemma \ref{lemma-representable-flat}).
Thus the projection $X'_i \times_X X_j \to X_j$ factors
through $X'_j$ by the universal property. We conclude that
$$
R_{ij} = X'_i \times_X X_j = X'_i \times_X X'_j = X_i \times_X X'_j
$$
because the morphisms $X'_i \to X_i$ are injections of sheaves.
Set $U = \coprod X'_i$, set
$R = \coprod R_{ij}$, and denote $s, t : R \to U$ the two
projections. As a sheaf $R = U \times_X U$ and $s$ and $t$
are \'etale. Then $(t, s) : R \to U$ defines an \'etale equivalence
relation by our observations above. Thus $X' = U/R$ is an
algebraic space by Spaces, Theorem \ref{spaces-theorem-presentation}.
By construction the diagram
$$
\xymatrix{
\coprod X'_i \ar[r] \ar[d] & \coprod X_i \ar[d] \\
X' \ar[r] & X
}
$$
is cartesian. Since the right vertical arrow is \'etale surjective
and the top horizontal arrow is representable and a closed immersion
we conclude that $X' \to X$ is representable by
Bootstrap, Lemma \ref{bootstrap-lemma-after-fppf-sep-lqf}.
Then we can use Spaces, Lemma
\ref{spaces-lemma-descent-representable-transformations-property}
to conclude that $X' \to X$ is a closed immersion.

\medskip\noindent
Finally, suppose that $Y \to X$ is a morphism with
$Y$ a locally Noetherian formal algebraic space flat over $A$.
Then each $X_i \times_X Y$ is \'etale over $Y$ and
therefore flat over $A$ (see above).
Then $X_i \times_X Y \to X_i$ factors through $X'_i$.
Hence $Y \to X$ factors through $X'$ because
$\{X_i \times_X Y \to Y\}$ is an \'etale covering.
\end{proof}

\begin{lemma}
\label{lemma-flat-and-diagonal-rig-surjective}
Let $X$ be a locally Noetherian formal algebraic space which is
locally of finite type over a complete discrete valuation ring $A$.
Let $X' \subset X$ be as in Lemma \ref{lemma-flat-locus}.
If $X \to X \times_{\text{Spf}(A)} X$ is rig-\'etale and rig-surjective,
then $X' = \text{Spf}(A)$ or $X' = \emptyset$.
\end{lemma}

\begin{proof}
(Aside: the diagonal is always locally of finite type by
Formal Spaces, Lemma
\ref{formal-spaces-lemma-diagonal-morphism-formal-algebraic-spaces}
and $X \times_{\text{Spf}(A)} X$ is locally Noetherian by
Formal Spaces, Lemmas
\ref{formal-spaces-lemma-base-change-finite-type} and
\ref{formal-spaces-lemma-locally-finite-type-locally-noetherian}.
Thus imposing the conditions on the diagonal morphism makes sense.)
The diagram
$$
\xymatrix{
X' \ar[r] \ar[d] & X' \times_{\text{Spf}(A)} X' \ar[d] \\
X \ar[r] & X \times_{\text{Spf}(A)} X
}
$$
is cartesian. Hence $X' \to X' \times_{\text{Spf}(A)} X'$
is rig-\'etale and rig-surjective by
Lemma \ref{lemma-base-change-rig-surjective}.
Choose an affine formal algebraic space $U$ and a morphism
$U \to X'$ which is representable by algebraic spaces and \'etale.
Then $U = \text{Spf}(B)$ where $B$ is an adic Noetherian topological ring
which is a flat $A$-algebra, whose topology is the $\pi$-adic
topology where $\pi \in A$ is a uniformizer, and such that
$A/\pi^n A \to B/\pi^n B$ is of finite type for each $n$.
For later use, we remark that this in particular implies: if $B \not = 0$,
then the map $\text{Spf}(B) \to \text{Spf}(A)$ is a surjection
of sheaves (please recall that we are using the fppf topology
as always). Repeating the argument above, we see that
$$
W = U \times_{X'} U =
X' \times_{X' \times_{\text{Spf}(A)} X'} (U \times_{\text{Spf}(A)} U)
\longrightarrow
U \times_{\text{Spf}(A)} U
$$
is a closed immersion and rig-\'etale and rig-surjective. We have
$U \times_{\text{Spf}(A)} U = \text{Spf}(B \widehat{\otimes}_A B)$
by Formal Spaces, Lemma
\ref{formal-spaces-lemma-fibre-product-affines-over-separated}.
Then $B \widehat{\otimes}_A B$ is a flat $A$-algebra
as the $\pi$-adic completion of the flat $A$-algebra $B \otimes_A B$.
Hence $W = U \times_{\text{Spf}(A)} U$ by
Lemma \ref{lemma-closed-immersion-rig-smooth-rig-surjective}.
In other words, we have $U \times_{X'} U = U \times_{\text{Spf}(A)} U$
which in turn means that the image of $U \to X'$ (as a map of sheaves)
maps injectively to $\text{Spf}(A)$.
Choose a covering $\{U_i \to X'\}$ as in Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}.
In particular $\coprod U_i \to X'$ is a surjection of sheaves.
By applying the above to $U_i \coprod U_j \to X'$ (using the
fact that $U_i \amalg U_j$ is an affine formal algebraic space
as well) we see that $X' \to \text{Spf}(A)$ is an injective map
of fppf sheaves. Since $X'$ is flat over $A$, either $X'$ is empty
(if $U_i$ is empty for all $i$) or the map is an isomorphism
(if $U_i$ is nonempty for some $i$ when we have seen that
$U_i \to \text{Spf}(A)$ is a surjective map of sheaves)
and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-rig-monomorphism-rig-surjective}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of formal algebraic
spaces. Assume
\begin{enumerate}
\item $X$ and $Y$ are locally Noetherian,
\item $f$ locally of finite type,
\item $\Delta_f : X \to X \times_Y X$ is rig-\'etale and rig-surjective.
\end{enumerate}
Then $f$ is rig surjective if and only if every adic morphism
$\text{Spf}(R) \to Y$ where $R$ is a complete discrete
valuation ring lifts to a morphism $\text{Spf}(R) \to X$.
\end{lemma}

\begin{proof}
One direction is trivial. For the other, suppose that $\text{Spf}(R) \to Y$
is an adic morphism such that there exists an extension of complete
discrete valuation rings $R \subset R'$ with
$\text{Spf}(R') \to \text{Spf}(R) \to X$ factoring through $Y$.
Consider the fibre product diagram
$$
\xymatrix{
\text{Spf}(R') \ar[r] \ar[rd] &
\text{Spf}(R) \times_Y X \ar[r] \ar[d]^p &
X \ar[d]^f \\
&
\text{Spf}(R) \ar[r] &
Y
}
$$
The morphism $p$ is locally of finite type as a base change of $f$, see
Formal Spaces, Lemma
\ref{formal-spaces-lemma-base-change-finite-type}.
The diagonal morphism $\Delta_p$ is the base change of
$\Delta_f$ and hence is rig-\'etale and rig-surjective.
By Lemma \ref{lemma-flat-and-diagonal-rig-surjective}
the flat locus of $\text{Spf}(R) \times_Y X$ over $R$
is either $\emptyset$ or equal to $\text{Spf}(R)$.
However, since $\text{Spf}(R')$ factors through it
we conclude it is not empty and hence
we get a morphism $\text{Spf}(R) \to \text{Spf}(R) \times_Y X \to X$
as desired.
\end{proof}










\section{The completion functor}
\label{section-completion-functor}

\noindent
In this section we consider the following situation.
First we fix a base scheme $S$. All rings, topological rings,
schemes, algebraic spaces, and formal algebraic spaces and
morphisms between these will be over $S$. Next, we fix an
algebraic space $X$ and a closed subset $T \subset |X|$.
We denote $U \subset X$ be the open subspace with $|U| = |X| \setminus T$.
Picture
$$
U \to X \quad |X| = |U| \amalg T
$$
In this situation, given an algebraic space $X'$ over $X$, i.e., an
algebraic space $X'$ endowed with a morphism $f : X' \to X$, then we
denote $T' \subset |X'|$ the inverse image of $T$ and we let $U' \subset X'$
be the open subspace with $|U'| = |X'| \setminus T'$. Picture
$$
U' = f^{-1}U
\quad\quad
\vcenter{
\xymatrix{
U' \ar[d] \ar[r] & X' \ar[d]_f \\
U \ar[r] & X
}
}
\quad\quad
\vcenter{
\xymatrix{
|U'| \ar[r] \ar[d] & |X'| \ar[d]^{|f|} & T' \ar[l] \ar[d] \\
|U| \ar[r] & |X| & T \ar[l]
}
}
\quad\quad
T' = |f|^{-1}T
$$
We will relate properties of $f$ to properties of the induced morphism
$$
f_{/T} : X'_{/T'} \longrightarrow X_{/T}
$$
of formal completions. As indicated in the displayed formula, we will
denote this morphism $f_{/T}$. We have already seen that
$f_{/T}$ is representable by algebraic spaces in
Formal Spaces, Lemma
\ref{formal-spaces-lemma-map-completions-representable}.
In fact, as the proof of that lemma shows, the diagram
$$
\xymatrix{
X'_{/T'} \ar[d]_{f_{/T}} \ar[r] & X' \ar[d]^f \\
X_{/T} \ar[r] & X
}
$$
is cartesian. Please keep this fact in mind whilst reading the lemmas stated
and proved below.

\begin{lemma}
\label{lemma-map-completions-finite-type}
In the situation above. If $f$ is locally of finite type, then
$f_{/T}$ is locally of finite type.
\end{lemma}

\begin{proof}
(Finite type morphisms of formal algebraic spaces are discussed in
Formal Spaces, Section \ref{formal-spaces-section-finite-type}.)
Namely, suppose that $Z \to X$ is a morphism from a scheme into $X$ such
that $|Z|$ maps into $T$. From the cartesian square above we see that
$Z \times_X X'$ is an algebraic space representing
$Z \times_{X_{/T}} X'_{/T'}$. Since $Z \times_X X' \to Z$
is locally of finite type by Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-finite-type} we conclude.
\end{proof}

\begin{lemma}
\label{lemma-map-completions-etale}
In the situation above. If $f$ is \'etale, then $f_{/T}$ is \'etale.
\end{lemma}

\begin{proof}
By the same argument as in the proof of
Lemma \ref{lemma-map-completions-finite-type} this follows from
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-base-change-etale}.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-gives-closed-immersion}
In the situation above. If $f$ is a closed immersion, then
$f_{/T}$ is a closed immersion.
\end{lemma}

\begin{proof}
(Closed immersions of formal algebraic spaces are discussed in
Formal Spaces, Section
\ref{formal-spaces-section-closed-immersions}.)
By the same argument as in the proof of
Lemma \ref{lemma-map-completions-finite-type} this follows from
Spaces, Lemma
\ref{spaces-lemma-base-change-immersions}.
\end{proof}

\begin{lemma}
\label{lemma-proper-gives-proper}
In the situation above. If $f$ is proper, then $f_{/T}$ is proper.
\end{lemma}

\begin{proof}
(Proper morphisms of formal algebraic spaces are discussed in
Formal Spaces, Section \ref{formal-spaces-section-proper}.)
By the same argument as in the proof of
Lemma \ref{lemma-map-completions-finite-type} this follows from
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-proper}.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact-gives-quasi-compact}
In the situation above. If $f$ is quasi-compact, then
$f_{/T}$ is quasi-compact.
\end{lemma}

\begin{proof}
(Quasi-compact morphisms of formal algebraic spaces are discussed in
Formal Spaces, Section \ref{formal-spaces-section-quasi-compact}.)
We have to show that $(X'_{/T'})_{red} \to (X_{/T})_{red}$ is a quasi-compact
morphism of algebraic spaces. By
Formal Spaces, Lemma \ref{formal-spaces-lemma-reduction-completion}
this is the morphism $Z' \to Z$ where $Z' \subset X'$, resp.\ $Z \subset X$
is the reduced induced algebraic space structure on $T'$, resp.\ $T$.
It follows that $Z' \to f^{-1}Z = Z \times_X X'$ is a thickening (a closed
immersion defining an isomorphism on underlying topological spaces).
Since $Z \times_X X' \to Z$ is quasi-compact as a base change of $f$
(Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-quasi-compact})
we conclude that $Z' \to Z$ is too by
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-thicken-property-morphisms}.
\end{proof}

\begin{remark}
\label{remark-diagonal-gives-diagonal}
In the situation above consider the diagonal morphisms
$\Delta_f : X' \to X' \times_X X'$ and
$\Delta_{f_{/T}} : X'_{/T'} \to X'_{/T'} \times_{X_{/T}} X'_{/T'}$.
It is easy to see that
$$
X'_{/T'} \times_{X_{/T}} X'_{/T'} = (X' \times_X X')_{/T''}
$$
as subfunctors of $X' \times_X X'$ where $T'' \subset |X' \times_X X'|$
is the inverse image of $T$. Hence we see that
$\Delta_{f_{/T}} = (\Delta_f)_{/T''}$. We will use this below
to show that properties of $\Delta_f$ are inherited by $\Delta_{f_{/T}}$.
\end{remark}

\begin{lemma}
\label{lemma-quasi-separated-gives-quasi-separated}
In the situation above. If $f$ is (quasi-)separated, then
$f_{/T}$ is too.
\end{lemma}

\begin{proof}
(Separation conditions on morphisms of formal algebraic spaces are discussed in
Formal Spaces, Section
\ref{formal-spaces-section-separation-axioms}.)
We have to show that if $\Delta_f$ is quasi-compact, resp.\ a closed immersion,
then the same is true for $\Delta_{f_{/T}}$. This follows from the discussion
in Remark \ref{remark-diagonal-gives-diagonal} and
Lemmas \ref{lemma-quasi-compact-gives-quasi-compact} and
\ref{lemma-closed-immersion-gives-closed-immersion}.
\end{proof}

\begin{lemma}
\label{lemma-smooth-gives-rig-smooth}
In the situation above. If $X$ is locally Noetherian,
$f$ is locally of finite type, and $U' \to U$ is smooth, then
$f_{/T}$ is rig-smooth.
\end{lemma}

\begin{proof}
The strategy of the proof is this: reduce to the case where $X$ and $X'$
are affine, translate the affine case into algebra, and finally apply
Lemma \ref{lemma-rig-smooth}. We urge the reader to skip the details.

\medskip\noindent
Choose a surjective \'etale morphism $W \to X$ with $W = \coprod W_i$
a disjoint union of affine schemes, see Properties of Spaces, Lemma
\ref{spaces-properties-lemma-cover-by-union-affines}.
For each $i$ choose a surjective \'etale morphism $W'_i \to W_i \times_X X'$
where $W'_i = \coprod W'_{ij}$ is a disjoint union of affines.
In particular $\coprod W'_{ij} \to X'$ is surjective and \'etale.
Denote $f_{ij} : W_{ij} \to W_i$ the given morphism.
Denote $T_i \subset W_i$ and $T'_{ij} \subset W_{ij}$ the inverse
images of $T$. Since taking the completion along the inverse
image of $T$ produces cartesian diagrams (see above) we
have $(W_i)_{/T_i} = W_i \times_X X_{/T}$ and similarly
$(W'_{ij})_{/T'_{ij}} = W'_{ij} \times_{X'} X'_{/T'}$.
Moreover, recall that $(W_i)_{/T_i}$ and $(W'_{ij})_{/T'_{ij}}$
are affine formal algebraic spaces.
Hence $\{W'_{ij})_{/T'_{ij}} \to X'_{/T'}\}$ is a covering
as in Formal Spaces, Definition
\ref{formal-spaces-definition-formal-algebraic-space}.
By Lemma \ref{lemma-rig-smooth-morphisms}
we see that it suffices to prove that
$$
(W'_{ij})_{/T'_{ij}} \longrightarrow (W_i)_{/T_i}
$$
is rig-smooth. Observe that $W'_{ij} \to W_i$
is locally of finite type and induces a smooth morphism
$W'_{ij} \setminus T'_{ij} \to W_i \setminus T_i$
(as this is true for $f$ and these properties of morphisms are
\'etale local on the source and target).
Observe that $W_i$ is locally Noetherian (as $X$ is locally Noetherian
and this property is \'etale local on the algebraic space).
Hence it suffices to prove the lemma when
$X$ and $X'$ are affine schemes.

\medskip\noindent
Assume $X = \Spec(A)$ and $X' = \Spec(A')$ are affine schemes.
Since $X$ is Noetherian, we see that $A$ is Noetherian.
The morphism $f$ is given by a ring map $A \to A'$ of finite type.
Let $I \subset A$ be an ideal cutting out $T$. Then $IA'$ cuts out $T'$.
Also $\Spec(A') \to \Spec(A)$ is smooth over $\Spec(A) \setminus T$.
Let $A^\wedge$ and $(A')^\wedge$ be the $I$-adic
completions. We have $X_{/T} = \text{Spf}(A^\wedge)$ and
$X'_{/T'} = \text{Spf}((A')^\wedge)$, see proof of
Formal Spaces, Lemma
\ref{formal-spaces-lemma-formal-completion-types}.
By Lemma \ref{lemma-rig-smooth} we see that
$(A')^\wedge$ is rig-smooth over $(A. I)$
which in turn means that $A^\wedge \to (A')^\wedge$ is rig-smooth which
finally implies that $X'_{/T'} \to X_{/T}$ is rig smooth by
Lemma \ref{lemma-rig-smooth-morphisms}.
\end{proof}

\begin{lemma}
\label{lemma-etale-gives-rig-etale}
In the situation above. If $X$ is locally Noetherian,
$f$ is locally of finite type, and $U' \to U$ is \'etale, then
$f_{/T}$ is rig-\'etale.
\end{lemma}

\begin{proof}
The proof is exactly the same as the proof of
Lemma \ref{lemma-smooth-gives-rig-smooth} except with
Lemmas \ref{lemma-rig-smooth} and \ref{lemma-rig-smooth-morphisms}
replaced by
Lemmas \ref{lemma-rig-etale} and \ref{lemma-rig-etale-morphisms}
\end{proof}

\begin{lemma}
\label{lemma-completion-proper-surjective-rig-surjective}
In the situation above. If $X$ is locally Noetherian,
$f$ is proper, and $U' \to U$ is surjective, then $f_{/T}$ is rig-surjective.
\end{lemma}

\begin{proof}
(The statement makes sense by
Lemma \ref{lemma-map-completions-finite-type} and
Formal Spaces, Lemma \ref{formal-spaces-lemma-formal-completion-types}.)
Let $R$ be a complete discrete valuation ring with fraction field $K$.
Let $p : \text{Spf}(R) \to X_{/T}$ be an adic morphism of
formal algebraic spaces. By Formal Spaces, Lemma
\ref{formal-spaces-lemma-adic-into-completion}
the composition $\text{Spf}(R) \to X_{/T} \to X$
corresponds to a morphism $q : \Spec(R) \to X$
which maps $\Spec(K)$ into $U$. Since $U' \to U$ is proper and surjective
we see that $\Spec(K) \times_U U'$ is nonempty and proper over $K$.
Hence we can choose a field extension $K'/K$ and a commutative
diagram
$$
\xymatrix{
\Spec(K') \ar[r] \ar[d] & U' \ar[r] \ar[d] & X' \ar[d] \\
\Spec(K) \ar[r] & U \ar[r] & X
}
$$
Let $R' \subset K'$ be a discrete valuation ring dominating $R$
with fraction field $K'$, see Algebra, Lemma \ref{algebra-lemma-exists-dvr}.
Since $\Spec(K) \to X$ extends to $\Spec(R) \to X$ we see by the valuative
criterion of properness
(Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-characterize-proper})
that we can extend our $K'$-point of $U'$ to a morphism
$\Spec(R') \to X'$ over $\Spec(R) \to X$.
It follows that the inverse image of $T'$ in $\Spec(R')$ is the
closed point and we find an adic morphism
$\text{Spf}((R')^\wedge) \to X'_{/T'}$ lifting $p$
as desired (note that $(R')^\wedge$ is a complete discrete valuation ring
by More on Algebra, Lemma \ref{more-algebra-lemma-completion-dvr}).
\end{proof}

\begin{lemma}
\label{lemma-separated-mono-open-diagonal-rig-surjective}
In the situation above. If $X$ is locally Noetherian,
$f$ is separated and locally of finite type, and $U' \to U$ is
a monomorphism, then $\Delta_{f_{/T}}$ is rig-surjective.
\end{lemma}

\begin{proof}
The diagonal $\Delta_f : X' \to X' \times_X X'$ is a closed
immersion and the restriction $U' \to U' \times_U U'$ of $\Delta_f$
is surjective. Hence the lemma follows from the discussion in
Remark \ref{remark-diagonal-gives-diagonal} and
Lemma \ref{lemma-completion-proper-surjective-rig-surjective}.
\end{proof}












\section{Formal modifications}
\label{section-formal-modifications}

\noindent
In this section we define and study Artin's notion of a formal modification
of locally Noetherian formal algebraic spaces. First, here is the
definition.

\begin{definition}
\label{definition-formal-modification}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of
locally Noetherian formal algebraic spaces over $S$. We say $f$ is a
{\it formal modification} if
\begin{enumerate}
\item $f$ is a proper morphism (Formal Spaces, Definition
\ref{formal-spaces-definition-proper}),
\item $f$ is rig-\'etale,
\item $f$ is rig-surjective,
\item $\Delta_f : X \to X \times_Y X$ is rig-surjective.
\end{enumerate}
\end{definition}

\noindent
A typical example is given in
Lemma \ref{lemma-modification-gives-formal-modification}
and indeed we will later show that every formal modification is
``formal locally'' of this type, see
Lemma \ref{lemma-formal-modifications-locally-algebraic}.
Let us compare these conditions with those in Artin's paper.

\begin{remark}
\label{remark-compare-formal-modification-artin}
In \cite[Definition 1.7]{ArtinII} a formal modification is defined as a
proper morphism $f : X \to Y$ of locally Noetherian formal algebraic spaces
satisfying the following three conditions\footnote{We will not completely
translate these conditions into the language developed in the Stacks
project. We hope nonetheless the discussion here will be useful to the
reader.}
\begin{enumerate}
\item[(\romannumeral1)] the Cramer and Jacobian ideal of
$f$ each contain an ideal of definition of $X$,
\item[(\romannumeral2)] the ideal defining the
diagonal map $\Delta : X \to X \times_Y X$
is annihilated by an ideal of definition of $X \times_Y X$, and
\item[(\romannumeral3)] any adic morphism $\text{Spf}(R) \to Y$
lifts to $\text{Spf}(R) \to X$ whenever $R$ is a
complete discrete valuation ring.
\end{enumerate}
Let us compare these to our list of conditions above.

\medskip\noindent
Ad (\romannumeral1). Property (\romannumeral1) agrees with our condition
that $f$ be a rig-\'etale morphism: this follows from
Lemma \ref{lemma-equivalent-with-artin} part (\ref{item-condition-artin}).

\medskip\noindent
Ad (\romannumeral2). Assume $f$ is rig-\'etale. Then
$\Delta_f : X \to X \times_Y X$ is rig-\'etale as a morphism
of locally Noetherian formal algebraic spaces which are
rig-\'etale over $X$ (via $\text{id}_X$ for the first one and via
$\text{pr}_1$ for the second one).
See Lemmas \ref{lemma-base-change-rig-etale} and
\ref{lemma-rig-etale-permanence}.
Hence property (\romannumeral2) agrees with our condition
that $\Delta_f$ be rig-surjective by
Lemma \ref{lemma-closed-immersion-rig-smooth-rig-surjective}.

\medskip\noindent
Ad (\romannumeral3). Property (\romannumeral3) does not quite
agree with our notion of a rig-surjective morphism, as Artin
requires all adic morphisms $\text{Spf}(R) \to Y$ to lift to
morphisms into $X$ whereas our notion of rig-surjective only
asserts the existence of a lift after replacing $R$ by an extension.
However, since we already have that $\Delta_f$ is
rig-\'etale and rig-surjective by (\romannumeral1) and (\romannumeral2),
these conditions are equivalent by
Lemma \ref{lemma-rig-monomorphism-rig-surjective}.
\end{remark}

\begin{lemma}
\label{lemma-modification-gives-formal-modification}
Let $S$, $f : X' \to X$, $T \subset |X|$, $U \subset X$,
$T' \subset |X'|$, and $U' \subset X'$ be as in
Section \ref{section-completion-functor}.
If $X$ is locally Noetherian, $f$ is proper, and $U' \to U$ is an isomorphism,
then $f_{/T} : X'_{/T'} \to X_{/T}$ is a formal modification.
\end{lemma}

\begin{proof}
By Formal Spaces, Lemmas \ref{formal-spaces-lemma-formal-completion-types}
the source and target of the arrow are locally Noetherian
formal algebraic spaces.
The other conditions follow from
Lemmas \ref{lemma-proper-gives-proper},
\ref{lemma-etale-gives-rig-etale},
\ref{lemma-completion-proper-surjective-rig-surjective}, and
\ref{lemma-separated-mono-open-diagonal-rig-surjective}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-formal-modification}
Let $S$ be a scheme. Let $f : X \to Y$ be a morphism of locally Noetherian
formal algebraic spaces over $S$ which is a formal modification.
Then for any adic morphism $Y' \to Y$ of locally Noetherian formal
algebraic spaces, the base change $f' : X \times_Y Y' \to Y'$ is
a formal modification.
\end{lemma}

\begin{proof}
The morphism $f'$ is proper by
Formal Spaces, Lemma \ref{formal-spaces-lemma-base-change-proper}.
The morphism $f'$ is rig-etale by
Lemma \ref{lemma-base-change-rig-etale}.
Then morphism $f'$ is rig-surjective by
Lemma \ref{lemma-base-change-rig-surjective}. Set $X' = X \times_ Y'$.
The morphism $\Delta_{f'}$ is the base change of
$\Delta_f$ by the adic morphism $X' \times_{Y'} X' \to X \times_Y X$.
Hence $\Delta_{f'}$ is rig-surjective by
Lemma \ref{lemma-base-change-rig-surjective}.
\end{proof}









\section{Completions and morphisms, I}
\label{section-completion-and-morphisms}

\noindent
In this section we put some preliminary results on completions
which we will use in the proof of Theorem \ref{theorem-dilatations-general}.
Although the lemmas stated and proved here are not trivial
(some are based on our work on algebraization of rig-\'etale algebras),
we still suggest the reader skip this section on a first reading.

\begin{lemma}
\label{lemma-algebraize-rig-etale-affine}
Let $T \subset X$ be a closed subset of a Noetherian affine scheme $X$.
Let $W$ be a Noetherian affine formal algebraic space.
Let $g : W \to X_{/T}$ be a rig-\'etale morphism. Then there exists
an affine scheme $X'$ and a finite type morphism $f : X' \to X$
\'etale over $X \setminus T$ such that there is an isomorphism
$X'_{/f^{-1}T} \cong W$ compatible with $f_{/T}$ and $g$.
Moreover, if $W \to X_{/T}$ is \'etale, then $X' \to X$ is \'etale.
\end{lemma}

\begin{proof}
The existence of $X'$ is a restatement of
Lemma \ref{lemma-approximate-by-etale-over-complement}.
The final statement follows from
More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}.
\end{proof}

\begin{lemma}
\label{lemma-algebraize-morphism-rig-etale}
Assume we have
\begin{enumerate}
\item Noetherian affine schemes $X$, $X'$, and $Y$,
\item a closed subset $T \subset |X|$,
\item a morphism $f : X' \to X$ locally of finite type
and \'etale over $X \setminus T$,
\item a morphism $h : Y \to X$,
\item a morphism $\alpha : Y_{/T} \to X'_{/T}$ over $X_{/T}$
(see proof for notation).
\end{enumerate}
Then there exists an \'etale morphism $b : Y' \to Y$ of affine schemes
which induces an isomorphism $b_{/T} : Y'_{/T} \to Y_{/T}$
and a morphism $a : Y' \to X'$ over $X$
such that $\alpha = a_{/T} \circ b_{/T}^{-1}$.
\end{lemma}

\begin{proof}
The notation using the subscript ${}_{/T}$ in the statement
refers to the construction which to a morphism of schemes $g : V \to X$
associates the morphism $g_{/T} : V_{/g^{-1}T} \to X_{/T}$ of formal
algebraic spaces; it is a functor from the category of schemes over $X$
to the category of formal algebraic spaces over $X_{/T}$, see
Section \ref{section-completion-functor}.
Having said this, the lemma is just a reformulation of
Lemma \ref{lemma-fully-faithful-etale-over-complement}.
\end{proof}

\begin{lemma}
\label{lemma-factor}
Let $S$ be a scheme. Let $f : X \to Y$ and $g : Z \to Y$ be morphisms
of algebraic spaces. Let $T \subset |X|$ be closed.
Assume that
\begin{enumerate}
\item $X$ is locally Noetherian,
\item $g$ is a monomorphism and locally of finite type,
\item $f|_{X \setminus T} : X \setminus T \to Y$ factors through $g$, and
\item $f_{/T} : X_{/T} \to Y$ factors through $g$,
\end{enumerate}
then $f$ factors through $g$.
\end{lemma}

\begin{proof}
Consider the fibre product $E = X \times_Y Z \to X$.
By assumption the open immersion $X \setminus T \to X$
factors through $E$ and any morphism $\varphi : X' \to X$ with
$|\varphi|(|X'|) \subset T$ factors through $E$ as well, see
Formal Spaces, Section \ref{formal-spaces-section-completion}.
By More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}
this implies that $E \to X$ is \'etale at every point of $E$
mapping to a point of $T$. Hence $E \to X$ is an \'etale
monomorphism, hence an open immersion
(Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-etale-universally-injective-open}).
Then it follows that $E = X$ since our assumptions imply that $|X| = |E|$.
\end{proof}

\begin{lemma}
\label{lemma-faithful-general}
Let $S$ be a scheme. Let $X$, $W$ be algebraic spaces over $S$ with
$X$ locally Noetherian. Let $T \subset |X|$ be a closed subset.
Let $a, b : X \to W$ be morphisms of algebraic spaces over $S$ such
that $a|_{X \setminus T} = b|_{X \setminus T}$ and such that
$a_{/T} = b_{/T}$ as morphisms $X_{/T} \to W$. Then $a = b$.
\end{lemma}

\begin{proof}
Let $E$ be the equalizer of $a$ and $b$. Then $E$ is an algebraic space
and $E \to X$ is locally of finite type and a monomorphism, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-properties-diagonal}.
Our assumptions imply we can apply Lemma \ref{lemma-factor} to the two
morphisms $f = \text{id} : X \to X$ and $g : E \to X$ and the closed
subset $T$ of $|X|$.
\end{proof}

\begin{lemma}
\label{lemma-faithful}
Let $S$ be a scheme. Let $X$, $Y$ be locally Noetherian algebraic spaces
over $S$. Let $T \subset |X|$ and $T' \subset |Y|$ be closed subsets.
Let $a, b : X \to Y$ be morphisms of algebraic spaces over $S$ such
that $a|_{X \setminus T} = b|_{X \setminus T}$, such that
$|a|(T) \subset T'$ and $|b|(T) \subset T'$, and such that
$a_{/T} = b_{/T}$ as morphisms $X_{/T} \to Y_{/T'}$.
Then $a = b$.
\end{lemma}

\begin{proof}
Consequence of the more general Lemma \ref{lemma-faithful-general}.
\end{proof}

\begin{lemma}
\label{lemma-equivalence-relation}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space
over $S$. Let $T \subset |X|$ be a closed subset.
Let $s, t : R \to U$ be two morphisms of algebraic spaces over $X$.
Assume
\begin{enumerate}
\item $R$, $U$ are locally of finite type over $X$,
\item the base change of $s$ and $t$ to $X \setminus T$
is an \'etale equivalence relation, and
\item the formal completion
$(t_{/T}, s_{/T}) : R_{/T} \to U_{/T} \times_{X_{/T}} U_{/T}$
is an equivalence relation too (see proof for notation).
\end{enumerate}
Then $(t, s) : R \to U \times_X U$ is an \'etale equivalence relation.
\end{lemma}

\begin{proof}
The notation using the subscript ${}_{/T}$ in the statement refers to the
construction which to a morphism $f : X' \to X$ of algebraic spaces
associates the morphism $f_{/T} : X'_{/f^{-1}T} \to X_{/T}$ of formal
algebraic spaces, see Section \ref{section-completion-functor}.
The morphisms $s, t : R \to U$ are \'etale over $X \setminus T$
by assumption. Since the formal completions of the maps
$s, t : R \to U$ are \'etale, we see that $s$ and $t$ are \'etale
for example by More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}.
Applying Lemma \ref{lemma-factor} to the morphisms
$\text{id} : R \times_{U \times_X U} R \to R \times_{U \times_X U} R$
and $\Delta : R \to R \times_{U \times_X U} R$ we conclude that
$(t, s)$ is a monomorphism. Applying it again to
$(t \circ \text{pr}_0, s \circ \text{pr}_1) :
R \times_{s, U, t} R \to U \times_X U$ and $(t, s) : R \to U \times_X U$
we find that ``transitivity'' holds. We omit the proof of
the other two axioms of an equivalence relation.
\end{proof}

\begin{lemma}
\label{lemma-smash-away-from-T}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$
and let $T \subset |X|$ be a closed subset. Let $f : X' \to X$ be a morphism
of algebraic spaces which is locally of finite type and \'etale outside of $T$.
There exists a factorization
$$
X' \longrightarrow X'' \longrightarrow X
$$
of $f$ with the following properties:
$X'' \to X$ is locally of finite type,
$X'' \to X$ is an isomorphism over $X \setminus T$, and
$X'_{/T} \to X''_{/T}$ is an isomorphism (see proof for notation).
\end{lemma}

\begin{proof}
The notation using the subscript ${}_{/T}$ in the statement refers to the
construction which to a morphism $f : X' \to X$ of algebraic spaces
associates the morphism $f_{/T} : X'_{/f^{-1}T} \to X_{/T}$ of formal
algebraic spaces, see Section \ref{section-completion-functor}.
We will also use the notion $U \subset X$ and $U' \subset X'$ to denote
the open subspaces with $|U| = |X| \setminus T$ and
$U' = |X'| \setminus f^{-1}T$ introduced in
Section \ref{section-completion-functor}.

\medskip\noindent
After replacing $X'$ by $X' \amalg U$ we may and do assume
the image of $X' \to X$ contains $U$.
Let
$$
R = X' \amalg_{U'} (U' \times_U U')
$$
be the pushout of $U' \to X'$ and the diagonal morphism
$U' \to U' \times_U U' = U' \times_X U'$. Since $U' \to X$ is \'etale,
this diagonal is an open immersion and we see that $R$ is an algebraic space
(this follows for example from
Spaces, Lemma \ref{spaces-lemma-glueing-algebraic-spaces}).
The two projections $U' \times_U U' \to U'$ extend to $R$
and we obtain two \'etale morphisms $s, t : R \to X'$.
Checking on each piece separatedly we find that $R$
is an \'etale equivalence relation on $X'$. Set $X'' = X'/R$
which is an algebraic space by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}.
By construction have the factorization as in the lemma and
the morphism $X'' \to X$ is locally of finite type (as this
can be checked \'etale locally, i.e., on $X'$).
Since $U' \to U$ is a surjective \'etale morphism
and since $s^{-1}(U') = t^{-1}(U') = U' \times_U U'$
we see that $U'' = U \times_X X'' \to U$ is an isomorphism.
Finally, we have to show the morphism $X' \to X''$ induces an isomorphism
$X'_{/T} \to X''_{/T}$. To see this, note that the formal completion of $R$
along the inverse image of $T$ is equal to the formal completion of
$X'$ along the inverse image of $T$ by our choice of $R$! By
our construction of the formal completion in
Formal Spaces, Section \ref{formal-spaces-section-completion}
we have $X''_{/T} = (X'_{/T}) / (R_{/T})$ as sheaves. Since
$X'_{/T} = R_{/T}$ we conclude that $X'_{/T} = X''_{/T}$
and this finishes the proof.
\end{proof}








\section{Rig glueing of morphisms}
\label{section-glue-formal-to-actual}

\noindent
Let $X$, $W$ be algebraic spaces with $X$ Noetherian. Let $Z \subset X$
be a closed subspace with open complement $U$.
The proposition below says roughly speaking that
$$
\{\text{morphisms }X \to W\} =
\{\text{compatible morphisms }U \to W\text{ and }X_{/Z} \to W\}
$$
where compatibility of $a : U \to W$ and $b : X_{/Z} \to W$
means that $a$ and $b$ define the same ``morphism of rig-spaces''.
To introduce the category of ``rig-spaces'' requires a lot of work, but
we don't need to do so in order to state precisely what the
condition means in this case.

\begin{proposition}
\label{proposition-glue-modification}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a closed subset with complementary open subspace
$U \subset X$. Let $f : X' \to X$ be a proper morphism
of algebraic spaces such that $f^{-1}(U) \to U$ is an isomorphism.
For any algebraic space $W$ over $S$ the map
$$
\Mor_S(X, W) \longrightarrow
\Mor_S(X', W) \times_{\Mor_S(X'_{/T}, W)} \Mor_S(X_{/T}, W)
$$
is bijective.
\end{proposition}

\begin{proof}
Let $w' : X' \to W$ and $\hat w : X_{/T} \to W$ be morphisms
which determine the same morphism $X'_{/T} \to W$ by composition
with $X'_{/T} \to X$ and $X'_{/T} \to X_{/T}$. We have to prove
there exists a unique morphism $w : X \to W$ whose composition
with $X' \to X$ and $X_{/T} \to X$ recovers $w'$ and $\hat w$.
The uniqueness is immediate from Lemma \ref{lemma-faithful-general}.

\medskip\noindent
The assumptions on $T$ and $f$ are preserved by base change
by any \'etale morphism $X_1 \to X$ of algebraic spaces.
Since formal algebraic spaces are sheaves for the
\'etale topology and since we aready have the uniqueness,
it suffices to prove existence after replacing $X$ by
the members of an \'etale covering. Thus we may assume $X$ is
an affine Noetherian scheme.

\medskip\noindent
Assume $X$ is an affine Noetherian scheme. We will construct
the morphism $w : X \to W$ using the material in
Pushouts of Spaces, Section \ref{spaces-pushouts-section-coequalizer-glue}.
It makes sense to read a little bit of the material
in that section before continuing the read the proof.

\medskip\noindent
Set $X'' = X' \times_X X'$ and consider the two morphisms
$a = w' \circ \text{pr}_1 : X'' \to W$ and 
$b = w' \circ \text{pr}_2 : X'' \to W$.
Then we see that $a$ and $b$ agree over the open $U$
and that $a_{/T}$ and $b_{a/T}$ agree (as these are
both equal to the composition $X''_{/T} \to X_{/T} \to W$
where the second arrow is $\hat w$).
Thus by Lemma \ref{lemma-faithful-general}
we see $a = b$.

\medskip\noindent
Denote $Z \subset X$ the reduced induced closed subscheme structure
on $T$. For $n \geq 1$ denote $Z_n \subset X$ the $n$th infinitesimal
neighbourhood of $Z$. Denote $w_n = \hat w|_{Z_n} : Z_n \to W$
so that we have $\hat w = \colim w_n$ on $X_{/T} = \colim Z_n$.
Set $Y_n = X' \amalg Z_n$. Consider the two projections
$$
s_n, t_n : R_n = Y_n \times_X Y_n \longrightarrow Y_n
$$
Let $Y_n \to X_n \to X$ be the coequalizer of $s_n$ and $t_n$ as in
Pushouts of Spaces, Section \ref{spaces-pushouts-section-coequalizer-glue}
(in particular this coequalizer exists, has good properties, etc, see
Pushouts of Spaces, Lemma \ref{spaces-pushouts-lemma-coequalizer}).
By the result $a = b$ of the previous parapgraph and the agreement
of $w'$ and $\hat w$ over $X'_{/T}$ we see that the morphism
$$
w' \amalg w_n : Y_n \longrightarrow W
$$
equalizes the morphisms $s_n$ and $t_n$. Hence we see that for all $n \geq 1$
there is a morphism $w^n : X_n \to W$ compatible with $w'$ and $w_n$.
Moreover, for $m \geq 1$ the composition
$$
X_n \to X_{n + m} \xrightarrow{w^{n + m}} W
$$
is equal to $w^n$ by construction (as the corresponding statement holds
for $w' \amalg w_{n + m}$ and $w' \amalg w_n$). By
Pushouts of Spaces, Lemma
\ref{spaces-pushouts-lemma-essentially-constant} and
Remark \ref{spaces-pushouts-remark-essentially-constant}
the system of algebraic spaces $X_n$ is essentially constant
with value $X$ and we conclude.
\end{proof}














\section{Algebraization of rig-\'etale morphisms}
\label{section-algebraization}

\noindent
In this section we prove a generalization of the result on dilatations
from the paper of Artin \cite{ArtinII}.

\medskip\noindent
The notation in this section will agree with the notation in
Section \ref{section-completion-functor} except our algebraic
spaces and formal algebraic spaces will be locally Noetherian.

\medskip\noindent
Thus, we first fix a base scheme $S$. All rings, topological rings,
schemes, algebraic spaces, and formal algebraic spaces and
morphisms between these will be over $S$. Next, we fix a
locally Noetherian algebraic space $X$ and a closed subset $T \subset |X|$.
We denote $U \subset X$ be the open subspace with $|U| = |X| \setminus T$.
Picture
$$
U \to X \quad |X| = |U| \amalg T
$$
Given a morphism of algebraic spaces $f : X' \to X$, we will use the notation
$U' = f^{-1}U$, $T' = |f|^{-1}(T)$, and $f_{/T} : X'_{/T'} \to X_{/T}$ as in
Section \ref{section-completion-functor}. We will sometimes write
$X'_{/T}$ in stead of $X'_{/T'}$ and more generally for a morphism
$a : X' \to X''$ of algebraic spaces over $X$ we will denote
$a_{/T} : X'_{/T} \to X''_{/T}$ the induced morphism of formal
algebraic spaces obtained by completing the morphism $a$ along
the inverse images of $T$ in $X'$ and $X''$.

\medskip\noindent
Given this setup we will consider the functor
\begin{equation}
\label{equation-completion-functor}
\left\{
\begin{matrix}
\text{morphisms of algebraic spaces}\\
f : X' \to X\text{ which are locally}\\
\text{of finite type and such that}\\
U' \to U\text{ is an isomorphism}
\end{matrix}
\right\}
\longrightarrow
\left\{
\begin{matrix}
\text{morphisms }g : W \to X_{/T}\\
\text{of formal algebraic spaces}\\
\text{with }W\text{ locally Noetherian}\\
\text{and }g\text{ rig-\'etale}
\end{matrix}
\right\}
\end{equation}
sending $f : X' \to X$ to $f_{/T} : X'_{/T'} \to X_{/T}$.
This makes sense because $f_{/T}$ is rig-\'etale by
Lemma \ref{lemma-etale-gives-rig-etale}.

\begin{lemma}
\label{lemma-functoriality-completion-functor}
In the situation above, let $X_1 \to X$ be a morphism of algebraic
spaces with $X_1$ locally Noetherian. Denote $T_1 \subset |X_1|$
the inverse image of $T$ and $U_1 \subset X_1$ the inverse image of $U$.
We denote
\begin{enumerate}
\item $\mathcal{C}_{X, T}$ the category whose objects are
morphisms of algebraic spaces $f : X' \to X$ which are locally
of finite type and such that $U' = f^{-1}U \to U$ is an isomorphism,
\item $\mathcal{C}_{X_1, T_1}$ the category whose objects are
morphisms of algebraic spaces $f_1 : X_1' \to X_1$ which are locally
of finite type and such that $f_1^{-1}U_1 \to U_1$ is an isomorphism,
\item $\mathcal{C}_{X_{/T}}$ the category whose objects are
morphisms $g : W \to X_{/T}$ of formal algebraic spaces
with $W$ locally Noetherian and $g$ rig-\'etale,
\item $\mathcal{C}_{X_{1, /T_1}}$ the category whose objects are
morphisms $g_1 : W_1 \to X_{1, /T_1}$ of formal algebraic spaces
with $W_1$ locally Noetherian and $g_1$ rig-\'etale.
\end{enumerate}
Then the diagram
$$
\xymatrix{
\mathcal{C}_{X, T} \ar[d] \ar[r] &
\mathcal{C}_{X_{/T}} \ar[d] \\
\mathcal{C}_{X_1, T_1} \ar[r] &
\mathcal{C}_{X_{1, /T_1}}
}
$$
is commutative where the horizonal arrows are given by
(\ref{equation-completion-functor})
and the vertical arrows by base change along
$X_1 \to X$ and along $X_{1, /T_1} \to X_{/T}$.
\end{lemma}

\begin{proof}
This follows immediately from the fact that the completion functor
$(h : Y \to X) \mapsto Y_{/T} = Y_{/|h|^{-1}T}$
on the category of algebraic spaces over $X$
commutes with fibre products.
\end{proof}

\begin{lemma}
\label{lemma-completion-functor-fully-faithful}
In the situation above. Let $f : X' \to X$ be a morphism of algebraic spaces
which is locally of finite type and an isomorphism over $U$. Let
$g : Y \to X$ be a morphism with $Y$ locally Noetherian. Then completion
defines a bijection
$$
\Mor_X(Y, X') \longrightarrow \Mor_{X_{/T}}(Y_{/T}, X'_{/T})
$$
In particular, the functor (\ref{equation-completion-functor}) is
fully faithful.
\end{lemma}

\begin{proof}
Let $a, b : Y \to X'$ be morphisms over $X$ such that
$a_{/T} = b_{/T}$. Then we see that $a$ and $b$ agree over the open
subspace $g^{-1}U$ and after completion along $g^{-1}T$.
Hence $a = b$ by Lemma \ref{lemma-faithful}.
In other words, the completion map is always injective.

\medskip\noindent
Let $\alpha : Y_{/T} \to X'_{/T}$ be a morphism of formal algebraic spaces
over $X_{/T}$. We have to prove there exists a morphism $a : Y \to X'$
over $X$ such that $\alpha = a_{/T}$. The proof proceeds by a standard
but cumbersome reduction to the affine case and then applying
Lemma \ref{lemma-algebraize-morphism-rig-etale}.

\medskip\noindent
Let $\{h_i : Y_i \to Y\}$ be an \'etale covering of algebraic spaces.
If we can find for each $i$ a morphism $a_i : Y_i \to X'$ over $X$
whose completion $(a_i)_{/T} : (Y_i)_{/T} \to X'_{/T}$ is equal to
$\alpha \circ (h_i)_{/T}$, then we get a morphism $a : Y \to X'$
with $\alpha = a_{/T}$. Namely, we first observe that
$(a_i)_{/T} \circ \text{pr}_1 = (a_j)_{/T} \circ \text{pr}_2$
as morphisms $(Y_i \times_Y Y_j)_{/T} \to X'_{/T}$ by the
agreement with $\alpha$ (this uses that completion ${}_{/T}$ commutes
with fibre products). By the injectivity already proven this shows that
$a_i \circ \text{pr}_1 = a_j \circ \text{pr}_2$ as morphisms
$Y_i \times_Y Y_j \to X'$. Since $X'$ is an fppf sheaf this means that
the collection of morphisms $a_i$ descends to a morphism $a : Y \to X'$.
We have $\alpha = a_{/T}$ because $\{(a_i)_{/T} : (Y_i)_{/T} \to X'_{/T}\}$
is an \'etale covering.

\medskip\noindent
By the result of the previous paragraph, to prove existence,
we may assume that $Y$ is affine and that $g : Y \to X$ factors
as $g_1 : Y \to X_1$ and an \'etale morphism $X_1 \to X$ with $X_1$ affine.
Then we can consider $T_1 \subset |X_1|$ the inverse image of $T$
and we can set $X'_1 = X' \times_X X_1$ with projection $f_1 : X'_1 \to X_1$
and
$$
\alpha_1 = (\alpha, (g_1)_{/T_1}) :
Y_{/T_1} = Y_{/T}
\longrightarrow
X'_{/T} \times_{X_{/T}} (X_1)_{/T_1} = (X'_1)_{/T_1}
$$
We conclude that it suffices to prove the existence for $\alpha_1$
over $X_1$, in other words, we may replace $X, T, X', Y, f, g, \alpha$
by $X_1, T_1, X'_1, Y, g_1, \alpha_1$.
This reduces us to the case described in the next paragraph.

\medskip\noindent
Assume $Y$ and $X$ are affine. Recall that $(Y_{/T})_{red}$
is an affine scheme (isomorphic to the reduced induced scheme structure
on $g^{-1}T \subset Y$, see Formal Spaces, Lemma
\ref{formal-spaces-lemma-reduction-completion}).
Hence $\alpha_{red} : (Y_{/T})_{red} \to (X'_{/T})_{red}$
has quasi-compact image $E$ in $f^{-1}T$ (this is the underlying
topological space of $(X'_{/T})_{red}$ by the same lemma as above).
Thus we can find an affine scheme $V$ and an \'etale morpism
$h : V \to X'$ such that the image of $h$ contains $E$.
Choose a solid cartesian diagram
$$
\xymatrix{
Y'_{/T} \ar@{..>}[rd] \ar@{..>}[r] &
W \ar[d] \ar[r] & V_{/T} \ar[d]^{h_{/T}} \\
& Y_{/T} \ar[r]^\alpha & X'_{/T}
}
$$
By construction, the morphism $W \to Y_{/T}$ is representable by
algebraic spaces, \'etale, and surjective
(surjectivity can be seen by looking at the reductions, see
Formal Spaces, Lemma
\ref{formal-spaces-lemma-reduction-surjective}).
By Lemma \ref{lemma-algebraize-rig-etale-affine}
we can write $W = Y'_{/T}$ for $Y' \to Y$ \'etale and $Y'$ affine.
This gives the dotted arrows in the diagram.
Since $W \to Y_{/T}$ is surjective, we see that
the image of $Y' \to Y$ contains $g^{-1}T$.
Hence $\{Y' \to Y, Y \setminus g^{-1}T \to Y\}$
is an \'etale covering. As $f$ is an isomorphism over $U$ we have a
(unique) morphism $Y \setminus g^{-1}T \to X'$ over $X$
agreeing with $\alpha$ on completions
(as the completion of $Y \setminus g^{-1}T$ is empty).
Thus it suffices to prove the existence for $Y'$
which reduces us to the case studied in the next paragraph.

\medskip\noindent
By the result of the previous paragraph, we may assume that $Y$ is affine
and that $\alpha$ factors as $Y_{/T} \to V_{/T} \to X'_{/T}$
where $V$ is an affine scheme \'etale over $X'$. We may still replace $Y$ by
the members of an affine \'etale covering.
By Lemma \ref{lemma-algebraize-morphism-rig-etale}
we may find an \'etale morphism $b : Y' \to Y$ of affine schemes
which induces an isomorphism $b_{/T} : Y'_{/T} \to Y_{/T}$
and a morphism $c : Y' \to V$ such that $c_{/T} \circ b_{/T}^{-1}$
is the given morphism $Y_{/T} \to V_{/T}$. Setting
$a' : Y' \to X'$ equal to the composition of $c$ and $V \to X'$
we find that $a'_{/T} = \alpha \circ b_{/T}$, in other words, we have
existence for $Y'$ and $\alpha \circ b_{/T}$.
Then we are done by replacing considering once more
the \'etale covering $\{Y' \to Y, Y \setminus g^{-1}T \to Y\}$.
\end{proof}

\begin{lemma}
\label{lemma-dilatations-affine}
In the situation above. Assume $X$ is affine. Then the functor
(\ref{equation-completion-functor}) is an equivalence.
\end{lemma}

\noindent
Before we prove this lemma let us discuss an example. Suppose that
$S = \Spec(k)$, $X = \mathbf{A}^1_k$, and $T = \{0\}$. Then
$X_{/T} = \text{Spf}(k[[x]])$. Let $W = \text{Spf}(k[[x]] \times k[[x]])$.
Then the corresponding $f : X' \to X$ is the affine line with zero doubled
mapping to the affine line
(Schemes, Example \ref{schemes-example-affine-space-zero-doubled}).
Moreover, this is the output of the construction in
Lemma \ref{lemma-smash-away-from-T}
starting with $X \amalg X$ over $X$.

\begin{proof}
We already know the functor is fully faithful, see
Lemma \ref{lemma-completion-functor-fully-faithful}.
Essential surjectivity. Let $g : W \to X_{/T}$ be a morphism
of formal algebraic spaces with $W$ locally Noetherian
and $g$ rig-\'etale. We will prove $W$ is in the essential
image in a number of steps.

\medskip\noindent
Step 1: $W$ is an affine formal algebraic space. Then we can find
$U \to X$ of finite type and \'etale over $X \setminus T$ such that
$U_{/T}$ is isomorphic to $W$, see
Lemma \ref{lemma-algebraize-rig-etale-affine}.
Thus we see that $W$ is in the essential image by
Lemma \ref{lemma-smash-away-from-T}.

\medskip\noindent
Step 2: $W$ is separated. Choose $\{W_i \to W\}$ as in
Formal Spaces, Definition \ref{formal-spaces-definition-formal-algebraic-space}.
By Step 1 the formal algebraic spaces $W_i$ and $W_i \times_W W_j$
are in the essential image.
Say $W_i = (X'_i)_{/T}$ and $W_i \times_W W_j = (X'_{ij})_{/T}$.
By fully faithfulness we obtain morphisms $t_{ij} : X'_{ij} \to X'_i$
and $s_{ij} : X'_{ij} \to X'_j$ matching the projections
$W_i \times_W W_j \to W_i$ and $W_i \times_W W_j \to W_j$.
Consider the structure
$$
R = \coprod X'_{ij},\quad
V = \coprod X'_i,\quad
s = \coprod s_{ij},\quad
t = \coprod t_{ij}
$$
(We can't use the letter $U$ as it has already been used.)
Applying Lemma \ref{lemma-equivalence-relation} we find that
$(t, s) : R \to V \times_X V$ defines an \'etale equivalence relation
on $V$ over $X$. Thus we can take the quotient $X' = V/R$ and
it is an algebraic space, see
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}.
Since completion commutes with fibre products and taking
quotient sheaves, we find that
$X'_{/T} \cong W$ as formal algebraic spaces over $X_{/T}$.

\medskip\noindent
Step 3: $W$ is general. Choose $\{W_i \to W\}$ as in
Formal Spaces, Definition \ref{formal-spaces-definition-formal-algebraic-space}.
The formal algebraic spaces $W_i$ and $W_i \times_W W_j$ are separated.
Hence by Step 2  the formal algebraic spaces $W_i$ and $W_i \times_W W_j$
are in the essential image. Then we argue exactly as in the previous
paragraph to see that $W$ is in the essential image as well.
This concludes the proof.
\end{proof}

\begin{theorem}
\label{theorem-dilatations-general}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. Let $U \subset X$ be the open subspace
with $|U| = |X| \setminus T$. The completion functor
(\ref{equation-completion-functor})
$$
\left\{
\begin{matrix}
\text{morphisms of algebraic spaces}\\
f : X' \to X\text{ which are locally}\\
\text{of finite type and such that}\\
f^{-1}U \to U\text{ is an isomorphism}
\end{matrix}
\right\}
\longrightarrow
\left\{
\begin{matrix}
\text{morphisms }g : W \to X_{/T}\\
\text{of formal algebraic spaces}\\
\text{with }W\text{ locally Noetherian}\\
\text{and }g\text{ rig-\'etale}
\end{matrix}
\right\}
$$
sending $f : X' \to X$ to $f_{/T} : X'_{/T'} \to X_{/T}$ is an equivalence.
\end{theorem}

\begin{proof}
The functor is fully faithful by
Lemma \ref{lemma-completion-functor-fully-faithful}.
Let $g : W \to X_{/T}$ be a morphism of formal algebraic spaces
with $W$ locally Noetherian and $g$ rig-\'etale.
We will prove $W$ is in the essential image to finish the proof.

\medskip\noindent
Choose an \'etale covering $\{X_i \to X\}$ with $X_i$ affine for all $i$.
Denote $U_i \subset X_i$ the inverse image of $U$ and denote
$T_i \subset X_i$ the inverse image of $T$.
Recall that $(X_i)_{/T_i} = (X_i)_{/T} = (X_i \times_X X)_{/T}$ and
$W_i = X_i \times_X W = (X_i)_{/T} \times_{X_{/T}} W$, see
Lemma \ref{lemma-functoriality-completion-functor}.
Observe that we obtain isomorphisms
$$
\alpha_{ij} :
W_i \times_{X_{/T}} (X_j)_{/T}
\longrightarrow 
(X_i)_{/T} \times_{X_{/T}} W_j
$$
satisfying a suitable cocycle condition.
By Lemma \ref{lemma-dilatations-affine} applied to
$X_i, T_i, U_i, W_i \to (X_i)_{/T}$
there exists a morphism $X'_i \to X_i$ of algebraic spaces
which is locally of finite type and an isomorphism over $U_i$
and an isomorphism $\beta_i : (X'_i)_{/T} \cong W_i$ over $(X_i)_{/T}$.
By fully faithfullness we find an isomorphism
$$
a_{ij} : X'_i \times_X X_j \longrightarrow X_i \times_X X'_j
$$
over $X_i \times_X X_j$ such that
$\alpha_{ij} = \beta_j|_{X_i \times_X X_j}
\circ (a_{ij})_{/T} \circ \beta_i^{-1}|_{X_i \times_X X_j}$.
By fully faithfulness again (this time over
$X_i \times_X X_j \times_X X_k$)
we see that these morphisms $a_{ij}$ satisfy the same
cocycle condition as satisfied by the $\alpha_{ij}$.
In other words, we obtain a descent datum
(as in Descent on Spaces, Definition
\ref{spaces-descent-definition-descent-datum-for-family-of-morphisms})
$(X'_i, a_{ij})$ relative to the family $\{X_i \to X\}$.
By Bootstrap, Lemma \ref{bootstrap-lemma-descend-algebraic-space},
this descent datum is effective. Thus we find a morphism
$f : X' \to X$ of algebraic spaces and isomorphisms
$h_i : X' \times_X X_i \to X'_i$ over $X_i$ such that
$a_{ij} = h_j|_{X_i \times_X X_j} \circ h_i^{-1}|_{X_i \times_X X_j}$.
The reader can check that the ensuing isomorphisms
$$
(X' \times_X X_i)_{/T}
\xrightarrow{\beta_i \circ (h_i)_{/T}}
W_i
$$
over $X_i$ glue to an isomorphism $X'_{/T} \to W$
over $X_{/T}$; some details omitted.
\end{proof}









\section{Completions and morphisms, II}
\label{section-completion-and-morphisms-bis}

\noindent
To obtain Artin's theorem on dilatations, we need to match
formal modifications with actual modifications in the correspondence
given by Theorem \ref{theorem-dilatations-general}.
We urge the reader to skip this section.

\begin{lemma}
\label{lemma-output-quasi-compact}
With assumptions and notation as in Theorem \ref{theorem-dilatations-general}
let $f : X' \to X$ correspond to $g : W \to X_{/T}$.
Then $f$ is quasi-compact if and only if $g$ is quasi-compact.
\end{lemma}

\begin{proof}
If $f$ is quasi-compact, then $g$ is quasi-compact by
Lemma \ref{lemma-quasi-compact-gives-quasi-compact}.
Conversely, assume $g$ is quasi-compact.
Choose an \'etale covering $\{X_i \to X\}$ with $X_i$ affine.
It suffices to prove that the base change $X' \times_X X_i \to X_i$
is quasi-compact, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-quasi-compact-local}.
By Formal Spaces, Lemma
\ref{formal-spaces-lemma-characterize-quasi-compact-morphism}
the base changes $W_i \times_{X_{/T}} (X_i)_{/T}  \to (X_i)_{/T}$
are quasi-compact.
By Lemma \ref{lemma-functoriality-completion-functor}
we reduce to the case described in the next paragraph.

\medskip\noindent
Assume $X$ is affine and $g : W \to X_{/T}$ quasi-compact.
We have to show that $X'$ is quasi-compact.
Let $V \to X'$ be a surjective \'etale morphism
where $V = \coprod_{j \in J} V_j$ is a disjoint union of affines. Then
$V_{/T} \to X'_{/T} = W$ is a surjective \'etale morphism.
Since $W$ is quasi-compact, then we can find a finite subset
$J' \subset J$ such that $\coprod_{j \in J'} (V_j)_{/T} \to W$ is surjective.
Then it follows that
$$
U \amalg \coprod\nolimits_{j \in J'} V_j \longrightarrow X'
$$
is surjective (and hence $X'$ is quasi-compact).
Namely, we have $|X'| = |U| \amalg |W_{red}|$ as $X'_{/T} = W$.
\end{proof}

\begin{lemma}
\label{lemma-output-quasi-separated}
With assumptions and notation as in Theorem \ref{theorem-dilatations-general}
let $f : X' \to X$ correspond to $g : W \to X_{/T}$.
Then $f$ is quasi-separated if and only if $g$ is so.
\end{lemma}

\begin{proof}
If $f$ is quasi-separated, then $g$ is quasi-separated by
Lemma \ref{lemma-quasi-separated-gives-quasi-separated}.
Conversely, assume $g$ is quasi-separated. We have to show
that $f$ is quasi-separated. Exactly as in the proof
of Lemma \ref{lemma-output-quasi-compact} we may check
this over the members of a \'etale covering of $X$ by affine schemes
using Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-separated-local}
and Formal Spaces, Lemma
\ref{formal-spaces-lemma-separated-local}.
Thus we may and do assume $X$ is affine.

\medskip\noindent
Let $V \to X'$ be a surjective \'etale morphism
where $V = \coprod_{j \in J} V_j$ is a disjoint union of affines.
To show that $X'$ is quasi-separated, it suffices to show that
$V_j \times_{X'} V_{j'}$ is quasi-compact for all $j, j' \in J$.
Since $W$ is quasi-separated the fibre products
$(V_j \times_Y V_{j'})_{/T} = (V_j)_{/T} \times_{X'_{/T}} (V_{j'})_{/T}$
are quasi-compact for all $j, j' \in J$. Since $X$ is Noetherian affine
and $U' \to U$ is an isomorphism, we see that
$$
(V_j \times_{X'} V_{j'}) \times_X U =
(V_j \times_X V_{j'}) \times_X U
$$
is quasi-compact. Hence we conclude by the equality
$$
|V_j \times_{X'} V_{j'}| =
|(V_j \times_{X'} V_{j'}) \times_X U| \amalg
|(V_j \times_{X'} V_{j'})_{/T, red}|
$$
and the fact that a formal algebraic space is quasi-compact if and
only if its associated reduced algebraic space is so.
\end{proof}

\begin{lemma}
\label{lemma-output-separated}
With assumptions and notation as in Theorem \ref{theorem-dilatations-general}
let $f : X' \to X$ correspond to $g : W \to X_{/T}$.
Then $f$ is separated $\Leftrightarrow$ $g$ is
separated and $\Delta_g : W \to W \times_{X_{/T}} W$ is rig-surjective.
\end{lemma}

\begin{proof}
If $f$ is separated, then $g$ is separated and $\Delta_g$
is rig-surjective by
Lemmas \ref{lemma-quasi-separated-gives-quasi-separated} and
\ref{lemma-separated-mono-open-diagonal-rig-surjective}.
Assume $g$ is separated and $\Delta_g$ is rig-surjective.
Exactly as in the proof of
Lemma \ref{lemma-output-quasi-compact}
we may check this over the members of a \'etale covering of $X$
by affine schemes using
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-base-change-separated}
(locality on the base of being separated for morphisms of algebraic spaces),
Formal Spaces, Lemma \ref{formal-spaces-lemma-base-change-separated}
(being separated for morphisms of formal algebraic spaces is preserved
by base change), and
Lemma \ref{lemma-base-change-rig-surjective} (being rig-surjective
is preserved by base change).
Thus we may and do assume $X$ is affine. Furthermore,
we already know that $f : X' \to X$ is quasi-separated by
Lemma \ref{lemma-output-quasi-separated}.

\medskip\noindent
By Cohomology of Spaces, Lemma
\ref{spaces-cohomology-lemma-check-separated-dvr} and
Remark \ref{spaces-cohomology-remark-variant}
it suffices to show that given any commutative diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X' \ar[d] \\
\Spec(R) \ar[r]^p \ar@{-->}[ru] & X' \times_X X'
}
$$
where $R$ is a complete discrete valuation ring with fraction field $K$,
there is a dotted arrow making the diagram commute (as this will
give the uniqueness part of the valuative criterion). Let
$h : \Spec(R) \to X$ be the composition of $p$ with the morphism
$Y \times_X Y \to X$. There are three cases:
Case I: $h(\Spec(R)) \subset U$. This case is trivial
because $U' = X' \times_X U \to U$ is an isomorphism.
Case II: $h$ maps $\Spec(R)$ into $T$. This case follows
from our assumption that $g : W \to X_{/T}$ is separated. Namely,
if $Z$ denotes the reduced induced closed subspace structure
on $T$, then $h$ factors through $Z$ and
$$
W \times_{X_{/T}} Z = X' \times_X Z \longrightarrow Z
$$
is separated by assumption (and for example
Formal Spaces, Lemma \ref{formal-spaces-lemma-separated-local})
which implies we get the lifting property by
Cohomology of Spaces, Lemma \ref{spaces-cohomology-lemma-check-separated-dvr}
applied to the displayed arrow. Case III: $h(\Spec(K))$ is not in $T$
but $h$ maps the closed point of $\Spec(R)$ into $T$. In this case
the corresponding morphism
$$
p_{/T} :
\text{Spf}(R)
\longrightarrow
(X' \times_X X')_{/T} =
W \times_{X_{/T}} W
$$
is an adic morphism (by
Formal Spaces, Lemma
\ref{formal-spaces-lemma-map-completions-representable} and
Definition \ref{formal-spaces-definition-adic-morphism}).
Hence our assumption that
$\Delta_g : W \to W \times_{X_{/T}} W$ is rig-surjective implies we can lift
$p_{/T}$ to a morphism $\text{Spf}(R) \to W = X'_{/T}$, see
Lemma \ref{lemma-monomorphism-rig-surjective}.
Algebraizing the composition $\text{Spf}(R) \to X'$ using
Formal Spaces, Lemma \ref{formal-spaces-lemma-map-into-algebraic-space}
we find a morphism $\Spec(R) \to X'$ lifting $p$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-output-proper}
With assumptions and notation as in Theorem \ref{theorem-dilatations-general}
let $f : X' \to X$ correspond to $g : W \to X_{/T}$.
Then $f$ is proper if and only if $g$ is a formal modification
(Definition \ref{definition-formal-modification}).
\end{lemma}

\begin{proof}
If $f$ is proper, then $g$ is a formal modification by
Lemma \ref{lemma-modification-gives-formal-modification}.
Assume $g$ is a formal modification. By
Lemmas \ref{lemma-output-quasi-compact} and \ref{lemma-output-separated}
we see that $f$ is quasi-compact and separated.

\medskip\noindent
By Cohomology of Spaces, Lemma \ref{spaces-cohomology-lemma-check-proper-dvr}
and Remark \ref{spaces-cohomology-remark-variant}
it suffices to show that given any commutative diagram
$$
\xymatrix{
\Spec(K) \ar[r] \ar[d] & X' \ar[d]^f \\
\Spec(R) \ar[r]^p \ar@{-->}[ru] & X
}
$$
where $R$ is a complete discrete valuation ring with fraction field $K$,
there is a dotted arrow making the diagram commute.
There are three cases:
Case I: $p(\Spec(R)) \subset U$. This case is trivial
because $U' \to U$ is an isomorphism.
Case II: $p$ maps $\Spec(R)$ into $T$. This case follows
from our assumption that $g : W \to X_{/T}$ is proper. Namely,
if $Z$ denotes the reduced induced closed subspace structure
on $T$, then $p$ factors through $Z$ and
$$
W \times_{X_{/T}} Z = X' \times_X Z \longrightarrow Z
$$
is proper by assumption which implies we get the lifting property by
Cohomology of Spaces, Lemma \ref{spaces-cohomology-lemma-check-proper-dvr}
applied to the displayed arrow. Case III: $p(\Spec(K))$ is not in $T$
but $p$ maps the closed point of $\Spec(R)$ into $T$. In this case
the corresponding morphism
$$
p_{/T} : \text{Spf}(R) \longrightarrow X'_{/T} = W
$$
is an adic morphism (by
Formal Spaces, Lemma
\ref{formal-spaces-lemma-map-completions-representable} and
Definition \ref{formal-spaces-definition-adic-morphism}).
Hence our assumption that $g : W \to X_{/T}$ be rig-surjective
implies we can lift $g_{/T}$ to a morphism
$\text{Spf}(R') \to W = X'_{/T}$
for some extension of complete discrete valuation rings $R \subset R'$.
Algebraizing the composition $\text{Spf}(R') \to X'$ using
Formal Spaces, Lemma \ref{formal-spaces-lemma-map-into-algebraic-space}
we find a morphism $\Spec(R') \to X'$ lifting $p$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-output-etale}
With assumptions and notation as in Theorem \ref{theorem-dilatations-general}
let $f : X' \to X$ correspond to $g : W \to X_{/T}$.
Then $f$ is \'etale if and only if $g$ is \'etale.
\end{lemma}

\begin{proof}
If $f$ is \'etale, then $g$ is \'etale by
Lemma \ref{lemma-map-completions-etale}.
Conversely, assume $g$ is \'etale.
Since $f$ is an isomorphism over $U$ we see that $f$ is \'etale
over $U$. Thus it suffices to prove that $f$ is \'etale
at any point of $X'$ lying over $T$. Denote $Z \subset X$
the reduced closed subspace whose underlying topological
space is $|Z| = T \subset |X|$, see
Properties of Spaces, Definition
\ref{spaces-properties-definition-reduced-induced-space}.
Letting $Z_n \subset X$ be the $n$th infinitesimal neighbourhood
we have $X_{/T} = \colim Z_n$. Since $X'_{/T} = W \to X_{/T}$
we conclude that $f^{-1}(Z_n) = X' \times_X Z_n \to Z_n$
is \'etale by the assumed \'etaleness of $g$.
By More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}
we conclude that $f$ is \'etale at points lying over $T$.
\end{proof}





\section{Artin's theorem on dilatations}
\label{section-dilatations}

\noindent
In this section we use a different font for formal algebraic spaces
to stress the similarity of the statements with the corresponding
statements in \cite{ArtinII}. Here is the first main theorem of this chapter.

\begin{theorem}
\label{theorem-dilatations}
\begin{reference}
\cite[Theorem 3.2]{ArtinII}
\end{reference}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a closed subset. Let
$\mathfrak X = X_{/T}$
be the formal completion of $X$ along $T$. Let
$$
\mathfrak f : \mathfrak X' \to \mathfrak X
$$
be a formal modification (Definition \ref{definition-formal-modification}).
Then there exists a unique proper morphism $f : X' \to X$ which is an
isomorphism over the complement of $T$ in $X$ whose completion $f_{/T}$
recovers $\mathfrak f$. 
\end{theorem}

\begin{proof}
This follows from Theorem \ref{theorem-dilatations-general}
and Lemma \ref{lemma-output-proper}.
\end{proof}

\noindent
Here is the characterization of formal modifcations
as promised in Section \ref{section-formal-modifications}.

\begin{lemma}
\label{lemma-formal-modifications-locally-algebraic}
Let $S$ be a scheme. Let $\mathfrak X' \to \mathfrak X$
be a formal modification (Definition \ref{definition-formal-modification})
of locally Noetherian formal algebraic spaces over $S$. Given
\begin{enumerate}
\item any adic Noetherian topological ring $A$,
\item any adic morphism $\text{Spf}(A) \longrightarrow \mathfrak X$
\end{enumerate}
there exists a proper morphism $X \to \Spec(A)$ of algebraic spaces
and an isomorphism
$$
\text{Spf}(A) \times_{\mathfrak X} \mathfrak X'
\longrightarrow
X_{/Z}
$$
over $\text{Spf}(A)$ of the base change of $\mathfrak X$
with the formal completion of $X$ along the ``closed fibre''
$Z = X \times_{\Spec(A)} \text{Spf}(A)_{red}$ of $X$ over $A$.
\end{lemma}

\begin{proof}
The morphism $\text{Spf}(A) \times_{\mathfrak X} \mathfrak X'
\to \text{Spf}(A)$ is a formal modification by
Lemma \ref{lemma-base-change-formal-modification}.
Hence this follows from Theorem \ref{theorem-dilatations}.
\end{proof}







\section{Application to modifications}
\label{section-modifications}

\noindent
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. We set
$X = \Spec(A)$ and $U = X \setminus V(I)$. In this section
we will consider the category
\begin{equation}
\label{equation-modification}
\left\{
f : X' \longrightarrow X
\quad \middle| \quad
\begin{matrix}
X'\text{ is an algebraic space}\\
f\text{ is locally of finite type}\\
f^{-1}(U) \to U\text{ is an isomorphism}
\end{matrix}
\right\}
\end{equation}
A morphism from $X'/X$ to $X''/X$ will be a morphism of algebraic spaces
$X' \to X''$ over $X$.

\medskip\noindent
Let $A \to B$ be a homomorphism of Noetherian rings and let $J \subset B$
be an ideal such that $J = \sqrt{I B}$. Then base
change along the morphism $\Spec(B) \to \Spec(A)$ gives a functor
from the category (\ref{equation-modification}) for $A$
to the category (\ref{equation-modification}) for $B$.

\begin{lemma}
\label{lemma-Noetherian-local-ring}
Let $A \to B$ be a ring homomorphism of Noetherian rings inducing an
isomorphism on $I$-adic completions for some ideal $I \subset A$
(for example if $B$ is the $I$-adic completion of $A$).
Then base change defines an equivalence of categories between the
category (\ref{equation-modification}) for $(A, I)$
with the category (\ref{equation-modification}) for $(B, IB)$.
\end{lemma}

\begin{proof}
Set $X = \Spec(A)$ and $T = V(I)$.
Set $X_1 = \Spec(B)$ and $T_1 = V(IB)$.
By Theorem \ref{theorem-dilatations-general} (in fact we only need
the affine case treated in Lemma \ref{lemma-dilatations-affine})
the category (\ref{equation-modification}) for $X$ and $T$
is equivalent to the the category of rig-\'etale morphisms
$W \to X_{/T}$ of locally Noetherian formal algebraic spaces.
Similarly, the the category (\ref{equation-modification})
for $X_1$ and $T_1$ is equivalent to the category of rig-\'etale
morphisms $W_1 \to X_{1, /T_1}$ of locally Noetherian formal
algebraic spaces. Since $X_{/T} = \text{Spf}(A^\wedge)$
and $X_{1, /T_1} = \text{Spf}(B^\wedge)$ (Formal Spaces, Lemma
\ref{formal-spaces-lemma-affine-formal-completion-types}) we see that
these categories are equivalent by our assumption that
$A^\wedge \to B^\wedge$ is an isomorphism. We omit the verification
that this equivalence is given by base change.
\end{proof}

\begin{lemma}
\label{lemma-Noetherian-local-ring-properties}
Notation and assumptions as in Lemma \ref{lemma-Noetherian-local-ring}.
Let $f : X' \to \Spec(A)$ correspond to $g : Y' \to \Spec(B)$
via the equivalence. Then $f$ is quasi-compact, quasi-separated, separated,
proper, finite, and add more here if and only if $g$ is so.
\end{lemma}

\begin{proof}
You can deduce this for the statements
quasi-compact, quasi-separated, separated, and proper
by using Lemmas \ref{lemma-output-quasi-compact}
\ref{lemma-output-quasi-separated},
\ref{lemma-output-separated},
\ref{lemma-output-quasi-separated}, and
\ref{lemma-output-proper}
to translate the corresponding property into a property
of the formal completion and using the argument of the proof
of Lemma \ref{lemma-Noetherian-local-ring}.
However, there is a direct argument using fpqc descent as follows.
First, you can reduce to proving the lemma for $A \to A^\wedge$
and $B \to B^\wedge$ since $A^\wedge  \to B^\wedge$ is an isomorphism.
Then note that $\{U \to \Spec(A), \Spec(A^\wedge) \to \Spec(A)\}$ is an
fpqc covering with $U = \Spec(A) \setminus V(I)$ as before.
The base change of $f$ by $U \to \Spec(A)$ is $\text{id}_U$
by definition of our category (\ref{equation-modification}).
Let $P$ be a property of morphisms of algebraic spaces which
is fpqc local on the base (Descent on Spaces, Definition
\ref{spaces-descent-definition-property-morphisms-local})
such that $P$ holds for identity morphisms.
Then we see that $P$ holds for $f$ if and only if $P$ holds for $g$.
This applies to $P$ equal to
quasi-compact, quasi-separated, separated, proper, and finite
by
Descent on Spaces, Lemmas
\ref{spaces-descent-lemma-descending-property-quasi-compact},
\ref{spaces-descent-lemma-descending-property-quasi-separated},
\ref{spaces-descent-lemma-descending-property-separated},
\ref{spaces-descent-lemma-descending-property-proper}, and
\ref{spaces-descent-lemma-descending-property-finite}.
\end{proof}

\begin{lemma}
\label{lemma-equivalence-to-completion}
Let $A \to B$ be a local map of local Noetherian rings such that
\begin{enumerate}
\item $A \to B$ is flat,
\item $\mathfrak m_B = \mathfrak m_A B$, and
\item $\kappa(\mathfrak m_A) = \kappa(\mathfrak m_B)$
\end{enumerate}
Then the base change functor from the category
(\ref{equation-modification}) for $(A, \mathfrak m_A)$ to the category
(\ref{equation-modification}) for $(B, \mathfrak m_B)$
is an equivalence.
\end{lemma}

\begin{proof}
The conditions signify that $A \to B$ induces an isomorphism on
completions, see
More on Algebra, Lemma \ref{more-algebra-lemma-flat-unramified}.
Hence this lemma is a special case of
Lemma \ref{lemma-Noetherian-local-ring}.
\end{proof}

\begin{lemma}
\label{lemma-dominate-by-admissible-blowup}
Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring.
Let $f : X \to S$ be an object of (\ref{equation-modification}).
Then there exists a $U$-admissible blowup $S' \to S$
which dominates $X$.
\end{lemma}

\begin{proof}
Special case of More on Morphisms of Spaces,
Lemma \ref{spaces-more-morphisms-lemma-dominate-modification-by-blowup}.
\end{proof}




\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}

